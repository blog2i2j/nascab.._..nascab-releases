function _0x31b4(){const _0x3ff108=['TYPE_UPLOAD','base64originalName','uploadFile','app','LEVEL_MAIN_OPERATION','over','340755jfqluA','statusCode','Connection','STATE_SUC','savePath','message','upload','exports','21bEfwVf','nascab_torrentSavePath','json','rename','diskStorage','set','skip','join','log','addFileOperationRecord','ctime','uploadTempFilePrefix','overMode','143ZdncKN','originalname','191333IXdkhh','path','returnFileError','base64','replace','toString','uploadSubtitle','body','saveFullPath','1231182RYYZez','SAMENAME','utimesSync','multer','122643AoxdMX','1144380LkZxcS','query','close','12dkgQAA','../utils/fileUtils','decodePath','username','filename','torrentPath','64yeYpIX','file','133317YoEMox','length','dbOther','torrentSavePath','170230RrOvmx','stat','currentUser'];_0x31b4=function(){return _0x3ff108;};return _0x31b4();}const _0x58147a=_0x4ed2;(function(_0x4f6827,_0x25828b){const _0x2252da=_0x4ed2,_0xf941b8=_0x4f6827();while(!![]){try{const _0x193a2a=parseInt(_0x2252da(0xdc))/0x1+-parseInt(_0x2252da(0xea))/0x2+-parseInt(_0x2252da(0xe9))/0x3*(-parseInt(_0x2252da(0xed))/0x4)+parseInt(_0x2252da(0xc5))/0x5+parseInt(_0x2252da(0xe5))/0x6*(parseInt(_0x2252da(0xcd))/0x7)+parseInt(_0x2252da(0xf3))/0x8*(parseInt(_0x2252da(0xf5))/0x9)+parseInt(_0x2252da(0xbc))/0xa*(-parseInt(_0x2252da(0xda))/0xb);if(_0x193a2a===_0x25828b)break;else _0xf941b8['push'](_0xf941b8['shift']());}catch(_0x42a612){_0xf941b8['push'](_0xf941b8['shift']());}}}(_0x31b4,0x4ecad));let fs=require('fs'),path=require(_0x58147a(0xdd)),uploadUtil={},multer=require(_0x58147a(0xe8)),fileUtil=require(_0x58147a(0xee));const config=require('../../myConfig/config');let dbFileOperationRecord=require('../../db/dbFileOperationRecord');const storage=multer[_0x58147a(0xd1)]({'destination':function(_0x15b582,_0x4855f6,_0x2d065b){const _0x566a05=_0x58147a;let _0x51c02b=_0x15b582[_0x566a05(0xeb)][_0x566a05(0xc9)];if(_0x15b582[_0x566a05(0xeb)][_0x566a05(0xf1)]){let _0xc597ea=_0x15b582['query']['filename'];try{_0xc597ea=decodeURIComponent(_0xc597ea);}catch(_0x4e428a){}_0x4855f6[_0x566a05(0xdb)]=_0xc597ea;}let _0x17ef12=path[_0x566a05(0xd4)](_0x51c02b,_0x4855f6['originalname']),_0x53e702=_0x15b582[_0x566a05(0xeb)][_0x566a05(0xd9)]||_0x15b582[_0x566a05(0xe3)]['overMode'];!_0x53e702&&(_0x53e702=_0x566a05(0xd3)),fs['stat'](_0x17ef12,(_0x3f2965,_0xa691f7)=>{const _0x5ecd0e=_0x566a05;if(!_0x3f2965){if(_0x53e702==_0x5ecd0e(0xd3))return _0x2d065b(new Error(_0x5ecd0e(0xe6)));else{if(_0x53e702==_0x5ecd0e(0xd0))_0x4855f6[_0x5ecd0e(0xdb)]=new Date()['getTime']()+_0x4855f6[_0x5ecd0e(0xdb)];else{if(_0x53e702==_0x5ecd0e(0xc4)){}}}}_0x15b582[_0x5ecd0e(0xeb)][_0x5ecd0e(0xdb)]=_0x4855f6[_0x5ecd0e(0xdb)][_0x5ecd0e(0xe0)](/[<>\\\/:\*\?\"\|]/g,'_'),_0x4855f6['originalname']=(config[_0x5ecd0e(0xd8)]+_0x4855f6[_0x5ecd0e(0xdb)])['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x17ef12=path[_0x5ecd0e(0xd4)](_0x51c02b,_0x4855f6['originalname']),_0x15b582[_0x5ecd0e(0xeb)][_0x5ecd0e(0xe4)]=_0x17ef12,_0x2d065b(null,_0x51c02b);});},'filename':function(_0x5586d8,_0x45ba02,_0x58bde4){const _0x4bded7=_0x58147a;_0x5586d8[_0x4bded7(0xeb)]['base64originalName']?_0x58bde4(null,Buffer['from'](_0x45ba02[_0x4bded7(0xdb)])[_0x4bded7(0xe1)](_0x4bded7(0xdf))):_0x58bde4(null,_0x45ba02[_0x4bded7(0xdb)]);}}),multerUpload=multer({'storage':storage})['single'](_0x58147a(0xf4));function _0x4ed2(_0x8dac3a,_0x241e73){const _0x31b4cb=_0x31b4();return _0x4ed2=function(_0x4ed260,_0x32ca06){_0x4ed260=_0x4ed260-0xba;let _0x4814f4=_0x31b4cb[_0x4ed260];return _0x4814f4;},_0x4ed2(_0x8dac3a,_0x241e73);}uploadUtil[_0x58147a(0xc1)]=function(_0x2504fe,_0x3fe5ac,_0x2637ee,_0x3f0e37,_0x518059,_0x1463a0,_0x274123){const _0xbf5820=_0x58147a;let _0x13474b=_0x2504fe[_0xbf5820(0xeb)][_0xbf5820(0xc9)]||_0x2504fe[_0xbf5820(0xe3)][_0xbf5820(0xc9)];if(_0x2504fe[_0xbf5820(0xeb)][_0xbf5820(0xe2)]==0x1){let _0x54742c=path[_0xbf5820(0xd4)](config['subtitlePath'],_0xbf5820(0xcb));_0x13474b=_0x54742c;}else _0x518059&&(_0x2504fe[_0xbf5820(0xeb)][_0xbf5820(0xc0)]=!![]),_0x2637ee&&(_0x13474b=fileUtil[_0xbf5820(0xef)](_0x13474b));if(_0x13474b==_0xbf5820(0xce)){let _0x51357b=path[_0xbf5820(0xd4)](config[_0xbf5820(0xf2)]);console['log'](_0xbf5820(0xbb),_0x51357b),_0x13474b=_0x51357b;}_0x2504fe[_0xbf5820(0xeb)][_0xbf5820(0xc9)]=_0x13474b,console[_0xbf5820(0xd5)](_0xbf5820(0xc9),_0x13474b),multerUpload(_0x2504fe,_0x3fe5ac,function(_0x1e2a75){const _0x2dcce3=_0xbf5820;if(_0x1e2a75)return _0x1e2a75[_0x2dcce3(0xca)]==_0x2dcce3(0xe6)?(_0x3fe5ac[_0x2dcce3(0xc6)]=0xc8,_0x3fe5ac[_0x2dcce3(0xd2)](_0x2dcce3(0xc7),_0x2dcce3(0xec)),_0x3fe5ac[_0x2dcce3(0xcf)]({'code':0x1,'remark':_0x2dcce3(0xe6),'message':_0x3fe5ac['__']('sameNameFileAlreadExist')})):(_0x274123&&_0x274123(_0x1e2a75),fileUtil['returnFileError'](_0x3fe5ac,_0x1e2a75));if(!_0x2504fe[_0x2dcce3(0xeb)][_0x2dcce3(0xdb)]){_0x274123&&_0x274123(_0x1e2a75);return;}let _0x5d68e7=path[_0x2dcce3(0xd4)](_0x2504fe['query']['savePath'],_0x2504fe[_0x2dcce3(0xeb)][_0x2dcce3(0xdb)]);fs[_0x2dcce3(0xbd)](_0x2504fe[_0x2dcce3(0xeb)][_0x2dcce3(0xe4)],(_0x4b8719,_0x690a06)=>{const _0x15cbb7=_0x2dcce3;if(_0x4b8719){_0x274123&&_0x274123(_0x4b8719);return;}_0x690a06['isFile']()&&fs[_0x15cbb7(0xd0)](_0x2504fe[_0x15cbb7(0xeb)]['saveFullPath'],_0x5d68e7,_0x467f50=>{const _0x553722=_0x15cbb7;if(_0x467f50)return _0x274123&&_0x274123(_0x467f50),fileUtil[_0x553722(0xde)](_0x3fe5ac,_0x467f50);else{dbFileOperationRecord[_0x553722(0xd6)](_0x2504fe[_0x553722(0xc2)][_0x553722(0xba)],{'username':_0x2504fe[_0x553722(0xbe)][_0x553722(0xf0)],'targetPath':_0x5d68e7,'level':dbFileOperationRecord[_0x553722(0xc3)],'type':dbFileOperationRecord[_0x553722(0xbf)],'state':dbFileOperationRecord[_0x553722(0xc8)]}),_0x2504fe[_0x553722(0xf4)][_0x553722(0xdd)]=_0x5d68e7,_0x2504fe[_0x553722(0xf4)][_0x553722(0xf1)]=_0x2504fe[_0x553722(0xeb)]['originalname'];let _0x108155=_0x2504fe['body'][_0x553722(0xd7)]||_0x2504fe[_0x553722(0xeb)][_0x553722(0xd7)];try{if(_0x108155){_0x108155=_0x108155+'';if(_0x108155[_0x553722(0xf6)]==0xa)fs[_0x553722(0xe7)](_0x5d68e7,_0x108155,_0x108155);else{}}}catch(_0x5de2ba){}_0x1463a0&&_0x1463a0(_0x2504fe[_0x553722(0xf4)]);if(!_0x3f0e37)return _0x3fe5ac[_0x553722(0xcf)]({'code':0x0,'file':_0x2504fe['file']});}});});});},module[_0x58147a(0xcc)]=uploadUtil;