const _0x296ca1=_0x1c4a;(function(_0x5b7997,_0x312d22){const _0x250e26=_0x1c4a,_0x46d80e=_0x5b7997();while(!![]){try{const _0x3657d8=-parseInt(_0x250e26(0x167))/0x1*(-parseInt(_0x250e26(0x15d))/0x2)+-parseInt(_0x250e26(0x154))/0x3*(-parseInt(_0x250e26(0x162))/0x4)+parseInt(_0x250e26(0x156))/0x5+-parseInt(_0x250e26(0x16c))/0x6*(-parseInt(_0x250e26(0x157))/0x7)+-parseInt(_0x250e26(0x176))/0x8*(parseInt(_0x250e26(0x147))/0x9)+parseInt(_0x250e26(0x160))/0xa+-parseInt(_0x250e26(0x175))/0xb;if(_0x3657d8===_0x312d22)break;else _0x46d80e['push'](_0x46d80e['shift']());}catch(_0x4d4752){_0x46d80e['push'](_0x46d80e['shift']());}}}(_0x44f6,0x8b79d));let fs=require('fs'),path=require('path'),uploadUtil={},multer=require(_0x296ca1(0x155)),fileUtil=require(_0x296ca1(0x14d));function _0x1c4a(_0x202b88,_0x5ce86a){const _0x44f697=_0x44f6();return _0x1c4a=function(_0x1c4a2e,_0x27e70f){_0x1c4a2e=_0x1c4a2e-0x143;let _0x1911d3=_0x44f697[_0x1c4a2e];return _0x1911d3;},_0x1c4a(_0x202b88,_0x5ce86a);}const config=require('../../myConfig/config');let dbFileOperationRecord=require(_0x296ca1(0x15a));function _0x44f6(){const _0x31fa8f=['4HnmzpM','upload','STATE_SUC','torrentSavePath','saveFullPath','1wGHrkM','message','skip','join','set','1273110vqYaVg','decodePath','toString','overMode','ctime','length','SAMENAME','filename','base64','17792379IXUsNA','427592VxCnHJ','LEVEL_MAIN_OPERATION','torrentPath','log','json','body','stat','nascab_torrentSavePath','app','utimesSync','returnFileError','54VnzrUG','file','uploadFile','uploadTempFilePrefix','savePath','rename','../utils/fileUtils','replace','diskStorage','query','sameNameFileAlreadExist','addFileOperationRecord','dbOther','2783637hVKTdw','multer','1513200HvQCaB','7kbZiOj','currentUser','uploadSubtitle','../../db/dbFileOperationRecord','isFile','originalname','1065462UpaQaB','base64originalName','from','5340410BwUQZK','getTime'];_0x44f6=function(){return _0x31fa8f;};return _0x44f6();}const storage=multer[_0x296ca1(0x14f)]({'destination':function(_0x3edfe,_0x3d715e,_0x717960){const _0x202475=_0x296ca1;let _0x1fa37e=_0x3edfe[_0x202475(0x150)][_0x202475(0x14b)];if(_0x3edfe['query']['filename']){let _0x5f3a88=_0x3edfe['query'][_0x202475(0x173)];try{_0x5f3a88=decodeURIComponent(_0x5f3a88);}catch(_0x2a2dc1){}_0x3d715e['originalname']=_0x5f3a88;}let _0x20ffe7=path[_0x202475(0x16a)](_0x1fa37e,_0x3d715e[_0x202475(0x15c)]),_0x10af9d=_0x3edfe[_0x202475(0x150)][_0x202475(0x16f)]||_0x3edfe['body'][_0x202475(0x16f)];!_0x10af9d&&(_0x10af9d=_0x202475(0x169)),fs[_0x202475(0x17c)](_0x20ffe7,(_0x3ee605,_0x44235b)=>{const _0x5483b5=_0x202475;if(!_0x3ee605){if(_0x10af9d==_0x5483b5(0x169))return _0x717960(new Error(_0x5483b5(0x172)));else{if(_0x10af9d==_0x5483b5(0x14c))_0x3d715e[_0x5483b5(0x15c)]=new Date()[_0x5483b5(0x161)]()+_0x3d715e[_0x5483b5(0x15c)];else{if(_0x10af9d=='over'){}}}}_0x3edfe[_0x5483b5(0x150)][_0x5483b5(0x15c)]=_0x3d715e['originalname'][_0x5483b5(0x14e)](/[<>\\\/:\*\?\"\|]/g,'_'),_0x3d715e[_0x5483b5(0x15c)]=(config[_0x5483b5(0x14a)]+_0x3d715e['originalname'])['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x20ffe7=path[_0x5483b5(0x16a)](_0x1fa37e,_0x3d715e[_0x5483b5(0x15c)]),_0x3edfe['query']['saveFullPath']=_0x20ffe7,_0x717960(null,_0x1fa37e);});},'filename':function(_0x489fc3,_0x378884,_0x2cc619){const _0x55cda1=_0x296ca1;_0x489fc3[_0x55cda1(0x150)]['base64originalName']?_0x2cc619(null,Buffer[_0x55cda1(0x15f)](_0x378884[_0x55cda1(0x15c)])[_0x55cda1(0x16e)](_0x55cda1(0x174))):_0x2cc619(null,_0x378884['originalname']);}}),multerUpload=multer({'storage':storage})['single'](_0x296ca1(0x148));uploadUtil[_0x296ca1(0x149)]=function(_0x22b527,_0x5fcc91,_0x455eda,_0x51e4d5,_0x102131,_0x395d5b,_0x6b5bda){const _0x147581=_0x296ca1;let _0x82a928=_0x22b527['query'][_0x147581(0x14b)]||_0x22b527['body'][_0x147581(0x14b)];if(_0x22b527[_0x147581(0x150)][_0x147581(0x159)]==0x1){let _0x32a90f=path[_0x147581(0x16a)](config['subtitlePath'],_0x147581(0x163));_0x82a928=_0x32a90f;}else _0x102131&&(_0x22b527['query'][_0x147581(0x15e)]=!![]),_0x455eda&&(_0x82a928=fileUtil[_0x147581(0x16d)](_0x82a928));if(_0x82a928==_0x147581(0x143)){let _0x39f428=path[_0x147581(0x16a)](config[_0x147581(0x178)]);console[_0x147581(0x179)](_0x147581(0x165),_0x39f428),_0x82a928=_0x39f428;}_0x22b527[_0x147581(0x150)]['savePath']=_0x82a928,console[_0x147581(0x179)](_0x147581(0x14b),_0x82a928),multerUpload(_0x22b527,_0x5fcc91,function(_0x1883da){const _0x1f7f45=_0x147581;if(_0x1883da)return _0x1883da[_0x1f7f45(0x168)]==_0x1f7f45(0x172)?(_0x5fcc91['statusCode']=0xc8,_0x5fcc91[_0x1f7f45(0x16b)]('Connection','close'),_0x5fcc91['json']({'code':0x1,'remark':_0x1f7f45(0x172),'message':_0x5fcc91['__'](_0x1f7f45(0x151))})):(_0x6b5bda&&_0x6b5bda(_0x1883da),fileUtil[_0x1f7f45(0x146)](_0x5fcc91,_0x1883da));if(!_0x22b527['query'][_0x1f7f45(0x15c)]){_0x6b5bda&&_0x6b5bda(_0x1883da);return;}let _0x1be20b=path[_0x1f7f45(0x16a)](_0x22b527[_0x1f7f45(0x150)]['savePath'],_0x22b527[_0x1f7f45(0x150)]['originalname']);fs[_0x1f7f45(0x17c)](_0x22b527['query'][_0x1f7f45(0x166)],(_0x5161f4,_0x1a8ef6)=>{const _0x32ef29=_0x1f7f45;if(_0x5161f4){_0x6b5bda&&_0x6b5bda(_0x5161f4);return;}_0x1a8ef6[_0x32ef29(0x15b)]()&&fs[_0x32ef29(0x14c)](_0x22b527[_0x32ef29(0x150)]['saveFullPath'],_0x1be20b,_0x1e5eec=>{const _0x1a868f=_0x32ef29;if(_0x1e5eec)return _0x6b5bda&&_0x6b5bda(_0x1e5eec),fileUtil[_0x1a868f(0x146)](_0x5fcc91,_0x1e5eec);else{dbFileOperationRecord[_0x1a868f(0x152)](_0x22b527[_0x1a868f(0x144)][_0x1a868f(0x153)],{'username':_0x22b527[_0x1a868f(0x158)]['username'],'targetPath':_0x1be20b,'level':dbFileOperationRecord[_0x1a868f(0x177)],'type':dbFileOperationRecord['TYPE_UPLOAD'],'state':dbFileOperationRecord[_0x1a868f(0x164)]}),_0x22b527[_0x1a868f(0x148)]['path']=_0x1be20b,_0x22b527[_0x1a868f(0x148)][_0x1a868f(0x173)]=_0x22b527[_0x1a868f(0x150)][_0x1a868f(0x15c)];let _0x6651c=_0x22b527[_0x1a868f(0x17b)]['ctime']||_0x22b527['query'][_0x1a868f(0x170)];try{if(_0x6651c){_0x6651c=_0x6651c+'';if(_0x6651c[_0x1a868f(0x171)]==0xa)fs[_0x1a868f(0x145)](_0x1be20b,_0x6651c,_0x6651c);else{}}}catch(_0x19590a){}_0x395d5b&&_0x395d5b(_0x22b527[_0x1a868f(0x148)]);if(!_0x51e4d5)return _0x5fcc91[_0x1a868f(0x17a)]({'code':0x0,'file':_0x22b527['file']});}});});});},module['exports']=uploadUtil;