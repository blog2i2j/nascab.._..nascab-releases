const _0x5c3a8a=_0x163b;function _0x564e(){const _0x47449b=['subtitlePath','uploadTempFilePrefix','from','exports','username','originalname','path','addFileOperationRecord','340ENNrJc','uploadFile','length','8135QUiQzO','decodePath','saveFullPath','isFile','STATE_SUC','398964bXanoS','filename','156663hUnEmW','43373WVYanI','ctime','uploadSubtitle','replace','join','utimesSync','savePath','close','LEVEL_MAIN_OPERATION','base64','Connection','sameNameFileAlreadExist','158845OIDHmP','stat','file','skip','statusCode','body','query','message','42wPoPbA','currentUser','toString','torrentSavePath','base64originalName','upload','SAMENAME','rename','../../myConfig/config','log','over','overMode','2bFEHRn','2005948mPnRmc','128AyZQGg','single','nascab_torrentSavePath','returnFileError','41272vJxQgx'];_0x564e=function(){return _0x47449b;};return _0x564e();}(function(_0x25e841,_0x2295f2){const _0x46a07e=_0x163b,_0x1475df=_0x25e841();while(!![]){try{const _0x5b7a73=-parseInt(_0x46a07e(0xc0))/0x1*(-parseInt(_0x46a07e(0xd4))/0x2)+-parseInt(_0x46a07e(0xb1))/0x3+parseInt(_0x46a07e(0xda))/0x4+-parseInt(_0x46a07e(0xac))/0x5*(parseInt(_0x46a07e(0xc8))/0x6)+-parseInt(_0x46a07e(0xd5))/0x7+parseInt(_0x46a07e(0xd6))/0x8*(parseInt(_0x46a07e(0xb3))/0x9)+-parseInt(_0x46a07e(0xe3))/0xa*(-parseInt(_0x46a07e(0xb4))/0xb);if(_0x5b7a73===_0x2295f2)break;else _0x1475df['push'](_0x1475df['shift']());}catch(_0x528803){_0x1475df['push'](_0x1475df['shift']());}}}(_0x564e,0x24d0c));let fs=require('fs'),path=require('path'),uploadUtil={},multer=require('multer'),fileUtil=require('../utils/fileUtils');function _0x163b(_0xfbccae,_0x8be609){const _0x564e06=_0x564e();return _0x163b=function(_0x163b4d,_0x4cbbe6){_0x163b4d=_0x163b4d-0xaa;let _0x47d3dd=_0x564e06[_0x163b4d];return _0x47d3dd;},_0x163b(_0xfbccae,_0x8be609);}const config=require(_0x5c3a8a(0xd0));let dbFileOperationRecord=require('../../db/dbFileOperationRecord');const storage=multer['diskStorage']({'destination':function(_0x4bc0dc,_0x43342f,_0x43f8b9){const _0x257ca7=_0x5c3a8a;let _0x3ba377=_0x4bc0dc[_0x257ca7(0xc6)]['savePath'];if(_0x4bc0dc[_0x257ca7(0xc6)]['filename']){let _0x5711c6=_0x4bc0dc[_0x257ca7(0xc6)]['filename'];try{_0x5711c6=decodeURIComponent(_0x5711c6);}catch(_0x2ef130){}_0x43342f[_0x257ca7(0xe0)]=_0x5711c6;}let _0x4b54ac=path['join'](_0x3ba377,_0x43342f[_0x257ca7(0xe0)]),_0x790c79=_0x4bc0dc['query'][_0x257ca7(0xd3)]||_0x4bc0dc[_0x257ca7(0xc5)][_0x257ca7(0xd3)];!_0x790c79&&(_0x790c79=_0x257ca7(0xc3)),fs[_0x257ca7(0xc1)](_0x4b54ac,(_0x24c7f8,_0x121988)=>{const _0x164994=_0x257ca7;if(!_0x24c7f8){if(_0x790c79=='skip')return _0x43f8b9(new Error(_0x164994(0xce)));else{if(_0x790c79==_0x164994(0xcf))_0x43342f[_0x164994(0xe0)]=new Date()['getTime']()+_0x43342f[_0x164994(0xe0)];else{if(_0x790c79==_0x164994(0xd2)){}}}}_0x4bc0dc['query'][_0x164994(0xe0)]=_0x43342f['originalname']['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x43342f['originalname']=(config[_0x164994(0xdc)]+_0x43342f[_0x164994(0xe0)])[_0x164994(0xb7)](/[<>\\\/:\*\?\"\|]/g,'_'),_0x4b54ac=path['join'](_0x3ba377,_0x43342f[_0x164994(0xe0)]),_0x4bc0dc[_0x164994(0xc6)][_0x164994(0xae)]=_0x4b54ac,_0x43f8b9(null,_0x3ba377);});},'filename':function(_0x45329f,_0x48ea11,_0xb3a387){const _0x1528df=_0x5c3a8a;_0x45329f[_0x1528df(0xc6)][_0x1528df(0xcc)]?_0xb3a387(null,Buffer[_0x1528df(0xdd)](_0x48ea11[_0x1528df(0xe0)])[_0x1528df(0xca)](_0x1528df(0xbd))):_0xb3a387(null,_0x48ea11[_0x1528df(0xe0)]);}}),multerUpload=multer({'storage':storage})[_0x5c3a8a(0xd7)]('file');uploadUtil[_0x5c3a8a(0xaa)]=function(_0x3e2478,_0x284c71,_0x292640,_0x44baa6,_0x50728c,_0x87702e,_0x2ca6dd){const _0x45e7c9=_0x5c3a8a;let _0x55098e=_0x3e2478['query'][_0x45e7c9(0xba)]||_0x3e2478[_0x45e7c9(0xc5)][_0x45e7c9(0xba)];if(_0x3e2478[_0x45e7c9(0xc6)][_0x45e7c9(0xb6)]==0x1){let _0x57e61c=path[_0x45e7c9(0xb8)](config[_0x45e7c9(0xdb)],_0x45e7c9(0xcd));_0x55098e=_0x57e61c;}else _0x50728c&&(_0x3e2478[_0x45e7c9(0xc6)][_0x45e7c9(0xcc)]=!![]),_0x292640&&(_0x55098e=fileUtil[_0x45e7c9(0xad)](_0x55098e));if(_0x55098e==_0x45e7c9(0xd8)){let _0xe4151e=path['join'](config['torrentPath']);console[_0x45e7c9(0xd1)](_0x45e7c9(0xcb),_0xe4151e),_0x55098e=_0xe4151e;}_0x3e2478[_0x45e7c9(0xc6)][_0x45e7c9(0xba)]=_0x55098e,console[_0x45e7c9(0xd1)](_0x45e7c9(0xba),_0x55098e),multerUpload(_0x3e2478,_0x284c71,function(_0x52b8ba){const _0x36459c=_0x45e7c9;if(_0x52b8ba)return _0x52b8ba[_0x36459c(0xc7)]==_0x36459c(0xce)?(_0x284c71[_0x36459c(0xc4)]=0xc8,_0x284c71['set'](_0x36459c(0xbe),_0x36459c(0xbb)),_0x284c71['json']({'code':0x1,'remark':_0x36459c(0xce),'message':_0x284c71['__'](_0x36459c(0xbf))})):(_0x2ca6dd&&_0x2ca6dd(_0x52b8ba),fileUtil[_0x36459c(0xd9)](_0x284c71,_0x52b8ba));if(!_0x3e2478[_0x36459c(0xc6)][_0x36459c(0xe0)]){_0x2ca6dd&&_0x2ca6dd(_0x52b8ba);return;}let _0x1f4245=path[_0x36459c(0xb8)](_0x3e2478[_0x36459c(0xc6)][_0x36459c(0xba)],_0x3e2478['query']['originalname']);fs[_0x36459c(0xc1)](_0x3e2478['query']['saveFullPath'],(_0x2152ec,_0x7ecc8d)=>{const _0x209125=_0x36459c;if(_0x2152ec){_0x2ca6dd&&_0x2ca6dd(_0x2152ec);return;}_0x7ecc8d[_0x209125(0xaf)]()&&fs[_0x209125(0xcf)](_0x3e2478[_0x209125(0xc6)][_0x209125(0xae)],_0x1f4245,_0x43cd25=>{const _0x376584=_0x209125;if(_0x43cd25)return _0x2ca6dd&&_0x2ca6dd(_0x43cd25),fileUtil[_0x376584(0xd9)](_0x284c71,_0x43cd25);else{dbFileOperationRecord[_0x376584(0xe2)](_0x3e2478['app']['dbOther'],{'username':_0x3e2478[_0x376584(0xc9)][_0x376584(0xdf)],'targetPath':_0x1f4245,'level':dbFileOperationRecord[_0x376584(0xbc)],'type':dbFileOperationRecord['TYPE_UPLOAD'],'state':dbFileOperationRecord[_0x376584(0xb0)]}),_0x3e2478[_0x376584(0xc2)][_0x376584(0xe1)]=_0x1f4245,_0x3e2478[_0x376584(0xc2)][_0x376584(0xb2)]=_0x3e2478[_0x376584(0xc6)][_0x376584(0xe0)];let _0x318837=_0x3e2478[_0x376584(0xc5)][_0x376584(0xb5)]||_0x3e2478[_0x376584(0xc6)][_0x376584(0xb5)];try{if(_0x318837){_0x318837=_0x318837+'';if(_0x318837[_0x376584(0xab)]==0xa)fs[_0x376584(0xb9)](_0x1f4245,_0x318837,_0x318837);else{}}}catch(_0x59faca){}_0x87702e&&_0x87702e(_0x3e2478[_0x376584(0xc2)]);if(!_0x44baa6)return _0x284c71['json']({'code':0x0,'file':_0x3e2478[_0x376584(0xc2)]});}});});});},module[_0x5c3a8a(0xde)]=uploadUtil;