const _0x2971b7=_0x21b4;(function(_0x43ab9c,_0x557155){const _0x316ca1=_0x21b4,_0x26a738=_0x43ab9c();while(!![]){try{const _0x104107=parseInt(_0x316ca1(0x191))/0x1*(parseInt(_0x316ca1(0x190))/0x2)+-parseInt(_0x316ca1(0x197))/0x3+parseInt(_0x316ca1(0x198))/0x4+-parseInt(_0x316ca1(0x17a))/0x5+-parseInt(_0x316ca1(0x18f))/0x6+parseInt(_0x316ca1(0x183))/0x7*(parseInt(_0x316ca1(0x193))/0x8)+-parseInt(_0x316ca1(0x19a))/0x9*(parseInt(_0x316ca1(0x17d))/0xa);if(_0x104107===_0x557155)break;else _0x26a738['push'](_0x26a738['shift']());}catch(_0x1c4a19){_0x26a738['push'](_0x26a738['shift']());}}}(_0x3a57,0x54af2));function _0x3a57(){const _0x492c11=['skip','message','4580pobgyb','json','app','LEVEL_MAIN_OPERATION','currentUser','filename','56lXBbFs','savePath','path','SAMENAME','ctime','torrentSavePath','replace','subtitlePath','stat','torrentPath','exports','diskStorage','1149138SXjOou','2mVQfOn','504626CxIQpv','join','337744VXjdPF','single','toString','decodePath','775638oibiGB','2709732vurtBO','overMode','5229qHckgd','isFile','../utils/fileUtils','returnFileError','sameNameFileAlreadExist','multer','uploadSubtitle','file','statusCode','query','utimesSync','originalname','rename','Connection','base64originalName','body','length','saveFullPath','2283850qVdAZp'];_0x3a57=function(){return _0x492c11;};return _0x3a57();}let fs=require('fs'),path=require(_0x2971b7(0x185)),uploadUtil={},multer=require(_0x2971b7(0x16d)),fileUtil=require(_0x2971b7(0x19c));const config=require('../../myConfig/config');let dbFileOperationRecord=require('../../db/dbFileOperationRecord');const storage=multer[_0x2971b7(0x18e)]({'destination':function(_0x3db487,_0x10b5b2,_0x3c646c){const _0x395c13=_0x2971b7;let _0x254201=_0x3db487[_0x395c13(0x171)][_0x395c13(0x184)];if(_0x3db487['query'][_0x395c13(0x182)]){let _0x406b00=_0x3db487['query'][_0x395c13(0x182)];try{_0x406b00=decodeURIComponent(_0x406b00);}catch(_0x5506f0){}_0x10b5b2['originalname']=_0x406b00;}let _0x53070f=path['join'](_0x254201,_0x10b5b2[_0x395c13(0x173)]),_0x51bc7d=_0x3db487['query'][_0x395c13(0x199)]||_0x3db487['body']['overMode'];!_0x51bc7d&&(_0x51bc7d=_0x395c13(0x17b)),fs['stat'](_0x53070f,(_0x3dd54f,_0x2d1b66)=>{const _0x58a001=_0x395c13;if(!_0x3dd54f){if(_0x51bc7d=='skip')return _0x3c646c(new Error(_0x58a001(0x186)));else{if(_0x51bc7d==_0x58a001(0x174))_0x10b5b2[_0x58a001(0x173)]=new Date()['getTime']()+_0x10b5b2[_0x58a001(0x173)];else{if(_0x51bc7d=='over'){}}}}_0x3db487[_0x58a001(0x171)][_0x58a001(0x173)]=_0x10b5b2['originalname'][_0x58a001(0x189)](/[<>\\\/:\*\?\"\|]/g,'_'),_0x10b5b2[_0x58a001(0x173)]=(config['uploadTempFilePrefix']+_0x10b5b2[_0x58a001(0x173)])['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x53070f=path[_0x58a001(0x192)](_0x254201,_0x10b5b2['originalname']),_0x3db487[_0x58a001(0x171)]['saveFullPath']=_0x53070f,_0x3c646c(null,_0x254201);});},'filename':function(_0x20d569,_0xb188e2,_0x4fb7a2){const _0x1b9c56=_0x2971b7;_0x20d569[_0x1b9c56(0x171)][_0x1b9c56(0x176)]?_0x4fb7a2(null,Buffer['from'](_0xb188e2[_0x1b9c56(0x173)])[_0x1b9c56(0x195)]('base64')):_0x4fb7a2(null,_0xb188e2[_0x1b9c56(0x173)]);}}),multerUpload=multer({'storage':storage})[_0x2971b7(0x194)](_0x2971b7(0x16f));function _0x21b4(_0x4e0738,_0x4d712e){const _0x3a5786=_0x3a57();return _0x21b4=function(_0x21b400,_0x503cee){_0x21b400=_0x21b400-0x16b;let _0x2b0407=_0x3a5786[_0x21b400];return _0x2b0407;},_0x21b4(_0x4e0738,_0x4d712e);}uploadUtil['uploadFile']=function(_0x25a7f8,_0x26a3f7,_0x759de1,_0x3c1b3a,_0xc23c8,_0x3e5c8a,_0x5372c7){const _0x59cfef=_0x2971b7;let _0x4d76eb=_0x25a7f8['query'][_0x59cfef(0x184)]||_0x25a7f8['body'][_0x59cfef(0x184)];if(_0x25a7f8['query'][_0x59cfef(0x16e)]==0x1){let _0x30055f=path[_0x59cfef(0x192)](config[_0x59cfef(0x18a)],'upload');_0x4d76eb=_0x30055f;}else _0xc23c8&&(_0x25a7f8[_0x59cfef(0x171)][_0x59cfef(0x176)]=!![]),_0x759de1&&(_0x4d76eb=fileUtil[_0x59cfef(0x196)](_0x4d76eb));if(_0x4d76eb=='nascab_torrentSavePath'){let _0x4b83fd=path['join'](config[_0x59cfef(0x18c)]);console['log'](_0x59cfef(0x188),_0x4b83fd),_0x4d76eb=_0x4b83fd;}_0x25a7f8[_0x59cfef(0x171)][_0x59cfef(0x184)]=_0x4d76eb,console['log'](_0x59cfef(0x184),_0x4d76eb),multerUpload(_0x25a7f8,_0x26a3f7,function(_0x5c7a0e){const _0x32a919=_0x59cfef;if(_0x5c7a0e)return _0x5c7a0e[_0x32a919(0x17c)]==_0x32a919(0x186)?(_0x26a3f7[_0x32a919(0x170)]=0xc8,_0x26a3f7['set'](_0x32a919(0x175),'close'),_0x26a3f7[_0x32a919(0x17e)]({'code':0x1,'remark':'SAMENAME','message':_0x26a3f7['__'](_0x32a919(0x16c))})):(_0x5372c7&&_0x5372c7(_0x5c7a0e),fileUtil[_0x32a919(0x16b)](_0x26a3f7,_0x5c7a0e));if(!_0x25a7f8['query'][_0x32a919(0x173)]){_0x5372c7&&_0x5372c7(_0x5c7a0e);return;}let _0x1785e4=path[_0x32a919(0x192)](_0x25a7f8['query'][_0x32a919(0x184)],_0x25a7f8[_0x32a919(0x171)]['originalname']);fs[_0x32a919(0x18b)](_0x25a7f8['query'][_0x32a919(0x179)],(_0x2b3dd2,_0x10b50f)=>{const _0x202845=_0x32a919;if(_0x2b3dd2){_0x5372c7&&_0x5372c7(_0x2b3dd2);return;}_0x10b50f[_0x202845(0x19b)]()&&fs[_0x202845(0x174)](_0x25a7f8[_0x202845(0x171)][_0x202845(0x179)],_0x1785e4,_0x9de34a=>{const _0x34dbe4=_0x202845;if(_0x9de34a)return _0x5372c7&&_0x5372c7(_0x9de34a),fileUtil['returnFileError'](_0x26a3f7,_0x9de34a);else{dbFileOperationRecord['addFileOperationRecord'](_0x25a7f8[_0x34dbe4(0x17f)]['dbOther'],{'username':_0x25a7f8[_0x34dbe4(0x181)]['username'],'targetPath':_0x1785e4,'level':dbFileOperationRecord[_0x34dbe4(0x180)],'type':dbFileOperationRecord['TYPE_UPLOAD'],'state':dbFileOperationRecord['STATE_SUC']}),_0x25a7f8[_0x34dbe4(0x16f)][_0x34dbe4(0x185)]=_0x1785e4,_0x25a7f8[_0x34dbe4(0x16f)][_0x34dbe4(0x182)]=_0x25a7f8[_0x34dbe4(0x171)]['originalname'];let _0x4820af=_0x25a7f8[_0x34dbe4(0x177)][_0x34dbe4(0x187)]||_0x25a7f8[_0x34dbe4(0x171)]['ctime'];try{if(_0x4820af){_0x4820af=_0x4820af+'';if(_0x4820af[_0x34dbe4(0x178)]==0xa)fs[_0x34dbe4(0x172)](_0x1785e4,_0x4820af,_0x4820af);else{}}}catch(_0x1f8c10){}_0x3e5c8a&&_0x3e5c8a(_0x25a7f8[_0x34dbe4(0x16f)]);if(!_0x3c1b3a)return _0x26a3f7['json']({'code':0x0,'file':_0x25a7f8[_0x34dbe4(0x16f)]});}});});});},module[_0x2971b7(0x18d)]=uploadUtil;