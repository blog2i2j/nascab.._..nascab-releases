function _0x2a50(_0x2b77b2,_0x24a7f5){const _0x3bb7af=_0x3bb7();return _0x2a50=function(_0x2a5060,_0x41d7dc){_0x2a5060=_0x2a5060-0x1a8;let _0x505119=_0x3bb7af[_0x2a5060];return _0x505119;},_0x2a50(_0x2b77b2,_0x24a7f5);}const _0x54be90=_0x2a50;(function(_0x2d0f4d,_0x1d5f19){const _0x4409a1=_0x2a50,_0x5c28b2=_0x2d0f4d();while(!![]){try{const _0x384033=-parseInt(_0x4409a1(0x1b8))/0x1*(parseInt(_0x4409a1(0x1d5))/0x2)+parseInt(_0x4409a1(0x1cf))/0x3*(-parseInt(_0x4409a1(0x1c3))/0x4)+parseInt(_0x4409a1(0x1b5))/0x5+-parseInt(_0x4409a1(0x1bc))/0x6*(parseInt(_0x4409a1(0x1b0))/0x7)+-parseInt(_0x4409a1(0x1af))/0x8+-parseInt(_0x4409a1(0x1ca))/0x9*(parseInt(_0x4409a1(0x1db))/0xa)+-parseInt(_0x4409a1(0x1bd))/0xb*(-parseInt(_0x4409a1(0x1ce))/0xc);if(_0x384033===_0x1d5f19)break;else _0x5c28b2['push'](_0x5c28b2['shift']());}catch(_0xa07898){_0x5c28b2['push'](_0x5c28b2['shift']());}}}(_0x3bb7,0x8eba4));function _0x3bb7(){const _0x298d3d=['TYPE_UPLOAD','2509900oXNXaY','overMode','stat','single','uploadFile','ctime','addFileOperationRecord','file','nascab_torrentSavePath','base64','STATE_SUC','../../db/dbFileOperationRecord','currentUser','6132208uZLBoJ','21oPjBkM','filename','close','exports','log','801665NAstSF','join','torrentSavePath','1MuKqnH','over','uploadTempFilePrefix','isFile','411672oLKDHk','11GLzhrI','Connection','torrentPath','username','getTime','body','444088uCaqRS','decodePath','returnFileError','toString','message','sameNameFileAlreadExist','originalname','36CRyUjo','path','saveFullPath','savePath','37593516lvFNQK','15JdaTwv','SAMENAME','LEVEL_MAIN_OPERATION','length','dbOther','query','354164SaQYOw','multer','base64originalName','statusCode','rename'];_0x3bb7=function(){return _0x298d3d;};return _0x3bb7();}let fs=require('fs'),path=require(_0x54be90(0x1cb)),uploadUtil={},multer=require(_0x54be90(0x1d6)),fileUtil=require('../utils/fileUtils');const config=require('../../myConfig/config');let dbFileOperationRecord=require(_0x54be90(0x1ad));const storage=multer['diskStorage']({'destination':function(_0x2ce38f,_0x4b3fde,_0x2fa830){const _0x2e348f=_0x54be90;let _0x273a29=_0x2ce38f[_0x2e348f(0x1d4)]['savePath'];if(_0x2ce38f[_0x2e348f(0x1d4)][_0x2e348f(0x1b1)]){let _0xfcced8=_0x2ce38f[_0x2e348f(0x1d4)]['filename'];try{_0xfcced8=decodeURIComponent(_0xfcced8);}catch(_0x262512){}_0x4b3fde[_0x2e348f(0x1c9)]=_0xfcced8;}let _0x23359a=path[_0x2e348f(0x1b6)](_0x273a29,_0x4b3fde[_0x2e348f(0x1c9)]),_0xad8d4f=_0x2ce38f[_0x2e348f(0x1d4)][_0x2e348f(0x1dc)]||_0x2ce38f['body']['overMode'];!_0xad8d4f&&(_0xad8d4f='skip'),fs['stat'](_0x23359a,(_0x9f696e,_0x5edb9c)=>{const _0x59e689=_0x2e348f;if(!_0x9f696e){if(_0xad8d4f=='skip')return _0x2fa830(new Error(_0x59e689(0x1d0)));else{if(_0xad8d4f=='rename')_0x4b3fde[_0x59e689(0x1c9)]=new Date()[_0x59e689(0x1c1)]()+_0x4b3fde[_0x59e689(0x1c9)];else{if(_0xad8d4f==_0x59e689(0x1b9)){}}}}_0x2ce38f[_0x59e689(0x1d4)][_0x59e689(0x1c9)]=_0x4b3fde[_0x59e689(0x1c9)]['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x4b3fde['originalname']=(config[_0x59e689(0x1ba)]+_0x4b3fde[_0x59e689(0x1c9)])['replace'](/[<>\\\/:\*\?\"\|]/g,'_'),_0x23359a=path['join'](_0x273a29,_0x4b3fde['originalname']),_0x2ce38f[_0x59e689(0x1d4)]['saveFullPath']=_0x23359a,_0x2fa830(null,_0x273a29);});},'filename':function(_0x59129b,_0x1dbef7,_0x4b20b7){const _0x44c4a9=_0x54be90;_0x59129b[_0x44c4a9(0x1d4)][_0x44c4a9(0x1d7)]?_0x4b20b7(null,Buffer['from'](_0x1dbef7['originalname'])[_0x44c4a9(0x1c6)](_0x44c4a9(0x1ab))):_0x4b20b7(null,_0x1dbef7[_0x44c4a9(0x1c9)]);}}),multerUpload=multer({'storage':storage})[_0x54be90(0x1de)](_0x54be90(0x1a9));uploadUtil[_0x54be90(0x1df)]=function(_0x2deae7,_0x3fd6dd,_0x35923a,_0x4623ca,_0xd6c34e,_0x241dde,_0x27a23c){const _0x133980=_0x54be90;let _0x27909f=_0x2deae7[_0x133980(0x1d4)][_0x133980(0x1cd)]||_0x2deae7[_0x133980(0x1c2)][_0x133980(0x1cd)];if(_0x2deae7[_0x133980(0x1d4)]['uploadSubtitle']==0x1){let _0x1a2cea=path[_0x133980(0x1b6)](config['subtitlePath'],'upload');_0x27909f=_0x1a2cea;}else _0xd6c34e&&(_0x2deae7[_0x133980(0x1d4)][_0x133980(0x1d7)]=!![]),_0x35923a&&(_0x27909f=fileUtil[_0x133980(0x1c4)](_0x27909f));if(_0x27909f==_0x133980(0x1aa)){let _0x1fc8dd=path[_0x133980(0x1b6)](config[_0x133980(0x1bf)]);console[_0x133980(0x1b4)](_0x133980(0x1b7),_0x1fc8dd),_0x27909f=_0x1fc8dd;}_0x2deae7['query'][_0x133980(0x1cd)]=_0x27909f,console[_0x133980(0x1b4)](_0x133980(0x1cd),_0x27909f),multerUpload(_0x2deae7,_0x3fd6dd,function(_0x394e27){const _0x4669f6=_0x133980;if(_0x394e27)return _0x394e27[_0x4669f6(0x1c7)]=='SAMENAME'?(_0x3fd6dd[_0x4669f6(0x1d8)]=0xc8,_0x3fd6dd['set'](_0x4669f6(0x1be),_0x4669f6(0x1b2)),_0x3fd6dd['json']({'code':0x1,'remark':_0x4669f6(0x1d0),'message':_0x3fd6dd['__'](_0x4669f6(0x1c8))})):(_0x27a23c&&_0x27a23c(_0x394e27),fileUtil[_0x4669f6(0x1c5)](_0x3fd6dd,_0x394e27));if(!_0x2deae7[_0x4669f6(0x1d4)][_0x4669f6(0x1c9)]){_0x27a23c&&_0x27a23c(_0x394e27);return;}let _0x3f22b6=path[_0x4669f6(0x1b6)](_0x2deae7['query']['savePath'],_0x2deae7[_0x4669f6(0x1d4)][_0x4669f6(0x1c9)]);fs[_0x4669f6(0x1dd)](_0x2deae7[_0x4669f6(0x1d4)][_0x4669f6(0x1cc)],(_0x367b63,_0xe063b1)=>{const _0x101acd=_0x4669f6;if(_0x367b63){_0x27a23c&&_0x27a23c(_0x367b63);return;}_0xe063b1[_0x101acd(0x1bb)]()&&fs[_0x101acd(0x1d9)](_0x2deae7[_0x101acd(0x1d4)][_0x101acd(0x1cc)],_0x3f22b6,_0x344b71=>{const _0x9d917c=_0x101acd;if(_0x344b71)return _0x27a23c&&_0x27a23c(_0x344b71),fileUtil[_0x9d917c(0x1c5)](_0x3fd6dd,_0x344b71);else{dbFileOperationRecord[_0x9d917c(0x1a8)](_0x2deae7['app'][_0x9d917c(0x1d3)],{'username':_0x2deae7[_0x9d917c(0x1ae)][_0x9d917c(0x1c0)],'targetPath':_0x3f22b6,'level':dbFileOperationRecord[_0x9d917c(0x1d1)],'type':dbFileOperationRecord[_0x9d917c(0x1da)],'state':dbFileOperationRecord[_0x9d917c(0x1ac)]}),_0x2deae7['file']['path']=_0x3f22b6,_0x2deae7[_0x9d917c(0x1a9)]['filename']=_0x2deae7[_0x9d917c(0x1d4)][_0x9d917c(0x1c9)];let _0x4dde75=_0x2deae7[_0x9d917c(0x1c2)][_0x9d917c(0x1e0)]||_0x2deae7[_0x9d917c(0x1d4)]['ctime'];try{if(_0x4dde75){_0x4dde75=_0x4dde75+'';if(_0x4dde75[_0x9d917c(0x1d2)]==0xa)fs['utimesSync'](_0x3f22b6,_0x4dde75,_0x4dde75);else{}}}catch(_0x37a456){}_0x241dde&&_0x241dde(_0x2deae7[_0x9d917c(0x1a9)]);if(!_0x4623ca)return _0x3fd6dd['json']({'code':0x0,'file':_0x2deae7[_0x9d917c(0x1a9)]});}});});});},module[_0x54be90(0x1b3)]=uploadUtil;