const _0x1dcc27=_0x5621;(function(_0x148303,_0x182b75){const _0x5c0dd1=_0x5621,_0x44172c=_0x148303();while(!![]){try{const _0x14a901=-parseInt(_0x5c0dd1(0x250))/0x1+parseInt(_0x5c0dd1(0x1da))/0x2+-parseInt(_0x5c0dd1(0x1de))/0x3*(parseInt(_0x5c0dd1(0x235))/0x4)+-parseInt(_0x5c0dd1(0x246))/0x5+parseInt(_0x5c0dd1(0x214))/0x6*(parseInt(_0x5c0dd1(0x23d))/0x7)+-parseInt(_0x5c0dd1(0x255))/0x8+parseInt(_0x5c0dd1(0x24c))/0x9;if(_0x14a901===_0x182b75)break;else _0x44172c['push'](_0x44172c['shift']());}catch(_0x48ab2c){_0x44172c['push'](_0x44172c['shift']());}}}(_0x4062,0x2bf92));const commonRouter=require(_0x1dcc27(0x233)),express=require(_0x1dcc27(0x20b)),app=express(),expressWs=require(_0x1dcc27(0x1ff));expressWs(app);const path=require(_0x1dcc27(0x24a)),cookieParser=require(_0x1dcc27(0x227)),dbUtil=require(_0x1dcc27(0x1f3)),dbu=new dbUtil(),netUtils=require(_0x1dcc27(0x217)),config=require(_0x1dcc27(0x225)),compression=require('compression'),dbUserTable=require('../db/dbUserTable'),cors=require('cors'),messageUtil=require(_0x1dcc27(0x237)),encryptUtil=require(_0x1dcc27(0x1f0));app[_0x1dcc27(0x208)](cors()),app['use'](compression());let i18nUtil=require('../utils/i18nUtil'),i18n=i18nUtil[_0x1dcc27(0x20d)](dbu[_0x1dcc27(0x222)]);app[_0x1dcc27(0x208)](i18n['init']),app['i18n']=i18n,app[_0x1dcc27(0x1e3)]=function(_0x57cdbb,_0x1c8dae,_0x30a05f){const _0x407452=_0x1dcc27;let _0x3e435e={'code':0x1,'message':_0x1c8dae};_0x30a05f&&(_0x3e435e[_0x407452(0x258)]=_0x30a05f);if(!_0x57cdbb[_0x407452(0x1e5)])return _0x57cdbb[_0x407452(0x22b)](_0x3e435e);},app[_0x1dcc27(0x1eb)]=dbu[_0x1dcc27(0x1eb)],app[_0x1dcc27(0x222)]=dbu[_0x1dcc27(0x222)],app[_0x1dcc27(0x22d)]=dbu[_0x1dcc27(0x22d)];const dbConfigTable=require('../db/dbConfigTable'),dbLoginTable=require(_0x1dcc27(0x1fc));let ipDetection=![];app[_0x1dcc27(0x218)]=()=>{const _0x32c22e=_0x1dcc27;let _0x51eee7=dbConfigTable['findByTitle'](dbu[_0x32c22e(0x222)],_0x32c22e(0x201));_0x51eee7&&(ipDetection=_0x51eee7[_0x32c22e(0x1ea)]=='1');},app[_0x1dcc27(0x218)]();let ipMode=_0x1dcc27(0x1ed),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0x1dcc27(0x1d3)]=()=>{const _0x42de93=_0x1dcc27;let _0x22bc50=new Date()[_0x42de93(0x23e)]();refreshIpTimestamp=_0x22bc50;let _0x574b8b=dbConfigTable[_0x42de93(0x231)](dbu[_0x42de93(0x222)],'ipMode');_0x574b8b&&(ipMode=_0x574b8b[_0x42de93(0x1ea)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x42de93(0x1ed)){let _0xb97c20=dbLoginTable['getAllIpListByWhere'](dbu['dbOther'],_0x42de93(0x22c)+_0x22bc50+')');for(let _0x187af5 in _0xb97c20){ipBlackList[_0x42de93(0x247)](_0xb97c20[_0x187af5]['ip']);}}else{if(ipMode=='white'){let _0x12ffa9=dbLoginTable[_0x42de93(0x21f)](dbu[_0x42de93(0x222)],_0x42de93(0x1ee)+_0x22bc50+')');for(let _0x5cee7d in _0x12ffa9){ipWhiteList[_0x42de93(0x247)](_0x12ffa9[_0x5cee7d]['ip']);}}}},app[_0x1dcc27(0x1d3)](),app['use'](express[_0x1dcc27(0x251)](path[_0x1dcc27(0x238)](config[_0x1dcc27(0x200)],_0x1dcc27(0x1f5)))),app[_0x1dcc27(0x208)](express[_0x1dcc27(0x251)](path['join'](config['appRootPath'],_0x1dcc27(0x226)))),app[_0x1dcc27(0x208)](express['static'](path[_0x1dcc27(0x238)](config[_0x1dcc27(0x200)],'public_viewer'))),app['use'](express[_0x1dcc27(0x251)](path[_0x1dcc27(0x238)](config[_0x1dcc27(0x200)],_0x1dcc27(0x1df)))),app[_0x1dcc27(0x208)](express[_0x1dcc27(0x251)](path[_0x1dcc27(0x238)](config[_0x1dcc27(0x200)],'public_book')));var bodyParser=require(_0x1dcc27(0x1d4));app['use'](bodyParser[_0x1dcc27(0x22b)]({'limit':_0x1dcc27(0x1e4)})),app[_0x1dcc27(0x208)](bodyParser[_0x1dcc27(0x1d8)]({'limit':_0x1dcc27(0x1e4),'extended':!![]})),app[_0x1dcc27(0x208)](express['json']()),app[_0x1dcc27(0x208)](express['urlencoded']({'extended':![]})),app[_0x1dcc27(0x208)](cookieParser());const noCheckPathArr=[_0x1dcc27(0x1dc),_0x1dcc27(0x1d5),_0x1dcc27(0x213),_0x1dcc27(0x259),_0x1dcc27(0x22a),_0x1dcc27(0x1fa),'/api/usersApi/registAdmin',_0x1dcc27(0x1e7),_0x1dcc27(0x243),'/api/usersApi/login',_0x1dcc27(0x212),_0x1dcc27(0x249),_0x1dcc27(0x1f6),_0x1dcc27(0x22f),_0x1dcc27(0x1e6)];let lastUpdateLastLoginTime={};app['use'](function(_0x3f8404,_0x5e46e6,_0x5d88fd){const _0x3181f4=_0x1dcc27;if(_0x3f8404[_0x3181f4(0x24a)]==_0x3181f4(0x207))return _0x5e46e6[_0x3181f4(0x22b)]({'code':0x0});let _0x3da23d=new Date()[_0x3181f4(0x23e)](),_0x2da00f=netUtils[_0x3181f4(0x20c)](_0x3f8404);if(_0x2da00f!=_0x3181f4(0x206)&&_0x2da00f!='127.0.0.1'){_0x3da23d-refreshIpGap>refreshIpTimestamp&&app['refreshIpList']();if(ipMode==_0x3181f4(0x1ed)){if(ipBlackList['includes'](_0x2da00f))return app[_0x3181f4(0x1e3)](_0x5e46e6,_0x5e46e6['__'](_0x3181f4(0x244))+_0x5e46e6['__'](_0x3181f4(0x1d6)));}else{if(ipMode==_0x3181f4(0x24f)){if(!ipWhiteList[_0x3181f4(0x219)](_0x2da00f))return app[_0x3181f4(0x1e3)](_0x5e46e6,_0x5e46e6['__'](_0x3181f4(0x244))+_0x5e46e6['__'](_0x3181f4(0x1d6)));}}}encryptUtil['decryptParams'](_0x3f8404),_0x3f8404['setLocale'](i18n['getLocale']()),_0x5e46e6[_0x3181f4(0x24e)][_0x3181f4(0x239)]=i18n[_0x3181f4(0x1e8)]();let _0x583127=_0x3f8404['query'][_0x3181f4(0x23a)]||_0x3f8404[_0x3181f4(0x21e)]['st'];if(_0x583127&&(_0x3f8404[_0x3181f4(0x24a)]['startsWith'](_0x3181f4(0x1f7))||_0x3f8404[_0x3181f4(0x24a)][_0x3181f4(0x229)](_0x3181f4(0x253))||_0x3f8404['path'][_0x3181f4(0x229)](_0x3181f4(0x252))||_0x3f8404[_0x3181f4(0x24a)][_0x3181f4(0x229)](_0x3181f4(0x257))))try{let _0x4924b1=_0x3f8404[_0x3181f4(0x21e)][_0x3181f4(0x228)]||_0x3f8404[_0x3181f4(0x21e)]['sp'];_0x4924b1&&(_0x3f8404[_0x3181f4(0x21e)]['sp']=Buffer[_0x3181f4(0x234)](_0x4924b1,_0x3181f4(0x1f2))['toString']());let _0x11c74a=_0x3f8404['app'][_0x3181f4(0x222)][_0x3181f4(0x1db)](_0x3181f4(0x21d))[_0x3181f4(0x202)](_0x583127,new Date()[_0x3181f4(0x23e)]());if(!_0x11c74a)return _0x5e46e6[_0x3181f4(0x20a)](0x194)[_0x3181f4(0x224)]();if(_0x11c74a[_0x3181f4(0x1e0)]&&_0x11c74a[_0x3181f4(0x1e0)]!=_0x3f8404[_0x3181f4(0x21e)]['sp'])return _0x5e46e6['status'](0x194)[_0x3181f4(0x224)]();return _0x3f8404[_0x3181f4(0x209)]=!![],_0x5d88fd();}catch(_0x45db26){return _0x5e46e6[_0x3181f4(0x20a)](0x194)['end']();}if(noCheckPathArr[_0x3181f4(0x205)](_0x3f8404['path'])==-0x1){let _0x38f000=_0x3f8404['headers'][_0x3181f4(0x1d9)]||_0x3f8404[_0x3181f4(0x21e)][_0x3181f4(0x1d9)]||_0x3f8404['body']['token'],_0x38afaa=dbUserTable[_0x3181f4(0x1f4)](_0x3f8404[_0x3181f4(0x21a)][_0x3181f4(0x222)],_0x38f000),_0x4a3c42=!![];ipDetection&&_0x38afaa&&_0x2da00f!=_0x38afaa[_0x3181f4(0x20e)]&&_0x2da00f!=_0x3181f4(0x206)&&!_0x2da00f[_0x3181f4(0x229)](_0x3181f4(0x221))&&!_0x2da00f[_0x3181f4(0x229)](_0x3181f4(0x216))&&!_0x2da00f[_0x3181f4(0x229)]('172.')&&(_0x4a3c42=![]);if(!_0x38afaa||!_0x4a3c42)return _0x5e46e6[_0x3181f4(0x22b)]({'code':0x65,'message':i18n['__']('TokenExpired')});let _0x17d1b6=new Date()[_0x3181f4(0x23e)](),_0x4e16f5=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x38afaa['id']]||_0x17d1b6-lastUpdateLastLoginTime[_0x38afaa['id']]>_0x4e16f5)&&(dbUserTable[_0x3181f4(0x254)](_0x3f8404['app'][_0x3181f4(0x222)],_0x38f000,_0x17d1b6),lastUpdateLastLoginTime[_0x38afaa['id']]=_0x17d1b6),_0x3f8404[_0x3181f4(0x241)]=_0x38afaa,_0x5d88fd();}else _0x5d88fd();});let mapRouter=require(_0x1dcc27(0x240));app[_0x1dcc27(0x208)](_0x1dcc27(0x232),mapRouter);let uploadRouter=require(_0x1dcc27(0x1e1));app['use'](_0x1dcc27(0x1e2),uploadRouter);let transCodeRouter=require('./routes/transCodeApi');app[_0x1dcc27(0x208)]('/api/transCode',transCodeRouter);let pathFileRouter=require(_0x1dcc27(0x236));app[_0x1dcc27(0x208)](_0x1dcc27(0x245),pathFileRouter);let fileRecordApi=require(_0x1dcc27(0x23c));app['use'](_0x1dcc27(0x256),fileRecordApi);let fileRouter=require(_0x1dcc27(0x248));app[_0x1dcc27(0x208)](_0x1dcc27(0x23b),fileRouter);function _0x4062(){const _0x268530=['/api/file','638095BQxyBf','push','./routes/fileApi','/api/usersApi/checkIsNasServer','path','./routes/backupApi','3868974bozrbT','/api/zipFileApi','locals','white','101962QUXugF','static','/api/file/rawFile/','/api/fileApi/rawFileByPath/','updateLastLoginTimeByToken','1330208ffxiuT','/api/fileRecordApi','/api/file/zipFile/','alertType','/api/usersApi/resetPwd','refreshIpList','body-parser','/api/mapApi/getZoom','login.cannotLogin','log','urlencoded','token','84426HdtQEL','prepare','/api/mapApi/tile','/api/movieApi','64863AnLAcq','public_music','password','./routes/uploadApi','/api/uploadApi','returnErrMsg','100gb','headersSent','/api/commonApi/getServerIpAndSign','/api/file/getTempShareFiles','getLocale','./routes/addGpsApi','value','dbFileIndex','/api/sourceFolderApi','black','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','/api/backupApi','./utils/encryptUtil','./routes/sourceFolderApi','base64','../db/dbUtil','getUserByToken','public','/api/commonApi/getLanguage','/api/fileApi/tinyImgByPath/','/api/bookApi','./routes/downloadApi','/api/usersApi/hasAdmin','/api/musicApi','../db/dbLoginTable','/api/usersApi','/api/privateSpaceApi','express-ws','appRootPath','ipDetection','get','./routes/bookApi','./routes/zipFileApi','indexOf','localhost','/api/healthCheck','use','isTempShare','status','express','getClientIp','getI18n','token_ip','./routes/ordinaryAlbumApi','message','./routes/movieInfoApi','/api/usersApi/tokenLogin','/api/mapApi/getLocationStr','6oaGAww','/api/fileShareApi','10.','./utils/netUtils','refreshIpDetection','includes','app','./routes/messageApi','/api/ordinaryAlbumApi','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','query','getAllIpListByWhere','/api/addGpsApi','192.','dbOther','/api/commonApi','end','../myConfig/config','public_pdf','cookie-parser','sharePwd','startsWith','/api/usersApi/resetPwdInfo','json','\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','dbCity','/api/downloadApi','/api/commonApi/setLanguage','./routes/privateSpace','findByTitle','/api/mapApi','./routes/commonApi','from','8CkksnA','./routes/file','../utils/messageUtil','join','language','shareToken','/api/fileApi','./routes/fileRecordApi','1029798FDEBMd','getTime','/api/messageApi','./routes/mapApi','currentUser','@tensorflow/tfjs','/api/file/customImageFile','security.ipNotInAllowList'];_0x4062=function(){return _0x268530;};return _0x4062();}let zipFileRouter=require(_0x1dcc27(0x204));app['use'](_0x1dcc27(0x24d),zipFileRouter),app[_0x1dcc27(0x208)](_0x1dcc27(0x223),commonRouter);let usersRouter=require('./routes/usersApi');app['use'](_0x1dcc27(0x1fd),usersRouter);function _0x5621(_0x2552f5,_0x22639f){const _0x4062c1=_0x4062();return _0x5621=function(_0x562168,_0x42ceea){_0x562168=_0x562168-0x1d3;let _0x1dd21d=_0x4062c1[_0x562168];return _0x1dd21d;},_0x5621(_0x2552f5,_0x22639f);}let sourceFolderRouter=require(_0x1dcc27(0x1f1));app[_0x1dcc27(0x208)](_0x1dcc27(0x1ec),sourceFolderRouter);let ordinaryRouter=require(_0x1dcc27(0x20f));app['use'](_0x1dcc27(0x21c),ordinaryRouter);let photoRouter=require('./routes/photoApi');app[_0x1dcc27(0x208)]('/api/photoApi',photoRouter);let addGpsRouter=require(_0x1dcc27(0x1e9));app['use'](_0x1dcc27(0x220),addGpsRouter);let messageRouter=require(_0x1dcc27(0x21b));app[_0x1dcc27(0x208)](_0x1dcc27(0x23f),messageRouter);let movieRouter=require('./routes/movieApi');app[_0x1dcc27(0x208)](_0x1dcc27(0x1dd),movieRouter);let movieInfoRouter=require(_0x1dcc27(0x211));app[_0x1dcc27(0x208)]('/api/movieInfoApi',movieInfoRouter);let musicRouter=require('./routes/musicApi');app[_0x1dcc27(0x208)](_0x1dcc27(0x1fb),musicRouter);let bookRouter=require(_0x1dcc27(0x203));app[_0x1dcc27(0x208)](_0x1dcc27(0x1f8),bookRouter);let backupRouter=require(_0x1dcc27(0x24b));app[_0x1dcc27(0x208)](_0x1dcc27(0x1ef),backupRouter);let fileShareRouter=require('./routes/fileShareApi');app[_0x1dcc27(0x208)](_0x1dcc27(0x215),fileShareRouter);let nasAccountRouter=require('./routes/nasAccountApi');app[_0x1dcc27(0x208)]('/api/nasAccountApi',nasAccountRouter);let privateSpaceRouter=require(_0x1dcc27(0x230));const {data}=require(_0x1dcc27(0x242));app[_0x1dcc27(0x208)](_0x1dcc27(0x1fe),privateSpaceRouter);let downloadRouter=require(_0x1dcc27(0x1f9));app[_0x1dcc27(0x208)](_0x1dcc27(0x22e),downloadRouter),app['use'](function(_0xed65ad,_0xa6e961,_0x3a553a){const _0x42e7ac=_0x1dcc27;_0xa6e961['status'](0x194)[_0x42e7ac(0x224)];}),app[_0x1dcc27(0x208)](function(_0x4679f3,_0x31d4fe,_0x3163dc,_0x72ada){const _0xea135d=_0x1dcc27;_0x3163dc[_0xea135d(0x24e)][_0xea135d(0x210)]=_0x4679f3[_0xea135d(0x210)],console[_0xea135d(0x1d7)](_0x4679f3),_0x3163dc[_0xea135d(0x20a)](_0x4679f3[_0xea135d(0x20a)]||0x1f4)[_0xea135d(0x224)]();}),module['exports']=app;