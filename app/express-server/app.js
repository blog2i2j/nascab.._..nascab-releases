const _0x2fd0fd=_0x33b8;(function(_0x4b9cb8,_0x50c408){const _0x3ee330=_0x33b8,_0x37f29b=_0x4b9cb8();while(!![]){try{const _0x9aaa32=-parseInt(_0x3ee330(0x189))/0x1*(-parseInt(_0x3ee330(0x160))/0x2)+parseInt(_0x3ee330(0x130))/0x3*(-parseInt(_0x3ee330(0x13d))/0x4)+-parseInt(_0x3ee330(0x184))/0x5*(-parseInt(_0x3ee330(0x180))/0x6)+-parseInt(_0x3ee330(0x15a))/0x7+-parseInt(_0x3ee330(0x19e))/0x8*(parseInt(_0x3ee330(0x142))/0x9)+-parseInt(_0x3ee330(0x13a))/0xa*(parseInt(_0x3ee330(0x188))/0xb)+parseInt(_0x3ee330(0x131))/0xc*(parseInt(_0x3ee330(0x191))/0xd);if(_0x9aaa32===_0x50c408)break;else _0x37f29b['push'](_0x37f29b['shift']());}catch(_0x3193d2){_0x37f29b['push'](_0x37f29b['shift']());}}}(_0x5afc,0x3d7e0));const commonRouter=require(_0x2fd0fd(0x13f)),express=require(_0x2fd0fd(0x14b)),app=express(),expressWs=require('express-ws');expressWs(app);const path=require(_0x2fd0fd(0x150)),cookieParser=require(_0x2fd0fd(0x17d)),dbUtil=require('../db/dbUtil'),dbu=new dbUtil(),netUtils=require(_0x2fd0fd(0x1b0)),config=require('../myConfig/config'),compression=require(_0x2fd0fd(0x18e)),dbUserTable=require(_0x2fd0fd(0x1af)),cors=require(_0x2fd0fd(0x14d)),messageUtil=require(_0x2fd0fd(0x135)),encryptUtil=require('./utils/encryptUtil');app[_0x2fd0fd(0x147)](cors()),app['use'](compression());let i18nUtil=require(_0x2fd0fd(0x159)),i18n=i18nUtil['getI18n'](dbu['dbOther']);app[_0x2fd0fd(0x147)](i18n['init']),app['i18n']=i18n,app[_0x2fd0fd(0x1a6)]=function(_0x4f50fe,_0x54ee0e,_0x36c650){const _0x1c67a9=_0x2fd0fd;let _0x1afdd0={'code':0x1,'message':_0x54ee0e};_0x36c650&&(_0x1afdd0[_0x1c67a9(0x15f)]=_0x36c650);if(!_0x4f50fe[_0x1c67a9(0x14f)])return _0x4f50fe['json'](_0x1afdd0);},app[_0x2fd0fd(0x139)]=dbu[_0x2fd0fd(0x139)],app[_0x2fd0fd(0x171)]=dbu[_0x2fd0fd(0x171)],app[_0x2fd0fd(0x1a5)]=dbu[_0x2fd0fd(0x1a5)];const dbConfigTable=require(_0x2fd0fd(0x175)),dbLoginTable=require(_0x2fd0fd(0x137));let ipDetection=![];app[_0x2fd0fd(0x154)]=()=>{const _0x198d10=_0x2fd0fd;let _0x660ce1=dbConfigTable[_0x198d10(0x145)](dbu[_0x198d10(0x171)],_0x198d10(0x1a0));_0x660ce1&&(ipDetection=_0x660ce1['value']=='1');},app[_0x2fd0fd(0x154)]();let ipMode='black',ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0x2fd0fd(0x1b9)]=()=>{const _0x4781b6=_0x2fd0fd;let _0x261faf=new Date()['getTime']();refreshIpTimestamp=_0x261faf;let _0x311811=dbConfigTable[_0x4781b6(0x145)](dbu[_0x4781b6(0x171)],_0x4781b6(0x132));_0x311811&&(ipMode=_0x311811['value']);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x4781b6(0x174)){let _0x377f93=dbLoginTable['getAllIpListByWhere'](dbu['dbOther'],'\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>'+_0x261faf+')');for(let _0x28ff1a in _0x377f93){ipBlackList['push'](_0x377f93[_0x28ff1a]['ip']);}}else{if(ipMode==_0x4781b6(0x19b)){let _0x1c9e64=dbLoginTable[_0x4781b6(0x1ac)](dbu['dbOther'],_0x4781b6(0x1b8)+_0x261faf+')');for(let _0x5d9ac4 in _0x1c9e64){ipWhiteList[_0x4781b6(0x1b7)](_0x1c9e64[_0x5d9ac4]['ip']);}}}},app[_0x2fd0fd(0x1b9)](),app[_0x2fd0fd(0x147)](express[_0x2fd0fd(0x13b)](path[_0x2fd0fd(0x143)](config[_0x2fd0fd(0x162)],_0x2fd0fd(0x178)))),app[_0x2fd0fd(0x147)](express['static'](path['join'](config['appRootPath'],'public_pdf'))),app['use'](express[_0x2fd0fd(0x13b)](path[_0x2fd0fd(0x143)](config[_0x2fd0fd(0x162)],'public_viewer'))),app['use'](express[_0x2fd0fd(0x13b)](path['join'](config[_0x2fd0fd(0x162)],'public_music'))),app['use'](express[_0x2fd0fd(0x13b)](path[_0x2fd0fd(0x143)](config['appRootPath'],_0x2fd0fd(0x16e))));var bodyParser=require(_0x2fd0fd(0x169));app['use'](bodyParser['json']({'limit':'100gb'})),app[_0x2fd0fd(0x147)](bodyParser[_0x2fd0fd(0x155)]({'limit':'100gb','extended':!![]})),app[_0x2fd0fd(0x147)](express['json']()),app[_0x2fd0fd(0x147)](express[_0x2fd0fd(0x155)]({'extended':![]})),app[_0x2fd0fd(0x147)](cookieParser());const noCheckPathArr=['/api/mapApi/tile',_0x2fd0fd(0x18c),'/api/mapApi/getLocationStr',_0x2fd0fd(0x190),_0x2fd0fd(0x15d),'/api/usersApi/hasAdmin',_0x2fd0fd(0x195),_0x2fd0fd(0x1a1),_0x2fd0fd(0x151),_0x2fd0fd(0x17c),_0x2fd0fd(0x179),_0x2fd0fd(0x1aa),_0x2fd0fd(0x196),_0x2fd0fd(0x177),_0x2fd0fd(0x165)];let lastUpdateLastLoginTime={};app[_0x2fd0fd(0x147)](function(_0xc91669,_0x5e99d9,_0x3f199c){const _0x27671f=_0x2fd0fd;if(_0xc91669['path']==_0x27671f(0x1a9))return _0x5e99d9['json']({'code':0x0});let _0x587e24=new Date()[_0x27671f(0x12f)](),_0x4c68bf=netUtils[_0x27671f(0x19d)](_0xc91669);if(_0x4c68bf!=_0x27671f(0x14e)&&_0x4c68bf!=_0x27671f(0x1ab)){_0x587e24-refreshIpGap>refreshIpTimestamp&&app[_0x27671f(0x1b9)]();if(ipMode=='black'){if(ipBlackList[_0x27671f(0x144)](_0x4c68bf))return app['returnErrMsg'](_0x5e99d9,_0x5e99d9['__']('security.ipNotInAllowList')+_0x5e99d9['__']('login.cannotLogin'));}else{if(ipMode==_0x27671f(0x19b)){if(!ipWhiteList[_0x27671f(0x144)](_0x4c68bf))return app[_0x27671f(0x1a6)](_0x5e99d9,_0x5e99d9['__'](_0x27671f(0x187))+_0x5e99d9['__'](_0x27671f(0x1a3)));}}}encryptUtil[_0x27671f(0x16f)](_0xc91669),_0xc91669[_0x27671f(0x1b5)](i18n[_0x27671f(0x18a)]()),_0x5e99d9[_0x27671f(0x164)][_0x27671f(0x140)]=i18n['getLocale']();let _0x597911=_0xc91669[_0x27671f(0x148)][_0x27671f(0x19f)]||_0xc91669[_0x27671f(0x148)]['st'];if(_0x597911&&(_0xc91669[_0x27671f(0x150)][_0x27671f(0x136)](_0x27671f(0x17b))||_0xc91669[_0x27671f(0x150)][_0x27671f(0x136)](_0x27671f(0x138))||_0xc91669[_0x27671f(0x150)][_0x27671f(0x136)](_0x27671f(0x16a))||_0xc91669['path']['startsWith']('/api/file/zipFile/')))try{let _0x2891ea=_0xc91669['query']['sharePwd']||_0xc91669['query']['sp'];_0x2891ea&&(_0xc91669['query']['sp']=Buffer[_0x27671f(0x133)](_0x2891ea,'base64')[_0x27671f(0x186)]());let _0xc56f90=_0xc91669[_0x27671f(0x185)][_0x27671f(0x171)]['prepare'](_0x27671f(0x166))[_0x27671f(0x192)](_0x597911,new Date()[_0x27671f(0x12f)]());if(!_0xc56f90)return _0x5e99d9[_0x27671f(0x170)](0x194)[_0x27671f(0x141)]();if(_0xc56f90['password']&&_0xc56f90[_0x27671f(0x1b3)]!=_0xc91669[_0x27671f(0x148)]['sp'])return _0x5e99d9[_0x27671f(0x170)](0x194)[_0x27671f(0x141)]();return _0xc91669[_0x27671f(0x1ae)]=!![],_0x3f199c();}catch(_0x2487b3){return _0x5e99d9[_0x27671f(0x170)](0x194)[_0x27671f(0x141)]();}if(noCheckPathArr[_0x27671f(0x1a7)](_0xc91669['path'])==-0x1){let _0x51f7b8=_0xc91669[_0x27671f(0x146)][_0x27671f(0x1a8)]||_0xc91669[_0x27671f(0x148)][_0x27671f(0x1a8)]||_0xc91669[_0x27671f(0x13c)]['token'],_0x228db8=dbUserTable[_0x27671f(0x19c)](_0xc91669['app'][_0x27671f(0x171)],_0x51f7b8),_0x5883a4=!![];ipDetection&&_0x228db8&&_0x4c68bf!=_0x228db8[_0x27671f(0x16c)]&&_0x4c68bf!=_0x27671f(0x14e)&&!_0x4c68bf[_0x27671f(0x136)](_0x27671f(0x13e))&&!_0x4c68bf[_0x27671f(0x136)](_0x27671f(0x1b4))&&!_0x4c68bf[_0x27671f(0x136)](_0x27671f(0x182))&&(_0x5883a4=![]);if(!_0x228db8||!_0x5883a4)return _0x5e99d9['json']({'code':0x65,'message':i18n['__'](_0x27671f(0x19a))});let _0x1e0247=new Date()[_0x27671f(0x12f)](),_0x25ccbd=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x228db8['id']]||_0x1e0247-lastUpdateLastLoginTime[_0x228db8['id']]>_0x25ccbd)&&(dbUserTable['updateLastLoginTimeByToken'](_0xc91669[_0x27671f(0x185)][_0x27671f(0x171)],_0x51f7b8,_0x1e0247),lastUpdateLastLoginTime[_0x228db8['id']]=_0x1e0247),_0xc91669[_0x27671f(0x1b2)]=_0x228db8,_0x3f199c();}else _0x3f199c();});let mapRouter=require(_0x2fd0fd(0x18f));app['use'](_0x2fd0fd(0x198),mapRouter);let uploadRouter=require(_0x2fd0fd(0x163));app['use'](_0x2fd0fd(0x172),uploadRouter);let transCodeRouter=require(_0x2fd0fd(0x15b));function _0x5afc(){const _0x4c70d9=['headersSent','path','/api/file/customImageFile','./routes/movieApi','./routes/file','refreshIpDetection','urlencoded','./routes/downloadApi','./routes/fileShareApi','./routes/fileApi','../utils/i18nUtil','2572892zwOHgb','./routes/transCodeApi','/api/commonApi','/api/usersApi/resetPwdInfo','/api/fileApi','alertType','2sbrLWW','/api/movieInfoApi','appRootPath','./routes/uploadApi','locals','/api/commonApi/getServerIpAndSign','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','./routes/sourceFolderApi','exports','body-parser','/api/file/rawFile/','/api/downloadApi','token_ip','./routes/addGpsApi','public_book','decryptParams','status','dbOther','/api/uploadApi','./routes/fileRecordApi','black','../db/dbConfigTable','/api/fileRecordApi','/api/commonApi/setLanguage','public','/api/usersApi/tokenLogin','/api/nasAccountApi','/api/fileApi/tinyImgByPath/','/api/usersApi/login','cookie-parser','/api/usersApi','/api/bookApi','36jaujbv','/api/messageApi','172.','/api/zipFileApi','146205JdGJdf','app','toString','security.ipNotInAllowList','22319TKeUzO','315613RGZUgA','getLocale','./routes/photoApi','/api/mapApi/getZoom','log','compression','./routes/mapApi','/api/usersApi/resetPwd','26WmZsZo','get','./routes/nasAccountApi','message','/api/usersApi/registAdmin','/api/commonApi/getLanguage','/api/movieApi','/api/mapApi','./routes/zipFileApi','TokenExpired','white','getUserByToken','getClientIp','8AGaCpF','shareToken','ipDetection','/api/file/getTempShareFiles','/api/photoApi','login.cannotLogin','/api/privateSpaceApi','dbCity','returnErrMsg','indexOf','token','/api/healthCheck','/api/usersApi/checkIsNasServer','127.0.0.1','getAllIpListByWhere','./routes/bookApi','isTempShare','../db/dbUserTable','./utils/netUtils','./routes/messageApi','currentUser','password','10.','setLocale','./routes/movieInfoApi','push','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','refreshIpList','getTime','3sYUsBf','5694324jOjluw','ipMode','from','/api/transCode','../utils/messageUtil','startsWith','../db/dbLoginTable','/api/fileApi/rawFileByPath/','dbFileIndex','1070xXOdjE','static','body','743804JILPeS','192.','./routes/commonApi','language','end','3758679bZmjzH','join','includes','findByTitle','headers','use','query','/api/addGpsApi','./routes/musicApi','express','/api/backupApi','cors','localhost'];_0x5afc=function(){return _0x4c70d9;};return _0x5afc();}app[_0x2fd0fd(0x147)](_0x2fd0fd(0x134),transCodeRouter);let pathFileRouter=require(_0x2fd0fd(0x153));app[_0x2fd0fd(0x147)]('/api/file',pathFileRouter);let fileRecordApi=require(_0x2fd0fd(0x173));function _0x33b8(_0x29f1af,_0x22bf2d){const _0x5afc31=_0x5afc();return _0x33b8=function(_0x33b870,_0x42f3ab){_0x33b870=_0x33b870-0x12f;let _0x454429=_0x5afc31[_0x33b870];return _0x454429;},_0x33b8(_0x29f1af,_0x22bf2d);}app[_0x2fd0fd(0x147)](_0x2fd0fd(0x176),fileRecordApi);let fileRouter=require(_0x2fd0fd(0x158));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x15e),fileRouter);let zipFileRouter=require(_0x2fd0fd(0x199));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x183),zipFileRouter),app[_0x2fd0fd(0x147)](_0x2fd0fd(0x15c),commonRouter);let usersRouter=require('./routes/usersApi');app[_0x2fd0fd(0x147)](_0x2fd0fd(0x17e),usersRouter);let sourceFolderRouter=require(_0x2fd0fd(0x167));app[_0x2fd0fd(0x147)]('/api/sourceFolderApi',sourceFolderRouter);let ordinaryRouter=require('./routes/ordinaryAlbumApi');app[_0x2fd0fd(0x147)]('/api/ordinaryAlbumApi',ordinaryRouter);let photoRouter=require(_0x2fd0fd(0x18b));app['use'](_0x2fd0fd(0x1a2),photoRouter);let addGpsRouter=require(_0x2fd0fd(0x16d));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x149),addGpsRouter);let messageRouter=require(_0x2fd0fd(0x1b1));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x181),messageRouter);let movieRouter=require(_0x2fd0fd(0x152));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x197),movieRouter);let movieInfoRouter=require(_0x2fd0fd(0x1b6));app['use'](_0x2fd0fd(0x161),movieInfoRouter);let musicRouter=require(_0x2fd0fd(0x14a));app[_0x2fd0fd(0x147)]('/api/musicApi',musicRouter);let bookRouter=require(_0x2fd0fd(0x1ad));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x17f),bookRouter);let backupRouter=require('./routes/backupApi');app[_0x2fd0fd(0x147)](_0x2fd0fd(0x14c),backupRouter);let fileShareRouter=require(_0x2fd0fd(0x157));app[_0x2fd0fd(0x147)]('/api/fileShareApi',fileShareRouter);let nasAccountRouter=require(_0x2fd0fd(0x193));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x17a),nasAccountRouter);let privateSpaceRouter=require('./routes/privateSpace');const {data}=require('@tensorflow/tfjs');app['use'](_0x2fd0fd(0x1a4),privateSpaceRouter);let downloadRouter=require(_0x2fd0fd(0x156));app[_0x2fd0fd(0x147)](_0x2fd0fd(0x16b),downloadRouter),app[_0x2fd0fd(0x147)](function(_0x225062,_0x4500bf,_0x2a6bdb){const _0x44417f=_0x2fd0fd;_0x4500bf[_0x44417f(0x170)](0x194)[_0x44417f(0x141)];}),app[_0x2fd0fd(0x147)](function(_0x752cc6,_0x3248e6,_0x1d1a4d,_0x3bd536){const _0x2ede70=_0x2fd0fd;_0x1d1a4d[_0x2ede70(0x164)][_0x2ede70(0x194)]=_0x752cc6[_0x2ede70(0x194)],console[_0x2ede70(0x18d)](_0x752cc6),_0x1d1a4d[_0x2ede70(0x170)](_0x752cc6[_0x2ede70(0x170)]||0x1f4)[_0x2ede70(0x141)]();}),module[_0x2fd0fd(0x168)]=app;