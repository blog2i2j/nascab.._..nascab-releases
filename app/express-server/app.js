const _0x2a857d=_0x2bc5;(function(_0x4604b5,_0x5cb82a){const _0x1801da=_0x2bc5,_0xfe4943=_0x4604b5();while(!![]){try{const _0x2fcbf7=parseInt(_0x1801da(0x17c))/0x1+parseInt(_0x1801da(0x164))/0x2+-parseInt(_0x1801da(0x1cb))/0x3+-parseInt(_0x1801da(0x156))/0x4+parseInt(_0x1801da(0x149))/0x5+parseInt(_0x1801da(0x14e))/0x6+parseInt(_0x1801da(0x1cc))/0x7*(-parseInt(_0x1801da(0x18b))/0x8);if(_0x2fcbf7===_0x5cb82a)break;else _0xfe4943['push'](_0xfe4943['shift']());}catch(_0xebcd8d){_0xfe4943['push'](_0xfe4943['shift']());}}}(_0x1f35,0xe8ea5));const commonRouter=require(_0x2a857d(0x1b8)),express=require('express'),app=express(),expressWs=require(_0x2a857d(0x1a3));expressWs(app);const path=require(_0x2a857d(0x195)),cookieParser=require(_0x2a857d(0x192)),dbUtil=require(_0x2a857d(0x189)),dbu=new dbUtil(),netUtils=require(_0x2a857d(0x165)),config=require('../myConfig/config'),compression=require('compression'),dbUserTable=require(_0x2a857d(0x1ba)),cors=require(_0x2a857d(0x1af)),messageUtil=require(_0x2a857d(0x1bd)),encryptUtil=require(_0x2a857d(0x172));app[_0x2a857d(0x19d)](cors()),app['use'](compression());let i18nUtil=require(_0x2a857d(0x179)),i18n=i18nUtil['getI18n'](dbu[_0x2a857d(0x178)]);app[_0x2a857d(0x19d)](i18n[_0x2a857d(0x167)]),app[_0x2a857d(0x17e)]=i18n,app[_0x2a857d(0x1a5)]=function(_0x4cebbb,_0x32eab0,_0x186a44){const _0x5df692=_0x2a857d;let _0x4d1308={'code':0x1,'message':_0x32eab0};_0x186a44&&(_0x4d1308['alertType']=_0x186a44);if(!_0x4cebbb[_0x5df692(0x1b9)])return _0x4cebbb['json'](_0x4d1308);},app['dbFileIndex']=dbu[_0x2a857d(0x1c8)],app[_0x2a857d(0x178)]=dbu[_0x2a857d(0x178)],app[_0x2a857d(0x197)]=dbu['dbCity'];const dbConfigTable=require(_0x2a857d(0x1cd)),dbLoginTable=require(_0x2a857d(0x19c));let ipDetection=![];app[_0x2a857d(0x1ad)]=()=>{const _0x545335=_0x2a857d;let _0xa62d53=dbConfigTable['findByTitle'](dbu[_0x545335(0x178)],_0x545335(0x194));_0xa62d53&&(ipDetection=_0xa62d53[_0x545335(0x191)]=='1');},app['refreshIpDetection']();let ipMode=_0x2a857d(0x198),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0x2a857d(0x15a)]=()=>{const _0x7077b=_0x2a857d;let _0x5c43fd=new Date()[_0x7077b(0x1c4)]();refreshIpTimestamp=_0x5c43fd;let _0x572738=dbConfigTable[_0x7077b(0x19b)](dbu['dbOther'],_0x7077b(0x1d1));_0x572738&&(ipMode=_0x572738[_0x7077b(0x191)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x7077b(0x198)){let _0x588052=dbLoginTable['getAllIpListByWhere'](dbu[_0x7077b(0x178)],_0x7077b(0x15c)+_0x5c43fd+')');for(let _0x2a1500 in _0x588052){ipBlackList['push'](_0x588052[_0x2a1500]['ip']);}}else{if(ipMode==_0x7077b(0x1b4)){let _0x848713=dbLoginTable[_0x7077b(0x1a0)](dbu[_0x7077b(0x178)],_0x7077b(0x14b)+_0x5c43fd+')');for(let _0x5d3e24 in _0x848713){ipWhiteList[_0x7077b(0x16f)](_0x848713[_0x5d3e24]['ip']);}}}},app['refreshIpList'](),app['use'](express[_0x2a857d(0x1aa)](path[_0x2a857d(0x1a2)](config['appRootPath'],_0x2a857d(0x1b0)))),app[_0x2a857d(0x19d)](express[_0x2a857d(0x1aa)](path['join'](config[_0x2a857d(0x1ae)],_0x2a857d(0x181)))),app[_0x2a857d(0x19d)](express[_0x2a857d(0x1aa)](path[_0x2a857d(0x1a2)](config['appRootPath'],_0x2a857d(0x196)))),app[_0x2a857d(0x19d)](express['static'](path[_0x2a857d(0x1a2)](config['appRootPath'],_0x2a857d(0x170)))),app[_0x2a857d(0x19d)](express[_0x2a857d(0x1aa)](path[_0x2a857d(0x1a2)](config[_0x2a857d(0x1ae)],_0x2a857d(0x173))));var bodyParser=require('body-parser');app[_0x2a857d(0x19d)](bodyParser[_0x2a857d(0x154)]({'limit':_0x2a857d(0x182)})),app[_0x2a857d(0x19d)](bodyParser[_0x2a857d(0x1b7)]({'limit':_0x2a857d(0x182),'extended':!![]})),app[_0x2a857d(0x19d)](express[_0x2a857d(0x154)]()),app[_0x2a857d(0x19d)](express['urlencoded']({'extended':![]})),app[_0x2a857d(0x19d)](cookieParser());const noCheckPathArr=['/api/mapApi/tile',_0x2a857d(0x16c),_0x2a857d(0x1cf),_0x2a857d(0x1a6),_0x2a857d(0x15f),'/api/usersApi/hasAdmin',_0x2a857d(0x152),_0x2a857d(0x1b6),_0x2a857d(0x1c6),_0x2a857d(0x16e),_0x2a857d(0x1a8),_0x2a857d(0x168),_0x2a857d(0x1b5),_0x2a857d(0x155),_0x2a857d(0x185)];let lastUpdateLastLoginTime={};app[_0x2a857d(0x19d)](function(_0x420f3c,_0x1c6c30,_0x556cd1){const _0x589369=_0x2a857d;if(_0x420f3c['path']==_0x589369(0x14d))return _0x1c6c30['json']({'code':0x0});let _0x490c91=new Date()['getTime'](),_0x1658dc=netUtils['getClientIp'](_0x420f3c);if(_0x1658dc!='localhost'&&_0x1658dc!=_0x589369(0x199)){_0x490c91-refreshIpGap>refreshIpTimestamp&&app[_0x589369(0x15a)]();if(ipMode==_0x589369(0x198)){if(ipBlackList['includes'](_0x1658dc))return app[_0x589369(0x1a5)](_0x1c6c30,_0x1c6c30['__'](_0x589369(0x1c2))+_0x1c6c30['__'](_0x589369(0x18a)));}else{if(ipMode==_0x589369(0x1b4)){if(!ipWhiteList['includes'](_0x1658dc))return app['returnErrMsg'](_0x1c6c30,_0x1c6c30['__'](_0x589369(0x1c2))+_0x1c6c30['__'](_0x589369(0x18a)));}}}encryptUtil[_0x589369(0x1c0)](_0x420f3c),_0x420f3c[_0x589369(0x1c3)](i18n[_0x589369(0x157)]()),_0x1c6c30[_0x589369(0x180)][_0x589369(0x186)]=i18n['getLocale']();let _0x455aa6=_0x420f3c[_0x589369(0x187)]['shareToken']||_0x420f3c['query']['st'];if(_0x455aa6&&(_0x420f3c[_0x589369(0x195)][_0x589369(0x19f)](_0x589369(0x1d0))||_0x420f3c[_0x589369(0x195)][_0x589369(0x19f)](_0x589369(0x14f))||_0x420f3c[_0x589369(0x195)][_0x589369(0x19f)](_0x589369(0x1c9))||_0x420f3c[_0x589369(0x195)][_0x589369(0x19f)]('/api/file/zipFile/')))try{let _0x5726be=_0x420f3c[_0x589369(0x187)][_0x589369(0x1a1)]||_0x420f3c[_0x589369(0x187)]['sp'];_0x5726be&&(_0x420f3c[_0x589369(0x187)]['sp']=Buffer[_0x589369(0x1ab)](_0x5726be,_0x589369(0x15e))[_0x589369(0x18d)]());let _0x21b7c9=_0x420f3c[_0x589369(0x1b2)][_0x589369(0x178)][_0x589369(0x162)](_0x589369(0x1a9))[_0x589369(0x15b)](_0x455aa6,new Date()[_0x589369(0x1c4)]());if(!_0x21b7c9)return _0x1c6c30['status'](0x194)[_0x589369(0x1d2)]();if(_0x21b7c9[_0x589369(0x1ca)]&&_0x21b7c9[_0x589369(0x1ca)]!=_0x420f3c[_0x589369(0x187)]['sp'])return _0x1c6c30[_0x589369(0x1be)](0x194)[_0x589369(0x1d2)]();return _0x420f3c['isTempShare']=!![],_0x556cd1();}catch(_0x54365e){return _0x1c6c30['status'](0x194)['end']();}if(noCheckPathArr['indexOf'](_0x420f3c[_0x589369(0x195)])==-0x1){let _0x571135=_0x420f3c[_0x589369(0x166)][_0x589369(0x17b)]||_0x420f3c[_0x589369(0x187)][_0x589369(0x17b)]||_0x420f3c[_0x589369(0x158)][_0x589369(0x17b)],_0x3b1bf4=dbUserTable[_0x589369(0x15d)](_0x420f3c[_0x589369(0x1b2)][_0x589369(0x178)],_0x571135),_0x23046a=!![];ipDetection&&_0x3b1bf4&&_0x1658dc!=_0x3b1bf4[_0x589369(0x1a4)]&&_0x1658dc!=_0x589369(0x17a)&&!_0x1658dc[_0x589369(0x19f)](_0x589369(0x17f))&&!_0x1658dc[_0x589369(0x19f)](_0x589369(0x16d))&&!_0x1658dc[_0x589369(0x19f)]('172.')&&(_0x23046a=![]);if(!_0x3b1bf4||!_0x23046a)return _0x1c6c30['json']({'code':0x65,'message':i18n['__'](_0x589369(0x18c))});let _0x4e5642=new Date()[_0x589369(0x1c4)](),_0x9b2262=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x3b1bf4['id']]||_0x4e5642-lastUpdateLastLoginTime[_0x3b1bf4['id']]>_0x9b2262)&&(dbUserTable[_0x589369(0x18e)](_0x420f3c[_0x589369(0x1b2)]['dbOther'],_0x571135,_0x4e5642),lastUpdateLastLoginTime[_0x3b1bf4['id']]=_0x4e5642),_0x420f3c[_0x589369(0x1c7)]=_0x3b1bf4,_0x556cd1();}else _0x556cd1();});let mapRouter=require('./routes/mapApi');app[_0x2a857d(0x19d)](_0x2a857d(0x184),mapRouter);let uploadRouter=require(_0x2a857d(0x1c1));app[_0x2a857d(0x19d)](_0x2a857d(0x148),uploadRouter);let transCodeRouter=require(_0x2a857d(0x1c5));app[_0x2a857d(0x19d)](_0x2a857d(0x1a7),transCodeRouter);let pathFileRouter=require('./routes/file');app[_0x2a857d(0x19d)](_0x2a857d(0x174),pathFileRouter);let fileRecordApi=require('./routes/fileRecordApi');app[_0x2a857d(0x19d)](_0x2a857d(0x171),fileRecordApi);let fileRouter=require('./routes/fileApi');app['use']('/api/fileApi',fileRouter);function _0x1f35(){const _0x1d507e=['refreshIpList','get','\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','getUserByToken','base64','/api/usersApi/resetPwdInfo','/api/usersApi','./routes/backupApi','prepare','./routes/movieApi','3015900dFMTmI','./utils/netUtils','headers','init','/api/usersApi/checkIsNasServer','/api/movieInfoApi','log','./routes/privateSpace','/api/mapApi/getZoom','10.','/api/usersApi/login','push','public_music','/api/fileRecordApi','./utils/encryptUtil','public_book','/api/file','/api/movieApi','./routes/movieInfoApi','./routes/fileShareApi','dbOther','../utils/i18nUtil','localhost','token','329033WsGJXr','@tensorflow/tfjs','i18n','192.','locals','public_pdf','100gb','./routes/usersApi','/api/mapApi','/api/commonApi/getServerIpAndSign','language','query','./routes/zipFileApi','../db/dbUtil','login.cannotLogin','16jrcplE','TokenExpired','toString','updateLastLoginTimeByToken','/api/backupApi','/api/privateSpaceApi','value','cookie-parser','/api/bookApi','ipDetection','path','public_viewer','dbCity','black','127.0.0.1','./routes/downloadApi','findByTitle','../db/dbLoginTable','use','message','startsWith','getAllIpListByWhere','sharePwd','join','express-ws','token_ip','returnErrMsg','/api/usersApi/resetPwd','/api/transCode','/api/usersApi/tokenLogin','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','static','from','/api/sourceFolderApi','refreshIpDetection','appRootPath','cors','public','/api/ordinaryAlbumApi','app','/api/addGpsApi','white','/api/commonApi/getLanguage','/api/file/getTempShareFiles','urlencoded','./routes/commonApi','headersSent','../db/dbUserTable','/api/musicApi','/api/downloadApi','../utils/messageUtil','status','./routes/photoApi','decryptParams','./routes/uploadApi','security.ipNotInAllowList','setLocale','getTime','./routes/transCodeApi','/api/file/customImageFile','currentUser','dbFileIndex','/api/file/rawFile/','password','1973370nIUAPi','2743216RpdjgH','../db/dbConfigTable','./routes/ordinaryAlbumApi','/api/mapApi/getLocationStr','/api/fileApi/tinyImgByPath/','ipMode','end','/api/uploadApi','2763900xIijXk','./routes/messageApi','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','/api/fileShareApi','/api/healthCheck','1066278FjnINO','/api/fileApi/rawFileByPath/','./routes/musicApi','./routes/bookApi','/api/usersApi/registAdmin','/api/zipFileApi','json','/api/commonApi/setLanguage','687556XCzeNQ','getLocale','body','./routes/nasAccountApi'];_0x1f35=function(){return _0x1d507e;};return _0x1f35();}let zipFileRouter=require(_0x2a857d(0x188));app[_0x2a857d(0x19d)](_0x2a857d(0x153),zipFileRouter),app['use']('/api/commonApi',commonRouter);let usersRouter=require(_0x2a857d(0x183));app[_0x2a857d(0x19d)](_0x2a857d(0x160),usersRouter);let sourceFolderRouter=require('./routes/sourceFolderApi');app[_0x2a857d(0x19d)](_0x2a857d(0x1ac),sourceFolderRouter);let ordinaryRouter=require(_0x2a857d(0x1ce));app[_0x2a857d(0x19d)](_0x2a857d(0x1b1),ordinaryRouter);let photoRouter=require(_0x2a857d(0x1bf));app['use']('/api/photoApi',photoRouter);let addGpsRouter=require('./routes/addGpsApi');app[_0x2a857d(0x19d)](_0x2a857d(0x1b3),addGpsRouter);let messageRouter=require(_0x2a857d(0x14a));app[_0x2a857d(0x19d)]('/api/messageApi',messageRouter);let movieRouter=require(_0x2a857d(0x163));app[_0x2a857d(0x19d)](_0x2a857d(0x175),movieRouter);let movieInfoRouter=require(_0x2a857d(0x176));app[_0x2a857d(0x19d)](_0x2a857d(0x169),movieInfoRouter);let musicRouter=require(_0x2a857d(0x150));app[_0x2a857d(0x19d)](_0x2a857d(0x1bb),musicRouter);let bookRouter=require(_0x2a857d(0x151));app[_0x2a857d(0x19d)](_0x2a857d(0x193),bookRouter);let backupRouter=require(_0x2a857d(0x161));app['use'](_0x2a857d(0x18f),backupRouter);let fileShareRouter=require(_0x2a857d(0x177));app[_0x2a857d(0x19d)](_0x2a857d(0x14c),fileShareRouter);let nasAccountRouter=require(_0x2a857d(0x159));app[_0x2a857d(0x19d)]('/api/nasAccountApi',nasAccountRouter);let privateSpaceRouter=require(_0x2a857d(0x16b));const {data}=require(_0x2a857d(0x17d));app['use'](_0x2a857d(0x190),privateSpaceRouter);let downloadRouter=require(_0x2a857d(0x19a));function _0x2bc5(_0x4c4071,_0x35039e){const _0x1f3592=_0x1f35();return _0x2bc5=function(_0x2bc573,_0x286e69){_0x2bc573=_0x2bc573-0x148;let _0x2bf6aa=_0x1f3592[_0x2bc573];return _0x2bf6aa;},_0x2bc5(_0x4c4071,_0x35039e);}app[_0x2a857d(0x19d)](_0x2a857d(0x1bc),downloadRouter),app['use'](function(_0x58f6cc,_0x5bda7f,_0x4651aa){const _0x37c589=_0x2a857d;_0x5bda7f[_0x37c589(0x1be)](0x194)[_0x37c589(0x1d2)];}),app['use'](function(_0x2511df,_0x5c3a86,_0x1b6d06,_0x285aac){const _0x3caf42=_0x2a857d;_0x1b6d06[_0x3caf42(0x180)][_0x3caf42(0x19e)]=_0x2511df['message'],console[_0x3caf42(0x16a)](_0x2511df),_0x1b6d06[_0x3caf42(0x1be)](_0x2511df[_0x3caf42(0x1be)]||0x1f4)[_0x3caf42(0x1d2)]();}),module['exports']=app;