const _0x261dc1=_0x2e39;(function(_0x23ef21,_0x2b15e3){const _0x97f820=_0x2e39,_0x3a1d9f=_0x23ef21();while(!![]){try{const _0x5314d5=parseInt(_0x97f820(0x178))/0x1+parseInt(_0x97f820(0x13f))/0x2+-parseInt(_0x97f820(0x171))/0x3+-parseInt(_0x97f820(0x193))/0x4*(parseInt(_0x97f820(0x1a7))/0x5)+-parseInt(_0x97f820(0x18f))/0x6*(parseInt(_0x97f820(0x157))/0x7)+parseInt(_0x97f820(0x1b7))/0x8+-parseInt(_0x97f820(0x1a6))/0x9*(-parseInt(_0x97f820(0x17d))/0xa);if(_0x5314d5===_0x2b15e3)break;else _0x3a1d9f['push'](_0x3a1d9f['shift']());}catch(_0x49eef2){_0x3a1d9f['push'](_0x3a1d9f['shift']());}}}(_0x958b,0x70687));const commonRouter=require(_0x261dc1(0x15a)),express=require(_0x261dc1(0x163)),app=express(),expressWs=require('express-ws');expressWs(app);const path=require(_0x261dc1(0x180)),cookieParser=require(_0x261dc1(0x1b5)),dbUtil=require(_0x261dc1(0x145)),dbu=new dbUtil(),netUtils=require(_0x261dc1(0x18a)),config=require(_0x261dc1(0x196)),compression=require(_0x261dc1(0x15f)),dbUserTable=require(_0x261dc1(0x14c)),cors=require('cors'),messageUtil=require('../utils/messageUtil'),encryptUtil=require(_0x261dc1(0x142));app['use'](cors()),app[_0x261dc1(0x187)](compression());let i18nUtil=require('../utils/i18nUtil'),i18n=i18nUtil[_0x261dc1(0x184)](dbu[_0x261dc1(0x15e)]);app['use'](i18n[_0x261dc1(0x1ba)]),app[_0x261dc1(0x13e)]=i18n,app[_0x261dc1(0x177)]=function(_0x2d0a01,_0xde999d,_0x196f47){const _0x5bc65f=_0x261dc1;let _0x1a9fd8={'code':0x1,'message':_0xde999d};_0x196f47&&(_0x1a9fd8[_0x5bc65f(0x16a)]=_0x196f47);if(!_0x2d0a01[_0x5bc65f(0x17b)])return _0x2d0a01['json'](_0x1a9fd8);},app[_0x261dc1(0x1b8)]=dbu[_0x261dc1(0x1b8)],app[_0x261dc1(0x15e)]=dbu[_0x261dc1(0x15e)],app[_0x261dc1(0x13b)]=dbu[_0x261dc1(0x13b)];const dbConfigTable=require(_0x261dc1(0x189)),dbLoginTable=require(_0x261dc1(0x15c));let ipDetection=![];app[_0x261dc1(0x195)]=()=>{const _0x59ffae=_0x261dc1;let _0x161684=dbConfigTable[_0x59ffae(0x16e)](dbu['dbOther'],_0x59ffae(0x186));_0x161684&&(ipDetection=_0x161684[_0x59ffae(0x14d)]=='1');},app[_0x261dc1(0x195)]();let ipMode=_0x261dc1(0x147),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app[_0x261dc1(0x199)]=()=>{const _0x303bca=_0x261dc1;let _0x5d38a9=new Date()['getTime']();refreshIpTimestamp=_0x5d38a9;let _0x3a8771=dbConfigTable[_0x303bca(0x16e)](dbu[_0x303bca(0x15e)],_0x303bca(0x154));_0x3a8771&&(ipMode=_0x3a8771[_0x303bca(0x14d)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x303bca(0x147)){let _0x475f8b=dbLoginTable[_0x303bca(0x146)](dbu[_0x303bca(0x15e)],'\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>'+_0x5d38a9+')');for(let _0x5d6584 in _0x475f8b){ipBlackList[_0x303bca(0x153)](_0x475f8b[_0x5d6584]['ip']);}}else{if(ipMode=='white'){let _0x16b181=dbLoginTable[_0x303bca(0x146)](dbu['dbOther'],_0x303bca(0x159)+_0x5d38a9+')');for(let _0x196dd0 in _0x16b181){ipWhiteList['push'](_0x16b181[_0x196dd0]['ip']);}}}},app[_0x261dc1(0x199)](),app['use'](express['static'](path[_0x261dc1(0x19d)](config[_0x261dc1(0x166)],_0x261dc1(0x165)))),app[_0x261dc1(0x187)](express['static'](path['join'](config[_0x261dc1(0x166)],_0x261dc1(0x14e)))),app[_0x261dc1(0x187)](express['static'](path[_0x261dc1(0x19d)](config[_0x261dc1(0x166)],_0x261dc1(0x1af)))),app['use'](express['static'](path[_0x261dc1(0x19d)](config[_0x261dc1(0x166)],_0x261dc1(0x1ab)))),app[_0x261dc1(0x187)](express[_0x261dc1(0x164)](path[_0x261dc1(0x19d)](config[_0x261dc1(0x166)],_0x261dc1(0x19b))));var bodyParser=require('body-parser');app[_0x261dc1(0x187)](bodyParser['json']({'limit':_0x261dc1(0x173)})),app[_0x261dc1(0x187)](bodyParser[_0x261dc1(0x19e)]({'limit':_0x261dc1(0x173),'extended':!![]})),app['use'](express[_0x261dc1(0x148)]()),app[_0x261dc1(0x187)](express['urlencoded']({'extended':![]})),app['use'](cookieParser());const noCheckPathArr=[_0x261dc1(0x1a4),_0x261dc1(0x140),'/api/mapApi/getLocationStr','/api/usersApi/resetPwd',_0x261dc1(0x183),_0x261dc1(0x18e),_0x261dc1(0x174),_0x261dc1(0x160),_0x261dc1(0x14b),_0x261dc1(0x149),'/api/usersApi/tokenLogin',_0x261dc1(0x1a2),'/api/commonApi/getLanguage',_0x261dc1(0x17a),_0x261dc1(0x172)];let lastUpdateLastLoginTime={};app[_0x261dc1(0x187)](function(_0x2feaaa,_0x475d8e,_0x5e9d70){const _0x137f99=_0x261dc1;if(_0x2feaaa[_0x137f99(0x180)]==_0x137f99(0x17e))return _0x475d8e[_0x137f99(0x148)]({'code':0x0});let _0x6b9997=new Date()['getTime'](),_0x376421=netUtils['getClientIp'](_0x2feaaa);if(_0x376421!=_0x137f99(0x191)&&_0x376421!=_0x137f99(0x158)){_0x6b9997-refreshIpGap>refreshIpTimestamp&&app['refreshIpList']();if(ipMode=='black'){if(ipBlackList[_0x137f99(0x155)](_0x376421))return app[_0x137f99(0x177)](_0x475d8e,_0x475d8e['__'](_0x137f99(0x1b0))+_0x475d8e['__']('login.cannotLogin'));}else{if(ipMode=='white'){if(!ipWhiteList[_0x137f99(0x155)](_0x376421))return app[_0x137f99(0x177)](_0x475d8e,_0x475d8e['__'](_0x137f99(0x1b0))+_0x475d8e['__'](_0x137f99(0x1b3)));}}}encryptUtil['decryptParams'](_0x2feaaa),_0x2feaaa['setLocale'](i18n['getLocale']()),_0x475d8e[_0x137f99(0x152)][_0x137f99(0x17c)]=i18n[_0x137f99(0x1b4)]();let _0x293fdf=_0x2feaaa[_0x137f99(0x176)]['shareToken']||_0x2feaaa[_0x137f99(0x176)]['st'];if(_0x293fdf&&(_0x2feaaa[_0x137f99(0x180)][_0x137f99(0x151)]('/api/fileApi/tinyImgByPath/')||_0x2feaaa['path'][_0x137f99(0x151)](_0x137f99(0x161))||_0x2feaaa[_0x137f99(0x180)]['startsWith'](_0x137f99(0x185))||_0x2feaaa[_0x137f99(0x180)][_0x137f99(0x151)](_0x137f99(0x16d))))try{let _0x4eb7bc=_0x2feaaa[_0x137f99(0x176)][_0x137f99(0x1a8)]||_0x2feaaa[_0x137f99(0x176)]['sp'];_0x4eb7bc&&(_0x2feaaa[_0x137f99(0x176)]['sp']=Buffer[_0x137f99(0x19a)](_0x4eb7bc,_0x137f99(0x1ac))['toString']());let _0x33e98e=_0x2feaaa['app']['dbOther'][_0x137f99(0x144)](_0x137f99(0x1ae))[_0x137f99(0x162)](_0x293fdf,new Date()[_0x137f99(0x181)]());if(!_0x33e98e)return _0x475d8e[_0x137f99(0x182)](0x194)[_0x137f99(0x15b)]();if(_0x33e98e[_0x137f99(0x167)]&&_0x33e98e[_0x137f99(0x167)]!=_0x2feaaa[_0x137f99(0x176)]['sp'])return _0x475d8e[_0x137f99(0x182)](0x194)[_0x137f99(0x15b)]();return _0x2feaaa[_0x137f99(0x150)]=!![],_0x5e9d70();}catch(_0xd5f3d8){return _0x475d8e['status'](0x194)['end']();}if(noCheckPathArr[_0x137f99(0x19c)](_0x2feaaa[_0x137f99(0x180)])==-0x1){let _0x2282f5=_0x2feaaa[_0x137f99(0x1ad)]['token']||_0x2feaaa[_0x137f99(0x176)][_0x137f99(0x13c)]||_0x2feaaa[_0x137f99(0x13d)]['token'],_0x1934e4=dbUserTable[_0x137f99(0x169)](_0x2feaaa[_0x137f99(0x1a0)][_0x137f99(0x15e)],_0x2282f5),_0x222535=!![];ipDetection&&_0x1934e4&&_0x376421!=_0x1934e4[_0x137f99(0x1b1)]&&_0x376421!=_0x137f99(0x191)&&!_0x376421[_0x137f99(0x151)](_0x137f99(0x14f))&&!_0x376421[_0x137f99(0x151)](_0x137f99(0x16c))&&!_0x376421[_0x137f99(0x151)]('172.')&&(_0x222535=![]);if(!_0x1934e4||!_0x222535)return _0x475d8e[_0x137f99(0x148)]({'code':0x65,'message':i18n['__']('TokenExpired')});let _0x303992=new Date()[_0x137f99(0x181)](),_0x3c28a4=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x1934e4['id']]||_0x303992-lastUpdateLastLoginTime[_0x1934e4['id']]>_0x3c28a4)&&(dbUserTable[_0x137f99(0x198)](_0x2feaaa['app'][_0x137f99(0x15e)],_0x2282f5,_0x303992),lastUpdateLastLoginTime[_0x1934e4['id']]=_0x303992),_0x2feaaa[_0x137f99(0x17f)]=_0x1934e4,_0x5e9d70();}else _0x5e9d70();});let mapRouter=require(_0x261dc1(0x168));app[_0x261dc1(0x187)]('/api/mapApi',mapRouter);let uploadRouter=require(_0x261dc1(0x143));app[_0x261dc1(0x187)](_0x261dc1(0x1a9),uploadRouter);function _0x958b(){const _0x3a3676=['ipDetection','use','./routes/messageApi','../db/dbConfigTable','./utils/netUtils','./routes/ordinaryAlbumApi','./routes/sourceFolderApi','/api/fileApi','/api/usersApi/hasAdmin','2970654cdBBVX','exports','localhost','message','68892tXYkvc','./routes/photoApi','refreshIpDetection','../myConfig/config','/api/addGpsApi','updateLastLoginTimeByToken','refreshIpList','from','public_book','indexOf','join','urlencoded','/api/zipFileApi','app','/api/backupApi','/api/usersApi/checkIsNasServer','./routes/fileRecordApi','/api/mapApi/tile','./routes/downloadApi','99vNUbGF','130JzUZNs','sharePwd','/api/uploadApi','/api/ordinaryAlbumApi','public_music','base64','headers','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','public_viewer','security.ipNotInAllowList','token_ip','log','login.cannotLogin','getLocale','cookie-parser','@tensorflow/tfjs','6017456kbYDMe','dbFileIndex','/api/commonApi','init','dbCity','token','body','i18n','353884FOmWSk','/api/mapApi/getZoom','/api/transCode','./utils/encryptUtil','./routes/uploadApi','prepare','../db/dbUtil','getAllIpListByWhere','black','json','/api/usersApi/login','/api/movieApi','/api/file/customImageFile','../db/dbUserTable','value','public_pdf','192.','isTempShare','startsWith','locals','push','ipMode','includes','./routes/addGpsApi','7ekxRkT','127.0.0.1','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','./routes/commonApi','end','../db/dbLoginTable','./routes/nasAccountApi','dbOther','compression','/api/file/getTempShareFiles','/api/fileApi/rawFileByPath/','get','express','static','public','appRootPath','password','./routes/mapApi','getUserByToken','alertType','/api/musicApi','10.','/api/file/zipFile/','findByTitle','/api/fileShareApi','./routes/transCodeApi','520806uRCVAz','/api/commonApi/getServerIpAndSign','100gb','/api/usersApi/registAdmin','/api/photoApi','query','returnErrMsg','483666WBqgYH','./routes/privateSpace','/api/commonApi/setLanguage','headersSent','language','149220SLEfqJ','/api/healthCheck','currentUser','path','getTime','status','/api/usersApi/resetPwdInfo','getI18n','/api/file/rawFile/'];_0x958b=function(){return _0x3a3676;};return _0x958b();}let transCodeRouter=require(_0x261dc1(0x170));app[_0x261dc1(0x187)](_0x261dc1(0x141),transCodeRouter);let pathFileRouter=require('./routes/file');app[_0x261dc1(0x187)]('/api/file',pathFileRouter);let fileRecordApi=require(_0x261dc1(0x1a3));app['use']('/api/fileRecordApi',fileRecordApi);let fileRouter=require('./routes/fileApi');app['use'](_0x261dc1(0x18d),fileRouter);let zipFileRouter=require('./routes/zipFileApi');app[_0x261dc1(0x187)](_0x261dc1(0x19f),zipFileRouter),app['use'](_0x261dc1(0x1b9),commonRouter);let usersRouter=require('./routes/usersApi');app[_0x261dc1(0x187)]('/api/usersApi',usersRouter);let sourceFolderRouter=require(_0x261dc1(0x18c));app[_0x261dc1(0x187)]('/api/sourceFolderApi',sourceFolderRouter);let ordinaryRouter=require(_0x261dc1(0x18b));app['use'](_0x261dc1(0x1aa),ordinaryRouter);let photoRouter=require(_0x261dc1(0x194));app[_0x261dc1(0x187)](_0x261dc1(0x175),photoRouter);let addGpsRouter=require(_0x261dc1(0x156));app[_0x261dc1(0x187)](_0x261dc1(0x197),addGpsRouter);let messageRouter=require(_0x261dc1(0x188));app[_0x261dc1(0x187)]('/api/messageApi',messageRouter);let movieRouter=require('./routes/movieApi');app[_0x261dc1(0x187)](_0x261dc1(0x14a),movieRouter);let movieInfoRouter=require('./routes/movieInfoApi');app['use']('/api/movieInfoApi',movieInfoRouter);let musicRouter=require('./routes/musicApi');app[_0x261dc1(0x187)](_0x261dc1(0x16b),musicRouter);let bookRouter=require('./routes/bookApi');app['use']('/api/bookApi',bookRouter);let backupRouter=require('./routes/backupApi');app[_0x261dc1(0x187)](_0x261dc1(0x1a1),backupRouter);let fileShareRouter=require('./routes/fileShareApi');function _0x2e39(_0x418123,_0x3a6299){const _0x958b5c=_0x958b();return _0x2e39=function(_0x2e393c,_0x52154e){_0x2e393c=_0x2e393c-0x13b;let _0x3eb9cc=_0x958b5c[_0x2e393c];return _0x3eb9cc;},_0x2e39(_0x418123,_0x3a6299);}app[_0x261dc1(0x187)](_0x261dc1(0x16f),fileShareRouter);let nasAccountRouter=require(_0x261dc1(0x15d));app['use']('/api/nasAccountApi',nasAccountRouter);let privateSpaceRouter=require(_0x261dc1(0x179));const {data}=require(_0x261dc1(0x1b6));app[_0x261dc1(0x187)]('/api/privateSpaceApi',privateSpaceRouter);let downloadRouter=require(_0x261dc1(0x1a5));app[_0x261dc1(0x187)]('/api/downloadApi',downloadRouter),app[_0x261dc1(0x187)](function(_0x2cdf6f,_0x219987,_0x2f73cc){_0x219987['status'](0x194)['end'];}),app['use'](function(_0x5807c5,_0x4a8575,_0x362cac,_0x45ee4b){const _0x21245e=_0x261dc1;_0x362cac[_0x21245e(0x152)][_0x21245e(0x192)]=_0x5807c5['message'],console[_0x21245e(0x1b2)](_0x5807c5),_0x362cac['status'](_0x5807c5[_0x21245e(0x182)]||0x1f4)[_0x21245e(0x15b)]();}),module[_0x261dc1(0x190)]=app;