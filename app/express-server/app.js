const _0x19087e=_0x576a;(function(_0x74ba27,_0x41330e){const _0x1fea8f=_0x576a,_0x50b811=_0x74ba27();while(!![]){try{const _0x3755aa=parseInt(_0x1fea8f(0xda))/0x1*(parseInt(_0x1fea8f(0x104))/0x2)+-parseInt(_0x1fea8f(0x10b))/0x3*(-parseInt(_0x1fea8f(0x108))/0x4)+parseInt(_0x1fea8f(0xfc))/0x5*(parseInt(_0x1fea8f(0xf5))/0x6)+-parseInt(_0x1fea8f(0xc9))/0x7*(-parseInt(_0x1fea8f(0x146))/0x8)+-parseInt(_0x1fea8f(0xe4))/0x9+parseInt(_0x1fea8f(0xe8))/0xa+-parseInt(_0x1fea8f(0x123))/0xb;if(_0x3755aa===_0x41330e)break;else _0x50b811['push'](_0x50b811['shift']());}catch(_0xb89d48){_0x50b811['push'](_0x50b811['shift']());}}}(_0x4557,0x6411e));const commonRouter=require(_0x19087e(0x141)),express=require(_0x19087e(0xd2)),app=express(),expressWs=require('express-ws');expressWs(app);const path=require(_0x19087e(0x138)),cookieParser=require(_0x19087e(0xf0)),dbUtil=require('../db/dbUtil'),dbu=new dbUtil(),netUtils=require(_0x19087e(0x131)),config=require(_0x19087e(0xde)),compression=require(_0x19087e(0xd5)),dbUserTable=require(_0x19087e(0xee)),cors=require(_0x19087e(0x13b)),messageUtil=require(_0x19087e(0xc3)),encryptUtil=require(_0x19087e(0x119));app[_0x19087e(0xce)](cors()),app[_0x19087e(0xce)](compression());let i18nUtil=require(_0x19087e(0x11c)),i18n=i18nUtil[_0x19087e(0xed)](dbu[_0x19087e(0x134)]);app[_0x19087e(0xce)](i18n[_0x19087e(0xdf)]),app['i18n']=i18n,app[_0x19087e(0xec)]=function(_0x386af3,_0x41e176,_0x2c8139){const _0x48cf1e=_0x19087e;let _0x12c448={'code':0x1,'message':_0x41e176};_0x2c8139&&(_0x12c448[_0x48cf1e(0xe5)]=_0x2c8139);if(!_0x386af3['headersSent'])return _0x386af3[_0x48cf1e(0xe9)](_0x12c448);},app[_0x19087e(0x115)]=dbu[_0x19087e(0x115)],app[_0x19087e(0x134)]=dbu[_0x19087e(0x134)],app['dbCity']=dbu[_0x19087e(0x122)];function _0x4557(){const _0x399c4d=['sharePwd','6553300ldqyms','json','ipDetection','/api/privateSpaceApi','returnErrMsg','getI18n','../db/dbUserTable','./routes/file','cookie-parser','refreshIpDetection','/api/file/getTempShareFiles','/api/movieApi','/api/uploadApi','2715078Dmgnhk','body-parser','/api/commonApi/setLanguage','getTime','/api/usersApi/checkIsNasServer','/api/sourceFolderApi','/api/file/rawFile/','5fqVRxL','./routes/photoApi','\x20type=\x27black\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','login.cannotLogin','../db/dbConfigTable','password','10.','/api/usersApi/hasAdmin','554oHVASq','indexOf','/api/healthCheck','public_pdf','116TkfRak','getClientIp','public_book','4269yfzxkm','/api/usersApi/tokenLogin','/api/backupApi','prepare','./routes/addGpsApi','@tensorflow/tfjs','./routes/downloadApi','/api/nasAccountApi','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?\x20AND\x20end_timestamp\x20>\x20?','getLocale','dbFileIndex','/api/usersApi/registAdmin','/api/usersApi/resetPwdInfo','/api/mapApi/getLocationStr','./utils/encryptUtil','./routes/fileApi','./routes/zipFileApi','../utils/i18nUtil','/api/usersApi/login','/api/file/customImageFile','push','isTempShare','/api/mapApi','dbCity','3275085EZLFeM','getAllIpListByWhere','192.','./routes/fileShareApi','172.','./routes/movieApi','app','white','\x20type=\x27white\x27\x20and\x20(end_timestamp\x20is\x20null\x20or\x20end_timestamp>','public_music','token','/api/musicApi','language','localhost','./utils/netUtils','/api/ordinaryAlbumApi','currentUser','dbOther','includes','/api/file/zipFile/','public_viewer','path','/api/mapApi/tile','/api/messageApi','cors','127.0.0.1','from','/api/file','shareToken','/api/mapApi/getZoom','./routes/commonApi','get','100gb','/api/fileRecordApi','./routes/backupApi','533240vUEKtb','TokenExpired','toString','log','updateLastLoginTimeByToken','../utils/messageUtil','static','setLocale','refreshIpList','./routes/messageApi','/api/movieInfoApi','7lqBPcQ','decryptParams','/api/fileShareApi','value','status','use','end','./routes/bookApi','base64','express','query','urlencoded','compression','/api/usersApi','/api/commonApi/getLanguage','message','join','634UVslRJ','appRootPath','startsWith','./routes/transCodeApi','../myConfig/config','init','exports','security.ipNotInAllowList','black','body','6153858aYkVmP','alertType','locals'];_0x4557=function(){return _0x399c4d;};return _0x4557();}const dbConfigTable=require(_0x19087e(0x100)),dbLoginTable=require('../db/dbLoginTable');let ipDetection=![];app[_0x19087e(0xf1)]=()=>{const _0x2c8988=_0x19087e;let _0x5c2b0b=dbConfigTable['findByTitle'](dbu['dbOther'],_0x2c8988(0xea));_0x5c2b0b&&(ipDetection=_0x5c2b0b[_0x2c8988(0xcc)]=='1');},app[_0x19087e(0xf1)]();let ipMode=_0x19087e(0xe2),ipBlackList=[],ipWhiteList=[],refreshIpTimestamp=0x0,refreshIpGap=0x3c*0x3e8;app['refreshIpList']=()=>{const _0x18d389=_0x19087e;let _0x408547=new Date()['getTime']();refreshIpTimestamp=_0x408547;let _0x5784b4=dbConfigTable['findByTitle'](dbu[_0x18d389(0x134)],'ipMode');_0x5784b4&&(ipMode=_0x5784b4[_0x18d389(0xcc)]);ipBlackList=[],ipWhiteList=[];if(ipMode==_0x18d389(0xe2)){let _0x5fe888=dbLoginTable[_0x18d389(0x124)](dbu[_0x18d389(0x134)],_0x18d389(0xfe)+_0x408547+')');for(let _0x4445d5 in _0x5fe888){ipBlackList[_0x18d389(0x11f)](_0x5fe888[_0x4445d5]['ip']);}}else{if(ipMode==_0x18d389(0x12a)){let _0x5a18e1=dbLoginTable[_0x18d389(0x124)](dbu[_0x18d389(0x134)],_0x18d389(0x12b)+_0x408547+')');for(let _0x485276 in _0x5a18e1){ipWhiteList[_0x18d389(0x11f)](_0x5a18e1[_0x485276]['ip']);}}}},app[_0x19087e(0xc6)](),app[_0x19087e(0xce)](express['static'](path[_0x19087e(0xd9)](config[_0x19087e(0xdb)],'public'))),app[_0x19087e(0xce)](express['static'](path[_0x19087e(0xd9)](config[_0x19087e(0xdb)],_0x19087e(0x107)))),app[_0x19087e(0xce)](express[_0x19087e(0xc4)](path['join'](config['appRootPath'],_0x19087e(0x137)))),app[_0x19087e(0xce)](express[_0x19087e(0xc4)](path['join'](config['appRootPath'],_0x19087e(0x12c)))),app[_0x19087e(0xce)](express[_0x19087e(0xc4)](path['join'](config[_0x19087e(0xdb)],_0x19087e(0x10a))));var bodyParser=require(_0x19087e(0xf6));app[_0x19087e(0xce)](bodyParser[_0x19087e(0xe9)]({'limit':_0x19087e(0x143)})),app[_0x19087e(0xce)](bodyParser[_0x19087e(0xd4)]({'limit':_0x19087e(0x143),'extended':!![]})),app[_0x19087e(0xce)](express[_0x19087e(0xe9)]()),app[_0x19087e(0xce)](express[_0x19087e(0xd4)]({'extended':![]})),app[_0x19087e(0xce)](cookieParser());const noCheckPathArr=[_0x19087e(0x139),_0x19087e(0x140),_0x19087e(0x118),'/api/usersApi/resetPwd',_0x19087e(0x117),_0x19087e(0x103),_0x19087e(0x116),_0x19087e(0xf2),_0x19087e(0x11e),_0x19087e(0x11d),_0x19087e(0x10c),_0x19087e(0xf9),_0x19087e(0xd7),_0x19087e(0xf7),'/api/commonApi/getServerIpAndSign'];let lastUpdateLastLoginTime={};app['use'](function(_0x33ea89,_0x18dff6,_0x1bea52){const _0x42e9aa=_0x19087e;if(_0x33ea89[_0x42e9aa(0x138)]==_0x42e9aa(0x106))return _0x18dff6[_0x42e9aa(0xe9)]({'code':0x0});let _0xe9841=new Date()['getTime'](),_0x3ac640=netUtils[_0x42e9aa(0x109)](_0x33ea89);if(_0x3ac640!='localhost'&&_0x3ac640!=_0x42e9aa(0x13c)){_0xe9841-refreshIpGap>refreshIpTimestamp&&app[_0x42e9aa(0xc6)]();if(ipMode==_0x42e9aa(0xe2)){if(ipBlackList[_0x42e9aa(0x135)](_0x3ac640))return app[_0x42e9aa(0xec)](_0x18dff6,_0x18dff6['__']('security.ipNotInAllowList')+_0x18dff6['__'](_0x42e9aa(0xff)));}else{if(ipMode==_0x42e9aa(0x12a)){if(!ipWhiteList['includes'](_0x3ac640))return app[_0x42e9aa(0xec)](_0x18dff6,_0x18dff6['__'](_0x42e9aa(0xe1))+_0x18dff6['__'](_0x42e9aa(0xff)));}}}encryptUtil[_0x42e9aa(0xca)](_0x33ea89),_0x33ea89[_0x42e9aa(0xc5)](i18n['getLocale']()),_0x18dff6[_0x42e9aa(0xe6)][_0x42e9aa(0x12f)]=i18n[_0x42e9aa(0x114)]();let _0x587ec4=_0x33ea89['query'][_0x42e9aa(0x13f)]||_0x33ea89[_0x42e9aa(0xd3)]['st'];if(_0x587ec4&&(_0x33ea89[_0x42e9aa(0x138)][_0x42e9aa(0xdc)]('/api/fileApi/tinyImgByPath/')||_0x33ea89[_0x42e9aa(0x138)][_0x42e9aa(0xdc)]('/api/fileApi/rawFileByPath/')||_0x33ea89[_0x42e9aa(0x138)][_0x42e9aa(0xdc)](_0x42e9aa(0xfb))||_0x33ea89[_0x42e9aa(0x138)][_0x42e9aa(0xdc)](_0x42e9aa(0x136))))try{let _0x17519c=_0x33ea89[_0x42e9aa(0xd3)][_0x42e9aa(0xe7)]||_0x33ea89['query']['sp'];_0x17519c&&(_0x33ea89[_0x42e9aa(0xd3)]['sp']=Buffer[_0x42e9aa(0x13d)](_0x17519c,_0x42e9aa(0xd1))[_0x42e9aa(0xc0)]());let _0x348635=_0x33ea89[_0x42e9aa(0x129)][_0x42e9aa(0x134)][_0x42e9aa(0x10e)](_0x42e9aa(0x113))[_0x42e9aa(0x142)](_0x587ec4,new Date()[_0x42e9aa(0xf8)]());if(!_0x348635)return _0x18dff6['status'](0x194)[_0x42e9aa(0xcf)]();if(_0x348635[_0x42e9aa(0x101)]&&_0x348635['password']!=_0x33ea89[_0x42e9aa(0xd3)]['sp'])return _0x18dff6[_0x42e9aa(0xcd)](0x194)[_0x42e9aa(0xcf)]();return _0x33ea89[_0x42e9aa(0x120)]=!![],_0x1bea52();}catch(_0x518efe){return _0x18dff6['status'](0x194)[_0x42e9aa(0xcf)]();}if(noCheckPathArr[_0x42e9aa(0x105)](_0x33ea89['path'])==-0x1){let _0x407030=_0x33ea89['headers'][_0x42e9aa(0x12d)]||_0x33ea89[_0x42e9aa(0xd3)]['token']||_0x33ea89[_0x42e9aa(0xe3)]['token'],_0x5b5176=dbUserTable['getUserByToken'](_0x33ea89[_0x42e9aa(0x129)][_0x42e9aa(0x134)],_0x407030),_0x383aa8=!![];ipDetection&&_0x5b5176&&_0x3ac640!=_0x5b5176['token_ip']&&_0x3ac640!=_0x42e9aa(0x130)&&!_0x3ac640[_0x42e9aa(0xdc)](_0x42e9aa(0x125))&&!_0x3ac640[_0x42e9aa(0xdc)](_0x42e9aa(0x102))&&!_0x3ac640[_0x42e9aa(0xdc)](_0x42e9aa(0x127))&&(_0x383aa8=![]);if(!_0x5b5176||!_0x383aa8)return _0x18dff6[_0x42e9aa(0xe9)]({'code':0x65,'message':i18n['__'](_0x42e9aa(0xbf))});let _0x2b8f25=new Date()[_0x42e9aa(0xf8)](),_0x4e3356=0xa*0x3e8;(!lastUpdateLastLoginTime[_0x5b5176['id']]||_0x2b8f25-lastUpdateLastLoginTime[_0x5b5176['id']]>_0x4e3356)&&(dbUserTable[_0x42e9aa(0xc2)](_0x33ea89[_0x42e9aa(0x129)][_0x42e9aa(0x134)],_0x407030,_0x2b8f25),lastUpdateLastLoginTime[_0x5b5176['id']]=_0x2b8f25),_0x33ea89[_0x42e9aa(0x133)]=_0x5b5176,_0x1bea52();}else _0x1bea52();});let mapRouter=require('./routes/mapApi');app[_0x19087e(0xce)](_0x19087e(0x121),mapRouter);let uploadRouter=require('./routes/uploadApi');app[_0x19087e(0xce)](_0x19087e(0xf4),uploadRouter);let transCodeRouter=require(_0x19087e(0xdd));app[_0x19087e(0xce)]('/api/transCode',transCodeRouter);let pathFileRouter=require(_0x19087e(0xef));app[_0x19087e(0xce)](_0x19087e(0x13e),pathFileRouter);let fileRecordApi=require('./routes/fileRecordApi');app[_0x19087e(0xce)](_0x19087e(0x144),fileRecordApi);let fileRouter=require(_0x19087e(0x11a));app[_0x19087e(0xce)]('/api/fileApi',fileRouter);let zipFileRouter=require(_0x19087e(0x11b));app[_0x19087e(0xce)]('/api/zipFileApi',zipFileRouter),app[_0x19087e(0xce)]('/api/commonApi',commonRouter);let usersRouter=require('./routes/usersApi');app['use'](_0x19087e(0xd6),usersRouter);let sourceFolderRouter=require('./routes/sourceFolderApi');app['use'](_0x19087e(0xfa),sourceFolderRouter);let ordinaryRouter=require('./routes/ordinaryAlbumApi');app[_0x19087e(0xce)](_0x19087e(0x132),ordinaryRouter);let photoRouter=require(_0x19087e(0xfd));app[_0x19087e(0xce)]('/api/photoApi',photoRouter);let addGpsRouter=require(_0x19087e(0x10f));app[_0x19087e(0xce)]('/api/addGpsApi',addGpsRouter);let messageRouter=require(_0x19087e(0xc7));app[_0x19087e(0xce)](_0x19087e(0x13a),messageRouter);let movieRouter=require(_0x19087e(0x128));app[_0x19087e(0xce)](_0x19087e(0xf3),movieRouter);let movieInfoRouter=require('./routes/movieInfoApi');app['use'](_0x19087e(0xc8),movieInfoRouter);let musicRouter=require('./routes/musicApi');app[_0x19087e(0xce)](_0x19087e(0x12e),musicRouter);let bookRouter=require(_0x19087e(0xd0));app[_0x19087e(0xce)]('/api/bookApi',bookRouter);let backupRouter=require(_0x19087e(0x145));app['use'](_0x19087e(0x10d),backupRouter);let fileShareRouter=require(_0x19087e(0x126));app[_0x19087e(0xce)](_0x19087e(0xcb),fileShareRouter);let nasAccountRouter=require('./routes/nasAccountApi');function _0x576a(_0x6aae1,_0x1ecbb1){const _0x45577e=_0x4557();return _0x576a=function(_0x576aee,_0x5f40fe){_0x576aee=_0x576aee-0xbf;let _0x3be042=_0x45577e[_0x576aee];return _0x3be042;},_0x576a(_0x6aae1,_0x1ecbb1);}app[_0x19087e(0xce)](_0x19087e(0x112),nasAccountRouter);let privateSpaceRouter=require('./routes/privateSpace');const {data}=require(_0x19087e(0x110));app[_0x19087e(0xce)](_0x19087e(0xeb),privateSpaceRouter);let downloadRouter=require(_0x19087e(0x111));app[_0x19087e(0xce)]('/api/downloadApi',downloadRouter),app[_0x19087e(0xce)](function(_0xba6d57,_0x42f343,_0x23d911){const _0x4a3094=_0x19087e;_0x42f343['status'](0x194)[_0x4a3094(0xcf)];}),app[_0x19087e(0xce)](function(_0x1c4df8,_0x559170,_0x44220a,_0x483f3d){const _0x4fbdcf=_0x19087e;_0x44220a[_0x4fbdcf(0xe6)][_0x4fbdcf(0xd8)]=_0x1c4df8[_0x4fbdcf(0xd8)],console[_0x4fbdcf(0xc1)](_0x1c4df8),_0x44220a[_0x4fbdcf(0xcd)](_0x1c4df8[_0x4fbdcf(0xcd)]||0x1f4)[_0x4fbdcf(0xcf)]();}),module[_0x19087e(0xe0)]=app;