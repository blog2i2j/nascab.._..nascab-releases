const _0x251a80=_0x2c99;(function(_0x158a24,_0x3dff7b){const _0x22c4a9=_0x2c99,_0xe77f3c=_0x158a24();while(!![]){try{const _0x138ab1=parseInt(_0x22c4a9(0x1ba))/0x1+parseInt(_0x22c4a9(0x1c9))/0x2*(parseInt(_0x22c4a9(0x1c8))/0x3)+parseInt(_0x22c4a9(0x18a))/0x4+-parseInt(_0x22c4a9(0x1cb))/0x5*(-parseInt(_0x22c4a9(0x179))/0x6)+-parseInt(_0x22c4a9(0x194))/0x7+-parseInt(_0x22c4a9(0x190))/0x8*(-parseInt(_0x22c4a9(0x1a8))/0x9)+-parseInt(_0x22c4a9(0x1d4))/0xa;if(_0x138ab1===_0x3dff7b)break;else _0xe77f3c['push'](_0xe77f3c['shift']());}catch(_0x4cb64c){_0xe77f3c['push'](_0xe77f3c['shift']());}}}(_0x5f1f,0x95f79));var express=require('express'),router=express['Router']();function _0x2c99(_0xdb6738,_0xcf7f2c){const _0x5f1ff6=_0x5f1f();return _0x2c99=function(_0x2c99d,_0x3f4d13){_0x2c99d=_0x2c99d-0x175;let _0x1602d7=_0x5f1ff6[_0x2c99d];return _0x1602d7;},_0x2c99(_0xdb6738,_0xcf7f2c);}const fs=require('fs'),sharp=require(_0x251a80(0x180)),axios=require('axios');let sha256=require(_0x251a80(0x195)),path=require('path'),config=require(_0x251a80(0x1f2));const tmdbApi=require(_0x251a80(0x196)),movieInfoUtil=require(_0x251a80(0x1b4)),movieSeasonUtil=require(_0x251a80(0x186)),dbFileIndexTable=require(_0x251a80(0x1e1)),dbUserTable=require('../../db/dbUserTable'),dbFileOperationRecord=require(_0x251a80(0x1a3)),nfoUtil=require(_0x251a80(0x1ae)),httpUtil=require(_0x251a80(0x183));function _0x5f1f(){const _0x53c2a4=['207699tHAMWw','getTmdbApi','is_tvplay','exports','tmdbId','addFileOperationRecord','fanart.jpg','need\x20folder','-thumb.jpg','splice','languageList','post','log','then','723acFfXf','5034UwiQIc','season.nfo','1049845Oowghh','刮削文件清理成功','-poster.jpg','push','power_change','ext','/testTmdb','.nfo','url','1638370kWZcWy','noCache','json','status_message','/searchMovieInfo','dbOther','success','Need\x20tmdb\x20key','returnErrMsg','TMDBID','query','/getImdbImg','search','../../db/dbFileIndexTable','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','doUserCanGet','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','getDetail','headersSent','getProxyUrl','-fanart.jpg','status_code','page','runSearchNfoWorker','SWITCH_MOVIE_INFO','Need\x20tmdb\x20language','要清除的nfo和海报文件列表','tmdb','all','/testTmdbProxy','../../myConfig/config','currentUser','TMDB\x20search接口请求失败','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?','poster.jpg','SELECT\x20*\x20FROM\x20','6dOoKhd','saveMovieInfoToDb','sep','catch','substring','API','indexId/tmdbId\x20error','sharp','jpeg','username','../../utils/httpUtil','LEVEL_MAIN_OPERATION','searchStr','../../utils/movieSeasonUtil','body','filename','params\x20error','3436968CFljIH','getById','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','get','indexId','TMDB\x20Error','22112oQZnYE','path','resize','downloadImg','8182839vIiEVH','sha256','../../utils/movieInfoTmdbApi','indexOf','run','is_admin','/getScrapeLog','lastIndexOf','stat','dirname','message','movieTmdbApiKey','getSeasonNumber','send','testTmdb','../../db/dbFileOperationRecord','operationFail','STATE_SUC','sourceFolder','allSettled','207IDNbgQ','INDEX_TABLE_NAME_MOVIE','count','tvshow.nfo','join','length','../../utils/nfoUtil','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','app','dbFileIndex','.jpg','/setMovieInfo','../../utils/movieInfoUtil','movieTmdbApiUrl','status','end','KEYWORD','prepare'];_0x5f1f=function(){return _0x53c2a4;};return _0x5f1f();}router['post'](_0x251a80(0x1d1),(_0x2cffc2,_0x3a63c4,_0x150a08)=>{const _0x558b88=_0x251a80;if(_0x2cffc2['currentUser'][_0x558b88(0x199)]!=0x1)return _0x3a63c4['json']({'code':0x66});let _0x592235=_0x2cffc2[_0x558b88(0x187)]['movieTmdbLanguage'],_0x50b9f6=_0x2cffc2[_0x558b88(0x187)][_0x558b88(0x1b5)],_0x17097d=_0x2cffc2[_0x558b88(0x187)][_0x558b88(0x19f)];if(!_0x592235)return _0x2cffc2[_0x558b88(0x1b0)][_0x558b88(0x1dc)](_0x3a63c4,_0x558b88(0x1ed));if(!_0x50b9f6)return _0x2cffc2['app'][_0x558b88(0x1dc)](_0x3a63c4,'Need\x20tmdb\x20api\x20url');if(!_0x17097d)return _0x2cffc2[_0x558b88(0x1b0)][_0x558b88(0x1dc)](_0x3a63c4,_0x558b88(0x1db));let _0x1cfec3=movieInfoUtil[_0x558b88(0x1e7)](_0x2cffc2[_0x558b88(0x1b0)][_0x558b88(0x1d9)]),_0xe78b22=new tmdbApi[(_0x558b88(0x17e))](_0x17097d,_0x592235,_0x50b9f6,_0x1cfec3);_0xe78b22[_0x558b88(0x1c4)]()['then'](_0x3609a7=>{const _0x13d3f0=_0x558b88;if(_0x3609a7[_0x13d3f0(0x1da)]==![]||_0x3609a7['status_code'])return _0x3a63c4[_0x13d3f0(0x1d6)]({'code':0x2,'msg':_0x3609a7['status_message']});return _0x3a63c4['json']({'code':0x0,'data':[]});})[_0x558b88(0x17c)](_0x5498fb=>{const _0x442758=_0x558b88;let _0x54f58b=_0x442758(0x18f);if(_0x5498fb){if(_0x5498fb[_0x442758(0x1e9)])_0x54f58b+=':'+_0x5498fb['status_message'];else _0x5498fb[_0x442758(0x19e)]&&(_0x54f58b+=':'+_0x5498fb[_0x442758(0x19e)]);}return _0x3a63c4[_0x442758(0x1d6)]({'code':0x2,'msg':_0x54f58b,'data':[]});});}),router[_0x251a80(0x1c5)](_0x251a80(0x1f1),(_0x5a8c2d,_0x1cfea8,_0x15f8af)=>{const _0x3fa786=_0x251a80;if(_0x5a8c2d[_0x3fa786(0x1f3)]['is_admin']!=0x1)return _0x1cfea8[_0x3fa786(0x1d6)]({'code':0x66});movieInfoUtil[_0x3fa786(0x1a2)](_0x5a8c2d[_0x3fa786(0x1b0)][_0x3fa786(0x1d9)])[_0x3fa786(0x1c7)](()=>{const _0x2a746e=_0x3fa786;return _0x1cfea8[_0x2a746e(0x1d6)]({'code':0x0});})[_0x3fa786(0x17c)](_0x44a829=>{return _0x1cfea8['json']({'code':0x2,'msg':_0x44a829});});}),router[_0x251a80(0x1c5)](_0x251a80(0x1d8),(_0x20a7f4,_0x548a17,_0x226007)=>{const _0x2a4e17=_0x251a80;let _0x130f36=_0x20a7f4['body'][_0x2a4e17(0x185)],_0xc259e7=_0x20a7f4[_0x2a4e17(0x187)]['searchType'],_0x21333c=_0x20a7f4[_0x2a4e17(0x187)]['searchMediaType'],_0x450410=_0x20a7f4[_0x2a4e17(0x187)][_0x2a4e17(0x1ea)];if(!_0x130f36||!_0xc259e7||!_0x21333c)return _0x20a7f4[_0x2a4e17(0x1b0)][_0x2a4e17(0x1dc)](_0x548a17,_0x2a4e17(0x189));let _0x351251=movieInfoUtil[_0x2a4e17(0x1bb)](_0x20a7f4[_0x2a4e17(0x1b0)][_0x2a4e17(0x1d9)]);if(_0xc259e7==_0x2a4e17(0x1b8))_0x351251[_0x2a4e17(0x1e0)](_0x130f36,_0x21333c=='TV',null,_0x450410,!![])[_0x2a4e17(0x1c7)](_0xaeb9c3=>{if(!_0x548a17['headersSent'])return _0x548a17['json']({'code':0x0,'data':_0xaeb9c3});})[_0x2a4e17(0x17c)](_0x481b88=>{const _0x5b9c91=_0x2a4e17;console[_0x5b9c91(0x1c6)](_0x5b9c91(0x175),_0x481b88);if(_0x481b88&&_0x481b88['status_code']&&_0x481b88[_0x5b9c91(0x1d7)])return _0x20a7f4[_0x5b9c91(0x1b0)]['returnErrMsg'](_0x548a17,_0x481b88[_0x5b9c91(0x1d7)]);if(!_0x548a17[_0x5b9c91(0x1e6)])return _0x548a17[_0x5b9c91(0x1d6)]({'code':0x0,'data':[]});});else{if(_0xc259e7==_0x2a4e17(0x1dd))_0x351251[_0x2a4e17(0x1e5)](_0x130f36,_0x21333c=='TV')[_0x2a4e17(0x1c7)](_0x35eed1=>{const _0x335086=_0x2a4e17;if(!_0x548a17[_0x335086(0x1e6)])return _0x548a17[_0x335086(0x1d6)]({'code':0x0,'data':[_0x35eed1]});})['catch'](_0x1c783c=>{const _0x239349=_0x2a4e17;console[_0x239349(0x1c6)](_0x239349(0x175),_0x1c783c);if(_0x1c783c&&_0x1c783c['status_code']&&_0x1c783c[_0x239349(0x1d7)])return _0x20a7f4[_0x239349(0x1b0)]['returnErrMsg'](_0x548a17,_0x1c783c[_0x239349(0x1d7)]);if(!_0x548a17[_0x239349(0x1e6)])return _0x548a17[_0x239349(0x1d6)]({'code':0x0,'data':[]});});else{if(!_0x548a17[_0x2a4e17(0x1e6)])return _0x548a17[_0x2a4e17(0x1d6)]({'code':0x0,'data':[]});}}});function updateIndexByNfo(_0x17c5af,_0x1e85cd){return new Promise((_0x4b4ade,_0x332168)=>{const _0x2b359f=_0x2c99;nfoUtil['parseNfo'](_0x1e85cd,!![],![])[_0x2b359f(0x1c7)](_0xfe35c5=>{const _0x5ce570=_0x2b359f;return movieInfoUtil[_0x5ce570(0x17a)](_0x17c5af,_0x1e85cd['id'],_0xfe35c5),_0x4b4ade();})['catch'](_0xbed48=>{return _0x4b4ade();});});}router[_0x251a80(0x1c5)]('/scrapeAgain',(_0x5d1e2f,_0x1e7644,_0x10570e)=>{const _0x3d90cf=_0x251a80;let _0x1e71fe=_0x5d1e2f[_0x3d90cf(0x187)][_0x3d90cf(0x18e)],_0x44718e=_0x5d1e2f[_0x3d90cf(0x187)]['scrapeMissing'],_0x1f35e5=dbFileIndexTable[_0x3d90cf(0x18b)](_0x5d1e2f['app'][_0x3d90cf(0x1b1)],_0x1e71fe,dbFileIndexTable[_0x3d90cf(0x1a9)]);if(!_0x1f35e5)return _0x5d1e2f['app'][_0x3d90cf(0x1dc)](_0x1e7644,'indexId\x20error');if(dbUserTable['doUserCanGet'](_0x5d1e2f,_0x1e7644,'','power_change',_0x1f35e5[_0x3d90cf(0x191)])==!![]){function _0x5403b8(){const _0x23fe6e=_0x3d90cf;movieInfoUtil['runSearchNfoWorker'](_0x5d1e2f[_0x23fe6e(0x1b0)][_0x23fe6e(0x1d9)],_0x1f35e5[_0x23fe6e(0x191)],_0x1f35e5[_0x23fe6e(0x188)],_0x1f35e5['is_tvplay'],null,_0x44718e)[_0x23fe6e(0x1c7)](()=>{const _0x1c883d=_0x23fe6e;_0x1f35e5[_0x1c883d(0x1bc)]==0x0&&updateIndexByNfo(_0x5d1e2f[_0x1c883d(0x1b0)][_0x1c883d(0x1b1)],_0x1f35e5)['then'](()=>{});})['catch'](_0x57fb70=>{});}_0x44718e==0x1?_0x5403b8():clearInfo(_0x5d1e2f,_0x1e7644,_0x1f35e5)[_0x3d90cf(0x1c7)](()=>{_0x5403b8();});if(!_0x1e7644['headersSent'])return _0x1e7644[_0x3d90cf(0x1d6)]({'code':0x0});}}),router[_0x251a80(0x1c5)](_0x251a80(0x19a),(_0x5aefdc,_0x21f118,_0x1d6194)=>{const _0x2ede7b=_0x251a80;if(_0x5aefdc[_0x2ede7b(0x1f3)][_0x2ede7b(0x199)]!=0x1)return _0x21f118[_0x2ede7b(0x1d6)]({'code':0x66});let _0xa2b222=_0x5aefdc[_0x2ede7b(0x187)][_0x2ede7b(0x1aa)]||0x1e,_0x833d83=_0x5aefdc['body']['offset']||0x0;const _0x276a9=_0x2ede7b(0x1e2);let _0x1476c9=_0x5aefdc[_0x2ede7b(0x1b0)][_0x2ede7b(0x1b1)][_0x2ede7b(0x1b9)](_0x276a9)[_0x2ede7b(0x1f0)](_0xa2b222,_0x833d83);return _0x21f118[_0x2ede7b(0x1d6)]({'code':0x0,'data':_0x1476c9});}),router[_0x251a80(0x1c5)]('/clearScrapeLog',(_0x3476b9,_0xb7d4f3,_0x7a0fcf)=>{const _0x47336b=_0x251a80;if(_0x3476b9[_0x47336b(0x1f3)]['is_admin']!=0x1)return _0xb7d4f3[_0x47336b(0x1d6)]({'code':0x66});const _0x23683e=_0x47336b(0x1e4);return _0x3476b9['app'][_0x47336b(0x1b1)][_0x47336b(0x1b9)](_0x23683e)['run'](),_0xb7d4f3[_0x47336b(0x1d6)]({'code':0x0});}),router[_0x251a80(0x1c5)]('/clearNfoImg',(_0x2d57eb,_0x58f767,_0x1baed8)=>{const _0x542d8b=_0x251a80;if(_0x2d57eb[_0x542d8b(0x1f3)][_0x542d8b(0x199)]!=0x1)return _0x58f767['json']({'code':0x66});let _0x280f59=_0x2d57eb['body'][_0x542d8b(0x1a6)];if(!_0x280f59)return _0x2d57eb[_0x542d8b(0x1b0)]['returnErrMsg'](_0x58f767,_0x542d8b(0x1c1));const _0x209a11=_0x542d8b(0x176);_0x2d57eb[_0x542d8b(0x1b0)]['dbFileIndex'][_0x542d8b(0x1b9)](_0x209a11)[_0x542d8b(0x198)](_0x280f59,_0x280f59+path[_0x542d8b(0x17b)]+'%');let _0x463303=_0x542d8b(0x178)+dbFileIndexTable[_0x542d8b(0x1a9)]+_0x542d8b(0x18c),_0x35a1a5=_0x2d57eb[_0x542d8b(0x1b0)]['dbFileIndex']['prepare'](_0x463303)['all'](_0x280f59,_0x280f59+path[_0x542d8b(0x17b)]+'%'),_0x274392=[];for(let _0xd4b38 of _0x35a1a5){movieInfoUtil['saveMovieInfoToDb'](_0x2d57eb[_0x542d8b(0x1b0)][_0x542d8b(0x1b1)],_0xd4b38['id'],{}),_0x274392[_0x542d8b(0x1ce)](deleteMovieInfoOfIndex(_0x2d57eb,_0xd4b38));}Promise['allSettled'](_0x274392)[_0x542d8b(0x1c7)](_0x34b351=>{const _0x267c5d=_0x542d8b;return process[_0x267c5d(0x1a1)]({'type':_0x267c5d(0x1ec)}),_0x58f767['json']({'code':0x0});});});function deleteMovieInfoOfIndex(_0x3482f8,_0x1fcab3){return new Promise((_0x123b7b,_0x3a4acb)=>{const _0x7de792=_0x2c99;let _0x4e8010=path['join'](_0x1fcab3[_0x7de792(0x191)],_0x1fcab3['filename']['substring'](0x0,_0x1fcab3[_0x7de792(0x188)][_0x7de792(0x19b)](_0x1fcab3['ext']))+_0x7de792(0x1b2)),_0x3c2726=path[_0x7de792(0x1ac)](_0x1fcab3[_0x7de792(0x191)],_0x1fcab3[_0x7de792(0x188)]['substring'](0x0,_0x1fcab3[_0x7de792(0x188)][_0x7de792(0x19b)](_0x1fcab3[_0x7de792(0x1d0)]))+_0x7de792(0x1c2)),_0x50e296=path['join'](_0x1fcab3[_0x7de792(0x191)],_0x1fcab3[_0x7de792(0x188)][_0x7de792(0x17d)](0x0,_0x1fcab3[_0x7de792(0x188)][_0x7de792(0x19b)](_0x1fcab3[_0x7de792(0x1d0)]))+_0x7de792(0x1e8)),_0x4410a0=path[_0x7de792(0x1ac)](_0x1fcab3[_0x7de792(0x191)],_0x1fcab3[_0x7de792(0x188)][_0x7de792(0x17d)](0x0,_0x1fcab3[_0x7de792(0x188)][_0x7de792(0x19b)](_0x1fcab3['ext']))+_0x7de792(0x1cd)),_0x4e3d8c=path[_0x7de792(0x1ac)](_0x1fcab3[_0x7de792(0x191)],'poster.jpg'),_0x540b4f=path[_0x7de792(0x1ac)](_0x1fcab3[_0x7de792(0x191)],_0x1fcab3['filename'][_0x7de792(0x17d)](0x0,_0x1fcab3['filename'][_0x7de792(0x19b)](_0x1fcab3['ext']))+_0x7de792(0x1d2)),_0x2491e6=[_0x4e8010,_0x4e3d8c,_0x3c2726,_0x50e296,_0x4410a0,_0x540b4f];if(_0x1fcab3[_0x7de792(0x1bc)]==0x1){let _0x781e31=path['join'](_0x1fcab3[_0x7de792(0x191)],_0x7de792(0x1ab)),_0x78e300=path[_0x7de792(0x1ac)](_0x1fcab3[_0x7de792(0x191)],_0x7de792(0x1ca));_0x2491e6[_0x7de792(0x1ce)](_0x781e31),_0x2491e6[_0x7de792(0x1ce)](_0x78e300);let _0x144bd4=path['basename'](_0x1fcab3[_0x7de792(0x191)]),_0xab8e49=path[_0x7de792(0x19d)](_0x1fcab3[_0x7de792(0x191)]),_0x116039=movieSeasonUtil[_0x7de792(0x1a0)](_0x144bd4);if(_0x116039>0x0){let _0x174ab2=path[_0x7de792(0x1ac)](_0xab8e49,'tvshow.nfo');_0x2491e6[_0x7de792(0x1ce)](_0x174ab2);_0x116039<0xa&&(_0x116039='0'+_0x116039);let _0x34b36e=path['join'](_0xab8e49,'season'+_0x116039+_0x7de792(0x1cd));_0x2491e6[_0x7de792(0x1ce)](_0x34b36e);let _0x2029c8=path[_0x7de792(0x1ac)](_0xab8e49,_0x7de792(0x177));_0x2491e6[_0x7de792(0x1ce)](_0x2029c8);let _0x835901=path['join'](_0xab8e49,_0x7de792(0x1c0));_0x2491e6[_0x7de792(0x1ce)](_0x835901);}}console[_0x7de792(0x1c6)](_0x7de792(0x1ee),_0x2491e6);function _0x1aded0(){const _0x1b123f=_0x7de792;_0x2491e6['length']>0x0?fs[_0x1b123f(0x19c)](_0x2491e6[0x0],(_0x3ae202,_0x55d17c)=>{const _0x255d13=_0x1b123f;!_0x3ae202&&_0x55d17c&&_0x55d17c['isFile']()?(console[_0x255d13(0x1c6)]('清理',_0x2491e6[0x0]),fs['rm'](_0x2491e6[0x0],_0x227274=>{const _0x261ff3=_0x255d13;let _0x22dffe=_0x2491e6[0x0];_0x2491e6['splice'](0x0,0x1),!_0x227274&&(console[_0x261ff3(0x1c6)](_0x261ff3(0x1cc),_0x22dffe),dbFileOperationRecord[_0x261ff3(0x1bf)](_0x3482f8[_0x261ff3(0x1b0)][_0x261ff3(0x1d9)],{'username':_0x3482f8[_0x261ff3(0x1f3)][_0x261ff3(0x182)],'targetPath':_0x22dffe,'level':dbFileOperationRecord[_0x261ff3(0x184)],'type':dbFileOperationRecord['TYPE_DELETE'],'state':dbFileOperationRecord[_0x261ff3(0x1a5)]})),_0x1aded0();})):(_0x2491e6[_0x255d13(0x1c3)](0x0,0x1),_0x1aded0());}):(movieInfoUtil[_0x1b123f(0x17a)](_0x3482f8[_0x1b123f(0x1b0)]['dbFileIndex'],_0x1fcab3['id'],{}),_0x123b7b());}_0x1aded0();});}function clearInfo(_0x2f33e3,_0x33fc9b,_0x557f75){return new Promise((_0x26ca89,_0x527994)=>{const _0x5cf310=_0x2c99;if(dbUserTable['doUserCanGet'](_0x2f33e3,_0x33fc9b,'','power_delete',_0x557f75[_0x5cf310(0x191)])==!![]){if(_0x557f75[_0x5cf310(0x1bc)]==0x1){let _0x5a9cd0=_0x5cf310(0x178)+dbFileIndexTable[_0x5cf310(0x1a9)]+_0x5cf310(0x1af),_0x587a92=_0x2f33e3[_0x5cf310(0x1b0)]['dbFileIndex'][_0x5cf310(0x1b9)](_0x5a9cd0)[_0x5cf310(0x1f0)](_0x557f75['path']),_0x234a6b=[];for(let _0x50fde6 of _0x587a92){_0x234a6b[_0x5cf310(0x1ce)](deleteMovieInfoOfIndex(_0x2f33e3,_0x50fde6));}if(_0x234a6b[_0x5cf310(0x1ad)]<0x1)return _0x26ca89();Promise[_0x5cf310(0x1a7)](_0x234a6b)[_0x5cf310(0x1c7)](_0x589903=>{return _0x26ca89();})[_0x5cf310(0x17c)](_0x12e0af=>{return _0x26ca89();});}else deleteMovieInfoOfIndex(_0x2f33e3,_0x557f75)[_0x5cf310(0x1c7)](_0x2ae594=>{return _0x26ca89();});}});}router[_0x251a80(0x1c5)]('/clearMovieInfo',(_0x35106f,_0x1385c9,_0x4054aa)=>{const _0x411af7=_0x251a80;let _0x4d38c4=_0x35106f[_0x411af7(0x187)][_0x411af7(0x18e)],_0xe44c67=dbFileIndexTable[_0x411af7(0x18b)](_0x35106f[_0x411af7(0x1b0)][_0x411af7(0x1b1)],_0x4d38c4,dbFileIndexTable[_0x411af7(0x1a9)]);if(!_0xe44c67)return _0x35106f['app']['returnErrMsg'](_0x1385c9,'indexId\x20error');clearInfo(_0x35106f,_0x1385c9,_0xe44c67)[_0x411af7(0x1c7)](()=>{const _0x38d9ff=_0x411af7;return _0x1385c9[_0x38d9ff(0x1d6)]({'code':0x0});});}),router[_0x251a80(0x1c5)](_0x251a80(0x1b3),(_0x31c9bc,_0x59bdc7,_0x366c50)=>{const _0x3a41e3=_0x251a80;let _0x10a4d8=_0x31c9bc['body'][_0x3a41e3(0x18e)],_0x4324e6=dbFileIndexTable[_0x3a41e3(0x18b)](_0x31c9bc[_0x3a41e3(0x1b0)][_0x3a41e3(0x1b1)],_0x10a4d8,dbFileIndexTable[_0x3a41e3(0x1a9)]),_0x349c58=_0x31c9bc[_0x3a41e3(0x187)][_0x3a41e3(0x1be)];if(!_0x4324e6||!_0x349c58)return _0x31c9bc[_0x3a41e3(0x1b0)]['returnErrMsg'](_0x59bdc7,_0x3a41e3(0x17f));dbUserTable[_0x3a41e3(0x1e3)](_0x31c9bc,_0x59bdc7,'',_0x3a41e3(0x1cf),_0x4324e6[_0x3a41e3(0x191)])==!![]&&clearInfo(_0x31c9bc,_0x59bdc7,_0x4324e6)['then'](()=>{const _0x3556d4=_0x3a41e3;return movieInfoUtil[_0x3556d4(0x1eb)](_0x31c9bc[_0x3556d4(0x1b0)][_0x3556d4(0x1d9)],_0x4324e6[_0x3556d4(0x191)],_0x4324e6[_0x3556d4(0x188)],_0x4324e6['is_tvplay'],_0x349c58)[_0x3556d4(0x1c7)](()=>{const _0x12f717=_0x3556d4;if(_0x4324e6['is_tvplay']==0x0)updateIndexByNfo(_0x31c9bc[_0x12f717(0x1b0)]['dbFileIndex'],_0x4324e6)[_0x12f717(0x1c7)](()=>{});else{}})['catch'](_0x338ff2=>{const _0x12ddf5=_0x3556d4;return console[_0x12ddf5(0x1c6)](_0x338ff2),_0x31c9bc[_0x12ddf5(0x1b0)][_0x12ddf5(0x1dc)](_0x59bdc7,_0x59bdc7['__'](_0x12ddf5(0x1a4)));}),_0x59bdc7[_0x3556d4(0x1d6)]({'code':0x0});});}),router[_0x251a80(0x18d)](_0x251a80(0x1df),(_0x1118ad,_0xf66e3,_0x363040)=>{const _0x1ffa2c=_0x251a80;let _0x38d333=_0x1118ad[_0x1ffa2c(0x1de)][_0x1ffa2c(0x1d3)];if(!_0x38d333||!_0x38d333[_0x1ffa2c(0x197)](_0x1ffa2c(0x1ef))==-0x1)return _0xf66e3[_0x1ffa2c(0x1b6)](0x194)[_0x1ffa2c(0x1b7)]();_0x38d333=decodeURIComponent(_0x38d333);let _0xd55b83=path[_0x1ffa2c(0x1ac)](config['posterPath'],sha256(_0x38d333));function _0x45e36f(){const _0x1eecee=_0x1ffa2c;sharp(_0xd55b83,{'failOnError':![]})[_0x1eecee(0x181)]({'quality':0x4d})[_0x1eecee(0x192)]({'width':0x1f4})['toBuffer']()[_0x1eecee(0x1c7)](_0x2c4eea=>{const _0x367048=_0x1eecee;return _0xf66e3[_0x367048(0x1a1)](_0x2c4eea);})[_0x1eecee(0x17c)](_0x3c97a7=>{const _0x2dd150=_0x1eecee;return console['log']('err1',_0x3c97a7),_0xf66e3['status'](0x194)[_0x2dd150(0x1b7)]();});}fs[_0x1ffa2c(0x19c)](_0xd55b83,(_0x3b5841,_0x866f3a)=>{const _0x237070=_0x1ffa2c;if(!_0x3b5841)return _0x45e36f();_0x1118ad[_0x237070(0x1de)][_0x237070(0x1d5)]==0x1?httpUtil[_0x237070(0x193)](_0x1118ad[_0x237070(0x1b0)][_0x237070(0x1d9)],_0x38d333)['then'](_0x10f3ef=>{return _0x10f3ef['pipe'](_0xf66e3);})[_0x237070(0x17c)](_0x3e1e4b=>{const _0x13cb88=_0x237070;return _0xf66e3[_0x13cb88(0x1b6)](0x194)[_0x13cb88(0x1b7)]();}):httpUtil[_0x237070(0x193)](_0x1118ad[_0x237070(0x1b0)][_0x237070(0x1d9)],_0x38d333,_0xd55b83)[_0x237070(0x1c7)](_0x4fbd5d=>{_0x45e36f();})[_0x237070(0x17c)](_0x34e747=>{const _0x5913cb=_0x237070;return _0xf66e3[_0x5913cb(0x1b6)](0x194)['end']();});});}),module[_0x251a80(0x1bd)]=router;