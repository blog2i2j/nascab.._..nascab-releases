const _0x5a71f7=_0x1989;(function(_0x2b8116,_0x40c2e7){const _0x18bae5=_0x1989,_0x243653=_0x2b8116();while(!![]){try{const _0x2b8a32=-parseInt(_0x18bae5(0x13b))/0x1+parseInt(_0x18bae5(0x165))/0x2+-parseInt(_0x18bae5(0x182))/0x3*(parseInt(_0x18bae5(0x14e))/0x4)+parseInt(_0x18bae5(0x138))/0x5*(parseInt(_0x18bae5(0x175))/0x6)+-parseInt(_0x18bae5(0x179))/0x7*(parseInt(_0x18bae5(0x130))/0x8)+-parseInt(_0x18bae5(0x117))/0x9+parseInt(_0x18bae5(0x113))/0xa*(parseInt(_0x18bae5(0x140))/0xb);if(_0x2b8a32===_0x40c2e7)break;else _0x243653['push'](_0x243653['shift']());}catch(_0x3e3261){_0x243653['push'](_0x243653['shift']());}}}(_0xbf9d,0xb8669));var express=require('express'),router=express[_0x5a71f7(0x133)]();function _0x1989(_0x51e381,_0x5908cc){const _0xbf9d1d=_0xbf9d();return _0x1989=function(_0x1989db,_0x215c6e){_0x1989db=_0x1989db-0x105;let _0x3893ed=_0xbf9d1d[_0x1989db];return _0x3893ed;},_0x1989(_0x51e381,_0x5908cc);}const fs=require('fs'),sharp=require('sharp'),axios=require('axios');let sha256=require('sha256'),path=require('path'),config=require(_0x5a71f7(0x164));function _0xbf9d(){const _0x4d3daa=['returnErrMsg','KEYWORD','STATE_SUC','INDEX_TABLE_NAME_MOVIE','../../utils/movieSeasonUtil','query','indexId','catch','../../db/dbUserTable','/testTmdb','params\x20error','status_message','run','currentUser','indexId\x20error','success','searchType','season','tmdbId','then','684920nuNsUV','/scrapeAgain','/clearNfoImg','Router','send','tmdb','get','getProxyUrl','516910kvcROn','is_admin','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','1130303eKrjgf','page','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?','../../utils/httpUtil','basename','275TkJFnx','offset','要清除的nfo和海报文件列表','parseNfo','.nfo','join','lastIndexOf','Need\x20tmdb\x20language','API','../../utils/nfoUtil','fanart.jpg','prepare','/getScrapeLog','downloadImg','28rFWzCk','push','SELECT\x20*\x20FROM\x20','saveMovieInfoToDb','languageList','toBuffer','ext','runSearchNfoWorker','filename','movieTmdbApiUrl','indexOf','../../db/dbFileOperationRecord','tvshow.nfo','json','sep','TYPE_DELETE','length','-thumb.jpg','movieTmdbApiKey','path','/testTmdbProxy','../../utils/movieInfoTmdbApi','../../myConfig/config','2577836xncGYo','status','getById','doUserCanGet','-poster.jpg','message','status_code','username','TMDB\x20search接口请求失败','resize','dbFileIndex','jpeg','indexId/tmdbId\x20error','post','TMDBID','body','42nEdiOd','is_tvplay','/setMovieInfo','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','98McIfwP','/clearMovieInfo','allSettled','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','../../utils/movieInfoUtil','poster.jpg','splice','getTmdbApi','searchStr','526341gQUKsw','app','substring','../../db/dbFileIndexTable','url','stat','posterPath','pipe','need\x20folder','end','/clearScrapeLog','/getImdbImg','headersSent','TMDB\x20Error','log','LEVEL_MAIN_OPERATION','power_change','1168590WNBqik','dbOther','scrapeMissing','operationFail','5595480beeoDE','all','.jpg','err1','searchMediaType'];_0xbf9d=function(){return _0x4d3daa;};return _0xbf9d();}const tmdbApi=require(_0x5a71f7(0x163)),movieInfoUtil=require(_0x5a71f7(0x17d)),movieSeasonUtil=require(_0x5a71f7(0x120)),dbFileIndexTable=require(_0x5a71f7(0x105)),dbUserTable=require(_0x5a71f7(0x124)),dbFileOperationRecord=require(_0x5a71f7(0x159)),nfoUtil=require(_0x5a71f7(0x149)),httpUtil=require(_0x5a71f7(0x13e));router[_0x5a71f7(0x172)](_0x5a71f7(0x125),(_0x26f489,_0x47dc4c,_0x4d6e25)=>{const _0x2dc096=_0x5a71f7;if(_0x26f489[_0x2dc096(0x129)][_0x2dc096(0x139)]!=0x1)return _0x47dc4c[_0x2dc096(0x15b)]({'code':0x66});let _0xf4a804=_0x26f489['body']['movieTmdbLanguage'],_0x132e97=_0x26f489[_0x2dc096(0x174)][_0x2dc096(0x157)],_0x10deda=_0x26f489[_0x2dc096(0x174)][_0x2dc096(0x160)];if(!_0xf4a804)return _0x26f489[_0x2dc096(0x183)][_0x2dc096(0x11c)](_0x47dc4c,_0x2dc096(0x147));if(!_0x132e97)return _0x26f489['app'][_0x2dc096(0x11c)](_0x47dc4c,'Need\x20tmdb\x20api\x20url');if(!_0x10deda)return _0x26f489['app'][_0x2dc096(0x11c)](_0x47dc4c,'Need\x20tmdb\x20key');let _0x30321a=movieInfoUtil[_0x2dc096(0x137)](_0x26f489[_0x2dc096(0x183)][_0x2dc096(0x114)]),_0x5bac5f=new tmdbApi[(_0x2dc096(0x148))](_0x10deda,_0xf4a804,_0x132e97,_0x30321a);_0x5bac5f[_0x2dc096(0x152)]()['then'](_0x171891=>{const _0x983ab2=_0x2dc096;if(_0x171891[_0x983ab2(0x12b)]==![]||_0x171891[_0x983ab2(0x16b)])return _0x47dc4c[_0x983ab2(0x15b)]({'code':0x2,'msg':_0x171891[_0x983ab2(0x127)]});return _0x47dc4c[_0x983ab2(0x15b)]({'code':0x0,'data':[]});})['catch'](_0x33b26d=>{const _0x253d4f=_0x2dc096;let _0x4ca00a=_0x253d4f(0x10f);if(_0x33b26d){if(_0x33b26d[_0x253d4f(0x16b)])_0x4ca00a+=':'+_0x33b26d[_0x253d4f(0x127)];else _0x33b26d['message']&&(_0x4ca00a+=':'+_0x33b26d[_0x253d4f(0x16a)]);}return _0x47dc4c[_0x253d4f(0x15b)]({'code':0x2,'msg':_0x4ca00a,'data':[]});});}),router[_0x5a71f7(0x172)](_0x5a71f7(0x162),(_0x34f9bf,_0x24ee5c,_0x3fca88)=>{const _0x103fbe=_0x5a71f7;if(_0x34f9bf[_0x103fbe(0x129)][_0x103fbe(0x139)]!=0x1)return _0x24ee5c[_0x103fbe(0x15b)]({'code':0x66});movieInfoUtil['testTmdb'](_0x34f9bf[_0x103fbe(0x183)][_0x103fbe(0x114)])[_0x103fbe(0x12f)](()=>{const _0x9fa6de=_0x103fbe;return _0x24ee5c[_0x9fa6de(0x15b)]({'code':0x0});})[_0x103fbe(0x123)](_0x20d5ac=>{const _0xf51dc=_0x103fbe;return _0x24ee5c[_0xf51dc(0x15b)]({'code':0x2,'msg':_0x20d5ac});});}),router['post']('/searchMovieInfo',(_0x408e77,_0x282579,_0x2c1964)=>{const _0x1f505a=_0x5a71f7;let _0x5991a6=_0x408e77['body'][_0x1f505a(0x181)],_0x2f9c9f=_0x408e77['body'][_0x1f505a(0x12c)],_0x162450=_0x408e77[_0x1f505a(0x174)][_0x1f505a(0x11b)],_0x4a577e=_0x408e77[_0x1f505a(0x174)][_0x1f505a(0x13c)];if(!_0x5991a6||!_0x2f9c9f||!_0x162450)return _0x408e77[_0x1f505a(0x183)][_0x1f505a(0x11c)](_0x282579,_0x1f505a(0x126));let _0x166a0e=movieInfoUtil[_0x1f505a(0x180)](_0x408e77[_0x1f505a(0x183)]['dbOther']);if(_0x2f9c9f==_0x1f505a(0x11d))_0x166a0e['search'](_0x5991a6,_0x162450=='TV',null,_0x4a577e,!![])[_0x1f505a(0x12f)](_0x536a4c=>{const _0x108bb0=_0x1f505a;if(!_0x282579[_0x108bb0(0x10e)])return _0x282579[_0x108bb0(0x15b)]({'code':0x0,'data':_0x536a4c});})['catch'](_0x16b908=>{const _0x4d0735=_0x1f505a;console[_0x4d0735(0x110)]('TMDB\x20search接口请求失败',_0x16b908);if(_0x16b908&&_0x16b908[_0x4d0735(0x16b)]&&_0x16b908[_0x4d0735(0x127)])return _0x408e77[_0x4d0735(0x183)]['returnErrMsg'](_0x282579,_0x16b908[_0x4d0735(0x127)]);if(!_0x282579[_0x4d0735(0x10e)])return _0x282579[_0x4d0735(0x15b)]({'code':0x0,'data':[]});});else{if(_0x2f9c9f==_0x1f505a(0x173))_0x166a0e['getDetail'](_0x5991a6,_0x162450=='TV')[_0x1f505a(0x12f)](_0x658a1d=>{const _0x12c3bf=_0x1f505a;if(!_0x282579[_0x12c3bf(0x10e)])return _0x282579[_0x12c3bf(0x15b)]({'code':0x0,'data':[_0x658a1d]});})[_0x1f505a(0x123)](_0x3fcb21=>{const _0x1b838f=_0x1f505a;console['log'](_0x1b838f(0x16d),_0x3fcb21);if(_0x3fcb21&&_0x3fcb21[_0x1b838f(0x16b)]&&_0x3fcb21[_0x1b838f(0x127)])return _0x408e77[_0x1b838f(0x183)][_0x1b838f(0x11c)](_0x282579,_0x3fcb21[_0x1b838f(0x127)]);if(!_0x282579[_0x1b838f(0x10e)])return _0x282579[_0x1b838f(0x15b)]({'code':0x0,'data':[]});});else{if(!_0x282579['headersSent'])return _0x282579['json']({'code':0x0,'data':[]});}}});function updateIndexByNfo(_0x186c1d,_0x226db6){return new Promise((_0x22e9ac,_0x2b180b)=>{const _0x34f419=_0x1989;nfoUtil[_0x34f419(0x143)](_0x226db6,!![],![])[_0x34f419(0x12f)](_0x31faa1=>{return movieInfoUtil['saveMovieInfoToDb'](_0x186c1d,_0x226db6['id'],_0x31faa1),_0x22e9ac();})[_0x34f419(0x123)](_0x4c8d20=>{return _0x22e9ac();});});}router['post'](_0x5a71f7(0x131),(_0x25b0d6,_0x490d9a,_0x39f6a5)=>{const _0x1c9468=_0x5a71f7;let _0x21b607=_0x25b0d6[_0x1c9468(0x174)][_0x1c9468(0x122)],_0x2c0b20=_0x25b0d6[_0x1c9468(0x174)][_0x1c9468(0x115)],_0x3f43c4=dbFileIndexTable[_0x1c9468(0x167)](_0x25b0d6[_0x1c9468(0x183)][_0x1c9468(0x16f)],_0x21b607,dbFileIndexTable[_0x1c9468(0x11f)]);if(!_0x3f43c4)return _0x25b0d6[_0x1c9468(0x183)][_0x1c9468(0x11c)](_0x490d9a,_0x1c9468(0x12a));if(dbUserTable[_0x1c9468(0x168)](_0x25b0d6,_0x490d9a,'',_0x1c9468(0x112),_0x3f43c4[_0x1c9468(0x161)])==!![]){function _0x2043c6(){const _0x48a891=_0x1c9468;movieInfoUtil[_0x48a891(0x155)](_0x25b0d6[_0x48a891(0x183)][_0x48a891(0x114)],_0x3f43c4[_0x48a891(0x161)],_0x3f43c4[_0x48a891(0x156)],_0x3f43c4[_0x48a891(0x176)],null,_0x2c0b20)[_0x48a891(0x12f)](()=>{const _0x37332d=_0x48a891;_0x3f43c4[_0x37332d(0x176)]==0x0&&updateIndexByNfo(_0x25b0d6[_0x37332d(0x183)][_0x37332d(0x16f)],_0x3f43c4)[_0x37332d(0x12f)](()=>{});})[_0x48a891(0x123)](_0x2733cf=>{});}_0x2c0b20==0x1?_0x2043c6():clearInfo(_0x25b0d6,_0x490d9a,_0x3f43c4)[_0x1c9468(0x12f)](()=>{_0x2043c6();});if(!_0x490d9a[_0x1c9468(0x10e)])return _0x490d9a[_0x1c9468(0x15b)]({'code':0x0});}}),router[_0x5a71f7(0x172)](_0x5a71f7(0x14c),(_0x58ef2a,_0x53cab0,_0x2f0279)=>{const _0x433f10=_0x5a71f7;if(_0x58ef2a['currentUser'][_0x433f10(0x139)]!=0x1)return _0x53cab0[_0x433f10(0x15b)]({'code':0x66});let _0x3c445=_0x58ef2a['body']['count']||0x1e,_0x4d1684=_0x58ef2a[_0x433f10(0x174)][_0x433f10(0x141)]||0x0;const _0x1c16f4=_0x433f10(0x13a);let _0x2adcbe=_0x58ef2a[_0x433f10(0x183)][_0x433f10(0x16f)]['prepare'](_0x1c16f4)[_0x433f10(0x118)](_0x3c445,_0x4d1684);return _0x53cab0[_0x433f10(0x15b)]({'code':0x0,'data':_0x2adcbe});}),router[_0x5a71f7(0x172)](_0x5a71f7(0x10c),(_0x1e254c,_0x232476,_0x15f32d)=>{const _0x253fc9=_0x5a71f7;if(_0x1e254c['currentUser'][_0x253fc9(0x139)]!=0x1)return _0x232476[_0x253fc9(0x15b)]({'code':0x66});const _0x47daed=_0x253fc9(0x17c);return _0x1e254c[_0x253fc9(0x183)][_0x253fc9(0x16f)]['prepare'](_0x47daed)[_0x253fc9(0x128)](),_0x232476[_0x253fc9(0x15b)]({'code':0x0});}),router['post'](_0x5a71f7(0x132),(_0x1ebd87,_0x2103af,_0xc41551)=>{const _0x12a77b=_0x5a71f7;if(_0x1ebd87[_0x12a77b(0x129)]['is_admin']!=0x1)return _0x2103af['json']({'code':0x66});let _0x547994=_0x1ebd87[_0x12a77b(0x174)]['sourceFolder'];if(!_0x547994)return _0x1ebd87['app'][_0x12a77b(0x11c)](_0x2103af,_0x12a77b(0x10a));const _0x35c75e=_0x12a77b(0x13d);_0x1ebd87[_0x12a77b(0x183)][_0x12a77b(0x16f)]['prepare'](_0x35c75e)['run'](_0x547994,_0x547994+path[_0x12a77b(0x15c)]+'%');let _0x5ec2ff=_0x12a77b(0x150)+dbFileIndexTable[_0x12a77b(0x11f)]+_0x12a77b(0x178),_0x42d822=_0x1ebd87['app'][_0x12a77b(0x16f)][_0x12a77b(0x14b)](_0x5ec2ff)[_0x12a77b(0x118)](_0x547994,_0x547994+path[_0x12a77b(0x15c)]+'%'),_0x32c079=[];for(let _0x2b7dd6 of _0x42d822){movieInfoUtil[_0x12a77b(0x151)](_0x1ebd87[_0x12a77b(0x183)]['dbFileIndex'],_0x2b7dd6['id'],{}),_0x32c079[_0x12a77b(0x14f)](deleteMovieInfoOfIndex(_0x1ebd87,_0x2b7dd6));}Promise[_0x12a77b(0x17b)](_0x32c079)[_0x12a77b(0x12f)](_0xa4d279=>{const _0x109587=_0x12a77b;return process[_0x109587(0x134)]({'type':'SWITCH_MOVIE_INFO'}),_0x2103af[_0x109587(0x15b)]({'code':0x0});});});function deleteMovieInfoOfIndex(_0x4182da,_0x17eb6b){return new Promise((_0x435ada,_0x4e81b1)=>{const _0x57a93a=_0x1989;let _0x57c9ba=path[_0x57a93a(0x145)](_0x17eb6b[_0x57a93a(0x161)],_0x17eb6b[_0x57a93a(0x156)][_0x57a93a(0x184)](0x0,_0x17eb6b[_0x57a93a(0x156)][_0x57a93a(0x146)](_0x17eb6b[_0x57a93a(0x154)]))+_0x57a93a(0x119)),_0x4b5827=path[_0x57a93a(0x145)](_0x17eb6b[_0x57a93a(0x161)],_0x17eb6b[_0x57a93a(0x156)]['substring'](0x0,_0x17eb6b[_0x57a93a(0x156)][_0x57a93a(0x146)](_0x17eb6b['ext']))+_0x57a93a(0x15f)),_0x32dc2b=path['join'](_0x17eb6b[_0x57a93a(0x161)],_0x17eb6b['filename'][_0x57a93a(0x184)](0x0,_0x17eb6b[_0x57a93a(0x156)][_0x57a93a(0x146)](_0x17eb6b['ext']))+'-fanart.jpg'),_0x37b2dd=path[_0x57a93a(0x145)](_0x17eb6b[_0x57a93a(0x161)],_0x17eb6b['filename'][_0x57a93a(0x184)](0x0,_0x17eb6b[_0x57a93a(0x156)][_0x57a93a(0x146)](_0x17eb6b[_0x57a93a(0x154)]))+'-poster.jpg'),_0x488745=path[_0x57a93a(0x145)](_0x17eb6b[_0x57a93a(0x161)],_0x57a93a(0x17e)),_0x1c218a=path[_0x57a93a(0x145)](_0x17eb6b[_0x57a93a(0x161)],_0x17eb6b[_0x57a93a(0x156)]['substring'](0x0,_0x17eb6b[_0x57a93a(0x156)][_0x57a93a(0x146)](_0x17eb6b['ext']))+_0x57a93a(0x144)),_0x2a6226=[_0x57c9ba,_0x488745,_0x4b5827,_0x32dc2b,_0x37b2dd,_0x1c218a];if(_0x17eb6b[_0x57a93a(0x176)]==0x1){let _0x3b1701=path[_0x57a93a(0x145)](_0x17eb6b[_0x57a93a(0x161)],'tvshow.nfo'),_0x3140b4=path[_0x57a93a(0x145)](_0x17eb6b['path'],'season.nfo');_0x2a6226['push'](_0x3b1701),_0x2a6226['push'](_0x3140b4);let _0x1e0337=path[_0x57a93a(0x13f)](_0x17eb6b[_0x57a93a(0x161)]),_0x3b44c2=path['dirname'](_0x17eb6b[_0x57a93a(0x161)]),_0x82379d=movieSeasonUtil['getSeasonNumber'](_0x1e0337);if(_0x82379d>0x0){let _0x51ae2e=path[_0x57a93a(0x145)](_0x3b44c2,_0x57a93a(0x15a));_0x2a6226['push'](_0x51ae2e);_0x82379d<0xa&&(_0x82379d='0'+_0x82379d);let _0x59f14a=path[_0x57a93a(0x145)](_0x3b44c2,_0x57a93a(0x12d)+_0x82379d+_0x57a93a(0x169));_0x2a6226[_0x57a93a(0x14f)](_0x59f14a);let _0xcbef9c=path[_0x57a93a(0x145)](_0x3b44c2,_0x57a93a(0x17e));_0x2a6226[_0x57a93a(0x14f)](_0xcbef9c);let _0x1b3be1=path[_0x57a93a(0x145)](_0x3b44c2,_0x57a93a(0x14a));_0x2a6226[_0x57a93a(0x14f)](_0x1b3be1);}}console[_0x57a93a(0x110)](_0x57a93a(0x142),_0x2a6226);function _0x4efb06(){const _0x571563=_0x57a93a;_0x2a6226['length']>0x0?fs['stat'](_0x2a6226[0x0],(_0x2d08f3,_0x1f2e16)=>{const _0x1a2242=_0x1989;!_0x2d08f3&&_0x1f2e16&&_0x1f2e16['isFile']()?(console['log']('清理',_0x2a6226[0x0]),fs['rm'](_0x2a6226[0x0],_0x330896=>{const _0x15e26a=_0x1989;let _0x3b516d=_0x2a6226[0x0];_0x2a6226[_0x15e26a(0x17f)](0x0,0x1),!_0x330896&&(console[_0x15e26a(0x110)]('刮削文件清理成功',_0x3b516d),dbFileOperationRecord['addFileOperationRecord'](_0x4182da[_0x15e26a(0x183)][_0x15e26a(0x114)],{'username':_0x4182da['currentUser'][_0x15e26a(0x16c)],'targetPath':_0x3b516d,'level':dbFileOperationRecord[_0x15e26a(0x111)],'type':dbFileOperationRecord[_0x15e26a(0x15d)],'state':dbFileOperationRecord[_0x15e26a(0x11e)]})),_0x4efb06();})):(_0x2a6226[_0x1a2242(0x17f)](0x0,0x1),_0x4efb06());}):(movieInfoUtil[_0x571563(0x151)](_0x4182da[_0x571563(0x183)][_0x571563(0x16f)],_0x17eb6b['id'],{}),_0x435ada());}_0x4efb06();});}function clearInfo(_0x58b526,_0x497933,_0x49e1d2){return new Promise((_0x35eea5,_0x359d86)=>{const _0x5a362d=_0x1989;if(dbUserTable[_0x5a362d(0x168)](_0x58b526,_0x497933,'','power_delete',_0x49e1d2[_0x5a362d(0x161)])==!![]){if(_0x49e1d2[_0x5a362d(0x176)]==0x1){let _0x2e58bb=_0x5a362d(0x150)+dbFileIndexTable[_0x5a362d(0x11f)]+'\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20',_0x40ae9a=_0x58b526[_0x5a362d(0x183)]['dbFileIndex'][_0x5a362d(0x14b)](_0x2e58bb)[_0x5a362d(0x118)](_0x49e1d2[_0x5a362d(0x161)]),_0x3d49ae=[];for(let _0x47990f of _0x40ae9a){_0x3d49ae[_0x5a362d(0x14f)](deleteMovieInfoOfIndex(_0x58b526,_0x47990f));}if(_0x3d49ae[_0x5a362d(0x15e)]<0x1)return _0x35eea5();Promise[_0x5a362d(0x17b)](_0x3d49ae)['then'](_0x3b5e10=>{return _0x35eea5();})[_0x5a362d(0x123)](_0x2c36bd=>{return _0x35eea5();});}else deleteMovieInfoOfIndex(_0x58b526,_0x49e1d2)[_0x5a362d(0x12f)](_0x2f921e=>{return _0x35eea5();});}});}router[_0x5a71f7(0x172)](_0x5a71f7(0x17a),(_0x42af4d,_0x2bf734,_0x203df9)=>{const _0x3c6211=_0x5a71f7;let _0x47c0a1=_0x42af4d['body'][_0x3c6211(0x122)],_0x3df82d=dbFileIndexTable[_0x3c6211(0x167)](_0x42af4d['app']['dbFileIndex'],_0x47c0a1,dbFileIndexTable[_0x3c6211(0x11f)]);if(!_0x3df82d)return _0x42af4d[_0x3c6211(0x183)]['returnErrMsg'](_0x2bf734,'indexId\x20error');clearInfo(_0x42af4d,_0x2bf734,_0x3df82d)[_0x3c6211(0x12f)](()=>{const _0x24f4f9=_0x3c6211;return _0x2bf734[_0x24f4f9(0x15b)]({'code':0x0});});}),router[_0x5a71f7(0x172)](_0x5a71f7(0x177),(_0x33a456,_0x31182e,_0x4e8785)=>{const _0x341c30=_0x5a71f7;let _0x2e37da=_0x33a456[_0x341c30(0x174)][_0x341c30(0x122)],_0x4664da=dbFileIndexTable[_0x341c30(0x167)](_0x33a456[_0x341c30(0x183)][_0x341c30(0x16f)],_0x2e37da,dbFileIndexTable[_0x341c30(0x11f)]),_0x4a7bc2=_0x33a456[_0x341c30(0x174)][_0x341c30(0x12e)];if(!_0x4664da||!_0x4a7bc2)return _0x33a456[_0x341c30(0x183)]['returnErrMsg'](_0x31182e,_0x341c30(0x171));dbUserTable['doUserCanGet'](_0x33a456,_0x31182e,'',_0x341c30(0x112),_0x4664da[_0x341c30(0x161)])==!![]&&clearInfo(_0x33a456,_0x31182e,_0x4664da)[_0x341c30(0x12f)](()=>{const _0x29b175=_0x341c30;return movieInfoUtil['runSearchNfoWorker'](_0x33a456[_0x29b175(0x183)][_0x29b175(0x114)],_0x4664da[_0x29b175(0x161)],_0x4664da[_0x29b175(0x156)],_0x4664da[_0x29b175(0x176)],_0x4a7bc2)[_0x29b175(0x12f)](()=>{const _0x22fc86=_0x29b175;if(_0x4664da[_0x22fc86(0x176)]==0x0)updateIndexByNfo(_0x33a456[_0x22fc86(0x183)][_0x22fc86(0x16f)],_0x4664da)['then'](()=>{});else{}})[_0x29b175(0x123)](_0x4fc434=>{const _0x5ba0b1=_0x29b175;return console[_0x5ba0b1(0x110)](_0x4fc434),_0x33a456[_0x5ba0b1(0x183)][_0x5ba0b1(0x11c)](_0x31182e,_0x31182e['__'](_0x5ba0b1(0x116)));}),_0x31182e[_0x29b175(0x15b)]({'code':0x0});});}),router[_0x5a71f7(0x136)](_0x5a71f7(0x10d),(_0x2af1c4,_0x251e44,_0x4c71ea)=>{const _0x27ceaa=_0x5a71f7;let _0x22f3ad=_0x2af1c4['query'][_0x27ceaa(0x106)];if(!_0x22f3ad||!_0x22f3ad[_0x27ceaa(0x158)](_0x27ceaa(0x135))==-0x1)return _0x251e44[_0x27ceaa(0x166)](0x194)[_0x27ceaa(0x10b)]();_0x22f3ad=decodeURIComponent(_0x22f3ad);let _0x19f52d=path['join'](config[_0x27ceaa(0x108)],sha256(_0x22f3ad));function _0x5b7f58(){const _0x155e23=_0x27ceaa;sharp(_0x19f52d,{'failOnError':![]})[_0x155e23(0x170)]({'quality':0x4d})[_0x155e23(0x16e)]({'width':0x1f4})[_0x155e23(0x153)]()[_0x155e23(0x12f)](_0x3ca054=>{const _0x351e31=_0x155e23;return _0x251e44[_0x351e31(0x134)](_0x3ca054);})[_0x155e23(0x123)](_0x1898a7=>{const _0x22e94d=_0x155e23;return console[_0x22e94d(0x110)](_0x22e94d(0x11a),_0x1898a7),_0x251e44['status'](0x194)[_0x22e94d(0x10b)]();});}fs[_0x27ceaa(0x107)](_0x19f52d,(_0x16ae0a,_0x10ad36)=>{const _0x106dc9=_0x27ceaa;if(!_0x16ae0a)return _0x5b7f58();_0x2af1c4[_0x106dc9(0x121)]['noCache']==0x1?httpUtil['downloadImg'](_0x2af1c4['app'][_0x106dc9(0x114)],_0x22f3ad)['then'](_0x313ceb=>{const _0x2ed2a0=_0x106dc9;return _0x313ceb[_0x2ed2a0(0x109)](_0x251e44);})[_0x106dc9(0x123)](_0x30e98b=>{const _0x5a85bd=_0x106dc9;return _0x251e44[_0x5a85bd(0x166)](0x194)[_0x5a85bd(0x10b)]();}):httpUtil[_0x106dc9(0x14d)](_0x2af1c4[_0x106dc9(0x183)][_0x106dc9(0x114)],_0x22f3ad,_0x19f52d)['then'](_0x2c6986=>{_0x5b7f58();})['catch'](_0xabbfd5=>{const _0x53a592=_0x106dc9;return _0x251e44[_0x53a592(0x166)](0x194)[_0x53a592(0x10b)]();});});}),module['exports']=router;