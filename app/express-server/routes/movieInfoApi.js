const _0x4bd5dc=_0x27ed;function _0x4783(){const _0x402c9e=['filename','allSettled','params\x20error','/testTmdb','runSearchNfoWorker','1028531AbGzFl','27795vkJKsN','indexOf','catch','then','toBuffer','search','searchStr','downloadImg','run','doUserCanGet','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','../../utils/httpUtil','../../utils/movieInfoTmdbApi','saveMovieInfoToDb','tvshow.nfo','indexId','currentUser','poster.jpg','languageList','.jpg','success','../../myConfig/config','status_code','getSeasonNumber','post','-thumb.jpg','/scrapeAgain','exports','json','movieTmdbApiKey','dirname','TYPE_DELETE','end','/getImdbImg','movieTmdbApiUrl','SELECT\x20*\x20FROM\x20','count','getProxyUrl','刮削文件清理成功','280NasdWO','../../utils/nfoUtil','/getScrapeLog','jpeg','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','log','SWITCH_MOVIE_INFO','TMDBID','body','/clearNfoImg','dbOther','join','../../utils/movieInfoUtil','message','getTmdbApi','parseNfo','status_message','KEYWORD','send','axios','username','movieTmdbLanguage','pipe','path','.nfo','要清除的nfo和海报文件列表','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','-poster.jpg','substring','is_tvplay','Need\x20tmdb\x20language','sourceFolder','79717JvBZRW','LEVEL_MAIN_OPERATION','url','testTmdb','getById','TMDB\x20search接口请求失败','9sFkXGt','indexId\x20error','Router','API','ext','resize','sharp','1478744TaEnlf','season.nfo','prepare','/clearMovieInfo','Need\x20tmdb\x20api\x20url','push','headersSent','is_admin','season','isFile','get','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','sep','-fanart.jpg','need\x20folder','6wPxqRm','app','12tdulXV','INDEX_TABLE_NAME_MOVIE','/setMovieInfo','dbFileIndex','../../utils/movieSeasonUtil','../../db/dbFileIndexTable','/testTmdbProxy','lastIndexOf','splice','returnErrMsg','7863Pxruzd','stat','Need\x20tmdb\x20key','status','2927500MFjoGm','all','tmdbId','844DhpRLZ','offset','20MPiSTS','length','posterPath'];_0x4783=function(){return _0x402c9e;};return _0x4783();}(function(_0x40daa7,_0x5194a1){const _0x1ec0ae=_0x27ed,_0x3d6dbf=_0x40daa7();while(!![]){try{const _0xf5002=-parseInt(_0x1ec0ae(0xe5))/0x1*(parseInt(_0x1ec0ae(0xe7))/0x2)+-parseInt(_0x1ec0ae(0xde))/0x3*(parseInt(_0x1ec0ae(0x96))/0x4)+parseInt(_0x1ec0ae(0x6f))/0x5+parseInt(_0x1ec0ae(0xd2))/0x6*(-parseInt(_0x1ec0ae(0xef))/0x7)+parseInt(_0x1ec0ae(0xc3))/0x8*(parseInt(_0x1ec0ae(0xbc))/0x9)+parseInt(_0x1ec0ae(0xe2))/0xa+parseInt(_0x1ec0ae(0xb6))/0xb*(parseInt(_0x1ec0ae(0xd4))/0xc);if(_0xf5002===_0x5194a1)break;else _0x3d6dbf['push'](_0x3d6dbf['shift']());}catch(_0x42b0fa){_0x3d6dbf['push'](_0x3d6dbf['shift']());}}}(_0x4783,0x25004));var express=require('express'),router=express[_0x4bd5dc(0xbe)]();const fs=require('fs'),sharp=require(_0x4bd5dc(0xc2)),axios=require(_0x4bd5dc(0xa9));let sha256=require('sha256'),path=require(_0x4bd5dc(0xad)),config=require(_0x4bd5dc(0x84));const tmdbApi=require(_0x4bd5dc(0x7b)),movieInfoUtil=require(_0x4bd5dc(0xa2)),movieSeasonUtil=require(_0x4bd5dc(0xd8)),dbFileIndexTable=require(_0x4bd5dc(0xd9)),dbUserTable=require('../../db/dbUserTable'),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),nfoUtil=require(_0x4bd5dc(0x97)),httpUtil=require(_0x4bd5dc(0x7a));router[_0x4bd5dc(0x87)](_0x4bd5dc(0xed),(_0x27dd45,_0x97f5d7,_0x43e526)=>{const _0x3eade3=_0x4bd5dc;if(_0x27dd45['currentUser'][_0x3eade3(0xca)]!=0x1)return _0x97f5d7[_0x3eade3(0x8b)]({'code':0x66});let _0x46264f=_0x27dd45[_0x3eade3(0x9e)][_0x3eade3(0xab)],_0x2182ca=_0x27dd45[_0x3eade3(0x9e)][_0x3eade3(0x91)],_0xabdfb3=_0x27dd45['body'][_0x3eade3(0x8c)];if(!_0x46264f)return _0x27dd45['app'][_0x3eade3(0xdd)](_0x97f5d7,_0x3eade3(0xb4));if(!_0x2182ca)return _0x27dd45[_0x3eade3(0xd3)][_0x3eade3(0xdd)](_0x97f5d7,_0x3eade3(0xc7));if(!_0xabdfb3)return _0x27dd45[_0x3eade3(0xd3)]['returnErrMsg'](_0x97f5d7,_0x3eade3(0xe0));let _0x33453c=movieInfoUtil[_0x3eade3(0x94)](_0x27dd45[_0x3eade3(0xd3)][_0x3eade3(0xa0)]),_0x2114f7=new tmdbApi[(_0x3eade3(0xbf))](_0xabdfb3,_0x46264f,_0x2182ca,_0x33453c);_0x2114f7[_0x3eade3(0x81)]()[_0x3eade3(0x72)](_0x32e8b6=>{const _0x57dbfd=_0x3eade3;if(_0x32e8b6[_0x57dbfd(0x83)]==![]||_0x32e8b6[_0x57dbfd(0x85)])return _0x97f5d7[_0x57dbfd(0x8b)]({'code':0x2,'msg':_0x32e8b6[_0x57dbfd(0xa6)]});return _0x97f5d7[_0x57dbfd(0x8b)]({'code':0x0,'data':[]});})['catch'](_0x42a711=>{const _0x3a8ead=_0x3eade3;let _0x219fde='TMDB\x20Error';if(_0x42a711){if(_0x42a711[_0x3a8ead(0x85)])_0x219fde+=':'+_0x42a711[_0x3a8ead(0xa6)];else _0x42a711[_0x3a8ead(0xa3)]&&(_0x219fde+=':'+_0x42a711[_0x3a8ead(0xa3)]);}return _0x97f5d7[_0x3a8ead(0x8b)]({'code':0x2,'msg':_0x219fde,'data':[]});});}),router['post'](_0x4bd5dc(0xda),(_0x74abb5,_0x3b0df0,_0x365917)=>{const _0x2c7dcf=_0x4bd5dc;if(_0x74abb5[_0x2c7dcf(0x7f)][_0x2c7dcf(0xca)]!=0x1)return _0x3b0df0[_0x2c7dcf(0x8b)]({'code':0x66});movieInfoUtil[_0x2c7dcf(0xb9)](_0x74abb5[_0x2c7dcf(0xd3)][_0x2c7dcf(0xa0)])['then'](()=>{const _0x11aa75=_0x2c7dcf;return _0x3b0df0[_0x11aa75(0x8b)]({'code':0x0});})['catch'](_0x4585ed=>{const _0x52087b=_0x2c7dcf;return _0x3b0df0[_0x52087b(0x8b)]({'code':0x2,'msg':_0x4585ed});});}),router[_0x4bd5dc(0x87)]('/searchMovieInfo',(_0x382136,_0x557f21,_0x3d050f)=>{const _0x5dc1f8=_0x4bd5dc;let _0x1ab5be=_0x382136['body'][_0x5dc1f8(0x75)],_0x3eb9d6=_0x382136[_0x5dc1f8(0x9e)]['searchType'],_0x423282=_0x382136[_0x5dc1f8(0x9e)]['searchMediaType'],_0xa3a735=_0x382136[_0x5dc1f8(0x9e)]['page'];if(!_0x1ab5be||!_0x3eb9d6||!_0x423282)return _0x382136[_0x5dc1f8(0xd3)]['returnErrMsg'](_0x557f21,_0x5dc1f8(0xec));let _0x4458e5=movieInfoUtil[_0x5dc1f8(0xa4)](_0x382136['app'][_0x5dc1f8(0xa0)]);if(_0x3eb9d6==_0x5dc1f8(0xa7))_0x4458e5[_0x5dc1f8(0x74)](_0x1ab5be,_0x423282=='TV',null,_0xa3a735,!![])['then'](_0x2b21bd=>{const _0x53e783=_0x5dc1f8;if(!_0x557f21[_0x53e783(0xc9)])return _0x557f21[_0x53e783(0x8b)]({'code':0x0,'data':_0x2b21bd});})[_0x5dc1f8(0x71)](_0x46fc7d=>{const _0x50e740=_0x5dc1f8;console[_0x50e740(0x9b)](_0x50e740(0xbb),_0x46fc7d);if(_0x46fc7d&&_0x46fc7d[_0x50e740(0x85)]&&_0x46fc7d[_0x50e740(0xa6)])return _0x382136[_0x50e740(0xd3)]['returnErrMsg'](_0x557f21,_0x46fc7d['status_message']);if(!_0x557f21[_0x50e740(0xc9)])return _0x557f21['json']({'code':0x0,'data':[]});});else{if(_0x3eb9d6==_0x5dc1f8(0x9d))_0x4458e5['getDetail'](_0x1ab5be,_0x423282=='TV')[_0x5dc1f8(0x72)](_0x21b4f2=>{const _0xccf04e=_0x5dc1f8;if(!_0x557f21[_0xccf04e(0xc9)])return _0x557f21[_0xccf04e(0x8b)]({'code':0x0,'data':[_0x21b4f2]});})['catch'](_0x3b5ab2=>{const _0x4a6262=_0x5dc1f8;console[_0x4a6262(0x9b)](_0x4a6262(0xbb),_0x3b5ab2);if(_0x3b5ab2&&_0x3b5ab2[_0x4a6262(0x85)]&&_0x3b5ab2[_0x4a6262(0xa6)])return _0x382136['app'][_0x4a6262(0xdd)](_0x557f21,_0x3b5ab2[_0x4a6262(0xa6)]);if(!_0x557f21['headersSent'])return _0x557f21['json']({'code':0x0,'data':[]});});else{if(!_0x557f21[_0x5dc1f8(0xc9)])return _0x557f21[_0x5dc1f8(0x8b)]({'code':0x0,'data':[]});}}});function _0x27ed(_0x269022,_0x2ec0b9){const _0x478391=_0x4783();return _0x27ed=function(_0x27edad,_0x5f44f7){_0x27edad=_0x27edad-0x6f;let _0x51af22=_0x478391[_0x27edad];return _0x51af22;},_0x27ed(_0x269022,_0x2ec0b9);}function updateIndexByNfo(_0xb99b53,_0x1d1e8f){return new Promise((_0x3c85a9,_0x56dd5f)=>{const _0x2063be=_0x27ed;nfoUtil[_0x2063be(0xa5)](_0x1d1e8f,!![],![])[_0x2063be(0x72)](_0x4081f0=>{const _0x154e3c=_0x2063be;return movieInfoUtil[_0x154e3c(0x7c)](_0xb99b53,_0x1d1e8f['id'],_0x4081f0),_0x3c85a9();})['catch'](_0x2a9ef4=>{return _0x3c85a9();});});}router[_0x4bd5dc(0x87)](_0x4bd5dc(0x89),(_0x4f1c39,_0x3264c6,_0x16bc46)=>{const _0x17c3b3=_0x4bd5dc;let _0x220e6e=_0x4f1c39[_0x17c3b3(0x9e)][_0x17c3b3(0x7e)],_0x31a298=_0x4f1c39[_0x17c3b3(0x9e)]['scrapeMissing'],_0x4b3226=dbFileIndexTable[_0x17c3b3(0xba)](_0x4f1c39[_0x17c3b3(0xd3)][_0x17c3b3(0xd7)],_0x220e6e,dbFileIndexTable[_0x17c3b3(0xd5)]);if(!_0x4b3226)return _0x4f1c39[_0x17c3b3(0xd3)]['returnErrMsg'](_0x3264c6,'indexId\x20error');if(dbUserTable[_0x17c3b3(0x78)](_0x4f1c39,_0x3264c6,'','power_change',_0x4b3226['path'])==!![]){function _0x3a3fce(){const _0x3c4a4b=_0x17c3b3;movieInfoUtil[_0x3c4a4b(0xee)](_0x4f1c39[_0x3c4a4b(0xd3)][_0x3c4a4b(0xa0)],_0x4b3226[_0x3c4a4b(0xad)],_0x4b3226[_0x3c4a4b(0xea)],_0x4b3226['is_tvplay'],null,_0x31a298)[_0x3c4a4b(0x72)](()=>{const _0x2cb425=_0x3c4a4b;_0x4b3226['is_tvplay']==0x0&&updateIndexByNfo(_0x4f1c39[_0x2cb425(0xd3)]['dbFileIndex'],_0x4b3226)[_0x2cb425(0x72)](()=>{});})[_0x3c4a4b(0x71)](_0x38252b=>{});}_0x31a298==0x1?_0x3a3fce():clearInfo(_0x4f1c39,_0x3264c6,_0x4b3226)[_0x17c3b3(0x72)](()=>{_0x3a3fce();});if(!_0x3264c6[_0x17c3b3(0xc9)])return _0x3264c6[_0x17c3b3(0x8b)]({'code':0x0});}}),router[_0x4bd5dc(0x87)](_0x4bd5dc(0x98),(_0x16ea93,_0x58cc3f,_0x4b04f6)=>{const _0x719ff0=_0x4bd5dc;if(_0x16ea93[_0x719ff0(0x7f)][_0x719ff0(0xca)]!=0x1)return _0x58cc3f[_0x719ff0(0x8b)]({'code':0x66});let _0x588838=_0x16ea93['body'][_0x719ff0(0x93)]||0x1e,_0xf2bb04=_0x16ea93[_0x719ff0(0x9e)][_0x719ff0(0xe6)]||0x0;const _0x25200a=_0x719ff0(0xb0);let _0x5a6f43=_0x16ea93[_0x719ff0(0xd3)][_0x719ff0(0xd7)]['prepare'](_0x25200a)['all'](_0x588838,_0xf2bb04);return _0x58cc3f[_0x719ff0(0x8b)]({'code':0x0,'data':_0x5a6f43});}),router['post']('/clearScrapeLog',(_0x2aa7c5,_0x3f6bf0,_0x5c83a8)=>{const _0x3ae744=_0x4bd5dc;if(_0x2aa7c5[_0x3ae744(0x7f)][_0x3ae744(0xca)]!=0x1)return _0x3f6bf0['json']({'code':0x66});const _0x3fd399=_0x3ae744(0xce);return _0x2aa7c5[_0x3ae744(0xd3)][_0x3ae744(0xd7)][_0x3ae744(0xc5)](_0x3fd399)[_0x3ae744(0x77)](),_0x3f6bf0[_0x3ae744(0x8b)]({'code':0x0});}),router['post'](_0x4bd5dc(0x9f),(_0x303128,_0x1ec93e,_0x5d325c)=>{const _0x35a42c=_0x4bd5dc;if(_0x303128[_0x35a42c(0x7f)][_0x35a42c(0xca)]!=0x1)return _0x1ec93e[_0x35a42c(0x8b)]({'code':0x66});let _0x1e050c=_0x303128[_0x35a42c(0x9e)][_0x35a42c(0xb5)];if(!_0x1e050c)return _0x303128[_0x35a42c(0xd3)][_0x35a42c(0xdd)](_0x1ec93e,_0x35a42c(0xd1));const _0x2f88da='UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?';_0x303128['app'][_0x35a42c(0xd7)][_0x35a42c(0xc5)](_0x2f88da)[_0x35a42c(0x77)](_0x1e050c,_0x1e050c+path[_0x35a42c(0xcf)]+'%');let _0x347bc6=_0x35a42c(0x92)+dbFileIndexTable[_0x35a42c(0xd5)]+_0x35a42c(0x9a),_0x4b2972=_0x303128[_0x35a42c(0xd3)]['dbFileIndex'][_0x35a42c(0xc5)](_0x347bc6)[_0x35a42c(0xe3)](_0x1e050c,_0x1e050c+path['sep']+'%'),_0x3744a5=[];for(let _0x116af2 of _0x4b2972){movieInfoUtil[_0x35a42c(0x7c)](_0x303128[_0x35a42c(0xd3)][_0x35a42c(0xd7)],_0x116af2['id'],{}),_0x3744a5['push'](deleteMovieInfoOfIndex(_0x303128,_0x116af2));}Promise[_0x35a42c(0xeb)](_0x3744a5)[_0x35a42c(0x72)](_0x4c7071=>{const _0x243c81=_0x35a42c;return process[_0x243c81(0xa8)]({'type':_0x243c81(0x9c)}),_0x1ec93e['json']({'code':0x0});});});function deleteMovieInfoOfIndex(_0x515d41,_0x37b549){return new Promise((_0xb5da92,_0x4c0764)=>{const _0x23babd=_0x27ed;let _0x32f5e3=path['join'](_0x37b549[_0x23babd(0xad)],_0x37b549[_0x23babd(0xea)][_0x23babd(0xb2)](0x0,_0x37b549['filename'][_0x23babd(0xdb)](_0x37b549[_0x23babd(0xc0)]))+_0x23babd(0x82)),_0xc2353f=path[_0x23babd(0xa1)](_0x37b549['path'],_0x37b549[_0x23babd(0xea)]['substring'](0x0,_0x37b549['filename'][_0x23babd(0xdb)](_0x37b549['ext']))+_0x23babd(0x88)),_0x20c51e=path[_0x23babd(0xa1)](_0x37b549[_0x23babd(0xad)],_0x37b549[_0x23babd(0xea)][_0x23babd(0xb2)](0x0,_0x37b549[_0x23babd(0xea)][_0x23babd(0xdb)](_0x37b549[_0x23babd(0xc0)]))+_0x23babd(0xd0)),_0x5db8b5=path['join'](_0x37b549[_0x23babd(0xad)],_0x37b549[_0x23babd(0xea)]['substring'](0x0,_0x37b549[_0x23babd(0xea)][_0x23babd(0xdb)](_0x37b549['ext']))+_0x23babd(0xb1)),_0x5966f3=path[_0x23babd(0xa1)](_0x37b549['path'],_0x23babd(0x80)),_0x5a245f=path[_0x23babd(0xa1)](_0x37b549[_0x23babd(0xad)],_0x37b549[_0x23babd(0xea)][_0x23babd(0xb2)](0x0,_0x37b549[_0x23babd(0xea)][_0x23babd(0xdb)](_0x37b549[_0x23babd(0xc0)]))+_0x23babd(0xae)),_0x4c05ff=[_0x32f5e3,_0x5966f3,_0xc2353f,_0x20c51e,_0x5db8b5,_0x5a245f];if(_0x37b549[_0x23babd(0xb3)]==0x1){let _0x4ccca3=path['join'](_0x37b549[_0x23babd(0xad)],_0x23babd(0x7d)),_0x236750=path[_0x23babd(0xa1)](_0x37b549[_0x23babd(0xad)],_0x23babd(0xc4));_0x4c05ff['push'](_0x4ccca3),_0x4c05ff['push'](_0x236750);let _0x3f2059=path['basename'](_0x37b549['path']),_0x573851=path[_0x23babd(0x8d)](_0x37b549[_0x23babd(0xad)]),_0x11abe0=movieSeasonUtil[_0x23babd(0x86)](_0x3f2059);if(_0x11abe0>0x0){let _0xd0b650=path['join'](_0x573851,_0x23babd(0x7d));_0x4c05ff[_0x23babd(0xc8)](_0xd0b650);_0x11abe0<0xa&&(_0x11abe0='0'+_0x11abe0);let _0x266993=path[_0x23babd(0xa1)](_0x573851,_0x23babd(0xcb)+_0x11abe0+'-poster.jpg');_0x4c05ff[_0x23babd(0xc8)](_0x266993);let _0x3399b4=path[_0x23babd(0xa1)](_0x573851,'poster.jpg');_0x4c05ff[_0x23babd(0xc8)](_0x3399b4);let _0x311b27=path[_0x23babd(0xa1)](_0x573851,'fanart.jpg');_0x4c05ff['push'](_0x311b27);}}console['log'](_0x23babd(0xaf),_0x4c05ff);function _0x3d41ef(){const _0xe03c45=_0x23babd;_0x4c05ff[_0xe03c45(0xe8)]>0x0?fs[_0xe03c45(0xdf)](_0x4c05ff[0x0],(_0x29560a,_0x98094a)=>{const _0x4840b6=_0xe03c45;!_0x29560a&&_0x98094a&&_0x98094a[_0x4840b6(0xcc)]()?(console[_0x4840b6(0x9b)]('清理',_0x4c05ff[0x0]),fs['rm'](_0x4c05ff[0x0],_0x5ed334=>{const _0x17117e=_0x4840b6;let _0x3a9fbd=_0x4c05ff[0x0];_0x4c05ff['splice'](0x0,0x1),!_0x5ed334&&(console[_0x17117e(0x9b)](_0x17117e(0x95),_0x3a9fbd),dbFileOperationRecord['addFileOperationRecord'](_0x515d41['app'][_0x17117e(0xa0)],{'username':_0x515d41[_0x17117e(0x7f)][_0x17117e(0xaa)],'targetPath':_0x3a9fbd,'level':dbFileOperationRecord[_0x17117e(0xb7)],'type':dbFileOperationRecord[_0x17117e(0x8e)],'state':dbFileOperationRecord['STATE_SUC']})),_0x3d41ef();})):(_0x4c05ff[_0x4840b6(0xdc)](0x0,0x1),_0x3d41ef());}):(movieInfoUtil[_0xe03c45(0x7c)](_0x515d41[_0xe03c45(0xd3)]['dbFileIndex'],_0x37b549['id'],{}),_0xb5da92());}_0x3d41ef();});}function clearInfo(_0x3c7611,_0x2bc68d,_0xc24ee){return new Promise((_0x4e86a5,_0x1fee47)=>{const _0x3a2f3f=_0x27ed;if(dbUserTable[_0x3a2f3f(0x78)](_0x3c7611,_0x2bc68d,'','power_delete',_0xc24ee['path'])==!![]){if(_0xc24ee['is_tvplay']==0x1){let _0x479c35=_0x3a2f3f(0x92)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x3a2f3f(0x79),_0x1ce355=_0x3c7611[_0x3a2f3f(0xd3)][_0x3a2f3f(0xd7)][_0x3a2f3f(0xc5)](_0x479c35)[_0x3a2f3f(0xe3)](_0xc24ee[_0x3a2f3f(0xad)]),_0x3c3aaf=[];for(let _0x6a9feb of _0x1ce355){_0x3c3aaf[_0x3a2f3f(0xc8)](deleteMovieInfoOfIndex(_0x3c7611,_0x6a9feb));}if(_0x3c3aaf[_0x3a2f3f(0xe8)]<0x1)return _0x4e86a5();Promise[_0x3a2f3f(0xeb)](_0x3c3aaf)['then'](_0x290157=>{return _0x4e86a5();})['catch'](_0x1bfa4c=>{return _0x4e86a5();});}else deleteMovieInfoOfIndex(_0x3c7611,_0xc24ee)[_0x3a2f3f(0x72)](_0x256059=>{return _0x4e86a5();});}});}router['post'](_0x4bd5dc(0xc6),(_0x3f86c5,_0x352632,_0x54c488)=>{const _0x14541a=_0x4bd5dc;let _0x4fff33=_0x3f86c5[_0x14541a(0x9e)][_0x14541a(0x7e)],_0x5b6393=dbFileIndexTable['getById'](_0x3f86c5[_0x14541a(0xd3)]['dbFileIndex'],_0x4fff33,dbFileIndexTable[_0x14541a(0xd5)]);if(!_0x5b6393)return _0x3f86c5['app'][_0x14541a(0xdd)](_0x352632,_0x14541a(0xbd));clearInfo(_0x3f86c5,_0x352632,_0x5b6393)[_0x14541a(0x72)](()=>{const _0x1f9cdb=_0x14541a;return _0x352632[_0x1f9cdb(0x8b)]({'code':0x0});});}),router[_0x4bd5dc(0x87)](_0x4bd5dc(0xd6),(_0x324bd8,_0x56b9fa,_0x8a1d84)=>{const _0x1f8dcb=_0x4bd5dc;let _0x1e5272=_0x324bd8[_0x1f8dcb(0x9e)]['indexId'],_0x2187b9=dbFileIndexTable[_0x1f8dcb(0xba)](_0x324bd8[_0x1f8dcb(0xd3)][_0x1f8dcb(0xd7)],_0x1e5272,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x36b2c1=_0x324bd8[_0x1f8dcb(0x9e)][_0x1f8dcb(0xe4)];if(!_0x2187b9||!_0x36b2c1)return _0x324bd8['app']['returnErrMsg'](_0x56b9fa,'indexId/tmdbId\x20error');dbUserTable[_0x1f8dcb(0x78)](_0x324bd8,_0x56b9fa,'','power_change',_0x2187b9[_0x1f8dcb(0xad)])==!![]&&clearInfo(_0x324bd8,_0x56b9fa,_0x2187b9)[_0x1f8dcb(0x72)](()=>{const _0x23959d=_0x1f8dcb;return movieInfoUtil['runSearchNfoWorker'](_0x324bd8[_0x23959d(0xd3)][_0x23959d(0xa0)],_0x2187b9[_0x23959d(0xad)],_0x2187b9[_0x23959d(0xea)],_0x2187b9[_0x23959d(0xb3)],_0x36b2c1)['then'](()=>{const _0x3cb131=_0x23959d;if(_0x2187b9[_0x3cb131(0xb3)]==0x0)updateIndexByNfo(_0x324bd8[_0x3cb131(0xd3)][_0x3cb131(0xd7)],_0x2187b9)[_0x3cb131(0x72)](()=>{});else{}})[_0x23959d(0x71)](_0x2d2018=>{const _0x387906=_0x23959d;return console[_0x387906(0x9b)](_0x2d2018),_0x324bd8[_0x387906(0xd3)][_0x387906(0xdd)](_0x56b9fa,_0x56b9fa['__']('operationFail'));}),_0x56b9fa[_0x23959d(0x8b)]({'code':0x0});});}),router[_0x4bd5dc(0xcd)](_0x4bd5dc(0x90),(_0x2dccd1,_0x27f423,_0x619417)=>{const _0x5cbcf7=_0x4bd5dc;let _0x42dc4a=_0x2dccd1['query'][_0x5cbcf7(0xb8)];if(!_0x42dc4a||!_0x42dc4a[_0x5cbcf7(0x70)]('tmdb')==-0x1)return _0x27f423[_0x5cbcf7(0xe1)](0x194)[_0x5cbcf7(0x8f)]();_0x42dc4a=decodeURIComponent(_0x42dc4a);let _0x5b77f6=path['join'](config[_0x5cbcf7(0xe9)],sha256(_0x42dc4a));function _0x4afc49(){const _0x13ea3c=_0x5cbcf7;sharp(_0x5b77f6,{'failOnError':![]})[_0x13ea3c(0x99)]({'quality':0x4d})[_0x13ea3c(0xc1)]({'width':0x1f4})[_0x13ea3c(0x73)]()['then'](_0x468c0b=>{return _0x27f423['send'](_0x468c0b);})[_0x13ea3c(0x71)](_0x999a71=>{const _0x1bf97d=_0x13ea3c;return console['log']('err1',_0x999a71),_0x27f423[_0x1bf97d(0xe1)](0x194)[_0x1bf97d(0x8f)]();});}fs[_0x5cbcf7(0xdf)](_0x5b77f6,(_0x2ef68d,_0x30c0f1)=>{const _0x14cbce=_0x5cbcf7;if(!_0x2ef68d)return _0x4afc49();_0x2dccd1['query']['noCache']==0x1?httpUtil[_0x14cbce(0x76)](_0x2dccd1[_0x14cbce(0xd3)][_0x14cbce(0xa0)],_0x42dc4a)[_0x14cbce(0x72)](_0x5f3473=>{const _0x357a04=_0x14cbce;return _0x5f3473[_0x357a04(0xac)](_0x27f423);})[_0x14cbce(0x71)](_0x3d7836=>{const _0x316671=_0x14cbce;return _0x27f423[_0x316671(0xe1)](0x194)[_0x316671(0x8f)]();}):httpUtil['downloadImg'](_0x2dccd1[_0x14cbce(0xd3)]['dbOther'],_0x42dc4a,_0x5b77f6)[_0x14cbce(0x72)](_0x11bc47=>{_0x4afc49();})[_0x14cbce(0x71)](_0x1a0806=>{const _0x1a0092=_0x14cbce;return _0x27f423[_0x1a0092(0xe1)](0x194)[_0x1a0092(0x8f)]();});});}),module[_0x4bd5dc(0x8a)]=router;