const _0x3a45c7=_0x1b03;(function(_0x1c5fc2,_0x106677){const _0x3e48e9=_0x1b03,_0x5cb039=_0x1c5fc2();while(!![]){try{const _0x1b1513=-parseInt(_0x3e48e9(0x210))/0x1+-parseInt(_0x3e48e9(0x22a))/0x2+parseInt(_0x3e48e9(0x1f1))/0x3+-parseInt(_0x3e48e9(0x20a))/0x4+parseInt(_0x3e48e9(0x21f))/0x5+-parseInt(_0x3e48e9(0x24a))/0x6*(-parseInt(_0x3e48e9(0x225))/0x7)+-parseInt(_0x3e48e9(0x1eb))/0x8*(-parseInt(_0x3e48e9(0x1f0))/0x9);if(_0x1b1513===_0x106677)break;else _0x5cb039['push'](_0x5cb039['shift']());}catch(_0x3e6163){_0x5cb039['push'](_0x5cb039['shift']());}}}(_0x54a0,0x79096));function _0x54a0(){const _0x422663=['dbFileIndex','path','scrapeMissing','searchStr','headersSent','posterPath','movieTmdbApiKey','query','need\x20folder','API','searchMediaType','getDetail','sourceFolder','catch','basename','toBuffer','length','movieTmdbLanguage','filename','post','ext','resize','then','../../db/dbFileOperationRecord','24088yrsAFQ','noCache','要清除的nfo和海报文件列表','log','status','2439yALVZj','1247808YdlwpY','sha256','../../utils/movieSeasonUtil','/getScrapeLog','/testTmdbProxy','body','dirname','is_tvplay','/searchMovieInfo','indexId\x20error','exports','message','LEVEL_MAIN_OPERATION','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?','-poster.jpg','downloadImg','KEYWORD','searchType','run','indexOf','INDEX_TABLE_NAME_MOVIE','indexId','app','/getImdbImg','runSearchNfoWorker','3804732jZqYzR','../../utils/movieInfoTmdbApi','json','operationFail','TMDB\x20Error','testTmdb','868940OHgVPj','doUserCanGet','-thumb.jpg','power_change','prepare','Need\x20tmdb\x20api\x20url','SELECT\x20*\x20FROM\x20','push','dbOther','../../myConfig/config','allSettled','getById','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','is_admin','movieTmdbApiUrl','2606765kBsUEW','/testTmdb','/clearScrapeLog','TMDBID','getSeasonNumber','tmdb','7nPEThV','../../db/dbFileIndexTable','join','poster.jpg','jpeg','589862FcgoPk','all','count','-fanart.jpg','TYPE_DELETE','success','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?','/clearMovieInfo','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','currentUser','status_code','Router','../../utils/nfoUtil','splice','returnErrMsg','saveMovieInfoToDb','season.nfo','offset','status_message','tmdbId','parseNfo','send','languageList','end','getTmdbApi','stat','username','indexId/tmdbId\x20error','isFile','sep','lastIndexOf','substring','5145300SeJlaq'];_0x54a0=function(){return _0x422663;};return _0x54a0();}var express=require('express'),router=express[_0x3a45c7(0x235)]();const fs=require('fs'),sharp=require('sharp'),axios=require('axios');let sha256=require(_0x3a45c7(0x1f2)),path=require(_0x3a45c7(0x1d4)),config=require(_0x3a45c7(0x219));const tmdbApi=require(_0x3a45c7(0x20b)),movieInfoUtil=require('../../utils/movieInfoUtil'),movieSeasonUtil=require(_0x3a45c7(0x1f3)),dbFileIndexTable=require(_0x3a45c7(0x226)),dbUserTable=require('../../db/dbUserTable'),dbFileOperationRecord=require(_0x3a45c7(0x1ea)),nfoUtil=require(_0x3a45c7(0x236)),httpUtil=require('../../utils/httpUtil');function _0x1b03(_0xf399e2,_0x4321e1){const _0x54a08a=_0x54a0();return _0x1b03=function(_0x1b0322,_0x21a62e){_0x1b0322=_0x1b0322-0x1d3;let _0x51b86c=_0x54a08a[_0x1b0322];return _0x51b86c;},_0x1b03(_0xf399e2,_0x4321e1);}router[_0x3a45c7(0x1e6)](_0x3a45c7(0x220),(_0x1a0bf5,_0x4039e3,_0x38c48a)=>{const _0x4ce9d5=_0x3a45c7;if(_0x1a0bf5[_0x4ce9d5(0x233)][_0x4ce9d5(0x21d)]!=0x1)return _0x4039e3[_0x4ce9d5(0x20c)]({'code':0x66});let _0xa2aca9=_0x1a0bf5['body'][_0x4ce9d5(0x1e4)],_0x4adb14=_0x1a0bf5[_0x4ce9d5(0x1f6)][_0x4ce9d5(0x21e)],_0x3420f3=_0x1a0bf5[_0x4ce9d5(0x1f6)][_0x4ce9d5(0x1d9)];if(!_0xa2aca9)return _0x1a0bf5[_0x4ce9d5(0x207)]['returnErrMsg'](_0x4039e3,'Need\x20tmdb\x20language');if(!_0x4adb14)return _0x1a0bf5[_0x4ce9d5(0x207)]['returnErrMsg'](_0x4039e3,_0x4ce9d5(0x215));if(!_0x3420f3)return _0x1a0bf5[_0x4ce9d5(0x207)][_0x4ce9d5(0x238)](_0x4039e3,'Need\x20tmdb\x20key');let _0x4703c7=movieInfoUtil['getProxyUrl'](_0x1a0bf5[_0x4ce9d5(0x207)][_0x4ce9d5(0x218)]),_0x1577ba=new tmdbApi[(_0x4ce9d5(0x1dc))](_0x3420f3,_0xa2aca9,_0x4adb14,_0x4703c7);_0x1577ba[_0x4ce9d5(0x240)]()[_0x4ce9d5(0x1e9)](_0x186fdb=>{const _0x16cce1=_0x4ce9d5;if(_0x186fdb[_0x16cce1(0x22f)]==![]||_0x186fdb[_0x16cce1(0x234)])return _0x4039e3[_0x16cce1(0x20c)]({'code':0x2,'msg':_0x186fdb[_0x16cce1(0x23c)]});return _0x4039e3[_0x16cce1(0x20c)]({'code':0x0,'data':[]});})['catch'](_0xf07d30=>{const _0x451bef=_0x4ce9d5;let _0x896d32=_0x451bef(0x20e);if(_0xf07d30){if(_0xf07d30[_0x451bef(0x234)])_0x896d32+=':'+_0xf07d30[_0x451bef(0x23c)];else _0xf07d30[_0x451bef(0x1fc)]&&(_0x896d32+=':'+_0xf07d30[_0x451bef(0x1fc)]);}return _0x4039e3[_0x451bef(0x20c)]({'code':0x2,'msg':_0x896d32,'data':[]});});}),router[_0x3a45c7(0x1e6)](_0x3a45c7(0x1f5),(_0x1a8af2,_0x50bdb9,_0x14fbf6)=>{const _0x19b9f6=_0x3a45c7;if(_0x1a8af2['currentUser']['is_admin']!=0x1)return _0x50bdb9[_0x19b9f6(0x20c)]({'code':0x66});movieInfoUtil[_0x19b9f6(0x20f)](_0x1a8af2[_0x19b9f6(0x207)][_0x19b9f6(0x218)])['then'](()=>{return _0x50bdb9['json']({'code':0x0});})[_0x19b9f6(0x1e0)](_0x5086ce=>{const _0x4ecb41=_0x19b9f6;return _0x50bdb9[_0x4ecb41(0x20c)]({'code':0x2,'msg':_0x5086ce});});}),router[_0x3a45c7(0x1e6)](_0x3a45c7(0x1f9),(_0x212702,_0x3985c1,_0x3994e5)=>{const _0x45140a=_0x3a45c7;let _0x2126e1=_0x212702[_0x45140a(0x1f6)][_0x45140a(0x1d6)],_0x96344=_0x212702[_0x45140a(0x1f6)][_0x45140a(0x202)],_0x2de8db=_0x212702[_0x45140a(0x1f6)][_0x45140a(0x1dd)],_0x39d031=_0x212702[_0x45140a(0x1f6)]['page'];if(!_0x2126e1||!_0x96344||!_0x2de8db)return _0x212702[_0x45140a(0x207)][_0x45140a(0x238)](_0x3985c1,'params\x20error');let _0x2bf75e=movieInfoUtil[_0x45140a(0x242)](_0x212702[_0x45140a(0x207)][_0x45140a(0x218)]);if(_0x96344==_0x45140a(0x201))_0x2bf75e['search'](_0x2126e1,_0x2de8db=='TV',null,_0x39d031,!![])[_0x45140a(0x1e9)](_0x5793e7=>{const _0x3df07d=_0x45140a;if(!_0x3985c1[_0x3df07d(0x1d7)])return _0x3985c1[_0x3df07d(0x20c)]({'code':0x0,'data':_0x5793e7});})[_0x45140a(0x1e0)](_0x5a8293=>{const _0x33717b=_0x45140a;console['log']('TMDB\x20search接口请求失败',_0x5a8293);if(_0x5a8293&&_0x5a8293[_0x33717b(0x234)]&&_0x5a8293['status_message'])return _0x212702[_0x33717b(0x207)][_0x33717b(0x238)](_0x3985c1,_0x5a8293[_0x33717b(0x23c)]);if(!_0x3985c1[_0x33717b(0x1d7)])return _0x3985c1['json']({'code':0x0,'data':[]});});else{if(_0x96344==_0x45140a(0x222))_0x2bf75e[_0x45140a(0x1de)](_0x2126e1,_0x2de8db=='TV')[_0x45140a(0x1e9)](_0x5aa5ce=>{const _0x1c33ab=_0x45140a;if(!_0x3985c1[_0x1c33ab(0x1d7)])return _0x3985c1[_0x1c33ab(0x20c)]({'code':0x0,'data':[_0x5aa5ce]});})[_0x45140a(0x1e0)](_0x3cd13c=>{const _0x36deec=_0x45140a;console[_0x36deec(0x1ee)]('TMDB\x20search接口请求失败',_0x3cd13c);if(_0x3cd13c&&_0x3cd13c[_0x36deec(0x234)]&&_0x3cd13c['status_message'])return _0x212702['app'][_0x36deec(0x238)](_0x3985c1,_0x3cd13c[_0x36deec(0x23c)]);if(!_0x3985c1[_0x36deec(0x1d7)])return _0x3985c1[_0x36deec(0x20c)]({'code':0x0,'data':[]});});else{if(!_0x3985c1[_0x45140a(0x1d7)])return _0x3985c1[_0x45140a(0x20c)]({'code':0x0,'data':[]});}}});function updateIndexByNfo(_0x432484,_0x596ecb){return new Promise((_0x355583,_0x2d367c)=>{const _0x38dbc2=_0x1b03;nfoUtil[_0x38dbc2(0x23e)](_0x596ecb,!![],![])[_0x38dbc2(0x1e9)](_0xf607e=>{const _0x7b7e28=_0x38dbc2;return movieInfoUtil[_0x7b7e28(0x239)](_0x432484,_0x596ecb['id'],_0xf607e),_0x355583();})[_0x38dbc2(0x1e0)](_0x1714b4=>{return _0x355583();});});}router['post']('/scrapeAgain',(_0x213a50,_0x7c38ab,_0x5c0324)=>{const _0xaa1f67=_0x3a45c7;let _0x227d9d=_0x213a50['body'][_0xaa1f67(0x206)],_0x439bf5=_0x213a50[_0xaa1f67(0x1f6)][_0xaa1f67(0x1d5)],_0x23b5a7=dbFileIndexTable[_0xaa1f67(0x21b)](_0x213a50[_0xaa1f67(0x207)][_0xaa1f67(0x1d3)],_0x227d9d,dbFileIndexTable[_0xaa1f67(0x205)]);if(!_0x23b5a7)return _0x213a50[_0xaa1f67(0x207)][_0xaa1f67(0x238)](_0x7c38ab,_0xaa1f67(0x1fa));if(dbUserTable[_0xaa1f67(0x211)](_0x213a50,_0x7c38ab,'',_0xaa1f67(0x213),_0x23b5a7[_0xaa1f67(0x1d4)])==!![]){function _0x4538a8(){const _0x3d5be1=_0xaa1f67;movieInfoUtil[_0x3d5be1(0x209)](_0x213a50[_0x3d5be1(0x207)][_0x3d5be1(0x218)],_0x23b5a7[_0x3d5be1(0x1d4)],_0x23b5a7[_0x3d5be1(0x1e5)],_0x23b5a7[_0x3d5be1(0x1f8)],null,_0x439bf5)['then'](()=>{const _0x3c8f69=_0x3d5be1;_0x23b5a7[_0x3c8f69(0x1f8)]==0x0&&updateIndexByNfo(_0x213a50[_0x3c8f69(0x207)][_0x3c8f69(0x1d3)],_0x23b5a7)[_0x3c8f69(0x1e9)](()=>{});})[_0x3d5be1(0x1e0)](_0x3e92ef=>{});}_0x439bf5==0x1?_0x4538a8():clearInfo(_0x213a50,_0x7c38ab,_0x23b5a7)[_0xaa1f67(0x1e9)](()=>{_0x4538a8();});if(!_0x7c38ab['headersSent'])return _0x7c38ab['json']({'code':0x0});}}),router[_0x3a45c7(0x1e6)](_0x3a45c7(0x1f4),(_0x51241e,_0x24ff86,_0x264950)=>{const _0x491978=_0x3a45c7;if(_0x51241e[_0x491978(0x233)]['is_admin']!=0x1)return _0x24ff86[_0x491978(0x20c)]({'code':0x66});let _0x2ff0a4=_0x51241e[_0x491978(0x1f6)][_0x491978(0x22c)]||0x1e,_0x5dd3d1=_0x51241e[_0x491978(0x1f6)][_0x491978(0x23b)]||0x0;const _0x5c5934=_0x491978(0x232);let _0x44bb55=_0x51241e[_0x491978(0x207)][_0x491978(0x1d3)][_0x491978(0x214)](_0x5c5934)[_0x491978(0x22b)](_0x2ff0a4,_0x5dd3d1);return _0x24ff86[_0x491978(0x20c)]({'code':0x0,'data':_0x44bb55});}),router[_0x3a45c7(0x1e6)](_0x3a45c7(0x221),(_0x34f3e1,_0x353fcb,_0x40ec3d)=>{const _0x148d03=_0x3a45c7;if(_0x34f3e1['currentUser'][_0x148d03(0x21d)]!=0x1)return _0x353fcb[_0x148d03(0x20c)]({'code':0x66});const _0x4cc86e='DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1';return _0x34f3e1[_0x148d03(0x207)][_0x148d03(0x1d3)][_0x148d03(0x214)](_0x4cc86e)['run'](),_0x353fcb[_0x148d03(0x20c)]({'code':0x0});}),router[_0x3a45c7(0x1e6)]('/clearNfoImg',(_0x2f70a7,_0x5ebc80,_0x1880a6)=>{const _0x3d9231=_0x3a45c7;if(_0x2f70a7[_0x3d9231(0x233)]['is_admin']!=0x1)return _0x5ebc80[_0x3d9231(0x20c)]({'code':0x66});let _0x5e616b=_0x2f70a7['body'][_0x3d9231(0x1df)];if(!_0x5e616b)return _0x2f70a7[_0x3d9231(0x207)]['returnErrMsg'](_0x5ebc80,_0x3d9231(0x1db));const _0x28a7ab=_0x3d9231(0x230);_0x2f70a7['app'][_0x3d9231(0x1d3)][_0x3d9231(0x214)](_0x28a7ab)[_0x3d9231(0x203)](_0x5e616b,_0x5e616b+path[_0x3d9231(0x247)]+'%');let _0x4c4efd='SELECT\x20*\x20FROM\x20'+dbFileIndexTable[_0x3d9231(0x205)]+_0x3d9231(0x1fe),_0x36cb25=_0x2f70a7['app'][_0x3d9231(0x1d3)][_0x3d9231(0x214)](_0x4c4efd)[_0x3d9231(0x22b)](_0x5e616b,_0x5e616b+path[_0x3d9231(0x247)]+'%'),_0x18028b=[];for(let _0x368981 of _0x36cb25){movieInfoUtil[_0x3d9231(0x239)](_0x2f70a7[_0x3d9231(0x207)]['dbFileIndex'],_0x368981['id'],{}),_0x18028b['push'](deleteMovieInfoOfIndex(_0x2f70a7,_0x368981));}Promise[_0x3d9231(0x21a)](_0x18028b)[_0x3d9231(0x1e9)](_0x215cce=>{const _0x47c34d=_0x3d9231;return process[_0x47c34d(0x23f)]({'type':'SWITCH_MOVIE_INFO'}),_0x5ebc80[_0x47c34d(0x20c)]({'code':0x0});});});function deleteMovieInfoOfIndex(_0x3d607d,_0x891467){return new Promise((_0x4d3f12,_0x327c15)=>{const _0x5ab4ea=_0x1b03;let _0xd8ac05=path[_0x5ab4ea(0x227)](_0x891467[_0x5ab4ea(0x1d4)],_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x249)](0x0,_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x248)](_0x891467[_0x5ab4ea(0x1e7)]))+'.jpg'),_0x36f2f9=path['join'](_0x891467[_0x5ab4ea(0x1d4)],_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x249)](0x0,_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x248)](_0x891467[_0x5ab4ea(0x1e7)]))+_0x5ab4ea(0x212)),_0x3e95dd=path[_0x5ab4ea(0x227)](_0x891467['path'],_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x249)](0x0,_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x248)](_0x891467[_0x5ab4ea(0x1e7)]))+_0x5ab4ea(0x22d)),_0x442319=path['join'](_0x891467[_0x5ab4ea(0x1d4)],_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x249)](0x0,_0x891467[_0x5ab4ea(0x1e5)]['lastIndexOf'](_0x891467[_0x5ab4ea(0x1e7)]))+_0x5ab4ea(0x1ff)),_0x462c03=path['join'](_0x891467[_0x5ab4ea(0x1d4)],_0x5ab4ea(0x228)),_0x503411=path[_0x5ab4ea(0x227)](_0x891467['path'],_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x249)](0x0,_0x891467[_0x5ab4ea(0x1e5)][_0x5ab4ea(0x248)](_0x891467[_0x5ab4ea(0x1e7)]))+'.nfo'),_0x23144c=[_0xd8ac05,_0x462c03,_0x36f2f9,_0x3e95dd,_0x442319,_0x503411];if(_0x891467[_0x5ab4ea(0x1f8)]==0x1){let _0x113215=path[_0x5ab4ea(0x227)](_0x891467[_0x5ab4ea(0x1d4)],'tvshow.nfo'),_0x50f6ff=path['join'](_0x891467[_0x5ab4ea(0x1d4)],_0x5ab4ea(0x23a));_0x23144c[_0x5ab4ea(0x217)](_0x113215),_0x23144c[_0x5ab4ea(0x217)](_0x50f6ff);let _0x4cd4f4=path[_0x5ab4ea(0x1e1)](_0x891467[_0x5ab4ea(0x1d4)]),_0x5534af=path[_0x5ab4ea(0x1f7)](_0x891467[_0x5ab4ea(0x1d4)]),_0x8019fb=movieSeasonUtil[_0x5ab4ea(0x223)](_0x4cd4f4);if(_0x8019fb>0x0){let _0x2732f8=path[_0x5ab4ea(0x227)](_0x5534af,'tvshow.nfo');_0x23144c[_0x5ab4ea(0x217)](_0x2732f8);_0x8019fb<0xa&&(_0x8019fb='0'+_0x8019fb);let _0x23fc03=path[_0x5ab4ea(0x227)](_0x5534af,'season'+_0x8019fb+_0x5ab4ea(0x1ff));_0x23144c[_0x5ab4ea(0x217)](_0x23fc03);let _0x272718=path[_0x5ab4ea(0x227)](_0x5534af,_0x5ab4ea(0x228));_0x23144c[_0x5ab4ea(0x217)](_0x272718);let _0x5dd3ea=path[_0x5ab4ea(0x227)](_0x5534af,'fanart.jpg');_0x23144c[_0x5ab4ea(0x217)](_0x5dd3ea);}}console['log'](_0x5ab4ea(0x1ed),_0x23144c);function _0x287dfd(){const _0x20692f=_0x5ab4ea;_0x23144c['length']>0x0?fs[_0x20692f(0x243)](_0x23144c[0x0],(_0x468b99,_0x4ae375)=>{const _0x2fca17=_0x20692f;!_0x468b99&&_0x4ae375&&_0x4ae375[_0x2fca17(0x246)]()?(console[_0x2fca17(0x1ee)]('清理',_0x23144c[0x0]),fs['rm'](_0x23144c[0x0],_0x476af5=>{const _0x58ac8d=_0x2fca17;let _0x58be35=_0x23144c[0x0];_0x23144c['splice'](0x0,0x1),!_0x476af5&&(console[_0x58ac8d(0x1ee)]('刮削文件清理成功',_0x58be35),dbFileOperationRecord['addFileOperationRecord'](_0x3d607d[_0x58ac8d(0x207)][_0x58ac8d(0x218)],{'username':_0x3d607d[_0x58ac8d(0x233)][_0x58ac8d(0x244)],'targetPath':_0x58be35,'level':dbFileOperationRecord[_0x58ac8d(0x1fd)],'type':dbFileOperationRecord[_0x58ac8d(0x22e)],'state':dbFileOperationRecord['STATE_SUC']})),_0x287dfd();})):(_0x23144c[_0x2fca17(0x237)](0x0,0x1),_0x287dfd());}):(movieInfoUtil[_0x20692f(0x239)](_0x3d607d['app'][_0x20692f(0x1d3)],_0x891467['id'],{}),_0x4d3f12());}_0x287dfd();});}function clearInfo(_0x21e9af,_0x35ee3b,_0xf05458){return new Promise((_0x500e6b,_0x704393)=>{const _0xc37c70=_0x1b03;if(dbUserTable['doUserCanGet'](_0x21e9af,_0x35ee3b,'','power_delete',_0xf05458[_0xc37c70(0x1d4)])==!![]){if(_0xf05458['is_tvplay']==0x1){let _0x498a3d=_0xc37c70(0x216)+dbFileIndexTable[_0xc37c70(0x205)]+_0xc37c70(0x21c),_0x71e9bb=_0x21e9af[_0xc37c70(0x207)][_0xc37c70(0x1d3)][_0xc37c70(0x214)](_0x498a3d)[_0xc37c70(0x22b)](_0xf05458[_0xc37c70(0x1d4)]),_0x371e49=[];for(let _0x1d23c7 of _0x71e9bb){_0x371e49[_0xc37c70(0x217)](deleteMovieInfoOfIndex(_0x21e9af,_0x1d23c7));}if(_0x371e49[_0xc37c70(0x1e3)]<0x1)return _0x500e6b();Promise['allSettled'](_0x371e49)[_0xc37c70(0x1e9)](_0x469673=>{return _0x500e6b();})['catch'](_0x52c11a=>{return _0x500e6b();});}else deleteMovieInfoOfIndex(_0x21e9af,_0xf05458)[_0xc37c70(0x1e9)](_0x573172=>{return _0x500e6b();});}});}router[_0x3a45c7(0x1e6)](_0x3a45c7(0x231),(_0x35b447,_0x11e494,_0x545c8a)=>{const _0x1456b3=_0x3a45c7;let _0x5768f2=_0x35b447[_0x1456b3(0x1f6)][_0x1456b3(0x206)],_0x4965d8=dbFileIndexTable[_0x1456b3(0x21b)](_0x35b447['app'][_0x1456b3(0x1d3)],_0x5768f2,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x4965d8)return _0x35b447[_0x1456b3(0x207)][_0x1456b3(0x238)](_0x11e494,'indexId\x20error');clearInfo(_0x35b447,_0x11e494,_0x4965d8)[_0x1456b3(0x1e9)](()=>{const _0x75ac14=_0x1456b3;return _0x11e494[_0x75ac14(0x20c)]({'code':0x0});});}),router[_0x3a45c7(0x1e6)]('/setMovieInfo',(_0x3e15c7,_0x3d1778,_0x532bbb)=>{const _0x168dfb=_0x3a45c7;let _0x4e36ee=_0x3e15c7[_0x168dfb(0x1f6)]['indexId'],_0x2c7bf3=dbFileIndexTable['getById'](_0x3e15c7['app'][_0x168dfb(0x1d3)],_0x4e36ee,dbFileIndexTable[_0x168dfb(0x205)]),_0x485ba7=_0x3e15c7[_0x168dfb(0x1f6)][_0x168dfb(0x23d)];if(!_0x2c7bf3||!_0x485ba7)return _0x3e15c7[_0x168dfb(0x207)][_0x168dfb(0x238)](_0x3d1778,_0x168dfb(0x245));dbUserTable[_0x168dfb(0x211)](_0x3e15c7,_0x3d1778,'',_0x168dfb(0x213),_0x2c7bf3['path'])==!![]&&clearInfo(_0x3e15c7,_0x3d1778,_0x2c7bf3)[_0x168dfb(0x1e9)](()=>{const _0x361276=_0x168dfb;return movieInfoUtil[_0x361276(0x209)](_0x3e15c7['app'][_0x361276(0x218)],_0x2c7bf3[_0x361276(0x1d4)],_0x2c7bf3[_0x361276(0x1e5)],_0x2c7bf3[_0x361276(0x1f8)],_0x485ba7)[_0x361276(0x1e9)](()=>{const _0x216fa0=_0x361276;if(_0x2c7bf3[_0x216fa0(0x1f8)]==0x0)updateIndexByNfo(_0x3e15c7[_0x216fa0(0x207)]['dbFileIndex'],_0x2c7bf3)[_0x216fa0(0x1e9)](()=>{});else{}})[_0x361276(0x1e0)](_0x57c11b=>{const _0x39cf9b=_0x361276;return console['log'](_0x57c11b),_0x3e15c7[_0x39cf9b(0x207)][_0x39cf9b(0x238)](_0x3d1778,_0x3d1778['__'](_0x39cf9b(0x20d)));}),_0x3d1778['json']({'code':0x0});});}),router['get'](_0x3a45c7(0x208),(_0x3661ee,_0x3a677a,_0x5b8e5a)=>{const _0x34313e=_0x3a45c7;let _0x4c415b=_0x3661ee[_0x34313e(0x1da)]['url'];if(!_0x4c415b||!_0x4c415b[_0x34313e(0x204)](_0x34313e(0x224))==-0x1)return _0x3a677a[_0x34313e(0x1ef)](0x194)[_0x34313e(0x241)]();_0x4c415b=decodeURIComponent(_0x4c415b);let _0x2155cb=path[_0x34313e(0x227)](config[_0x34313e(0x1d8)],sha256(_0x4c415b));function _0x3b382d(){const _0x409362=_0x34313e;sharp(_0x2155cb,{'failOnError':![]})[_0x409362(0x229)]({'quality':0x4d})[_0x409362(0x1e8)]({'width':0x1f4})[_0x409362(0x1e2)]()[_0x409362(0x1e9)](_0x29f03b=>{const _0xbe7574=_0x409362;return _0x3a677a[_0xbe7574(0x23f)](_0x29f03b);})['catch'](_0x1e39de=>{const _0x2b43a2=_0x409362;return console['log']('err1',_0x1e39de),_0x3a677a[_0x2b43a2(0x1ef)](0x194)[_0x2b43a2(0x241)]();});}fs[_0x34313e(0x243)](_0x2155cb,(_0x3b6642,_0x544c6f)=>{const _0x4ba3be=_0x34313e;if(!_0x3b6642)return _0x3b382d();_0x3661ee['query'][_0x4ba3be(0x1ec)]==0x1?httpUtil[_0x4ba3be(0x200)](_0x3661ee[_0x4ba3be(0x207)]['dbOther'],_0x4c415b)['then'](_0x3ee21a=>{return _0x3ee21a['pipe'](_0x3a677a);})[_0x4ba3be(0x1e0)](_0x57ce08=>{const _0x3916f2=_0x4ba3be;return _0x3a677a['status'](0x194)[_0x3916f2(0x241)]();}):httpUtil[_0x4ba3be(0x200)](_0x3661ee['app'][_0x4ba3be(0x218)],_0x4c415b,_0x2155cb)[_0x4ba3be(0x1e9)](_0x5b4828=>{_0x3b382d();})['catch'](_0x46c773=>{const _0x4c8ca8=_0x4ba3be;return _0x3a677a[_0x4c8ca8(0x1ef)](0x194)['end']();});});}),module[_0x3a45c7(0x1fb)]=router;