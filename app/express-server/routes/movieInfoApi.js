const _0x57e6eb=_0x1683;(function(_0x462f22,_0x3d41db){const _0x343b43=_0x1683,_0x5c4d39=_0x462f22();while(!![]){try{const _0x1e6ef0=-parseInt(_0x343b43(0x10d))/0x1*(parseInt(_0x343b43(0xd6))/0x2)+parseInt(_0x343b43(0xb4))/0x3*(parseInt(_0x343b43(0xb7))/0x4)+parseInt(_0x343b43(0xd7))/0x5+-parseInt(_0x343b43(0x9d))/0x6*(parseInt(_0x343b43(0xf8))/0x7)+parseInt(_0x343b43(0xdb))/0x8+-parseInt(_0x343b43(0xe5))/0x9+parseInt(_0x343b43(0xf3))/0xa*(parseInt(_0x343b43(0xa4))/0xb);if(_0x1e6ef0===_0x3d41db)break;else _0x5c4d39['push'](_0x5c4d39['shift']());}catch(_0x59663f){_0x5c4d39['push'](_0x5c4d39['shift']());}}}(_0x50a2,0x8a5fe));var express=require('express'),router=express[_0x57e6eb(0xd9)]();function _0x50a2(){const _0x558a15=['.jpg','getProxyUrl','tvshow.nfo','headersSent','sha256','searchMediaType','currentUser','API','DELETE\x20FROM\x20movie_scrape_log\x20WHERE\x201=1','indexId/tmdbId\x20error','2svoaeB','5394800ckXqrr','fanart.jpg','Router','need\x20folder','5091928lFRLKG','get','downloadImg','tmdb','sep','poster.jpg','offset','sharp','movieTmdbApiKey','parseNfo','8623062GjxJzu','is_tvplay','movieTmdbLanguage','exports','SELECT\x20*\x20FROM\x20','-thumb.jpg','noCache','send','params\x20error','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0,movie_info_get_time=0,movie_info_get_times=0\x20WHERE\x20path=?\x20OR\x20path\x20like\x20?','post','pipe','tmdbId','SELECT\x20*\x20FROM\x20movie_scrape_log\x20ORDER\x20BY\x20id\x20DESC\x20LIMIT\x20?\x20OFFSET\x20?\x20','20jAXplU','ext','Need\x20tmdb\x20key','path','/getScrapeLog','49PvQCYR','url','indexId','status_code','.nfo','dbOther','is_admin','prepare','season.nfo','../../db/dbUserTable','splice','scrapeMissing','status_message','../../db/dbFileOperationRecord','../../db/dbFileIndexTable','lastIndexOf','all','success','body','join','returnErrMsg','413202WZAtIk','toBuffer','season','../../utils/movieSeasonUtil','username','getTmdbApi','saveMovieInfoToDb','INDEX_TABLE_NAME_MOVIE','addFileOperationRecord','substring','/searchMovieInfo','/testTmdbProxy','testTmdb','stat','jpeg','search','../../utils/movieInfoUtil','run','Need\x20tmdb\x20api\x20url','err1','756138Zjyacc','/getImdbImg','length','basename','../../myConfig/config','doUserCanGet','movieTmdbApiUrl','5202923vabtCW','runSearchNfoWorker','-poster.jpg','/clearNfoImg','languageList','TMDB\x20search接口请求失败','dbFileIndex','page','indexId\x20error','searchType','getById','TMDB\x20Error','log','Need\x20tmdb\x20language','filename','getDetail','6RoLwii','message','TYPE_DELETE','317652LEtGKg','要清除的nfo和海报文件列表','\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','push','app','json','end','power_change','query','then','SWITCH_MOVIE_INFO','/setMovieInfo','resize','getSeasonNumber','../../utils/movieInfoTmdbApi','/clearScrapeLog','catch','allSettled','status','TMDBID','LEVEL_MAIN_OPERATION'];_0x50a2=function(){return _0x558a15;};return _0x50a2();}const fs=require('fs'),sharp=require(_0x57e6eb(0xe2)),axios=require('axios');let sha256=require(_0x57e6eb(0xd0)),path=require('path'),config=require(_0x57e6eb(0xa1));const tmdbApi=require(_0x57e6eb(0xc5)),movieInfoUtil=require(_0x57e6eb(0x99)),movieSeasonUtil=require(_0x57e6eb(0x110)),dbFileIndexTable=require(_0x57e6eb(0x106)),dbUserTable=require(_0x57e6eb(0x101)),dbFileOperationRecord=require(_0x57e6eb(0x105)),nfoUtil=require('../../utils/nfoUtil'),httpUtil=require('../../utils/httpUtil');router[_0x57e6eb(0xef)]('/testTmdb',(_0x13d9ad,_0x4353da,_0x5a1e49)=>{const _0x3332ac=_0x57e6eb;if(_0x13d9ad['currentUser']['is_admin']!=0x1)return _0x4353da['json']({'code':0x66});let _0x1cc124=_0x13d9ad[_0x3332ac(0x10a)][_0x3332ac(0xe7)],_0x4ba8c9=_0x13d9ad[_0x3332ac(0x10a)][_0x3332ac(0xa3)],_0x1d0103=_0x13d9ad[_0x3332ac(0x10a)][_0x3332ac(0xe3)];if(!_0x1cc124)return _0x13d9ad[_0x3332ac(0xbb)]['returnErrMsg'](_0x4353da,_0x3332ac(0xb1));if(!_0x4ba8c9)return _0x13d9ad[_0x3332ac(0xbb)][_0x3332ac(0x10c)](_0x4353da,_0x3332ac(0x9b));if(!_0x1d0103)return _0x13d9ad[_0x3332ac(0xbb)][_0x3332ac(0x10c)](_0x4353da,_0x3332ac(0xf5));let _0x4871c2=movieInfoUtil[_0x3332ac(0xcd)](_0x13d9ad[_0x3332ac(0xbb)][_0x3332ac(0xfd)]),_0x5d05ba=new tmdbApi[(_0x3332ac(0xd3))](_0x1d0103,_0x1cc124,_0x4ba8c9,_0x4871c2);_0x5d05ba[_0x3332ac(0xa8)]()[_0x3332ac(0xc0)](_0x3fcaf4=>{const _0x104144=_0x3332ac;if(_0x3fcaf4[_0x104144(0x109)]==![]||_0x3fcaf4[_0x104144(0xfb)])return _0x4353da[_0x104144(0xbc)]({'code':0x2,'msg':_0x3fcaf4[_0x104144(0x104)]});return _0x4353da['json']({'code':0x0,'data':[]});})[_0x3332ac(0xc7)](_0x1bd33d=>{const _0xca885f=_0x3332ac;let _0x22bf39=_0xca885f(0xaf);if(_0x1bd33d){if(_0x1bd33d['status_code'])_0x22bf39+=':'+_0x1bd33d[_0xca885f(0x104)];else _0x1bd33d['message']&&(_0x22bf39+=':'+_0x1bd33d[_0xca885f(0xb5)]);}return _0x4353da['json']({'code':0x2,'msg':_0x22bf39,'data':[]});});}),router['post'](_0x57e6eb(0x94),(_0x19461e,_0x46dbea,_0x20aa86)=>{const _0x4394f8=_0x57e6eb;if(_0x19461e['currentUser'][_0x4394f8(0xfe)]!=0x1)return _0x46dbea[_0x4394f8(0xbc)]({'code':0x66});movieInfoUtil[_0x4394f8(0x95)](_0x19461e[_0x4394f8(0xbb)][_0x4394f8(0xfd)])[_0x4394f8(0xc0)](()=>{return _0x46dbea['json']({'code':0x0});})[_0x4394f8(0xc7)](_0x2082c7=>{return _0x46dbea['json']({'code':0x2,'msg':_0x2082c7});});}),router[_0x57e6eb(0xef)](_0x57e6eb(0x93),(_0x1936ee,_0x2b50bd,_0x9caec0)=>{const _0x176f90=_0x57e6eb;let _0x5bade8=_0x1936ee[_0x176f90(0x10a)]['searchStr'],_0x35b582=_0x1936ee[_0x176f90(0x10a)][_0x176f90(0xad)],_0x782d9e=_0x1936ee['body'][_0x176f90(0xd1)],_0x3372ad=_0x1936ee[_0x176f90(0x10a)][_0x176f90(0xab)];if(!_0x5bade8||!_0x35b582||!_0x782d9e)return _0x1936ee[_0x176f90(0xbb)][_0x176f90(0x10c)](_0x2b50bd,_0x176f90(0xed));let _0x3d0760=movieInfoUtil[_0x176f90(0x8e)](_0x1936ee[_0x176f90(0xbb)][_0x176f90(0xfd)]);if(_0x35b582=='KEYWORD')_0x3d0760[_0x176f90(0x98)](_0x5bade8,_0x782d9e=='TV',null,_0x3372ad,!![])['then'](_0x361eaf=>{const _0x5dbd79=_0x176f90;if(!_0x2b50bd[_0x5dbd79(0xcf)])return _0x2b50bd['json']({'code':0x0,'data':_0x361eaf});})[_0x176f90(0xc7)](_0x50fe02=>{const _0x136e5b=_0x176f90;console['log'](_0x136e5b(0xa9),_0x50fe02);if(_0x50fe02&&_0x50fe02[_0x136e5b(0xfb)]&&_0x50fe02['status_message'])return _0x1936ee[_0x136e5b(0xbb)][_0x136e5b(0x10c)](_0x2b50bd,_0x50fe02[_0x136e5b(0x104)]);if(!_0x2b50bd['headersSent'])return _0x2b50bd[_0x136e5b(0xbc)]({'code':0x0,'data':[]});});else{if(_0x35b582==_0x176f90(0xca))_0x3d0760[_0x176f90(0xb3)](_0x5bade8,_0x782d9e=='TV')[_0x176f90(0xc0)](_0x4191fb=>{const _0x114304=_0x176f90;if(!_0x2b50bd[_0x114304(0xcf)])return _0x2b50bd[_0x114304(0xbc)]({'code':0x0,'data':[_0x4191fb]});})['catch'](_0x3546bc=>{const _0xc6be82=_0x176f90;console['log'](_0xc6be82(0xa9),_0x3546bc);if(_0x3546bc&&_0x3546bc['status_code']&&_0x3546bc[_0xc6be82(0x104)])return _0x1936ee['app'][_0xc6be82(0x10c)](_0x2b50bd,_0x3546bc[_0xc6be82(0x104)]);if(!_0x2b50bd[_0xc6be82(0xcf)])return _0x2b50bd[_0xc6be82(0xbc)]({'code':0x0,'data':[]});});else{if(!_0x2b50bd[_0x176f90(0xcf)])return _0x2b50bd[_0x176f90(0xbc)]({'code':0x0,'data':[]});}}});function _0x1683(_0x3d8a5a,_0x295f92){const _0x50a22d=_0x50a2();return _0x1683=function(_0x1683e9,_0x3a0344){_0x1683e9=_0x1683e9-0x8e;let _0x12a941=_0x50a22d[_0x1683e9];return _0x12a941;},_0x1683(_0x3d8a5a,_0x295f92);}function updateIndexByNfo(_0x257dd4,_0x479389){return new Promise((_0x4b423d,_0x3f3ec3)=>{const _0x6ac42c=_0x1683;nfoUtil[_0x6ac42c(0xe4)](_0x479389,!![],![])[_0x6ac42c(0xc0)](_0x25b912=>{const _0x2101c1=_0x6ac42c;return movieInfoUtil[_0x2101c1(0x8f)](_0x257dd4,_0x479389['id'],_0x25b912),_0x4b423d();})['catch'](_0xae3a01=>{return _0x4b423d();});});}router[_0x57e6eb(0xef)]('/scrapeAgain',(_0x2c4aba,_0x4eae07,_0x4fe5f4)=>{const _0x1ceedc=_0x57e6eb;let _0x629fb8=_0x2c4aba[_0x1ceedc(0x10a)][_0x1ceedc(0xfa)],_0x1ed7cd=_0x2c4aba['body'][_0x1ceedc(0x103)],_0x1f34cf=dbFileIndexTable[_0x1ceedc(0xae)](_0x2c4aba['app']['dbFileIndex'],_0x629fb8,dbFileIndexTable[_0x1ceedc(0x90)]);if(!_0x1f34cf)return _0x2c4aba[_0x1ceedc(0xbb)]['returnErrMsg'](_0x4eae07,_0x1ceedc(0xac));if(dbUserTable[_0x1ceedc(0xa2)](_0x2c4aba,_0x4eae07,'',_0x1ceedc(0xbe),_0x1f34cf['path'])==!![]){function _0x3f267e(){const _0x27253b=_0x1ceedc;movieInfoUtil['runSearchNfoWorker'](_0x2c4aba[_0x27253b(0xbb)][_0x27253b(0xfd)],_0x1f34cf['path'],_0x1f34cf['filename'],_0x1f34cf[_0x27253b(0xe6)],null,_0x1ed7cd)[_0x27253b(0xc0)](()=>{const _0x24bf90=_0x27253b;_0x1f34cf['is_tvplay']==0x0&&updateIndexByNfo(_0x2c4aba[_0x24bf90(0xbb)][_0x24bf90(0xaa)],_0x1f34cf)[_0x24bf90(0xc0)](()=>{});})[_0x27253b(0xc7)](_0x39f9db=>{});}_0x1ed7cd==0x1?_0x3f267e():clearInfo(_0x2c4aba,_0x4eae07,_0x1f34cf)[_0x1ceedc(0xc0)](()=>{_0x3f267e();});if(!_0x4eae07[_0x1ceedc(0xcf)])return _0x4eae07[_0x1ceedc(0xbc)]({'code':0x0});}}),router[_0x57e6eb(0xef)](_0x57e6eb(0xf7),(_0x58d7dd,_0x171442,_0x468e96)=>{const _0x155bcc=_0x57e6eb;if(_0x58d7dd['currentUser'][_0x155bcc(0xfe)]!=0x1)return _0x171442[_0x155bcc(0xbc)]({'code':0x66});let _0x1181aa=_0x58d7dd['body']['count']||0x1e,_0x5e26d6=_0x58d7dd[_0x155bcc(0x10a)][_0x155bcc(0xe1)]||0x0;const _0x557c6f=_0x155bcc(0xf2);let _0x5e3644=_0x58d7dd[_0x155bcc(0xbb)][_0x155bcc(0xaa)]['prepare'](_0x557c6f)[_0x155bcc(0x108)](_0x1181aa,_0x5e26d6);return _0x171442[_0x155bcc(0xbc)]({'code':0x0,'data':_0x5e3644});}),router[_0x57e6eb(0xef)](_0x57e6eb(0xc6),(_0x377638,_0x5c4b59,_0x4d9a2b)=>{const _0x1dcb1a=_0x57e6eb;if(_0x377638[_0x1dcb1a(0xd2)][_0x1dcb1a(0xfe)]!=0x1)return _0x5c4b59[_0x1dcb1a(0xbc)]({'code':0x66});const _0x342129=_0x1dcb1a(0xd4);return _0x377638[_0x1dcb1a(0xbb)]['dbFileIndex'][_0x1dcb1a(0xff)](_0x342129)['run'](),_0x5c4b59[_0x1dcb1a(0xbc)]({'code':0x0});}),router['post'](_0x57e6eb(0xa7),(_0x50895f,_0xc1e5ef,_0x29f0fd)=>{const _0x6013ee=_0x57e6eb;if(_0x50895f[_0x6013ee(0xd2)][_0x6013ee(0xfe)]!=0x1)return _0xc1e5ef[_0x6013ee(0xbc)]({'code':0x66});let _0x8b060c=_0x50895f['body']['sourceFolder'];if(!_0x8b060c)return _0x50895f[_0x6013ee(0xbb)][_0x6013ee(0x10c)](_0xc1e5ef,_0x6013ee(0xda));const _0x4277b4=_0x6013ee(0xee);_0x50895f[_0x6013ee(0xbb)][_0x6013ee(0xaa)]['prepare'](_0x4277b4)[_0x6013ee(0x9a)](_0x8b060c,_0x8b060c+path[_0x6013ee(0xdf)]+'%');let _0x518be8=_0x6013ee(0xe9)+dbFileIndexTable[_0x6013ee(0x90)]+'\x20as\x20f\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20or\x20path\x20like\x20?',_0x545668=_0x50895f[_0x6013ee(0xbb)][_0x6013ee(0xaa)]['prepare'](_0x518be8)['all'](_0x8b060c,_0x8b060c+path[_0x6013ee(0xdf)]+'%'),_0x51179d=[];for(let _0x567866 of _0x545668){movieInfoUtil[_0x6013ee(0x8f)](_0x50895f[_0x6013ee(0xbb)][_0x6013ee(0xaa)],_0x567866['id'],{}),_0x51179d['push'](deleteMovieInfoOfIndex(_0x50895f,_0x567866));}Promise['allSettled'](_0x51179d)[_0x6013ee(0xc0)](_0x4dbd12=>{const _0x103354=_0x6013ee;return process[_0x103354(0xec)]({'type':_0x103354(0xc1)}),_0xc1e5ef[_0x103354(0xbc)]({'code':0x0});});});function deleteMovieInfoOfIndex(_0x45be69,_0x2203cb){return new Promise((_0x2f8f8c,_0x725a2f)=>{const _0x37be42=_0x1683;let _0x35bdab=path['join'](_0x2203cb['path'],_0x2203cb['filename']['substring'](0x0,_0x2203cb['filename'][_0x37be42(0x107)](_0x2203cb[_0x37be42(0xf4)]))+_0x37be42(0xcc)),_0x47bbf1=path[_0x37be42(0x10b)](_0x2203cb['path'],_0x2203cb[_0x37be42(0xb2)][_0x37be42(0x92)](0x0,_0x2203cb[_0x37be42(0xb2)][_0x37be42(0x107)](_0x2203cb[_0x37be42(0xf4)]))+_0x37be42(0xea)),_0x37f294=path[_0x37be42(0x10b)](_0x2203cb[_0x37be42(0xf6)],_0x2203cb[_0x37be42(0xb2)][_0x37be42(0x92)](0x0,_0x2203cb[_0x37be42(0xb2)]['lastIndexOf'](_0x2203cb[_0x37be42(0xf4)]))+'-fanart.jpg'),_0x182f9a=path[_0x37be42(0x10b)](_0x2203cb['path'],_0x2203cb[_0x37be42(0xb2)]['substring'](0x0,_0x2203cb[_0x37be42(0xb2)][_0x37be42(0x107)](_0x2203cb[_0x37be42(0xf4)]))+_0x37be42(0xa6)),_0x466565=path[_0x37be42(0x10b)](_0x2203cb[_0x37be42(0xf6)],_0x37be42(0xe0)),_0x4c8766=path[_0x37be42(0x10b)](_0x2203cb[_0x37be42(0xf6)],_0x2203cb[_0x37be42(0xb2)][_0x37be42(0x92)](0x0,_0x2203cb[_0x37be42(0xb2)]['lastIndexOf'](_0x2203cb['ext']))+_0x37be42(0xfc)),_0x2999aa=[_0x35bdab,_0x466565,_0x47bbf1,_0x37f294,_0x182f9a,_0x4c8766];if(_0x2203cb[_0x37be42(0xe6)]==0x1){let _0x1005e4=path[_0x37be42(0x10b)](_0x2203cb[_0x37be42(0xf6)],_0x37be42(0xce)),_0x2de60f=path[_0x37be42(0x10b)](_0x2203cb['path'],_0x37be42(0x100));_0x2999aa['push'](_0x1005e4),_0x2999aa[_0x37be42(0xba)](_0x2de60f);let _0x47998a=path[_0x37be42(0xa0)](_0x2203cb[_0x37be42(0xf6)]),_0x4c1c0b=path['dirname'](_0x2203cb[_0x37be42(0xf6)]),_0x4eea63=movieSeasonUtil[_0x37be42(0xc4)](_0x47998a);if(_0x4eea63>0x0){let _0x4ed82b=path[_0x37be42(0x10b)](_0x4c1c0b,_0x37be42(0xce));_0x2999aa[_0x37be42(0xba)](_0x4ed82b);_0x4eea63<0xa&&(_0x4eea63='0'+_0x4eea63);let _0x336371=path[_0x37be42(0x10b)](_0x4c1c0b,_0x37be42(0x10f)+_0x4eea63+'-poster.jpg');_0x2999aa[_0x37be42(0xba)](_0x336371);let _0x21b638=path[_0x37be42(0x10b)](_0x4c1c0b,'poster.jpg');_0x2999aa[_0x37be42(0xba)](_0x21b638);let _0x183399=path[_0x37be42(0x10b)](_0x4c1c0b,_0x37be42(0xd8));_0x2999aa[_0x37be42(0xba)](_0x183399);}}console[_0x37be42(0xb0)](_0x37be42(0xb8),_0x2999aa);function _0xc708d1(){const _0x233d80=_0x37be42;_0x2999aa[_0x233d80(0x9f)]>0x0?fs[_0x233d80(0x96)](_0x2999aa[0x0],(_0x312ef1,_0x465be3)=>{const _0x3b54cd=_0x233d80;!_0x312ef1&&_0x465be3&&_0x465be3['isFile']()?(console[_0x3b54cd(0xb0)]('清理',_0x2999aa[0x0]),fs['rm'](_0x2999aa[0x0],_0x4de41f=>{const _0x302f09=_0x3b54cd;let _0x3e9df8=_0x2999aa[0x0];_0x2999aa[_0x302f09(0x102)](0x0,0x1),!_0x4de41f&&(console[_0x302f09(0xb0)]('刮削文件清理成功',_0x3e9df8),dbFileOperationRecord[_0x302f09(0x91)](_0x45be69[_0x302f09(0xbb)][_0x302f09(0xfd)],{'username':_0x45be69[_0x302f09(0xd2)][_0x302f09(0x111)],'targetPath':_0x3e9df8,'level':dbFileOperationRecord[_0x302f09(0xcb)],'type':dbFileOperationRecord[_0x302f09(0xb6)],'state':dbFileOperationRecord['STATE_SUC']})),_0xc708d1();})):(_0x2999aa['splice'](0x0,0x1),_0xc708d1());}):(movieInfoUtil[_0x233d80(0x8f)](_0x45be69[_0x233d80(0xbb)]['dbFileIndex'],_0x2203cb['id'],{}),_0x2f8f8c());}_0xc708d1();});}function clearInfo(_0x34f120,_0x231423,_0x1f3c3d){return new Promise((_0x4ca2e6,_0x4e2d18)=>{const _0x5424ea=_0x1683;if(dbUserTable[_0x5424ea(0xa2)](_0x34f120,_0x231423,'','power_delete',_0x1f3c3d['path'])==!![]){if(_0x1f3c3d[_0x5424ea(0xe6)]==0x1){let _0x3acc35=_0x5424ea(0xe9)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x5424ea(0xb9),_0x2c8cba=_0x34f120[_0x5424ea(0xbb)][_0x5424ea(0xaa)][_0x5424ea(0xff)](_0x3acc35)[_0x5424ea(0x108)](_0x1f3c3d['path']),_0x57f9ed=[];for(let _0x149082 of _0x2c8cba){_0x57f9ed[_0x5424ea(0xba)](deleteMovieInfoOfIndex(_0x34f120,_0x149082));}if(_0x57f9ed[_0x5424ea(0x9f)]<0x1)return _0x4ca2e6();Promise[_0x5424ea(0xc8)](_0x57f9ed)[_0x5424ea(0xc0)](_0x2e97ee=>{return _0x4ca2e6();})['catch'](_0x5c918b=>{return _0x4ca2e6();});}else deleteMovieInfoOfIndex(_0x34f120,_0x1f3c3d)[_0x5424ea(0xc0)](_0x369320=>{return _0x4ca2e6();});}});}router[_0x57e6eb(0xef)]('/clearMovieInfo',(_0x190388,_0x4399d7,_0x1da05c)=>{const _0x595f53=_0x57e6eb;let _0x4e9c6f=_0x190388[_0x595f53(0x10a)]['indexId'],_0x18469b=dbFileIndexTable['getById'](_0x190388[_0x595f53(0xbb)]['dbFileIndex'],_0x4e9c6f,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x18469b)return _0x190388[_0x595f53(0xbb)][_0x595f53(0x10c)](_0x4399d7,'indexId\x20error');clearInfo(_0x190388,_0x4399d7,_0x18469b)[_0x595f53(0xc0)](()=>{const _0x446d22=_0x595f53;return _0x4399d7[_0x446d22(0xbc)]({'code':0x0});});}),router[_0x57e6eb(0xef)](_0x57e6eb(0xc2),(_0x160a09,_0x2dd9be,_0x14ac17)=>{const _0x1c54fd=_0x57e6eb;let _0x2cdf4d=_0x160a09[_0x1c54fd(0x10a)][_0x1c54fd(0xfa)],_0x344570=dbFileIndexTable[_0x1c54fd(0xae)](_0x160a09[_0x1c54fd(0xbb)][_0x1c54fd(0xaa)],_0x2cdf4d,dbFileIndexTable[_0x1c54fd(0x90)]),_0x239421=_0x160a09[_0x1c54fd(0x10a)][_0x1c54fd(0xf1)];if(!_0x344570||!_0x239421)return _0x160a09[_0x1c54fd(0xbb)][_0x1c54fd(0x10c)](_0x2dd9be,_0x1c54fd(0xd5));dbUserTable[_0x1c54fd(0xa2)](_0x160a09,_0x2dd9be,'',_0x1c54fd(0xbe),_0x344570['path'])==!![]&&clearInfo(_0x160a09,_0x2dd9be,_0x344570)[_0x1c54fd(0xc0)](()=>{const _0x3f55d6=_0x1c54fd;return movieInfoUtil[_0x3f55d6(0xa5)](_0x160a09[_0x3f55d6(0xbb)][_0x3f55d6(0xfd)],_0x344570['path'],_0x344570[_0x3f55d6(0xb2)],_0x344570[_0x3f55d6(0xe6)],_0x239421)[_0x3f55d6(0xc0)](()=>{const _0x5385d2=_0x3f55d6;if(_0x344570[_0x5385d2(0xe6)]==0x0)updateIndexByNfo(_0x160a09[_0x5385d2(0xbb)][_0x5385d2(0xaa)],_0x344570)[_0x5385d2(0xc0)](()=>{});else{}})[_0x3f55d6(0xc7)](_0x1e51ae=>{const _0xc76ab3=_0x3f55d6;return console[_0xc76ab3(0xb0)](_0x1e51ae),_0x160a09['app'][_0xc76ab3(0x10c)](_0x2dd9be,_0x2dd9be['__']('operationFail'));}),_0x2dd9be['json']({'code':0x0});});}),router[_0x57e6eb(0xdc)](_0x57e6eb(0x9e),(_0xf20ca7,_0x3bb8f7,_0x1179da)=>{const _0x12c33d=_0x57e6eb;let _0x1d11a8=_0xf20ca7[_0x12c33d(0xbf)][_0x12c33d(0xf9)];if(!_0x1d11a8||!_0x1d11a8['indexOf'](_0x12c33d(0xde))==-0x1)return _0x3bb8f7[_0x12c33d(0xc9)](0x194)[_0x12c33d(0xbd)]();_0x1d11a8=decodeURIComponent(_0x1d11a8);let _0x2ac158=path[_0x12c33d(0x10b)](config['posterPath'],sha256(_0x1d11a8));function _0x151a14(){const _0x13d768=_0x12c33d;sharp(_0x2ac158,{'failOnError':![]})[_0x13d768(0x97)]({'quality':0x4d})[_0x13d768(0xc3)]({'width':0x1f4})[_0x13d768(0x10e)]()['then'](_0x2ba00e=>{return _0x3bb8f7['send'](_0x2ba00e);})[_0x13d768(0xc7)](_0x1488eb=>{const _0x113fab=_0x13d768;return console[_0x113fab(0xb0)](_0x113fab(0x9c),_0x1488eb),_0x3bb8f7[_0x113fab(0xc9)](0x194)[_0x113fab(0xbd)]();});}fs[_0x12c33d(0x96)](_0x2ac158,(_0xf5f2f4,_0x3e2131)=>{const _0x20f175=_0x12c33d;if(!_0xf5f2f4)return _0x151a14();_0xf20ca7['query'][_0x20f175(0xeb)]==0x1?httpUtil[_0x20f175(0xdd)](_0xf20ca7[_0x20f175(0xbb)][_0x20f175(0xfd)],_0x1d11a8)['then'](_0x459afd=>{const _0x5035fb=_0x20f175;return _0x459afd[_0x5035fb(0xf0)](_0x3bb8f7);})[_0x20f175(0xc7)](_0x2f544b=>{const _0x440fc4=_0x20f175;return _0x3bb8f7['status'](0x194)[_0x440fc4(0xbd)]();}):httpUtil[_0x20f175(0xdd)](_0xf20ca7[_0x20f175(0xbb)][_0x20f175(0xfd)],_0x1d11a8,_0x2ac158)[_0x20f175(0xc0)](_0x9fdae1=>{_0x151a14();})[_0x20f175(0xc7)](_0x4bcc46=>{const _0x251d1b=_0x20f175;return _0x3bb8f7[_0x251d1b(0xc9)](0x194)['end']();});});}),module[_0x57e6eb(0xe8)]=router;