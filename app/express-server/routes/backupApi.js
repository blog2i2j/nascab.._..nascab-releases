const _0x2e51ea=_0xb3b6;(function(_0xfa70b9,_0x2f917e){const _0x5b2129=_0xb3b6,_0x56cd5b=_0xfa70b9();while(!![]){try{const _0x211fbf=parseInt(_0x5b2129(0x1da))/0x1+-parseInt(_0x5b2129(0x1d5))/0x2+parseInt(_0x5b2129(0x1f3))/0x3+parseInt(_0x5b2129(0x1cd))/0x4+-parseInt(_0x5b2129(0x1f1))/0x5*(parseInt(_0x5b2129(0x1cb))/0x6)+parseInt(_0x5b2129(0x20e))/0x7+parseInt(_0x5b2129(0x1f4))/0x8;if(_0x211fbf===_0x2f917e)break;else _0x56cd5b['push'](_0x56cd5b['shift']());}catch(_0x142872){_0x56cd5b['push'](_0x56cd5b['shift']());}}}(_0x1d51,0x850ad));var express=require(_0x2e51ea(0x20f)),router=express[_0x2e51ea(0x20d)]();let path=require('path'),fs=require('fs');function _0xb3b6(_0x7a3b52,_0x4ccf11){const _0x1d51a1=_0x1d51();return _0xb3b6=function(_0xb3b6c7,_0x5169d5){_0xb3b6c7=_0xb3b6c7-0x1cb;let _0x4a7670=_0x1d51a1[_0xb3b6c7];return _0x4a7670;},_0xb3b6(_0x7a3b52,_0x4ccf11);}const dbBackupTask=require(_0x2e51ea(0x1eb));function _0x1d51(){const _0x28befd=['createRecord','noGetFolderStat','log','length','is_admin','../../db/dbBackupTask','currentUser','\x20task_record_id=?\x20order\x20by\x20id\x20desc\x20limit\x20100','cannotUseRootPathAsBackupTarget','lastRecord','getAll','15nTVWvy','targetPath','807294NYHNum','5239208DKGzkX','excludeList','getRecordByWhere','stop','initBackupWorker','create','getAllRecordByWhere','taskAlreadyRunning','type','R_OK','stringify','getAllByTaskType','sourceList','update','body','json','\x20status=\x27running\x27\x20or\x20status=\x27waiting\x27','/operationTask','\x20status=\x27stop\x27','noWritePermission','dbOther','getAllRecordMsgByWhere','taskAlreadQueued','format','noReadPermission','Router','1587005FudXma','express','constants','/getRunningTaskList','test','status','running','moment','/deleteTask','1759908ToQMVq','isDirectory','455768GMByEW','\x20task_id=?\x20and\x20status=\x27running\x27','getById','dialog','join','\x20task_id=?\x20order\x20by\x20id\x20desc\x20limit\x201','/getTaskById','returnErrMsg','1519408gDhOXH','post','updateRecord','exports','start','919943ynocOZ','/createTask','send','taskType','taskTime','taskName','access','/getTaskRecordMsg','task\x20id\x20is\x20error','waiting','delete','app'];_0x1d51=function(){return _0x28befd;};return _0x1d51();}let moment=require(_0x2e51ea(0x215));router[_0x2e51ea(0x1d6)](_0x2e51ea(0x1db),(_0x3e0746,_0x255f4b,_0x99009)=>{const _0x609424=_0x2e51ea;if(_0x3e0746[_0x609424(0x1ec)][_0x609424(0x1ea)]!=0x1)return _0x255f4b['json']({'code':0x66});let _0x1cc87f=_0x3e0746[_0x609424(0x202)][_0x609424(0x1fc)],_0x5562e5=_0x3e0746[_0x609424(0x202)][_0x609424(0x1df)],_0x5407b5=_0x3e0746[_0x609424(0x202)][_0x609424(0x200)],_0x8945dd=_0x3e0746['body'][_0x609424(0x1f5)],_0x4a7f55=path[_0x609424(0x1d1)](_0x3e0746['body'][_0x609424(0x1f2)]),_0x1cfad2=_0x3e0746['body'][_0x609424(0x1dd)],_0x196420=_0x3e0746[_0x609424(0x202)]['taskDay'],_0x54f717=_0x3e0746[_0x609424(0x202)][_0x609424(0x1de)];if(/^\w\:\\$/[_0x609424(0x212)](_0x4a7f55))return _0x3e0746[_0x609424(0x1e5)][_0x609424(0x1d4)](_0x255f4b,_0x255f4b['__'](_0x609424(0x1ee)),_0x609424(0x1d0));let _0x2b0ae6=0x0;for(let _0x3fe946 in _0x5407b5){_0x5407b5[_0x3fe946]=path[_0x609424(0x1d1)](_0x5407b5[_0x3fe946]);if(/^\w\:\\$/[_0x609424(0x212)](_0x5407b5[_0x3fe946]))return _0x3e0746['app'][_0x609424(0x1d4)](_0x255f4b,_0x255f4b['__'](_0x609424(0x1ee)),'dialog');fs[_0x609424(0x1e0)](_0x5407b5[_0x3fe946],fs[_0x609424(0x210)][_0x609424(0x1fd)],_0x55f512=>{const _0x174a56=_0x609424;if(_0x55f512)return _0x3e0746[_0x174a56(0x1e5)][_0x174a56(0x1d4)](_0x255f4b,_0x255f4b['__'](_0x174a56(0x20c))+':'+_0x5407b5[_0x3fe946]);_0x2b0ae6+=0x1,_0x2b0ae6==_0x5407b5[_0x174a56(0x1e9)]&&_0x1fdc86();});}function _0x1fdc86(){const _0x59d237=_0x609424;fs[_0x59d237(0x1e0)](_0x4a7f55,fs[_0x59d237(0x210)]['W_OK']|fs[_0x59d237(0x210)][_0x59d237(0x1fd)],_0x420f03=>{const _0x12a72b=_0x59d237;if(_0x420f03)return console[_0x12a72b(0x1e8)](_0x420f03),_0x3e0746['app'][_0x12a72b(0x1d4)](_0x255f4b,_0x255f4b['__'](_0x12a72b(0x207))+':'+_0x4a7f55);fs['stat'](_0x4a7f55,(_0x23be92,_0x44ef27)=>{const _0x434ec5=_0x12a72b;if(_0x23be92||!_0x44ef27[_0x434ec5(0x1cc)]())return _0x3e0746[_0x434ec5(0x1e5)]['returnErrMsg'](_0x255f4b,_0x255f4b['__'](_0x434ec5(0x1e7)));let _0x31ffae={'task_name':_0x5562e5,'source_list':JSON[_0x434ec5(0x1fe)](_0x5407b5),'exclude_list':JSON[_0x434ec5(0x1fe)](_0x8945dd),'target_path':_0x4a7f55,'task_type':_0x1cfad2,'task_day':_0x196420,'task_time':_0x54f717};if(_0x1cc87f=='create')dbBackupTask[_0x434ec5(0x1f9)](_0x3e0746[_0x434ec5(0x1e5)][_0x434ec5(0x208)],_0x31ffae);else{if(_0x1cc87f==_0x434ec5(0x201)){let _0x425bf5=_0x3e0746[_0x434ec5(0x202)]['id'];dbBackupTask[_0x434ec5(0x201)](_0x3e0746[_0x434ec5(0x1e5)][_0x434ec5(0x208)],_0x31ffae,_0x425bf5);}}return process[_0x434ec5(0x1dc)]({'type':_0x434ec5(0x1f8)}),_0x255f4b[_0x434ec5(0x203)]({'code':0x0});});});}}),router[_0x2e51ea(0x1d6)](_0x2e51ea(0x216),(_0x27071c,_0x586eb0,_0x2f8e82)=>{const _0x3e9347=_0x2e51ea;if(_0x27071c[_0x3e9347(0x1ec)][_0x3e9347(0x1ea)]!=0x1)return _0x586eb0[_0x3e9347(0x203)]({'code':0x66});let _0x129bde=_0x27071c[_0x3e9347(0x202)]['id'];dbBackupTask[_0x3e9347(0x1e4)](_0x27071c[_0x3e9347(0x1e5)][_0x3e9347(0x208)],_0x129bde),process['send']({'type':_0x3e9347(0x1f8)}),_0x586eb0[_0x3e9347(0x203)]({'code':0x0});}),router[_0x2e51ea(0x1d6)](_0x2e51ea(0x205),(_0x4066f3,_0x2349ee,_0x5ebcae)=>{const _0x23586c=_0x2e51ea;if(_0x4066f3[_0x23586c(0x1ec)][_0x23586c(0x1ea)]!=0x1)return _0x2349ee[_0x23586c(0x203)]({'code':0x66});let _0x4c0abe=_0x4066f3['body'][_0x23586c(0x1fc)],_0x306048=_0x4066f3[_0x23586c(0x202)]['taskId'],_0x21a91e=dbBackupTask[_0x23586c(0x1cf)](_0x4066f3[_0x23586c(0x1e5)]['dbOther'],_0x306048);if(!_0x21a91e)return _0x2349ee['json']({'code':0x1,'message':_0x23586c(0x1e2)});if(_0x4c0abe==_0x23586c(0x1d9)){let _0x49460f=dbBackupTask[_0x23586c(0x1f6)](_0x4066f3[_0x23586c(0x1e5)]['dbOther'],'\x20task_id=?\x20and\x20(status=\x27stop\x27\x20or\x20status=\x27waiting\x27\x20or\x20status=\x27running\x27)',[_0x306048]);if(_0x49460f){if(_0x49460f[_0x23586c(0x213)]==_0x23586c(0x1e3))return _0x2349ee[_0x23586c(0x203)]({'code':0x1,'message':_0x2349ee['__'](_0x23586c(0x20a)),'task_record':_0x49460f});else{if(_0x49460f['status']==_0x23586c(0x214))return _0x2349ee[_0x23586c(0x203)]({'code':0x1,'message':_0x2349ee['__'](_0x23586c(0x1fb)),'task_record':_0x49460f});else _0x49460f[_0x23586c(0x213)]==_0x23586c(0x1f7)&&dbBackupTask[_0x23586c(0x1d7)](_0x4066f3[_0x23586c(0x1e5)][_0x23586c(0x208)],_0x49460f['id'],'\x20status=\x27waiting\x27');}}else{let _0x3ebe83=moment()[_0x23586c(0x20b)]('YYYY-MM-DD\x20HH:mm:ss');dbBackupTask[_0x23586c(0x1e6)](_0x4066f3[_0x23586c(0x1e5)]['dbOther'],_0x306048,_0x23586c(0x1e3),_0x3ebe83);}}else{if(_0x4c0abe==_0x23586c(0x1f7)){let _0x390d5e=dbBackupTask[_0x23586c(0x1f6)](_0x4066f3[_0x23586c(0x1e5)][_0x23586c(0x208)],_0x23586c(0x1ce),[_0x306048]);if(!_0x390d5e)return _0x2349ee['json']({'code':0x1,'message':_0x2349ee['__']('noRunningTasks'),'task_record':_0x390d5e});else dbBackupTask[_0x23586c(0x1d7)](_0x4066f3[_0x23586c(0x1e5)]['dbOther'],_0x390d5e['id'],_0x23586c(0x206));}}process[_0x23586c(0x1dc)]({'type':_0x23586c(0x1f8)}),_0x2349ee['json']({'code':0x0});}),router['post']('/getAllTask',(_0x2c418a,_0x57bac5,_0x4f7135)=>{const _0x5299a9=_0x2e51ea;if(_0x2c418a['currentUser'][_0x5299a9(0x1ea)]!=0x1)return _0x57bac5['json']({'code':0x66});let _0x4dcef5=_0x2c418a['body'][_0x5299a9(0x1dd)],_0x4a8546=[];_0x4dcef5=parseInt(_0x4dcef5);_0x4dcef5?_0x4a8546=dbBackupTask[_0x5299a9(0x1ff)](_0x2c418a['app'][_0x5299a9(0x208)],_0x4dcef5):_0x4a8546=dbBackupTask[_0x5299a9(0x1f0)](_0x2c418a[_0x5299a9(0x1e5)]['dbOther']);for(let _0x1e4d7a in _0x4a8546){let _0x16f3b9=dbBackupTask[_0x5299a9(0x1f6)](_0x2c418a[_0x5299a9(0x1e5)][_0x5299a9(0x208)],_0x5299a9(0x1d2),[_0x4a8546[_0x1e4d7a]['id']]);_0x4a8546[_0x1e4d7a][_0x5299a9(0x1ef)]=_0x16f3b9;}_0x57bac5[_0x5299a9(0x203)]({'code':0x0,'data':_0x4a8546});}),router[_0x2e51ea(0x1d6)](_0x2e51ea(0x1d3),(_0x1c40aa,_0x5b1ef6,_0x4ad281)=>{const _0x2b89d4=_0x2e51ea;if(_0x1c40aa[_0x2b89d4(0x1ec)]['is_admin']!=0x1)return _0x5b1ef6[_0x2b89d4(0x203)]({'code':0x66});let _0x3c1597=_0x1c40aa[_0x2b89d4(0x202)]['id'],_0x33eb45=dbBackupTask[_0x2b89d4(0x1cf)](_0x1c40aa['app'][_0x2b89d4(0x208)],_0x3c1597);_0x5b1ef6[_0x2b89d4(0x203)]({'code':0x0,'data':_0x33eb45});}),router[_0x2e51ea(0x1d6)]('/getTaskRecords',(_0xd8960e,_0xfde068,_0x98c76a)=>{const _0x4d11d7=_0x2e51ea;if(_0xd8960e[_0x4d11d7(0x1ec)][_0x4d11d7(0x1ea)]!=0x1)return _0xfde068[_0x4d11d7(0x203)]({'code':0x66});let _0x43f321=_0xd8960e['body']['id'],_0x2151db=dbBackupTask[_0x4d11d7(0x1fa)](_0xd8960e[_0x4d11d7(0x1e5)]['dbOther'],'\x20task_id=?\x20and\x20status=\x27done\x27\x20order\x20by\x20id\x20desc\x20limit\x20100',[_0x43f321]);_0xfde068['json']({'code':0x0,'data':_0x2151db});}),router[_0x2e51ea(0x1d6)](_0x2e51ea(0x1e1),(_0x17a99e,_0x38c4c4,_0x142234)=>{const _0x244139=_0x2e51ea;if(_0x17a99e[_0x244139(0x1ec)]['is_admin']!=0x1)return _0x38c4c4[_0x244139(0x203)]({'code':0x66});let _0x5a160c=_0x17a99e['body']['recordId'],_0x15f0f0=dbBackupTask[_0x244139(0x209)](_0x17a99e[_0x244139(0x1e5)]['dbOther'],_0x244139(0x1ed),[_0x5a160c]);_0x38c4c4[_0x244139(0x203)]({'code':0x0,'data':_0x15f0f0});}),router[_0x2e51ea(0x1d6)](_0x2e51ea(0x211),(_0x8fb789,_0x16ff62,_0x2a1414)=>{const _0xba9d45=_0x2e51ea;if(_0x8fb789['currentUser']['is_admin']!=0x1)return _0x16ff62['json']({'code':0x66});let _0x454016=_0x8fb789[_0xba9d45(0x202)]['recordId'],_0x1efdb7=dbBackupTask[_0xba9d45(0x1fa)](_0x8fb789[_0xba9d45(0x1e5)][_0xba9d45(0x208)],_0xba9d45(0x204),[]);_0x16ff62['json']({'code':0x0,'data':_0x1efdb7});}),module[_0x2e51ea(0x1d8)]=router;