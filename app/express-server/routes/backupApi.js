const _0x2fd4ad=_0x4a8e;(function(_0x4fe331,_0x160236){const _0x3efd0d=_0x4a8e,_0x5e043e=_0x4fe331();while(!![]){try{const _0x2de351=-parseInt(_0x3efd0d(0x102))/0x1+parseInt(_0x3efd0d(0x108))/0x2+parseInt(_0x3efd0d(0x123))/0x3+-parseInt(_0x3efd0d(0x138))/0x4*(parseInt(_0x3efd0d(0xf3))/0x5)+-parseInt(_0x3efd0d(0x10f))/0x6*(-parseInt(_0x3efd0d(0x109))/0x7)+-parseInt(_0x3efd0d(0x11b))/0x8*(-parseInt(_0x3efd0d(0xf7))/0x9)+-parseInt(_0x3efd0d(0xef))/0xa;if(_0x2de351===_0x160236)break;else _0x5e043e['push'](_0x5e043e['shift']());}catch(_0x48f8a2){_0x5e043e['push'](_0x5e043e['shift']());}}}(_0x3686,0x81962));var express=require(_0x2fd4ad(0x10a)),router=express[_0x2fd4ad(0xfa)]();let path=require(_0x2fd4ad(0x117)),fs=require('fs');const dbBackupTask=require(_0x2fd4ad(0x13b));let moment=require(_0x2fd4ad(0x12e));router[_0x2fd4ad(0x110)](_0x2fd4ad(0x11d),(_0x2710f4,_0x46fda2,_0x59a1c7)=>{const _0x14f741=_0x2fd4ad;if(_0x2710f4[_0x14f741(0x122)][_0x14f741(0x136)]!=0x1)return _0x46fda2['json']({'code':0x66});let _0x338182=_0x2710f4[_0x14f741(0x118)][_0x14f741(0x125)],_0x5eed71=_0x2710f4[_0x14f741(0x118)][_0x14f741(0x103)],_0x2ccf75=_0x2710f4['body'][_0x14f741(0x10c)],_0x321bae=_0x2710f4[_0x14f741(0x118)]['excludeList'],_0x40ccf8=path[_0x14f741(0x12f)](_0x2710f4[_0x14f741(0x118)][_0x14f741(0xf2)]),_0xafbadd=_0x2710f4[_0x14f741(0x118)]['taskType'],_0x49d808=_0x2710f4['body']['taskDay'],_0x13b205=_0x2710f4[_0x14f741(0x118)][_0x14f741(0x11e)];if(/^\w\:\\$/[_0x14f741(0xf8)](_0x40ccf8))return _0x2710f4[_0x14f741(0xff)][_0x14f741(0x12d)](_0x46fda2,_0x46fda2['__'](_0x14f741(0x130)),_0x14f741(0x10b));let _0x52e28e=0x0;for(let _0x272af1 in _0x2ccf75){_0x2ccf75[_0x272af1]=path[_0x14f741(0x12f)](_0x2ccf75[_0x272af1]);if(/^\w\:\\$/[_0x14f741(0xf8)](_0x2ccf75[_0x272af1]))return _0x2710f4['app'][_0x14f741(0x12d)](_0x46fda2,_0x46fda2['__'](_0x14f741(0x130)),'dialog');fs[_0x14f741(0x115)](_0x2ccf75[_0x272af1],fs[_0x14f741(0xfb)][_0x14f741(0x116)],_0x21c831=>{const _0x19e376=_0x14f741;if(_0x21c831)return _0x2710f4[_0x19e376(0xff)][_0x19e376(0x12d)](_0x46fda2,_0x46fda2['__'](_0x19e376(0xfc))+':'+_0x2ccf75[_0x272af1]);_0x52e28e+=0x1,_0x52e28e==_0x2ccf75[_0x19e376(0x124)]&&_0x2c98db();});}function _0x2c98db(){const _0x30378b=_0x14f741;fs[_0x30378b(0x115)](_0x40ccf8,fs[_0x30378b(0xfb)][_0x30378b(0x101)]|fs['constants'][_0x30378b(0x116)],_0x87641b=>{const _0x44bd45=_0x30378b;if(_0x87641b)return console[_0x44bd45(0xf4)](_0x87641b),_0x2710f4[_0x44bd45(0xff)][_0x44bd45(0x12d)](_0x46fda2,_0x46fda2['__'](_0x44bd45(0xf6))+':'+_0x40ccf8);fs[_0x44bd45(0x135)](_0x40ccf8,(_0x27b659,_0x5e4c39)=>{const _0x26fbf8=_0x44bd45;if(_0x27b659||!_0x5e4c39['isDirectory']())return _0x2710f4[_0x26fbf8(0xff)][_0x26fbf8(0x12d)](_0x46fda2,_0x46fda2['__'](_0x26fbf8(0x11f)));let _0x146fed={'task_name':_0x5eed71,'source_list':JSON[_0x26fbf8(0x105)](_0x2ccf75),'exclude_list':JSON[_0x26fbf8(0x105)](_0x321bae),'target_path':_0x40ccf8,'task_type':_0xafbadd,'task_day':_0x49d808,'task_time':_0x13b205};if(_0x338182==_0x26fbf8(0x13a))dbBackupTask[_0x26fbf8(0x13a)](_0x2710f4[_0x26fbf8(0xff)]['dbOther'],_0x146fed);else{if(_0x338182==_0x26fbf8(0x112)){let _0x2011b9=_0x2710f4[_0x26fbf8(0x118)]['id'];dbBackupTask[_0x26fbf8(0x112)](_0x2710f4[_0x26fbf8(0xff)][_0x26fbf8(0x113)],_0x146fed,_0x2011b9);}}return process['send']({'type':_0x26fbf8(0x104)}),_0x46fda2[_0x26fbf8(0x111)]({'code':0x0});});});}}),router[_0x2fd4ad(0x110)]('/deleteTask',(_0x1f5227,_0x2e2684,_0x454e7f)=>{const _0x11e32c=_0x2fd4ad;if(_0x1f5227[_0x11e32c(0x122)][_0x11e32c(0x136)]!=0x1)return _0x2e2684[_0x11e32c(0x111)]({'code':0x66});let _0x3298d5=_0x1f5227[_0x11e32c(0x118)]['id'];dbBackupTask[_0x11e32c(0xf0)](_0x1f5227[_0x11e32c(0xff)]['dbOther'],_0x3298d5),process[_0x11e32c(0x128)]({'type':_0x11e32c(0x104)}),_0x2e2684[_0x11e32c(0x111)]({'code':0x0});}),router[_0x2fd4ad(0x110)](_0x2fd4ad(0x132),(_0x397c56,_0x2d0964,_0x3559ea)=>{const _0x34d1d7=_0x2fd4ad;if(_0x397c56['currentUser'][_0x34d1d7(0x136)]!=0x1)return _0x2d0964['json']({'code':0x66});let _0x4fcbbf=_0x397c56[_0x34d1d7(0x118)][_0x34d1d7(0x125)],_0x18e1dd=_0x397c56[_0x34d1d7(0x118)][_0x34d1d7(0x127)],_0x3bbc98=dbBackupTask[_0x34d1d7(0x11c)](_0x397c56[_0x34d1d7(0xff)][_0x34d1d7(0x113)],_0x18e1dd);if(!_0x3bbc98)return _0x2d0964['json']({'code':0x1,'message':'task\x20id\x20is\x20error'});if(_0x4fcbbf==_0x34d1d7(0x120)){let _0xd61177=dbBackupTask[_0x34d1d7(0xee)](_0x397c56[_0x34d1d7(0xff)][_0x34d1d7(0x113)],'\x20task_id=?\x20and\x20(status=\x27stop\x27\x20or\x20status=\x27waiting\x27\x20or\x20status=\x27running\x27)',[_0x18e1dd]);if(_0xd61177){if(_0xd61177[_0x34d1d7(0x133)]==_0x34d1d7(0x137))return _0x2d0964[_0x34d1d7(0x111)]({'code':0x1,'message':_0x2d0964['__'](_0x34d1d7(0x139)),'task_record':_0xd61177});else{if(_0xd61177['status']==_0x34d1d7(0x121))return _0x2d0964[_0x34d1d7(0x111)]({'code':0x1,'message':_0x2d0964['__'](_0x34d1d7(0x100)),'task_record':_0xd61177});else _0xd61177[_0x34d1d7(0x133)]==_0x34d1d7(0x12c)&&dbBackupTask[_0x34d1d7(0xf5)](_0x397c56[_0x34d1d7(0xff)][_0x34d1d7(0x113)],_0xd61177['id'],'\x20status=\x27waiting\x27');}}else{let _0x55756c=moment()[_0x34d1d7(0x11a)]('YYYY-MM-DD\x20HH:mm:ss');dbBackupTask[_0x34d1d7(0x114)](_0x397c56[_0x34d1d7(0xff)][_0x34d1d7(0x113)],_0x18e1dd,_0x34d1d7(0x137),_0x55756c);}}else{if(_0x4fcbbf=='stop'){let _0x490be5=dbBackupTask['getRecordByWhere'](_0x397c56[_0x34d1d7(0xff)]['dbOther'],_0x34d1d7(0x12a),[_0x18e1dd]);if(!_0x490be5)return _0x2d0964[_0x34d1d7(0x111)]({'code':0x1,'message':_0x2d0964['__'](_0x34d1d7(0x106)),'task_record':_0x490be5});else dbBackupTask[_0x34d1d7(0xf5)](_0x397c56[_0x34d1d7(0xff)][_0x34d1d7(0x113)],_0x490be5['id'],_0x34d1d7(0x131));}}process[_0x34d1d7(0x128)]({'type':_0x34d1d7(0x104)}),_0x2d0964[_0x34d1d7(0x111)]({'code':0x0});}),router[_0x2fd4ad(0x110)]('/getAllTask',(_0x2f7c8a,_0x321168,_0x4a78c4)=>{const _0x43582a=_0x2fd4ad;if(_0x2f7c8a['currentUser'][_0x43582a(0x136)]!=0x1)return _0x321168[_0x43582a(0x111)]({'code':0x66});let _0x123d9e=_0x2f7c8a[_0x43582a(0x118)][_0x43582a(0xf1)],_0x2d5590=[];_0x123d9e=parseInt(_0x123d9e);_0x123d9e?_0x2d5590=dbBackupTask[_0x43582a(0x10d)](_0x2f7c8a[_0x43582a(0xff)][_0x43582a(0x113)],_0x123d9e):_0x2d5590=dbBackupTask['getAll'](_0x2f7c8a[_0x43582a(0xff)][_0x43582a(0x113)]);for(let _0xed2e11 in _0x2d5590){let _0x201cec=dbBackupTask[_0x43582a(0xee)](_0x2f7c8a[_0x43582a(0xff)]['dbOther'],'\x20task_id=?\x20order\x20by\x20id\x20desc\x20limit\x201',[_0x2d5590[_0xed2e11]['id']]);_0x2d5590[_0xed2e11]['lastRecord']=_0x201cec;}_0x321168[_0x43582a(0x111)]({'code':0x0,'data':_0x2d5590});}),router[_0x2fd4ad(0x110)]('/getTaskById',(_0x35ad67,_0x430efa,_0x425e96)=>{const _0x4cc6c1=_0x2fd4ad;if(_0x35ad67[_0x4cc6c1(0x122)][_0x4cc6c1(0x136)]!=0x1)return _0x430efa['json']({'code':0x66});let _0x48c784=_0x35ad67[_0x4cc6c1(0x118)]['id'],_0x5bb52f=dbBackupTask['getById'](_0x35ad67[_0x4cc6c1(0xff)][_0x4cc6c1(0x113)],_0x48c784);_0x430efa['json']({'code':0x0,'data':_0x5bb52f});}),router[_0x2fd4ad(0x110)](_0x2fd4ad(0x129),(_0x1a4870,_0x35f68a,_0x454e9c)=>{const _0x1872ea=_0x2fd4ad;if(_0x1a4870[_0x1872ea(0x122)][_0x1872ea(0x136)]!=0x1)return _0x35f68a['json']({'code':0x66});let _0x3b4918=_0x1a4870[_0x1872ea(0x118)]['id'],_0x549e94=dbBackupTask['getAllRecordByWhere'](_0x1a4870[_0x1872ea(0xff)][_0x1872ea(0x113)],_0x1872ea(0x119),[_0x3b4918]);_0x35f68a['json']({'code':0x0,'data':_0x549e94});}),router[_0x2fd4ad(0x110)](_0x2fd4ad(0x12b),(_0x1636cc,_0x398ffb,_0x317694)=>{const _0x41599a=_0x2fd4ad;if(_0x1636cc[_0x41599a(0x122)][_0x41599a(0x136)]!=0x1)return _0x398ffb['json']({'code':0x66});let _0x1ce271=_0x1636cc['body'][_0x41599a(0x107)],_0x30f376=dbBackupTask[_0x41599a(0xfd)](_0x1636cc[_0x41599a(0xff)][_0x41599a(0x113)],_0x41599a(0xf9),[_0x1ce271]);_0x398ffb['json']({'code':0x0,'data':_0x30f376});}),router[_0x2fd4ad(0x110)](_0x2fd4ad(0x134),(_0x38fd71,_0xd85068,_0x52d744)=>{const _0x48b14f=_0x2fd4ad;if(_0x38fd71[_0x48b14f(0x122)][_0x48b14f(0x136)]!=0x1)return _0xd85068['json']({'code':0x66});let _0x4d303a=_0x38fd71['body'][_0x48b14f(0x107)],_0x57d19a=dbBackupTask[_0x48b14f(0x10e)](_0x38fd71[_0x48b14f(0xff)]['dbOther'],_0x48b14f(0x126),[]);_0xd85068['json']({'code':0x0,'data':_0x57d19a});}),module[_0x2fd4ad(0xfe)]=router;function _0x4a8e(_0x26ddef,_0x4b8cb0){const _0x3686c0=_0x3686();return _0x4a8e=function(_0x4a8edf,_0x50dc77){_0x4a8edf=_0x4a8edf-0xee;let _0x326f32=_0x3686c0[_0x4a8edf];return _0x326f32;},_0x4a8e(_0x26ddef,_0x4b8cb0);}function _0x3686(){const _0x556baa=['update','dbOther','createRecord','access','R_OK','path','body','\x20task_id=?\x20and\x20status=\x27done\x27\x20order\x20by\x20id\x20desc\x20limit\x20100','format','281304FkjaMX','getById','/createTask','taskTime','noGetFolderStat','start','running','currentUser','2350077DcdPFM','length','type','\x20status=\x27running\x27\x20or\x20status=\x27waiting\x27','taskId','send','/getTaskRecords','\x20task_id=?\x20and\x20status=\x27running\x27','/getTaskRecordMsg','stop','returnErrMsg','moment','join','cannotUseRootPathAsBackupTarget','\x20status=\x27stop\x27','/operationTask','status','/getRunningTaskList','stat','is_admin','waiting','1521896QfhgJu','taskAlreadQueued','create','../../db/dbBackupTask','getRecordByWhere','12280710AvOfpk','delete','taskType','targetPath','10Tehdbw','log','updateRecord','noWritePermission','144aAYyWp','test','\x20task_record_id=?\x20order\x20by\x20id\x20desc\x20limit\x20100','Router','constants','noReadPermission','getAllRecordMsgByWhere','exports','app','taskAlreadyRunning','W_OK','608891eFovsi','taskName','initBackupWorker','stringify','noRunningTasks','recordId','1938796RMtGBw','334901eJQBqQ','express','dialog','sourceList','getAllByTaskType','getAllRecordByWhere','102lhEmgp','post','json'];_0x3686=function(){return _0x556baa;};return _0x3686();}