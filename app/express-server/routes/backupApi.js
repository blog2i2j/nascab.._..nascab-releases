const _0x11abaf=_0x2b26;(function(_0x598f0b,_0x3bebca){const _0x3dc7f0=_0x2b26,_0x7bd423=_0x598f0b();while(!![]){try{const _0x1e29b1=-parseInt(_0x3dc7f0(0x132))/0x1+parseInt(_0x3dc7f0(0x14b))/0x2+-parseInt(_0x3dc7f0(0x138))/0x3*(-parseInt(_0x3dc7f0(0x13f))/0x4)+parseInt(_0x3dc7f0(0x172))/0x5+-parseInt(_0x3dc7f0(0x16b))/0x6+parseInt(_0x3dc7f0(0x135))/0x7*(-parseInt(_0x3dc7f0(0x12f))/0x8)+-parseInt(_0x3dc7f0(0x150))/0x9*(-parseInt(_0x3dc7f0(0x156))/0xa);if(_0x1e29b1===_0x3bebca)break;else _0x7bd423['push'](_0x7bd423['shift']());}catch(_0x5a377a){_0x7bd423['push'](_0x7bd423['shift']());}}}(_0x3256,0x337a3));function _0x3256(){const _0x1da2b4=['stringify','updateRecord','Router','noReadPermission','waiting','1203164IIUHmQ','getById','start','\x20task_id=?\x20and\x20status=\x27running\x27','\x20task_id=?\x20and\x20status=\x27done\x27\x20order\x20by\x20id\x20desc\x20limit\x20100','isDirectory','lastRecord','R_OK','taskAlreadyRunning','taskType','getRecordByWhere','YYYY-MM-DD\x20HH:mm:ss','582406SeeUkg','type','update','post','/getTaskById','207AuVAqS','recordId','\x20task_id=?\x20and\x20(status=\x27stop\x27\x20or\x20status=\x27waiting\x27\x20or\x20status=\x27running\x27)','cannotUseRootPathAsBackupTarget','W_OK','excludeList','158230dFiyAQ','sourceList','getAllRecordByWhere','\x20status=\x27waiting\x27','create','access','length','/getRunningTaskList','body','dialog','taskAlreadQueued','getAllRecordMsgByWhere','log','taskTime','/deleteTask','taskDay','send','constants','json','getAll','exports','1042314pfuFed','format','app','running','moment','/getAllTask','taskId','828620LQexSG','initBackupWorker','returnErrMsg','\x20task_id=?\x20order\x20by\x20id\x20desc\x20limit\x201','test','currentUser','is_admin','status','noWritePermission','noRunningTasks','872UXREFq','express','stat','315465rFoLyf','task\x20id\x20is\x20error','createRecord','27076rqpLKx','dbOther','join','3wjIfxH','stop'];_0x3256=function(){return _0x1da2b4;};return _0x3256();}var express=require(_0x11abaf(0x130)),router=express[_0x11abaf(0x13c)]();let path=require('path'),fs=require('fs');function _0x2b26(_0x4974b4,_0x53f3dd){const _0x325639=_0x3256();return _0x2b26=function(_0x2b26b4,_0x2ff530){_0x2b26b4=_0x2b26b4-0x129;let _0x599836=_0x325639[_0x2b26b4];return _0x599836;},_0x2b26(_0x4974b4,_0x53f3dd);}const dbBackupTask=require('../../db/dbBackupTask');let moment=require(_0x11abaf(0x16f));router['post']('/createTask',(_0x4de1f3,_0x1a291e,_0x13990e)=>{const _0x3a94f9=_0x11abaf;if(_0x4de1f3[_0x3a94f9(0x12a)][_0x3a94f9(0x12b)]!=0x1)return _0x1a291e[_0x3a94f9(0x168)]({'code':0x66});let _0xf7f5f2=_0x4de1f3['body'][_0x3a94f9(0x14c)],_0x3359a6=_0x4de1f3[_0x3a94f9(0x15e)]['taskName'],_0x39762c=_0x4de1f3[_0x3a94f9(0x15e)][_0x3a94f9(0x157)],_0x39ba8b=_0x4de1f3['body'][_0x3a94f9(0x155)],_0x5dc68c=path['join'](_0x4de1f3[_0x3a94f9(0x15e)]['targetPath']),_0x143457=_0x4de1f3['body'][_0x3a94f9(0x148)],_0x434f72=_0x4de1f3[_0x3a94f9(0x15e)][_0x3a94f9(0x165)],_0x27146b=_0x4de1f3[_0x3a94f9(0x15e)][_0x3a94f9(0x163)];if(/^\w\:\\$/[_0x3a94f9(0x129)](_0x5dc68c))return _0x4de1f3[_0x3a94f9(0x16d)][_0x3a94f9(0x174)](_0x1a291e,_0x1a291e['__'](_0x3a94f9(0x153)),_0x3a94f9(0x15f));let _0x4ce890=0x0;for(let _0x53b93d in _0x39762c){_0x39762c[_0x53b93d]=path[_0x3a94f9(0x137)](_0x39762c[_0x53b93d]);if(/^\w\:\\$/['test'](_0x39762c[_0x53b93d]))return _0x4de1f3[_0x3a94f9(0x16d)][_0x3a94f9(0x174)](_0x1a291e,_0x1a291e['__'](_0x3a94f9(0x153)),'dialog');fs[_0x3a94f9(0x15b)](_0x39762c[_0x53b93d],fs[_0x3a94f9(0x167)][_0x3a94f9(0x146)],_0x5ed81d=>{const _0x33fc35=_0x3a94f9;if(_0x5ed81d)return _0x4de1f3['app'][_0x33fc35(0x174)](_0x1a291e,_0x1a291e['__'](_0x33fc35(0x13d))+':'+_0x39762c[_0x53b93d]);_0x4ce890+=0x1,_0x4ce890==_0x39762c[_0x33fc35(0x15c)]&&_0x3ef459();});}function _0x3ef459(){const _0x2cb64c=_0x3a94f9;fs[_0x2cb64c(0x15b)](_0x5dc68c,fs['constants'][_0x2cb64c(0x154)]|fs[_0x2cb64c(0x167)]['R_OK'],_0xd89699=>{const _0x27d0d7=_0x2cb64c;if(_0xd89699)return console[_0x27d0d7(0x162)](_0xd89699),_0x4de1f3[_0x27d0d7(0x16d)][_0x27d0d7(0x174)](_0x1a291e,_0x1a291e['__'](_0x27d0d7(0x12d))+':'+_0x5dc68c);fs[_0x27d0d7(0x131)](_0x5dc68c,(_0x327c43,_0x1bbb09)=>{const _0x15a9b6=_0x27d0d7;if(_0x327c43||!_0x1bbb09[_0x15a9b6(0x144)]())return _0x4de1f3['app'][_0x15a9b6(0x174)](_0x1a291e,_0x1a291e['__']('noGetFolderStat'));let _0x1fa7e8={'task_name':_0x3359a6,'source_list':JSON['stringify'](_0x39762c),'exclude_list':JSON[_0x15a9b6(0x13a)](_0x39ba8b),'target_path':_0x5dc68c,'task_type':_0x143457,'task_day':_0x434f72,'task_time':_0x27146b};if(_0xf7f5f2=='create')dbBackupTask[_0x15a9b6(0x15a)](_0x4de1f3[_0x15a9b6(0x16d)][_0x15a9b6(0x136)],_0x1fa7e8);else{if(_0xf7f5f2=='update'){let _0x401542=_0x4de1f3[_0x15a9b6(0x15e)]['id'];dbBackupTask[_0x15a9b6(0x14d)](_0x4de1f3['app'][_0x15a9b6(0x136)],_0x1fa7e8,_0x401542);}}return process['send']({'type':_0x15a9b6(0x173)}),_0x1a291e[_0x15a9b6(0x168)]({'code':0x0});});});}}),router[_0x11abaf(0x14e)](_0x11abaf(0x164),(_0x10c6f2,_0x19f3e6,_0x1f4c07)=>{const _0x59c30a=_0x11abaf;if(_0x10c6f2[_0x59c30a(0x12a)][_0x59c30a(0x12b)]!=0x1)return _0x19f3e6[_0x59c30a(0x168)]({'code':0x66});let _0xb8d73=_0x10c6f2['body']['id'];dbBackupTask['delete'](_0x10c6f2[_0x59c30a(0x16d)][_0x59c30a(0x136)],_0xb8d73),process[_0x59c30a(0x166)]({'type':_0x59c30a(0x173)}),_0x19f3e6['json']({'code':0x0});}),router[_0x11abaf(0x14e)]('/operationTask',(_0xe4cf22,_0x5331e7,_0x2fa306)=>{const _0x5b64ce=_0x11abaf;if(_0xe4cf22[_0x5b64ce(0x12a)][_0x5b64ce(0x12b)]!=0x1)return _0x5331e7[_0x5b64ce(0x168)]({'code':0x66});let _0x4a4f96=_0xe4cf22['body']['type'],_0x4691c7=_0xe4cf22[_0x5b64ce(0x15e)][_0x5b64ce(0x171)],_0x4004b3=dbBackupTask[_0x5b64ce(0x140)](_0xe4cf22[_0x5b64ce(0x16d)][_0x5b64ce(0x136)],_0x4691c7);if(!_0x4004b3)return _0x5331e7[_0x5b64ce(0x168)]({'code':0x1,'message':_0x5b64ce(0x133)});if(_0x4a4f96==_0x5b64ce(0x141)){let _0x1642ad=dbBackupTask[_0x5b64ce(0x149)](_0xe4cf22[_0x5b64ce(0x16d)][_0x5b64ce(0x136)],_0x5b64ce(0x152),[_0x4691c7]);if(_0x1642ad){if(_0x1642ad[_0x5b64ce(0x12c)]==_0x5b64ce(0x13e))return _0x5331e7['json']({'code':0x1,'message':_0x5331e7['__'](_0x5b64ce(0x160)),'task_record':_0x1642ad});else{if(_0x1642ad[_0x5b64ce(0x12c)]==_0x5b64ce(0x16e))return _0x5331e7[_0x5b64ce(0x168)]({'code':0x1,'message':_0x5331e7['__'](_0x5b64ce(0x147)),'task_record':_0x1642ad});else _0x1642ad[_0x5b64ce(0x12c)]==_0x5b64ce(0x139)&&dbBackupTask[_0x5b64ce(0x13b)](_0xe4cf22[_0x5b64ce(0x16d)]['dbOther'],_0x1642ad['id'],_0x5b64ce(0x159));}}else{let _0x181207=moment()[_0x5b64ce(0x16c)](_0x5b64ce(0x14a));dbBackupTask[_0x5b64ce(0x134)](_0xe4cf22[_0x5b64ce(0x16d)][_0x5b64ce(0x136)],_0x4691c7,_0x5b64ce(0x13e),_0x181207);}}else{if(_0x4a4f96==_0x5b64ce(0x139)){let _0x16a74e=dbBackupTask[_0x5b64ce(0x149)](_0xe4cf22['app'][_0x5b64ce(0x136)],_0x5b64ce(0x142),[_0x4691c7]);if(!_0x16a74e)return _0x5331e7[_0x5b64ce(0x168)]({'code':0x1,'message':_0x5331e7['__'](_0x5b64ce(0x12e)),'task_record':_0x16a74e});else dbBackupTask['updateRecord'](_0xe4cf22[_0x5b64ce(0x16d)][_0x5b64ce(0x136)],_0x16a74e['id'],'\x20status=\x27stop\x27');}}process[_0x5b64ce(0x166)]({'type':_0x5b64ce(0x173)}),_0x5331e7[_0x5b64ce(0x168)]({'code':0x0});}),router[_0x11abaf(0x14e)](_0x11abaf(0x170),(_0x4bdb81,_0x5b7c66,_0x48abce)=>{const _0x9e21ee=_0x11abaf;if(_0x4bdb81[_0x9e21ee(0x12a)][_0x9e21ee(0x12b)]!=0x1)return _0x5b7c66[_0x9e21ee(0x168)]({'code':0x66});let _0xb6410b=_0x4bdb81['body'][_0x9e21ee(0x148)],_0x5751fc=[];_0xb6410b=parseInt(_0xb6410b);_0xb6410b?_0x5751fc=dbBackupTask['getAllByTaskType'](_0x4bdb81[_0x9e21ee(0x16d)]['dbOther'],_0xb6410b):_0x5751fc=dbBackupTask[_0x9e21ee(0x169)](_0x4bdb81[_0x9e21ee(0x16d)][_0x9e21ee(0x136)]);for(let _0x105513 in _0x5751fc){let _0x192982=dbBackupTask[_0x9e21ee(0x149)](_0x4bdb81[_0x9e21ee(0x16d)][_0x9e21ee(0x136)],_0x9e21ee(0x175),[_0x5751fc[_0x105513]['id']]);_0x5751fc[_0x105513][_0x9e21ee(0x145)]=_0x192982;}_0x5b7c66[_0x9e21ee(0x168)]({'code':0x0,'data':_0x5751fc});}),router[_0x11abaf(0x14e)](_0x11abaf(0x14f),(_0x145776,_0x5b17ca,_0x1c1fa7)=>{const _0x217e3c=_0x11abaf;if(_0x145776[_0x217e3c(0x12a)]['is_admin']!=0x1)return _0x5b17ca[_0x217e3c(0x168)]({'code':0x66});let _0x3c8feb=_0x145776['body']['id'],_0xc07708=dbBackupTask[_0x217e3c(0x140)](_0x145776[_0x217e3c(0x16d)][_0x217e3c(0x136)],_0x3c8feb);_0x5b17ca[_0x217e3c(0x168)]({'code':0x0,'data':_0xc07708});}),router[_0x11abaf(0x14e)]('/getTaskRecords',(_0x71b73d,_0x2afe25,_0x107f05)=>{const _0x175c0d=_0x11abaf;if(_0x71b73d['currentUser'][_0x175c0d(0x12b)]!=0x1)return _0x2afe25[_0x175c0d(0x168)]({'code':0x66});let _0x32eec0=_0x71b73d['body']['id'],_0x502eac=dbBackupTask['getAllRecordByWhere'](_0x71b73d['app'][_0x175c0d(0x136)],_0x175c0d(0x143),[_0x32eec0]);_0x2afe25[_0x175c0d(0x168)]({'code':0x0,'data':_0x502eac});}),router['post']('/getTaskRecordMsg',(_0x4fc4af,_0x1fa7d8,_0x20070f)=>{const _0x4c2eb7=_0x11abaf;if(_0x4fc4af[_0x4c2eb7(0x12a)]['is_admin']!=0x1)return _0x1fa7d8[_0x4c2eb7(0x168)]({'code':0x66});let _0x433ef0=_0x4fc4af[_0x4c2eb7(0x15e)][_0x4c2eb7(0x151)],_0x5dac9e=dbBackupTask[_0x4c2eb7(0x161)](_0x4fc4af[_0x4c2eb7(0x16d)]['dbOther'],'\x20task_record_id=?\x20order\x20by\x20id\x20desc\x20limit\x20100',[_0x433ef0]);_0x1fa7d8[_0x4c2eb7(0x168)]({'code':0x0,'data':_0x5dac9e});}),router[_0x11abaf(0x14e)](_0x11abaf(0x15d),(_0x314a8d,_0x17e1c8,_0x2e0359)=>{const _0x1befbe=_0x11abaf;if(_0x314a8d[_0x1befbe(0x12a)][_0x1befbe(0x12b)]!=0x1)return _0x17e1c8[_0x1befbe(0x168)]({'code':0x66});let _0x1d4c1a=_0x314a8d[_0x1befbe(0x15e)][_0x1befbe(0x151)],_0x295220=dbBackupTask[_0x1befbe(0x158)](_0x314a8d[_0x1befbe(0x16d)][_0x1befbe(0x136)],'\x20status=\x27running\x27\x20or\x20status=\x27waiting\x27',[]);_0x17e1c8[_0x1befbe(0x168)]({'code':0x0,'data':_0x295220});}),module[_0x11abaf(0x16a)]=router;