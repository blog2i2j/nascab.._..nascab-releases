const _0x50db54=_0x43a4;(function(_0x3b4d51,_0x174e96){const _0x4d5288=_0x43a4,_0xcd89a5=_0x3b4d51();while(!![]){try{const _0x2d5aeb=-parseInt(_0x4d5288(0x1ef))/0x1+-parseInt(_0x4d5288(0x283))/0x2+-parseInt(_0x4d5288(0x2bf))/0x3*(parseInt(_0x4d5288(0x22d))/0x4)+-parseInt(_0x4d5288(0x1c7))/0x5*(parseInt(_0x4d5288(0x216))/0x6)+parseInt(_0x4d5288(0x1e8))/0x7*(-parseInt(_0x4d5288(0x24f))/0x8)+-parseInt(_0x4d5288(0x2bb))/0x9+parseInt(_0x4d5288(0x242))/0xa;if(_0x2d5aeb===_0x174e96)break;else _0xcd89a5['push'](_0xcd89a5['shift']());}catch(_0x1f50b0){_0xcd89a5['push'](_0xcd89a5['shift']());}}}(_0x1733,0x3ed15));let express=require('express'),router=express[_0x50db54(0x288)](),path=require(_0x50db54(0x2c4));const sharp=require(_0x50db54(0x1e2)),config=require(_0x50db54(0x1cf)),dbFileIndexTable=require(_0x50db54(0x2e1)),dbSourceFolderTable=require(_0x50db54(0x1c1)),dbFileOperationRecord=require(_0x50db54(0x1d5));let checkUtil=require(_0x50db54(0x280));const sqliteUtil=require(_0x50db54(0x2c2)),exifUtils=require('../../utils/exifUtils'),dbUserTable=require('../../db/dbUserTable'),dbAlbumTable=require(_0x50db54(0x1c4));function _0x1733(){const _0x265091=['is_admin','year','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_class_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27','../../db/dbFileIndexTable','update\x20file_index_photo\x20set\x20ai_face_detect_state=0','startSimilarPhotoWork','\x20is_file,id,path,filename,ext,duration,size\x20','end','/resetSimilarPhotoAi','movie','encode','timeType','filename_number','genTinyFile','doUserCanGet','power_change','desc','update\x20file_index_photo\x20set\x20phash=null,phash_compare=0','sortType','aiFaceMinPhotoCount','getPathByType','type','book','SELECT\x20id,path,filename,original_date,size\x20FROM\x20file_index_photo\x20where\x20id=','faceapi','basename','isFile','operationFail','/resetFaceAi','index_id','parse','is_file','\x20\x20\x20AND\x20in_trash!=1\x20','getPathWhere','photoSavedAsNewFile','searchStr','ExifIFD','SELECT\x20f.id\x20FROM\x20photo_faces2index\x20as\x20p\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20p.photo_index_id=f.id\x20WHERE\x20p.face_id=?\x20','getUserPathWhere','resize','isIndexing','replace','data_value','path_list','substring','join','value','/addAlbum','f2x','GPSDateStamp','trim','extract','dump','showFileType','\x20in_trash=0\x20AND\x20latitude!=\x27undefined\x27\x20AND\x20longitude!=\x27undefined\x27\x20AND\x20latitude\x20is\x20not\x20null','%\x27)\x20','toString','SELECT\x20*\x20FROM\x20file_index_photo\x20WHERE\x20in_trash=1\x20AND\x20is_file=1\x20AND\x20raw_filename\x20is\x20not\x20null\x20AND\x20raw_filename!=\x27\x27\x20AND\x20type=1','power_add','trash','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','shell','\x27,geohash4=\x27','GET','/getSimilarPhoto','delete\x20from\x20photo_faces2index\x20where\x201=1','/operationLibrary','/getPhotoByTime','\x20AND\x20geohash\x20LIKE\x20?\x20','keepIndexList','setFaceId','search','\x20order\x20by\x20score\x20desc','ordinaryAlbumId','indexObj','../../db/dbSourceFolderTable','UPDATE\x20photo_faces2index\x20SET\x20face_id=?\x20WHERE\x20face_id=?\x20and\x20photo_index_id=?','\x20AND\x20geohash4!=\x27undefined\x27\x20GROUP\x20BY\x20geohash4','../../db/dbAlbumTable','fileExist','/setFacePoster','443570EfDtMc','\x20id,geohash,latitude,longitude\x20','rotate','updateBySql','defaultTranscodeResolution','ngeohash','getByName','findByTitle','../../myConfig/config','stat','\x20WHERE\x20title\x20like\x20?','REPLACE\x20INTO\x20photo_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','face_id','\x20(((type=1\x20or\x20type=2)\x20\x20)\x20OR\x20is_file=0\x20)\x20','../../db/dbFileOperationRecord','/deleteAlbum','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20','cacheDeleteFail','sourceFolderList','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20disabled=0\x20and\x20belong_face_id\x20is\x20null\x20and\x20face_photo_count>=?\x20order\x20by\x20face_photo_count\x20desc\x20limit\x20500','UPDATE\x20photo_faces\x20SET\x20face_name=?\x20where\x20id\x20=\x20?','faceApiWaitDealCount','sendFile','jpeg','\x20ORDER\x20BY\x20','\x20id\x20in\x20(','sharp','searchMode','binary','dirname','similar_index_id','searchValue','791YydgWM','getAlbumWhereStr','getList','GPSLatitude','findWithField','folderNotExist','getFullYear','391680RSJsbK','dataPreview','exports','libraryId','\x20AND\x20geohash5!=\x27undefined\x27\x20GROUP\x20BY\x20geohash5','SELECT\x20f.id\x20as\x20photo_index_id\x20FROM\x20ai_classes2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20a.photo_index_id=f.id\x20WHERE\x20a.class_id=?\x20and\x20score>?\x20and\x20\x20f.in_trash=0\x20\x20and\x20f.tiny_path\x20is\x20not\x20null\x20AND\x20f.tiny_path\x20!=\x20\x270\x27\x20\x20','../utils/fileUtils','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time,latitude,longitude\x20','shareUidList','.HEIC','face_img_path','ERROR\x20GPS\x20LOCATION','minLng','body','operation\x20fail','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id\x20limit\x20','maxLng','moviePlaylongPressRate','photo_index_id','UPDATE\x20photo_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','minIndexId','maxLat','editId','\x20SET\x20in_trash=1,in_trash_time=','similarIndexList','TYPE_DELETE','dbFileIndex','DELETE','id,is_file,is_livephoto,path,filename,raw_filename,is_raw','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20id\x20=\x20?','writeFile','faceApiWaitCompareCount','isVip','geohash2\x20=\x20','SELECT\x20f.id,f.path,f.filename,f.original_date,f.size\x20FROM\x20photo_phash_similar\x20as\x20a\x20inner\x20join\x20file_index_photo\x20as\x20f\x20on\x20a.similar_index_id=f.id\x20where\x20a.index_id=','udpateName','count','STATE_FAIL','f2width','18TSubQR','transaction','\x20and\x20a.is_face_poster=1\x20limit\x201','\x20OFFSET\x20','%\x27\x20OR\x20mode\x20\x20LIKE\x20\x27%','\x20\x20AND\x20filename\x20LIKE\x20\x27%','floor','\x20and\x20title\x20like\x20?','insert','getAllByWhere','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=1\x20where\x20photo_index_id\x20=\x20','Image\x20format\x20not\x20support','/switchFaceId','app','faceName','getById','\x20LIMIT\x201','GPSLatitudeRef','getByWhere','asc','.JPG','\x27,original_date=\x27','length','1528216Drdigd','%\x27\x20','getPhotoByParams','/removeFromFace','存在livephoto','orderType','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?','utimes','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20photo_faces2index\x20WHERE\x20compare_state=0','then','class_id','/clearTrashBin','geoInfoWriteErr','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20phash\x20is\x20null\x20and\x20type=1','dbOther','mtime','moviePreferLanguage','/getBoundsPhoto','extname','noPermission','status','23101660dHNZQv','power_delete','getAllByWhereAndField','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=0\x20where\x20is_face_poster=1\x20and\x20face_id\x20in\x20','is_livephoto','dialog','piexifjs','zoom','indexId','send','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','album.sameNameExist','INDEX_TABLE_NAME_PHOTO','23704VLbEeI','includes','ADD','/dealSimilarPhoto','run','.jpg','stringify','\x27,geohash3=\x27','INDEX_TABLE_NAME_MUSIC','transSpcielFormat','/searchMode','size','Cleaning\x20out\x20the\x20recycle\x20bin\x20:\x20','getMonth','prepare','power_get','offset','getTime','EDIT','\x27,geohash2=\x27','../utils/nasAccountUtils','/getAiDealState','\x20LIMIT\x20','latitude','\x20LIMIT\x20?\x20OFFSET\x20?','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20face_name=?\x20and\x20belong_face_id\x20is\x20null','imgList','close','getExcludePathWhereStr','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27\x27\x20where\x20id=','getCountByWhere','timestamp','\x20in_trash=1\x20and\x20is_file=1\x20','getAllByWhereAndFieldFromOrdinaryAlbumCount','returnErrMsg','toLowerCase','orderField','.jpeg','GPSIFD','photo','query','\x27,longitude=\x27','\x20AND\x20\x20is_file=1\x20','load','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20id=?','post','Exif','\x20order\x20by\x20f.original_time\x20desc\x20limit\x201','username','../utils/checkUtil','\x20is_file=1\x20','original_time','375588bBRwEe','name','albumId','create','GPS','Router','/getIndexDetail','UPDATE\x20','mkdir','aiFaceEnable','(\x27mouse\x27,\x27person\x27,\x27traffic\x20light\x27,\x27stop\x20sign\x27,\x27parking\x20meter\x27,\x27fire\x20hydrant\x27)','facesPath','\x20and\x20face_id=','\x20AND\x20','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?\x20or\x20belong_face_id=?','SELECT\x20*\x20FROM\x20ai_classes\x20where\x20\x20class_name\x20not\x20in\x20','f2y','changes','parent','serverType','../utils/sharpUtils','\x20AND\x20in_trash=0\x20\x20\x20AND\x20is_file=1\x20\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20limit\x201','abs','rawFaceId','SELECT\x20*\x20FROM\x20photo_library\x20','DELETE\x20FROM\x20photo_faces2index\x20where\x20face_id=?\x20and\x20photo_index_id\x20=?','operation','update','\x20AND\x20geohash2!=\x27undefined\x27\x20GROUP\x20BY\x20geohash2','../../myWorkers/index/photoIndexUtil','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20share_for_subuser=1','f2height','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time\x20','UPDATE\x20photo_faces\x20SET\x20face_name=null\x20where\x20face_name\x20=\x20?','delete\x20from\x20photo_faces\x20where\x201=1','\x20\x20AND\x20(filename\x20LIKE\x20\x27%','/restoreTrashBinFiles','order\x20field\x20error','\x20SET\x20in_trash=0\x20WHERE\x20in_trash=1','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id','DELETE\x20FROM\x20photo_library\x20\x20WHERE\x20id=?','create_time','video','deleteRawTempFile','log','dealList','INDEX_TABLE_NAME_MOVIE','atleastChooseTwoFaces','push','sortField','shareForSubUser','\x20type=1\x20','文件写入成功','/getFaceImg/*','toFile','/getFileTreePhoto','4413384QdTGOY','json','\x27\x20AND\x20','getFaceInSql','3MBZhwI','filename','.MP4','../utils/sqliteUtil','currentUser','path','faceId','/getPhotoFaces','get','endsWith','\x20type=2\x20\x20','fileType','/getAlbumPhotoForMap','getDate','indexFullPath','targetFaceId','./photoApiUtils','startFaceAiWork','data','similar','addFileOperationRecord','f2id','longitude','share_uid','/editExifByIndexId','all','getAllByWhereAndFieldFromOrdinaryAlbum','ctimeMs','excludePathPhoto','/updateAlbum','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_face_detect_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20'];_0x1733=function(){return _0x265091;};return _0x1733();}let geohash=require(_0x50db54(0x1cc)),fs=require('fs');function _0x43a4(_0x23959f,_0x426d2e){const _0x173353=_0x1733();return _0x43a4=function(_0x43a47c,_0x381e0c){_0x43a47c=_0x43a47c-0x183;let _0x5a48e4=_0x173353[_0x43a47c];return _0x5a48e4;},_0x43a4(_0x23959f,_0x426d2e);}const dbConfigTable=require('../../db/dbConfigTable');let sharpUtil=require(_0x50db54(0x297)),nasAccountUtil=require(_0x50db54(0x263)),fileUtil=require(_0x50db54(0x1f5));const photoApiUtil=require(_0x50db54(0x2cf)),platform=require('os')['platform'](),photoIndexUtil=require(_0x50db54(0x2a0));let piexif=require(_0x50db54(0x248));router['post']('/getTimeLineDateList',(_0x4de669,_0x5aad1c,_0x51815a)=>{const _0x17860f=_0x50db54;if(dbUserTable[_0x17860f(0x184)](_0x4de669,_0x5aad1c,_0x17860f(0x276),_0x17860f(0x25e))==!![]){let _0x4bf959=_0x4de669[_0x17860f(0x1fc)][_0x17860f(0x2df)],_0x2ac074=_0x4de669['body']['type'],_0x57e3d6=_0x4de669[_0x17860f(0x1fc)]['geohash'],_0x4d52d9=_0x4de669[_0x17860f(0x1fc)][_0x17860f(0x285)],_0x3b5f44=_0x4de669['body']['searchStr'],_0x39306c=_0x4de669[_0x17860f(0x1fc)][_0x17860f(0x1bf)],_0x26119a=_0x4de669['body']['aiClassId'],_0x2d31ff=_0x4de669[_0x17860f(0x1fc)]['libraryId'],_0x39245f=_0x4de669[_0x17860f(0x1fc)][_0x17860f(0x2c5)],_0x4aa4d0=_0x4de669[_0x17860f(0x1fc)]['timeOrder'],_0x2f1e75=_0x4de669[_0x17860f(0x1fc)][_0x17860f(0x1da)],_0x2406d4=dbUserTable[_0x17860f(0x19c)](_0x4de669,_0x17860f(0x276),_0x17860f(0x25e),!![],_0x2f1e75),_0x2360c7=_0x2406d4,_0x4aa2c7=[];_0x57e3d6&&(_0x2360c7+=_0x17860f(0x1ba),_0x4aa2c7[_0x17860f(0x2b3)](_0x57e3d6+'%'));let _0x27ef95=dbSourceFolderTable[_0x17860f(0x26b)](_0x4de669[_0x17860f(0x223)]['dbOther'],_0x17860f(0x2c4),_0x17860f(0x2db));_0x27ef95&&(_0x2360c7+=_0x17860f(0x290)+_0x27ef95);let _0x60c6f8=dbSourceFolderTable[_0x17860f(0x26b)](_0x4de669[_0x17860f(0x223)][_0x17860f(0x23b)],_0x17860f(0x2c0),'excludeFilenamePhoto');_0x60c6f8&&(_0x2360c7+=_0x17860f(0x290)+_0x60c6f8);if(_0x2d31ff){let _0x3bc1ba=_0x4de669['app'][_0x17860f(0x209)][_0x17860f(0x25d)](_0x17860f(0x233))[_0x17860f(0x2c7)](_0x2d31ff);if(_0x3bc1ba)try{let _0x3ae583=JSON[_0x17860f(0x194)](_0x3bc1ba['path_list']),_0x1c12da=dbUserTable[_0x17860f(0x197)](!![],_0x3ae583);_0x2360c7+=_0x1c12da;}catch(_0x85ed72){console[_0x17860f(0x2af)](_0x85ed72);}}if(_0x4d52d9){let _0xf64f0f=dbAlbumTable['getAlbumWhereStr'](_0x4de669[_0x17860f(0x223)][_0x17860f(0x23b)],_0x4d52d9);_0xf64f0f&&(_0x2360c7+='\x20AND\x20'+_0xf64f0f);}_0x3b5f44&&(_0x2360c7+='\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)',_0x4aa2c7[_0x17860f(0x2b3)]('%'+_0x3b5f44+'%'),_0x4aa2c7[_0x17860f(0x2b3)]('%'+_0x3b5f44+'%'));_0x2360c7+=_0x17860f(0x196);let _0x5a991c=dbFileIndexTable['getTimeLineDateList'](_0x4de669[_0x17860f(0x223)][_0x17860f(0x209)],_0x4bf959,_0x2ac074,_0x2360c7,_0x39306c,_0x26119a,_0x39245f,_0x4aa2c7,_0x4aa4d0);_0x5aad1c['json']({'code':0x0,'data':_0x5a991c});}}),router[_0x50db54(0x27c)](_0x50db54(0x1b9),(_0x34f776,_0x2ee109,_0x2e73fe)=>{const _0x371db8=_0x50db54;dbUserTable[_0x371db8(0x184)](_0x34f776,_0x2ee109,_0x371db8(0x276),_0x371db8(0x25e))==!![]&&(result=photoApiUtil[_0x371db8(0x22f)](_0x34f776,_0x2ee109),_0x2ee109[_0x371db8(0x2bc)]({'code':0x0,'data':result}));}),router['post'](_0x50db54(0x2cb),(_0x1ea193,_0x56fcb8,_0x1f2536)=>{const _0x12fba1=_0x50db54;let _0x2f2985=dbUserTable['getUserPathWhere'](_0x1ea193,_0x12fba1(0x276),'power_get',!![]),_0x373907='\x20id,latitude,longitude,geohash,tiny_path',_0x22e546=_0x12fba1(0x1ac),_0x1f3d30=_0x1ea193['body']['libraryId'];if(_0x1ea193[_0x12fba1(0x1fc)]['albumId']){let _0x36c641=dbAlbumTable[_0x12fba1(0x1e9)](_0x1ea193[_0x12fba1(0x223)][_0x12fba1(0x23b)],_0x1ea193[_0x12fba1(0x1fc)]['albumId']);_0x36c641&&(_0x22e546+=_0x12fba1(0x290)+_0x36c641);}if(_0x1f3d30){let _0x1230ec=_0x1ea193['app'][_0x12fba1(0x209)]['prepare'](_0x12fba1(0x233))[_0x12fba1(0x2c7)](_0x1f3d30);if(_0x1230ec)try{let _0x1ae406=JSON[_0x12fba1(0x194)](_0x1230ec[_0x12fba1(0x1a1)]),_0x5c826d=dbUserTable[_0x12fba1(0x197)](!![],_0x1ae406);_0x22e546+=_0x5c826d;}catch(_0x1e28a9){console[_0x12fba1(0x2af)](_0x1e28a9);}}function _0x2f6f54(_0x237e14,_0x552b7c,_0x2ff4c8){const _0x63cb0c=_0x12fba1;if(_0x2ff4c8){let _0x25f33b=0x0;if(_0x1ea193[_0x63cb0c(0x1fc)][_0x63cb0c(0x1bf)]){let _0x4c52ac=dbFileIndexTable[_0x63cb0c(0x270)](_0x1ea193[_0x63cb0c(0x223)][_0x63cb0c(0x209)],_0x1ea193[_0x63cb0c(0x1fc)][_0x63cb0c(0x1bf)],_0x237e14);_0x25f33b=_0x4c52ac[_0x63cb0c(0x213)];}else{let _0x52f663=dbFileIndexTable[_0x63cb0c(0x26d)](_0x1ea193[_0x63cb0c(0x223)]['dbFileIndex'],_0x237e14);_0x25f33b=_0x52f663[_0x63cb0c(0x213)];}return _0x25f33b;}else{let _0x51a5ab=[];return _0x1ea193[_0x63cb0c(0x1fc)][_0x63cb0c(0x1bf)]?_0x51a5ab=dbFileIndexTable[_0x63cb0c(0x2d9)](_0x1ea193[_0x63cb0c(0x223)][_0x63cb0c(0x209)],_0x1ea193['body']['ordinaryAlbumId'],_0x237e14,_0x552b7c):_0x51a5ab=dbFileIndexTable[_0x63cb0c(0x244)](_0x1ea193[_0x63cb0c(0x223)][_0x63cb0c(0x209)],_0x237e14,_0x552b7c,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),_0x51a5ab;}}_0x22e546+=_0x2f2985,_0x22e546+=_0x12fba1(0x279);let _0x378b35=0xc8,_0x5b2376=[],_0x48180f=_0x2f6f54(_0x22e546,null,!![]);if(_0x48180f<_0x378b35)_0x5b2376=_0x2f6f54(_0x22e546,'*');else{let _0x48be72=_0x22e546+_0x12fba1(0x1f3),_0x277d08=_0x2f6f54(_0x48be72,'*');if(_0x277d08&&_0x277d08[_0x12fba1(0x22c)]<_0x378b35)_0x5b2376=_0x277d08;else{let _0xecd981=_0x22e546+_0x12fba1(0x1c3),_0x415343=_0x2f6f54(_0xecd981,'*');if(_0x415343&&_0x415343[_0x12fba1(0x22c)]<_0x378b35)_0x5b2376=_0x415343;else{let _0x84c3b1=_0x22e546+'\x20AND\x20geohash3!=\x27undefined\x27\x20GROUP\x20BY\x20geohash3',_0x58e001=_0x2f6f54(_0x84c3b1,'*');if(_0x58e001&&_0x58e001['length']<_0x378b35)_0x5b2376=_0x58e001;else{let _0x4c1c80=_0x22e546+_0x12fba1(0x29f);_0x5b2376=_0x2f6f54(_0x4c1c80,'*');}}}}return _0x56fcb8[_0x12fba1(0x2bc)]({'code':0x0,'mapPhoto':_0x5b2376});}),router[_0x50db54(0x27c)](_0x50db54(0x23e),(_0xd0655f,_0x55f10e,_0x4092fc)=>{const _0x14462d=_0x50db54;if(dbUserTable[_0x14462d(0x184)](_0xd0655f,_0x55f10e,'photo',_0x14462d(0x25e))==!![]){let _0x4a9c5d=dbUserTable[_0x14462d(0x19c)](_0xd0655f,_0x14462d(0x276),'power_get',!![]),_0x492441=_0xd0655f[_0x14462d(0x1fc)]['minLat'],_0x5122ad=_0xd0655f[_0x14462d(0x1fc)][_0x14462d(0x1fb)],_0x353e1c=_0xd0655f[_0x14462d(0x1fc)][_0x14462d(0x204)],_0xc74249=_0xd0655f[_0x14462d(0x1fc)][_0x14462d(0x1ff)],_0x522eb4=_0xd0655f[_0x14462d(0x1fc)][_0x14462d(0x249)],_0x111b7d='',_0x44206d=0x2;if(_0x522eb4<=0x4)_0x44206d=0x2,_0x111b7d=_0x14462d(0x210);else{if(_0x522eb4<=0x6)_0x44206d=0x3,_0x111b7d='geohash3\x20=\x20';else{if(_0x522eb4<=0x8)_0x44206d=0x4,_0x111b7d='geohash4\x20=\x20';else _0x522eb4<=0xc&&(_0x44206d=0x5,_0x111b7d='geohash5\x20=\x20');}}let _0x392456=geohash['bboxes'](_0x492441,_0x5122ad,_0x353e1c,_0xc74249,_0x44206d),_0x204107=[];for(let _0x34a8c7=0x0;_0x34a8c7<_0x392456[_0x14462d(0x22c)];_0x34a8c7++){let _0x342a98=_0x392456[_0x34a8c7],_0x2568a7='\x20'+_0x111b7d+'\x20\x27'+_0x342a98+'\x27\x20'+_0x4a9c5d+_0x14462d(0x298),_0x1621c1=dbFileIndexTable[_0x14462d(0x228)](_0xd0655f[_0x14462d(0x223)][_0x14462d(0x209)],_0x2568a7,_0x14462d(0x1c8));_0x1621c1&&_0x204107[_0x14462d(0x2b3)](_0x1621c1);}_0x55f10e['json']({'code':0x0,'mapPhoto':_0x204107});}}),router[_0x50db54(0x27c)](_0x50db54(0x1a5),(_0x2bcee9,_0x21416e,_0x17556e)=>{const _0x1bbb2c=_0x50db54;if(dbUserTable[_0x1bbb2c(0x184)](_0x2bcee9,_0x21416e,_0x1bbb2c(0x276),_0x1bbb2c(0x1b0))==!![]){let _0x145fd1=_0x2bcee9[_0x1bbb2c(0x1fc)][_0x1bbb2c(0x18b)],_0x1bc0ee=_0x2bcee9['body'][_0x1bbb2c(0x2d1)],_0x38b1e0=_0x2bcee9[_0x1bbb2c(0x1fc)][_0x1bbb2c(0x1a0)],_0x44f010=_0x2bcee9[_0x1bbb2c(0x1fc)][_0x1bbb2c(0x284)],_0xff1cd9=_0x2bcee9[_0x1bbb2c(0x1fc)][_0x1bbb2c(0x205)];if(!_0x1bc0ee||!_0x1bc0ee[_0x1bbb2c(0x1e7)]||sqliteUtil['checkSqlInjection'](_0x1bc0ee[_0x1bbb2c(0x1e7)])==!![])return _0x2bcee9[_0x1bbb2c(0x223)][_0x1bbb2c(0x271)](_0x21416e,'error\x20data');if(!_0xff1cd9){let _0x4c6e18=dbAlbumTable[_0x1bbb2c(0x1cd)](_0x2bcee9[_0x1bbb2c(0x223)]['dbOther'],_0x44f010);if(_0x4c6e18)return _0x2bcee9[_0x1bbb2c(0x223)][_0x1bbb2c(0x271)](_0x21416e,_0x21416e['__'](_0x1bbb2c(0x24d)));}let _0x3e4d62=null;_0xff1cd9?_0x3e4d62=dbAlbumTable[_0x1bbb2c(0x29e)](_0x2bcee9[_0x1bbb2c(0x223)][_0x1bbb2c(0x23b)],{'type':_0x145fd1,'data':_0x1bc0ee,'data_value':_0x38b1e0,'name':_0x44f010},_0xff1cd9):_0x3e4d62=dbAlbumTable[_0x1bbb2c(0x286)](_0x2bcee9[_0x1bbb2c(0x223)]['dbOther'],{'type':_0x145fd1,'data':_0x1bc0ee,'data_value':_0x38b1e0,'name':_0x44f010}),_0x21416e[_0x1bbb2c(0x2bc)]({'code':0x0,'result':_0x3e4d62});}}),router[_0x50db54(0x27c)](_0x50db54(0x1d6),(_0x1f6a30,_0x64210d,_0x96c970)=>{const _0x5a1d17=_0x50db54;if(dbUserTable[_0x5a1d17(0x184)](_0x1f6a30,_0x64210d,'photo','power_delete')==!![]){let _0x2f1068=_0x1f6a30['body']['id'],_0x428554=dbAlbumTable['delete'](_0x1f6a30['app'][_0x5a1d17(0x23b)],_0x2f1068);_0x428554[_0x5a1d17(0x294)]>0x0?_0x64210d[_0x5a1d17(0x2bc)]({'code':0x0,'result':_0x428554}):_0x64210d[_0x5a1d17(0x2bc)]({'code':0x1,'message':_0x5a1d17(0x1fd)});}}),router[_0x50db54(0x27c)](_0x50db54(0x2dc),(_0x4cacc8,_0x2487f0,_0x20d377)=>{const _0xe23428=_0x50db54;if(dbUserTable[_0xe23428(0x184)](_0x4cacc8,_0x2487f0,_0xe23428(0x276),_0xe23428(0x185))==!![]){let _0x3d572f=_0x4cacc8['body']['id'],_0x4c37ef=_0x4cacc8[_0xe23428(0x1fc)]['name'],_0x19adbe=dbAlbumTable['getByName'](_0x4cacc8[_0xe23428(0x223)][_0xe23428(0x23b)],_0x4c37ef);if(_0x19adbe)return _0x4cacc8[_0xe23428(0x223)][_0xe23428(0x271)](_0x2487f0,_0x2487f0['__']('album.sameNameExist'));let _0x457313=dbAlbumTable[_0xe23428(0x212)](_0x4cacc8['app'][_0xe23428(0x23b)],_0x3d572f,_0x4c37ef);_0x457313['changes']>0x0?_0x2487f0[_0xe23428(0x2bc)]({'code':0x0,'result':_0x457313}):_0x2487f0[_0xe23428(0x2bc)]({'code':0x1,'message':'operation\x20fail'});}}),router[_0x50db54(0x27c)]('/getAllAlbum',(_0x2db874,_0x281c6b,_0x384d01)=>{const _0x4e78c1=_0x50db54;if(dbUserTable[_0x4e78c1(0x184)](_0x2db874,_0x281c6b,_0x4e78c1(0x276),_0x4e78c1(0x25e))==!![]){let _0x3b527e=dbUserTable[_0x4e78c1(0x19c)](_0x2db874,_0x4e78c1(0x276),_0x4e78c1(0x25e),!![]),_0x53f4be=_0x2db874['body'][_0x4e78c1(0x213)]||0x32,_0x4519cf=_0x2db874[_0x4e78c1(0x1fc)][_0x4e78c1(0x25f)]||0x0,_0x3857cf=_0x2db874['body']['orderField']||'id',_0xfb7db8=_0x2db874[_0x4e78c1(0x1fc)]['orderType']||_0x4e78c1(0x186),_0x19eaa3=_0x2db874['body'][_0x4e78c1(0x1bd)];(!['name','id'][_0x4e78c1(0x250)](_0x3857cf)||![_0x4e78c1(0x229),_0x4e78c1(0x186)][_0x4e78c1(0x250)](_0xfb7db8))&&_0x281c6b['json']({'code':0x0,'data':[]});let _0x22b4ad=dbAlbumTable[_0x4e78c1(0x1ea)](_0x2db874[_0x4e78c1(0x223)][_0x4e78c1(0x23b)],_0x53f4be,_0x4519cf,_0x3857cf,_0xfb7db8,_0x19eaa3);for(let _0x5a6e3f=0x0;_0x5a6e3f<_0x22b4ad[_0x4e78c1(0x22c)];_0x5a6e3f++){let _0x3431f9=_0x4e78c1(0x281);_0x3431f9+=_0x3b527e;let _0x2e201e=dbAlbumTable[_0x4e78c1(0x1e9)](_0x2db874['app'][_0x4e78c1(0x23b)],_0x22b4ad[_0x5a6e3f]['id']);_0x2e201e&&(_0x3431f9+=_0x4e78c1(0x290)+_0x2e201e);_0x3431f9+=_0x4e78c1(0x24c),_0x3431f9+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';try{let _0x470cfa=dbFileIndexTable[_0x4e78c1(0x21f)](_0x2db874[_0x4e78c1(0x223)][_0x4e78c1(0x209)],_0x3431f9);_0x22b4ad[_0x5a6e3f][_0x4e78c1(0x269)]=_0x470cfa;}catch(_0x52baff){console[_0x4e78c1(0x2af)](_0x52baff),_0x22b4ad[_0x5a6e3f][_0x4e78c1(0x269)]=[];}}_0x281c6b['json']({'code':0x0,'data':_0x22b4ad});}}),router['post'](_0x50db54(0x259),(_0x58f930,_0x23e071,_0x1e7aa5)=>{const _0x5eae24=_0x50db54;let _0x33fba9=_0x58f930['body']['key'],_0x53ec6b=dbFileIndexTable[_0x5eae24(0x1e3)](_0x58f930['app'][_0x5eae24(0x209)],_0x33fba9),_0x58667b=[];for(let _0x5a913a=0x0;_0x5a913a<_0x53ec6b[_0x5eae24(0x22c)];_0x5a913a++){_0x58667b[_0x5eae24(0x2b3)](_0x53ec6b[_0x5a913a]['mode']);}_0x23e071[_0x5eae24(0x2bc)]({'code':0x0,'data':_0x58667b});}),router[_0x50db54(0x27c)](_0x50db54(0x2ba),(_0x25e4ca,_0x35c7f8,_0x3dceb5)=>{const _0x2d836e=_0x50db54;let _0x5b5715=_0x25e4ca[_0x2d836e(0x1fc)][_0x2d836e(0x295)],_0x4f1419=_0x25e4ca[_0x2d836e(0x1fc)]['serveType'],_0x181c04=_0x25e4ca[_0x2d836e(0x1fc)]['count'],_0x2d578c=_0x25e4ca[_0x2d836e(0x1fc)]['offset']||0x0;_0x2d578c=parseInt(_0x2d578c);let _0x3c6942=parseInt(_0x25e4ca['body'][_0x2d836e(0x1ab)]),_0x98ae04=_0x25e4ca[_0x2d836e(0x1fc)][_0x2d836e(0x199)],_0x11940a=[_0x2d836e(0x2c0),_0x2d836e(0x282),_0x2d836e(0x25a),_0x2d836e(0x2ac),_0x2d836e(0x2ea)],_0x4df25c=[_0x2d836e(0x229),_0x2d836e(0x186)],_0x1bdfba=_0x25e4ca[_0x2d836e(0x1fc)]['orderField']||'id',_0xe04246=_0x25e4ca[_0x2d836e(0x1fc)][_0x2d836e(0x232)]||_0x2d836e(0x186);!_0x11940a[_0x2d836e(0x250)](_0x1bdfba)&&(_0x1bdfba='id');!_0x4df25c['includes'](_0xe04246)&&(_0x1bdfba=_0x2d836e(0x186));if(dbUserTable[_0x2d836e(0x184)](_0x25e4ca,_0x35c7f8,_0x4f1419,_0x2d836e(0x25e))==!![]){let _0x2a4439=[];if(!_0x5b5715){let _0x18d7c9=[];_0x25e4ca[_0x2d836e(0x2c3)][_0x2d836e(0x2de)]==0x1?_0x18d7c9=dbSourceFolderTable[_0x2d836e(0x18a)](_0x25e4ca['app']['dbOther'],_0x4f1419):_0x18d7c9=dbUserTable['getUserPower'](_0x25e4ca[_0x2d836e(0x223)][_0x2d836e(0x23b)],_0x25e4ca['currentUser'][_0x2d836e(0x27f)],_0x4f1419);if(_0x18d7c9)for(let _0x4dfe75=0x0;_0x4dfe75<_0x18d7c9['length'];_0x4dfe75++){_0x2a4439[_0x2d836e(0x2b3)]({'path':_0x18d7c9[_0x4dfe75][_0x2d836e(0x2c4)],'is_file':0x0,'filename':path[_0x2d836e(0x18f)](_0x18d7c9[_0x4dfe75]['path']),'root':!![]});}}else{if(_0x25e4ca[_0x2d836e(0x2c3)][_0x2d836e(0x2de)]!=0x1){if(dbUserTable[_0x2d836e(0x184)](_0x25e4ca,_0x35c7f8,_0x4f1419,_0x2d836e(0x25e),_0x5b5715)!==!![])return;}_0x5b5715=path[_0x2d836e(0x1a3)](_0x5b5715),_0x5b5715=_0x5b5715[_0x2d836e(0x19f)](/\'/g,'\x27\x27');let _0x170aa3='\x20path=\x27'+_0x5b5715+_0x2d836e(0x2bd);if(_0x3c6942==0x0)_0x170aa3+=_0x2d836e(0x1d4);else{if(_0x3c6942==0x1)_0x170aa3+=_0x2d836e(0x2b6);else{if(_0x3c6942==0x2)_0x170aa3+=_0x2d836e(0x2c9);else _0x3c6942==0x3&&(_0x170aa3+='\x20is_file=0\x20');}}if(_0x98ae04){let _0x2a6376=_0x2d836e(0x2a6)+_0x98ae04+_0x2d836e(0x21a)+_0x98ae04+_0x2d836e(0x1ad);_0x4f1419==_0x2d836e(0x2e7)&&(_0x2a6376=_0x2d836e(0x21b)+_0x98ae04+_0x2d836e(0x22e)),_0x170aa3+=_0x2a6376;}let _0x4a5cc5=_0x2d836e(0x1f6),_0x5cce96=dbFileIndexTable['getIndexTableNameByType'](_0x4f1419);if(_0x4f1419==_0x2d836e(0x2e7))_0x4a5cc5=_0x2d836e(0x2a3);else _0x4f1419=='music'&&(_0x4a5cc5=_0x2d836e(0x2e4));_0x170aa3+='\x20ORDER\x20BY\x20is_file\x20asc,\x20'+_0x1bdfba+'\x20'+_0xe04246+_0x2d836e(0x265)+_0x181c04+_0x2d836e(0x219)+_0x2d578c,_0x2a4439=dbFileIndexTable['getAllByWhere'](_0x25e4ca[_0x2d836e(0x223)][_0x2d836e(0x209)],_0x170aa3,_0x4a5cc5,_0x5cce96);}let _0x14068e=path['sep'],_0x52c7c2={'platform':platform,'code':0x0,'data':_0x2a4439,'sep':_0x14068e};return _0x35c7f8[_0x2d836e(0x2bc)](_0x52c7c2);}}),router[_0x50db54(0x27c)](_0x50db54(0x289),(_0x5d9209,_0x263b71,_0x2d7db7)=>{const _0x35ee16=_0x50db54;let _0x5c886b=_0x5d9209[_0x35ee16(0x1fc)]['id'],_0x176784=_0x5d9209[_0x35ee16(0x1fc)][_0x35ee16(0x296)],_0x561358=dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'];if(_0x176784==_0x35ee16(0x2e7))_0x561358=dbFileIndexTable[_0x35ee16(0x2b1)];else{if(_0x176784=='music')_0x561358=dbFileIndexTable[_0x35ee16(0x257)];else _0x176784==_0x35ee16(0x18c)&&(_0x561358=dbFileIndexTable['INDEX_TABLE_NAME_BOOK']);}let _0x21bfd3=dbFileIndexTable[_0x35ee16(0x225)](_0x5d9209[_0x35ee16(0x223)]['dbFileIndex'],_0x5c886b,_0x561358);if(!_0x21bfd3)return _0x263b71['status'](0x194)['end']();if(dbUserTable[_0x35ee16(0x184)](_0x5d9209,_0x263b71,'',_0x35ee16(0x25e),_0x21bfd3[_0x35ee16(0x2c4)])==!![]){let _0x2a7087={'code':0x0,'data':_0x21bfd3};if(_0x176784==_0x35ee16(0x2e7)){let _0x40890c=dbConfigTable[_0x35ee16(0x1ce)](_0x5d9209['app']['dbOther'],'moviePreferLanguage');_0x2a7087[_0x35ee16(0x23d)]=_0x40890c?_0x40890c[_0x35ee16(0x1a4)]:'chi',_0x2a7087[_0x35ee16(0x2d1)][_0x35ee16(0x23d)]=_0x2a7087[_0x35ee16(0x23d)];let _0x496e7a=dbConfigTable['findByTitle'](_0x5d9209[_0x35ee16(0x223)]['dbOther'],_0x35ee16(0x200));_0x2a7087[_0x35ee16(0x200)]=_0x496e7a?_0x496e7a[_0x35ee16(0x1a4)]:'2',_0x2a7087[_0x35ee16(0x2d1)]['moviePlaylongPressRate']=_0x2a7087[_0x35ee16(0x200)];let _0x316772=dbConfigTable[_0x35ee16(0x1ce)](_0x5d9209[_0x35ee16(0x223)][_0x35ee16(0x23b)],_0x35ee16(0x1cb));_0x2a7087[_0x35ee16(0x1cb)]=_0x316772?_0x316772['value']:'3';let _0x182a30=path[_0x35ee16(0x1a3)](_0x21bfd3[_0x35ee16(0x2c4)],_0x21bfd3[_0x35ee16(0x2c0)]);fs[_0x35ee16(0x1d0)](_0x182a30,(_0x214b12,_0x376974)=>{const _0x43c5fb=_0x35ee16;return _0x214b12?(_0x2a7087['fileExist']=0x0,_0x2a7087[_0x43c5fb(0x2cd)]=_0x182a30):(_0x2a7087[_0x43c5fb(0x1c5)]=0x1,_0x2a7087[_0x43c5fb(0x2cd)]=_0x182a30),_0x263b71[_0x43c5fb(0x2bc)](_0x2a7087);});}else return _0x263b71[_0x35ee16(0x2bc)](_0x2a7087);}}),router[_0x50db54(0x27c)](_0x50db54(0x2d7),(_0x59816e,_0x477f82,_0x3f95f9)=>{const _0x2348de=_0x50db54;if(dbUserTable[_0x2348de(0x184)](_0x59816e,_0x477f82,_0x2348de(0x276),_0x2348de(0x185))==!![]){let _0x7b2227=_0x59816e['body']['id'],_0x2c67a6=_0x59816e[_0x2348de(0x1fc)][_0x2348de(0x266)],_0x13d682=_0x59816e['body'][_0x2348de(0x2d5)],_0xe7b021=_0x59816e[_0x2348de(0x1fc)]['newDate'],_0x3ed787=dbFileIndexTable[_0x2348de(0x225)](_0x59816e['app']['dbFileIndex'],_0x7b2227);if(!_0x3ed787)return _0x59816e['app'][_0x2348de(0x271)](_0x477f82,_0x477f82['__'](_0x2348de(0x198)));let _0x888176=path['join'](_0x3ed787['path'],path['sep'],_0x3ed787[_0x2348de(0x2c0)]),_0x4d2c48=path[_0x2348de(0x23f)](_0x888176)?path[_0x2348de(0x23f)](_0x888176)[_0x2348de(0x272)]():'';if(_0x4d2c48!=_0x2348de(0x254)&&_0x4d2c48!=_0x2348de(0x274))return _0x59816e[_0x2348de(0x223)]['returnErrMsg'](_0x477f82,_0x2348de(0x221));fs[_0x2348de(0x1d0)](_0x888176,(_0xc2d0aa,_0x9c382d)=>{const _0xff5098=_0x2348de;if(_0xc2d0aa||!_0x9c382d[_0xff5098(0x190)]())return _0x59816e[_0xff5098(0x223)][_0xff5098(0x271)](_0x477f82,_0x477f82['__'](_0xff5098(0x1ed)));if(_0xc2d0aa||!_0x9c382d[_0xff5098(0x190)]())return _0x59816e[_0xff5098(0x223)][_0xff5098(0x271)](_0x477f82,_0x477f82['__'](_0xff5098(0x1ed)));fs['readFile'](_0x888176,(_0x24ec42,_0x1dec04)=>{const _0xe1cb81=_0xff5098;if(_0x24ec42)return _0x59816e[_0xe1cb81(0x223)][_0xe1cb81(0x271)](_0x477f82,_0x477f82['__'](_0xe1cb81(0x191)));var _0x764770=piexif[_0xe1cb81(0x27a)](_0x1dec04['toString'](_0xe1cb81(0x1e4)));if(_0x2c67a6&&_0x13d682){function _0x3ee18a(_0x446d15){const _0x1ffcc2=_0xe1cb81;try{_0x446d15=Number(_0x446d15);let _0x5d6539=Math[_0x1ffcc2(0x21c)](Math[_0x1ffcc2(0x299)](_0x446d15)),_0xb51759=(Math[_0x1ffcc2(0x299)](_0x446d15)-_0x5d6539)*0x3c,_0x37f9f5=Math[_0x1ffcc2(0x21c)](_0xb51759),_0x599f4e=Math['round']((_0xb51759-_0x37f9f5)*0x3c*0x64);return[[_0x5d6539,0x1],[_0x37f9f5,0x1],[_0x599f4e,0x64]];}catch(_0x542cff){return'';}}let _0x2f2637=_0x3ee18a(_0x2c67a6),_0x4ef9c7=_0x3ee18a(_0x13d682);if(!_0x4ef9c7||!_0x2f2637)return _0x59816e[_0xe1cb81(0x223)][_0xe1cb81(0x271)](_0x477f82,_0xe1cb81(0x1fa));_0x764770[_0xe1cb81(0x287)][piexif[_0xe1cb81(0x275)][_0xe1cb81(0x227)]]=_0x2c67a6>=0x0?'N':'S',_0x764770[_0xe1cb81(0x287)][piexif[_0xe1cb81(0x275)][_0xe1cb81(0x1eb)]]=_0x2f2637,(_0x764770[_0xe1cb81(0x287)][piexif[_0xe1cb81(0x275)]['GPSLongitudeRef']]=_0x13d682>=0x0?'E':'W',_0x764770[_0xe1cb81(0x287)][piexif[_0xe1cb81(0x275)]['GPSLongitude']]=_0x4ef9c7);let _0x417aef=geohash[_0xe1cb81(0x2e8)](_0x2c67a6,_0x13d682,0x8),_0x1ffb07=_0x417aef[_0xe1cb81(0x1a2)](0x0,0x5),_0x447461=_0x417aef[_0xe1cb81(0x1a2)](0x0,0x4),_0x23d942=_0x417aef[_0xe1cb81(0x1a2)](0x0,0x3),_0x430f14=_0x417aef['substring'](0x0,0x2);dbFileIndexTable[_0xe1cb81(0x1ca)](_0x59816e[_0xe1cb81(0x223)][_0xe1cb81(0x209)],_0x3ed787['id'],'\x20latitude=\x27'+_0x2c67a6+_0xe1cb81(0x278)+_0x13d682+'\x27,geohash=\x27'+_0x417aef+'\x27,geohash5=\x27'+_0x1ffb07+_0xe1cb81(0x1b4)+_0x447461+_0xe1cb81(0x256)+_0x23d942+_0xe1cb81(0x262)+_0x430f14+'\x27\x20');}if(_0xe7b021){_0x764770[_0xe1cb81(0x27d)][piexif[_0xe1cb81(0x19a)]['DateTimeOriginal']]=_0xe7b021,_0x764770[_0xe1cb81(0x287)][piexif[_0xe1cb81(0x275)][_0xe1cb81(0x1a7)]]=_0xe7b021;let _0x2b7def=new Date(_0xe7b021),_0x304a99=_0x2b7def[_0xe1cb81(0x260)](),_0x2e2d74=_0x2b7def[_0xe1cb81(0x1ee)](),_0x56026b=_0x2b7def[_0xe1cb81(0x25c)]()+0x1;_0x56026b=_0x56026b>=0xa?_0x56026b:'0'+_0x56026b;let _0x159423=_0x2b7def[_0xe1cb81(0x2cc)]();_0x159423=_0x159423>=0xa?_0x159423:'0'+_0x159423;let _0x5476df=_0x2e2d74+'-'+_0x56026b+'-'+_0x159423;dbFileIndexTable['updateBySql'](_0x59816e[_0xe1cb81(0x223)][_0xe1cb81(0x209)],_0x3ed787['id'],'\x20original_time=\x27'+_0x304a99+_0xe1cb81(0x22b)+_0x5476df+'\x27\x20');}try{var _0x56f5dd=piexif[_0xe1cb81(0x1aa)](_0x764770),_0x41fd74=piexif[_0xe1cb81(0x21e)](_0x56f5dd,_0x1dec04[_0xe1cb81(0x1ae)](_0xe1cb81(0x1e4)));let _0x5a92a6=path[_0xe1cb81(0x1a3)](_0x3ed787['path'],_0x3ed787[_0xe1cb81(0x2c0)]);fs[_0xe1cb81(0x20d)](_0x5a92a6,Buffer['from'](_0x41fd74,'binary'),{},_0x5a9e29=>{const _0x3dda2b=_0xe1cb81;if(_0x5a9e29)return console[_0x3dda2b(0x2af)](_0x5a9e29),_0x59816e[_0x3dda2b(0x223)][_0x3dda2b(0x271)](_0x477f82,_0x477f82['__'](_0x3dda2b(0x191)));console[_0x3dda2b(0x2af)](_0x3dda2b(0x2b7)),fs[_0x3dda2b(0x234)](_0x5a92a6,new Date(_0x3ed787[_0x3dda2b(0x23c)]),new Date(_0x3ed787['mtime']),_0x4d0b41=>{const _0x3a2e01=_0x3dda2b;_0x4d0b41&&console['log'](_0x4d0b41),fs[_0x3a2e01(0x1d0)](_0x5a92a6,(_0x1ae1b9,_0x213525)=>{const _0x38b144=_0x3a2e01;if(_0x1ae1b9)return _0x59816e[_0x38b144(0x223)][_0x38b144(0x271)](_0x477f82,_0x477f82['__']('operationFail'));return dbFileIndexTable[_0x38b144(0x1ca)](_0x59816e[_0x38b144(0x223)][_0x38b144(0x209)],_0x3ed787['id'],'\x20size='+_0x213525['size']+',ctime='+_0x213525['ctimeMs']+'\x20'),_0x477f82[_0x38b144(0x2bc)]({'code':0x0,'newIndex':dbFileIndexTable['getById'](_0x59816e[_0x38b144(0x223)][_0x38b144(0x209)],_0x3ed787['id'])});});});});}catch(_0x509e14){return console[_0xe1cb81(0x2af)](_0x509e14),_0x59816e[_0xe1cb81(0x223)]['returnErrMsg'](_0x477f82,_0x477f82['__'](_0xe1cb81(0x239)));}});});}}),router[_0x50db54(0x27c)]('/getPhotoClasses',(_0x269d5e,_0x1ec95a,_0x413803)=>{const _0x3c753b=_0x50db54;if(dbUserTable[_0x3c753b(0x184)](_0x269d5e,_0x1ec95a,_0x3c753b(0x276),'power_get')==!![]){let _0x22d211=dbConfigTable[_0x3c753b(0x1ce)](_0x269d5e[_0x3c753b(0x223)]['dbOther'],'aiClassesEnable');if(!_0x22d211||_0x22d211[_0x3c753b(0x1a4)]!='1')return _0x1ec95a[_0x3c753b(0x2bc)]({'code':0x0,'data':[],'enable':![]});let _0x433ee2=_0x3c753b(0x28d),_0x6d42a7=dbUserTable[_0x3c753b(0x19c)](_0x269d5e,'photo',_0x3c753b(0x25e),!![]),_0x49905a=_0x269d5e[_0x3c753b(0x223)][_0x3c753b(0x209)][_0x3c753b(0x25d)](_0x3c753b(0x292)+_0x433ee2)['all'](),_0x3752ce=[];for(let _0x3dec0b in _0x49905a){let _0x469d00=_0x49905a[_0x3dec0b],_0x44eef3=_0x269d5e[_0x3c753b(0x223)][_0x3c753b(0x209)]['prepare'](_0x3c753b(0x1f4)+_0x6d42a7+_0x3c753b(0x1be))[_0x3c753b(0x2c7)](_0x469d00['id'],dbFileIndexTable['COCO_CLASS_MIN_SCORE']);if(_0x44eef3)_0x49905a[_0x3dec0b]['photo_index_id']=_0x44eef3[_0x3c753b(0x201)],_0x49905a[_0x3dec0b][_0x3c753b(0x237)]=_0x49905a[_0x3dec0b]['id'],_0x3752ce[_0x3c753b(0x2b3)](_0x49905a[_0x3dec0b]);else continue;}_0x1ec95a[_0x3c753b(0x2bc)]({'code':0x0,'data':_0x3752ce,'enable':!![]});}}),router[_0x50db54(0x27c)](_0x50db54(0x2c6),(_0xe4e766,_0x2de9af,_0x1f469f)=>{const _0x43e6d9=_0x50db54;if(dbUserTable[_0x43e6d9(0x184)](_0xe4e766,_0x2de9af,_0x43e6d9(0x276),_0x43e6d9(0x25e))==!![]){let _0x41324a=dbConfigTable[_0x43e6d9(0x1ce)](_0xe4e766[_0x43e6d9(0x223)][_0x43e6d9(0x23b)],_0x43e6d9(0x28c));if(!_0x41324a||_0x41324a[_0x43e6d9(0x1a4)]!='1')return _0x2de9af['json']({'code':0x0,'data':[],'enable':![]});let _0x13fb9a=0x5,_0x439ba9=dbConfigTable[_0x43e6d9(0x1ce)](_0xe4e766[_0x43e6d9(0x223)][_0x43e6d9(0x23b)],_0x43e6d9(0x189));_0x439ba9&&_0x439ba9[_0x43e6d9(0x1a4)]&&(_0x439ba9[_0x43e6d9(0x1a4)]>0x0&&(_0x13fb9a=_0x439ba9[_0x43e6d9(0x1a4)]));let _0x588bdf=_0xe4e766[_0x43e6d9(0x223)][_0x43e6d9(0x209)]['prepare'](_0x43e6d9(0x1db))['all'](parseInt(_0x13fb9a)),_0x5c9d2c=[];if(_0xe4e766['currentUser']['is_admin']==0x1)_0x5c9d2c=_0x588bdf;else{let _0x27e2dc=dbUserTable[_0x43e6d9(0x19c)](_0xe4e766,_0x43e6d9(0x276),_0x43e6d9(0x25e),!![]);for(let _0xdb7872 of _0x588bdf){try{let _0x55f172=_0xe4e766[_0x43e6d9(0x223)][_0x43e6d9(0x209)][_0x43e6d9(0x25d)](_0x43e6d9(0x19b)+_0x27e2dc+_0x43e6d9(0x226))[_0x43e6d9(0x2c7)](_0xdb7872['id']);_0x55f172&&_0x5c9d2c[_0x43e6d9(0x2b3)](_0xdb7872);}catch(_0x23060b){console['log'](_0x23060b),_0x5c9d2c[_0x43e6d9(0x2b3)](_0xdb7872);}}}_0x2de9af[_0x43e6d9(0x2bc)]({'code':0x0,'data':_0x5c9d2c,'enable':!![]});}}),router[_0x50db54(0x27c)](_0x50db54(0x1c6),(_0x53ba7e,_0x405a2c,_0x315fc5)=>{const _0x86b3dc=_0x50db54;let _0x365ed4=_0x53ba7e[_0x86b3dc(0x1fc)][_0x86b3dc(0x1bc)],_0x2f98dd=_0x53ba7e[_0x86b3dc(0x1fc)][_0x86b3dc(0x29a)],_0x22ccce=_0x53ba7e['body']['photoIndexId'];if(dbUserTable[_0x86b3dc(0x184)](_0x53ba7e,_0x405a2c,_0x86b3dc(0x276),_0x86b3dc(0x185))==!![]){let _0x476045=dbFileIndexTable[_0x86b3dc(0x2be)](_0x53ba7e[_0x86b3dc(0x223)][_0x86b3dc(0x209)],_0x365ed4);_0x53ba7e[_0x86b3dc(0x223)][_0x86b3dc(0x209)][_0x86b3dc(0x25d)](_0x86b3dc(0x245)+_0x476045)[_0x86b3dc(0x253)](),_0x53ba7e[_0x86b3dc(0x223)][_0x86b3dc(0x209)][_0x86b3dc(0x25d)](_0x86b3dc(0x220)+_0x22ccce+_0x86b3dc(0x28f)+_0x2f98dd)['run'](),_0x53ba7e['app'][_0x86b3dc(0x209)][_0x86b3dc(0x25d)](_0x86b3dc(0x26c)+_0x365ed4)[_0x86b3dc(0x253)](),_0x405a2c[_0x86b3dc(0x2bc)]({'code':0x0});}}),router[_0x50db54(0x27c)](_0x50db54(0x230),(_0x5c5536,_0x33d06e,_0x2521f1)=>{const _0x339c86=_0x50db54;let _0x5dfac3=_0x5c5536['body']['deleteList'];try{_0x5dfac3=JSON['parse'](_0x5dfac3);}catch(_0x270a53){console[_0x339c86(0x2af)](_0x270a53);}if(dbUserTable[_0x339c86(0x184)](_0x5c5536,_0x33d06e,_0x339c86(0x276),'power_change')==!![]){for(let _0x248284 of _0x5dfac3){_0x5c5536['app'][_0x339c86(0x209)]['prepare'](_0x339c86(0x29c))[_0x339c86(0x253)](parseInt(_0x248284[_0x339c86(0x2c5)]),parseInt(_0x248284[_0x339c86(0x24a)]));}_0x33d06e[_0x339c86(0x2bc)]({'code':0x0});}}),router[_0x50db54(0x27c)]('/updatePhotoFace',(_0x5d6f80,_0x452947,_0x4cc95d)=>{const _0xb5d867=_0x50db54;if(dbUserTable['doUserCanGet'](_0x5d6f80,_0x452947,_0xb5d867(0x276),_0xb5d867(0x185))==!![]){let _0x1ea847=_0x5d6f80['body'][_0xb5d867(0x224)],_0x5961a5=_0x5d6f80[_0xb5d867(0x1fc)]['disabled'],_0x39f0a8=_0x5d6f80[_0xb5d867(0x1fc)][_0xb5d867(0x2c5)],_0x27cc8b=_0x5d6f80['body']['faceIdList'];if(_0x1ea847){_0x1ea847=_0x1ea847[_0xb5d867(0x1a8)]();let _0x534b34=_0x5d6f80[_0xb5d867(0x223)][_0xb5d867(0x209)][_0xb5d867(0x25d)](_0xb5d867(0x268))[_0xb5d867(0x2c7)](_0x1ea847);_0x534b34&&_0x534b34['id']!=_0x39f0a8?_0x5d6f80['app']['dbFileIndex'][_0xb5d867(0x25d)]('UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?')[_0xb5d867(0x253)](_0x534b34['id'],_0x39f0a8):(_0x5d6f80['app'][_0xb5d867(0x209)][_0xb5d867(0x25d)](_0xb5d867(0x2a4))[_0xb5d867(0x253)](_0x1ea847),_0x5d6f80[_0xb5d867(0x223)][_0xb5d867(0x209)][_0xb5d867(0x25d)](_0xb5d867(0x1dc))[_0xb5d867(0x253)](_0x1ea847,_0x39f0a8));}if(parseInt(_0x5961a5)==0x0||parseInt(_0x5961a5)==0x1){if(_0x27cc8b){let _0x20301e=_0xb5d867(0x1e1);for(let _0x2dc7da in _0x27cc8b){_0x20301e+=_0x27cc8b[_0x2dc7da],_0x2dc7da!=_0x27cc8b[_0xb5d867(0x22c)]-0x1&&(_0x20301e+=',');}_0x20301e+=')';let _0x2c867f=_0xb5d867(0x1d8)+_0x20301e;_0x5d6f80[_0xb5d867(0x223)][_0xb5d867(0x209)][_0xb5d867(0x25d)](_0x2c867f)[_0xb5d867(0x253)](_0x5961a5);}else _0x5d6f80[_0xb5d867(0x223)][_0xb5d867(0x209)][_0xb5d867(0x25d)](_0xb5d867(0x20c))['run'](_0x5961a5,_0x39f0a8);}return _0x452947[_0xb5d867(0x2bc)]({'code':0x0});}}),router[_0x50db54(0x27c)]('/mergeFace',(_0x5e1125,_0x3fa62e,_0x32d7d4)=>{const _0x2fec7a=_0x50db54;if(dbUserTable[_0x2fec7a(0x184)](_0x5e1125,_0x3fa62e,_0x2fec7a(0x276),_0x2fec7a(0x185))==!![]){let _0x57a824=_0x5e1125[_0x2fec7a(0x1fc)]['faceIdList'];if(!_0x57a824||_0x57a824['length']<0x2)return _0x5e1125[_0x2fec7a(0x223)]['returnErrMsg'](_0x3fa62e,_0x3fa62e['__'](_0x2fec7a(0x2b2)));let _0x300149=_0x5e1125[_0x2fec7a(0x223)]['dbFileIndex']['prepare'](_0x2fec7a(0x27b))[_0x2fec7a(0x2c7)](_0x57a824[0x0]);if(!_0x300149)return _0x5e1125[_0x2fec7a(0x223)]['returnErrMsg'](_0x3fa62e,_0x3fa62e['__'](_0x2fec7a(0x191)));for(let _0x508510=0x1;_0x508510<_0x57a824['length'];_0x508510++){let _0x27673a=_0x57a824[_0x508510];_0x5e1125[_0x2fec7a(0x223)][_0x2fec7a(0x209)][_0x2fec7a(0x25d)](_0x2fec7a(0x291))[_0x2fec7a(0x253)](_0x300149['id'],_0x27673a,_0x27673a);}return process[_0x2fec7a(0x24b)]({'type':'startFaceAiWork'}),_0x3fa62e[_0x2fec7a(0x2bc)]({'code':0x0});}}),router['get'](_0x50db54(0x2b8),(_0x24afe3,_0x558002,_0x4030ef)=>{const _0x3fa293=_0x50db54;let _0x4431e4=_0x24afe3[_0x3fa293(0x277)][_0x3fa293(0x2c5)];if(dbUserTable[_0x3fa293(0x184)](_0x24afe3,_0x558002,'photo',_0x3fa293(0x25e))==!![]){let _0x2c2d1c=_0x24afe3[_0x3fa293(0x223)][_0x3fa293(0x209)]['prepare']('SELECT\x20*\x20FROM\x20photo_faces\x20where\x20id\x20=?')[_0x3fa293(0x2c7)](_0x4431e4);if(!_0x2c2d1c)return _0x558002['status'](0x194)['end']();_0x24afe3[_0x3fa293(0x2c3)][_0x3fa293(0x2de)]!=0x1?_0x139567(![]):!_0x2c2d1c[_0x3fa293(0x1f9)]?_0x139567(!![]):fs[_0x3fa293(0x1d0)](_0x2c2d1c[_0x3fa293(0x1f9)],(_0x22b544,_0x23fa2b)=>{const _0x433a55=_0x3fa293;if(!_0x22b544){let _0x5455bb=new Date()[_0x433a55(0x260)](),_0x548852=0x48*0xe10*0x3e8;if(_0x23fa2b['ctimeMs']){let _0xbb0f2e=_0x5455bb-_0x23fa2b[_0x433a55(0x2da)];if(_0xbb0f2e>_0x548852)return _0x139567(!![]);}return _0x558002[_0x433a55(0x1de)](_0x2c2d1c[_0x433a55(0x1f9)]);}_0x139567(!![]);});function _0x139567(_0x1914e0){const _0x199a37=_0x3fa293;let _0x57fc40=dbFileIndexTable[_0x199a37(0x2be)](_0x24afe3['app']['dbFileIndex'],_0x4431e4),_0x1cc0d7='SELECT\x20f.*,a.id\x20as\x20f2id,a.width\x20as\x20f2width,a.height\x20as\x20f2height,a.x\x20as\x20f2x,a.y\x20as\x20f2y\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20photo_faces2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20a.photo_index_id=f.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20a.face_id\x20in\x20'+_0x57fc40+'\x20';if(_0x24afe3[_0x199a37(0x2c3)][_0x199a37(0x2de)]!=0x1){let _0x17f70f=dbUserTable[_0x199a37(0x19c)](_0x24afe3,_0x199a37(0x276),_0x199a37(0x25e),!![]);_0x1cc0d7+=_0x17f70f;}let _0x3033df=_0x24afe3[_0x199a37(0x223)][_0x199a37(0x209)][_0x199a37(0x25d)](_0x1cc0d7+_0x199a37(0x218))[_0x199a37(0x2c7)]();if(!_0x3033df){_0x3033df=_0x24afe3[_0x199a37(0x223)]['dbFileIndex'][_0x199a37(0x25d)](_0x1cc0d7+_0x199a37(0x27e))[_0x199a37(0x2c7)]();if(!_0x3033df)return _0x558002[_0x199a37(0x241)](0x194)[_0x199a37(0x2e5)]();}if(!_0x3033df)return _0x558002[_0x199a37(0x241)](0x194)[_0x199a37(0x2e5)]();let _0x168a7e=path['join'](_0x3033df[_0x199a37(0x2c4)],_0x3033df[_0x199a37(0x2c0)]);if(parseInt(_0x3033df[_0x199a37(0x18b)])==0x2){let _0x3f21d4=config['getFileHashName'](_0x3033df),_0x2d1f95=path['join'](config['cachePath'],_0x3f21d4);sharpUtil[_0x199a37(0x183)](_0x168a7e,path[_0x199a37(0x1e5)](_0x2d1f95),path[_0x199a37(0x18f)](_0x2d1f95),_0x199a37(0x2ad),_0x3033df,_0x1245b7=>{_0x168a7e=_0x2d1f95,_0x1d461d();},_0x2d1353=>{const _0x2d3c7e=_0x199a37;return _0x558002[_0x2d3c7e(0x241)](0x194)[_0x2d3c7e(0x2e5)]();});}else _0x1d461d();function _0x1d461d(){const _0x566ff1=_0x199a37;let _0x3f124c=path[_0x566ff1(0x1a3)](config['facesPath'],_0x3033df[_0x566ff1(0x2d4)]+new Date()[_0x566ff1(0x260)]()+_0x566ff1(0x254)),_0x5c8fc6=0x7d0;sharpUtil[_0x566ff1(0x258)](_0x168a7e,(_0x126297,_0x5bac90,_0x3fdf88)=>{const _0x29b187=_0x566ff1;let _0x45e778=parseInt(_0x3033df['f2width']*1.4),_0x359ee4=parseInt(_0x3033df['f2height']*1.4),_0x56ca0d=parseInt(_0x3033df[_0x29b187(0x1a6)]-_0x45e778*0.2),_0x28199a=parseInt(_0x3033df[_0x29b187(0x293)]-_0x359ee4*0.2);if(_0x28199a<0x0)_0x28199a=0x0;if(_0x56ca0d<0x0)_0x56ca0d=0x0;_0x40ea5d(_0x126297,_0x5bac90,_0x3fdf88,_0x56ca0d,_0x28199a,_0x45e778,_0x359ee4,()=>{const _0x22da8c=_0x29b187;let _0x48de69=parseInt(_0x3033df[_0x22da8c(0x215)]),_0x5ec55b=parseInt(_0x3033df[_0x22da8c(0x2a2)]),_0x25afbd=parseInt(_0x3033df[_0x22da8c(0x1a6)]),_0x1af72c=parseInt(_0x3033df['f2y']);if(_0x1af72c<0x0)_0x1af72c=0x0;if(_0x25afbd<0x0)_0x25afbd=0x0;_0x40ea5d(_0x126297,_0x5bac90,_0x3fdf88,_0x25afbd,_0x1af72c,_0x48de69,_0x5ec55b);});});function _0x40ea5d(_0x32af55,_0x5d94e1,_0x2d785f,_0x45d4ae,_0x456435,_0x66f64c,_0x599130,_0x51ab98){const _0x13f9fc=_0x566ff1;let _0x10ceba=sharpUtil['getSharpInstanceFromInput'](_0x32af55),_0x57c50e=exifUtils['getRotateFromTags'](_0x2d785f);_0x57c50e?_0x10ceba=_0x10ceba[_0x13f9fc(0x1c9)](_0x57c50e):_0x10ceba=_0x10ceba[_0x13f9fc(0x1c9)](),_0x10ceba[_0x13f9fc(0x19d)]({'width':_0x5c8fc6,'height':_0x5c8fc6,'withoutEnlargement':!![]})[_0x13f9fc(0x1df)]()[_0x13f9fc(0x1a9)]({'left':_0x45d4ae,'top':_0x456435,'width':_0x66f64c,'height':_0x599130})[_0x13f9fc(0x2b9)](_0x3f124c,function(_0x154a3f){const _0x10711b=_0x13f9fc;if(_0x154a3f){_0x5d94e1&&sharpUtil[_0x10711b(0x2ae)](_0x32af55);if(_0x51ab98)_0x51ab98();else return _0x558002[_0x10711b(0x241)](0x194)[_0x10711b(0x2e5)]();}else{_0x5d94e1&&sharpUtil[_0x10711b(0x2ae)](_0x32af55);if(_0x1914e0)return _0x24afe3['app'][_0x10711b(0x209)][_0x10711b(0x25d)](_0x10711b(0x1d7)+_0x3f124c+'\x27\x20where\x20id='+_0x4431e4)[_0x10711b(0x253)](),_0x558002[_0x10711b(0x1de)](_0x3f124c);else _0x558002[_0x10711b(0x1de)](_0x3f124c),_0x558002['on'](_0x10711b(0x26a),()=>{fs['rm'](_0x3f124c,_0x442a87=>{});});}});}}}}}),router[_0x50db54(0x27c)](_0x50db54(0x222),(_0x724c7b,_0x390425,_0x2f481e)=>{const _0x29f4eb=_0x50db54;let _0x229dec=_0x724c7b[_0x29f4eb(0x1fc)][_0x29f4eb(0x2ce)],_0x327293=_0x724c7b[_0x29f4eb(0x1fc)]['rawFaceIndexIdList'],_0x277cbd=[];if(!_0x229dec||!_0x327293)return _0x390425['json']({'code':0x0,'sucIdList':_0x277cbd});try{_0x327293=JSON[_0x29f4eb(0x194)](_0x327293);for(let _0x292a50 in _0x327293){let _0xf65ef=_0x327293[_0x292a50],_0x1870ee=_0x724c7b[_0x29f4eb(0x223)]['dbFileIndex']['prepare'](_0x29f4eb(0x1c2))[_0x29f4eb(0x253)](parseInt(_0x229dec),parseInt(_0xf65ef[_0x29f4eb(0x1d3)]),parseInt(_0xf65ef[_0x29f4eb(0x201)]));_0x277cbd[_0x29f4eb(0x2b3)](_0xf65ef[_0x29f4eb(0x201)]);}return _0x390425[_0x29f4eb(0x2bc)]({'code':0x0,'sucIdList':_0x277cbd});}catch(_0x4cc73f){return console[_0x29f4eb(0x2af)](_0x4cc73f),_0x390425[_0x29f4eb(0x2bc)]({'code':0x0,'sucIdList':_0x277cbd});}}),router[_0x50db54(0x27c)](_0x50db54(0x264),(_0x50c27c,_0x4f2943,_0x10c5d1)=>{const _0x406b2f=_0x50db54;let _0x5985a0=_0x50c27c[_0x406b2f(0x1fc)][_0x406b2f(0x18b)],_0xaa6ffc={};if(_0x50c27c[_0x406b2f(0x2c3)][_0x406b2f(0x2de)]==0x1){if(!_0x5985a0||_0x5985a0==_0x406b2f(0x18e)){let _0x27e9cf=_0x50c27c[_0x406b2f(0x223)][_0x406b2f(0x209)]['prepare'](_0x406b2f(0x2dd))[_0x406b2f(0x2c7)]();_0xaa6ffc[_0x406b2f(0x1dd)]=_0x27e9cf['count'];if(_0x27e9cf['count']<0x1){let _0x3df453=_0x50c27c['app']['dbFileIndex']['prepare'](_0x406b2f(0x235))[_0x406b2f(0x2c7)]();_0xaa6ffc[_0x406b2f(0x20e)]=_0x3df453[_0x406b2f(0x213)];}}if(!_0x5985a0||_0x5985a0=='cocossd'){let _0x2ec953=_0x50c27c['app']['dbFileIndex'][_0x406b2f(0x25d)](_0x406b2f(0x2e0))['get']();_0xaa6ffc['cocossdWaitDealCount']=_0x2ec953[_0x406b2f(0x213)];}if(!_0x5985a0||_0x5985a0==_0x406b2f(0x2d2)){let _0x54c162=_0x50c27c[_0x406b2f(0x223)][_0x406b2f(0x209)][_0x406b2f(0x25d)](_0x406b2f(0x23a))[_0x406b2f(0x2c7)]();_0xaa6ffc['similarWaitDealCount']=_0x54c162[_0x406b2f(0x213)];}}let _0x5dd277=dbConfigTable[_0x406b2f(0x1ce)](_0x50c27c[_0x406b2f(0x223)][_0x406b2f(0x23b)],'file_index_photo-indexing'),_0x232790=0x0;return!_0x5dd277?_0x232790=0x0:_0x232790=_0x5dd277['value'],_0xaa6ffc[_0x406b2f(0x19e)]=_0x232790,_0x4f2943[_0x406b2f(0x2bc)]({'code':0x0,'data':_0xaa6ffc});}),router['post'](_0x50db54(0x192),(_0x172d26,_0x51135c,_0x410b98)=>{const _0x24067e=_0x50db54;if(dbUserTable['doUserCanGet'](_0x172d26,_0x51135c,'photo',_0x24067e(0x185))==!![])try{fs['rm'](config[_0x24067e(0x28e)],{'recursive':!![]},_0x26625c=>{const _0x190c73=_0x24067e;if(_0x26625c)return console['log'](_0x26625c),_0x172d26[_0x190c73(0x223)]['returnErrMsg'](_0x51135c,_0x51135c['__'](_0x190c73(0x1d9))+':'+config[_0x190c73(0x28e)],_0x190c73(0x247));fs[_0x190c73(0x28b)](config[_0x190c73(0x28e)],_0x5be667=>{const _0x20125b=_0x190c73;if(_0x5be667)return _0x172d26['app'][_0x20125b(0x271)](_0x51135c,_0x51135c['__'](_0x20125b(0x191)),_0x20125b(0x247));let _0x7121ba=_0x172d26[_0x20125b(0x223)][_0x20125b(0x209)]['transaction'](()=>{const _0x2a29ae=_0x20125b;return _0x172d26['app'][_0x2a29ae(0x209)][_0x2a29ae(0x25d)](_0x2a29ae(0x2a5))[_0x2a29ae(0x253)](),_0x172d26[_0x2a29ae(0x223)]['dbFileIndex']['prepare'](_0x2a29ae(0x1b7))[_0x2a29ae(0x253)](),_0x172d26[_0x2a29ae(0x223)][_0x2a29ae(0x209)][_0x2a29ae(0x25d)](_0x2a29ae(0x2e2))[_0x2a29ae(0x253)](),process[_0x2a29ae(0x24b)]({'type':_0x2a29ae(0x2d0)}),_0x51135c['json']({'code':0x0});});_0x7121ba();});});}catch(_0x5288c2){return _0x172d26[_0x24067e(0x223)]['returnErrMsg'](_0x51135c,_0x51135c['__'](_0x24067e(0x191)),'dialog');}}),router[_0x50db54(0x27c)](_0x50db54(0x2e6),(_0x30c105,_0xd04927,_0x18bcb7)=>{const _0x2ed8c4=_0x50db54;if(dbUserTable[_0x2ed8c4(0x184)](_0x30c105,_0xd04927,_0x2ed8c4(0x276),_0x2ed8c4(0x185))==!![])try{let _0x71ab62=_0x30c105[_0x2ed8c4(0x223)][_0x2ed8c4(0x209)][_0x2ed8c4(0x217)](()=>{const _0x253aef=_0x2ed8c4;return _0x30c105[_0x253aef(0x223)]['dbFileIndex']['prepare']('delete\x20from\x20photo_phash_similar\x20where\x201=1')['run'](),_0x30c105['app'][_0x253aef(0x209)][_0x253aef(0x25d)](_0x253aef(0x187))[_0x253aef(0x253)](),process['send']({'type':_0x253aef(0x2e3)}),_0xd04927['json']({'code':0x0});});_0x71ab62();}catch(_0x1fb10e){return _0x30c105['app'][_0x2ed8c4(0x271)](_0xd04927,_0xd04927['__'](_0x2ed8c4(0x191)),_0x2ed8c4(0x247));}}),router[_0x50db54(0x27c)](_0x50db54(0x1b6),(_0x487e2f,_0x4ff3d3,_0x3635e3)=>{const _0x41b8ff=_0x50db54;if(dbUserTable['isAdmin'](_0x487e2f,_0x4ff3d3)!==!![])return;let _0x1308a8=dbConfigTable['findByTitle'](_0x487e2f[_0x41b8ff(0x223)][_0x41b8ff(0x23b)],'aiSimilarPhotoEnable');if(!_0x1308a8||_0x1308a8['value']!='1')return _0x4ff3d3['json']({'code':0x0,'data':[],'enable':![]});let _0x408021=_0x487e2f[_0x41b8ff(0x1fc)][_0x41b8ff(0x203)];if(!_0x408021)_0x408021=0x0;let _0x4dd9d3=_0x487e2f[_0x41b8ff(0x1fc)]['count'];if(!_0x4dd9d3||_0x4dd9d3>0x64)_0x4dd9d3=0x64;let _0x39fda1=[],_0x5214d7=_0x487e2f[_0x41b8ff(0x223)]['dbFileIndex'][_0x41b8ff(0x25d)](_0x41b8ff(0x2aa))['all'](),_0x3d0771=_0x487e2f[_0x41b8ff(0x223)][_0x41b8ff(0x209)][_0x41b8ff(0x25d)](_0x41b8ff(0x1fe)+_0x4dd9d3)['all']();for(let _0x551690 in _0x3d0771){let _0x179610=_0x3d0771[_0x551690],_0x28b7aa=_0x487e2f[_0x41b8ff(0x223)]['dbFileIndex']['prepare'](_0x41b8ff(0x18d)+_0x179610[_0x41b8ff(0x193)])[_0x41b8ff(0x2c7)](),_0x5a0f92=_0x487e2f[_0x41b8ff(0x223)][_0x41b8ff(0x209)][_0x41b8ff(0x25d)](_0x41b8ff(0x211)+_0x179610['index_id'])['all']();_0x3d0771[_0x551690][_0x41b8ff(0x1c0)]=_0x28b7aa,_0x3d0771[_0x551690]['similarIndexList']=[_0x28b7aa],_0x3d0771[_0x551690][_0x41b8ff(0x207)]['push'](..._0x5a0f92),_0x3d0771[_0x551690][_0x41b8ff(0x207)][_0x41b8ff(0x22c)]>0x1?_0x39fda1[_0x41b8ff(0x2b3)](_0x3d0771[_0x551690]):_0x487e2f[_0x41b8ff(0x223)]['dbFileIndex']['prepare']('DELETE\x20FROM\x20photo_phash_similar\x20where\x20index_id=?')[_0x41b8ff(0x253)](_0x179610[_0x41b8ff(0x193)]);}return _0x4ff3d3[_0x41b8ff(0x2bc)]({'code':0x0,'data':_0x39fda1,'enable':!![],'waitDealCount':_0x5214d7[_0x41b8ff(0x22c)]});}),router[_0x50db54(0x27c)](_0x50db54(0x252),(_0x191502,_0x19f0b1,_0x40d0e6)=>{const _0x3294f7=_0x50db54;if(dbUserTable['isAdmin'](_0x191502,_0x19f0b1)!==!![])return;nasAccountUtil[_0x3294f7(0x20f)](_0x19f0b1,_0x191502[_0x3294f7(0x223)][_0x3294f7(0x23b)])[_0x3294f7(0x236)](_0x15c68a=>{const _0x264bbd=_0x3294f7;if(!_0x15c68a)return;let _0x54f7e3=_0x191502[_0x264bbd(0x1fc)][_0x264bbd(0x2b0)];for(let _0x384551 in _0x54f7e3){let _0x20e842=_0x191502[_0x264bbd(0x223)][_0x264bbd(0x209)][_0x264bbd(0x25d)]('SELECT\x20*\x20from\x20photo_phash_similar\x20where\x20index_id='+_0x54f7e3[_0x384551][_0x264bbd(0x193)])[_0x264bbd(0x2d8)]();for(let _0x39f0ae in _0x20e842){if(!_0x54f7e3[_0x384551][_0x264bbd(0x1bb)][_0x264bbd(0x250)](parseInt(_0x20e842[_0x39f0ae][_0x264bbd(0x1e6)]))){let _0x3ae3d8=new Date()[_0x264bbd(0x260)]();_0x191502[_0x264bbd(0x223)][_0x264bbd(0x209)][_0x264bbd(0x25d)]('UPDATE\x20'+dbFileIndexTable[_0x264bbd(0x24e)]+_0x264bbd(0x206)+_0x3ae3d8+'\x20WHERE\x20id\x20=\x20'+_0x20e842[_0x39f0ae]['similar_index_id'])[_0x264bbd(0x253)]();}}if(!_0x54f7e3[_0x384551][_0x264bbd(0x1bb)][_0x264bbd(0x250)](parseInt(_0x54f7e3[_0x384551][_0x264bbd(0x193)]))){let _0x2e33d8=new Date()[_0x264bbd(0x260)]();_0x191502[_0x264bbd(0x223)]['dbFileIndex']['prepare'](_0x264bbd(0x28a)+dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']+_0x264bbd(0x206)+_0x2e33d8+'\x20WHERE\x20id\x20=\x20'+_0x54f7e3[_0x384551]['index_id'])[_0x264bbd(0x253)]();}_0x191502['app'][_0x264bbd(0x209)][_0x264bbd(0x25d)]('delete\x20from\x20photo_phash_similar\x20where\x20index_id='+_0x54f7e3[_0x384551][_0x264bbd(0x193)])[_0x264bbd(0x253)]();}return _0x19f0b1[_0x264bbd(0x2bc)]({'code':0x0});});}),router['post'](_0x50db54(0x2a7),(_0x25ba25,_0x4cc5b7,_0x1430d7)=>{const _0x2403bb=_0x50db54;if(dbUserTable[_0x2403bb(0x184)](_0x25ba25,_0x4cc5b7,'photo',_0x2403bb(0x185),'')==!![]){let _0x303a13=_0x25ba25[_0x2403bb(0x223)][_0x2403bb(0x209)][_0x2403bb(0x25d)](_0x2403bb(0x1af))['all']();for(let _0x115136 of _0x303a13){_0x25ba25[_0x2403bb(0x223)][_0x2403bb(0x209)][_0x2403bb(0x25d)](_0x2403bb(0x1b2))[_0x2403bb(0x253)](_0x115136[_0x2403bb(0x2c4)],_0x115136['raw_filename']);}return _0x25ba25[_0x2403bb(0x223)][_0x2403bb(0x209)]['prepare']('UPDATE\x20'+dbFileIndexTable[_0x2403bb(0x24e)]+_0x2403bb(0x2a9))[_0x2403bb(0x253)](),_0x4cc5b7['json']({'code':0x0});}}),router[_0x50db54(0x27c)](_0x50db54(0x238),(_0x5cbc79,_0x5cb3ee,_0x47a573)=>{const _0x561185=_0x50db54;let _0x49baf4=_0x5cbc79['body']['putInSystemTrash'],_0x14799b=dbFileIndexTable[_0x561185(0x21f)](_0x5cbc79[_0x561185(0x223)][_0x561185(0x209)],_0x561185(0x26f),_0x561185(0x20b),dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),_0x4655ba=dbFileIndexTable[_0x561185(0x24e)];console['log'](_0x561185(0x25b)+_0x14799b[_0x561185(0x22c)]);function _0x52666d(_0x3a9e1f,_0x1fd3f4){const _0x113267=_0x561185;dbFileOperationRecord[_0x113267(0x2d3)](_0x5cbc79[_0x113267(0x223)]['dbOther'],{'username':_0x5cbc79[_0x113267(0x2c3)][_0x113267(0x27f)],'targetPath':_0x3a9e1f,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x113267(0x208)],'state':_0x1fd3f4?dbFileOperationRecord['STATE_SUC']:dbFileOperationRecord[_0x113267(0x214)]});}function _0x27c302(_0x4127fc){const _0xea937b=_0x561185;if(_0x4127fc[_0xea937b(0x195)]==0x1&&_0x4127fc[_0xea937b(0x246)]==0x1){let _0x2f4a72=path[_0xea937b(0x1a3)](_0x4127fc['path'],_0x4127fc[_0xea937b(0x2c0)]['replace']('.MOV','')+_0xea937b(0x1f8));_0x4127fc[_0xea937b(0x2c0)][_0xea937b(0x2c8)]('.MP4')&&(_0x2f4a72=path[_0xea937b(0x1a3)](_0x4127fc['path'],_0x4127fc[_0xea937b(0x2c0)]['replace'](_0xea937b(0x2c1),'')+_0xea937b(0x22a))),fs['existsSync'](_0x2f4a72)&&(console['log'](_0xea937b(0x231),_0x2f4a72),_0x388b29(_0x4127fc,_0x2f4a72,![]));}}function _0x388b29(_0x3ecff8,_0x19d0f2,_0x253083){const _0xc33090=_0x561185;_0x49baf4==0x1?(process[_0xc33090(0x24b)]({'type':_0xc33090(0x1b3),'shellType':_0xc33090(0x1b1),'path':_0x19d0f2}),_0x52666d(_0x19d0f2,!![])):fs['rm'](_0x19d0f2,{'recursive':!![]},_0xeea0b0=>{_0xeea0b0?_0x52666d(_0x19d0f2,![]):_0x52666d(_0x19d0f2,!![]);}),_0x253083&&_0x27c302(_0x3ecff8);}function _0xd681a(_0x176464){const _0xdd0791=_0x561185;dbFileIndexTable['delete'](_0x5cbc79[_0xdd0791(0x223)][_0xdd0791(0x209)],_0x176464['id'],_0x4655ba);}for(let _0x25c9ad in _0x14799b){let _0xd1a8a9=_0x14799b[_0x25c9ad];if(_0xd1a8a9){if(dbUserTable[_0x561185(0x184)](_0x5cbc79,_0x5cb3ee,'photo',_0x561185(0x243),_0xd1a8a9[_0x561185(0x2c4)])==!![]){let _0x127ed3=path[_0x561185(0x1a3)](_0xd1a8a9[_0x561185(0x2c4)],path['sep'],_0xd1a8a9[_0x561185(0x2c0)]);_0xd681a(_0xd1a8a9),_0x388b29(_0xd1a8a9,_0x127ed3,!![]);}}}return _0x5cb3ee[_0x561185(0x2bc)]({'code':0x0});}),router[_0x50db54(0x27c)](_0x50db54(0x1b8),(_0x5c60b8,_0x196508,_0x29b95b)=>{const _0x33b07f=_0x50db54;let _0x32c6cd=_0x5c60b8[_0x33b07f(0x1fc)]['title'],_0x1242c9=_0x5c60b8[_0x33b07f(0x1fc)]['libraryId'],_0x264b66=_0x5c60b8[_0x33b07f(0x1fc)]['pathList'],_0x4c1373=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x1f7)],_0x32f4f9=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x2b5)],_0x1d4676=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x29d)];if(_0x1d4676==_0x33b07f(0x1b5)){let _0x379217=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x25f)]||0x0,_0x335cb2=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x213)]||0x32,_0x322186=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x1bd)]||'',_0x29ddea=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x273)]||'create_time',_0x2e1042=_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x232)]||_0x33b07f(0x186);if(![_0x33b07f(0x2ac),'title'][_0x33b07f(0x250)](_0x29ddea))return console['log'](_0x33b07f(0x2a8),_0x29ddea),[];let _0x728514=[],_0x5b16b6=[],_0x580f4e=_0x33b07f(0x29b);_0x5c60b8['currentUser'][_0x33b07f(0x2de)]==0x1?_0x322186&&(_0x580f4e+=_0x33b07f(0x1d1),_0x5b16b6[_0x33b07f(0x2b3)]('%'+_0x322186+'%')):(_0x580f4e=_0x33b07f(0x2a1),_0x322186&&(_0x580f4e+=_0x33b07f(0x21d),_0x5b16b6[_0x33b07f(0x2b3)]('%'+_0x322186+'%')));_0x580f4e+=_0x33b07f(0x1e0)+_0x29ddea+'\x20'+_0x2e1042+_0x33b07f(0x267),_0x5b16b6[_0x33b07f(0x2b3)](_0x335cb2),_0x5b16b6['push'](_0x379217),_0x728514=_0x5c60b8[_0x33b07f(0x223)]['dbFileIndex'][_0x33b07f(0x25d)](_0x580f4e)[_0x33b07f(0x2d8)](_0x5b16b6);if(_0x728514[_0x33b07f(0x22c)]<0x1)return _0x196508[_0x33b07f(0x2bc)]({'code':0x0,'data':[]});for(let _0x1c5b9e in _0x728514){let _0x25ff40=_0x728514[_0x1c5b9e];try{let _0x48b006=JSON[_0x33b07f(0x194)](_0x25ff40[_0x33b07f(0x2d6)]),_0x58e607=[];for(let _0x343597 of _0x48b006){let _0x204879=dbUserTable[_0x33b07f(0x1ec)](_0x5c60b8[_0x33b07f(0x223)][_0x33b07f(0x23b)],_0x343597,'id,username');_0x58e607['push'](_0x204879);}_0x728514[_0x1c5b9e]['user_list']=_0x58e607;}catch(_0x39f26a){console[_0x33b07f(0x2af)](_0x39f26a);}_0x5c60b8[_0x33b07f(0x1fc)]['count']=0x4,_0x5c60b8[_0x33b07f(0x1fc)]['excludeIds']=[],_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x2ca)]=0x0,_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x2b4)]=_0x33b07f(0x282),_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x188)]=_0x33b07f(0x186),_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x2e9)]=0x1,_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x26e)]=0x9184e729fff,_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x1b1)]=0x0,_0x5c60b8[_0x33b07f(0x1fc)][_0x33b07f(0x1f2)]=_0x728514[_0x1c5b9e]['id'],_0x728514[_0x1c5b9e][_0x33b07f(0x1f0)]=photoApiUtil[_0x33b07f(0x22f)](_0x5c60b8,_0x196508);}return _0x196508[_0x33b07f(0x2bc)]({'code':0x0,'data':_0x728514});}else{if(_0x5c60b8[_0x33b07f(0x2c3)][_0x33b07f(0x2de)]!=0x1)return _0x5c60b8[_0x33b07f(0x223)][_0x33b07f(0x271)](_0x196508,_0x196508['__'](_0x33b07f(0x240)));if(_0x1d4676==_0x33b07f(0x251)||_0x1d4676==_0x33b07f(0x261)){if(!_0x264b66||!_0x264b66 instanceof Array||_0x264b66['length']<0x1)return _0x5c60b8[_0x33b07f(0x223)][_0x33b07f(0x271)](_0x196508,_0x196508['__'](_0x33b07f(0x191)));if(_0x32f4f9){if(_0x4c1373!=null&&!_0x4c1373 instanceof Array)return _0x5c60b8[_0x33b07f(0x223)]['returnErrMsg'](_0x196508,_0x196508['__'](_0x33b07f(0x191)));}if(sqliteUtil['checkSqlInjection'](JSON['stringify'](_0x264b66))==!![])return _0x5c60b8[_0x33b07f(0x223)]['returnErrMsg'](_0x196508,'error\x20pathList');}if(_0x1d4676==_0x33b07f(0x261)&&_0x1242c9)_0x5c60b8['app'][_0x33b07f(0x209)][_0x33b07f(0x25d)](_0x33b07f(0x202))['run'](_0x32c6cd,JSON['stringify'](_0x264b66),_0x32f4f9,JSON[_0x33b07f(0x255)](_0x4c1373),_0x1242c9);else{if(_0x1d4676==_0x33b07f(0x20a)&&_0x1242c9)_0x5c60b8[_0x33b07f(0x223)][_0x33b07f(0x209)][_0x33b07f(0x25d)](_0x33b07f(0x2ab))[_0x33b07f(0x253)](_0x1242c9);else{if(_0x1d4676=='ADD')_0x5c60b8[_0x33b07f(0x223)][_0x33b07f(0x209)][_0x33b07f(0x25d)](_0x33b07f(0x1d2))['run'](_0x32c6cd,JSON['stringify'](_0x264b66),_0x32f4f9,JSON[_0x33b07f(0x255)](_0x4c1373),_0x5c60b8[_0x33b07f(0x2c3)]['id']);else return _0x5c60b8[_0x33b07f(0x223)][_0x33b07f(0x271)](_0x196508,_0x196508['__']('noPermission'));}}return _0x196508[_0x33b07f(0x2bc)]({'code':0x0});}}),module[_0x50db54(0x1f1)]=router;