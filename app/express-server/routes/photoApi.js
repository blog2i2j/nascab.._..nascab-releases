function _0x26d3(){const _0x1c6d73=['checkSqlInjection','aiFaceMinPhotoCount','encode','log','/restoreTrashBinFiles','/getTimeLineDateList','indexId','showFileType','stat','\x20order\x20by\x20score\x20desc','delete\x20from\x20photo_faces2index\x20where\x201=1','sendFile','SELECT\x20id,path,filename,original_date,size\x20FROM\x20file_index_photo\x20where\x20id=','isVip','\x20and\x20a.is_face_poster=1\x20limit\x201','noPermission','getDate','GPS','170UHYRFV','operation','similarIndexList','GPSIFD','\x20type=1\x20','(\x27mouse\x27,\x27person\x27,\x27traffic\x20light\x27,\x27stop\x20sign\x27,\x27parking\x20meter\x27,\x27fire\x20hydrant\x27)','/setFacePoster','f2width','writeFile','end','changes','f2x','/getFaceImg/*','DELETE\x20FROM\x20photo_library\x20\x20WHERE\x20id=?','zoom','faceApiWaitCompareCount','close','toLowerCase','get','power_get','\x20AND\x20geohash3!=\x27undefined\x27\x20GROUP\x20BY\x20geohash3','is_admin','asc','.jpg','3115044RiZfrs','geoInfoWriteErr','ordinaryAlbumId','\x20AND\x20geohash\x20LIKE\x20?\x20','photoIndexId','power_add','isAdmin','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20id\x20=\x20?','operation\x20fail','getFaceInSql','startSimilarPhotoWork','includes','parse','Router','/getAllAlbum','INDEX_TABLE_NAME_PHOTO','.MOV','moviePreferLanguage','excludeFilenamePhoto','ADD','similar','\x20LIMIT\x20','fileExist','UPDATE\x20photo_faces\x20SET\x20face_name=null\x20where\x20face_name\x20=\x20?','endsWith','../../db/dbConfigTable','\x20path=\x27','cachePath','power_delete','faceapi','name','1334608GHGngr','ctimeMs','indexObj','resize','maxLng','getFullYear','f2height','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?\x20or\x20belong_face_id=?','../../db/dbFileOperationRecord','stringify','/resetSimilarPhotoAi','\x20id\x20in\x20(','targetFaceId','getPhotoByParams','mode','all','album.sameNameExist','dump','geohash4\x20=\x20','trim','similar_index_id','\x20in_trash=0\x20AND\x20latitude!=\x27undefined\x27\x20AND\x20longitude!=\x27undefined\x27\x20AND\x20latitude\x20is\x20not\x20null','shell','245547TofbRH','editId','transSpcielFormat','SELECT\x20f.id,f.path,f.filename,f.original_date,f.size\x20FROM\x20photo_phash_similar\x20as\x20a\x20inner\x20join\x20file_index_photo\x20as\x20f\x20on\x20a.similar_index_id=f.id\x20where\x20a.index_id=','setFaceId','sortType','\x20size=','value','push','toString','platform','%\x27\x20','defaultTranscodeResolution','cacheDeleteFail','load','sharp','文件写入成功','getById','UPDATE\x20photo_faces\x20SET\x20face_name=?\x20where\x20id\x20=\x20?','transaction','../utils/sqliteUtil','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time,latitude,longitude\x20','SELECT\x20*\x20FROM\x20ai_classes\x20where\x20\x20class_name\x20not\x20in\x20','/searchMode','maxLat','startFaceAiWork','3wwcjKG','imgList','mkdir','toFile','dialog','extract','/removeFromFace','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20id=?','/clearTrashBin','file_index_photo-indexing','\x20SET\x20in_trash=0\x20WHERE\x20in_trash=1','data_value','delete\x20from\x20photo_phash_similar\x20where\x201=1','title','\x27,original_date=\x27','INDEX_TABLE_NAME_MUSIC','1490880RbXMQY','/resetFaceAi','\x20\x20AND\x20filename\x20LIKE\x20\x27%','offset','SELECT\x20f.*,a.id\x20as\x20f2id,a.width\x20as\x20f2width,a.height\x20as\x20f2height,a.x\x20as\x20f2x,a.y\x20as\x20f2y\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20photo_faces2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20a.photo_index_id=f.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20a.face_id\x20in\x20','\x20type=2\x20\x20','app','dbFileIndex','UPDATE\x20photo_faces2index\x20SET\x20face_id=?\x20WHERE\x20face_id=?\x20and\x20photo_index_id=?','\x27,geohash2=\x27','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=1\x20where\x20photo_index_id\x20=\x20','face_img_path','filename','cocossdWaitDealCount','\x27,geohash=\x27','/editExifByIndexId','replace','searchValue','../utils/sharpUtils','create_time','UPDATE\x20photo_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','/getBoundsPhoto','size','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20share_for_subuser=1','isFile','deleteRawTempFile','getAllByWhere','getByWhere','SELECT\x20*\x20FROM\x20photo_faces\x20where\x20id\x20=?','/addAlbum','shareForSubUser','REPLACE\x20INTO\x20photo_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','../utils/nasAccountUtils','f2y','floor','dbOther','count','latitude','INDEX_TABLE_NAME_MOVIE','update\x20file_index_photo\x20set\x20phash=null,phash_compare=0','GPSLatitudeRef','error\x20pathList','path','similarWaitDealCount','/getAlbumPhotoForMap','STATE_SUC','getAlbumWhereStr','libraryId','udpateName','SELECT\x20*\x20FROM\x20photo_library\x20','\x20\x20AND\x20(filename\x20LIKE\x20\x27%','indexFullPath','2eNkmGa','status','getByName','TYPE_DELETE','moviePlaylongPressRate','\x20is_file,id,path,filename,ext,duration,size\x20','%\x27)\x20','getIndexTableNameByType','\x20is_file=1\x20','search','SELECT\x20*\x20from\x20photo_phash_similar\x20where\x20index_id=','trash','DELETE','\x20AND\x20','shareUidList','../utils/fileUtils','COCO_CLASS_MIN_SCORE','/getAiDealState','getList','/mergeFace','\x20WHERE\x20title\x20like\x20?','doUserCanGet','binary','\x20(((type=1\x20or\x20type=2)\x20\x20)\x20OR\x20is_file=0\x20)\x20','findByTitle','66oQKDOO','run','\x20AND\x20geohash4!=\x27undefined\x27\x20GROUP\x20BY\x20geohash4','getTime','orderType','Exif','\x20latitude=\x27','SELECT\x20f.id\x20FROM\x20photo_faces2index\x20as\x20p\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20p.photo_index_id=f.id\x20WHERE\x20p.face_id=?\x20','\x20SET\x20in_trash=1,in_trash_time=','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_face_detect_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20','getFileHashName','mtime','putInSystemTrash','movie','/dealSimilarPhoto','../../db/dbFileIndexTable','\x20LIMIT\x20?\x20OFFSET\x20?','id,is_file,is_livephoto,path,filename,raw_filename,is_raw','is_livephoto','/getPhotoByTime','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=0\x20where\x20is_face_poster=1\x20and\x20face_id\x20in\x20','getUserPathWhere','raw_filename','getUserPower','\x20order\x20by\x20f.original_time\x20desc\x20limit\x201','orderField','photo','137786WtRvKu','insert','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20phash\x20is\x20null\x20and\x20type=1','path_list','../../db/dbSourceFolderTable','getPathWhere','data','\x20AND\x20geohash5!=\x27undefined\x27\x20GROUP\x20BY\x20geohash5','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_class_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27','../../utils/exifUtils','minLat','delete','facesPath','\x20and\x20title\x20like\x20?','post','../../myWorkers/index/photoIndexUtil','getMonth','sep','geohash5\x20=\x20','length','updateBySql','\x20WHERE\x20id\x20=\x20','/updateAlbum','round','DateTimeOriginal','rawFaceId','desc','INDEX_TABLE_NAME_BOOK','f2id','disabled','/getPhotoFaces','/deleteAlbum','is_file','create','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27\x27\x20where\x20id=','GPSDateStamp','STATE_FAIL','\x20\x20\x20AND\x20in_trash!=1\x20','basename','minIndexId','.JPG','keepIndexList','/getFileTreePhoto','index_id','/updatePhotoFace','key','currentUser','body','308434eUtcaB','operationFail','8JSdmUH','rotate','\x20is_file=0\x20','faceId','update','photo_index_id','power_change','jpeg',',ctime=','newDate','year','ngeohash','substring','\x20OFFSET\x20','deleteList','albumId','ExifIFD','UPDATE\x20','\x27,geohash3=\x27','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20photo_faces2index\x20WHERE\x20compare_state=0','returnErrMsg','genTinyFile','dealList','serverType','join','json','rawFaceIndexIdList','searchStr','Image\x20format\x20not\x20support','atleastChooseTwoFaces','existsSync','aiClassId','fileType','music','\x20LIMIT\x201','send','.MP4','3545292ohbMxz','Cleaning\x20out\x20the\x20recycle\x20bin\x20:\x20','chi','update\x20file_index_photo\x20set\x20ai_face_detect_state=0','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20disabled=0\x20and\x20belong_face_id\x20is\x20null\x20and\x20face_photo_count>=?\x20order\x20by\x20face_photo_count\x20desc\x20limit\x20500','../../myConfig/config','username','cocossd','prepare','from','\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)','timeOrder','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?','serveType','faceIdList','folderNotExist','type','abs','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27','readFile','../../db/dbAlbumTable','faceName','\x27,longitude=\x27','\x20original_time=\x27','original_time','book','SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id\x20limit\x20','geohash','\x20id,latitude,longitude,geohash,tiny_path','EDIT','DELETE\x20FROM\x20photo_phash_similar\x20where\x20index_id=?','\x20in_trash=1\x20and\x20is_file=1\x20','then','getTimeLineDateList'];_0x26d3=function(){return _0x1c6d73;};return _0x26d3();}const _0x3b0907=_0x1a30;(function(_0x4d9229,_0x5104e7){const _0x37f277=_0x1a30,_0x5e2c9b=_0x4d9229();while(!![]){try{const _0x5b01ef=-parseInt(_0x37f277(0x1eb))/0x1*(-parseInt(_0x37f277(0x21f))/0x2)+parseInt(_0x37f277(0x1a7))/0x3*(parseInt(_0x37f277(0x176))/0x4)+parseInt(_0x37f277(0x1b7))/0x5+parseInt(_0x37f277(0x10b))/0x6+-parseInt(_0x37f277(0x24f))/0x7*(-parseInt(_0x37f277(0xe5))/0x8)+parseInt(_0x37f277(0x18d))/0x9*(parseInt(_0x37f277(0x13f))/0xa)+parseInt(_0x37f277(0x204))/0xb*(-parseInt(_0x37f277(0x157))/0xc);if(_0x5b01ef===_0x5104e7)break;else _0x5e2c9b['push'](_0x5e2c9b['shift']());}catch(_0x3926ff){_0x5e2c9b['push'](_0x5e2c9b['shift']());}}}(_0x26d3,0x4be3f));let express=require('express'),router=express[_0x3b0907(0x164)](),path=require(_0x3b0907(0x1e1));const sharp=require(_0x3b0907(0x19c)),config=require(_0x3b0907(0x110)),dbFileIndexTable=require(_0x3b0907(0x213)),dbSourceFolderTable=require(_0x3b0907(0x223)),dbFileOperationRecord=require(_0x3b0907(0x17e));let checkUtil=require('../utils/checkUtil');const sqliteUtil=require(_0x3b0907(0x1a1)),exifUtils=require(_0x3b0907(0x228)),dbUserTable=require('../../db/dbUserTable'),dbAlbumTable=require(_0x3b0907(0x11f));let geohash=require(_0x3b0907(0xf0)),fs=require('fs');const dbConfigTable=require(_0x3b0907(0x170));let sharpUtil=require(_0x3b0907(0x1c9)),nasAccountUtil=require(_0x3b0907(0x1d7)),fileUtil=require(_0x3b0907(0x1fa));function _0x1a30(_0x4a049c,_0x2809e3){const _0x26d314=_0x26d3();return _0x1a30=function(_0x1a30aa,_0x165993){_0x1a30aa=_0x1a30aa-0xe4;let _0x88d835=_0x26d314[_0x1a30aa];return _0x88d835;},_0x1a30(_0x4a049c,_0x2809e3);}const photoApiUtil=require('./photoApiUtils'),platform=require('os')[_0x3b0907(0x197)](),photoIndexUtil=require(_0x3b0907(0x22e));let piexif=require('piexifjs');router['post'](_0x3b0907(0x132),(_0xfec19,_0x387dfd,_0x33745c)=>{const _0xb14a9e=_0x3b0907;if(dbUserTable[_0xb14a9e(0x200)](_0xfec19,_0x387dfd,_0xb14a9e(0x21e),_0xb14a9e(0x152))==!![]){let _0x14aa00=_0xfec19[_0xb14a9e(0x24e)][_0xb14a9e(0xef)],_0x4e13f8=_0xfec19[_0xb14a9e(0x24e)][_0xb14a9e(0x11b)],_0x9a25c4=_0xfec19['body'][_0xb14a9e(0x126)],_0x52cdd9=_0xfec19[_0xb14a9e(0x24e)][_0xb14a9e(0xf4)],_0x5825b5=_0xfec19[_0xb14a9e(0x24e)][_0xb14a9e(0x101)],_0x40b030=_0xfec19[_0xb14a9e(0x24e)][_0xb14a9e(0x159)],_0x2b00b2=_0xfec19['body'][_0xb14a9e(0x105)],_0x33b5ff=_0xfec19[_0xb14a9e(0x24e)]['libraryId'],_0x43e27f=_0xfec19['body'][_0xb14a9e(0xe8)],_0xc10a95=_0xfec19[_0xb14a9e(0x24e)][_0xb14a9e(0x116)],_0x9619f5=_0xfec19[_0xb14a9e(0x24e)]['sourceFolderList'],_0x4efa3f=dbUserTable[_0xb14a9e(0x219)](_0xfec19,'photo','power_get',!![],_0x9619f5),_0x38e810=_0x4efa3f,_0x3791dd=[];_0x9a25c4&&(_0x38e810+=_0xb14a9e(0x15a),_0x3791dd[_0xb14a9e(0x195)](_0x9a25c4+'%'));let _0x56e875=dbSourceFolderTable['getExcludePathWhereStr'](_0xfec19[_0xb14a9e(0x1bd)]['dbOther'],'path','excludePathPhoto');_0x56e875&&(_0x38e810+=_0xb14a9e(0x1f8)+_0x56e875);let _0x24b9ec=dbSourceFolderTable['getExcludePathWhereStr'](_0xfec19[_0xb14a9e(0x1bd)][_0xb14a9e(0x1da)],_0xb14a9e(0x1c3),_0xb14a9e(0x169));_0x24b9ec&&(_0x38e810+=_0xb14a9e(0x1f8)+_0x24b9ec);if(_0x33b5ff){let _0x122eeb=_0xfec19[_0xb14a9e(0x1bd)][_0xb14a9e(0x1be)][_0xb14a9e(0x113)](_0xb14a9e(0x117))[_0xb14a9e(0x151)](_0x33b5ff);if(_0x122eeb)try{let _0x36091b=JSON['parse'](_0x122eeb[_0xb14a9e(0x222)]),_0x1846f2=dbUserTable[_0xb14a9e(0x224)](!![],_0x36091b);_0x38e810+=_0x1846f2;}catch(_0x255c61){console['log'](_0x255c61);}}if(_0x52cdd9){let _0x48f00c=dbAlbumTable[_0xb14a9e(0x1e5)](_0xfec19[_0xb14a9e(0x1bd)]['dbOther'],_0x52cdd9);_0x48f00c&&(_0x38e810+=_0xb14a9e(0x1f8)+_0x48f00c);}_0x5825b5&&(_0x38e810+=_0xb14a9e(0x115),_0x3791dd[_0xb14a9e(0x195)]('%'+_0x5825b5+'%'),_0x3791dd[_0xb14a9e(0x195)]('%'+_0x5825b5+'%'));_0x38e810+=_0xb14a9e(0x244);let _0x400aa2=dbFileIndexTable[_0xb14a9e(0x12c)](_0xfec19[_0xb14a9e(0x1bd)][_0xb14a9e(0x1be)],_0x14aa00,_0x4e13f8,_0x38e810,_0x40b030,_0x2b00b2,_0x43e27f,_0x3791dd,_0xc10a95);_0x387dfd[_0xb14a9e(0xff)]({'code':0x0,'data':_0x400aa2});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x217),(_0x4bebae,_0x13fc4b,_0x2d4e0b)=>{const _0x5c52f4=_0x3b0907;dbUserTable[_0x5c52f4(0x200)](_0x4bebae,_0x13fc4b,_0x5c52f4(0x21e),_0x5c52f4(0x152))==!![]&&(result=photoApiUtil[_0x5c52f4(0x183)](_0x4bebae,_0x13fc4b),_0x13fc4b[_0x5c52f4(0xff)]({'code':0x0,'data':result}));}),router['post'](_0x3b0907(0x1e3),(_0x4d646f,_0x2a95bc,_0x4d9366)=>{const _0x38a012=_0x3b0907;let _0x1db7ff=dbUserTable['getUserPathWhere'](_0x4d646f,'photo','power_get',!![]),_0x22a311=_0x38a012(0x127),_0x4b3310=_0x38a012(0x18b),_0x129a31=_0x4d646f[_0x38a012(0x24e)][_0x38a012(0x1e6)];if(_0x4d646f['body'][_0x38a012(0xf4)]){let _0x88eb59=dbAlbumTable[_0x38a012(0x1e5)](_0x4d646f[_0x38a012(0x1bd)][_0x38a012(0x1da)],_0x4d646f[_0x38a012(0x24e)][_0x38a012(0xf4)]);_0x88eb59&&(_0x4b3310+=_0x38a012(0x1f8)+_0x88eb59);}if(_0x129a31){let _0x2bc573=_0x4d646f[_0x38a012(0x1bd)][_0x38a012(0x1be)][_0x38a012(0x113)](_0x38a012(0x117))['get'](_0x129a31);if(_0x2bc573)try{let _0x3065c1=JSON[_0x38a012(0x163)](_0x2bc573[_0x38a012(0x222)]),_0xd93bb=dbUserTable[_0x38a012(0x224)](!![],_0x3065c1);_0x4b3310+=_0xd93bb;}catch(_0x28ee27){console[_0x38a012(0x130)](_0x28ee27);}}function _0x371864(_0x6541c2,_0x449938,_0x23b44e){const _0x1f87c9=_0x38a012;if(_0x23b44e){let _0x2d8047=0x0;if(_0x4d646f['body'][_0x1f87c9(0x159)]){let _0x41f9d9=dbFileIndexTable['getAllByWhereAndFieldFromOrdinaryAlbumCount'](_0x4d646f[_0x1f87c9(0x1bd)][_0x1f87c9(0x1be)],_0x4d646f[_0x1f87c9(0x24e)][_0x1f87c9(0x159)],_0x6541c2);_0x2d8047=_0x41f9d9['count'];}else{let _0x26976a=dbFileIndexTable['getCountByWhere'](_0x4d646f['app']['dbFileIndex'],_0x6541c2);_0x2d8047=_0x26976a[_0x1f87c9(0x1db)];}return _0x2d8047;}else{let _0x4940fb=[];return _0x4d646f[_0x1f87c9(0x24e)][_0x1f87c9(0x159)]?_0x4940fb=dbFileIndexTable['getAllByWhereAndFieldFromOrdinaryAlbum'](_0x4d646f[_0x1f87c9(0x1bd)][_0x1f87c9(0x1be)],_0x4d646f['body'][_0x1f87c9(0x159)],_0x6541c2,_0x449938):_0x4940fb=dbFileIndexTable['getAllByWhereAndField'](_0x4d646f[_0x1f87c9(0x1bd)]['dbFileIndex'],_0x6541c2,_0x449938,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),_0x4940fb;}}_0x4b3310+=_0x1db7ff,_0x4b3310+='\x20AND\x20\x20is_file=1\x20';let _0xef0318=0xc8,_0x223fc8=[],_0x3d28cd=_0x371864(_0x4b3310,null,!![]);if(_0x3d28cd<_0xef0318)_0x223fc8=_0x371864(_0x4b3310,'*');else{let _0x462ca7=_0x4b3310+_0x38a012(0x226),_0x5070cb=_0x371864(_0x462ca7,'*');if(_0x5070cb&&_0x5070cb['length']<_0xef0318)_0x223fc8=_0x5070cb;else{let _0x5745e5=_0x4b3310+_0x38a012(0x206),_0x29213f=_0x371864(_0x5745e5,'*');if(_0x29213f&&_0x29213f[_0x38a012(0x232)]<_0xef0318)_0x223fc8=_0x29213f;else{let _0x3c369f=_0x4b3310+_0x38a012(0x153),_0x51a388=_0x371864(_0x3c369f,'*');if(_0x51a388&&_0x51a388['length']<_0xef0318)_0x223fc8=_0x51a388;else{let _0x544c73=_0x4b3310+'\x20AND\x20geohash2!=\x27undefined\x27\x20GROUP\x20BY\x20geohash2';_0x223fc8=_0x371864(_0x544c73,'*');}}}}return _0x2a95bc[_0x38a012(0xff)]({'code':0x0,'mapPhoto':_0x223fc8});}),router[_0x3b0907(0x22d)](_0x3b0907(0x1cc),(_0x4d84d8,_0x516deb,_0x4a3918)=>{const _0x5260ef=_0x3b0907;if(dbUserTable['doUserCanGet'](_0x4d84d8,_0x516deb,_0x5260ef(0x21e),'power_get')==!![]){let _0x581783=dbUserTable[_0x5260ef(0x219)](_0x4d84d8,'photo',_0x5260ef(0x152),!![]),_0x3032da=_0x4d84d8[_0x5260ef(0x24e)][_0x5260ef(0x229)],_0x4f2acf=_0x4d84d8[_0x5260ef(0x24e)]['minLng'],_0x22f0ef=_0x4d84d8[_0x5260ef(0x24e)][_0x5260ef(0x1a5)],_0xe476f9=_0x4d84d8['body'][_0x5260ef(0x17a)],_0x5ed7d5=_0x4d84d8[_0x5260ef(0x24e)][_0x5260ef(0x14d)],_0x5206e0='',_0x36b954=0x2;if(_0x5ed7d5<=0x4)_0x36b954=0x2,_0x5206e0='geohash2\x20=\x20';else{if(_0x5ed7d5<=0x6)_0x36b954=0x3,_0x5206e0='geohash3\x20=\x20';else{if(_0x5ed7d5<=0x8)_0x36b954=0x4,_0x5206e0=_0x5260ef(0x188);else _0x5ed7d5<=0xc&&(_0x36b954=0x5,_0x5206e0=_0x5260ef(0x231));}}let _0xe8de6c=geohash['bboxes'](_0x3032da,_0x4f2acf,_0x22f0ef,_0xe476f9,_0x36b954),_0x4c47d0=[];for(let _0x19ba13=0x0;_0x19ba13<_0xe8de6c['length'];_0x19ba13++){let _0x3b1287=_0xe8de6c[_0x19ba13],_0x15daa4='\x20'+_0x5206e0+'\x20\x27'+_0x3b1287+'\x27\x20'+_0x581783+'\x20AND\x20in_trash=0\x20\x20\x20AND\x20is_file=1\x20\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20limit\x201',_0x37ab6b=dbFileIndexTable[_0x5260ef(0x1d2)](_0x4d84d8[_0x5260ef(0x1bd)][_0x5260ef(0x1be)],_0x15daa4,'\x20id,geohash,latitude,longitude\x20');_0x37ab6b&&_0x4c47d0[_0x5260ef(0x195)](_0x37ab6b);}_0x516deb[_0x5260ef(0xff)]({'code':0x0,'mapPhoto':_0x4c47d0});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x1d4),(_0x3b6fd1,_0x17e9ae,_0x8261bb)=>{const _0x263939=_0x3b0907;if(dbUserTable[_0x263939(0x200)](_0x3b6fd1,_0x17e9ae,'photo',_0x263939(0x15c))==!![]){let _0x36d9f2=_0x3b6fd1[_0x263939(0x24e)]['type'],_0x54b122=_0x3b6fd1[_0x263939(0x24e)][_0x263939(0x225)],_0x17a8f6=_0x3b6fd1['body'][_0x263939(0x1b2)],_0x4d930e=_0x3b6fd1[_0x263939(0x24e)][_0x263939(0x175)],_0x40676d=_0x3b6fd1[_0x263939(0x24e)][_0x263939(0x18e)];if(!_0x54b122||!_0x54b122[_0x263939(0x1c8)]||sqliteUtil[_0x263939(0x12d)](_0x54b122[_0x263939(0x1c8)])==!![])return _0x3b6fd1['app'][_0x263939(0xfa)](_0x17e9ae,'error\x20data');if(!_0x40676d){let _0x18ce19=dbAlbumTable[_0x263939(0x1ed)](_0x3b6fd1[_0x263939(0x1bd)][_0x263939(0x1da)],_0x4d930e);if(_0x18ce19)return _0x3b6fd1[_0x263939(0x1bd)][_0x263939(0xfa)](_0x17e9ae,_0x17e9ae['__'](_0x263939(0x186)));}let _0x1182d8=null;_0x40676d?_0x1182d8=dbAlbumTable[_0x263939(0xe9)](_0x3b6fd1[_0x263939(0x1bd)][_0x263939(0x1da)],{'type':_0x36d9f2,'data':_0x54b122,'data_value':_0x17a8f6,'name':_0x4d930e},_0x40676d):_0x1182d8=dbAlbumTable[_0x263939(0x240)](_0x3b6fd1[_0x263939(0x1bd)][_0x263939(0x1da)],{'type':_0x36d9f2,'data':_0x54b122,'data_value':_0x17a8f6,'name':_0x4d930e}),_0x17e9ae[_0x263939(0xff)]({'code':0x0,'result':_0x1182d8});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x23e),(_0x4d4134,_0x3ed148,_0x21210d)=>{const _0x1c2d66=_0x3b0907;if(dbUserTable[_0x1c2d66(0x200)](_0x4d4134,_0x3ed148,'photo',_0x1c2d66(0x173))==!![]){let _0x29a96e=_0x4d4134[_0x1c2d66(0x24e)]['id'],_0x4735f7=dbAlbumTable[_0x1c2d66(0x22a)](_0x4d4134[_0x1c2d66(0x1bd)][_0x1c2d66(0x1da)],_0x29a96e);_0x4735f7[_0x1c2d66(0x149)]>0x0?_0x3ed148[_0x1c2d66(0xff)]({'code':0x0,'result':_0x4735f7}):_0x3ed148['json']({'code':0x1,'message':'operation\x20fail'});}}),router['post'](_0x3b0907(0x235),(_0x5c90cb,_0x22326c,_0x377c44)=>{const _0x14ffc3=_0x3b0907;if(dbUserTable[_0x14ffc3(0x200)](_0x5c90cb,_0x22326c,'photo',_0x14ffc3(0xeb))==!![]){let _0x52c968=_0x5c90cb[_0x14ffc3(0x24e)]['id'],_0x29dd92=_0x5c90cb[_0x14ffc3(0x24e)]['name'],_0x154b24=dbAlbumTable[_0x14ffc3(0x1ed)](_0x5c90cb['app'][_0x14ffc3(0x1da)],_0x29dd92);if(_0x154b24)return _0x5c90cb[_0x14ffc3(0x1bd)]['returnErrMsg'](_0x22326c,_0x22326c['__'](_0x14ffc3(0x186)));let _0x4f0325=dbAlbumTable[_0x14ffc3(0x1e7)](_0x5c90cb['app'][_0x14ffc3(0x1da)],_0x52c968,_0x29dd92);_0x4f0325[_0x14ffc3(0x149)]>0x0?_0x22326c[_0x14ffc3(0xff)]({'code':0x0,'result':_0x4f0325}):_0x22326c[_0x14ffc3(0xff)]({'code':0x1,'message':_0x14ffc3(0x15f)});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x165),(_0x3e98f3,_0x510ac0,_0x1fad50)=>{const _0x16ff8b=_0x3b0907;if(dbUserTable[_0x16ff8b(0x200)](_0x3e98f3,_0x510ac0,'photo',_0x16ff8b(0x152))==!![]){let _0x7c9dea=dbUserTable['getUserPathWhere'](_0x3e98f3,_0x16ff8b(0x21e),_0x16ff8b(0x152),!![]),_0x4077cf=_0x3e98f3['body'][_0x16ff8b(0x1db)]||0x32,_0x4d108b=_0x3e98f3[_0x16ff8b(0x24e)][_0x16ff8b(0x1ba)]||0x0,_0x1f5e1d=_0x3e98f3[_0x16ff8b(0x24e)][_0x16ff8b(0x21d)]||'id',_0x46ece3=_0x3e98f3[_0x16ff8b(0x24e)]['orderType']||_0x16ff8b(0x239),_0x351c7a=_0x3e98f3['body'][_0x16ff8b(0x1f4)];(![_0x16ff8b(0x175),'id'][_0x16ff8b(0x162)](_0x1f5e1d)||![_0x16ff8b(0x155),_0x16ff8b(0x239)][_0x16ff8b(0x162)](_0x46ece3))&&_0x510ac0[_0x16ff8b(0xff)]({'code':0x0,'data':[]});let _0x171217=dbAlbumTable[_0x16ff8b(0x1fd)](_0x3e98f3[_0x16ff8b(0x1bd)]['dbOther'],_0x4077cf,_0x4d108b,_0x1f5e1d,_0x46ece3,_0x351c7a);for(let _0x4302a7=0x0;_0x4302a7<_0x171217[_0x16ff8b(0x232)];_0x4302a7++){let _0x42f307=_0x16ff8b(0x1f3);_0x42f307+=_0x7c9dea;let _0x36631d=dbAlbumTable[_0x16ff8b(0x1e5)](_0x3e98f3[_0x16ff8b(0x1bd)][_0x16ff8b(0x1da)],_0x171217[_0x4302a7]['id']);_0x36631d&&(_0x42f307+=_0x16ff8b(0x1f8)+_0x36631d);_0x42f307+='\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0',_0x42f307+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';try{let _0x1f32c9=dbFileIndexTable[_0x16ff8b(0x1d1)](_0x3e98f3[_0x16ff8b(0x1bd)][_0x16ff8b(0x1be)],_0x42f307);_0x171217[_0x4302a7][_0x16ff8b(0x1a8)]=_0x1f32c9;}catch(_0x302869){console[_0x16ff8b(0x130)](_0x302869),_0x171217[_0x4302a7][_0x16ff8b(0x1a8)]=[];}}_0x510ac0[_0x16ff8b(0xff)]({'code':0x0,'data':_0x171217});}}),router['post'](_0x3b0907(0x1a4),(_0x280c9a,_0x1087b8,_0x5297c1)=>{const _0x402aaa=_0x3b0907;let _0x4e38fe=_0x280c9a[_0x402aaa(0x24e)][_0x402aaa(0x24c)],_0x8b2c5a=dbFileIndexTable['searchMode'](_0x280c9a[_0x402aaa(0x1bd)][_0x402aaa(0x1be)],_0x4e38fe),_0xddc742=[];for(let _0x1ae09d=0x0;_0x1ae09d<_0x8b2c5a[_0x402aaa(0x232)];_0x1ae09d++){_0xddc742['push'](_0x8b2c5a[_0x1ae09d][_0x402aaa(0x184)]);}_0x1087b8[_0x402aaa(0xff)]({'code':0x0,'data':_0xddc742});}),router[_0x3b0907(0x22d)](_0x3b0907(0x249),(_0x5ac1e1,_0x25ce2e,_0x2ea8ec)=>{const _0x3a16a9=_0x3b0907;let _0x34f271=_0x5ac1e1[_0x3a16a9(0x24e)]['parent'],_0x2df088=_0x5ac1e1[_0x3a16a9(0x24e)][_0x3a16a9(0x118)],_0xc66f93=_0x5ac1e1[_0x3a16a9(0x24e)]['count'],_0x2f558a=_0x5ac1e1['body'][_0x3a16a9(0x1ba)]||0x0;_0x2f558a=parseInt(_0x2f558a);let _0x444787=parseInt(_0x5ac1e1[_0x3a16a9(0x24e)][_0x3a16a9(0x134)]),_0x3c72d8=_0x5ac1e1['body'][_0x3a16a9(0x101)],_0x1099da=[_0x3a16a9(0x1c3),_0x3a16a9(0x123),_0x3a16a9(0x1cd),_0x3a16a9(0x1ca),'filename_number'],_0x7e1979=[_0x3a16a9(0x155),'desc'],_0x2bee83=_0x5ac1e1[_0x3a16a9(0x24e)]['orderField']||'id',_0x514884=_0x5ac1e1[_0x3a16a9(0x24e)][_0x3a16a9(0x208)]||'desc';!_0x1099da[_0x3a16a9(0x162)](_0x2bee83)&&(_0x2bee83='id');!_0x7e1979[_0x3a16a9(0x162)](_0x514884)&&(_0x2bee83='desc');if(dbUserTable[_0x3a16a9(0x200)](_0x5ac1e1,_0x25ce2e,_0x2df088,'power_get')==!![]){let _0x58e084=[];if(!_0x34f271){let _0x2ff9f7=[];_0x5ac1e1[_0x3a16a9(0x24d)]['is_admin']==0x1?_0x2ff9f7=dbSourceFolderTable['getPathByType'](_0x5ac1e1[_0x3a16a9(0x1bd)][_0x3a16a9(0x1da)],_0x2df088):_0x2ff9f7=dbUserTable[_0x3a16a9(0x21b)](_0x5ac1e1['app'][_0x3a16a9(0x1da)],_0x5ac1e1[_0x3a16a9(0x24d)][_0x3a16a9(0x111)],_0x2df088);if(_0x2ff9f7)for(let _0x23c1ed=0x0;_0x23c1ed<_0x2ff9f7[_0x3a16a9(0x232)];_0x23c1ed++){_0x58e084[_0x3a16a9(0x195)]({'path':_0x2ff9f7[_0x23c1ed]['path'],'is_file':0x0,'filename':path[_0x3a16a9(0x245)](_0x2ff9f7[_0x23c1ed][_0x3a16a9(0x1e1)]),'root':!![]});}}else{if(_0x5ac1e1['currentUser'][_0x3a16a9(0x154)]!=0x1){if(dbUserTable['doUserCanGet'](_0x5ac1e1,_0x25ce2e,_0x2df088,'power_get',_0x34f271)!==!![])return;}_0x34f271=path['join'](_0x34f271),_0x34f271=_0x34f271[_0x3a16a9(0x1c7)](/\'/g,'\x27\x27');let _0x3ca1d2=_0x3a16a9(0x171)+_0x34f271+'\x27\x20AND\x20';if(_0x444787==0x0)_0x3ca1d2+=_0x3a16a9(0x202);else{if(_0x444787==0x1)_0x3ca1d2+=_0x3a16a9(0x143);else{if(_0x444787==0x2)_0x3ca1d2+=_0x3a16a9(0x1bc);else _0x444787==0x3&&(_0x3ca1d2+=_0x3a16a9(0xe7));}}if(_0x3c72d8){let _0x363e0b=_0x3a16a9(0x1e9)+_0x3c72d8+'%\x27\x20OR\x20mode\x20\x20LIKE\x20\x27%'+_0x3c72d8+_0x3a16a9(0x1f1);_0x2df088=='movie'&&(_0x363e0b=_0x3a16a9(0x1b9)+_0x3c72d8+_0x3a16a9(0x198)),_0x3ca1d2+=_0x363e0b;}let _0x3b085b=_0x3a16a9(0x1a2),_0x36d656=dbFileIndexTable[_0x3a16a9(0x1f2)](_0x2df088);if(_0x2df088==_0x3a16a9(0x211))_0x3b085b='\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time\x20';else _0x2df088=='music'&&(_0x3b085b=_0x3a16a9(0x1f0));_0x3ca1d2+='\x20ORDER\x20BY\x20is_file\x20asc,\x20'+_0x2bee83+'\x20'+_0x514884+_0x3a16a9(0x16c)+_0xc66f93+_0x3a16a9(0xf2)+_0x2f558a,_0x58e084=dbFileIndexTable[_0x3a16a9(0x1d1)](_0x5ac1e1[_0x3a16a9(0x1bd)][_0x3a16a9(0x1be)],_0x3ca1d2,_0x3b085b,_0x36d656);}let _0x1aec1f=path[_0x3a16a9(0x230)],_0x5c9d01={'platform':platform,'code':0x0,'data':_0x58e084,'sep':_0x1aec1f};return _0x25ce2e[_0x3a16a9(0xff)](_0x5c9d01);}}),router[_0x3b0907(0x22d)]('/getIndexDetail',(_0x4cf4fd,_0x968ec7,_0x188743)=>{const _0x1bf6f6=_0x3b0907;let _0x53c2bd=_0x4cf4fd['body']['id'],_0x2b736c=_0x4cf4fd[_0x1bf6f6(0x24e)][_0x1bf6f6(0xfd)],_0x56761a=dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'];if(_0x2b736c=='movie')_0x56761a=dbFileIndexTable[_0x1bf6f6(0x1dd)];else{if(_0x2b736c==_0x1bf6f6(0x107))_0x56761a=dbFileIndexTable[_0x1bf6f6(0x1b6)];else _0x2b736c==_0x1bf6f6(0x124)&&(_0x56761a=dbFileIndexTable[_0x1bf6f6(0x23a)]);}let _0x3578f1=dbFileIndexTable['getById'](_0x4cf4fd[_0x1bf6f6(0x1bd)][_0x1bf6f6(0x1be)],_0x53c2bd,_0x56761a);if(!_0x3578f1)return _0x968ec7[_0x1bf6f6(0x1ec)](0x194)[_0x1bf6f6(0x148)]();if(dbUserTable['doUserCanGet'](_0x4cf4fd,_0x968ec7,'',_0x1bf6f6(0x152),_0x3578f1['path'])==!![]){let _0x186c43={'code':0x0,'data':_0x3578f1};if(_0x2b736c=='movie'){let _0x460e24=dbConfigTable['findByTitle'](_0x4cf4fd[_0x1bf6f6(0x1bd)][_0x1bf6f6(0x1da)],'moviePreferLanguage');_0x186c43[_0x1bf6f6(0x168)]=_0x460e24?_0x460e24['value']:_0x1bf6f6(0x10d),_0x186c43[_0x1bf6f6(0x225)][_0x1bf6f6(0x168)]=_0x186c43[_0x1bf6f6(0x168)];let _0x431364=dbConfigTable[_0x1bf6f6(0x203)](_0x4cf4fd[_0x1bf6f6(0x1bd)][_0x1bf6f6(0x1da)],_0x1bf6f6(0x1ef));_0x186c43['moviePlaylongPressRate']=_0x431364?_0x431364['value']:'2',_0x186c43[_0x1bf6f6(0x225)][_0x1bf6f6(0x1ef)]=_0x186c43[_0x1bf6f6(0x1ef)];let _0x14b468=dbConfigTable[_0x1bf6f6(0x203)](_0x4cf4fd['app'][_0x1bf6f6(0x1da)],_0x1bf6f6(0x199));_0x186c43[_0x1bf6f6(0x199)]=_0x14b468?_0x14b468[_0x1bf6f6(0x194)]:'3';let _0x3f3216=path['join'](_0x3578f1['path'],_0x3578f1['filename']);fs[_0x1bf6f6(0x135)](_0x3f3216,(_0x487852,_0x592798)=>{const _0x5a93bd=_0x1bf6f6;return _0x487852?(_0x186c43[_0x5a93bd(0x16d)]=0x0,_0x186c43[_0x5a93bd(0x1ea)]=_0x3f3216):(_0x186c43[_0x5a93bd(0x16d)]=0x1,_0x186c43['indexFullPath']=_0x3f3216),_0x968ec7[_0x5a93bd(0xff)](_0x186c43);});}else return _0x968ec7[_0x1bf6f6(0xff)](_0x186c43);}}),router[_0x3b0907(0x22d)](_0x3b0907(0x1c6),(_0x584b81,_0x263c15,_0x3e6eef)=>{const _0x52b680=_0x3b0907;if(dbUserTable[_0x52b680(0x200)](_0x584b81,_0x263c15,'photo',_0x52b680(0xeb))==!![]){let _0x224428=_0x584b81[_0x52b680(0x24e)]['id'],_0x4f58e0=_0x584b81['body'][_0x52b680(0x1dc)],_0x44f4fe=_0x584b81[_0x52b680(0x24e)]['longitude'],_0x5091fd=_0x584b81[_0x52b680(0x24e)][_0x52b680(0xee)],_0x56d178=dbFileIndexTable[_0x52b680(0x19e)](_0x584b81[_0x52b680(0x1bd)][_0x52b680(0x1be)],_0x224428);if(!_0x56d178)return _0x584b81[_0x52b680(0x1bd)][_0x52b680(0xfa)](_0x263c15,_0x263c15['__']('photoSavedAsNewFile'));let _0x544292=path[_0x52b680(0xfe)](_0x56d178[_0x52b680(0x1e1)],path[_0x52b680(0x230)],_0x56d178[_0x52b680(0x1c3)]),_0x3390e6=path['extname'](_0x544292)?path['extname'](_0x544292)[_0x52b680(0x150)]():'';if(_0x3390e6!=_0x52b680(0x156)&&_0x3390e6!='.jpeg')return _0x584b81[_0x52b680(0x1bd)][_0x52b680(0xfa)](_0x263c15,_0x52b680(0x102));fs[_0x52b680(0x135)](_0x544292,(_0x575f0a,_0x141326)=>{const _0x73a48b=_0x52b680;if(_0x575f0a||!_0x141326[_0x73a48b(0x1cf)]())return _0x584b81[_0x73a48b(0x1bd)][_0x73a48b(0xfa)](_0x263c15,_0x263c15['__']('folderNotExist'));if(_0x575f0a||!_0x141326['isFile']())return _0x584b81[_0x73a48b(0x1bd)][_0x73a48b(0xfa)](_0x263c15,_0x263c15['__'](_0x73a48b(0x11a)));fs[_0x73a48b(0x11e)](_0x544292,(_0x52d8c3,_0x5cff57)=>{const _0x2006d6=_0x73a48b;if(_0x52d8c3)return _0x584b81[_0x2006d6(0x1bd)][_0x2006d6(0xfa)](_0x263c15,_0x263c15['__'](_0x2006d6(0xe4)));var _0x2f736f=piexif[_0x2006d6(0x19b)](_0x5cff57[_0x2006d6(0x196)](_0x2006d6(0x201)));if(_0x4f58e0&&_0x44f4fe){function _0x5bea2b(_0x7edfa8){const _0x33aaea=_0x2006d6;try{_0x7edfa8=Number(_0x7edfa8);let _0xdfde1d=Math[_0x33aaea(0x1d9)](Math[_0x33aaea(0x11c)](_0x7edfa8)),_0x237a01=(Math[_0x33aaea(0x11c)](_0x7edfa8)-_0xdfde1d)*0x3c,_0x37d068=Math['floor'](_0x237a01),_0x31cd59=Math[_0x33aaea(0x236)]((_0x237a01-_0x37d068)*0x3c*0x64);return[[_0xdfde1d,0x1],[_0x37d068,0x1],[_0x31cd59,0x64]];}catch(_0x2ca616){return'';}}let _0x28ee96=_0x5bea2b(_0x4f58e0),_0xe72fa6=_0x5bea2b(_0x44f4fe);if(!_0xe72fa6||!_0x28ee96)return _0x584b81['app'][_0x2006d6(0xfa)](_0x263c15,'ERROR\x20GPS\x20LOCATION');_0x2f736f[_0x2006d6(0x13e)][piexif[_0x2006d6(0x142)][_0x2006d6(0x1df)]]=_0x4f58e0>=0x0?'N':'S',_0x2f736f[_0x2006d6(0x13e)][piexif[_0x2006d6(0x142)]['GPSLatitude']]=_0x28ee96,(_0x2f736f['GPS'][piexif[_0x2006d6(0x142)]['GPSLongitudeRef']]=_0x44f4fe>=0x0?'E':'W',_0x2f736f[_0x2006d6(0x13e)][piexif[_0x2006d6(0x142)]['GPSLongitude']]=_0xe72fa6);let _0x18c051=geohash[_0x2006d6(0x12f)](_0x4f58e0,_0x44f4fe,0x8),_0x370892=_0x18c051[_0x2006d6(0xf1)](0x0,0x5),_0x4ae16b=_0x18c051[_0x2006d6(0xf1)](0x0,0x4),_0x33d73c=_0x18c051[_0x2006d6(0xf1)](0x0,0x3),_0x4f71dd=_0x18c051[_0x2006d6(0xf1)](0x0,0x2);dbFileIndexTable[_0x2006d6(0x233)](_0x584b81[_0x2006d6(0x1bd)][_0x2006d6(0x1be)],_0x56d178['id'],_0x2006d6(0x20a)+_0x4f58e0+_0x2006d6(0x121)+_0x44f4fe+_0x2006d6(0x1c5)+_0x18c051+'\x27,geohash5=\x27'+_0x370892+'\x27,geohash4=\x27'+_0x4ae16b+_0x2006d6(0xf7)+_0x33d73c+_0x2006d6(0x1c0)+_0x4f71dd+'\x27\x20');}if(_0x5091fd){_0x2f736f[_0x2006d6(0x209)][piexif[_0x2006d6(0xf5)][_0x2006d6(0x237)]]=_0x5091fd,_0x2f736f[_0x2006d6(0x13e)][piexif[_0x2006d6(0x142)][_0x2006d6(0x242)]]=_0x5091fd;let _0x39ad30=new Date(_0x5091fd),_0x486148=_0x39ad30[_0x2006d6(0x207)](),_0x1ec019=_0x39ad30[_0x2006d6(0x17b)](),_0x26e022=_0x39ad30[_0x2006d6(0x22f)]()+0x1;_0x26e022=_0x26e022>=0xa?_0x26e022:'0'+_0x26e022;let _0xd754b2=_0x39ad30[_0x2006d6(0x13d)]();_0xd754b2=_0xd754b2>=0xa?_0xd754b2:'0'+_0xd754b2;let _0x483dc8=_0x1ec019+'-'+_0x26e022+'-'+_0xd754b2;dbFileIndexTable['updateBySql'](_0x584b81['app']['dbFileIndex'],_0x56d178['id'],_0x2006d6(0x122)+_0x486148+_0x2006d6(0x1b5)+_0x483dc8+'\x27\x20');}try{var _0x325c3c=piexif[_0x2006d6(0x187)](_0x2f736f),_0x3b4b9d=piexif[_0x2006d6(0x220)](_0x325c3c,_0x5cff57[_0x2006d6(0x196)](_0x2006d6(0x201)));let _0x813115=path[_0x2006d6(0xfe)](_0x56d178[_0x2006d6(0x1e1)],_0x56d178[_0x2006d6(0x1c3)]);fs[_0x2006d6(0x147)](_0x813115,Buffer[_0x2006d6(0x114)](_0x3b4b9d,_0x2006d6(0x201)),{},_0x154585=>{const _0x39039d=_0x2006d6;if(_0x154585)return console[_0x39039d(0x130)](_0x154585),_0x584b81['app'][_0x39039d(0xfa)](_0x263c15,_0x263c15['__']('operationFail'));console[_0x39039d(0x130)](_0x39039d(0x19d)),fs['utimes'](_0x813115,new Date(_0x56d178['mtime']),new Date(_0x56d178[_0x39039d(0x20f)]),_0x16721b=>{_0x16721b&&console['log'](_0x16721b),fs['stat'](_0x813115,(_0x35d16c,_0x5c705d)=>{const _0x3ad63c=_0x1a30;if(_0x35d16c)return _0x584b81[_0x3ad63c(0x1bd)]['returnErrMsg'](_0x263c15,_0x263c15['__']('operationFail'));return dbFileIndexTable[_0x3ad63c(0x233)](_0x584b81[_0x3ad63c(0x1bd)]['dbFileIndex'],_0x56d178['id'],_0x3ad63c(0x193)+_0x5c705d[_0x3ad63c(0x1cd)]+_0x3ad63c(0xed)+_0x5c705d[_0x3ad63c(0x177)]+'\x20'),_0x263c15['json']({'code':0x0,'newIndex':dbFileIndexTable[_0x3ad63c(0x19e)](_0x584b81[_0x3ad63c(0x1bd)][_0x3ad63c(0x1be)],_0x56d178['id'])});});});});}catch(_0x4d1f78){return console[_0x2006d6(0x130)](_0x4d1f78),_0x584b81[_0x2006d6(0x1bd)][_0x2006d6(0xfa)](_0x263c15,_0x263c15['__'](_0x2006d6(0x158)));}});});}}),router[_0x3b0907(0x22d)]('/getPhotoClasses',(_0x32a1c0,_0x2a0976,_0x3dd4ef)=>{const _0x34d2c8=_0x3b0907;if(dbUserTable[_0x34d2c8(0x200)](_0x32a1c0,_0x2a0976,_0x34d2c8(0x21e),'power_get')==!![]){let _0x1dff30=dbConfigTable[_0x34d2c8(0x203)](_0x32a1c0[_0x34d2c8(0x1bd)][_0x34d2c8(0x1da)],'aiClassesEnable');if(!_0x1dff30||_0x1dff30['value']!='1')return _0x2a0976[_0x34d2c8(0xff)]({'code':0x0,'data':[],'enable':![]});let _0x2706c3=_0x34d2c8(0x144),_0x537153=dbUserTable[_0x34d2c8(0x219)](_0x32a1c0,'photo',_0x34d2c8(0x152),!![]),_0x22a6e5=_0x32a1c0[_0x34d2c8(0x1bd)][_0x34d2c8(0x1be)][_0x34d2c8(0x113)](_0x34d2c8(0x1a3)+_0x2706c3)['all'](),_0x449cfc=[];for(let _0x1ef6e7 in _0x22a6e5){let _0x2170a0=_0x22a6e5[_0x1ef6e7],_0x1574d2=_0x32a1c0[_0x34d2c8(0x1bd)]['dbFileIndex'][_0x34d2c8(0x113)]('SELECT\x20f.id\x20as\x20photo_index_id\x20FROM\x20ai_classes2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20a.photo_index_id=f.id\x20WHERE\x20a.class_id=?\x20and\x20score>?\x20and\x20\x20f.in_trash=0\x20\x20and\x20f.tiny_path\x20is\x20not\x20null\x20AND\x20f.tiny_path\x20!=\x20\x270\x27\x20\x20'+_0x537153+_0x34d2c8(0x136))[_0x34d2c8(0x151)](_0x2170a0['id'],dbFileIndexTable[_0x34d2c8(0x1fb)]);if(_0x1574d2)_0x22a6e5[_0x1ef6e7][_0x34d2c8(0xea)]=_0x1574d2['photo_index_id'],_0x22a6e5[_0x1ef6e7]['class_id']=_0x22a6e5[_0x1ef6e7]['id'],_0x449cfc[_0x34d2c8(0x195)](_0x22a6e5[_0x1ef6e7]);else continue;}_0x2a0976[_0x34d2c8(0xff)]({'code':0x0,'data':_0x449cfc,'enable':!![]});}}),router['post'](_0x3b0907(0x23d),(_0x535c1b,_0x386457,_0x1de180)=>{const _0x3ce77b=_0x3b0907;if(dbUserTable[_0x3ce77b(0x200)](_0x535c1b,_0x386457,'photo',_0x3ce77b(0x152))==!![]){let _0x161f3a=dbConfigTable['findByTitle'](_0x535c1b[_0x3ce77b(0x1bd)][_0x3ce77b(0x1da)],'aiFaceEnable');if(!_0x161f3a||_0x161f3a['value']!='1')return _0x386457[_0x3ce77b(0xff)]({'code':0x0,'data':[],'enable':![]});let _0x2d9c7d=0x5,_0xccfeab=dbConfigTable[_0x3ce77b(0x203)](_0x535c1b[_0x3ce77b(0x1bd)][_0x3ce77b(0x1da)],_0x3ce77b(0x12e));_0xccfeab&&_0xccfeab['value']&&(_0xccfeab[_0x3ce77b(0x194)]>0x0&&(_0x2d9c7d=_0xccfeab[_0x3ce77b(0x194)]));let _0x2049f8=_0x535c1b[_0x3ce77b(0x1bd)][_0x3ce77b(0x1be)][_0x3ce77b(0x113)](_0x3ce77b(0x10f))[_0x3ce77b(0x185)](parseInt(_0x2d9c7d)),_0xd49aab=[];if(_0x535c1b[_0x3ce77b(0x24d)]['is_admin']==0x1)_0xd49aab=_0x2049f8;else{let _0xd5c3e4=dbUserTable[_0x3ce77b(0x219)](_0x535c1b,_0x3ce77b(0x21e),'power_get',!![]);for(let _0x27f1d7 of _0x2049f8){try{let _0x33d152=_0x535c1b[_0x3ce77b(0x1bd)][_0x3ce77b(0x1be)][_0x3ce77b(0x113)](_0x3ce77b(0x20b)+_0xd5c3e4+_0x3ce77b(0x108))[_0x3ce77b(0x151)](_0x27f1d7['id']);_0x33d152&&_0xd49aab[_0x3ce77b(0x195)](_0x27f1d7);}catch(_0x342ca8){console[_0x3ce77b(0x130)](_0x342ca8),_0xd49aab[_0x3ce77b(0x195)](_0x27f1d7);}}}_0x386457[_0x3ce77b(0xff)]({'code':0x0,'data':_0xd49aab,'enable':!![]});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x145),(_0x20b4e8,_0x299d46,_0x17b9be)=>{const _0x1f520d=_0x3b0907;let _0x410a3d=_0x20b4e8['body'][_0x1f520d(0x191)],_0x2b6a5b=_0x20b4e8[_0x1f520d(0x24e)][_0x1f520d(0x238)],_0x5b67c4=_0x20b4e8[_0x1f520d(0x24e)][_0x1f520d(0x15b)];if(dbUserTable[_0x1f520d(0x200)](_0x20b4e8,_0x299d46,_0x1f520d(0x21e),_0x1f520d(0xeb))==!![]){let _0x5e7262=dbFileIndexTable[_0x1f520d(0x160)](_0x20b4e8[_0x1f520d(0x1bd)][_0x1f520d(0x1be)],_0x410a3d);_0x20b4e8[_0x1f520d(0x1bd)][_0x1f520d(0x1be)][_0x1f520d(0x113)](_0x1f520d(0x218)+_0x5e7262)[_0x1f520d(0x205)](),_0x20b4e8[_0x1f520d(0x1bd)][_0x1f520d(0x1be)]['prepare'](_0x1f520d(0x1c1)+_0x5b67c4+'\x20and\x20face_id='+_0x2b6a5b)[_0x1f520d(0x205)](),_0x20b4e8['app'][_0x1f520d(0x1be)][_0x1f520d(0x113)](_0x1f520d(0x241)+_0x410a3d)[_0x1f520d(0x205)](),_0x299d46[_0x1f520d(0xff)]({'code':0x0});}}),router['post'](_0x3b0907(0x1ad),(_0xb16ac0,_0x955aa2,_0x467ef3)=>{const _0x3afef1=_0x3b0907;let _0xac93e0=_0xb16ac0['body'][_0x3afef1(0xf3)];try{_0xac93e0=JSON['parse'](_0xac93e0);}catch(_0x2b4215){console[_0x3afef1(0x130)](_0x2b4215);}if(dbUserTable['doUserCanGet'](_0xb16ac0,_0x955aa2,_0x3afef1(0x21e),_0x3afef1(0xeb))==!![]){for(let _0x2e9584 of _0xac93e0){_0xb16ac0[_0x3afef1(0x1bd)][_0x3afef1(0x1be)][_0x3afef1(0x113)]('DELETE\x20FROM\x20photo_faces2index\x20where\x20face_id=?\x20and\x20photo_index_id\x20=?')[_0x3afef1(0x205)](parseInt(_0x2e9584[_0x3afef1(0xe8)]),parseInt(_0x2e9584[_0x3afef1(0x133)]));}_0x955aa2['json']({'code':0x0});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x24b),(_0x507730,_0x150741,_0x133f54)=>{const _0x5d44ef=_0x3b0907;if(dbUserTable[_0x5d44ef(0x200)](_0x507730,_0x150741,_0x5d44ef(0x21e),_0x5d44ef(0xeb))==!![]){let _0x1877b7=_0x507730[_0x5d44ef(0x24e)][_0x5d44ef(0x120)],_0x4cc5b4=_0x507730[_0x5d44ef(0x24e)][_0x5d44ef(0x23c)],_0x29cf4f=_0x507730['body'][_0x5d44ef(0xe8)],_0x1d28f5=_0x507730[_0x5d44ef(0x24e)][_0x5d44ef(0x119)];if(_0x1877b7){_0x1877b7=_0x1877b7[_0x5d44ef(0x189)]();let _0x367d5e=_0x507730[_0x5d44ef(0x1bd)][_0x5d44ef(0x1be)][_0x5d44ef(0x113)]('SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20face_name=?\x20and\x20belong_face_id\x20is\x20null')[_0x5d44ef(0x151)](_0x1877b7);_0x367d5e&&_0x367d5e['id']!=_0x29cf4f?_0x507730['app'][_0x5d44ef(0x1be)][_0x5d44ef(0x113)]('UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?')[_0x5d44ef(0x205)](_0x367d5e['id'],_0x29cf4f):(_0x507730[_0x5d44ef(0x1bd)][_0x5d44ef(0x1be)][_0x5d44ef(0x113)](_0x5d44ef(0x16e))[_0x5d44ef(0x205)](_0x1877b7),_0x507730[_0x5d44ef(0x1bd)][_0x5d44ef(0x1be)][_0x5d44ef(0x113)](_0x5d44ef(0x19f))[_0x5d44ef(0x205)](_0x1877b7,_0x29cf4f));}if(parseInt(_0x4cc5b4)==0x0||parseInt(_0x4cc5b4)==0x1){if(_0x1d28f5){let _0x2f2802=_0x5d44ef(0x181);for(let _0x429428 in _0x1d28f5){_0x2f2802+=_0x1d28f5[_0x429428],_0x429428!=_0x1d28f5[_0x5d44ef(0x232)]-0x1&&(_0x2f2802+=',');}_0x2f2802+=')';let _0x46ef69='UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20'+_0x2f2802;_0x507730[_0x5d44ef(0x1bd)][_0x5d44ef(0x1be)][_0x5d44ef(0x113)](_0x46ef69)[_0x5d44ef(0x205)](_0x4cc5b4);}else _0x507730[_0x5d44ef(0x1bd)]['dbFileIndex'][_0x5d44ef(0x113)](_0x5d44ef(0x15e))['run'](_0x4cc5b4,_0x29cf4f);}return _0x150741[_0x5d44ef(0xff)]({'code':0x0});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x1fe),(_0x3c9422,_0x34bfdf,_0x15d172)=>{const _0x34373a=_0x3b0907;if(dbUserTable[_0x34373a(0x200)](_0x3c9422,_0x34bfdf,_0x34373a(0x21e),'power_change')==!![]){let _0x1831ed=_0x3c9422['body']['faceIdList'];if(!_0x1831ed||_0x1831ed[_0x34373a(0x232)]<0x2)return _0x3c9422[_0x34373a(0x1bd)][_0x34373a(0xfa)](_0x34bfdf,_0x34bfdf['__'](_0x34373a(0x103)));let _0xe5ca10=_0x3c9422[_0x34373a(0x1bd)][_0x34373a(0x1be)][_0x34373a(0x113)](_0x34373a(0x1ae))[_0x34373a(0x151)](_0x1831ed[0x0]);if(!_0xe5ca10)return _0x3c9422[_0x34373a(0x1bd)]['returnErrMsg'](_0x34bfdf,_0x34bfdf['__'](_0x34373a(0xe4)));for(let _0x2281cf=0x1;_0x2281cf<_0x1831ed['length'];_0x2281cf++){let _0x439ad8=_0x1831ed[_0x2281cf];_0x3c9422['app'][_0x34373a(0x1be)][_0x34373a(0x113)](_0x34373a(0x17d))[_0x34373a(0x205)](_0xe5ca10['id'],_0x439ad8,_0x439ad8);}return process[_0x34373a(0x109)]({'type':_0x34373a(0x1a6)}),_0x34bfdf[_0x34373a(0xff)]({'code':0x0});}}),router[_0x3b0907(0x151)](_0x3b0907(0x14b),(_0x3ebc2a,_0x396f36,_0x4048c6)=>{const _0x4107c9=_0x3b0907;let _0x251a03=_0x3ebc2a['query']['faceId'];if(dbUserTable['doUserCanGet'](_0x3ebc2a,_0x396f36,_0x4107c9(0x21e),_0x4107c9(0x152))==!![]){let _0x2e4b0a=_0x3ebc2a[_0x4107c9(0x1bd)][_0x4107c9(0x1be)][_0x4107c9(0x113)](_0x4107c9(0x1d3))[_0x4107c9(0x151)](_0x251a03);if(!_0x2e4b0a)return _0x396f36[_0x4107c9(0x1ec)](0x194)[_0x4107c9(0x148)]();_0x3ebc2a[_0x4107c9(0x24d)][_0x4107c9(0x154)]!=0x1?_0x52db99(![]):!_0x2e4b0a[_0x4107c9(0x1c2)]?_0x52db99(!![]):fs[_0x4107c9(0x135)](_0x2e4b0a[_0x4107c9(0x1c2)],(_0x3315df,_0x150a3c)=>{const _0x4c510c=_0x4107c9;if(!_0x3315df){let _0x424de4=new Date()['getTime'](),_0x2b06f2=0x48*0xe10*0x3e8;if(_0x150a3c[_0x4c510c(0x177)]){let _0x22daf7=_0x424de4-_0x150a3c['ctimeMs'];if(_0x22daf7>_0x2b06f2)return _0x52db99(!![]);}return _0x396f36['sendFile'](_0x2e4b0a[_0x4c510c(0x1c2)]);}_0x52db99(!![]);});function _0x52db99(_0x5c50c4){const _0x2c3595=_0x4107c9;let _0x1466cb=dbFileIndexTable[_0x2c3595(0x160)](_0x3ebc2a['app'][_0x2c3595(0x1be)],_0x251a03),_0x53a923=_0x2c3595(0x1bb)+_0x1466cb+'\x20';if(_0x3ebc2a[_0x2c3595(0x24d)][_0x2c3595(0x154)]!=0x1){let _0x23b1d6=dbUserTable[_0x2c3595(0x219)](_0x3ebc2a,'photo',_0x2c3595(0x152),!![]);_0x53a923+=_0x23b1d6;}let _0x2f0ddd=_0x3ebc2a[_0x2c3595(0x1bd)][_0x2c3595(0x1be)]['prepare'](_0x53a923+_0x2c3595(0x13b))[_0x2c3595(0x151)]();if(!_0x2f0ddd){_0x2f0ddd=_0x3ebc2a[_0x2c3595(0x1bd)][_0x2c3595(0x1be)][_0x2c3595(0x113)](_0x53a923+_0x2c3595(0x21c))[_0x2c3595(0x151)]();if(!_0x2f0ddd)return _0x396f36[_0x2c3595(0x1ec)](0x194)[_0x2c3595(0x148)]();}if(!_0x2f0ddd)return _0x396f36[_0x2c3595(0x1ec)](0x194)[_0x2c3595(0x148)]();let _0x105001=path['join'](_0x2f0ddd[_0x2c3595(0x1e1)],_0x2f0ddd['filename']);if(parseInt(_0x2f0ddd[_0x2c3595(0x11b)])==0x2){let _0x39b167=config[_0x2c3595(0x20e)](_0x2f0ddd),_0x3e4d02=path[_0x2c3595(0xfe)](config[_0x2c3595(0x172)],_0x39b167);sharpUtil[_0x2c3595(0xfb)](_0x105001,path['dirname'](_0x3e4d02),path[_0x2c3595(0x245)](_0x3e4d02),'video',_0x2f0ddd,_0x36ee39=>{_0x105001=_0x3e4d02,_0x1920f1();},_0x37f283=>{const _0xc2dbc3=_0x2c3595;return _0x396f36[_0xc2dbc3(0x1ec)](0x194)[_0xc2dbc3(0x148)]();});}else _0x1920f1();function _0x1920f1(){const _0x22d562=_0x2c3595;let _0x38f3b1=path[_0x22d562(0xfe)](config[_0x22d562(0x22b)],_0x2f0ddd[_0x22d562(0x23b)]+new Date()[_0x22d562(0x207)]()+_0x22d562(0x156)),_0x433813=0x7d0;sharpUtil[_0x22d562(0x18f)](_0x105001,(_0x60139a,_0x23b53c,_0x55333f)=>{const _0x489c8d=_0x22d562;let _0x1498de=parseInt(_0x2f0ddd[_0x489c8d(0x146)]*1.4),_0x2be665=parseInt(_0x2f0ddd['f2height']*1.4),_0x2fb25a=parseInt(_0x2f0ddd[_0x489c8d(0x14a)]-_0x1498de*0.2),_0x47c1a1=parseInt(_0x2f0ddd[_0x489c8d(0x1d8)]-_0x2be665*0.2);if(_0x47c1a1<0x0)_0x47c1a1=0x0;if(_0x2fb25a<0x0)_0x2fb25a=0x0;_0x5fd362(_0x60139a,_0x23b53c,_0x55333f,_0x2fb25a,_0x47c1a1,_0x1498de,_0x2be665,()=>{const _0x3af559=_0x489c8d;let _0x4a3d12=parseInt(_0x2f0ddd[_0x3af559(0x146)]),_0x2a9ab4=parseInt(_0x2f0ddd[_0x3af559(0x17c)]),_0x1abdcb=parseInt(_0x2f0ddd[_0x3af559(0x14a)]),_0x4f3334=parseInt(_0x2f0ddd['f2y']);if(_0x4f3334<0x0)_0x4f3334=0x0;if(_0x1abdcb<0x0)_0x1abdcb=0x0;_0x5fd362(_0x60139a,_0x23b53c,_0x55333f,_0x1abdcb,_0x4f3334,_0x4a3d12,_0x2a9ab4);});});function _0x5fd362(_0x5958e4,_0x4422cb,_0x5a0931,_0x404cc5,_0x4e558a,_0x3e1c52,_0x4f0032,_0x32f5a1){const _0x32cfc1=_0x22d562;let _0x11a7c9=sharpUtil['getSharpInstanceFromInput'](_0x5958e4),_0x53e851=exifUtils['getRotateFromTags'](_0x5a0931);_0x53e851?_0x11a7c9=_0x11a7c9['rotate'](_0x53e851):_0x11a7c9=_0x11a7c9[_0x32cfc1(0xe6)](),_0x11a7c9[_0x32cfc1(0x179)]({'width':_0x433813,'height':_0x433813,'withoutEnlargement':!![]})[_0x32cfc1(0xec)]()[_0x32cfc1(0x1ac)]({'left':_0x404cc5,'top':_0x4e558a,'width':_0x3e1c52,'height':_0x4f0032})[_0x32cfc1(0x1aa)](_0x38f3b1,function(_0x1abf48){const _0x44b856=_0x32cfc1;if(_0x1abf48){_0x4422cb&&sharpUtil[_0x44b856(0x1d0)](_0x5958e4);if(_0x32f5a1)_0x32f5a1();else return _0x396f36[_0x44b856(0x1ec)](0x194)['end']();}else{_0x4422cb&&sharpUtil[_0x44b856(0x1d0)](_0x5958e4);if(_0x5c50c4)return _0x3ebc2a['app'][_0x44b856(0x1be)][_0x44b856(0x113)](_0x44b856(0x11d)+_0x38f3b1+'\x27\x20where\x20id='+_0x251a03)[_0x44b856(0x205)](),_0x396f36['sendFile'](_0x38f3b1);else _0x396f36[_0x44b856(0x138)](_0x38f3b1),_0x396f36['on'](_0x44b856(0x14f),()=>{fs['rm'](_0x38f3b1,_0x47b7b2=>{});});}});}}}}}),router[_0x3b0907(0x22d)]('/switchFaceId',(_0x2c1d69,_0x942f25,_0x5d10d7)=>{const _0x1a3cf6=_0x3b0907;let _0x3dda9e=_0x2c1d69[_0x1a3cf6(0x24e)][_0x1a3cf6(0x182)],_0x5a5d74=_0x2c1d69[_0x1a3cf6(0x24e)][_0x1a3cf6(0x100)],_0x29fad6=[];if(!_0x3dda9e||!_0x5a5d74)return _0x942f25[_0x1a3cf6(0xff)]({'code':0x0,'sucIdList':_0x29fad6});try{_0x5a5d74=JSON[_0x1a3cf6(0x163)](_0x5a5d74);for(let _0x308155 in _0x5a5d74){let _0x2705a7=_0x5a5d74[_0x308155],_0x84b355=_0x2c1d69['app'][_0x1a3cf6(0x1be)][_0x1a3cf6(0x113)](_0x1a3cf6(0x1bf))[_0x1a3cf6(0x205)](parseInt(_0x3dda9e),parseInt(_0x2705a7['face_id']),parseInt(_0x2705a7['photo_index_id']));_0x29fad6[_0x1a3cf6(0x195)](_0x2705a7[_0x1a3cf6(0xea)]);}return _0x942f25[_0x1a3cf6(0xff)]({'code':0x0,'sucIdList':_0x29fad6});}catch(_0x2cb819){return console[_0x1a3cf6(0x130)](_0x2cb819),_0x942f25[_0x1a3cf6(0xff)]({'code':0x0,'sucIdList':_0x29fad6});}}),router[_0x3b0907(0x22d)](_0x3b0907(0x1fc),(_0x431c00,_0x1b3a0c,_0x4d6629)=>{const _0x4911af=_0x3b0907;let _0x381e2a=_0x431c00['body'][_0x4911af(0x11b)],_0x306765={};if(_0x431c00[_0x4911af(0x24d)][_0x4911af(0x154)]==0x1){if(!_0x381e2a||_0x381e2a==_0x4911af(0x174)){let _0x4b091a=_0x431c00[_0x4911af(0x1bd)][_0x4911af(0x1be)][_0x4911af(0x113)](_0x4911af(0x20d))[_0x4911af(0x151)]();_0x306765['faceApiWaitDealCount']=_0x4b091a[_0x4911af(0x1db)];if(_0x4b091a[_0x4911af(0x1db)]<0x1){let _0x4690c1=_0x431c00['app']['dbFileIndex']['prepare'](_0x4911af(0xf9))[_0x4911af(0x151)]();_0x306765[_0x4911af(0x14e)]=_0x4690c1[_0x4911af(0x1db)];}}if(!_0x381e2a||_0x381e2a==_0x4911af(0x112)){let _0x2787d3=_0x431c00[_0x4911af(0x1bd)][_0x4911af(0x1be)][_0x4911af(0x113)](_0x4911af(0x227))[_0x4911af(0x151)]();_0x306765[_0x4911af(0x1c4)]=_0x2787d3[_0x4911af(0x1db)];}if(!_0x381e2a||_0x381e2a==_0x4911af(0x16b)){let _0x792fbc=_0x431c00[_0x4911af(0x1bd)]['dbFileIndex'][_0x4911af(0x113)](_0x4911af(0x221))[_0x4911af(0x151)]();_0x306765[_0x4911af(0x1e2)]=_0x792fbc['count'];}}let _0x5cb6dd=dbConfigTable[_0x4911af(0x203)](_0x431c00[_0x4911af(0x1bd)]['dbOther'],_0x4911af(0x1b0)),_0x21fb27=0x0;return!_0x5cb6dd?_0x21fb27=0x0:_0x21fb27=_0x5cb6dd[_0x4911af(0x194)],_0x306765['isIndexing']=_0x21fb27,_0x1b3a0c[_0x4911af(0xff)]({'code':0x0,'data':_0x306765});}),router[_0x3b0907(0x22d)](_0x3b0907(0x1b8),(_0x377908,_0x33b142,_0x37d80e)=>{const _0x51f361=_0x3b0907;if(dbUserTable[_0x51f361(0x200)](_0x377908,_0x33b142,'photo',_0x51f361(0xeb))==!![])try{fs['rm'](config['facesPath'],{'recursive':!![]},_0x147a8c=>{const _0x3ab765=_0x51f361;if(_0x147a8c)return console[_0x3ab765(0x130)](_0x147a8c),_0x377908[_0x3ab765(0x1bd)]['returnErrMsg'](_0x33b142,_0x33b142['__'](_0x3ab765(0x19a))+':'+config[_0x3ab765(0x22b)],_0x3ab765(0x1ab));fs[_0x3ab765(0x1a9)](config[_0x3ab765(0x22b)],_0x2117fc=>{const _0x1adb50=_0x3ab765;if(_0x2117fc)return _0x377908[_0x1adb50(0x1bd)][_0x1adb50(0xfa)](_0x33b142,_0x33b142['__'](_0x1adb50(0xe4)),'dialog');let _0x1b4346=_0x377908[_0x1adb50(0x1bd)]['dbFileIndex'][_0x1adb50(0x1a0)](()=>{const _0x5b3f85=_0x1adb50;return _0x377908[_0x5b3f85(0x1bd)]['dbFileIndex'][_0x5b3f85(0x113)]('delete\x20from\x20photo_faces\x20where\x201=1')[_0x5b3f85(0x205)](),_0x377908['app']['dbFileIndex']['prepare'](_0x5b3f85(0x137))['run'](),_0x377908['app'][_0x5b3f85(0x1be)]['prepare'](_0x5b3f85(0x10e))[_0x5b3f85(0x205)](),process[_0x5b3f85(0x109)]({'type':_0x5b3f85(0x1a6)}),_0x33b142[_0x5b3f85(0xff)]({'code':0x0});});_0x1b4346();});});}catch(_0x19a7a9){return _0x377908[_0x51f361(0x1bd)]['returnErrMsg'](_0x33b142,_0x33b142['__'](_0x51f361(0xe4)),_0x51f361(0x1ab));}}),router['post'](_0x3b0907(0x180),(_0x2c8a2e,_0x3c1e69,_0x1effc3)=>{const _0x317fcb=_0x3b0907;if(dbUserTable[_0x317fcb(0x200)](_0x2c8a2e,_0x3c1e69,_0x317fcb(0x21e),_0x317fcb(0xeb))==!![])try{let _0x33a3b3=_0x2c8a2e[_0x317fcb(0x1bd)][_0x317fcb(0x1be)]['transaction'](()=>{const _0x8f1d40=_0x317fcb;return _0x2c8a2e[_0x8f1d40(0x1bd)][_0x8f1d40(0x1be)]['prepare'](_0x8f1d40(0x1b3))[_0x8f1d40(0x205)](),_0x2c8a2e['app'][_0x8f1d40(0x1be)]['prepare'](_0x8f1d40(0x1de))['run'](),process[_0x8f1d40(0x109)]({'type':_0x8f1d40(0x161)}),_0x3c1e69['json']({'code':0x0});});_0x33a3b3();}catch(_0x2b205a){return _0x2c8a2e[_0x317fcb(0x1bd)][_0x317fcb(0xfa)](_0x3c1e69,_0x3c1e69['__'](_0x317fcb(0xe4)),_0x317fcb(0x1ab));}}),router[_0x3b0907(0x22d)]('/getSimilarPhoto',(_0x3ca266,_0x3a5412,_0x50054f)=>{const _0x45c030=_0x3b0907;if(dbUserTable['isAdmin'](_0x3ca266,_0x3a5412)!==!![])return;let _0x3f449a=dbConfigTable[_0x45c030(0x203)](_0x3ca266['app'][_0x45c030(0x1da)],'aiSimilarPhotoEnable');if(!_0x3f449a||_0x3f449a['value']!='1')return _0x3a5412[_0x45c030(0xff)]({'code':0x0,'data':[],'enable':![]});let _0x56cc79=_0x3ca266['body'][_0x45c030(0x246)];if(!_0x56cc79)_0x56cc79=0x0;let _0x196bad=_0x3ca266['body'][_0x45c030(0x1db)];if(!_0x196bad||_0x196bad>0x64)_0x196bad=0x64;let _0x107da6=[],_0x4c76d5=_0x3ca266[_0x45c030(0x1bd)]['dbFileIndex'][_0x45c030(0x113)]('SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id')[_0x45c030(0x185)](),_0x33a435=_0x3ca266[_0x45c030(0x1bd)][_0x45c030(0x1be)]['prepare'](_0x45c030(0x125)+_0x196bad)[_0x45c030(0x185)]();for(let _0x51b024 in _0x33a435){let _0x45f2ad=_0x33a435[_0x51b024],_0x32315a=_0x3ca266['app']['dbFileIndex'][_0x45c030(0x113)](_0x45c030(0x139)+_0x45f2ad['index_id'])[_0x45c030(0x151)](),_0x1345aa=_0x3ca266[_0x45c030(0x1bd)][_0x45c030(0x1be)][_0x45c030(0x113)](_0x45c030(0x190)+_0x45f2ad[_0x45c030(0x24a)])[_0x45c030(0x185)]();_0x33a435[_0x51b024][_0x45c030(0x178)]=_0x32315a,_0x33a435[_0x51b024][_0x45c030(0x141)]=[_0x32315a],_0x33a435[_0x51b024][_0x45c030(0x141)][_0x45c030(0x195)](..._0x1345aa),_0x33a435[_0x51b024][_0x45c030(0x141)][_0x45c030(0x232)]>0x1?_0x107da6[_0x45c030(0x195)](_0x33a435[_0x51b024]):_0x3ca266[_0x45c030(0x1bd)][_0x45c030(0x1be)][_0x45c030(0x113)](_0x45c030(0x129))[_0x45c030(0x205)](_0x45f2ad[_0x45c030(0x24a)]);}return _0x3a5412[_0x45c030(0xff)]({'code':0x0,'data':_0x107da6,'enable':!![],'waitDealCount':_0x4c76d5[_0x45c030(0x232)]});}),router[_0x3b0907(0x22d)](_0x3b0907(0x212),(_0x1aa080,_0x2e325c,_0x299618)=>{const _0x243049=_0x3b0907;if(dbUserTable[_0x243049(0x15d)](_0x1aa080,_0x2e325c)!==!![])return;nasAccountUtil[_0x243049(0x13a)](_0x2e325c,_0x1aa080[_0x243049(0x1bd)][_0x243049(0x1da)])[_0x243049(0x12b)](_0xa4421a=>{const _0x29b7b1=_0x243049;if(!_0xa4421a)return;let _0x1f1a06=_0x1aa080[_0x29b7b1(0x24e)][_0x29b7b1(0xfc)];for(let _0x16754b in _0x1f1a06){let _0x4ea3e8=_0x1aa080[_0x29b7b1(0x1bd)]['dbFileIndex']['prepare'](_0x29b7b1(0x1f5)+_0x1f1a06[_0x16754b][_0x29b7b1(0x24a)])[_0x29b7b1(0x185)]();for(let _0x2aff74 in _0x4ea3e8){if(!_0x1f1a06[_0x16754b][_0x29b7b1(0x248)][_0x29b7b1(0x162)](parseInt(_0x4ea3e8[_0x2aff74][_0x29b7b1(0x18a)]))){let _0x533580=new Date()['getTime']();_0x1aa080[_0x29b7b1(0x1bd)][_0x29b7b1(0x1be)][_0x29b7b1(0x113)](_0x29b7b1(0xf6)+dbFileIndexTable[_0x29b7b1(0x166)]+_0x29b7b1(0x20c)+_0x533580+_0x29b7b1(0x234)+_0x4ea3e8[_0x2aff74]['similar_index_id'])[_0x29b7b1(0x205)]();}}if(!_0x1f1a06[_0x16754b][_0x29b7b1(0x248)][_0x29b7b1(0x162)](parseInt(_0x1f1a06[_0x16754b][_0x29b7b1(0x24a)]))){let _0x42fc21=new Date()[_0x29b7b1(0x207)]();_0x1aa080[_0x29b7b1(0x1bd)][_0x29b7b1(0x1be)]['prepare'](_0x29b7b1(0xf6)+dbFileIndexTable[_0x29b7b1(0x166)]+_0x29b7b1(0x20c)+_0x42fc21+_0x29b7b1(0x234)+_0x1f1a06[_0x16754b][_0x29b7b1(0x24a)])[_0x29b7b1(0x205)]();}_0x1aa080[_0x29b7b1(0x1bd)]['dbFileIndex'][_0x29b7b1(0x113)]('delete\x20from\x20photo_phash_similar\x20where\x20index_id='+_0x1f1a06[_0x16754b][_0x29b7b1(0x24a)])[_0x29b7b1(0x205)]();}return _0x2e325c[_0x29b7b1(0xff)]({'code':0x0});});}),router[_0x3b0907(0x22d)](_0x3b0907(0x131),(_0x42c7cb,_0x212bee,_0x2404f7)=>{const _0x5e673f=_0x3b0907;if(dbUserTable[_0x5e673f(0x200)](_0x42c7cb,_0x212bee,_0x5e673f(0x21e),'power_change','')==!![]){let _0x199057=_0x42c7cb[_0x5e673f(0x1bd)][_0x5e673f(0x1be)][_0x5e673f(0x113)]('SELECT\x20*\x20FROM\x20file_index_photo\x20WHERE\x20in_trash=1\x20AND\x20is_file=1\x20AND\x20raw_filename\x20is\x20not\x20null\x20AND\x20raw_filename!=\x27\x27\x20AND\x20type=1')[_0x5e673f(0x185)]();for(let _0x1b6212 of _0x199057){_0x42c7cb[_0x5e673f(0x1bd)][_0x5e673f(0x1be)]['prepare'](_0x5e673f(0xf8))[_0x5e673f(0x205)](_0x1b6212['path'],_0x1b6212[_0x5e673f(0x21a)]);}return _0x42c7cb['app'][_0x5e673f(0x1be)][_0x5e673f(0x113)](_0x5e673f(0xf6)+dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']+_0x5e673f(0x1b1))[_0x5e673f(0x205)](),_0x212bee[_0x5e673f(0xff)]({'code':0x0});}}),router['post'](_0x3b0907(0x1af),(_0x3673b6,_0x245010,_0x2aede9)=>{const _0x12b251=_0x3b0907;let _0x301795=_0x3673b6['body'][_0x12b251(0x210)],_0x474c52=dbFileIndexTable[_0x12b251(0x1d1)](_0x3673b6['app'][_0x12b251(0x1be)],_0x12b251(0x12a),_0x12b251(0x215),dbFileIndexTable[_0x12b251(0x166)]),_0xb8e5ac=dbFileIndexTable[_0x12b251(0x166)];console[_0x12b251(0x130)](_0x12b251(0x10c)+_0x474c52[_0x12b251(0x232)]);function _0x3c340d(_0x2b0012,_0x4fe00a){const _0x42c260=_0x12b251;dbFileOperationRecord['addFileOperationRecord'](_0x3673b6[_0x42c260(0x1bd)]['dbOther'],{'username':_0x3673b6[_0x42c260(0x24d)][_0x42c260(0x111)],'targetPath':_0x2b0012,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x42c260(0x1ee)],'state':_0x4fe00a?dbFileOperationRecord[_0x42c260(0x1e4)]:dbFileOperationRecord[_0x42c260(0x243)]});}function _0x2ecf12(_0x54565c){const _0x5e8585=_0x12b251;if(_0x54565c[_0x5e8585(0x23f)]==0x1&&_0x54565c[_0x5e8585(0x216)]==0x1){let _0x552cad=path[_0x5e8585(0xfe)](_0x54565c[_0x5e8585(0x1e1)],_0x54565c[_0x5e8585(0x1c3)]['replace'](_0x5e8585(0x167),'')+'.HEIC');_0x54565c['filename'][_0x5e8585(0x16f)]('.MP4')&&(_0x552cad=path[_0x5e8585(0xfe)](_0x54565c[_0x5e8585(0x1e1)],_0x54565c[_0x5e8585(0x1c3)][_0x5e8585(0x1c7)](_0x5e8585(0x10a),'')+_0x5e8585(0x247))),fs[_0x5e8585(0x104)](_0x552cad)&&(console['log']('存在livephoto',_0x552cad),_0x16bb31(_0x54565c,_0x552cad,![]));}}function _0x16bb31(_0x185c3e,_0x56f465,_0xe55249){const _0x1578e4=_0x12b251;_0x301795==0x1?(process[_0x1578e4(0x109)]({'type':_0x1578e4(0x18c),'shellType':_0x1578e4(0x1f6),'path':_0x56f465}),_0x3c340d(_0x56f465,!![])):fs['rm'](_0x56f465,{'recursive':!![]},_0x3a49ae=>{_0x3a49ae?_0x3c340d(_0x56f465,![]):_0x3c340d(_0x56f465,!![]);}),_0xe55249&&_0x2ecf12(_0x185c3e);}function _0x4c4f98(_0x5b6ce9){const _0x15e1f2=_0x12b251;dbFileIndexTable[_0x15e1f2(0x22a)](_0x3673b6[_0x15e1f2(0x1bd)]['dbFileIndex'],_0x5b6ce9['id'],_0xb8e5ac);}for(let _0x8d970b in _0x474c52){let _0x1005d7=_0x474c52[_0x8d970b];if(_0x1005d7){if(dbUserTable['doUserCanGet'](_0x3673b6,_0x245010,_0x12b251(0x21e),'power_delete',_0x1005d7['path'])==!![]){let _0x5ccc93=path[_0x12b251(0xfe)](_0x1005d7[_0x12b251(0x1e1)],path['sep'],_0x1005d7['filename']);_0x4c4f98(_0x1005d7),_0x16bb31(_0x1005d7,_0x5ccc93,!![]);}}}return _0x245010[_0x12b251(0xff)]({'code':0x0});}),router[_0x3b0907(0x22d)]('/operationLibrary',(_0x27b62f,_0x5365ef,_0x57f346)=>{const _0x1c840f=_0x3b0907;let _0x1a3eac=_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x1b4)],_0x5a37e8=_0x27b62f[_0x1c840f(0x24e)]['libraryId'],_0x510a7f=_0x27b62f[_0x1c840f(0x24e)]['pathList'],_0x446aa6=_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x1f9)],_0x275e5a=_0x27b62f['body'][_0x1c840f(0x1d5)],_0x5ab0d3=_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x140)];if(_0x5ab0d3=='GET'){let _0x4b1cb7=_0x27b62f['body']['offset']||0x0,_0x11d4f3=_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x1db)]||0x32,_0x7c73a5=_0x27b62f['body'][_0x1c840f(0x1f4)]||'',_0x22a9e9=_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x21d)]||_0x1c840f(0x1ca),_0x51469f=_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x208)]||_0x1c840f(0x239);if(![_0x1c840f(0x1ca),'title'][_0x1c840f(0x162)](_0x22a9e9))return console[_0x1c840f(0x130)]('order\x20field\x20error',_0x22a9e9),[];let _0x4c3e64=[],_0x38df47=[],_0x505864=_0x1c840f(0x1e8);_0x27b62f[_0x1c840f(0x24d)]['is_admin']==0x1?_0x7c73a5&&(_0x505864+=_0x1c840f(0x1ff),_0x38df47[_0x1c840f(0x195)]('%'+_0x7c73a5+'%')):(_0x505864=_0x1c840f(0x1ce),_0x7c73a5&&(_0x505864+=_0x1c840f(0x22c),_0x38df47[_0x1c840f(0x195)]('%'+_0x7c73a5+'%')));_0x505864+='\x20ORDER\x20BY\x20'+_0x22a9e9+'\x20'+_0x51469f+_0x1c840f(0x214),_0x38df47['push'](_0x11d4f3),_0x38df47[_0x1c840f(0x195)](_0x4b1cb7),_0x4c3e64=_0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0x1be)][_0x1c840f(0x113)](_0x505864)[_0x1c840f(0x185)](_0x38df47);if(_0x4c3e64[_0x1c840f(0x232)]<0x1)return _0x5365ef[_0x1c840f(0xff)]({'code':0x0,'data':[]});for(let _0x36a18c in _0x4c3e64){let _0x130163=_0x4c3e64[_0x36a18c];try{let _0x575d1e=JSON[_0x1c840f(0x163)](_0x130163['share_uid']),_0x343612=[];for(let _0x57bce2 of _0x575d1e){let _0x5337e6=dbUserTable['findWithField'](_0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0x1da)],_0x57bce2,'id,username');_0x343612[_0x1c840f(0x195)](_0x5337e6);}_0x4c3e64[_0x36a18c]['user_list']=_0x343612;}catch(_0x3a48d5){console[_0x1c840f(0x130)](_0x3a48d5);}_0x27b62f['body'][_0x1c840f(0x1db)]=0x4,_0x27b62f[_0x1c840f(0x24e)]['excludeIds']=[],_0x27b62f['body'][_0x1c840f(0x106)]=0x0,_0x27b62f[_0x1c840f(0x24e)]['sortField']=_0x1c840f(0x123),_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x192)]=_0x1c840f(0x239),_0x27b62f[_0x1c840f(0x24e)]['timeType']=0x1,_0x27b62f[_0x1c840f(0x24e)]['timestamp']=0x9184e729fff,_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x1f6)]=0x0,_0x27b62f[_0x1c840f(0x24e)][_0x1c840f(0x1e6)]=_0x4c3e64[_0x36a18c]['id'],_0x4c3e64[_0x36a18c]['dataPreview']=photoApiUtil[_0x1c840f(0x183)](_0x27b62f,_0x5365ef);}return _0x5365ef['json']({'code':0x0,'data':_0x4c3e64});}else{if(_0x27b62f['currentUser'][_0x1c840f(0x154)]!=0x1)return _0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0xfa)](_0x5365ef,_0x5365ef['__'](_0x1c840f(0x13c)));if(_0x5ab0d3==_0x1c840f(0x16a)||_0x5ab0d3==_0x1c840f(0x128)){if(!_0x510a7f||!_0x510a7f instanceof Array||_0x510a7f['length']<0x1)return _0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0xfa)](_0x5365ef,_0x5365ef['__']('operationFail'));if(_0x275e5a){if(_0x446aa6!=null&&!_0x446aa6 instanceof Array)return _0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0xfa)](_0x5365ef,_0x5365ef['__'](_0x1c840f(0xe4)));}if(sqliteUtil['checkSqlInjection'](JSON['stringify'](_0x510a7f))==!![])return _0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0xfa)](_0x5365ef,_0x1c840f(0x1e0));}if(_0x5ab0d3==_0x1c840f(0x128)&&_0x5a37e8)_0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0x1be)][_0x1c840f(0x113)](_0x1c840f(0x1cb))['run'](_0x1a3eac,JSON[_0x1c840f(0x17f)](_0x510a7f),_0x275e5a,JSON['stringify'](_0x446aa6),_0x5a37e8);else{if(_0x5ab0d3==_0x1c840f(0x1f7)&&_0x5a37e8)_0x27b62f[_0x1c840f(0x1bd)]['dbFileIndex']['prepare'](_0x1c840f(0x14c))[_0x1c840f(0x205)](_0x5a37e8);else{if(_0x5ab0d3=='ADD')_0x27b62f['app'][_0x1c840f(0x1be)][_0x1c840f(0x113)](_0x1c840f(0x1d6))[_0x1c840f(0x205)](_0x1a3eac,JSON[_0x1c840f(0x17f)](_0x510a7f),_0x275e5a,JSON[_0x1c840f(0x17f)](_0x446aa6),_0x27b62f[_0x1c840f(0x24d)]['id']);else return _0x27b62f[_0x1c840f(0x1bd)][_0x1c840f(0xfa)](_0x5365ef,_0x5365ef['__'](_0x1c840f(0x13c)));}}return _0x5365ef['json']({'code':0x0});}}),module['exports']=router;