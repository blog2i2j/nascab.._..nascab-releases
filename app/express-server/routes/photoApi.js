function _0x2f03(){const _0x5f08ad=['shareUidList','count','status','operationFail','sendFile','\x20order\x20by\x20score\x20desc','2108392NreXKq','size','\x20AND\x20','\x27,longitude=\x27','express','create_time','\x20ORDER\x20BY\x20is_file\x20asc,\x20','rawFaceIndexIdList','doUserCanGet','getTimeLineDateList','platform','facesPath','/restoreTrashBinFiles','/getAiDealState','DELETE\x20FROM\x20photo_faces2index\x20where\x20face_id=?\x20and\x20photo_index_id\x20=?','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20face_name=?\x20and\x20belong_face_id\x20is\x20null','photo','getAllByWhere','raw_filename','atleastChooseTwoFaces','stat','getPathWhere','basename','app','excludeIds','rawFaceId','\x27,geohash5=\x27','latitude','returnErrMsg','error\x20data','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time\x20','../../db/dbConfigTable','operation\x20fail','mtime','dbFileIndex','.jpg','/searchMode','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20photo_faces2index\x20WHERE\x20compare_state=0','UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?','../utils/nasAccountUtils','toFile','\x20(((type=1\x20or\x20type=2)\x20\x20)\x20OR\x20is_file=0\x20)\x20','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20id=?','15460JbAycA','DELETE\x20FROM\x20photo_library\x20\x20WHERE\x20id=?',',ctime=','\x27,geohash4=\x27','send','/switchFaceId','/editExifByIndexId','../utils/fileUtils','folderNotExist','from','offset','pathList','./photoApiUtils','\x20WHERE\x20title\x20like\x20?','desc','asc','deleteRawTempFile','prepare','newDate','is_file','then','geohash3\x20=\x20','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27\x27\x20where\x20id=','abs','getByWhere','transSpcielFormat','/resetFaceAi','file_index_photo-indexing','1699859dpcbfY','update\x20file_index_photo\x20set\x20ai_face_detect_state=0','replace','GPSLatitude','TYPE_DELETE','.JPG','data','sharp','dialog','delete\x20from\x20photo_faces\x20where\x201=1','encode','getExcludePathWhereStr','path_list','isFile','5nxmXvA','data_value','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20phash\x20is\x20null\x20and\x20type=1','geohash','7971GYEQgf','orderType','photoIndexId','/removeFromFace','\x20id\x20in\x20(','getById','power_add','getFullYear','sep','../../myWorkers/index/photoIndexUtil','INDEX_TABLE_NAME_BOOK','ADD','\x20\x20\x20AND\x20in_trash!=1\x20','editId','resize','.MP4','getAlbumWhereStr','searchValue','SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20disabled=0\x20and\x20belong_face_id\x20is\x20null\x20and\x20face_photo_count>=?\x20order\x20by\x20face_photo_count\x20desc\x20limit\x20500','LEVEL_MAIN_OPERATION','GPSLongitudeRef','SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_class_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27','updateBySql','/deleteAlbum','get','indexFullPath','f2width','serverType','\x20is_file,id,path,filename,ext,type,width,height,duration,size,original_date,original_time,latitude,longitude\x20','fileExist','id,is_file,is_livephoto,path,filename,raw_filename,is_raw','album.sameNameExist','music','share_uid','power_get','\x20is_file=1\x20','writeFile','cachePath','checkSqlInjection','EDIT','UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=0\x20where\x20is_face_poster=1\x20and\x20face_id\x20in\x20','SELECT\x20f.*,a.id\x20as\x20f2id,a.width\x20as\x20f2width,a.height\x20as\x20f2height,a.x\x20as\x20f2x,a.y\x20as\x20f2y\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20photo_faces2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20a.photo_index_id=f.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20a.face_id\x20in\x20','isIndexing','getPhotoByParams','username','endsWith','delete','moviePlaylongPressRate','/resetSimilarPhotoAi','f2x','ctimeMs','STATE_FAIL','name','\x20AND\x20geohash4!=\x27undefined\x27\x20GROUP\x20BY\x20geohash4','../../db/dbAlbumTable','f2height','2168015onpQtt','getUserPathWhere','GPSLongitude','ordinaryAlbumId','/getPhotoFaces','\x20and\x20a.is_face_poster=1\x20limit\x201','floor','/setFacePoster','indexObj','serveType','SELECT\x20*\x20FROM\x20photo_library\x20','currentUser','libraryId','exports','type','rotate','geoInfoWriteErr','\x20and\x20title\x20like\x20?','\x20WHERE\x20id\x20=\x20','trash','UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?\x20or\x20belong_face_id=?','existsSync','filename','GPSIFD','SELECT\x20f.id\x20FROM\x20photo_faces2index\x20as\x20p\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20p.photo_index_id=f.id\x20WHERE\x20p.face_id=?\x20','../utils/sqliteUtil','face_id','power_change','defaultTranscodeResolution','original_time','aiSimilarPhotoEnable','\x20LIMIT\x20','UPDATE\x20photo_faces\x20SET\x20face_img_path=\x27','DateTimeOriginal','\x20AND\x20in_trash=0\x20\x20\x20AND\x20is_file=1\x20\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20limit\x201','/getPhotoClasses','update\x20file_index_photo\x20set\x20phash=null,phash_compare=0','getRotateFromTags','aiClassId','/clearTrashBin','UPDATE\x20','toLowerCase','post','\x20is_file=0\x20','UPDATE\x20photo_faces\x20SET\x20face_name=null\x20where\x20face_name\x20=\x20?','cocossdWaitDealCount','power_delete','excludeFilenamePhoto','\x20type=2\x20\x20','\x20in_trash=0\x20AND\x20latitude!=\x27undefined\x27\x20AND\x20longitude!=\x27undefined\x27\x20AND\x20latitude\x20is\x20not\x20null','%\x27\x20OR\x20mode\x20\x20LIKE\x20\x27%','/getSimilarPhoto','similar','movie','sortType','\x20order\x20by\x20f.original_time\x20desc\x20limit\x201','SELECT\x20*\x20FROM\x20photo_library\x20WHERE\x20share_for_subuser=1','extract','\x20AND\x20geohash5!=\x27undefined\x27\x20GROUP\x20BY\x20geohash5','disabled','jpeg','substring','face_img_path','photoSavedAsNewFile','maxLng','\x20SET\x20in_trash=0\x20WHERE\x20in_trash=1','\x20LIMIT\x20?\x20OFFSET\x20?','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','\x27,geohash2=\x27','filename_number','setFaceId','../utils/sharpUtils','INDEX_TABLE_NAME_PHOTO','minLng','stringify','photo_index_id','sourceFolderList','round','getCountByWhere','../../myConfig/config','/getFaceImg/*','delete\x20from\x20photo_phash_similar\x20where\x201=1','path','dealList','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20id\x20=\x20?','end','faceIdList','SELECT\x20f.id\x20as\x20photo_index_id\x20FROM\x20ai_classes2index\x20as\x20a\x20INNER\x20JOIN\x20file_index_photo\x20as\x20f\x20ON\x20a.photo_index_id=f.id\x20WHERE\x20a.class_id=?\x20and\x20score>?\x20and\x20\x20f.in_trash=0\x20\x20and\x20f.tiny_path\x20is\x20not\x20null\x20AND\x20f.tiny_path\x20!=\x20\x270\x27\x20\x20','2353782DwnLKR','123394mofIum','length','load','run','is_admin','push','key','\x20and\x20face_id=','create','dump','GPSLatitudeRef','\x20\x20AND\x20filename\x20LIKE\x20\x27%','.jpeg','includes','timeOrder','mode','changes','video','is_livephoto','../../db/dbSourceFolderTable','all','id,username','isAdmin','keepIndexList','shareForSubUser','moviePreferLanguage','value','INDEX_TABLE_NAME_MOVIE','parse','/getAllAlbum','\x20SET\x20in_trash=1,in_trash_time=','/getFileTreePhoto','UPDATE\x20photo_faces\x20SET\x20face_name=?\x20where\x20id\x20=\x20?','STATE_SUC','user_list','SELECT\x20id,path,filename,original_date,size\x20FROM\x20file_index_photo\x20where\x20id=','timeType','\x27,original_date=\x27','transaction','fileType','excludePathPhoto','\x20size=','error\x20pathList','getSharpInstanceFromInput','%\x27\x20','findByTitle','log','4257vuFYbu','\x27\x20where\x20id=','INDEX_TABLE_NAME_MUSIC','../../db/dbUserTable','faceName','cocossd','shell','/getBoundsPhoto','search','SELECT\x20*\x20from\x20photo_phash_similar\x20where\x20index_id=','DELETE','/updatePhotoFace','longitude','albumId','mkdir','ExifIFD','184avcQqt','join','aiClassesEnable','UPDATE\x20photo_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','文件写入成功','getTime','insert','orderField','COCO_CLASS_MIN_SCORE','getByName','order\x20field\x20error','genTinyFile','imgList','udpateName','GPS','\x20AND\x20geohash\x20LIKE\x20?\x20','similarIndexList','getFaceInSql','startSimilarPhotoWork','\x20AND\x20\x20is_file=1\x20','dirname','index_id','SELECT\x20f.id,f.path,f.filename,f.original_date,f.size\x20FROM\x20photo_phash_similar\x20as\x20a\x20inner\x20join\x20file_index_photo\x20as\x20f\x20on\x20a.similar_index_id=f.id\x20where\x20a.index_id=','dataPreview','body','\x27\x20AND\x20','UPDATE\x20photo_faces\x20SET\x20disabled=?\x20where\x20','similar_index_id','ERROR\x20GPS\x20LOCATION','timestamp','binary','/updateAlbum','.HEIC','update','Exif','title','\x20AND\x20geohash3!=\x27undefined\x27\x20GROUP\x20BY\x20geohash3','getPathByType','startFaceAiWork','searchStr','\x27,geohash=\x27','getUserPower','.MOV','geohash5\x20=\x20','faceId','dbOther','f2id','REPLACE\x20INTO\x20photo_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','%\x27)\x20','toString','zoom','f2y','getDate','aiFaceEnable','query','\x20is_file,id,path,filename,ext,duration,size\x20','GET','close','showFileType','operation','json','\x20latitude=\x27','cacheDeleteFail','存在livephoto'];_0x2f03=function(){return _0x5f08ad;};return _0x2f03();}const _0x43c3ce=_0x20c3;(function(_0x480ab6,_0x3a9eb4){const _0x1f2764=_0x20c3,_0x3ecc1a=_0x480ab6();while(!![]){try{const _0x1f48e5=-parseInt(_0x1f2764(0x222))/0x1*(-parseInt(_0x1f2764(0x148))/0x2)+parseInt(_0x1f2764(0x226))/0x3*(parseInt(_0x1f2764(0x187))/0x4)+parseInt(_0x1f2764(0x25e))/0x5+-parseInt(_0x1f2764(0x147))/0x6+parseInt(_0x1f2764(0x214))/0x7+parseInt(_0x1f2764(0x1cd))/0x8+parseInt(_0x1f2764(0x177))/0x9*(-parseInt(_0x1f2764(0x1f8))/0xa);if(_0x1f48e5===_0x3a9eb4)break;else _0x3ecc1a['push'](_0x3ecc1a['shift']());}catch(_0x575ae2){_0x3ecc1a['push'](_0x3ecc1a['shift']());}}}(_0x2f03,0x3c565));let express=require(_0x43c3ce(0x1d1)),router=express['Router'](),path=require('path');const sharp=require(_0x43c3ce(0x21b)),config=require(_0x43c3ce(0x13e)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbSourceFolderTable=require(_0x43c3ce(0x15b)),dbFileOperationRecord=require('../../db/dbFileOperationRecord');let checkUtil=require('../utils/checkUtil');const sqliteUtil=require(_0x43c3ce(0x277)),exifUtils=require('../../utils/exifUtils'),dbUserTable=require(_0x43c3ce(0x17a)),dbAlbumTable=require(_0x43c3ce(0x25c));let geohash=require('ngeohash'),fs=require('fs');const dbConfigTable=require(_0x43c3ce(0x1ec));let sharpUtil=require(_0x43c3ce(0x136)),nasAccountUtil=require(_0x43c3ce(0x1f4)),fileUtil=require(_0x43c3ce(0x1ff));function _0x20c3(_0x3f9a99,_0x2455cd){const _0x2f0358=_0x2f03();return _0x20c3=function(_0x20c38f,_0x1ddf4d){_0x20c38f=_0x20c38f-0x12f;let _0x61a2ab=_0x2f0358[_0x20c38f];return _0x61a2ab;},_0x20c3(_0x3f9a99,_0x2455cd);}const photoApiUtil=require(_0x43c3ce(0x204)),platform=require('os')[_0x43c3ce(0x1d7)](),photoIndexUtil=require(_0x43c3ce(0x22f));let piexif=require('piexifjs');router[_0x43c3ce(0x288)]('/getTimeLineDateList',(_0x1fb16d,_0x39c40b,_0xcfee08)=>{const _0xe3f993=_0x43c3ce;if(dbUserTable['doUserCanGet'](_0x1fb16d,_0x39c40b,_0xe3f993(0x1dd),_0xe3f993(0x248))==!![]){let _0x572939=_0x1fb16d[_0xe3f993(0x19f)]['year'],_0x53e3b8=_0x1fb16d[_0xe3f993(0x19f)][_0xe3f993(0x26c)],_0x254444=_0x1fb16d[_0xe3f993(0x19f)][_0xe3f993(0x225)],_0x150f33=_0x1fb16d['body'][_0xe3f993(0x184)],_0x459f8e=_0x1fb16d[_0xe3f993(0x19f)]['searchStr'],_0x5c0b08=_0x1fb16d[_0xe3f993(0x19f)][_0xe3f993(0x261)],_0x19a6de=_0x1fb16d['body'][_0xe3f993(0x284)],_0xe1760c=_0x1fb16d['body'][_0xe3f993(0x26a)],_0x3132d5=_0x1fb16d['body'][_0xe3f993(0x1b3)],_0x305b36=_0x1fb16d[_0xe3f993(0x19f)][_0xe3f993(0x156)],_0xf747c6=_0x1fb16d['body'][_0xe3f993(0x13b)],_0x1426ae=dbUserTable[_0xe3f993(0x25f)](_0x1fb16d,_0xe3f993(0x1dd),_0xe3f993(0x248),!![],_0xf747c6),_0x2f9d60=_0x1426ae,_0x1eca4b=[];_0x254444&&(_0x2f9d60+=_0xe3f993(0x196),_0x1eca4b[_0xe3f993(0x14d)](_0x254444+'%'));let _0x4da67f=dbSourceFolderTable[_0xe3f993(0x21f)](_0x1fb16d[_0xe3f993(0x1e4)][_0xe3f993(0x1b4)],'path',_0xe3f993(0x170));_0x4da67f&&(_0x2f9d60+=_0xe3f993(0x1cf)+_0x4da67f);let _0x29adf1=dbSourceFolderTable[_0xe3f993(0x21f)](_0x1fb16d[_0xe3f993(0x1e4)][_0xe3f993(0x1b4)],_0xe3f993(0x274),_0xe3f993(0x28d));_0x29adf1&&(_0x2f9d60+=_0xe3f993(0x1cf)+_0x29adf1);if(_0xe1760c){let _0x2dbe53=_0x1fb16d[_0xe3f993(0x1e4)][_0xe3f993(0x1ef)][_0xe3f993(0x209)](_0xe3f993(0x1f7))[_0xe3f993(0x23e)](_0xe1760c);if(_0x2dbe53)try{let _0x3a3269=JSON[_0xe3f993(0x164)](_0x2dbe53['path_list']),_0x3b80b0=dbUserTable[_0xe3f993(0x1e2)](!![],_0x3a3269);_0x2f9d60+=_0x3b80b0;}catch(_0x1a7496){console[_0xe3f993(0x176)](_0x1a7496);}}if(_0x150f33){let _0x10c27b=dbAlbumTable[_0xe3f993(0x236)](_0x1fb16d[_0xe3f993(0x1e4)]['dbOther'],_0x150f33);_0x10c27b&&(_0x2f9d60+=_0xe3f993(0x1cf)+_0x10c27b);}_0x459f8e&&(_0x2f9d60+='\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20mode\x20\x20LIKE\x20?)',_0x1eca4b[_0xe3f993(0x14d)]('%'+_0x459f8e+'%'),_0x1eca4b[_0xe3f993(0x14d)]('%'+_0x459f8e+'%'));_0x2f9d60+=_0xe3f993(0x232);let _0xe1752c=dbFileIndexTable[_0xe3f993(0x1d6)](_0x1fb16d[_0xe3f993(0x1e4)][_0xe3f993(0x1ef)],_0x572939,_0x53e3b8,_0x2f9d60,_0x5c0b08,_0x19a6de,_0x3132d5,_0x1eca4b,_0x305b36);_0x39c40b[_0xe3f993(0x1c3)]({'code':0x0,'data':_0xe1752c});}}),router[_0x43c3ce(0x288)]('/getPhotoByTime',(_0x19aa2e,_0x4f8003,_0x3413d5)=>{const _0x38b775=_0x43c3ce;dbUserTable['doUserCanGet'](_0x19aa2e,_0x4f8003,_0x38b775(0x1dd),_0x38b775(0x248))==!![]&&(result=photoApiUtil['getPhotoByParams'](_0x19aa2e,_0x4f8003),_0x4f8003[_0x38b775(0x1c3)]({'code':0x0,'data':result}));}),router['post']('/getAlbumPhotoForMap',(_0x4bbc51,_0x40ff2b,_0x42dbeb)=>{const _0x1522f7=_0x43c3ce;let _0x1308ab=dbUserTable[_0x1522f7(0x25f)](_0x4bbc51,_0x1522f7(0x1dd),_0x1522f7(0x248),!![]),_0x1c2a3a='\x20id,latitude,longitude,geohash,tiny_path',_0x1ec92a=_0x1522f7(0x28f),_0x315320=_0x4bbc51[_0x1522f7(0x19f)][_0x1522f7(0x26a)];if(_0x4bbc51[_0x1522f7(0x19f)][_0x1522f7(0x184)]){let _0x44c28d=dbAlbumTable[_0x1522f7(0x236)](_0x4bbc51[_0x1522f7(0x1e4)]['dbOther'],_0x4bbc51[_0x1522f7(0x19f)]['albumId']);_0x44c28d&&(_0x1ec92a+=_0x1522f7(0x1cf)+_0x44c28d);}if(_0x315320){let _0xb54dcb=_0x4bbc51[_0x1522f7(0x1e4)][_0x1522f7(0x1ef)][_0x1522f7(0x209)](_0x1522f7(0x1f7))[_0x1522f7(0x23e)](_0x315320);if(_0xb54dcb)try{let _0x137d64=JSON['parse'](_0xb54dcb[_0x1522f7(0x220)]),_0x3b7136=dbUserTable['getPathWhere'](!![],_0x137d64);_0x1ec92a+=_0x3b7136;}catch(_0x58286c){console['log'](_0x58286c);}}function _0xa07cdd(_0x1a51a8,_0x30dc6c,_0x40b1dc){const _0x3721fc=_0x1522f7;if(_0x40b1dc){let _0x53ed8d=0x0;if(_0x4bbc51[_0x3721fc(0x19f)][_0x3721fc(0x261)]){let _0x14a20a=dbFileIndexTable['getAllByWhereAndFieldFromOrdinaryAlbumCount'](_0x4bbc51[_0x3721fc(0x1e4)][_0x3721fc(0x1ef)],_0x4bbc51[_0x3721fc(0x19f)][_0x3721fc(0x261)],_0x1a51a8);_0x53ed8d=_0x14a20a[_0x3721fc(0x1c8)];}else{let _0x2d644f=dbFileIndexTable[_0x3721fc(0x13d)](_0x4bbc51['app']['dbFileIndex'],_0x1a51a8);_0x53ed8d=_0x2d644f['count'];}return _0x53ed8d;}else{let _0x166cfc=[];return _0x4bbc51[_0x3721fc(0x19f)][_0x3721fc(0x261)]?_0x166cfc=dbFileIndexTable['getAllByWhereAndFieldFromOrdinaryAlbum'](_0x4bbc51[_0x3721fc(0x1e4)]['dbFileIndex'],_0x4bbc51[_0x3721fc(0x19f)]['ordinaryAlbumId'],_0x1a51a8,_0x30dc6c):_0x166cfc=dbFileIndexTable['getAllByWhereAndField'](_0x4bbc51[_0x3721fc(0x1e4)][_0x3721fc(0x1ef)],_0x1a51a8,_0x30dc6c,dbFileIndexTable[_0x3721fc(0x137)]),_0x166cfc;}}_0x1ec92a+=_0x1308ab,_0x1ec92a+=_0x1522f7(0x19a);let _0x4e10b1=0xc8,_0x118e55=[],_0x1f48dc=_0xa07cdd(_0x1ec92a,null,!![]);if(_0x1f48dc<_0x4e10b1)_0x118e55=_0xa07cdd(_0x1ec92a,'*');else{let _0x275299=_0x1ec92a+_0x1522f7(0x298),_0x1e5d06=_0xa07cdd(_0x275299,'*');if(_0x1e5d06&&_0x1e5d06[_0x1522f7(0x149)]<_0x4e10b1)_0x118e55=_0x1e5d06;else{let _0x5522ad=_0x1ec92a+_0x1522f7(0x25b),_0x270041=_0xa07cdd(_0x5522ad,'*');if(_0x270041&&_0x270041[_0x1522f7(0x149)]<_0x4e10b1)_0x118e55=_0x270041;else{let _0x33a53a=_0x1ec92a+_0x1522f7(0x1ab),_0x1b31d1=_0xa07cdd(_0x33a53a,'*');if(_0x1b31d1&&_0x1b31d1[_0x1522f7(0x149)]<_0x4e10b1)_0x118e55=_0x1b31d1;else{let _0x130f0c=_0x1ec92a+'\x20AND\x20geohash2!=\x27undefined\x27\x20GROUP\x20BY\x20geohash2';_0x118e55=_0xa07cdd(_0x130f0c,'*');}}}}return _0x40ff2b[_0x1522f7(0x1c3)]({'code':0x0,'mapPhoto':_0x118e55});}),router[_0x43c3ce(0x288)](_0x43c3ce(0x17e),(_0x2fdf0b,_0x4998f1,_0x174e9b)=>{const _0x529465=_0x43c3ce;if(dbUserTable['doUserCanGet'](_0x2fdf0b,_0x4998f1,_0x529465(0x1dd),_0x529465(0x248))==!![]){let _0x26f7af=dbUserTable[_0x529465(0x25f)](_0x2fdf0b,_0x529465(0x1dd),_0x529465(0x248),!![]),_0x3fb192=_0x2fdf0b[_0x529465(0x19f)]['minLat'],_0xfae1e8=_0x2fdf0b['body'][_0x529465(0x138)],_0x25ae32=_0x2fdf0b[_0x529465(0x19f)]['maxLat'],_0xafbdcf=_0x2fdf0b[_0x529465(0x19f)][_0x529465(0x12f)],_0x10ec73=_0x2fdf0b[_0x529465(0x19f)][_0x529465(0x1b9)],_0x1e66ad='',_0x73b6c6=0x2;if(_0x10ec73<=0x4)_0x73b6c6=0x2,_0x1e66ad='geohash2\x20=\x20';else{if(_0x10ec73<=0x6)_0x73b6c6=0x3,_0x1e66ad=_0x529465(0x20d);else{if(_0x10ec73<=0x8)_0x73b6c6=0x4,_0x1e66ad='geohash4\x20=\x20';else _0x10ec73<=0xc&&(_0x73b6c6=0x5,_0x1e66ad=_0x529465(0x1b2));}}let _0x2e5146=geohash['bboxes'](_0x3fb192,_0xfae1e8,_0x25ae32,_0xafbdcf,_0x73b6c6),_0x54ed11=[];for(let _0x701ab7=0x0;_0x701ab7<_0x2e5146[_0x529465(0x149)];_0x701ab7++){let _0x2b3f3c=_0x2e5146[_0x701ab7],_0x522477='\x20'+_0x1e66ad+'\x20\x27'+_0x2b3f3c+'\x27\x20'+_0x26f7af+_0x529465(0x280),_0x13d893=dbFileIndexTable[_0x529465(0x210)](_0x2fdf0b[_0x529465(0x1e4)][_0x529465(0x1ef)],_0x522477,'\x20id,geohash,latitude,longitude\x20');_0x13d893&&_0x54ed11['push'](_0x13d893);}_0x4998f1['json']({'code':0x0,'mapPhoto':_0x54ed11});}}),router['post']('/addAlbum',(_0x397841,_0x19654c,_0x4695d2)=>{const _0x2f7247=_0x43c3ce;if(dbUserTable[_0x2f7247(0x1d5)](_0x397841,_0x19654c,'photo',_0x2f7247(0x22c))==!![]){let _0x130550=_0x397841[_0x2f7247(0x19f)][_0x2f7247(0x26c)],_0x45b770=_0x397841[_0x2f7247(0x19f)]['data'],_0x354222=_0x397841['body'][_0x2f7247(0x223)],_0x3d0418=_0x397841[_0x2f7247(0x19f)][_0x2f7247(0x25a)],_0x8c29a=_0x397841[_0x2f7247(0x19f)][_0x2f7247(0x233)];if(!_0x45b770||!_0x45b770[_0x2f7247(0x237)]||sqliteUtil[_0x2f7247(0x24c)](_0x45b770[_0x2f7247(0x237)])==!![])return _0x397841[_0x2f7247(0x1e4)][_0x2f7247(0x1e9)](_0x19654c,_0x2f7247(0x1ea));if(!_0x8c29a){let _0x525aab=dbAlbumTable['getByName'](_0x397841['app'][_0x2f7247(0x1b4)],_0x3d0418);if(_0x525aab)return _0x397841['app']['returnErrMsg'](_0x19654c,_0x19654c['__'](_0x2f7247(0x245)));}let _0x4b658e=null;_0x8c29a?_0x4b658e=dbAlbumTable[_0x2f7247(0x1a8)](_0x397841['app'][_0x2f7247(0x1b4)],{'type':_0x130550,'data':_0x45b770,'data_value':_0x354222,'name':_0x3d0418},_0x8c29a):_0x4b658e=dbAlbumTable[_0x2f7247(0x150)](_0x397841[_0x2f7247(0x1e4)][_0x2f7247(0x1b4)],{'type':_0x130550,'data':_0x45b770,'data_value':_0x354222,'name':_0x3d0418}),_0x19654c[_0x2f7247(0x1c3)]({'code':0x0,'result':_0x4b658e});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x23d),(_0x805b36,_0x6a0c0b,_0x306b25)=>{const _0x41db0f=_0x43c3ce;if(dbUserTable[_0x41db0f(0x1d5)](_0x805b36,_0x6a0c0b,'photo','power_delete')==!![]){let _0xb8bc36=_0x805b36[_0x41db0f(0x19f)]['id'],_0x25eabc=dbAlbumTable[_0x41db0f(0x254)](_0x805b36[_0x41db0f(0x1e4)][_0x41db0f(0x1b4)],_0xb8bc36);_0x25eabc[_0x41db0f(0x158)]>0x0?_0x6a0c0b[_0x41db0f(0x1c3)]({'code':0x0,'result':_0x25eabc}):_0x6a0c0b[_0x41db0f(0x1c3)]({'code':0x1,'message':_0x41db0f(0x1ed)});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x1a6),(_0xc0e50d,_0x223a50,_0x2f6f50)=>{const _0x1da666=_0x43c3ce;if(dbUserTable[_0x1da666(0x1d5)](_0xc0e50d,_0x223a50,_0x1da666(0x1dd),_0x1da666(0x279))==!![]){let _0x35f71b=_0xc0e50d[_0x1da666(0x19f)]['id'],_0x2492da=_0xc0e50d['body'][_0x1da666(0x25a)],_0x208038=dbAlbumTable[_0x1da666(0x190)](_0xc0e50d[_0x1da666(0x1e4)][_0x1da666(0x1b4)],_0x2492da);if(_0x208038)return _0xc0e50d['app'][_0x1da666(0x1e9)](_0x223a50,_0x223a50['__'](_0x1da666(0x245)));let _0x454d7b=dbAlbumTable[_0x1da666(0x194)](_0xc0e50d[_0x1da666(0x1e4)]['dbOther'],_0x35f71b,_0x2492da);_0x454d7b[_0x1da666(0x158)]>0x0?_0x223a50[_0x1da666(0x1c3)]({'code':0x0,'result':_0x454d7b}):_0x223a50[_0x1da666(0x1c3)]({'code':0x1,'message':_0x1da666(0x1ed)});}}),router['post'](_0x43c3ce(0x165),(_0x3ce527,_0x53e44b,_0x182edc)=>{const _0x468ff1=_0x43c3ce;if(dbUserTable[_0x468ff1(0x1d5)](_0x3ce527,_0x53e44b,'photo','power_get')==!![]){let _0x140cd4=dbUserTable['getUserPathWhere'](_0x3ce527,_0x468ff1(0x1dd),'power_get',!![]),_0x1a62c4=_0x3ce527[_0x468ff1(0x19f)][_0x468ff1(0x1c8)]||0x32,_0x41ca09=_0x3ce527['body'][_0x468ff1(0x202)]||0x0,_0x1cc0d5=_0x3ce527[_0x468ff1(0x19f)][_0x468ff1(0x18e)]||'id',_0x31e177=_0x3ce527[_0x468ff1(0x19f)]['orderType']||_0x468ff1(0x206),_0x6b18eb=_0x3ce527[_0x468ff1(0x19f)][_0x468ff1(0x17f)];(![_0x468ff1(0x25a),'id'][_0x468ff1(0x155)](_0x1cc0d5)||!['asc',_0x468ff1(0x206)][_0x468ff1(0x155)](_0x31e177))&&_0x53e44b['json']({'code':0x0,'data':[]});let _0x5de31a=dbAlbumTable['getList'](_0x3ce527[_0x468ff1(0x1e4)]['dbOther'],_0x1a62c4,_0x41ca09,_0x1cc0d5,_0x31e177,_0x6b18eb);for(let _0x5cf29d=0x0;_0x5cf29d<_0x5de31a['length'];_0x5cf29d++){let _0x144091=_0x468ff1(0x249);_0x144091+=_0x140cd4;let _0x1448a9=dbAlbumTable[_0x468ff1(0x236)](_0x3ce527[_0x468ff1(0x1e4)][_0x468ff1(0x1b4)],_0x5de31a[_0x5cf29d]['id']);_0x1448a9&&(_0x144091+='\x20AND\x20'+_0x1448a9);_0x144091+=_0x468ff1(0x132),_0x144091+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';try{let _0x4067d6=dbFileIndexTable[_0x468ff1(0x1de)](_0x3ce527[_0x468ff1(0x1e4)][_0x468ff1(0x1ef)],_0x144091);_0x5de31a[_0x5cf29d][_0x468ff1(0x193)]=_0x4067d6;}catch(_0x352bf7){console[_0x468ff1(0x176)](_0x352bf7),_0x5de31a[_0x5cf29d]['imgList']=[];}}_0x53e44b['json']({'code':0x0,'data':_0x5de31a});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x1f1),(_0x5148c2,_0x557104,_0x1ad987)=>{const _0x147fe0=_0x43c3ce;let _0x246d3a=_0x5148c2['body'][_0x147fe0(0x14e)],_0x4febd3=dbFileIndexTable['searchMode'](_0x5148c2[_0x147fe0(0x1e4)][_0x147fe0(0x1ef)],_0x246d3a),_0x8cf4ff=[];for(let _0x1e9265=0x0;_0x1e9265<_0x4febd3[_0x147fe0(0x149)];_0x1e9265++){_0x8cf4ff['push'](_0x4febd3[_0x1e9265][_0x147fe0(0x157)]);}_0x557104['json']({'code':0x0,'data':_0x8cf4ff});}),router[_0x43c3ce(0x288)](_0x43c3ce(0x167),(_0x57a728,_0x1be9f8,_0x25ba83)=>{const _0x14159e=_0x43c3ce;let _0x566a72=_0x57a728[_0x14159e(0x19f)]['parent'],_0x510e4f=_0x57a728['body'][_0x14159e(0x267)],_0x17baa7=_0x57a728[_0x14159e(0x19f)][_0x14159e(0x1c8)],_0x48fc8b=_0x57a728['body']['offset']||0x0;_0x48fc8b=parseInt(_0x48fc8b);let _0x2d1c72=parseInt(_0x57a728[_0x14159e(0x19f)][_0x14159e(0x1c1)]),_0x839f34=_0x57a728[_0x14159e(0x19f)][_0x14159e(0x1ae)],_0x1056dd=['filename',_0x14159e(0x27b),_0x14159e(0x1ce),_0x14159e(0x1d2),_0x14159e(0x134)],_0x3eb6a8=[_0x14159e(0x207),_0x14159e(0x206)],_0x580c6d=_0x57a728['body'][_0x14159e(0x18e)]||'id',_0x52433e=_0x57a728[_0x14159e(0x19f)][_0x14159e(0x227)]||_0x14159e(0x206);!_0x1056dd[_0x14159e(0x155)](_0x580c6d)&&(_0x580c6d='id');!_0x3eb6a8[_0x14159e(0x155)](_0x52433e)&&(_0x580c6d=_0x14159e(0x206));if(dbUserTable[_0x14159e(0x1d5)](_0x57a728,_0x1be9f8,_0x510e4f,_0x14159e(0x248))==!![]){let _0xaa1ef4=[];if(!_0x566a72){let _0xd432ef=[];_0x57a728[_0x14159e(0x269)][_0x14159e(0x14c)]==0x1?_0xd432ef=dbSourceFolderTable[_0x14159e(0x1ac)](_0x57a728[_0x14159e(0x1e4)][_0x14159e(0x1b4)],_0x510e4f):_0xd432ef=dbUserTable[_0x14159e(0x1b0)](_0x57a728['app'][_0x14159e(0x1b4)],_0x57a728[_0x14159e(0x269)][_0x14159e(0x252)],_0x510e4f);if(_0xd432ef)for(let _0x4abb57=0x0;_0x4abb57<_0xd432ef['length'];_0x4abb57++){_0xaa1ef4[_0x14159e(0x14d)]({'path':_0xd432ef[_0x4abb57][_0x14159e(0x141)],'is_file':0x0,'filename':path[_0x14159e(0x1e3)](_0xd432ef[_0x4abb57][_0x14159e(0x141)]),'root':!![]});}}else{if(_0x57a728[_0x14159e(0x269)][_0x14159e(0x14c)]!=0x1){if(dbUserTable['doUserCanGet'](_0x57a728,_0x1be9f8,_0x510e4f,_0x14159e(0x248),_0x566a72)!==!![])return;}_0x566a72=path[_0x14159e(0x188)](_0x566a72),_0x566a72=_0x566a72[_0x14159e(0x216)](/\'/g,'\x27\x27');let _0x462a8a='\x20path=\x27'+_0x566a72+_0x14159e(0x1a0);if(_0x2d1c72==0x0)_0x462a8a+=_0x14159e(0x1f6);else{if(_0x2d1c72==0x1)_0x462a8a+='\x20type=1\x20';else{if(_0x2d1c72==0x2)_0x462a8a+=_0x14159e(0x28e);else _0x2d1c72==0x3&&(_0x462a8a+=_0x14159e(0x289));}}if(_0x839f34){let _0x369fd0='\x20\x20AND\x20(filename\x20LIKE\x20\x27%'+_0x839f34+_0x14159e(0x290)+_0x839f34+_0x14159e(0x1b7);_0x510e4f=='movie'&&(_0x369fd0=_0x14159e(0x153)+_0x839f34+_0x14159e(0x174)),_0x462a8a+=_0x369fd0;}let _0x5a06ee=_0x14159e(0x242),_0x12986d=dbFileIndexTable['getIndexTableNameByType'](_0x510e4f);if(_0x510e4f==_0x14159e(0x293))_0x5a06ee=_0x14159e(0x1eb);else _0x510e4f==_0x14159e(0x246)&&(_0x5a06ee=_0x14159e(0x1be));_0x462a8a+=_0x14159e(0x1d3)+_0x580c6d+'\x20'+_0x52433e+_0x14159e(0x27d)+_0x17baa7+'\x20OFFSET\x20'+_0x48fc8b,_0xaa1ef4=dbFileIndexTable[_0x14159e(0x1de)](_0x57a728[_0x14159e(0x1e4)]['dbFileIndex'],_0x462a8a,_0x5a06ee,_0x12986d);}let _0x32d988=path[_0x14159e(0x22e)],_0x2631c2={'platform':platform,'code':0x0,'data':_0xaa1ef4,'sep':_0x32d988};return _0x1be9f8[_0x14159e(0x1c3)](_0x2631c2);}}),router[_0x43c3ce(0x288)]('/getIndexDetail',(_0x2a1256,_0x33a570,_0x42dfa3)=>{const _0x175701=_0x43c3ce;let _0x26dab0=_0x2a1256[_0x175701(0x19f)]['id'],_0x4f713c=_0x2a1256['body'][_0x175701(0x241)],_0x5b7d5b=dbFileIndexTable[_0x175701(0x137)];if(_0x4f713c==_0x175701(0x293))_0x5b7d5b=dbFileIndexTable[_0x175701(0x163)];else{if(_0x4f713c=='music')_0x5b7d5b=dbFileIndexTable[_0x175701(0x179)];else _0x4f713c=='book'&&(_0x5b7d5b=dbFileIndexTable[_0x175701(0x230)]);}let _0x2f5ab8=dbFileIndexTable[_0x175701(0x22b)](_0x2a1256[_0x175701(0x1e4)]['dbFileIndex'],_0x26dab0,_0x5b7d5b);if(!_0x2f5ab8)return _0x33a570[_0x175701(0x1c9)](0x194)[_0x175701(0x144)]();if(dbUserTable[_0x175701(0x1d5)](_0x2a1256,_0x33a570,'',_0x175701(0x248),_0x2f5ab8[_0x175701(0x141)])==!![]){let _0x551439={'code':0x0,'data':_0x2f5ab8};if(_0x4f713c==_0x175701(0x293)){let _0x3118d4=dbConfigTable['findByTitle'](_0x2a1256['app'][_0x175701(0x1b4)],_0x175701(0x161));_0x551439[_0x175701(0x161)]=_0x3118d4?_0x3118d4[_0x175701(0x162)]:'chi',_0x551439[_0x175701(0x21a)][_0x175701(0x161)]=_0x551439['moviePreferLanguage'];let _0x171859=dbConfigTable['findByTitle'](_0x2a1256['app'][_0x175701(0x1b4)],_0x175701(0x255));_0x551439[_0x175701(0x255)]=_0x171859?_0x171859[_0x175701(0x162)]:'2',_0x551439[_0x175701(0x21a)][_0x175701(0x255)]=_0x551439[_0x175701(0x255)];let _0x2d7cfa=dbConfigTable[_0x175701(0x175)](_0x2a1256[_0x175701(0x1e4)]['dbOther'],_0x175701(0x27a));_0x551439[_0x175701(0x27a)]=_0x2d7cfa?_0x2d7cfa[_0x175701(0x162)]:'3';let _0x250874=path[_0x175701(0x188)](_0x2f5ab8['path'],_0x2f5ab8['filename']);fs[_0x175701(0x1e1)](_0x250874,(_0x297cd6,_0x528a6c)=>{const _0x899794=_0x175701;return _0x297cd6?(_0x551439['fileExist']=0x0,_0x551439[_0x899794(0x23f)]=_0x250874):(_0x551439[_0x899794(0x243)]=0x1,_0x551439[_0x899794(0x23f)]=_0x250874),_0x33a570['json'](_0x551439);});}else return _0x33a570[_0x175701(0x1c3)](_0x551439);}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x1fe),(_0x332a0a,_0x227aab,_0xb46819)=>{const _0x2fbdb9=_0x43c3ce;if(dbUserTable[_0x2fbdb9(0x1d5)](_0x332a0a,_0x227aab,_0x2fbdb9(0x1dd),_0x2fbdb9(0x279))==!![]){let _0x2e3b65=_0x332a0a['body']['id'],_0x112542=_0x332a0a['body'][_0x2fbdb9(0x1e8)],_0xd6a53e=_0x332a0a[_0x2fbdb9(0x19f)][_0x2fbdb9(0x183)],_0x5d8154=_0x332a0a[_0x2fbdb9(0x19f)][_0x2fbdb9(0x20a)],_0x98a77e=dbFileIndexTable[_0x2fbdb9(0x22b)](_0x332a0a[_0x2fbdb9(0x1e4)]['dbFileIndex'],_0x2e3b65);if(!_0x98a77e)return _0x332a0a[_0x2fbdb9(0x1e4)][_0x2fbdb9(0x1e9)](_0x227aab,_0x227aab['__'](_0x2fbdb9(0x29d)));let _0x1c9619=path[_0x2fbdb9(0x188)](_0x98a77e['path'],path['sep'],_0x98a77e[_0x2fbdb9(0x274)]),_0x4ec7a0=path['extname'](_0x1c9619)?path['extname'](_0x1c9619)[_0x2fbdb9(0x287)]():'';if(_0x4ec7a0!=_0x2fbdb9(0x1f0)&&_0x4ec7a0!=_0x2fbdb9(0x154))return _0x332a0a[_0x2fbdb9(0x1e4)][_0x2fbdb9(0x1e9)](_0x227aab,'Image\x20format\x20not\x20support');fs['stat'](_0x1c9619,(_0x134cde,_0x4cc296)=>{const _0xab9f2=_0x2fbdb9;if(_0x134cde||!_0x4cc296[_0xab9f2(0x221)]())return _0x332a0a[_0xab9f2(0x1e4)][_0xab9f2(0x1e9)](_0x227aab,_0x227aab['__'](_0xab9f2(0x200)));if(_0x134cde||!_0x4cc296['isFile']())return _0x332a0a['app'][_0xab9f2(0x1e9)](_0x227aab,_0x227aab['__']('folderNotExist'));fs['readFile'](_0x1c9619,(_0x49512a,_0x1efeb7)=>{const _0x283884=_0xab9f2;if(_0x49512a)return _0x332a0a[_0x283884(0x1e4)][_0x283884(0x1e9)](_0x227aab,_0x227aab['__'](_0x283884(0x1ca)));var _0x33249d=piexif[_0x283884(0x14a)](_0x1efeb7[_0x283884(0x1b8)](_0x283884(0x1a5)));if(_0x112542&&_0xd6a53e){function _0x3dc3cb(_0x5e27ab){const _0x576702=_0x283884;try{_0x5e27ab=Number(_0x5e27ab);let _0x4e2218=Math[_0x576702(0x264)](Math[_0x576702(0x20f)](_0x5e27ab)),_0x4b2f61=(Math[_0x576702(0x20f)](_0x5e27ab)-_0x4e2218)*0x3c,_0x20057b=Math['floor'](_0x4b2f61),_0x186f7c=Math[_0x576702(0x13c)]((_0x4b2f61-_0x20057b)*0x3c*0x64);return[[_0x4e2218,0x1],[_0x20057b,0x1],[_0x186f7c,0x64]];}catch(_0x41de08){return'';}}let _0x104661=_0x3dc3cb(_0x112542),_0x4eec49=_0x3dc3cb(_0xd6a53e);if(!_0x4eec49||!_0x104661)return _0x332a0a['app'][_0x283884(0x1e9)](_0x227aab,_0x283884(0x1a3));_0x33249d[_0x283884(0x195)][piexif[_0x283884(0x275)][_0x283884(0x152)]]=_0x112542>=0x0?'N':'S',_0x33249d['GPS'][piexif[_0x283884(0x275)][_0x283884(0x217)]]=_0x104661,(_0x33249d[_0x283884(0x195)][piexif[_0x283884(0x275)][_0x283884(0x23a)]]=_0xd6a53e>=0x0?'E':'W',_0x33249d['GPS'][piexif[_0x283884(0x275)][_0x283884(0x260)]]=_0x4eec49);let _0x4c1923=geohash[_0x283884(0x21e)](_0x112542,_0xd6a53e,0x8),_0x41d4be=_0x4c1923[_0x283884(0x29b)](0x0,0x5),_0x4fa52a=_0x4c1923[_0x283884(0x29b)](0x0,0x4),_0x37f00a=_0x4c1923['substring'](0x0,0x3),_0x964578=_0x4c1923[_0x283884(0x29b)](0x0,0x2);dbFileIndexTable[_0x283884(0x23c)](_0x332a0a['app']['dbFileIndex'],_0x98a77e['id'],_0x283884(0x1c4)+_0x112542+_0x283884(0x1d0)+_0xd6a53e+_0x283884(0x1af)+_0x4c1923+_0x283884(0x1e7)+_0x41d4be+_0x283884(0x1fb)+_0x4fa52a+'\x27,geohash3=\x27'+_0x37f00a+_0x283884(0x133)+_0x964578+'\x27\x20');}if(_0x5d8154){_0x33249d[_0x283884(0x1a9)][piexif[_0x283884(0x186)][_0x283884(0x27f)]]=_0x5d8154,_0x33249d[_0x283884(0x195)][piexif[_0x283884(0x275)]['GPSDateStamp']]=_0x5d8154;let _0x41f0c2=new Date(_0x5d8154),_0x52450b=_0x41f0c2[_0x283884(0x18c)](),_0x4fc561=_0x41f0c2[_0x283884(0x22d)](),_0x488a8b=_0x41f0c2['getMonth']()+0x1;_0x488a8b=_0x488a8b>=0xa?_0x488a8b:'0'+_0x488a8b;let _0xfcba85=_0x41f0c2[_0x283884(0x1bb)]();_0xfcba85=_0xfcba85>=0xa?_0xfcba85:'0'+_0xfcba85;let _0x45b5be=_0x4fc561+'-'+_0x488a8b+'-'+_0xfcba85;dbFileIndexTable[_0x283884(0x23c)](_0x332a0a['app'][_0x283884(0x1ef)],_0x98a77e['id'],'\x20original_time=\x27'+_0x52450b+_0x283884(0x16d)+_0x45b5be+'\x27\x20');}try{var _0x14493b=piexif[_0x283884(0x151)](_0x33249d),_0x3d258a=piexif[_0x283884(0x18d)](_0x14493b,_0x1efeb7[_0x283884(0x1b8)](_0x283884(0x1a5)));let _0x565a30=path[_0x283884(0x188)](_0x98a77e['path'],_0x98a77e[_0x283884(0x274)]);fs[_0x283884(0x24a)](_0x565a30,Buffer[_0x283884(0x201)](_0x3d258a,'binary'),{},_0x3b4d25=>{const _0x4cf782=_0x283884;if(_0x3b4d25)return console['log'](_0x3b4d25),_0x332a0a[_0x4cf782(0x1e4)][_0x4cf782(0x1e9)](_0x227aab,_0x227aab['__'](_0x4cf782(0x1ca)));console[_0x4cf782(0x176)](_0x4cf782(0x18b)),fs['utimes'](_0x565a30,new Date(_0x98a77e['mtime']),new Date(_0x98a77e[_0x4cf782(0x1ee)]),_0x46fb6c=>{const _0x578819=_0x4cf782;_0x46fb6c&&console['log'](_0x46fb6c),fs[_0x578819(0x1e1)](_0x565a30,(_0x3ba662,_0x54265a)=>{const _0x46a0a1=_0x578819;if(_0x3ba662)return _0x332a0a[_0x46a0a1(0x1e4)][_0x46a0a1(0x1e9)](_0x227aab,_0x227aab['__']('operationFail'));return dbFileIndexTable['updateBySql'](_0x332a0a[_0x46a0a1(0x1e4)]['dbFileIndex'],_0x98a77e['id'],_0x46a0a1(0x171)+_0x54265a[_0x46a0a1(0x1ce)]+_0x46a0a1(0x1fa)+_0x54265a[_0x46a0a1(0x258)]+'\x20'),_0x227aab[_0x46a0a1(0x1c3)]({'code':0x0,'newIndex':dbFileIndexTable[_0x46a0a1(0x22b)](_0x332a0a[_0x46a0a1(0x1e4)]['dbFileIndex'],_0x98a77e['id'])});});});});}catch(_0x543c0e){return console[_0x283884(0x176)](_0x543c0e),_0x332a0a[_0x283884(0x1e4)]['returnErrMsg'](_0x227aab,_0x227aab['__'](_0x283884(0x26e)));}});});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x281),(_0x1dbe27,_0x2e6c86,_0x5a243c)=>{const _0x373703=_0x43c3ce;if(dbUserTable[_0x373703(0x1d5)](_0x1dbe27,_0x2e6c86,_0x373703(0x1dd),_0x373703(0x248))==!![]){let _0x469af0=dbConfigTable[_0x373703(0x175)](_0x1dbe27[_0x373703(0x1e4)][_0x373703(0x1b4)],_0x373703(0x189));if(!_0x469af0||_0x469af0[_0x373703(0x162)]!='1')return _0x2e6c86['json']({'code':0x0,'data':[],'enable':![]});let _0x27d5f3='(\x27mouse\x27,\x27person\x27,\x27traffic\x20light\x27,\x27stop\x20sign\x27,\x27parking\x20meter\x27,\x27fire\x20hydrant\x27)',_0x43cfc4=dbUserTable['getUserPathWhere'](_0x1dbe27,_0x373703(0x1dd),_0x373703(0x248),!![]),_0x122467=_0x1dbe27[_0x373703(0x1e4)][_0x373703(0x1ef)]['prepare']('SELECT\x20*\x20FROM\x20ai_classes\x20where\x20\x20class_name\x20not\x20in\x20'+_0x27d5f3)[_0x373703(0x15c)](),_0xbb1954=[];for(let _0x3abf6b in _0x122467){let _0x6bcbfb=_0x122467[_0x3abf6b],_0x52ae54=_0x1dbe27['app']['dbFileIndex'][_0x373703(0x209)](_0x373703(0x146)+_0x43cfc4+_0x373703(0x1cc))[_0x373703(0x23e)](_0x6bcbfb['id'],dbFileIndexTable[_0x373703(0x18f)]);if(_0x52ae54)_0x122467[_0x3abf6b][_0x373703(0x13a)]=_0x52ae54[_0x373703(0x13a)],_0x122467[_0x3abf6b]['class_id']=_0x122467[_0x3abf6b]['id'],_0xbb1954['push'](_0x122467[_0x3abf6b]);else continue;}_0x2e6c86[_0x373703(0x1c3)]({'code':0x0,'data':_0xbb1954,'enable':!![]});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x262),(_0xa82435,_0x3608f3,_0x52f01f)=>{const _0x1281b4=_0x43c3ce;if(dbUserTable[_0x1281b4(0x1d5)](_0xa82435,_0x3608f3,_0x1281b4(0x1dd),'power_get')==!![]){let _0x513d1f=dbConfigTable[_0x1281b4(0x175)](_0xa82435[_0x1281b4(0x1e4)][_0x1281b4(0x1b4)],_0x1281b4(0x1bc));if(!_0x513d1f||_0x513d1f[_0x1281b4(0x162)]!='1')return _0x3608f3[_0x1281b4(0x1c3)]({'code':0x0,'data':[],'enable':![]});let _0x22dfe4=0x5,_0x5ed6c4=dbConfigTable[_0x1281b4(0x175)](_0xa82435['app'][_0x1281b4(0x1b4)],'aiFaceMinPhotoCount');_0x5ed6c4&&_0x5ed6c4[_0x1281b4(0x162)]&&(_0x5ed6c4[_0x1281b4(0x162)]>0x0&&(_0x22dfe4=_0x5ed6c4[_0x1281b4(0x162)]));let _0x314851=_0xa82435['app']['dbFileIndex'][_0x1281b4(0x209)](_0x1281b4(0x238))['all'](parseInt(_0x22dfe4)),_0x11d03b=[];if(_0xa82435['currentUser'][_0x1281b4(0x14c)]==0x1)_0x11d03b=_0x314851;else{let _0xef2d9b=dbUserTable['getUserPathWhere'](_0xa82435,'photo',_0x1281b4(0x248),!![]);for(let _0x319ac9 of _0x314851){try{let _0x2e4b1a=_0xa82435['app'][_0x1281b4(0x1ef)][_0x1281b4(0x209)](_0x1281b4(0x276)+_0xef2d9b+'\x20LIMIT\x201')['get'](_0x319ac9['id']);_0x2e4b1a&&_0x11d03b['push'](_0x319ac9);}catch(_0x31664b){console['log'](_0x31664b),_0x11d03b[_0x1281b4(0x14d)](_0x319ac9);}}}_0x3608f3[_0x1281b4(0x1c3)]({'code':0x0,'data':_0x11d03b,'enable':!![]});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x265),(_0x3b96a6,_0x105403,_0x4efcb9)=>{const _0x3da710=_0x43c3ce;let _0x5e5c8a=_0x3b96a6['body'][_0x3da710(0x135)],_0x508d71=_0x3b96a6['body'][_0x3da710(0x1e6)],_0x2fe297=_0x3b96a6[_0x3da710(0x19f)][_0x3da710(0x228)];if(dbUserTable[_0x3da710(0x1d5)](_0x3b96a6,_0x105403,_0x3da710(0x1dd),'power_change')==!![]){let _0x5e6d0c=dbFileIndexTable[_0x3da710(0x198)](_0x3b96a6['app'][_0x3da710(0x1ef)],_0x5e5c8a);_0x3b96a6['app'][_0x3da710(0x1ef)]['prepare'](_0x3da710(0x24e)+_0x5e6d0c)['run'](),_0x3b96a6[_0x3da710(0x1e4)][_0x3da710(0x1ef)][_0x3da710(0x209)]('UPDATE\x20photo_faces2index\x20SET\x20is_face_poster=1\x20where\x20photo_index_id\x20=\x20'+_0x2fe297+_0x3da710(0x14f)+_0x508d71)['run'](),_0x3b96a6['app']['dbFileIndex'][_0x3da710(0x209)](_0x3da710(0x20e)+_0x5e5c8a)['run'](),_0x105403[_0x3da710(0x1c3)]({'code':0x0});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x229),(_0x26c461,_0x5c3665,_0x423dc4)=>{const _0xba77da=_0x43c3ce;let _0x2ef240=_0x26c461['body']['deleteList'];try{_0x2ef240=JSON['parse'](_0x2ef240);}catch(_0x23417d){console[_0xba77da(0x176)](_0x23417d);}if(dbUserTable['doUserCanGet'](_0x26c461,_0x5c3665,'photo','power_change')==!![]){for(let _0x2310d7 of _0x2ef240){_0x26c461['app']['dbFileIndex'][_0xba77da(0x209)](_0xba77da(0x1db))[_0xba77da(0x14b)](parseInt(_0x2310d7[_0xba77da(0x1b3)]),parseInt(_0x2310d7['indexId']));}_0x5c3665[_0xba77da(0x1c3)]({'code':0x0});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x182),(_0x119f9e,_0x424ebe,_0x2560cc)=>{const _0x1d8742=_0x43c3ce;if(dbUserTable['doUserCanGet'](_0x119f9e,_0x424ebe,_0x1d8742(0x1dd),'power_change')==!![]){let _0x2c1d2c=_0x119f9e[_0x1d8742(0x19f)][_0x1d8742(0x17b)],_0x18c946=_0x119f9e['body'][_0x1d8742(0x299)],_0x23a221=_0x119f9e[_0x1d8742(0x19f)][_0x1d8742(0x1b3)],_0x577b3a=_0x119f9e[_0x1d8742(0x19f)][_0x1d8742(0x145)];if(_0x2c1d2c){_0x2c1d2c=_0x2c1d2c['trim']();let _0x3f4ab9=_0x119f9e['app'][_0x1d8742(0x1ef)][_0x1d8742(0x209)](_0x1d8742(0x1dc))[_0x1d8742(0x23e)](_0x2c1d2c);_0x3f4ab9&&_0x3f4ab9['id']!=_0x23a221?_0x119f9e[_0x1d8742(0x1e4)]['dbFileIndex'][_0x1d8742(0x209)]('UPDATE\x20photo_faces\x20SET\x20belong_face_id=?\x20where\x20id\x20=\x20?')['run'](_0x3f4ab9['id'],_0x23a221):(_0x119f9e[_0x1d8742(0x1e4)][_0x1d8742(0x1ef)][_0x1d8742(0x209)](_0x1d8742(0x28a))['run'](_0x2c1d2c),_0x119f9e[_0x1d8742(0x1e4)][_0x1d8742(0x1ef)][_0x1d8742(0x209)](_0x1d8742(0x168))[_0x1d8742(0x14b)](_0x2c1d2c,_0x23a221));}if(parseInt(_0x18c946)==0x0||parseInt(_0x18c946)==0x1){if(_0x577b3a){let _0x4ff3d8=_0x1d8742(0x22a);for(let _0x2e9052 in _0x577b3a){_0x4ff3d8+=_0x577b3a[_0x2e9052],_0x2e9052!=_0x577b3a[_0x1d8742(0x149)]-0x1&&(_0x4ff3d8+=',');}_0x4ff3d8+=')';let _0x168bc8=_0x1d8742(0x1a1)+_0x4ff3d8;_0x119f9e['app'][_0x1d8742(0x1ef)][_0x1d8742(0x209)](_0x168bc8)[_0x1d8742(0x14b)](_0x18c946);}else _0x119f9e['app'][_0x1d8742(0x1ef)][_0x1d8742(0x209)](_0x1d8742(0x143))['run'](_0x18c946,_0x23a221);}return _0x424ebe[_0x1d8742(0x1c3)]({'code':0x0});}}),router['post']('/mergeFace',(_0x5e7d70,_0x4e13a2,_0x3942d0)=>{const _0x24d0ae=_0x43c3ce;if(dbUserTable[_0x24d0ae(0x1d5)](_0x5e7d70,_0x4e13a2,_0x24d0ae(0x1dd),_0x24d0ae(0x279))==!![]){let _0x1f8d53=_0x5e7d70[_0x24d0ae(0x19f)][_0x24d0ae(0x145)];if(!_0x1f8d53||_0x1f8d53['length']<0x2)return _0x5e7d70[_0x24d0ae(0x1e4)][_0x24d0ae(0x1e9)](_0x4e13a2,_0x4e13a2['__'](_0x24d0ae(0x1e0)));let _0x186ccf=_0x5e7d70['app']['dbFileIndex'][_0x24d0ae(0x209)]('SELECT\x20*\x20FROM\x20photo_faces\x20WHERE\x20id=?')[_0x24d0ae(0x23e)](_0x1f8d53[0x0]);if(!_0x186ccf)return _0x5e7d70[_0x24d0ae(0x1e4)]['returnErrMsg'](_0x4e13a2,_0x4e13a2['__'](_0x24d0ae(0x1ca)));for(let _0x4a0387=0x1;_0x4a0387<_0x1f8d53[_0x24d0ae(0x149)];_0x4a0387++){let _0x41ce62=_0x1f8d53[_0x4a0387];_0x5e7d70[_0x24d0ae(0x1e4)][_0x24d0ae(0x1ef)][_0x24d0ae(0x209)](_0x24d0ae(0x272))[_0x24d0ae(0x14b)](_0x186ccf['id'],_0x41ce62,_0x41ce62);}return process[_0x24d0ae(0x1fc)]({'type':_0x24d0ae(0x1ad)}),_0x4e13a2[_0x24d0ae(0x1c3)]({'code':0x0});}}),router[_0x43c3ce(0x23e)](_0x43c3ce(0x13f),(_0x3effd0,_0xd69e95,_0x249bde)=>{const _0x300b14=_0x43c3ce;let _0xceb59b=_0x3effd0[_0x300b14(0x1bd)][_0x300b14(0x1b3)];if(dbUserTable[_0x300b14(0x1d5)](_0x3effd0,_0xd69e95,_0x300b14(0x1dd),'power_get')==!![]){let _0x250592=_0x3effd0[_0x300b14(0x1e4)][_0x300b14(0x1ef)][_0x300b14(0x209)]('SELECT\x20*\x20FROM\x20photo_faces\x20where\x20id\x20=?')[_0x300b14(0x23e)](_0xceb59b);if(!_0x250592)return _0xd69e95[_0x300b14(0x1c9)](0x194)[_0x300b14(0x144)]();_0x3effd0[_0x300b14(0x269)][_0x300b14(0x14c)]!=0x1?_0x5b61e5(![]):!_0x250592[_0x300b14(0x29c)]?_0x5b61e5(!![]):fs['stat'](_0x250592['face_img_path'],(_0x4d770c,_0x275181)=>{const _0x47dcd6=_0x300b14;if(!_0x4d770c){let _0x3c6d73=new Date()['getTime'](),_0xa49e24=0x48*0xe10*0x3e8;if(_0x275181['ctimeMs']){let _0x50c846=_0x3c6d73-_0x275181[_0x47dcd6(0x258)];if(_0x50c846>_0xa49e24)return _0x5b61e5(!![]);}return _0xd69e95['sendFile'](_0x250592[_0x47dcd6(0x29c)]);}_0x5b61e5(!![]);});function _0x5b61e5(_0x28f54c){const _0x8c1c47=_0x300b14;let _0x365fb5=dbFileIndexTable[_0x8c1c47(0x198)](_0x3effd0[_0x8c1c47(0x1e4)][_0x8c1c47(0x1ef)],_0xceb59b),_0x5e0acc=_0x8c1c47(0x24f)+_0x365fb5+'\x20';if(_0x3effd0[_0x8c1c47(0x269)][_0x8c1c47(0x14c)]!=0x1){let _0x34ecd6=dbUserTable[_0x8c1c47(0x25f)](_0x3effd0,_0x8c1c47(0x1dd),_0x8c1c47(0x248),!![]);_0x5e0acc+=_0x34ecd6;}let _0x387404=_0x3effd0[_0x8c1c47(0x1e4)][_0x8c1c47(0x1ef)]['prepare'](_0x5e0acc+_0x8c1c47(0x263))[_0x8c1c47(0x23e)]();if(!_0x387404){_0x387404=_0x3effd0[_0x8c1c47(0x1e4)]['dbFileIndex']['prepare'](_0x5e0acc+_0x8c1c47(0x295))[_0x8c1c47(0x23e)]();if(!_0x387404)return _0xd69e95[_0x8c1c47(0x1c9)](0x194)[_0x8c1c47(0x144)]();}if(!_0x387404)return _0xd69e95['status'](0x194)[_0x8c1c47(0x144)]();let _0x1ab80d=path[_0x8c1c47(0x188)](_0x387404[_0x8c1c47(0x141)],_0x387404[_0x8c1c47(0x274)]);if(parseInt(_0x387404[_0x8c1c47(0x26c)])==0x2){let _0x1f6393=config['getFileHashName'](_0x387404),_0x38a6e4=path[_0x8c1c47(0x188)](config[_0x8c1c47(0x24b)],_0x1f6393);sharpUtil[_0x8c1c47(0x192)](_0x1ab80d,path[_0x8c1c47(0x19b)](_0x38a6e4),path[_0x8c1c47(0x1e3)](_0x38a6e4),_0x8c1c47(0x159),_0x387404,_0x1fd1cd=>{_0x1ab80d=_0x38a6e4,_0x3c1439();},_0x766bd0=>{return _0xd69e95['status'](0x194)['end']();});}else _0x3c1439();function _0x3c1439(){const _0x6209e0=_0x8c1c47;let _0x58e597=path[_0x6209e0(0x188)](config[_0x6209e0(0x1d8)],_0x387404[_0x6209e0(0x1b5)]+new Date()[_0x6209e0(0x18c)]()+_0x6209e0(0x1f0)),_0x2a92f9=0x7d0;sharpUtil[_0x6209e0(0x211)](_0x1ab80d,(_0x417247,_0x3e8eb4,_0x404b62)=>{const _0x42ccf5=_0x6209e0;let _0x1f91bc=parseInt(_0x387404[_0x42ccf5(0x240)]*1.4),_0x1377e6=parseInt(_0x387404['f2height']*1.4),_0x268355=parseInt(_0x387404[_0x42ccf5(0x257)]-_0x1f91bc*0.2),_0xb5efc2=parseInt(_0x387404[_0x42ccf5(0x1ba)]-_0x1377e6*0.2);if(_0xb5efc2<0x0)_0xb5efc2=0x0;if(_0x268355<0x0)_0x268355=0x0;_0x48764a(_0x417247,_0x3e8eb4,_0x404b62,_0x268355,_0xb5efc2,_0x1f91bc,_0x1377e6,()=>{const _0x2456b7=_0x42ccf5;let _0x160cbb=parseInt(_0x387404['f2width']),_0x2e0811=parseInt(_0x387404[_0x2456b7(0x25d)]),_0x5c71a1=parseInt(_0x387404[_0x2456b7(0x257)]),_0xf423c2=parseInt(_0x387404[_0x2456b7(0x1ba)]);if(_0xf423c2<0x0)_0xf423c2=0x0;if(_0x5c71a1<0x0)_0x5c71a1=0x0;_0x48764a(_0x417247,_0x3e8eb4,_0x404b62,_0x5c71a1,_0xf423c2,_0x160cbb,_0x2e0811);});});function _0x48764a(_0x21b8e2,_0x111946,_0x416881,_0x51b974,_0x44c4d8,_0x33bc12,_0x40d2a4,_0x53c2f3){const _0xf5700d=_0x6209e0;let _0x31c943=sharpUtil[_0xf5700d(0x173)](_0x21b8e2),_0x2b63b2=exifUtils[_0xf5700d(0x283)](_0x416881);_0x2b63b2?_0x31c943=_0x31c943[_0xf5700d(0x26d)](_0x2b63b2):_0x31c943=_0x31c943[_0xf5700d(0x26d)](),_0x31c943[_0xf5700d(0x234)]({'width':_0x2a92f9,'height':_0x2a92f9,'withoutEnlargement':!![]})[_0xf5700d(0x29a)]()[_0xf5700d(0x297)]({'left':_0x51b974,'top':_0x44c4d8,'width':_0x33bc12,'height':_0x40d2a4})[_0xf5700d(0x1f5)](_0x58e597,function(_0x382b9e){const _0x505003=_0xf5700d;if(_0x382b9e){_0x111946&&sharpUtil[_0x505003(0x208)](_0x21b8e2);if(_0x53c2f3)_0x53c2f3();else return _0xd69e95[_0x505003(0x1c9)](0x194)[_0x505003(0x144)]();}else{_0x111946&&sharpUtil[_0x505003(0x208)](_0x21b8e2);if(_0x28f54c)return _0x3effd0[_0x505003(0x1e4)][_0x505003(0x1ef)][_0x505003(0x209)](_0x505003(0x27e)+_0x58e597+_0x505003(0x178)+_0xceb59b)[_0x505003(0x14b)](),_0xd69e95[_0x505003(0x1cb)](_0x58e597);else _0xd69e95[_0x505003(0x1cb)](_0x58e597),_0xd69e95['on'](_0x505003(0x1c0),()=>{fs['rm'](_0x58e597,_0x1dcb03=>{});});}});}}}}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x1fd),(_0x5242c1,_0x56aaf7,_0x6e0d0b)=>{const _0x742b58=_0x43c3ce;let _0x1f3313=_0x5242c1[_0x742b58(0x19f)]['targetFaceId'],_0x4fdc6=_0x5242c1[_0x742b58(0x19f)][_0x742b58(0x1d4)],_0x37a9b1=[];if(!_0x1f3313||!_0x4fdc6)return _0x56aaf7[_0x742b58(0x1c3)]({'code':0x0,'sucIdList':_0x37a9b1});try{_0x4fdc6=JSON[_0x742b58(0x164)](_0x4fdc6);for(let _0x4a56e8 in _0x4fdc6){let _0x224974=_0x4fdc6[_0x4a56e8],_0x3f719c=_0x5242c1['app'][_0x742b58(0x1ef)][_0x742b58(0x209)]('UPDATE\x20photo_faces2index\x20SET\x20face_id=?\x20WHERE\x20face_id=?\x20and\x20photo_index_id=?')['run'](parseInt(_0x1f3313),parseInt(_0x224974[_0x742b58(0x278)]),parseInt(_0x224974[_0x742b58(0x13a)]));_0x37a9b1[_0x742b58(0x14d)](_0x224974[_0x742b58(0x13a)]);}return _0x56aaf7[_0x742b58(0x1c3)]({'code':0x0,'sucIdList':_0x37a9b1});}catch(_0xb2a62c){return console[_0x742b58(0x176)](_0xb2a62c),_0x56aaf7[_0x742b58(0x1c3)]({'code':0x0,'sucIdList':_0x37a9b1});}}),router['post'](_0x43c3ce(0x1da),(_0x5a6ac3,_0x4e0b31,_0x3b989f)=>{const _0x365d3a=_0x43c3ce;let _0x393126=_0x5a6ac3[_0x365d3a(0x19f)]['type'],_0x1e18a2={};if(_0x5a6ac3['currentUser'][_0x365d3a(0x14c)]==0x1){if(!_0x393126||_0x393126=='faceapi'){let _0x36008e=_0x5a6ac3['app'][_0x365d3a(0x1ef)][_0x365d3a(0x209)]('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20file_index_photo\x20WHERE\x20ai_face_detect_state=0\x20and\x20(type=1\x20or\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20')['get']();_0x1e18a2['faceApiWaitDealCount']=_0x36008e['count'];if(_0x36008e[_0x365d3a(0x1c8)]<0x1){let _0x25150e=_0x5a6ac3[_0x365d3a(0x1e4)][_0x365d3a(0x1ef)]['prepare'](_0x365d3a(0x1f2))[_0x365d3a(0x23e)]();_0x1e18a2['faceApiWaitCompareCount']=_0x25150e[_0x365d3a(0x1c8)];}}if(!_0x393126||_0x393126==_0x365d3a(0x17c)){let _0xdc041f=_0x5a6ac3[_0x365d3a(0x1e4)][_0x365d3a(0x1ef)][_0x365d3a(0x209)](_0x365d3a(0x23b))['get']();_0x1e18a2[_0x365d3a(0x28b)]=_0xdc041f['count'];}if(!_0x393126||_0x393126==_0x365d3a(0x292)){let _0x18aa1b=_0x5a6ac3[_0x365d3a(0x1e4)][_0x365d3a(0x1ef)][_0x365d3a(0x209)](_0x365d3a(0x224))[_0x365d3a(0x23e)]();_0x1e18a2['similarWaitDealCount']=_0x18aa1b[_0x365d3a(0x1c8)];}}let _0x35c2c7=dbConfigTable['findByTitle'](_0x5a6ac3['app'][_0x365d3a(0x1b4)],_0x365d3a(0x213)),_0x1a6c97=0x0;return!_0x35c2c7?_0x1a6c97=0x0:_0x1a6c97=_0x35c2c7[_0x365d3a(0x162)],_0x1e18a2[_0x365d3a(0x250)]=_0x1a6c97,_0x4e0b31[_0x365d3a(0x1c3)]({'code':0x0,'data':_0x1e18a2});}),router[_0x43c3ce(0x288)](_0x43c3ce(0x212),(_0x4a6a1f,_0x102dee,_0x1e62e8)=>{const _0x5638f6=_0x43c3ce;if(dbUserTable['doUserCanGet'](_0x4a6a1f,_0x102dee,_0x5638f6(0x1dd),_0x5638f6(0x279))==!![])try{fs['rm'](config[_0x5638f6(0x1d8)],{'recursive':!![]},_0x1b4fb6=>{const _0x4f38a6=_0x5638f6;if(_0x1b4fb6)return console[_0x4f38a6(0x176)](_0x1b4fb6),_0x4a6a1f[_0x4f38a6(0x1e4)][_0x4f38a6(0x1e9)](_0x102dee,_0x102dee['__'](_0x4f38a6(0x1c5))+':'+config[_0x4f38a6(0x1d8)],_0x4f38a6(0x21c));fs[_0x4f38a6(0x185)](config[_0x4f38a6(0x1d8)],_0x58d716=>{const _0x2f9b8b=_0x4f38a6;if(_0x58d716)return _0x4a6a1f[_0x2f9b8b(0x1e4)][_0x2f9b8b(0x1e9)](_0x102dee,_0x102dee['__']('operationFail'),'dialog');let _0x42264a=_0x4a6a1f[_0x2f9b8b(0x1e4)][_0x2f9b8b(0x1ef)][_0x2f9b8b(0x16e)](()=>{const _0x28b425=_0x2f9b8b;return _0x4a6a1f[_0x28b425(0x1e4)]['dbFileIndex'][_0x28b425(0x209)](_0x28b425(0x21d))[_0x28b425(0x14b)](),_0x4a6a1f[_0x28b425(0x1e4)][_0x28b425(0x1ef)][_0x28b425(0x209)]('delete\x20from\x20photo_faces2index\x20where\x201=1')[_0x28b425(0x14b)](),_0x4a6a1f[_0x28b425(0x1e4)]['dbFileIndex'][_0x28b425(0x209)](_0x28b425(0x215))[_0x28b425(0x14b)](),process[_0x28b425(0x1fc)]({'type':_0x28b425(0x1ad)}),_0x102dee['json']({'code':0x0});});_0x42264a();});});}catch(_0x277653){return _0x4a6a1f[_0x5638f6(0x1e4)][_0x5638f6(0x1e9)](_0x102dee,_0x102dee['__'](_0x5638f6(0x1ca)),'dialog');}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x256),(_0x1f12bd,_0x3caace,_0x382031)=>{const _0x40d415=_0x43c3ce;if(dbUserTable['doUserCanGet'](_0x1f12bd,_0x3caace,_0x40d415(0x1dd),_0x40d415(0x279))==!![])try{let _0x2f31a6=_0x1f12bd['app'][_0x40d415(0x1ef)][_0x40d415(0x16e)](()=>{const _0x311595=_0x40d415;return _0x1f12bd['app'][_0x311595(0x1ef)][_0x311595(0x209)](_0x311595(0x140))['run'](),_0x1f12bd[_0x311595(0x1e4)][_0x311595(0x1ef)]['prepare'](_0x311595(0x282))[_0x311595(0x14b)](),process[_0x311595(0x1fc)]({'type':_0x311595(0x199)}),_0x3caace['json']({'code':0x0});});_0x2f31a6();}catch(_0x164fdb){return _0x1f12bd[_0x40d415(0x1e4)]['returnErrMsg'](_0x3caace,_0x3caace['__'](_0x40d415(0x1ca)),'dialog');}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x291),(_0x376767,_0x43a9e8,_0x5df053)=>{const _0x2ef4e0=_0x43c3ce;if(dbUserTable[_0x2ef4e0(0x15e)](_0x376767,_0x43a9e8)!==!![])return;let _0x46f8cb=dbConfigTable[_0x2ef4e0(0x175)](_0x376767[_0x2ef4e0(0x1e4)][_0x2ef4e0(0x1b4)],_0x2ef4e0(0x27c));if(!_0x46f8cb||_0x46f8cb['value']!='1')return _0x43a9e8[_0x2ef4e0(0x1c3)]({'code':0x0,'data':[],'enable':![]});let _0x179852=_0x376767['body']['minIndexId'];if(!_0x179852)_0x179852=0x0;let _0x4cea28=_0x376767['body'][_0x2ef4e0(0x1c8)];if(!_0x4cea28||_0x4cea28>0x64)_0x4cea28=0x64;let _0x1cefa2=[],_0x536cfc=_0x376767[_0x2ef4e0(0x1e4)][_0x2ef4e0(0x1ef)][_0x2ef4e0(0x209)]('SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id')[_0x2ef4e0(0x15c)](),_0x34b2b5=_0x376767[_0x2ef4e0(0x1e4)][_0x2ef4e0(0x1ef)][_0x2ef4e0(0x209)]('SELECT\x20index_id\x20FROM\x20photo_phash_similar\x20group\x20by\x20index_id\x20limit\x20'+_0x4cea28)['all']();for(let _0x386bdf in _0x34b2b5){let _0x261cfa=_0x34b2b5[_0x386bdf],_0x182c64=_0x376767[_0x2ef4e0(0x1e4)][_0x2ef4e0(0x1ef)]['prepare'](_0x2ef4e0(0x16b)+_0x261cfa[_0x2ef4e0(0x19c)])[_0x2ef4e0(0x23e)](),_0x18b9a9=_0x376767[_0x2ef4e0(0x1e4)][_0x2ef4e0(0x1ef)][_0x2ef4e0(0x209)](_0x2ef4e0(0x19d)+_0x261cfa[_0x2ef4e0(0x19c)])[_0x2ef4e0(0x15c)]();_0x34b2b5[_0x386bdf][_0x2ef4e0(0x266)]=_0x182c64,_0x34b2b5[_0x386bdf]['similarIndexList']=[_0x182c64],_0x34b2b5[_0x386bdf][_0x2ef4e0(0x197)]['push'](..._0x18b9a9),_0x34b2b5[_0x386bdf][_0x2ef4e0(0x197)][_0x2ef4e0(0x149)]>0x1?_0x1cefa2[_0x2ef4e0(0x14d)](_0x34b2b5[_0x386bdf]):_0x376767[_0x2ef4e0(0x1e4)][_0x2ef4e0(0x1ef)][_0x2ef4e0(0x209)]('DELETE\x20FROM\x20photo_phash_similar\x20where\x20index_id=?')[_0x2ef4e0(0x14b)](_0x261cfa[_0x2ef4e0(0x19c)]);}return _0x43a9e8['json']({'code':0x0,'data':_0x1cefa2,'enable':!![],'waitDealCount':_0x536cfc['length']});}),router['post']('/dealSimilarPhoto',(_0x4423ad,_0x2c6aca,_0x3434f2)=>{const _0x5dee07=_0x43c3ce;if(dbUserTable[_0x5dee07(0x15e)](_0x4423ad,_0x2c6aca)!==!![])return;nasAccountUtil['isVip'](_0x2c6aca,_0x4423ad[_0x5dee07(0x1e4)][_0x5dee07(0x1b4)])[_0x5dee07(0x20c)](_0xc0383c=>{const _0x248091=_0x5dee07;if(!_0xc0383c)return;let _0x39184a=_0x4423ad[_0x248091(0x19f)][_0x248091(0x142)];for(let _0x451690 in _0x39184a){let _0x28f78b=_0x4423ad['app']['dbFileIndex'][_0x248091(0x209)](_0x248091(0x180)+_0x39184a[_0x451690][_0x248091(0x19c)])[_0x248091(0x15c)]();for(let _0xf3fa17 in _0x28f78b){if(!_0x39184a[_0x451690][_0x248091(0x15f)][_0x248091(0x155)](parseInt(_0x28f78b[_0xf3fa17][_0x248091(0x1a2)]))){let _0x5c1f0d=new Date()['getTime']();_0x4423ad[_0x248091(0x1e4)][_0x248091(0x1ef)][_0x248091(0x209)](_0x248091(0x286)+dbFileIndexTable[_0x248091(0x137)]+_0x248091(0x166)+_0x5c1f0d+_0x248091(0x270)+_0x28f78b[_0xf3fa17][_0x248091(0x1a2)])['run']();}}if(!_0x39184a[_0x451690][_0x248091(0x15f)]['includes'](parseInt(_0x39184a[_0x451690][_0x248091(0x19c)]))){let _0x3bbab7=new Date()[_0x248091(0x18c)]();_0x4423ad['app'][_0x248091(0x1ef)][_0x248091(0x209)](_0x248091(0x286)+dbFileIndexTable[_0x248091(0x137)]+'\x20SET\x20in_trash=1,in_trash_time='+_0x3bbab7+'\x20WHERE\x20id\x20=\x20'+_0x39184a[_0x451690][_0x248091(0x19c)])[_0x248091(0x14b)]();}_0x4423ad[_0x248091(0x1e4)][_0x248091(0x1ef)][_0x248091(0x209)]('delete\x20from\x20photo_phash_similar\x20where\x20index_id='+_0x39184a[_0x451690][_0x248091(0x19c)])[_0x248091(0x14b)]();}return _0x2c6aca['json']({'code':0x0});});}),router[_0x43c3ce(0x288)](_0x43c3ce(0x1d9),(_0x9b77d,_0x4c9346,_0x32b0b7)=>{const _0x350841=_0x43c3ce;if(dbUserTable[_0x350841(0x1d5)](_0x9b77d,_0x4c9346,_0x350841(0x1dd),'power_change','')==!![]){let _0x3b17ca=_0x9b77d['app'][_0x350841(0x1ef)]['prepare']('SELECT\x20*\x20FROM\x20file_index_photo\x20WHERE\x20in_trash=1\x20AND\x20is_file=1\x20AND\x20raw_filename\x20is\x20not\x20null\x20AND\x20raw_filename!=\x27\x27\x20AND\x20type=1')[_0x350841(0x15c)]();for(let _0x5238c8 of _0x3b17ca){_0x9b77d['app'][_0x350841(0x1ef)][_0x350841(0x209)](_0x350841(0x1f3))[_0x350841(0x14b)](_0x5238c8[_0x350841(0x141)],_0x5238c8[_0x350841(0x1df)]);}return _0x9b77d[_0x350841(0x1e4)]['dbFileIndex'][_0x350841(0x209)]('UPDATE\x20'+dbFileIndexTable[_0x350841(0x137)]+_0x350841(0x130))[_0x350841(0x14b)](),_0x4c9346[_0x350841(0x1c3)]({'code':0x0});}}),router[_0x43c3ce(0x288)](_0x43c3ce(0x285),(_0x300abe,_0x260a24,_0x13518c)=>{const _0x38cbae=_0x43c3ce;let _0x4dacdf=_0x300abe[_0x38cbae(0x19f)]['putInSystemTrash'],_0x2e0d16=dbFileIndexTable[_0x38cbae(0x1de)](_0x300abe[_0x38cbae(0x1e4)][_0x38cbae(0x1ef)],'\x20in_trash=1\x20and\x20is_file=1\x20',_0x38cbae(0x244),dbFileIndexTable[_0x38cbae(0x137)]),_0x324478=dbFileIndexTable[_0x38cbae(0x137)];console[_0x38cbae(0x176)]('Cleaning\x20out\x20the\x20recycle\x20bin\x20:\x20'+_0x2e0d16[_0x38cbae(0x149)]);function _0x23edeb(_0x5f5a0d,_0x1022db){const _0x4b0835=_0x38cbae;dbFileOperationRecord['addFileOperationRecord'](_0x300abe[_0x4b0835(0x1e4)][_0x4b0835(0x1b4)],{'username':_0x300abe[_0x4b0835(0x269)][_0x4b0835(0x252)],'targetPath':_0x5f5a0d,'level':dbFileOperationRecord[_0x4b0835(0x239)],'type':dbFileOperationRecord[_0x4b0835(0x218)],'state':_0x1022db?dbFileOperationRecord[_0x4b0835(0x169)]:dbFileOperationRecord[_0x4b0835(0x259)]});}function _0x466b20(_0x42e3c8){const _0x1706dd=_0x38cbae;if(_0x42e3c8[_0x1706dd(0x20b)]==0x1&&_0x42e3c8[_0x1706dd(0x15a)]==0x1){let _0x1ddd84=path[_0x1706dd(0x188)](_0x42e3c8[_0x1706dd(0x141)],_0x42e3c8[_0x1706dd(0x274)][_0x1706dd(0x216)](_0x1706dd(0x1b1),'')+_0x1706dd(0x1a7));_0x42e3c8[_0x1706dd(0x274)][_0x1706dd(0x253)](_0x1706dd(0x235))&&(_0x1ddd84=path[_0x1706dd(0x188)](_0x42e3c8[_0x1706dd(0x141)],_0x42e3c8[_0x1706dd(0x274)][_0x1706dd(0x216)](_0x1706dd(0x235),'')+_0x1706dd(0x219))),fs[_0x1706dd(0x273)](_0x1ddd84)&&(console['log'](_0x1706dd(0x1c6),_0x1ddd84),_0x486a18(_0x42e3c8,_0x1ddd84,![]));}}function _0x486a18(_0x41633f,_0x386bb5,_0xf97f98){const _0x3ce9a1=_0x38cbae;_0x4dacdf==0x1?(process['send']({'type':_0x3ce9a1(0x17d),'shellType':_0x3ce9a1(0x271),'path':_0x386bb5}),_0x23edeb(_0x386bb5,!![])):fs['rm'](_0x386bb5,{'recursive':!![]},_0x2cf936=>{_0x2cf936?_0x23edeb(_0x386bb5,![]):_0x23edeb(_0x386bb5,!![]);}),_0xf97f98&&_0x466b20(_0x41633f);}function _0xd6b8f9(_0x499647){const _0x10362b=_0x38cbae;dbFileIndexTable[_0x10362b(0x254)](_0x300abe['app'][_0x10362b(0x1ef)],_0x499647['id'],_0x324478);}for(let _0x29cca2 in _0x2e0d16){let _0x2aea89=_0x2e0d16[_0x29cca2];if(_0x2aea89){if(dbUserTable['doUserCanGet'](_0x300abe,_0x260a24,'photo',_0x38cbae(0x28c),_0x2aea89[_0x38cbae(0x141)])==!![]){let _0x19083c=path[_0x38cbae(0x188)](_0x2aea89[_0x38cbae(0x141)],path[_0x38cbae(0x22e)],_0x2aea89['filename']);_0xd6b8f9(_0x2aea89),_0x486a18(_0x2aea89,_0x19083c,!![]);}}}return _0x260a24[_0x38cbae(0x1c3)]({'code':0x0});}),router[_0x43c3ce(0x288)]('/operationLibrary',(_0x14ec57,_0x3dc52e,_0x3a33a6)=>{const _0x4a16fa=_0x43c3ce;let _0x26a0da=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x1aa)],_0x3fffee=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x26a)],_0xbe8b2c=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x203)],_0x47f86c=_0x14ec57['body'][_0x4a16fa(0x1c7)],_0x5498e3=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x160)],_0x354081=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x1c2)];if(_0x354081==_0x4a16fa(0x1bf)){let _0x1ae15d=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x202)]||0x0,_0x3338d9=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x1c8)]||0x32,_0x32a876=_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x17f)]||'',_0x353241=_0x14ec57[_0x4a16fa(0x19f)]['orderField']||_0x4a16fa(0x1d2),_0x19c8b2=_0x14ec57[_0x4a16fa(0x19f)]['orderType']||_0x4a16fa(0x206);if(![_0x4a16fa(0x1d2),_0x4a16fa(0x1aa)][_0x4a16fa(0x155)](_0x353241))return console[_0x4a16fa(0x176)](_0x4a16fa(0x191),_0x353241),[];let _0x24828e=[],_0x232095=[],_0x4a4e95=_0x4a16fa(0x268);_0x14ec57[_0x4a16fa(0x269)]['is_admin']==0x1?_0x32a876&&(_0x4a4e95+=_0x4a16fa(0x205),_0x232095['push']('%'+_0x32a876+'%')):(_0x4a4e95=_0x4a16fa(0x296),_0x32a876&&(_0x4a4e95+=_0x4a16fa(0x26f),_0x232095[_0x4a16fa(0x14d)]('%'+_0x32a876+'%')));_0x4a4e95+='\x20ORDER\x20BY\x20'+_0x353241+'\x20'+_0x19c8b2+_0x4a16fa(0x131),_0x232095[_0x4a16fa(0x14d)](_0x3338d9),_0x232095[_0x4a16fa(0x14d)](_0x1ae15d),_0x24828e=_0x14ec57['app']['dbFileIndex'][_0x4a16fa(0x209)](_0x4a4e95)[_0x4a16fa(0x15c)](_0x232095);if(_0x24828e['length']<0x1)return _0x3dc52e[_0x4a16fa(0x1c3)]({'code':0x0,'data':[]});for(let _0x54af9b in _0x24828e){let _0x39f9db=_0x24828e[_0x54af9b];try{let _0x26b2e9=JSON[_0x4a16fa(0x164)](_0x39f9db[_0x4a16fa(0x247)]),_0x59c6c9=[];for(let _0x19cc26 of _0x26b2e9){let _0x325b56=dbUserTable['findWithField'](_0x14ec57[_0x4a16fa(0x1e4)]['dbOther'],_0x19cc26,_0x4a16fa(0x15d));_0x59c6c9[_0x4a16fa(0x14d)](_0x325b56);}_0x24828e[_0x54af9b][_0x4a16fa(0x16a)]=_0x59c6c9;}catch(_0x55a9f3){console[_0x4a16fa(0x176)](_0x55a9f3);}_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x1c8)]=0x4,_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x1e5)]=[],_0x14ec57['body'][_0x4a16fa(0x16f)]=0x0,_0x14ec57['body']['sortField']=_0x4a16fa(0x27b),_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x294)]=_0x4a16fa(0x206),_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x16c)]=0x1,_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x1a4)]=0x9184e729fff,_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x271)]=0x0,_0x14ec57[_0x4a16fa(0x19f)][_0x4a16fa(0x26a)]=_0x24828e[_0x54af9b]['id'],_0x24828e[_0x54af9b][_0x4a16fa(0x19e)]=photoApiUtil[_0x4a16fa(0x251)](_0x14ec57,_0x3dc52e);}return _0x3dc52e[_0x4a16fa(0x1c3)]({'code':0x0,'data':_0x24828e});}else{if(_0x14ec57['currentUser'][_0x4a16fa(0x14c)]!=0x1)return _0x14ec57[_0x4a16fa(0x1e4)][_0x4a16fa(0x1e9)](_0x3dc52e,_0x3dc52e['__']('noPermission'));if(_0x354081==_0x4a16fa(0x231)||_0x354081==_0x4a16fa(0x24d)){if(!_0xbe8b2c||!_0xbe8b2c instanceof Array||_0xbe8b2c[_0x4a16fa(0x149)]<0x1)return _0x14ec57[_0x4a16fa(0x1e4)][_0x4a16fa(0x1e9)](_0x3dc52e,_0x3dc52e['__'](_0x4a16fa(0x1ca)));if(_0x5498e3){if(_0x47f86c!=null&&!_0x47f86c instanceof Array)return _0x14ec57['app'][_0x4a16fa(0x1e9)](_0x3dc52e,_0x3dc52e['__']('operationFail'));}if(sqliteUtil[_0x4a16fa(0x24c)](JSON[_0x4a16fa(0x139)](_0xbe8b2c))==!![])return _0x14ec57['app']['returnErrMsg'](_0x3dc52e,_0x4a16fa(0x172));}if(_0x354081==_0x4a16fa(0x24d)&&_0x3fffee)_0x14ec57['app'][_0x4a16fa(0x1ef)][_0x4a16fa(0x209)](_0x4a16fa(0x18a))[_0x4a16fa(0x14b)](_0x26a0da,JSON[_0x4a16fa(0x139)](_0xbe8b2c),_0x5498e3,JSON['stringify'](_0x47f86c),_0x3fffee);else{if(_0x354081==_0x4a16fa(0x181)&&_0x3fffee)_0x14ec57[_0x4a16fa(0x1e4)][_0x4a16fa(0x1ef)]['prepare'](_0x4a16fa(0x1f9))[_0x4a16fa(0x14b)](_0x3fffee);else{if(_0x354081==_0x4a16fa(0x231))_0x14ec57['app'][_0x4a16fa(0x1ef)][_0x4a16fa(0x209)](_0x4a16fa(0x1b6))[_0x4a16fa(0x14b)](_0x26a0da,JSON['stringify'](_0xbe8b2c),_0x5498e3,JSON[_0x4a16fa(0x139)](_0x47f86c),_0x14ec57['currentUser']['id']);else return _0x14ec57['app']['returnErrMsg'](_0x3dc52e,_0x3dc52e['__']('noPermission'));}}return _0x3dc52e[_0x4a16fa(0x1c3)]({'code':0x0});}}),module[_0x43c3ce(0x26b)]=router;