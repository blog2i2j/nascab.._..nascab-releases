function _0x5910(_0x3d8492,_0x4ed975){const _0x1321fd=_0x1321();return _0x5910=function(_0x5910ee,_0x14c0ef){_0x5910ee=_0x5910ee-0x1ac;let _0x3f5938=_0x1321fd[_0x5910ee];return _0x3f5938;},_0x5910(_0x3d8492,_0x4ed975);}const _0x2a7144=_0x5910;(function(_0x6f1769,_0x57ab22){const _0x4b32e9=_0x5910,_0x5918ab=_0x6f1769();while(!![]){try{const _0x19d822=parseInt(_0x4b32e9(0x1ee))/0x1+parseInt(_0x4b32e9(0x1f6))/0x2+parseInt(_0x4b32e9(0x1b2))/0x3+parseInt(_0x4b32e9(0x1fa))/0x4*(parseInt(_0x4b32e9(0x1fd))/0x5)+-parseInt(_0x4b32e9(0x22f))/0x6*(-parseInt(_0x4b32e9(0x216))/0x7)+parseInt(_0x4b32e9(0x1c9))/0x8+-parseInt(_0x4b32e9(0x1dc))/0x9;if(_0x19d822===_0x57ab22)break;else _0x5918ab['push'](_0x5918ab['shift']());}catch(_0x2d3491){_0x5918ab['push'](_0x5918ab['shift']());}}}(_0x1321,0xcc81f));let express=require('express'),router=express[_0x2a7144(0x1c7)](),path=require(_0x2a7144(0x211)),fs=require('fs'),transCodeUtil=require(_0x2a7144(0x215)),fileUtil=require(_0x2a7144(0x1d6));const config=require(_0x2a7144(0x1d4));let videoStreamUtil=require('../../utils/videoStreamUtil'),FFmpeg=require(_0x2a7144(0x247))['FFmpeg'],cryptoUtils=require(_0x2a7144(0x1bb)),sha256=require(_0x2a7144(0x1f5));require(_0x2a7144(0x208))['EventEmitter'][_0x2a7144(0x224)]=0x0;const dbUserTable=require(_0x2a7144(0x23c)),dbFileIndexTable=require(_0x2a7144(0x1e1)),dbConfigTable=require('../../db/dbConfigTable');var jschardet=require(_0x2a7144(0x1b5));function MP4FfmpegTrans(_0x2f1282,_0x31b16e,_0x4d5986,_0x502090,_0x4b8f48,_0x2692eb){const _0x4bec88=_0x2a7144;let _0x3a7f57=_0x2f1282[_0x4bec88(0x1de)],_0x278555=FFmpeg(),_0x234975;if(_0x4b8f48)_0x234975=cryptoUtils[_0x4bec88(0x232)](_0x2692eb,_0x4d5986);let _0x57f040=_0x4b8f48?_0x234975:_0x4d5986,{videoStream:_0x6dee64,videoWidth:_0x3e9b95,videoHeight:_0x4cae53}=transCodeUtil['parseStreamList'](_0x502090);_0x278555[_0x4bec88(0x225)](transCodeUtil[_0x4bec88(0x21c)](_0x57f040));try{_0x278555['on'](_0x4bec88(0x1bc),function(_0x398be5){console['log'](_0x398be5);}),_0x278555['on'](_0x4bec88(0x1bd),function(_0x1309f3){const _0x319448=_0x4bec88;if(_0x1309f3['message']&&_0x1309f3['message'][_0x319448(0x21a)](_0x319448(0x1c1))==-0x1)_0x278555['kill'](),_0x278555=null,_0x31b16e[_0x319448(0x200)](0x1f4)[_0x319448(0x1b7)]();else{}}),_0x278555['on']('end',function(_0x3b1d15){const _0x23ea73=_0x4bec88;_0x278555&&(_0x278555[_0x23ea73(0x1ef)](),_0x278555=null);if(_0x31b16e)_0x31b16e[_0x23ea73(0x200)](0xc8)[_0x23ea73(0x1b7)]();}),_0x31b16e['on'](_0x4bec88(0x1f8),function(){});let _0x1cca2c=transCodeUtil[_0x4bec88(0x1d5)](_0x2f1282[_0x4bec88(0x233)][_0x4bec88(0x1ff)],_0x6dee64);_0x1cca2c[_0x4bec88(0x24f)]&&_0x278555['addInputOption'](_0x1cca2c['decoderCommand']);let _0x802082=_0x3a7f57[_0x4bec88(0x1d0)]*config[_0x4bec88(0x1da)];_0x802082&&!_0x4b8f48&&_0x278555[_0x4bec88(0x1ca)](''+parseInt(_0x802082));_0x1cca2c['encoderName']&&_0x278555[_0x4bec88(0x20f)](_0x1cca2c['encoderName']);let _0x3a6d2b=transCodeUtil[_0x4bec88(0x1c0)](_0x6dee64,_0x3a7f57['videobit']);!_0x3a6d2b&&(_0x3a6d2b=0x1800),_0x278555[_0x4bec88(0x1b4)](''+_0x3a6d2b),_0x278555[_0x4bec88(0x201)]('-map\x200:v:0?'),_0x278555[_0x4bec88(0x201)](_0x4bec88(0x1e8)+(_0x3a7f57[_0x4bec88(0x1c5)]?_0x3a7f57[_0x4bec88(0x1c5)]:0x0)+'?'),_0x278555[_0x4bec88(0x1c3)](_0x4bec88(0x1c2)),_0x278555[_0x4bec88(0x202)](_0x4bec88(0x243)),_0x278555[_0x4bec88(0x1f9)]([_0x4bec88(0x222)]),_0x278555[_0x4bec88(0x1c3)](_0x4bec88(0x1c2)),_0x278555['pipe'](_0x31b16e,{'end':!![]});}catch(_0xe513ab){console[_0x4bec88(0x212)](_0xe513ab),_0x278555[_0x4bec88(0x1ef)](),_0x31b16e[_0x4bec88(0x20e)](0x1f4);}}router['all']('/stopPlay',(_0x56767f,_0x1b3e7a,_0x107716)=>{const _0x57d769=_0x2a7144;let _0x1aeab3=_0x56767f[_0x57d769(0x1de)][_0x57d769(0x1d1)]||_0x56767f[_0x57d769(0x234)][_0x57d769(0x1d1)];process['send']({'type':_0x57d769(0x1f2),'playId':_0x1aeab3,'action':_0x57d769(0x23f)});let _0x38a404=path['join'](config[_0x57d769(0x229)],_0x1aeab3);return fs['rm'](_0x38a404,{'recursive':!![],'force':!![],'maxRetries':0xa},_0x4b2220=>{const _0x5b03f3=_0x57d769;if(_0x4b2220)console[_0x5b03f3(0x212)](_0x4b2220);}),_0x56767f['app'][_0x57d769(0x1ff)][_0x57d769(0x20d)]('DELETE\x20FROM\x20play_record\x20WHERE\x20play_id=?')[_0x57d769(0x23a)](_0x56767f[_0x57d769(0x1de)][_0x57d769(0x1d1)]),_0x1b3e7a[_0x57d769(0x250)]({'code':0x0});}),router[_0x2a7144(0x22a)](_0x2a7144(0x1e5),(_0x22f4f9,_0x284900,_0x3588d6)=>{const _0x53795f=_0x2a7144;let _0x380586=_0x22f4f9['query'],_0x37d1c9=_0x380586['subtitleIndex'],_0x19a20a=_0x380586[_0x53795f(0x1dd)];if(_0x19a20a&&_0x19a20a[_0x53795f(0x1d9)]>0x2){let _0x3f73e8=fileUtil[_0x53795f(0x1bf)](_0x19a20a);fs[_0x53795f(0x1d8)](_0x3f73e8,fs[_0x53795f(0x20a)][_0x53795f(0x238)],_0x4c577=>{const _0x4403e1=_0x53795f;if(_0x4c577)return _0x22f4f9['app'][_0x4403e1(0x1d2)](_0x284900,_0x284900['__'](_0x4403e1(0x248)));path[_0x4403e1(0x209)](_0x3f73e8)==_0x4403e1(0x1b6)&&_0x284900[_0x4403e1(0x221)](_0x3f73e8),fs[_0x4403e1(0x1fc)](_0x3f73e8,(_0x5b49e8,_0x41756c)=>{const _0xbbf026=_0x4403e1;if(_0x5b49e8)return _0x22f4f9[_0xbbf026(0x233)][_0xbbf026(0x1d2)](_0x284900,_0x284900['__'](_0xbbf026(0x248)));try{let _0x58e640=jschardet[_0xbbf026(0x241)](_0x41756c);!_0x58e640[_0xbbf026(0x210)][_0xbbf026(0x24b)]('UTF-')&&_0x58e640[_0xbbf026(0x228)]>0.95?_0x3311c7(_0x58e640['encoding']):_0x3311c7();}catch(_0x3da2bb){console[_0xbbf026(0x212)](_0x3da2bb),_0x3311c7();}function _0x3311c7(_0x1b3544){const _0x5c1d53=_0xbbf026;let _0x19618d=FFmpeg();_0x19618d[_0x5c1d53(0x225)](transCodeUtil['dealFFmpegPath'](_0x3f73e8))['noAudio']()[_0x5c1d53(0x227)]()[_0x5c1d53(0x1ce)](_0x5c1d53(0x23d)),_0x1b3544&&_0x19618d['inputOption']('-sub_charenc\x20'+_0x1b3544),_0x19618d['on']('start',function(_0xa90a62){const _0x3dcfba=_0x5c1d53;console[_0x3dcfba(0x212)](_0xa90a62);})['on'](_0x5c1d53(0x1bd),function(_0x397d35){const _0x441c9c=_0x5c1d53;_0x19618d[_0x441c9c(0x1ef)]();})['on'](_0x5c1d53(0x1b7),function(){const _0x32519e=_0x5c1d53;_0x19618d[_0x32519e(0x1ef)]();})[_0x5c1d53(0x24d)](_0x284900);}});});}else{let _0x19ad08=_0x380586[_0x53795f(0x1e2)];transCodeUtil['parseVideoFullPath'](_0x22f4f9[_0x53795f(0x233)]['dbFileIndex'],_0x22f4f9[_0x53795f(0x233)][_0x53795f(0x1ff)],_0x380586)[_0x53795f(0x1e9)](_0x3f7537=>{const _0x49e27c=_0x53795f;let {fullpath:_0x40b2c1,needDecrypt:_0xe3bc62,pwd:_0x4571b9,streamList:_0x1be098}=_0x3f7537;fs[_0x49e27c(0x1d8)](_0x40b2c1,fs[_0x49e27c(0x20a)][_0x49e27c(0x238)],_0x2b9ffd=>{const _0xcb4871=_0x49e27c;if(_0x2b9ffd)return _0x22f4f9['app'][_0xcb4871(0x1d2)](_0x284900,_0x284900['__'](_0xcb4871(0x248)));if(!_0x19ad08)_0x19ad08=_0xcb4871(0x231);let _0x546bf1=path[_0xcb4871(0x1ea)](config[_0xcb4871(0x1c6)],sha256(_0x40b2c1+_0x37d1c9)+'.'+_0x19ad08);fs[_0xcb4871(0x1ae)](_0x546bf1,(_0x21e289,_0x5c8ccb)=>{const _0x483d15=_0xcb4871;if(_0x21e289||_0x5c8ccb[_0x483d15(0x235)]<0x3e8){console[_0x483d15(0x212)](_0x483d15(0x21b),_0x546bf1);let _0x4a21d6=_0xe3bc62?cryptoUtils[_0x483d15(0x232)](_0x4571b9,_0x40b2c1):_0x40b2c1,_0x4e8aec=FFmpeg({'timeout':0x258});_0x4e8aec[_0x483d15(0x225)](transCodeUtil[_0x483d15(0x21c)](_0x4a21d6))[_0x483d15(0x203)]()[_0x483d15(0x227)]()['outputOptions'](['-map\x200:s:'+_0x37d1c9])[_0x483d15(0x23b)](_0x546bf1)['on']('start',function(_0x4d2fdd){const _0x3fdc49=_0x483d15;console[_0x3fdc49(0x212)](_0x4d2fdd);})['on']('error',function(_0x250c14){const _0xcc9f3b=_0x483d15;console[_0xcc9f3b(0x212)](_0x250c14),_0x4e8aec[_0xcc9f3b(0x1ef)](),fs['rm'](_0x546bf1,_0x36ec43=>{}),_0x22f4f9[_0xcc9f3b(0x233)][_0xcc9f3b(0x1d2)](_0x284900,_0x284900['__'](_0xcc9f3b(0x24a)));})['on'](_0x483d15(0x1b7),function(){const _0x56e1c9=_0x483d15;return _0x4e8aec[_0x56e1c9(0x1ef)](),_0x380586['noContent']?_0x284900[_0x56e1c9(0x250)]({'code':0x0}):_0x284900[_0x56e1c9(0x221)](_0x546bf1);}),_0x4e8aec[_0x483d15(0x23a)](),_0x284900['on'](_0x483d15(0x1f8),function(){const _0x1b67d2=_0x483d15;_0x4e8aec[_0x1b67d2(0x1ef)]();});}else{console[_0x483d15(0x212)](_0x483d15(0x206),_0x546bf1);if(_0x380586[_0x483d15(0x1e0)])return _0x284900['json']({'code':0x0});return _0x284900['sendFile'](_0x546bf1);}});});})[_0x53795f(0x20c)](_0x79de93=>{const _0x5b1195=_0x53795f;console[_0x5b1195(0x212)](_0x79de93),_0x22f4f9[_0x5b1195(0x233)][_0x5b1195(0x1d2)](_0x284900,_0x79de93);});}});function sendTsFile(_0x5984d7,_0x483fab,_0x2afb31,_0x45b7b,_0x828975,_0x8c6522=0x1){const _0x1ad457=_0x2a7144;if(_0x8c6522>0x28)return;let _0x5920da=_0x2afb31[_0x1ad457(0x1d1)];if(!_0x5920da)return;let _0x46c9b3=_0x5984d7['app'][_0x1ad457(0x1ff)][_0x1ad457(0x20d)](_0x1ad457(0x1cd))[_0x1ad457(0x22a)](_0x5920da,_0x828975,_0x1ad457(0x1cb));if(_0x46c9b3)fs[_0x1ad457(0x1ae)](_0x45b7b,(_0x54569c,_0x46456d)=>{const _0x2ce503=_0x1ad457;_0x54569c?(_0x5984d7[_0x2ce503(0x233)][_0x2ce503(0x1ff)][_0x2ce503(0x20d)]('DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?')[_0x2ce503(0x23a)](_0x5920da,_0x828975),sendTsFile(_0x5984d7,_0x483fab,_0x2afb31,_0x45b7b,_0x828975,_0x8c6522+0x1)):(_0x5984d7[_0x2ce503(0x233)]['dbOther']['prepare'](_0x2ce503(0x218))['run'](_0x5920da),_0x483fab[_0x2ce503(0x221)](_0x45b7b));});else{function _0x26c90a(){const _0x5a44b7=_0x1ad457;let _0xcf93a3=setTimeout(()=>{clearTimeout(_0xcf93a3),sendTsFile(_0x5984d7,_0x483fab,_0x2afb31,_0x45b7b,_0x828975,_0x8c6522+0x1);},0x1f4);_0x483fab['on'](_0x5a44b7(0x1f8),()=>clearTimeout(_0xcf93a3));}let _0x665b22=_0x5984d7[_0x1ad457(0x233)]['dbOther'][_0x1ad457(0x20d)](_0x1ad457(0x1ed))[_0x1ad457(0x22a)](_0x5920da,_0x1ad457(0x1cb));if(!_0x665b22)return _0x26c90a();else{let _0x3f48e8=_0x5984d7[_0x1ad457(0x233)]['dbOther'][_0x1ad457(0x20d)]('SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?')['get'](_0x5920da,_0x828975,_0x1ad457(0x249));if(_0x3f48e8)return _0x26c90a();else{let _0x39a5c8=parseInt(_0x665b22[_0x1ad457(0x214)][_0x1ad457(0x246)](_0x1ad457(0x1b3),'')[_0x1ad457(0x246)]('.ts',''));return _0x2afb31[_0x1ad457(0x1d0)]>_0x39a5c8+0xf||_0x2afb31[_0x1ad457(0x1d0)]<_0x39a5c8?(process[_0x1ad457(0x24e)]({'type':_0x1ad457(0x1f2),'playId':_0x5920da,'action':_0x1ad457(0x23f)}),process[_0x1ad457(0x24e)]({'type':'M3u8Transcode','playId':_0x5920da,'args':_0x2afb31,'action':_0x1ad457(0x1bc)}),_0x5984d7[_0x1ad457(0x233)][_0x1ad457(0x1ff)][_0x1ad457(0x20d)]('REPLACE\x20INTO\x20play_record_ts(play_id,ts_name,ts_type)\x20VALUES(?,?,?)')[_0x1ad457(0x23a)](_0x5920da,_0x828975,'waiting'),_0x26c90a()):_0x26c90a();}}}}function hasPermission(_0x289822,_0x1aed70,_0x68ff62){const _0x3427da=_0x2a7144;if(_0x68ff62['indexId']&&!_0x68ff62[_0x3427da(0x1c8)]){let _0x45543f=dbFileIndexTable[_0x3427da(0x217)](_0x68ff62[_0x3427da(0x22d)]),_0x409571=dbFileIndexTable[_0x3427da(0x1fe)](_0x289822[_0x3427da(0x233)]['dbFileIndex'],_0x68ff62[_0x3427da(0x1e7)],_0x45543f);if(!_0x409571)return reject('index\x20does\x20not\x20exist');let _0x48776d=_0x409571[_0x3427da(0x211)]+path[_0x3427da(0x1e6)]+_0x409571['filename'];if(dbUserTable[_0x3427da(0x20b)](_0x289822,_0x1aed70,_0x68ff62[_0x3427da(0x22d)],_0x3427da(0x205),_0x48776d,!![])!==!![])return console[_0x3427da(0x212)](_0x3427da(0x237)),![];return!![];}else{if(_0x68ff62[_0x3427da(0x22e)]&&!_0x68ff62[_0x3427da(0x1c8)]){let _0xce319c=fileUtil[_0x3427da(0x1bf)](_0x68ff62['filePath']);if(dbUserTable['doUserCanGet'](_0x289822,_0x1aed70,'',_0x3427da(0x205),_0xce319c,!![])!==!![])return console['log'](_0x3427da(0x237)),![];return!![];}else return!![];}}function _0x1321(){const _0x1b6ff7=['4836428Faoynh','\x0a#EXT-X-ENDLIST\x0a','readFile','5jeONsD','getById','dbOther','status','addOption','audioCodec','noAudio','&subtitleIndex=','power_get','字幕文件存在缓存','.ts?playId=','events','extname','constants','doUserCanGet','catch','prepare','sendStatus','videoCodec','encoding','path','log','.m3u8','ts_name','../../utils/transCodeUtil','57659oqBBUC','getIndexTableNameByType','DELETE\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=\x27waiting\x27','&spaceId=','indexOf','生成字幕文件','dealFFmpegPath','findByTitle','getVideoMeta','&burn=','parseVideoFullPath','sendFile','-movflags\x20frag_keyframe+empty_moov','seek','defaultMaxListeners','input','&token=','noVideo','confidence','m3u8TmpPath','get','REPLACE\x20INTO\x20play_record(play_id,args,uid)\x20VALUES(?,?,?)','currentUser','serverType','filePath','852WjctKw','need\x20play\x20id','vtt','decryptFileGetStream','app','body','size','videobit','index\x20no\x20permission','R_OK','&spaceIndexId=','run','output','../../db/dbUserTable','webvtt','Content-type','stop','post','detect','duration','aac','&serverType=','lastIndexOf','replace','../../libs/nasTrans','cannotReadFile','waiting','faidLoadSubtitle','startsWith','burn','pipe','send','decoderCommand','json','endsWith','&size=','stat','&spaceToken=','&filePath=','token','1456233AqhUyx','stream','videoBitrate','jschardet','.vtt','end','&audioIndex=','stringify','getDurationFromStream','../utils/cryptoUtils','start','error','/getVideoInfoByPath','decodePath','getVideoBitrate','killed','mp4','outputFormat','/play*','audioIndex','subtitlePath','Router','spaceId','1470968JkTczZ','seekInput','gen','SELECT\x20*\x20FROM\x20play_record\x20WHERE\x20play_id=?','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_name=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC','format','m3u8','seq','playId','returnErrMsg','streams','../../myConfig/config','getCoderConfig','../utils/fileUtils','Content-disposition','access','length','m3u8segmentDuration','subtitleIndex','26867736CkKjEx','subtitleFile','query','spaceToken','noContent','../../db/dbFileIndexTable','stype','.0,\x0astream','moviePreferLanguage','/subtitle*','sep','indexId','-map\x200:a:','then','join','&videobit=','value','SELECT\x20*\x20FROM\x20play_record_ts\x20WHERE\x20play_id=?\x20and\x20ts_type=?\x20ORDER\x20BY\x20create_time\x20DESC','564533dTFWCj','kill','substring','attachment;\x20filename=','M3u8Transcode','&seq=','&ac=','sha256','420782SndSGY','dbFileIndex','close','outputOptions'];_0x1321=function(){return _0x1b6ff7;};return _0x1321();}router[_0x2a7144(0x22a)](_0x2a7144(0x1c4),(_0x45dc8e,_0x40f76f,_0x425022)=>{const _0xcab513=_0x2a7144;let _0x3086a0=_0x45dc8e[_0xcab513(0x1de)];if(_0x45dc8e[_0xcab513(0x211)][_0xcab513(0x1ac)]('ts')){let _0x36f2c1=_0x45dc8e[_0xcab513(0x211)][_0xcab513(0x1f0)](_0x45dc8e['path'][_0xcab513(0x245)]('/')+0x1),_0x557d87=_0x3086a0['playId'],_0x2f4544=path[_0xcab513(0x1ea)](config[_0xcab513(0x229)],_0x557d87,_0x36f2c1),_0x455e2f=_0x45dc8e[_0xcab513(0x233)][_0xcab513(0x1ff)][_0xcab513(0x20d)](_0xcab513(0x1cc))[_0xcab513(0x22a)](_0x557d87);!_0x455e2f&&(_0x3086a0[_0xcab513(0x223)]=_0x3086a0[_0xcab513(0x1d0)]*config[_0xcab513(0x1da)],_0x45dc8e[_0xcab513(0x233)][_0xcab513(0x1ff)][_0xcab513(0x20d)](_0xcab513(0x22b))[_0xcab513(0x23a)](_0x557d87,JSON[_0xcab513(0x1b9)](_0x3086a0),_0x45dc8e['currentUser']['id']));if(!hasPermission(_0x45dc8e,_0x40f76f,_0x3086a0))return _0x40f76f[_0xcab513(0x250)]({'code':0x66});return process[_0xcab513(0x24e)]({'type':_0xcab513(0x1f2),'playId':_0x557d87,'args':_0x3086a0,'action':_0xcab513(0x1bc)}),sendTsFile(_0x45dc8e,_0x40f76f,_0x3086a0,_0x2f4544,_0x36f2c1);}else{if(_0x45dc8e[_0xcab513(0x211)][_0xcab513(0x1ac)](_0xcab513(0x1cf))){let _0x3bcdc7=_0x3086a0['playId'];if(!_0x3bcdc7)return _0x45dc8e[_0xcab513(0x233)][_0xcab513(0x1d2)](_0x40f76f,_0xcab513(0x230));if(!hasPermission(_0x45dc8e,_0x40f76f,_0x3086a0))return _0x40f76f['json']({'code':0x66});transCodeUtil[_0xcab513(0x220)](_0x45dc8e[_0xcab513(0x233)]['dbFileIndex'],_0x45dc8e[_0xcab513(0x233)]['dbOther'],_0x3086a0)['then'](_0x96e4a8=>{const _0x52cc37=_0xcab513;let {fullpath:_0x5375bc,duration:_0x124084}=_0x96e4a8;fs[_0x52cc37(0x1d8)](_0x5375bc,fs[_0x52cc37(0x20a)][_0x52cc37(0x238)],_0x4f6dc9=>{const _0x5f0ee5=_0x52cc37;if(_0x4f6dc9)return _0x45dc8e['app'][_0x5f0ee5(0x1d2)](_0x40f76f,_0x40f76f['__'](_0x5f0ee5(0x248)));_0x45dc8e[_0x5f0ee5(0x233)][_0x5f0ee5(0x1ff)]['prepare'](_0x5f0ee5(0x22b))['run'](_0x3bcdc7,JSON[_0x5f0ee5(0x1b9)](_0x3086a0),_0x45dc8e[_0x5f0ee5(0x22c)]['id']),process[_0x5f0ee5(0x24e)]({'type':'M3u8Transcode','playId':_0x3bcdc7,'args':_0x3086a0,'action':'start'}),getM3U8(_0x3086a0,_0x124084,_0x40f76f);});})[_0xcab513(0x20c)](_0x2a8b78=>{const _0x374a21=_0xcab513;console['log'](_0x374a21(0x1bd),_0x2a8b78),_0x45dc8e['app'][_0x374a21(0x1d2)](_0x40f76f,_0x2a8b78);});}else{if(_0x45dc8e[_0xcab513(0x211)][_0xcab513(0x1ac)](_0xcab513(0x1c2))){if(!hasPermission(_0x45dc8e,_0x40f76f,_0x3086a0))return _0x40f76f[_0xcab513(0x250)]({'code':0x66});transCodeUtil[_0xcab513(0x220)](_0x45dc8e[_0xcab513(0x233)][_0xcab513(0x1f7)],_0x45dc8e['app']['dbOther'],_0x3086a0)[_0xcab513(0x1e9)](_0x28b63c=>{const _0x55a7ed=_0xcab513;let {fullpath:_0x438e77,streamList:_0x266d18,needDecrypt:_0x4eca3d,pwd:_0x36f2af}=_0x28b63c;fs[_0x55a7ed(0x1d8)](_0x438e77,fs[_0x55a7ed(0x20a)][_0x55a7ed(0x238)],_0x55ee4e=>{const _0x3d224f=_0x55a7ed;if(_0x55ee4e)return _0x45dc8e[_0x3d224f(0x233)][_0x3d224f(0x1d2)](_0x40f76f,_0x40f76f['__'](_0x3d224f(0x248)));MP4FfmpegTrans(_0x45dc8e,_0x40f76f,_0x438e77,_0x266d18,_0x4eca3d,_0x36f2af);});})['catch'](_0x18f46c=>{const _0xbac0c3=_0xcab513;console['log']('error',_0x18f46c),_0x45dc8e[_0xbac0c3(0x233)][_0xbac0c3(0x1d2)](_0x40f76f,_0x18f46c);});}}}}),router[_0x2a7144(0x240)](_0x2a7144(0x1be),(_0x581588,_0x2e097e,_0x376908)=>{const _0x4fab4f=_0x2a7144;if(!_0x581588['body'][_0x4fab4f(0x22e)])return _0x2e097e[_0x4fab4f(0x20e)](0x1f4);let _0x5bdd38=fileUtil[_0x4fab4f(0x1bf)](_0x581588[_0x4fab4f(0x234)][_0x4fab4f(0x22e)]),_0x29e802={'code':0x0,'streams':[],'duration':0x0},_0x151234=dbConfigTable[_0x4fab4f(0x21d)](_0x581588['app']['dbOther'],_0x4fab4f(0x1e4));_0x29e802[_0x4fab4f(0x1e4)]=_0x151234?_0x151234[_0x4fab4f(0x1ec)]:'chi',_0x5bdd38=transCodeUtil[_0x4fab4f(0x21c)](_0x5bdd38),videoStreamUtil[_0x4fab4f(0x21e)](_0x5bdd38)['then'](_0x51c02d=>{const _0x59698a=_0x4fab4f;_0x29e802['streams']=_0x51c02d[_0x59698a(0x1d3)],_0x29e802[_0x59698a(0x242)]=videoStreamUtil[_0x59698a(0x1ba)](_0x51c02d),_0x2e097e[_0x59698a(0x250)](_0x29e802);})['catch'](_0x251f36=>{const _0x273a24=_0x4fab4f;return console[_0x273a24(0x212)](_0x251f36),_0x581588[_0x273a24(0x233)][_0x273a24(0x1d2)](_0x2e097e,_0x251f36);});});function getM3U8(_0x5aaf4d,_0x76832c,_0x26a7f1){const _0x403716=_0x2a7144;let _0x5d763d=Math['floor'](_0x76832c/config[_0x403716(0x1da)]),_0x22b809=_0x76832c-_0x5d763d*_0x76832c;if(_0x22b809>0x0){try{_0x22b809=parseInt(_0x22b809);}catch(_0x3a80f0){console[_0x403716(0x212)](_0x3a80f0);}_0x5d763d+=0x1;}let _0x32ffa2='#EXTM3U\x0a#EXT-X-PLAYLIST-TYPE:VOD\x20\x20\x20\x20\x20\x20\x20\x20\x0a#EXT-X-VERSION:3\x0a#EXT-X-TARGETDURATION:'+config[_0x403716(0x1da)]+',\x0a#EXT-X-MEDIA-SEQUENCE:0\x0a#EXT-X-ALLOW-CACHE:YES\x0a#EXT-X-START:TIME-OFFSET='+_0x5aaf4d[_0x403716(0x223)]+'\x0a';_0x5aaf4d['seek']&&(segmentStartNum=parseInt(_0x5aaf4d[_0x403716(0x223)]/config[_0x403716(0x1da)]));for(let _0x545316=0x0;_0x545316<_0x5d763d;_0x545316++){let _0x312621='\x0a#EXTINF:'+(_0x545316==_0x5d763d-0x1&&_0x22b809>0x0?_0x22b809:config[_0x403716(0x1da)])+_0x403716(0x1e3)+_0x545316+_0x403716(0x207)+_0x5aaf4d[_0x403716(0x1d1)]+_0x403716(0x226)+_0x5aaf4d[_0x403716(0x1b1)]+_0x403716(0x1f3)+_0x545316;_0x5aaf4d[_0x403716(0x235)]&&(_0x312621+=_0x403716(0x1ad)+_0x5aaf4d[_0x403716(0x235)]),_0x5aaf4d[_0x403716(0x236)]&&(_0x312621+=_0x403716(0x1eb)+_0x5aaf4d['videobit']),_0x5aaf4d[_0x403716(0x1db)]&&(_0x312621+=_0x403716(0x204)+_0x5aaf4d[_0x403716(0x1db)]),_0x5aaf4d[_0x403716(0x22d)]&&(_0x312621+=_0x403716(0x244)+_0x5aaf4d[_0x403716(0x22d)]),_0x5aaf4d['audioIndex']&&(_0x312621+=_0x403716(0x1b8)+_0x5aaf4d[_0x403716(0x1c5)]),_0x5aaf4d[_0x403716(0x1e7)]&&(_0x312621+='&indexId='+_0x5aaf4d['indexId']),_0x5aaf4d['ac']&&(_0x312621+=_0x403716(0x1f4)+_0x5aaf4d['ac']),_0x5aaf4d['filePath']&&(_0x312621+=_0x403716(0x1b0)+_0x5aaf4d[_0x403716(0x22e)]),_0x5aaf4d['spaceId']&&(_0x312621+=_0x403716(0x219)+_0x5aaf4d[_0x403716(0x1c8)]),_0x5aaf4d['spaceToken']&&(_0x312621+=_0x403716(0x1af)+_0x5aaf4d[_0x403716(0x1df)]),_0x5aaf4d['spaceIndexId']&&(_0x312621+=_0x403716(0x239)+_0x5aaf4d['spaceIndexId']),_0x5aaf4d['burn']&&(_0x312621+=_0x403716(0x21f)+_0x5aaf4d[_0x403716(0x24c)]),_0x32ffa2+=_0x312621;}_0x32ffa2+=_0x403716(0x1fb),_0x26a7f1['setHeader'](_0x403716(0x23e),'application/octet-stream');let _0x4bc871=new Date()['getTime']()+_0x403716(0x213);_0x26a7f1['setHeader'](_0x403716(0x1d7),_0x403716(0x1f1)+_0x4bc871),_0x26a7f1[_0x403716(0x24e)](_0x32ffa2);}module['exports']=router;