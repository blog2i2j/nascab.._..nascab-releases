const _0x4fd1ce=_0x1be7;(function(_0x46b08a,_0x3abe2c){const _0x36ba64=_0x1be7,_0x2575fd=_0x46b08a();while(!![]){try{const _0x2ec78f=parseInt(_0x36ba64(0x114))/0x1+-parseInt(_0x36ba64(0x103))/0x2+-parseInt(_0x36ba64(0x11f))/0x3+parseInt(_0x36ba64(0x11a))/0x4+-parseInt(_0x36ba64(0x138))/0x5*(-parseInt(_0x36ba64(0x12e))/0x6)+-parseInt(_0x36ba64(0x136))/0x7*(parseInt(_0x36ba64(0x107))/0x8)+-parseInt(_0x36ba64(0x12b))/0x9*(-parseInt(_0x36ba64(0x12f))/0xa);if(_0x2ec78f===_0x3abe2c)break;else _0x2575fd['push'](_0x2575fd['shift']());}catch(_0x37157a){_0x2575fd['push'](_0x2575fd['shift']());}}}(_0x1d7d,0x6f0c4));var express=require('express'),router=express[_0x4fd1ce(0x129)]();let path=require(_0x4fd1ce(0x110)),fs=require('fs');const dbFileIndexTable=require(_0x4fd1ce(0x123)),ngeohash=require(_0x4fd1ce(0x115));let config=require(_0x4fd1ce(0x121)),axios=require('axios'),nasAccountUtil=require('../utils/nasAccountUtils');function _0x1d7d(){const _0x24cb4a=['zoom','858lkgBzT','3970SPDIZn','GET','error','app','/getZoom','prepare','tile.png','3647AGBhDi','json','15425HMUmKl','post','join','length','\x20or\x20','lng','dirname','1281930zyTpkg','undefined','/tile','geohash','6256dFwpBl','/tile.png','userDataFolder','getById','mkdir','stream','dbOther','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20','stat','path','sendFile','dbCity','end','271323xREafI','ngeohash','https://down.nascab.cn/mapTiles/','lat','data','indexId','2927764ZtnsOW','mapTiles','exports','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash\x20like\x20?','isVip','31965IQnVyC','/getLocationStr','../../myConfig/config','createWriteStream','../../db/dbFileIndexTable','body','query','get','status','neighbors','Router','then','1575kpxnCA','substring'];_0x1d7d=function(){return _0x24cb4a;};return _0x1d7d();}function getByGeohash(_0x519288,_0x5ae3e9){const _0x15c2c0=_0x4fd1ce;let _0x197fe6=_0x519288[_0x15c2c0(0x134)](_0x15c2c0(0x11d))[_0x15c2c0(0x126)]([_0x5ae3e9+'%']);return _0x197fe6;}function _0x1be7(_0xef7cd4,_0x3800e6){const _0x1d7d53=_0x1d7d();return _0x1be7=function(_0x1be7e2,_0x34bcae){_0x1be7e2=_0x1be7e2-0xfd;let _0x35a8f5=_0x1d7d53[_0x1be7e2];return _0x35a8f5;},_0x1be7(_0xef7cd4,_0x3800e6);}function getByGeohashNeighbor(_0x5755ac,_0x11b19d){const _0x54abe5=_0x4fd1ce;let _0x3dd169=ngeohash[_0x54abe5(0x128)](_0x11b19d),_0x46eb86='',_0x50cd14=[];for(let _0x1d2875=0x0;_0x1d2875<_0x3dd169[_0x54abe5(0xff)];_0x1d2875++){_0x46eb86+='\x20geohash\x20like\x20?',_0x50cd14['push'](_0x3dd169[_0x1d2875]+'%'),_0x1d2875!=_0x3dd169[_0x54abe5(0xff)]-0x1&&(_0x46eb86+=_0x54abe5(0x100));}let _0x1263e3=_0x54abe5(0x10e)+_0x46eb86;return _0x5755ac['prepare'](_0x1263e3)[_0x54abe5(0x126)](_0x50cd14);}router['get'](_0x4fd1ce(0x105),(_0x179df9,_0x4a5fb1,_0x539b63)=>{const _0xb1593c=_0x4fd1ce;let _0x332a06=_0x179df9['query'][_0xb1593c(0x12d)],_0x5ef5fa=_0x179df9[_0xb1593c(0x125)]['x'],_0x4d70b1=_0x179df9[_0xb1593c(0x125)]['y'];if(!_0x332a06||!_0x5ef5fa||!_0x4d70b1)return _0x4a5fb1[_0xb1593c(0x127)](0x194)[_0xb1593c(0x113)]();let _0x5bb5b6=_0xb1593c(0x116)+_0x332a06+'/'+_0x5ef5fa+'/'+_0x4d70b1+_0xb1593c(0x108),_0x581e6b=path[_0xb1593c(0xfe)](config[_0xb1593c(0x109)],_0xb1593c(0x11b),_0x332a06,_0x5ef5fa,_0x4d70b1,_0xb1593c(0x135));fs[_0xb1593c(0x10f)](_0x581e6b,(_0xb50e6f,_0x5d752a)=>{const _0x5e1835=_0xb1593c;if(_0xb50e6f)axios({'url':_0x5bb5b6,'method':_0x5e1835(0x130),'responseType':_0x5e1835(0x10c)})['then'](_0x3fbd90=>{const _0x387a30=_0x5e1835;fs[_0x387a30(0x10b)](path[_0x387a30(0x102)](_0x581e6b),{'recursive':!![]},_0x42b08d=>{const _0x4b5586=_0x387a30;let _0x58ddcd=fs[_0x4b5586(0x122)](_0x581e6b);_0x3fbd90[_0x4b5586(0x118)]['pipe'](_0x58ddcd),_0x58ddcd['on']('finish',()=>{const _0x405ec0=_0x4b5586;return _0x4a5fb1[_0x405ec0(0x111)](_0x581e6b);}),_0x58ddcd['on'](_0x4b5586(0x131),()=>{const _0x321c1c=_0x4b5586;return _0x4a5fb1[_0x321c1c(0x127)](0x194)[_0x321c1c(0x113)]();});});})['catch'](_0x5e1978=>{const _0x3432c7=_0x5e1835;return _0x4a5fb1[_0x3432c7(0x127)](0x194)[_0x3432c7(0x113)]();});else return _0x4a5fb1['set']('Content-Type','image/png'),_0x4a5fb1[_0x5e1835(0x111)](_0x581e6b);});}),router['get'](_0x4fd1ce(0x133),(_0x5e690d,_0x4c8e1f,_0x8ca065)=>{const _0x157d2c=_0x4fd1ce;nasAccountUtil['isVip'](null,_0x5e690d[_0x157d2c(0x132)]['dbOther'])['then'](_0x3342ed=>{const _0x594551=_0x157d2c;return _0x3342ed?_0x4c8e1f[_0x594551(0x137)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0x4c8e1f[_0x594551(0x137)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router[_0x4fd1ce(0xfd)](_0x4fd1ce(0x133),(_0x36bb34,_0xb974d2,_0x2c4c8e)=>{const _0x4ec880=_0x4fd1ce;nasAccountUtil[_0x4ec880(0x11e)](null,_0x36bb34[_0x4ec880(0x132)][_0x4ec880(0x10d)])[_0x4ec880(0x12a)](_0x3a5903=>{const _0x17101f=_0x4ec880;return _0x3a5903?_0xb974d2[_0x17101f(0x137)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0xb974d2[_0x17101f(0x137)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router[_0x4fd1ce(0xfd)](_0x4fd1ce(0x120),(_0x572775,_0x1d652b,_0x2d29c0)=>{const _0x2a1f0c=_0x4fd1ce;let _0x658ad1=_0x572775['body'][_0x2a1f0c(0x117)],_0x217c43=_0x572775[_0x2a1f0c(0x124)][_0x2a1f0c(0x101)],_0x3f5ffa=_0x572775[_0x2a1f0c(0x124)][_0x2a1f0c(0x119)],_0x4b4205=dbFileIndexTable[_0x2a1f0c(0x10a)](_0x572775[_0x2a1f0c(0x132)]['dbFileIndex'],_0x3f5ffa);function _0xc66c3(){const _0xad7a36=_0x2a1f0c;return _0x1d652b[_0xad7a36(0x137)]({'code':0x0,'geo':{'name':'','cn_name':'','geohash':''}});}if(!_0x4b4205&&!_0x658ad1&&!_0x217c43)return _0xc66c3();let _0xd81d9e=_0x572775['app'][_0x2a1f0c(0x112)],_0x4ddce6='';if(_0x4b4205)_0x4ddce6=_0x4b4205[_0x2a1f0c(0x106)];else _0x658ad1&&_0x217c43&&(_0x4ddce6=ngeohash['encode'](_0x658ad1,_0x217c43));if(!_0x4ddce6||_0x4ddce6==_0x2a1f0c(0x104))return _0xc66c3();let _0x5c0ddc=undefined;for(let _0x1ed775=0x5;_0x1ed775>0x0;_0x1ed775--){_0x4ddce6=_0x4ddce6[_0x2a1f0c(0x12c)](0x0,_0x1ed775),_0x5c0ddc=getByGeohash(_0xd81d9e,_0x4ddce6);!_0x5c0ddc&&(_0x5c0ddc=getByGeohashNeighbor(_0xd81d9e,_0x4ddce6));if(_0x5c0ddc)break;}return _0x1d652b[_0x2a1f0c(0x137)]({'code':0x0,'geo':_0x5c0ddc});}),module[_0x4fd1ce(0x11c)]=router;