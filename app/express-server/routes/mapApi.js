const _0x1de798=_0xc2f4;(function(_0x70d3f0,_0x19bf1c){const _0x19a713=_0xc2f4,_0x116ba8=_0x70d3f0();while(!![]){try{const _0x1b2c1d=parseInt(_0x19a713(0xb3))/0x1*(-parseInt(_0x19a713(0x85))/0x2)+parseInt(_0x19a713(0x9b))/0x3+-parseInt(_0x19a713(0x9d))/0x4+-parseInt(_0x19a713(0xa9))/0x5*(parseInt(_0x19a713(0x90))/0x6)+-parseInt(_0x19a713(0xac))/0x7*(-parseInt(_0x19a713(0x92))/0x8)+-parseInt(_0x19a713(0x98))/0x9+parseInt(_0x19a713(0x94))/0xa;if(_0x1b2c1d===_0x19bf1c)break;else _0x116ba8['push'](_0x116ba8['shift']());}catch(_0xa5beea){_0x116ba8['push'](_0x116ba8['shift']());}}}(_0x5782,0x69c97));var express=require(_0x1de798(0xa5)),router=express[_0x1de798(0x89)]();let path=require(_0x1de798(0xa8)),fs=require('fs');const dbFileIndexTable=require(_0x1de798(0xa1)),ngeohash=require(_0x1de798(0x9f));let config=require(_0x1de798(0x96)),axios=require(_0x1de798(0xb6)),nasAccountUtil=require(_0x1de798(0x7f));function _0x5782(){const _0x2de604=['../utils/nasAccountUtils','undefined','status','mkdir','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash\x20like\x20?','GET','56134jLIrPq','Content-Type','lng','getById','Router','stream','/tile','pipe','indexId','catch','then','456sxalib','end','16ZYgcaA','set','8441350aneTNs','userDataFolder','../../myConfig/config','mapTiles','2151729kZnGuk','dirname','get','258261QncLYY','query','114768tkjitU','prepare','ngeohash','tile.png','../../db/dbFileIndexTable','sendFile','encode','geohash','express','json','body','path','10645pxibou','dbOther','\x20or\x20','1925462HSDiaS','app','length','post','/getZoom','zoom','substring','22MaNZDr','isVip','error','axios','/tile.png','data','/getLocationStr','dbCity','dbFileIndex','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20'];_0x5782=function(){return _0x2de604;};return _0x5782();}function getByGeohash(_0x5306a8,_0x4c0252){const _0x5cea0f=_0x1de798;let _0x404e95=_0x5306a8[_0x5cea0f(0x9e)](_0x5cea0f(0x83))[_0x5cea0f(0x9a)]([_0x4c0252+'%']);return _0x404e95;}function _0xc2f4(_0x3eeb3a,_0x46ab5c){const _0x5782d6=_0x5782();return _0xc2f4=function(_0xc2f469,_0x4750fb){_0xc2f469=_0xc2f469-0x7b;let _0x554346=_0x5782d6[_0xc2f469];return _0x554346;},_0xc2f4(_0x3eeb3a,_0x46ab5c);}function getByGeohashNeighbor(_0x136c07,_0x2d6cd5){const _0x1251e2=_0x1de798;let _0x26576a=ngeohash['neighbors'](_0x2d6cd5),_0x12ce0b='',_0x13bdf5=[];for(let _0x42a689=0x0;_0x42a689<_0x26576a[_0x1251e2(0xae)];_0x42a689++){_0x12ce0b+='\x20geohash\x20like\x20?',_0x13bdf5['push'](_0x26576a[_0x42a689]+'%'),_0x42a689!=_0x26576a['length']-0x1&&(_0x12ce0b+=_0x1251e2(0xab));}let _0xd38bfd=_0x1251e2(0x7e)+_0x12ce0b;return _0x136c07[_0x1251e2(0x9e)](_0xd38bfd)[_0x1251e2(0x9a)](_0x13bdf5);}router[_0x1de798(0x9a)](_0x1de798(0x8b),(_0x187cd0,_0x5a2933,_0xff75ca)=>{const _0x567db7=_0x1de798;let _0x368e01=_0x187cd0['query'][_0x567db7(0xb1)],_0x420d12=_0x187cd0['query']['x'],_0x2cce4a=_0x187cd0[_0x567db7(0x9c)]['y'];if(!_0x368e01||!_0x420d12||!_0x2cce4a)return _0x5a2933['status'](0x194)[_0x567db7(0x91)]();let _0x2fc7e8='https://down.nascab.cn/mapTiles/'+_0x368e01+'/'+_0x420d12+'/'+_0x2cce4a+_0x567db7(0xb7),_0x4dc0fd=path['join'](config[_0x567db7(0x95)],_0x567db7(0x97),_0x368e01,_0x420d12,_0x2cce4a,_0x567db7(0xa0));fs['stat'](_0x4dc0fd,(_0x708937,_0x5c0c2f)=>{const _0x1dea59=_0x567db7;if(_0x708937)axios({'url':_0x2fc7e8,'method':_0x1dea59(0x84),'responseType':_0x1dea59(0x8a)})['then'](_0x12cc1c=>{const _0x4125fa=_0x1dea59;fs[_0x4125fa(0x82)](path[_0x4125fa(0x99)](_0x4dc0fd),{'recursive':!![]},_0x10b50f=>{const _0x186c54=_0x4125fa;let _0x5a5cbd=fs['createWriteStream'](_0x4dc0fd);_0x12cc1c[_0x186c54(0xb8)][_0x186c54(0x8c)](_0x5a5cbd),_0x5a5cbd['on']('finish',()=>{return _0x5a2933['sendFile'](_0x4dc0fd);}),_0x5a5cbd['on'](_0x186c54(0xb5),()=>{const _0xd37f8b=_0x186c54;return _0x5a2933[_0xd37f8b(0x81)](0x194)[_0xd37f8b(0x91)]();});});})[_0x1dea59(0x8e)](_0x512acb=>{const _0x444013=_0x1dea59;return _0x5a2933[_0x444013(0x81)](0x194)[_0x444013(0x91)]();});else return _0x5a2933[_0x1dea59(0x93)](_0x1dea59(0x86),'image/png'),_0x5a2933[_0x1dea59(0xa2)](_0x4dc0fd);});}),router[_0x1de798(0x9a)](_0x1de798(0xb0),(_0x91b809,_0x454c0e,_0x550707)=>{const _0xa02ead=_0x1de798;nasAccountUtil[_0xa02ead(0xb4)](null,_0x91b809['app'][_0xa02ead(0xaa)])[_0xa02ead(0x8f)](_0x2dac9a=>{const _0x502cf8=_0xa02ead;return _0x2dac9a?_0x454c0e['json']({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0x454c0e[_0x502cf8(0xa6)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router[_0x1de798(0xaf)](_0x1de798(0xb0),(_0x3064df,_0x435a08,_0x2a9e94)=>{const _0x2ec4da=_0x1de798;nasAccountUtil[_0x2ec4da(0xb4)](null,_0x3064df[_0x2ec4da(0xad)][_0x2ec4da(0xaa)])[_0x2ec4da(0x8f)](_0x50a6f0=>{const _0x5ab325=_0x2ec4da;return _0x50a6f0?_0x435a08[_0x5ab325(0xa6)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0x435a08[_0x5ab325(0xa6)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router[_0x1de798(0xaf)](_0x1de798(0x7b),(_0x4fb603,_0x40765e,_0x117f3a)=>{const _0x5aaf31=_0x1de798;let _0x4c06d4=_0x4fb603[_0x5aaf31(0xa7)]['lat'],_0x5e0692=_0x4fb603[_0x5aaf31(0xa7)][_0x5aaf31(0x87)],_0x1ede58=_0x4fb603[_0x5aaf31(0xa7)][_0x5aaf31(0x8d)],_0x13f7dc=dbFileIndexTable[_0x5aaf31(0x88)](_0x4fb603[_0x5aaf31(0xad)][_0x5aaf31(0x7d)],_0x1ede58);function _0x52fc08(){const _0x5431c4=_0x5aaf31;return _0x40765e[_0x5431c4(0xa6)]({'code':0x0,'geo':{'name':'','cn_name':'','geohash':''}});}if(!_0x13f7dc&&!_0x4c06d4&&!_0x5e0692)return _0x52fc08();let _0x34fe1f=_0x4fb603['app'][_0x5aaf31(0x7c)],_0xa2e86b='';if(_0x13f7dc)_0xa2e86b=_0x13f7dc[_0x5aaf31(0xa4)];else _0x4c06d4&&_0x5e0692&&(_0xa2e86b=ngeohash[_0x5aaf31(0xa3)](_0x4c06d4,_0x5e0692));if(!_0xa2e86b||_0xa2e86b==_0x5aaf31(0x80))return _0x52fc08();let _0x433bdc=undefined;for(let _0xa85846=0x5;_0xa85846>0x0;_0xa85846--){_0xa2e86b=_0xa2e86b[_0x5aaf31(0xb2)](0x0,_0xa85846),_0x433bdc=getByGeohash(_0x34fe1f,_0xa2e86b);!_0x433bdc&&(_0x433bdc=getByGeohashNeighbor(_0x34fe1f,_0xa2e86b));if(_0x433bdc)break;}return _0x40765e[_0x5aaf31(0xa6)]({'code':0x0,'geo':_0x433bdc});}),module['exports']=router;