const _0x1a702f=_0x1110;(function(_0x29d991,_0x1d14f3){const _0x2bd442=_0x1110,_0x2b1754=_0x29d991();while(!![]){try{const _0xe80950=parseInt(_0x2bd442(0x111))/0x1*(-parseInt(_0x2bd442(0x14b))/0x2)+parseInt(_0x2bd442(0x133))/0x3*(-parseInt(_0x2bd442(0x121))/0x4)+parseInt(_0x2bd442(0x115))/0x5+parseInt(_0x2bd442(0x131))/0x6+parseInt(_0x2bd442(0x12b))/0x7*(parseInt(_0x2bd442(0x14a))/0x8)+parseInt(_0x2bd442(0x13d))/0x9+-parseInt(_0x2bd442(0x12a))/0xa;if(_0xe80950===_0x1d14f3)break;else _0x2b1754['push'](_0x2b1754['shift']());}catch(_0x1ccf5){_0x2b1754['push'](_0x2b1754['shift']());}}}(_0x13a0,0x2a34b));var express=require('express'),router=express[_0x1a702f(0x137)]();let path=require(_0x1a702f(0x140)),fs=require('fs');const dbFileIndexTable=require(_0x1a702f(0x14d)),ngeohash=require(_0x1a702f(0x11e));let config=require(_0x1a702f(0x11a)),axios=require(_0x1a702f(0x129)),nasAccountUtil=require('../utils/nasAccountUtils');function _0x1110(_0x56b82d,_0x3c3720){const _0x13a0dd=_0x13a0();return _0x1110=function(_0x1110fa,_0x3c70e5){_0x1110fa=_0x1110fa-0x111;let _0x200943=_0x13a0dd[_0x1110fa];return _0x200943;},_0x1110(_0x56b82d,_0x3c3720);}function _0x13a0(){const _0x5c9945=['error','1JNMeCV','dirname','status','pipe','1244070pPOfWq','end','undefined','sendFile','catch','../../myConfig/config','get','data','exports','ngeohash','/tile','indexId','1636NeeAoY','mkdir','getById','\x20or\x20','/tile.png','userDataFolder','createWriteStream','zoom','axios','2196170wFUrUZ','2369381aaVoSs','lng','GET','\x20geohash\x20like\x20?','finish','prepare','482970MhyTuD','set','2061rFrUpE','tile.png','/getZoom','dbCity','Router','geohash','post','query','json','then','2790666drljQP','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20','/getLocationStr','path','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash\x20like\x20?','https://down.nascab.cn/mapTiles/','encode','dbOther','image/png','dbFileIndex','neighbors','app','isVip','8yLLOgS','608782WXPWXT','body','../../db/dbFileIndexTable'];_0x13a0=function(){return _0x5c9945;};return _0x13a0();}function getByGeohash(_0x4dbbd8,_0x15ebf4){const _0x16b4e0=_0x1a702f;let _0x36b645=_0x4dbbd8[_0x16b4e0(0x130)](_0x16b4e0(0x141))[_0x16b4e0(0x11b)]([_0x15ebf4+'%']);return _0x36b645;}function getByGeohashNeighbor(_0x3d6e97,_0x149ddb){const _0x154d6e=_0x1a702f;let _0x5501e=ngeohash[_0x154d6e(0x147)](_0x149ddb),_0x41b430='',_0x1ab8b4=[];for(let _0x57edf3=0x0;_0x57edf3<_0x5501e['length'];_0x57edf3++){_0x41b430+=_0x154d6e(0x12e),_0x1ab8b4['push'](_0x5501e[_0x57edf3]+'%'),_0x57edf3!=_0x5501e['length']-0x1&&(_0x41b430+=_0x154d6e(0x124));}let _0x4b6fc9=_0x154d6e(0x13e)+_0x41b430;return _0x3d6e97['prepare'](_0x4b6fc9)[_0x154d6e(0x11b)](_0x1ab8b4);}router[_0x1a702f(0x11b)](_0x1a702f(0x11f),(_0x329d68,_0x4da874,_0x18739c)=>{const _0x1f5b9c=_0x1a702f;let _0x5415a2=_0x329d68[_0x1f5b9c(0x13a)][_0x1f5b9c(0x128)],_0x39d9f8=_0x329d68[_0x1f5b9c(0x13a)]['x'],_0x76ad31=_0x329d68['query']['y'];if(!_0x5415a2||!_0x39d9f8||!_0x76ad31)return _0x4da874[_0x1f5b9c(0x113)](0x194)[_0x1f5b9c(0x116)]();let _0x9ebf3e=_0x1f5b9c(0x142)+_0x5415a2+'/'+_0x39d9f8+'/'+_0x76ad31+_0x1f5b9c(0x125),_0x47ed45=path['join'](config[_0x1f5b9c(0x126)],'mapTiles',_0x5415a2,_0x39d9f8,_0x76ad31,_0x1f5b9c(0x134));fs['stat'](_0x47ed45,(_0x13a8f5,_0x17cba8)=>{const _0x5c6bb7=_0x1f5b9c;if(_0x13a8f5)axios({'url':_0x9ebf3e,'method':_0x5c6bb7(0x12d),'responseType':'stream'})[_0x5c6bb7(0x13c)](_0x213889=>{const _0x2c82f2=_0x5c6bb7;fs[_0x2c82f2(0x122)](path[_0x2c82f2(0x112)](_0x47ed45),{'recursive':!![]},_0x168750=>{const _0x1d1a99=_0x2c82f2;let _0x297ffd=fs[_0x1d1a99(0x127)](_0x47ed45);_0x213889[_0x1d1a99(0x11c)][_0x1d1a99(0x114)](_0x297ffd),_0x297ffd['on'](_0x1d1a99(0x12f),()=>{const _0xcec909=_0x1d1a99;return _0x4da874[_0xcec909(0x118)](_0x47ed45);}),_0x297ffd['on'](_0x1d1a99(0x14e),()=>{const _0x25fee8=_0x1d1a99;return _0x4da874[_0x25fee8(0x113)](0x194)[_0x25fee8(0x116)]();});});})[_0x5c6bb7(0x119)](_0x11339d=>{const _0xb53a2b=_0x5c6bb7;return _0x4da874[_0xb53a2b(0x113)](0x194)[_0xb53a2b(0x116)]();});else return _0x4da874[_0x5c6bb7(0x132)]('Content-Type',_0x5c6bb7(0x145)),_0x4da874[_0x5c6bb7(0x118)](_0x47ed45);});}),router['get'](_0x1a702f(0x135),(_0xa5a039,_0x42b0c5,_0x28a9a2)=>{const _0x36ddb3=_0x1a702f;nasAccountUtil[_0x36ddb3(0x149)](null,_0xa5a039['app'][_0x36ddb3(0x144)])[_0x36ddb3(0x13c)](_0x5952e0=>{const _0x32d43b=_0x36ddb3;return _0x5952e0?_0x42b0c5[_0x32d43b(0x13b)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0x42b0c5['json']({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router[_0x1a702f(0x139)](_0x1a702f(0x135),(_0x300623,_0x40737e,_0x187e0c)=>{const _0x344dd5=_0x1a702f;nasAccountUtil['isVip'](null,_0x300623[_0x344dd5(0x148)]['dbOther'])[_0x344dd5(0x13c)](_0x323e3a=>{const _0x35bcc5=_0x344dd5;return _0x323e3a?_0x40737e['json']({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0x40737e[_0x35bcc5(0x13b)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router['post'](_0x1a702f(0x13f),(_0x5932bd,_0x29b764,_0x3b4951)=>{const _0xc8efe7=_0x1a702f;let _0x58f66a=_0x5932bd[_0xc8efe7(0x14c)]['lat'],_0x1332af=_0x5932bd['body'][_0xc8efe7(0x12c)],_0x21fc05=_0x5932bd[_0xc8efe7(0x14c)][_0xc8efe7(0x120)],_0xe57b3f=dbFileIndexTable[_0xc8efe7(0x123)](_0x5932bd['app'][_0xc8efe7(0x146)],_0x21fc05);function _0x341a07(){const _0x374638=_0xc8efe7;return _0x29b764[_0x374638(0x13b)]({'code':0x0,'geo':{'name':'','cn_name':'','geohash':''}});}if(!_0xe57b3f&&!_0x58f66a&&!_0x1332af)return _0x341a07();let _0x572a8e=_0x5932bd[_0xc8efe7(0x148)][_0xc8efe7(0x136)],_0x208190='';if(_0xe57b3f)_0x208190=_0xe57b3f[_0xc8efe7(0x138)];else _0x58f66a&&_0x1332af&&(_0x208190=ngeohash[_0xc8efe7(0x143)](_0x58f66a,_0x1332af));if(!_0x208190||_0x208190==_0xc8efe7(0x117))return _0x341a07();let _0x4bbbca=undefined;for(let _0x1197b4=0x5;_0x1197b4>0x0;_0x1197b4--){_0x208190=_0x208190['substring'](0x0,_0x1197b4),_0x4bbbca=getByGeohash(_0x572a8e,_0x208190);!_0x4bbbca&&(_0x4bbbca=getByGeohashNeighbor(_0x572a8e,_0x208190));if(_0x4bbbca)break;}return _0x29b764[_0xc8efe7(0x13b)]({'code':0x0,'geo':_0x4bbbca});}),module[_0x1a702f(0x11d)]=router;