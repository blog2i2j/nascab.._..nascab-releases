const _0x38bf0c=_0x380d;(function(_0x2a4391,_0x484080){const _0x2bb909=_0x380d,_0x2f1b10=_0x2a4391();while(!![]){try{const _0x4d6fee=-parseInt(_0x2bb909(0x10e))/0x1+-parseInt(_0x2bb909(0xf4))/0x2+parseInt(_0x2bb909(0x101))/0x3+parseInt(_0x2bb909(0x114))/0x4*(-parseInt(_0x2bb909(0x10f))/0x5)+parseInt(_0x2bb909(0xf7))/0x6*(-parseInt(_0x2bb909(0x113))/0x7)+-parseInt(_0x2bb909(0xfa))/0x8+parseInt(_0x2bb909(0x122))/0x9;if(_0x4d6fee===_0x484080)break;else _0x2f1b10['push'](_0x2f1b10['shift']());}catch(_0x21b521){_0x2f1b10['push'](_0x2f1b10['shift']());}}}(_0x2fad,0xdf8cb));var express=require(_0x38bf0c(0xf3)),router=express[_0x38bf0c(0xf5)]();let path=require(_0x38bf0c(0x112)),fs=require('fs');const dbFileIndexTable=require(_0x38bf0c(0x10b)),ngeohash=require(_0x38bf0c(0x116));let config=require(_0x38bf0c(0x11f)),axios=require('axios'),nasAccountUtil=require(_0x38bf0c(0x104));function getByGeohash(_0x4ae3f0,_0x500810){const _0x64d4c3=_0x38bf0c;let _0x24e87e=_0x4ae3f0['prepare'](_0x64d4c3(0x118))[_0x64d4c3(0x107)]([_0x500810+'%']);return _0x24e87e;}function _0x380d(_0x849dc1,_0x320978){const _0x2fad5a=_0x2fad();return _0x380d=function(_0x380d76,_0x4aa1d5){_0x380d76=_0x380d76-0xea;let _0x2b7843=_0x2fad5a[_0x380d76];return _0x2b7843;},_0x380d(_0x849dc1,_0x320978);}function _0x2fad(){const _0x3cf1bc=['stream','37679202ahAetD','dbOther','/getLocationStr','undefined','length','dirname','tile.png','image/png','finish','geohash','express','3623984YQSkRD','Router','mapTiles','3756lKnqQQ','mkdir','\x20geohash\x20like\x20?','2100232KBKEWA','lat','push','\x20or\x20','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20','query','lng','1234437QRltYn','json','/getZoom','../utils/nasAccountUtils','userDataFolder','data','get','status','post','getById','../../db/dbFileIndexTable','app','substring','1063499FlcTIm','45cbEWZa','/tile.png','/tile','path','2261TESfNI','152080SQEGdg','https://down.nascab.cn/mapTiles/','ngeohash','body','SELECT\x20name,cn_name,geohash\x20FROM\x20cities\x20WHERE\x20geohash\x20like\x20?','sendFile','then','neighbors','catch','end','isVip','../../myConfig/config','GET'];_0x2fad=function(){return _0x3cf1bc;};return _0x2fad();}function getByGeohashNeighbor(_0x3901c1,_0x5e1ec1){const _0x73c677=_0x38bf0c;let _0x3330ad=ngeohash[_0x73c677(0x11b)](_0x5e1ec1),_0x1d3c7c='',_0xcd1074=[];for(let _0x37ec54=0x0;_0x37ec54<_0x3330ad['length'];_0x37ec54++){_0x1d3c7c+=_0x73c677(0xf9),_0xcd1074[_0x73c677(0xfc)](_0x3330ad[_0x37ec54]+'%'),_0x37ec54!=_0x3330ad[_0x73c677(0xed)]-0x1&&(_0x1d3c7c+=_0x73c677(0xfd));}let _0x18e25a=_0x73c677(0xfe)+_0x1d3c7c;return _0x3901c1['prepare'](_0x18e25a)[_0x73c677(0x107)](_0xcd1074);}router[_0x38bf0c(0x107)](_0x38bf0c(0x111),(_0x5d8ae1,_0x2e0be3,_0x3db09b)=>{const _0xe5f0c5=_0x38bf0c;let _0x19801f=_0x5d8ae1['query']['zoom'],_0x16b2a6=_0x5d8ae1[_0xe5f0c5(0xff)]['x'],_0x5bd284=_0x5d8ae1[_0xe5f0c5(0xff)]['y'];if(!_0x19801f||!_0x16b2a6||!_0x5bd284)return _0x2e0be3[_0xe5f0c5(0x108)](0x194)[_0xe5f0c5(0x11d)]();let _0x54429e=_0xe5f0c5(0x115)+_0x19801f+'/'+_0x16b2a6+'/'+_0x5bd284+_0xe5f0c5(0x110),_0x411fd7=path['join'](config[_0xe5f0c5(0x105)],_0xe5f0c5(0xf6),_0x19801f,_0x16b2a6,_0x5bd284,_0xe5f0c5(0xef));fs['stat'](_0x411fd7,(_0x7d7811,_0x3f4fa3)=>{const _0x5e3ee5=_0xe5f0c5;if(_0x7d7811)axios({'url':_0x54429e,'method':_0x5e3ee5(0x120),'responseType':_0x5e3ee5(0x121)})[_0x5e3ee5(0x11a)](_0x41ec04=>{const _0x3e2819=_0x5e3ee5;fs[_0x3e2819(0xf8)](path[_0x3e2819(0xee)](_0x411fd7),{'recursive':!![]},_0x3dc451=>{const _0x62e138=_0x3e2819;let _0x1fe99b=fs['createWriteStream'](_0x411fd7);_0x41ec04[_0x62e138(0x106)]['pipe'](_0x1fe99b),_0x1fe99b['on'](_0x62e138(0xf1),()=>{const _0xdff658=_0x62e138;return _0x2e0be3[_0xdff658(0x119)](_0x411fd7);}),_0x1fe99b['on']('error',()=>{const _0x867e75=_0x62e138;return _0x2e0be3[_0x867e75(0x108)](0x194)[_0x867e75(0x11d)]();});});})[_0x5e3ee5(0x11c)](_0x8ed526=>{return _0x2e0be3['status'](0x194)['end']();});else return _0x2e0be3['set']('Content-Type',_0x5e3ee5(0xf0)),_0x2e0be3[_0x5e3ee5(0x119)](_0x411fd7);});}),router['get'](_0x38bf0c(0x103),(_0x707471,_0x431f8f,_0x272ceb)=>{const _0x5cf282=_0x38bf0c;nasAccountUtil[_0x5cf282(0x11e)](null,_0x707471['app'][_0x5cf282(0xea)])[_0x5cf282(0x11a)](_0x5778ab=>{const _0x4c65a7=_0x5cf282;return _0x5778ab?_0x431f8f[_0x4c65a7(0x102)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0x431f8f[_0x4c65a7(0x102)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router['post'](_0x38bf0c(0x103),(_0x1881e5,_0x151f5d,_0x9eae8f)=>{const _0x194795=_0x38bf0c;nasAccountUtil[_0x194795(0x11e)](null,_0x1881e5[_0x194795(0x10c)][_0x194795(0xea)])['then'](_0x26f311=>{const _0x24fcdf=_0x194795;return _0x26f311?_0x151f5d['json']({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0xc}}):_0x151f5d[_0x24fcdf(0x102)]({'code':0x0,'zoomInfo':{'minZoom':0x2,'maxZoom':0x8}});});}),router[_0x38bf0c(0x109)](_0x38bf0c(0xeb),(_0x48874a,_0xfb9738,_0x25e673)=>{const _0x16e3b2=_0x38bf0c;let _0x249398=_0x48874a[_0x16e3b2(0x117)][_0x16e3b2(0xfb)],_0x4c4bfa=_0x48874a[_0x16e3b2(0x117)][_0x16e3b2(0x100)],_0x4e7cc5=_0x48874a[_0x16e3b2(0x117)]['indexId'],_0x28c3fe=dbFileIndexTable[_0x16e3b2(0x10a)](_0x48874a['app']['dbFileIndex'],_0x4e7cc5);function _0x1121f8(){const _0x456a2d=_0x16e3b2;return _0xfb9738[_0x456a2d(0x102)]({'code':0x0,'geo':{'name':'','cn_name':'','geohash':''}});}if(!_0x28c3fe&&!_0x249398&&!_0x4c4bfa)return _0x1121f8();let _0x1a86d5=_0x48874a[_0x16e3b2(0x10c)]['dbCity'],_0x245923='';if(_0x28c3fe)_0x245923=_0x28c3fe[_0x16e3b2(0xf2)];else _0x249398&&_0x4c4bfa&&(_0x245923=ngeohash['encode'](_0x249398,_0x4c4bfa));if(!_0x245923||_0x245923==_0x16e3b2(0xec))return _0x1121f8();let _0x382d37=undefined;for(let _0x2199e5=0x5;_0x2199e5>0x0;_0x2199e5--){_0x245923=_0x245923[_0x16e3b2(0x10d)](0x0,_0x2199e5),_0x382d37=getByGeohash(_0x1a86d5,_0x245923);!_0x382d37&&(_0x382d37=getByGeohashNeighbor(_0x1a86d5,_0x245923));if(_0x382d37)break;}return _0xfb9738[_0x16e3b2(0x102)]({'code':0x0,'geo':_0x382d37});}),module['exports']=router;