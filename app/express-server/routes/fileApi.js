const _0x10bb17=_0x43a5;function _0x41fb(){const _0x22b0a6=['16cotnqc','endsWith','cachePath','tiny_path','../../db/dbMusicIndexTable','returnFileError','rawImgTypeList','/getInfo','../../db/dbUserTable','serverType','deletePathAll','../../db/dbFileIndexTable','getTime','/inOutTrash','8733324jvcQAp','53650jiNyty','updateById','getIndexTableNameByType','Content-Disposition','toLowerCase','930684ouGzHy','existsSync','music','operation\x20fail','join','file\x20not\x20found','attachment;\x20filename*=UTF-8\x27\x27','STATE_FAIL','set','is_livephoto','videoTypeList','../utils/fileUtils','code','transToMp3','express','imgTypeList','status','addFileOperationRecord','.txt','parse','prepare','type','fullPath','includes','params\x20is\x20not\x20valid','exifr','UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?','6646040xRJZQH','json','/clearTinyImg','8jJgMnL','quality','.MOV','raw_filename','5045305tWTDNr','then','query','../../utils/musicTransCodeUtil','toUpperCase','photo','dbFileIndex','46807673hBdlEk','basename','download','/rawFile*','isFile','sendStatus','.MP4','replace','exports','returnDealedFile','check_time','get','username','delete','setHeader','ids','sendFile','video','size','TYPE_DELETE','is_file','raw','extname','length','340036OTsKhQ','doUserCanGet','sep','stat','7UAUhIR','path','body','power_delete','changes','updatePlayTime','indexId','Convert\x20to\x20utf8\x20','putInSystemTrash','utf8','currentUser','pipe','power_get','push','.HEIC','getFileHashName','deleteIndexFolder','decodePath','Router','exifInfo','../../utils/encodingUtil','image','dbOther','log','../../myConfig/config','LEVEL_MAIN_OPERATION','Unable\x20to\x20read\x20file','end','dirname','post','/rawFileByPath*','send','1557PUoCUD','catch','filename','run','app'];_0x41fb=function(){return _0x22b0a6;};return _0x41fb();}(function(_0x40207c,_0x2de7a3){const _0x13c897=_0x43a5,_0x36edaa=_0x40207c();while(!![]){try{const _0xa2d557=parseInt(_0x13c897(0x196))/0x1*(parseInt(_0x13c897(0x173))/0x2)+-parseInt(_0x13c897(0x155))/0x3*(-parseInt(_0x13c897(0x141))/0x4)+parseInt(_0x13c897(0x177))/0x5+-parseInt(_0x13c897(0x14f))/0x6*(-parseInt(_0x13c897(0x19a))/0x7)+-parseInt(_0x13c897(0x170))/0x8+-parseInt(_0x13c897(0x13c))/0x9*(-parseInt(_0x13c897(0x150))/0xa)+-parseInt(_0x13c897(0x17e))/0xb;if(_0xa2d557===_0x2de7a3)break;else _0x36edaa['push'](_0x36edaa['shift']());}catch(_0x4d844f){_0x36edaa['push'](_0x36edaa['shift']());}}}(_0x41fb,0xdda2a));let express=require(_0x10bb17(0x163)),router=express[_0x10bb17(0x1ac)](),path=require(_0x10bb17(0x19b)),fs=require('fs');const sharp=require('sharp');let sharpUtil=require('../utils/sharpUtils'),exifUtil=require(_0x10bb17(0x16e)),fileUtil=require(_0x10bb17(0x160));const config=require(_0x10bb17(0x1b2)),dbFileIndexTable=require(_0x10bb17(0x14c)),dbFileOperationRecord=require('../../db/dbFileOperationRecord'),dbUserTable=require(_0x10bb17(0x149)),dbMusicIndexTable=require(_0x10bb17(0x145));let musicTransCodeUtil=require(_0x10bb17(0x17a));const encodingUtil=require(_0x10bb17(0x1ae));function getIndexTableName(_0x539d8b){const _0x5726a8=_0x10bb17;let _0xa17b3=dbFileIndexTable[_0x5726a8(0x152)](_0x539d8b);return _0xa17b3;}function getIndexObj(_0x455e40,_0x23587d){const _0x16b41e=_0x10bb17;let _0x1e5bb1=_0x455e40['body'][_0x16b41e(0x14a)]||_0x455e40[_0x16b41e(0x179)]['serverType'],_0x4a2e51=getIndexTableName(_0x1e5bb1);return dbFileIndexTable['getById'](_0x455e40[_0x16b41e(0x140)][_0x16b41e(0x17d)],_0x23587d,_0x4a2e51);}router[_0x10bb17(0x139)](_0x10bb17(0x14e),(_0x2cea5,_0x154373,_0x396311)=>{const _0x52de1b=_0x10bb17;let _0x1c5942=_0x2cea5[_0x52de1b(0x19c)][_0x52de1b(0x18d)],_0x3b3d2d=_0x2cea5[_0x52de1b(0x19c)]['trash'];if(dbUserTable[_0x52de1b(0x197)](_0x2cea5,_0x154373,_0x52de1b(0x17c),_0x52de1b(0x19d))==!![]){if(_0x1c5942&&_0x1c5942['length']>0x0){let _0x4254aa='(';for(let _0xba9213=0x0;_0xba9213<_0x1c5942[_0x52de1b(0x195)];_0xba9213++){let _0x35ce0e=getIndexObj(_0x2cea5,_0x1c5942[_0xba9213]);if(!_0x35ce0e)continue;_0x35ce0e[_0x52de1b(0x176)]!=null&&_0x35ce0e[_0x52de1b(0x176)]!=''&&_0x35ce0e[_0x52de1b(0x192)]&&(_0x3b3d2d==0x1?_0x2cea5[_0x52de1b(0x140)][_0x52de1b(0x17d)][_0x52de1b(0x169)](_0x52de1b(0x16f))[_0x52de1b(0x13f)](_0x35ce0e[_0x52de1b(0x19b)],_0x35ce0e[_0x52de1b(0x176)]):_0x2cea5[_0x52de1b(0x140)][_0x52de1b(0x17d)][_0x52de1b(0x169)]('UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?')[_0x52de1b(0x13f)](_0x35ce0e[_0x52de1b(0x19b)],_0x35ce0e['raw_filename'])),_0x4254aa+=_0x1c5942[_0xba9213],_0xba9213!=_0x1c5942[_0x52de1b(0x195)]-0x1&&(_0x4254aa+=',');}_0x4254aa+=')';let _0x5c3b32=dbFileIndexTable['inOutTrash'](_0x2cea5[_0x52de1b(0x140)][_0x52de1b(0x17d)],_0x4254aa,_0x3b3d2d,getIndexTableName(_0x2cea5['body'][_0x52de1b(0x14a)]));_0x5c3b32[_0x52de1b(0x19e)]>0x0&&_0x154373['json']({'code':0x0,'count':_0x5c3b32[_0x52de1b(0x19e)]});}else{_0x154373[_0x52de1b(0x171)]({'code':0x1,'message':_0x52de1b(0x16d)});return;}}}),router['post']('/deleteFromDisk',(_0x19c9d3,_0x538722,_0x46ef2d)=>{const _0x4b9b78=_0x10bb17;let _0x2b22ab=_0x19c9d3[_0x4b9b78(0x19c)][_0x4b9b78(0x18d)],_0x293ce4=_0x19c9d3['body'][_0x4b9b78(0x14a)],_0xfa062=_0x19c9d3[_0x4b9b78(0x19c)][_0x4b9b78(0x1aa)]==0x1,_0x1209b9=_0x19c9d3['body']['ignoreLivephoto']==0x1,_0x46f150=_0x19c9d3[_0x4b9b78(0x19c)][_0x4b9b78(0x1a2)],_0x4edc4a=getIndexTableName(_0x293ce4);function _0xb1abcc(_0x394f3c,_0x11f5a0){const _0x3db803=_0x4b9b78;dbFileOperationRecord[_0x3db803(0x166)](_0x19c9d3[_0x3db803(0x140)][_0x3db803(0x1b0)],{'username':_0x19c9d3[_0x3db803(0x1a4)][_0x3db803(0x18a)],'targetPath':_0x394f3c,'level':dbFileOperationRecord[_0x3db803(0x135)],'type':dbFileOperationRecord[_0x3db803(0x191)],'state':_0x11f5a0?dbFileOperationRecord['STATE_SUC']:dbFileOperationRecord[_0x3db803(0x15c)]});}function _0x1d6b34(_0x1f5cde){const _0x47af3f=_0x4b9b78;if(_0x1f5cde[_0x47af3f(0x192)]==0x1&&_0x1f5cde[_0x47af3f(0x15e)]==0x1){let _0x5157d8=path[_0x47af3f(0x159)](_0x1f5cde['path'],_0x1f5cde['filename'][_0x47af3f(0x185)](_0x47af3f(0x175),'')+_0x47af3f(0x1a8));_0x1f5cde[_0x47af3f(0x13e)][_0x47af3f(0x142)](_0x47af3f(0x184))&&(_0x5157d8=path['join'](_0x1f5cde[_0x47af3f(0x19b)],_0x1f5cde[_0x47af3f(0x13e)][_0x47af3f(0x185)](_0x47af3f(0x184),'')+'.JPG')),fs[_0x47af3f(0x156)](_0x5157d8)&&_0x43afe6(_0x1f5cde,_0x5157d8,![]);}}function _0x43afe6(_0x520c3e,_0x363363,_0x520594){const _0x3b9c69=_0x4b9b78;_0x46f150==0x1?(process[_0x3b9c69(0x13b)]({'type':'shell','shellType':'trash','path':_0x363363}),_0xb1abcc(_0x363363,!![])):fs['rm'](_0x363363,{'recursive':!![]},_0x5cb95b=>{_0x5cb95b?_0xb1abcc(_0x363363,![]):_0xb1abcc(_0x363363,!![]);}),_0x520594&&_0x1d6b34(_0x520c3e);}function _0x3a9963(_0x50b4b2){const _0x56b3c9=_0x4b9b78;dbFileIndexTable[_0x56b3c9(0x18b)](_0x19c9d3[_0x56b3c9(0x140)][_0x56b3c9(0x17d)],_0x50b4b2,_0x4edc4a);}function _0x30b6e8(_0x2acb1d,_0xfc5a04){const _0x37d1c3=_0x4b9b78;if(!_0xfc5a04)return;dbFileIndexTable[_0x37d1c3(0x18b)](_0x19c9d3[_0x37d1c3(0x140)][_0x37d1c3(0x17d)],_0x2acb1d,_0x4edc4a);let _0x40a9de=dbFileIndexTable[_0x37d1c3(0x14b)](_0x19c9d3[_0x37d1c3(0x140)]['dbFileIndex'],_0xfc5a04,_0x4edc4a);}if(_0x2b22ab&&_0x2b22ab[_0x4b9b78(0x195)]>0x0){let _0x31625f=0x0,_0x29359d=0x0,_0x29f565=[];for(let _0x5c1767=0x0;_0x5c1767<_0x2b22ab[_0x4b9b78(0x195)];_0x5c1767++){let _0x174c96=_0x2b22ab[_0x5c1767],_0x419f25=getIndexObj(_0x19c9d3,_0x174c96,_0x4edc4a);if(_0x419f25){if(dbUserTable['doUserCanGet'](_0x19c9d3,_0x538722,_0x293ce4,_0x4b9b78(0x19d),_0x419f25['path'])==!![]){_0x31625f+=0x1,_0x29f565[_0x4b9b78(0x1a7)](_0x174c96);let _0x359c8c=path[_0x4b9b78(0x159)](_0x419f25[_0x4b9b78(0x19b)],path[_0x4b9b78(0x198)],_0x419f25[_0x4b9b78(0x13e)]),_0x423944=_0x419f25[_0x4b9b78(0x192)]==0x0;_0xfa062&&(_0x359c8c=_0x419f25[_0x4b9b78(0x19b)],_0x423944=!![]),_0x423944?_0x30b6e8(_0x174c96,_0x359c8c):_0x3a9963(_0x174c96),_0x43afe6(_0x419f25,_0x359c8c,!_0x1209b9);}else _0x29359d+=0x1;}}return _0x538722[_0x4b9b78(0x171)]({'code':0x0,'deletedIds':_0x29f565,'deleteCount':_0x31625f,'errCount':_0x29359d});}else return _0x19c9d3[_0x4b9b78(0x140)]['returnErrMsg'](_0x538722,_0x4b9b78(0x16d));});function genTinyForFilePath(_0x382967,_0x846068,_0x44d72f,_0x599c21){const _0x426c32=_0x10bb17;let _0x304e5a=path['extname'](_0x846068)?path['extname'](_0x846068)[_0x426c32(0x154)]():null,_0x118f6b=![];if(config[_0x426c32(0x164)][_0x426c32(0x16c)](_0x304e5a)||config[_0x426c32(0x147)]['includes'](_0x304e5a['toLowerCase']()))_0x118f6b=_0x426c32(0x1af);else{if(config[_0x426c32(0x15f)][_0x426c32(0x16c)](_0x304e5a))_0x118f6b=_0x426c32(0x18f);else return _0x382967[_0x426c32(0x165)](0x194)[_0x426c32(0x137)]();}sharpUtil['genTinyFile'](_0x846068,path[_0x426c32(0x138)](_0x44d72f),path['basename'](_0x44d72f),_0x118f6b,null,_0x57c1c7=>{const _0x18e0bb=_0x426c32;_0x382967[_0x18e0bb(0x18e)](_0x57c1c7);},_0x1daaac=>{const _0x94c5ae=_0x426c32;return _0x382967[_0x94c5ae(0x165)](0x194)[_0x94c5ae(0x137)]();},_0x599c21);}function _0x43a5(_0x13d950,_0x3cf117){const _0x41fb11=_0x41fb();return _0x43a5=function(_0x43a528,_0x5cccad){_0x43a528=_0x43a528-0x135;let _0x24258e=_0x41fb11[_0x43a528];return _0x24258e;},_0x43a5(_0x13d950,_0x3cf117);}function genTiny(_0x3431e5,_0x3f834a,_0x283b77,_0x57d5d3,_0x24bf57,_0x380d13){const _0x6faf4c=_0x10bb17;let _0x3f7717=_0x6faf4c(0x1af);_0x57d5d3[_0x6faf4c(0x16a)]==0x2&&(_0x3f7717=_0x6faf4c(0x18f)),sharpUtil['genTinyFile'](_0x283b77,path[_0x6faf4c(0x138)](_0x380d13),path[_0x6faf4c(0x17f)](_0x380d13),_0x3f7717,_0x57d5d3,_0x271055=>{const _0x32944b=_0x6faf4c;dbFileIndexTable[_0x32944b(0x151)](_0x3f834a,_0x57d5d3['id'],'tiny_path',_0x271055,_0x24bf57),_0x3431e5[_0x32944b(0x18e)](_0x271055);},_0x266e62=>{const _0xe8f9ed=_0x6faf4c;return _0x3431e5[_0xe8f9ed(0x165)](0x194)[_0xe8f9ed(0x137)]();});}router[_0x10bb17(0x189)](_0x10bb17(0x13a),(_0x50f4ba,_0x451569,_0x4e87d2)=>{const _0x1a5693=_0x10bb17;let _0xb1c4d2=_0x50f4ba['query'][_0x1a5693(0x16b)];_0xb1c4d2=fileUtil['decodePath'](_0xb1c4d2);let _0x434b27=_0x50f4ba[_0x1a5693(0x179)][_0x1a5693(0x180)]==0x1,_0x1f9c6a=_0x50f4ba[_0x1a5693(0x179)][_0x1a5693(0x190)],_0xe823d0=_0x50f4ba[_0x1a5693(0x179)][_0x1a5693(0x174)];fs[_0x1a5693(0x199)](_0xb1c4d2,(_0x428fb4,_0xff3a29)=>{const _0x4249c5=_0x1a5693;if(_0x428fb4)return _0x451569[_0x4249c5(0x183)](0x194);if(dbUserTable[_0x4249c5(0x197)](_0x50f4ba,_0x451569,'','power_get',_0xb1c4d2)==!![])try{let _0x1dc860=_0x50f4ba[_0x4249c5(0x179)][_0x4249c5(0x193)];if(_0x1dc860&&_0x1dc860==0x1){if(_0x434b27){const _0x184609=encodeURIComponent(path['basename'](_0xb1c4d2))[_0x4249c5(0x185)](/%([0-9A-F]{2})/g,(_0x5a2c1e,_0x3104dc)=>'%'+_0x3104dc['toUpperCase']());_0x451569['setHeader'](_0x4249c5(0x153),'attachment;\x20filename*=UTF-8\x27\x27'+_0x184609);}return _0x451569[_0x4249c5(0x18e)](_0xb1c4d2);}sharpUtil[_0x4249c5(0x187)](_0x451569,_0xb1c4d2,_0x434b27,_0x1f9c6a,_0xe823d0);}catch(_0x3e4719){return _0x451569[_0x4249c5(0x165)](0x194)[_0x4249c5(0x137)]();}});}),router['get']('/tinyImgByPath*',(_0x5112f0,_0xbf0b1f,_0x4d279b)=>{const _0x454fed=_0x10bb17;let _0x214efc=_0x5112f0[_0x454fed(0x179)]['fullPath'];_0x214efc=fileUtil[_0x454fed(0x1ab)](_0x214efc);let _0x5e58f1=_0x5112f0[_0x454fed(0x179)][_0x454fed(0x190)];fs[_0x454fed(0x199)](_0x214efc,(_0x1b372b,_0x589a7b)=>{const _0x261aca=_0x454fed;if(_0x1b372b)return _0xbf0b1f[_0x261aca(0x183)](0x194);config['getFileHashNameByPathAndStat'](_0x5e58f1,_0x214efc,_0x2d992b=>{const _0x5ae964=_0x261aca;if(!_0x2d992b)return _0xbf0b1f[_0x5ae964(0x183)](0x194);let _0x4b4226=path[_0x5ae964(0x159)](config[_0x5ae964(0x143)],_0x2d992b);dbUserTable[_0x5ae964(0x197)](_0x5112f0,_0xbf0b1f,'','power_get',_0x214efc,!![])==!![]&&fs['stat'](_0x4b4226,(_0x1447ed,_0x4727e3)=>{const _0xeb593d=_0x5ae964;if(_0x1447ed)return genTinyForFilePath(_0xbf0b1f,_0x214efc,_0x4b4226,_0x5e58f1);return _0x4727e3[_0xeb593d(0x182)]()?_0xbf0b1f[_0xeb593d(0x18e)](_0x4b4226):genTinyForFilePath(_0xbf0b1f,_0x214efc,_0x4b4226,_0x5e58f1);});});});}),router[_0x10bb17(0x189)]('/tinyImg*',(_0x3697d6,_0x4dbed4,_0x50a24c)=>{const _0x479835=_0x10bb17;let _0x1159ac=_0x3697d6[_0x479835(0x179)][_0x479835(0x1a0)],_0x4ae360=_0x3697d6['query'][_0x479835(0x14a)],_0xde62ae=getIndexTableName(_0x4ae360),_0x4c2483=getIndexObj(_0x3697d6,_0x1159ac);if(!_0x4c2483)return _0x4dbed4[_0x479835(0x165)](0x194)[_0x479835(0x137)]();let _0x4a2d54=config[_0x479835(0x1a9)](_0x4c2483),_0x45b976=path[_0x479835(0x159)](config[_0x479835(0x143)],_0x4a2d54);if(dbUserTable[_0x479835(0x197)](_0x3697d6,_0x4dbed4,_0x4ae360,'power_get',_0x4c2483[_0x479835(0x19b)])==!![]){let _0x2895b2=path[_0x479835(0x159)](_0x4c2483[_0x479835(0x19b)],path[_0x479835(0x198)],_0x4c2483[_0x479835(0x13e)]);fs[_0x479835(0x199)](_0x2895b2,(_0x4c12bd,_0x22e5d3)=>{const _0x1b6ca8=_0x479835;if(_0x4c12bd)return!_0x4c2483[_0x1b6ca8(0x144)]?_0x4dbed4['status'](0x194)['end']():fs[_0x1b6ca8(0x199)](_0x4c2483[_0x1b6ca8(0x144)],(_0x5c06a9,_0x1453c2)=>{const _0x17ffc0=_0x1b6ca8;return _0x5c06a9||_0x1453c2&&!_0x1453c2[_0x17ffc0(0x182)]()?_0x4dbed4[_0x17ffc0(0x165)](0x194)[_0x17ffc0(0x137)]():_0x4dbed4[_0x17ffc0(0x18e)](_0x4c2483[_0x17ffc0(0x144)]);});if(!_0x22e5d3['isFile']())return _0x4dbed4[_0x1b6ca8(0x165)](0x194)[_0x1b6ca8(0x137)]();!_0x4c2483[_0x1b6ca8(0x144)]?fs['stat'](_0x45b976,(_0x53f4df,_0x1f886a)=>{const _0x5a12dd=_0x1b6ca8;if(_0x53f4df)return genTiny(_0x4dbed4,_0x3697d6['app'][_0x5a12dd(0x17d)],_0x2895b2,_0x4c2483,_0xde62ae,_0x45b976);return _0x1f886a[_0x5a12dd(0x182)]()&&_0x1f886a[_0x5a12dd(0x190)]>0x7d0?(dbFileIndexTable['updateById'](_0x3697d6[_0x5a12dd(0x140)][_0x5a12dd(0x17d)],_0x4c2483['id'],_0x5a12dd(0x144),_0x45b976,_0xde62ae),_0x4dbed4[_0x5a12dd(0x18e)](_0x45b976)):genTiny(_0x4dbed4,_0x3697d6['app'][_0x5a12dd(0x17d)],_0x2895b2,_0x4c2483,_0xde62ae,_0x45b976);}):fs[_0x1b6ca8(0x199)](_0x4c2483[_0x1b6ca8(0x144)],(_0x3908dc,_0x13914d)=>{const _0x48b822=_0x1b6ca8;return _0x3908dc||!_0x13914d['isFile']()?genTiny(_0x4dbed4,_0x3697d6[_0x48b822(0x140)][_0x48b822(0x17d)],_0x2895b2,_0x4c2483,_0xde62ae,_0x45b976):_0x4dbed4[_0x48b822(0x18e)](_0x4c2483[_0x48b822(0x144)]);});});}}),router['get'](_0x10bb17(0x181),(_0x174606,_0x2309f1,_0x54c7ea)=>{const _0x112938=_0x10bb17;let _0x38b87d=_0x174606[_0x112938(0x179)][_0x112938(0x1a0)],_0x349f95=_0x174606[_0x112938(0x179)]['serverType'],_0x1416f5=getIndexObj(_0x174606,_0x38b87d),_0x434993=getIndexTableName(_0x349f95),_0x3c47a2=_0x174606['query'][_0x112938(0x180)]==0x1,_0x558f54=_0x174606[_0x112938(0x179)][_0x112938(0x190)],_0x4c2876=_0x174606['query']['quality'];if(!_0x1416f5)return _0x2309f1['status'](0x194)['end']();if(dbUserTable[_0x112938(0x197)](_0x174606,_0x2309f1,_0x349f95,_0x112938(0x1a6),_0x1416f5[_0x112938(0x19b)])==!![]){_0x349f95==_0x112938(0x157)&&(dbMusicIndexTable['increasePlayCount'](_0x174606[_0x112938(0x140)][_0x112938(0x17d)],_0x38b87d),dbMusicIndexTable[_0x112938(0x19f)](_0x174606['app'][_0x112938(0x17d)],_0x38b87d));dbFileIndexTable[_0x112938(0x151)](_0x174606[_0x112938(0x140)]['dbFileIndex'],_0x38b87d,_0x112938(0x188),new Date()[_0x112938(0x14d)](),_0x434993);let _0x5c0d13=_0x1416f5[_0x112938(0x19b)]+path[_0x112938(0x198)]+_0x1416f5['filename'];fs[_0x112938(0x199)](_0x5c0d13,(_0x47fde5,_0x4cdd28)=>{const _0x41c352=_0x112938;if(_0x47fde5||!_0x4cdd28[_0x41c352(0x182)]())return _0x2309f1[_0x41c352(0x165)](0x194)[_0x41c352(0x137)]();let _0x1ca8ac=_0x174606['query'][_0x41c352(0x193)];if(_0x1ca8ac&&_0x1ca8ac==0x1){if(_0x3c47a2){const _0x3010bb=encodeURIComponent(path[_0x41c352(0x17f)](_0x5c0d13))[_0x41c352(0x185)](/%([0-9A-F]{2})/g,(_0x214851,_0x34c646)=>'%'+_0x34c646[_0x41c352(0x17b)]());_0x2309f1[_0x41c352(0x18c)](_0x41c352(0x153),_0x41c352(0x15b)+_0x3010bb);}return _0x2309f1['sendFile'](_0x5c0d13);}if(_0x174606[_0x41c352(0x179)]['transToMp3']==0x1){_0x2309f1[_0x41c352(0x15d)]('Content-Type','audio/mpeg');const _0x47079c=_0x174606['headers']['range'];if('bytes=0-1'==_0x47079c)return _0x2309f1['sendFile'](_0x5c0d13);return musicTransCodeUtil[_0x41c352(0x162)](_0x2309f1,_0x5c0d13);}else _0x174606['query'][_0x41c352(0x161)]&&_0x174606[_0x41c352(0x179)][_0x41c352(0x161)]==_0x41c352(0x1a3)&&path['extname'](_0x5c0d13)&&path[_0x41c352(0x194)](_0x5c0d13)[_0x41c352(0x154)]()==_0x41c352(0x167)?(console[_0x41c352(0x1b1)](_0x41c352(0x1a1),_0x5c0d13),encodingUtil['getUtf8FileStream'](_0x5c0d13)['then'](_0x35008f=>{const _0x5f521e=_0x41c352;return _0x35008f?_0x35008f[_0x5f521e(0x1a5)](_0x2309f1):(console['log'](_0x5f521e(0x136),_0x5c0d13),_0x2309f1[_0x5f521e(0x18e)](_0x5c0d13));})):sharpUtil['returnDealedFile'](_0x2309f1,_0x5c0d13,_0x3c47a2,_0x558f54,_0x4c2876);});}}),router[_0x10bb17(0x139)](_0x10bb17(0x148),(_0x48f6ad,_0xdbeda,_0x1fb0ea)=>{const _0x12e08e=_0x10bb17;let _0x4452ff=_0x48f6ad[_0x12e08e(0x19c)][_0x12e08e(0x1a0)],_0x37e230=getIndexObj(_0x48f6ad,_0x4452ff);if(!_0x37e230)return _0xdbeda[_0x12e08e(0x165)](0x194)[_0x12e08e(0x137)]();if(dbUserTable['doUserCanGet'](_0x48f6ad,_0xdbeda,'',_0x12e08e(0x1a6),_0x37e230['path'])==!![]){let _0xc12cc=_0x37e230[_0x12e08e(0x19b)]+path[_0x12e08e(0x198)]+_0x37e230[_0x12e08e(0x13e)];exifUtil[_0x12e08e(0x168)](_0xc12cc)[_0x12e08e(0x178)](_0x11a735=>{const _0x452887=_0x12e08e;_0x37e230[_0x452887(0x1ad)]=_0x11a735,_0xdbeda[_0x452887(0x171)]({'code':0x0,'data':_0x37e230});})[_0x12e08e(0x13d)](_0x592851=>{const _0x579335=_0x12e08e;_0x37e230[_0x579335(0x1ad)]=![],_0xdbeda['json']({'code':0x0,'data':_0x37e230});});}}),router['post'](_0x10bb17(0x172),(_0x2fda64,_0x25003d,_0x3f2360)=>{const _0x2e29b5=_0x10bb17;let _0x9a26e0=_0x2fda64[_0x2e29b5(0x19c)][_0x2e29b5(0x1a0)],_0x1bb289=getIndexObj(_0x2fda64,_0x9a26e0),_0x26a0ba=getIndexTableName(_0x2fda64[_0x2e29b5(0x179)][_0x2e29b5(0x14a)]);if(!_0x1bb289)return _0x25003d[_0x2e29b5(0x171)]({'code':0x2,'message':_0x2e29b5(0x15a)});try{fs['rm'](_0x1bb289[_0x2e29b5(0x144)],_0x121975=>{const _0x2e2ba6=_0x2e29b5;return _0x121975?fileUtil[_0x2e2ba6(0x146)](_0x25003d,_0x121975):(dbFileIndexTable[_0x2e2ba6(0x151)](_0x2fda64['app'][_0x2e2ba6(0x17d)],_0x9a26e0,'tiny_path','',_0x26a0ba),_0x25003d[_0x2e2ba6(0x171)]({'code':0x0}));});}catch(_0xb3138a){return _0x25003d['json']({'code':0x2,'message':_0x2e29b5(0x158)});}}),module[_0x10bb17(0x186)]=router;