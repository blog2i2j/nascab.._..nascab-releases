const _0x50102a=_0x465b;function _0x465b(_0x26bfb9,_0x2d9039){const _0x4b8473=_0x4b84();return _0x465b=function(_0x465b94,_0x5a1ead){_0x465b94=_0x465b94-0x120;let _0x292c83=_0x4b8473[_0x465b94];return _0x292c83;},_0x465b(_0x26bfb9,_0x2d9039);}(function(_0x27a3ff,_0xb8f124){const _0x1bba7b=_0x465b,_0x5bfd60=_0x27a3ff();while(!![]){try{const _0x45a65c=parseInt(_0x1bba7b(0x15d))/0x1+-parseInt(_0x1bba7b(0x15b))/0x2*(-parseInt(_0x1bba7b(0x120))/0x3)+-parseInt(_0x1bba7b(0x181))/0x4*(parseInt(_0x1bba7b(0x161))/0x5)+parseInt(_0x1bba7b(0x171))/0x6*(-parseInt(_0x1bba7b(0x152))/0x7)+-parseInt(_0x1bba7b(0x142))/0x8*(-parseInt(_0x1bba7b(0x168))/0x9)+-parseInt(_0x1bba7b(0x12e))/0xa*(-parseInt(_0x1bba7b(0x194))/0xb)+-parseInt(_0x1bba7b(0x18f))/0xc*(parseInt(_0x1bba7b(0x132))/0xd);if(_0x45a65c===_0xb8f124)break;else _0x5bfd60['push'](_0x5bfd60['shift']());}catch(_0x21cb08){_0x5bfd60['push'](_0x5bfd60['shift']());}}}(_0x4b84,0xcdd9e));let express=require(_0x50102a(0x15e)),router=express[_0x50102a(0x13a)](),path=require(_0x50102a(0x18d)),fs=require('fs');const sharp=require('sharp');let sharpUtil=require(_0x50102a(0x160)),exifUtil=require(_0x50102a(0x14f)),fileUtil=require(_0x50102a(0x188));function _0x4b84(){const _0x1d77b4=['prepare','deletePathAll','length','quality','2034570ApMxbF','delete','post','Unable\x20to\x20read\x20file','params\x20is\x20not\x20valid','imgTypeList','check_time','dirname','doUserCanGet','username','music','end','setHeader','body','18950DLqFyQ','indexId','filename','/getInfo','85111CsBnYZ','../../db/dbFileIndexTable','UPDATE\x20file_index_photo\x20SET\x20is_show=1\x20WHERE\x20path=?\x20AND\x20filename\x20=?','catch','ids','exports','dbFileIndex','shell','Router','isFile','sendStatus','changes','replace','stat','tiny_path','../../db/dbMusicIndexTable','3220744TEoswg','returnFileError','genTinyFile','sep','TYPE_DELETE','status','query','increasePlayCount','then','send','../../db/dbFileOperationRecord','raw_filename','ignoreLivephoto','exifr','cachePath','trash','2002stYHML','file\x20not\x20found','STATE_SUC','push','is_file','json','decodePath','power_get','is_livephoto','4iPUzlm','STATE_FAIL','947876WTcCmt','express','transToMp3','../utils/sharpUtils','5LVFvxk','getById','getFileHashNameByPathAndStat','sendFile','inOutTrash','getTime','download','36kfKaZh','includes','putInSystemTrash','videoTypeList','set','run','.MP4','image','/tinyImgByPath*','17166NTzefX','basename','get','bytes=0-1','.txt','exifInfo','raw','join','toUpperCase','extname','code','addFileOperationRecord','video','updateById','Content-Disposition','fullPath','6175556pjCLib','app','serverType','size','audio/mpeg','returnDealedFile','.MOV','../utils/fileUtils','.JPG','/deleteFromDisk','toLowerCase','updatePlayTime','path','getFileHashName','1512pdULMB','.HEIC','power_delete','../../db/dbUserTable','range','671fPMubc','existsSync','returnErrMsg','utf8','currentUser'];_0x4b84=function(){return _0x1d77b4;};return _0x4b84();}const config=require('../../myConfig/config'),dbFileIndexTable=require(_0x50102a(0x133)),dbFileOperationRecord=require(_0x50102a(0x14c)),dbUserTable=require(_0x50102a(0x192)),dbMusicIndexTable=require(_0x50102a(0x141));let musicTransCodeUtil=require('../../utils/musicTransCodeUtil');const encodingUtil=require('../../utils/encodingUtil');function getIndexTableName(_0x58c914){let _0xb86bc=dbFileIndexTable['getIndexTableNameByType'](_0x58c914);return _0xb86bc;}function getIndexObj(_0x577ca4,_0x248318){const _0x1ce824=_0x50102a;let _0x7b1b44=_0x577ca4[_0x1ce824(0x12d)][_0x1ce824(0x183)]||_0x577ca4['query'][_0x1ce824(0x183)],_0x42f278=getIndexTableName(_0x7b1b44);return dbFileIndexTable[_0x1ce824(0x162)](_0x577ca4[_0x1ce824(0x182)][_0x1ce824(0x138)],_0x248318,_0x42f278);}router[_0x50102a(0x122)]('/inOutTrash',(_0x406340,_0x2dc5a4,_0x2a5219)=>{const _0xddbcc9=_0x50102a;let _0x373993=_0x406340[_0xddbcc9(0x12d)][_0xddbcc9(0x136)],_0x58a210=_0x406340[_0xddbcc9(0x12d)]['trash'];if(dbUserTable[_0xddbcc9(0x128)](_0x406340,_0x2dc5a4,'photo',_0xddbcc9(0x191))==!![]){if(_0x373993&&_0x373993['length']>0x0){let _0x17ffd0='(';for(let _0x4bf610=0x0;_0x4bf610<_0x373993['length'];_0x4bf610++){let _0x440c24=getIndexObj(_0x406340,_0x373993[_0x4bf610]);if(!_0x440c24)continue;_0x440c24[_0xddbcc9(0x14d)]!=null&&_0x440c24['raw_filename']!=''&&_0x440c24['is_file']&&(_0x58a210==0x1?_0x406340[_0xddbcc9(0x182)][_0xddbcc9(0x138)][_0xddbcc9(0x199)](_0xddbcc9(0x134))[_0xddbcc9(0x16d)](_0x440c24[_0xddbcc9(0x18d)],_0x440c24['raw_filename']):_0x406340[_0xddbcc9(0x182)][_0xddbcc9(0x138)][_0xddbcc9(0x199)]('UPDATE\x20file_index_photo\x20SET\x20is_show=0\x20WHERE\x20path=?\x20AND\x20filename\x20=?')[_0xddbcc9(0x16d)](_0x440c24[_0xddbcc9(0x18d)],_0x440c24[_0xddbcc9(0x14d)])),_0x17ffd0+=_0x373993[_0x4bf610],_0x4bf610!=_0x373993[_0xddbcc9(0x19b)]-0x1&&(_0x17ffd0+=',');}_0x17ffd0+=')';let _0x1f5029=dbFileIndexTable[_0xddbcc9(0x165)](_0x406340['app'][_0xddbcc9(0x138)],_0x17ffd0,_0x58a210,getIndexTableName(_0x406340[_0xddbcc9(0x12d)][_0xddbcc9(0x183)]));_0x1f5029['changes']>0x0&&_0x2dc5a4['json']({'code':0x0,'count':_0x1f5029[_0xddbcc9(0x13d)]});}else{_0x2dc5a4['json']({'code':0x1,'message':_0xddbcc9(0x124)});return;}}}),router[_0x50102a(0x122)](_0x50102a(0x18a),(_0x1524d7,_0x23bd94,_0x5ca4d9)=>{const _0x3cb123=_0x50102a;let _0x2b5a2b=_0x1524d7[_0x3cb123(0x12d)]['ids'],_0x43adf9=_0x1524d7['body'][_0x3cb123(0x183)],_0x4c3ace=_0x1524d7['body']['deleteIndexFolder']==0x1,_0x3df633=_0x1524d7[_0x3cb123(0x12d)][_0x3cb123(0x14e)]==0x1,_0x58b922=_0x1524d7[_0x3cb123(0x12d)][_0x3cb123(0x16a)],_0x385339=getIndexTableName(_0x43adf9);function _0x5366ba(_0x18837f,_0x5096e7){const _0x3a8f7c=_0x3cb123;dbFileOperationRecord[_0x3a8f7c(0x17c)](_0x1524d7[_0x3a8f7c(0x182)]['dbOther'],{'username':_0x1524d7[_0x3a8f7c(0x198)][_0x3a8f7c(0x129)],'targetPath':_0x18837f,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x3a8f7c(0x146)],'state':_0x5096e7?dbFileOperationRecord[_0x3a8f7c(0x154)]:dbFileOperationRecord[_0x3a8f7c(0x15c)]});}function _0x74b1c1(_0x4ad0db){const _0x524b6c=_0x3cb123;if(_0x4ad0db[_0x524b6c(0x156)]==0x1&&_0x4ad0db[_0x524b6c(0x15a)]==0x1){let _0x4945bd=path[_0x524b6c(0x178)](_0x4ad0db['path'],_0x4ad0db[_0x524b6c(0x130)]['replace'](_0x524b6c(0x187),'')+_0x524b6c(0x190));_0x4ad0db[_0x524b6c(0x130)]['endsWith'](_0x524b6c(0x16e))&&(_0x4945bd=path[_0x524b6c(0x178)](_0x4ad0db['path'],_0x4ad0db[_0x524b6c(0x130)][_0x524b6c(0x13e)](_0x524b6c(0x16e),'')+_0x524b6c(0x189))),fs[_0x524b6c(0x195)](_0x4945bd)&&_0x1a8416(_0x4ad0db,_0x4945bd,![]);}}function _0x1a8416(_0x163ef4,_0x50b3f7,_0x5a9c89){const _0xe7d827=_0x3cb123;_0x58b922==0x1?(process[_0xe7d827(0x14b)]({'type':_0xe7d827(0x139),'shellType':_0xe7d827(0x151),'path':_0x50b3f7}),_0x5366ba(_0x50b3f7,!![])):fs['rm'](_0x50b3f7,{'recursive':!![]},_0x417ff=>{_0x417ff?_0x5366ba(_0x50b3f7,![]):_0x5366ba(_0x50b3f7,!![]);}),_0x5a9c89&&_0x74b1c1(_0x163ef4);}function _0x1d5045(_0x4c0dc3){const _0x49a431=_0x3cb123;dbFileIndexTable[_0x49a431(0x121)](_0x1524d7[_0x49a431(0x182)]['dbFileIndex'],_0x4c0dc3,_0x385339);}function _0x46a700(_0x85749a,_0x4ca51e){const _0x50065e=_0x3cb123;if(!_0x4ca51e)return;dbFileIndexTable['delete'](_0x1524d7['app'][_0x50065e(0x138)],_0x85749a,_0x385339);let _0x40dc5c=dbFileIndexTable[_0x50065e(0x19a)](_0x1524d7['app'][_0x50065e(0x138)],_0x4ca51e,_0x385339);}if(_0x2b5a2b&&_0x2b5a2b[_0x3cb123(0x19b)]>0x0){let _0xa6b04e=0x0,_0x333a1d=0x0,_0x5ac652=[];for(let _0x5bad8a=0x0;_0x5bad8a<_0x2b5a2b[_0x3cb123(0x19b)];_0x5bad8a++){let _0x16cf30=_0x2b5a2b[_0x5bad8a],_0xe7a2ea=getIndexObj(_0x1524d7,_0x16cf30,_0x385339);if(_0xe7a2ea){if(dbUserTable[_0x3cb123(0x128)](_0x1524d7,_0x23bd94,_0x43adf9,'power_delete',_0xe7a2ea[_0x3cb123(0x18d)])==!![]){_0xa6b04e+=0x1,_0x5ac652[_0x3cb123(0x155)](_0x16cf30);let _0x577f02=path[_0x3cb123(0x178)](_0xe7a2ea[_0x3cb123(0x18d)],path[_0x3cb123(0x145)],_0xe7a2ea[_0x3cb123(0x130)]),_0x2a9597=_0xe7a2ea[_0x3cb123(0x156)]==0x0;_0x4c3ace&&(_0x577f02=_0xe7a2ea[_0x3cb123(0x18d)],_0x2a9597=!![]),_0x2a9597?_0x46a700(_0x16cf30,_0x577f02):_0x1d5045(_0x16cf30),_0x1a8416(_0xe7a2ea,_0x577f02,!_0x3df633);}else _0x333a1d+=0x1;}}return _0x23bd94['json']({'code':0x0,'deletedIds':_0x5ac652,'deleteCount':_0xa6b04e,'errCount':_0x333a1d});}else return _0x1524d7[_0x3cb123(0x182)][_0x3cb123(0x196)](_0x23bd94,_0x3cb123(0x124));});function genTinyForFilePath(_0xc6bc89,_0x343253,_0x160814,_0x1688fe){const _0xda1a93=_0x50102a;let _0x15f0d2=path[_0xda1a93(0x17a)](_0x343253)?path[_0xda1a93(0x17a)](_0x343253)[_0xda1a93(0x18b)]():null,_0x299ccc=![];if(config[_0xda1a93(0x125)][_0xda1a93(0x169)](_0x15f0d2)||config['rawImgTypeList'][_0xda1a93(0x169)](_0x15f0d2[_0xda1a93(0x18b)]()))_0x299ccc=_0xda1a93(0x16f);else{if(config[_0xda1a93(0x16b)]['includes'](_0x15f0d2))_0x299ccc=_0xda1a93(0x17d);else return _0xc6bc89[_0xda1a93(0x147)](0x194)[_0xda1a93(0x12b)]();}sharpUtil['genTinyFile'](_0x343253,path[_0xda1a93(0x127)](_0x160814),path[_0xda1a93(0x172)](_0x160814),_0x299ccc,null,_0x224b92=>{const _0x58d449=_0xda1a93;_0xc6bc89[_0x58d449(0x164)](_0x224b92);},_0x1b602e=>{const _0x4553bb=_0xda1a93;return _0xc6bc89[_0x4553bb(0x147)](0x194)[_0x4553bb(0x12b)]();},_0x1688fe);}function genTiny(_0x164877,_0x488a96,_0x200239,_0x5bc0d2,_0x297a30,_0x46cdd8){const _0x58bd87=_0x50102a;let _0x275acc=_0x58bd87(0x16f);_0x5bc0d2['type']==0x2&&(_0x275acc=_0x58bd87(0x17d)),sharpUtil[_0x58bd87(0x144)](_0x200239,path[_0x58bd87(0x127)](_0x46cdd8),path['basename'](_0x46cdd8),_0x275acc,_0x5bc0d2,_0x28d9cf=>{const _0x581638=_0x58bd87;dbFileIndexTable[_0x581638(0x17e)](_0x488a96,_0x5bc0d2['id'],'tiny_path',_0x28d9cf,_0x297a30),_0x164877[_0x581638(0x164)](_0x28d9cf);},_0x3dd67c=>{const _0x3f1bd8=_0x58bd87;return _0x164877[_0x3f1bd8(0x147)](0x194)['end']();});}router[_0x50102a(0x173)]('/rawFileByPath*',(_0x218626,_0x4e97c7,_0xc769cd)=>{const _0xa59898=_0x50102a;let _0x4d2a9a=_0x218626[_0xa59898(0x148)][_0xa59898(0x180)];_0x4d2a9a=fileUtil[_0xa59898(0x158)](_0x4d2a9a);let _0x55b0f4=_0x218626[_0xa59898(0x148)][_0xa59898(0x167)]==0x1,_0x4d19e1=_0x218626['query'][_0xa59898(0x184)],_0x36767d=_0x218626[_0xa59898(0x148)][_0xa59898(0x19c)];fs[_0xa59898(0x13f)](_0x4d2a9a,(_0x593a3a,_0xc9399c)=>{const _0x24a113=_0xa59898;if(_0x593a3a)return _0x4e97c7['sendStatus'](0x194);if(dbUserTable[_0x24a113(0x128)](_0x218626,_0x4e97c7,'',_0x24a113(0x159),_0x4d2a9a)==!![])try{let _0x3eed61=_0x218626['query'][_0x24a113(0x177)];if(_0x3eed61&&_0x3eed61==0x1){if(_0x55b0f4){const _0x381242=encodeURIComponent(path['basename'](_0x4d2a9a))[_0x24a113(0x13e)](/%([0-9A-F]{2})/g,(_0x31a9ba,_0x485c20)=>'%'+_0x485c20[_0x24a113(0x179)]());_0x4e97c7['setHeader'](_0x24a113(0x17f),'attachment;\x20filename*=UTF-8\x27\x27'+_0x381242);}return _0x4e97c7['sendFile'](_0x4d2a9a);}sharpUtil[_0x24a113(0x186)](_0x4e97c7,_0x4d2a9a,_0x55b0f4,_0x4d19e1,_0x36767d);}catch(_0x17b12d){return _0x4e97c7[_0x24a113(0x147)](0x194)[_0x24a113(0x12b)]();}});}),router[_0x50102a(0x173)](_0x50102a(0x170),(_0x206029,_0x1b4430,_0x4d7161)=>{const _0x198ae2=_0x50102a;let _0xfc6d1f=_0x206029[_0x198ae2(0x148)][_0x198ae2(0x180)];_0xfc6d1f=fileUtil[_0x198ae2(0x158)](_0xfc6d1f);let _0x5642e3=_0x206029[_0x198ae2(0x148)][_0x198ae2(0x184)];fs[_0x198ae2(0x13f)](_0xfc6d1f,(_0x428f2b,_0x24a26e)=>{const _0x2b6544=_0x198ae2;if(_0x428f2b)return _0x1b4430[_0x2b6544(0x13c)](0x194);config[_0x2b6544(0x163)](_0x5642e3,_0xfc6d1f,_0xd02933=>{const _0x497a11=_0x2b6544;if(!_0xd02933)return _0x1b4430[_0x497a11(0x13c)](0x194);let _0x36139b=path[_0x497a11(0x178)](config[_0x497a11(0x150)],_0xd02933);dbUserTable[_0x497a11(0x128)](_0x206029,_0x1b4430,'',_0x497a11(0x159),_0xfc6d1f,!![])==!![]&&fs[_0x497a11(0x13f)](_0x36139b,(_0x2da179,_0x50b1d4)=>{const _0x13d764=_0x497a11;if(_0x2da179)return genTinyForFilePath(_0x1b4430,_0xfc6d1f,_0x36139b,_0x5642e3);return _0x50b1d4['isFile']()?_0x1b4430[_0x13d764(0x164)](_0x36139b):genTinyForFilePath(_0x1b4430,_0xfc6d1f,_0x36139b,_0x5642e3);});});});}),router['get']('/tinyImg*',(_0xd8ff90,_0x3e9949,_0x25b706)=>{const _0x17fc62=_0x50102a;let _0x4623cb=_0xd8ff90[_0x17fc62(0x148)][_0x17fc62(0x12f)],_0x278cd6=_0xd8ff90['query'][_0x17fc62(0x183)],_0x166fb3=getIndexTableName(_0x278cd6),_0x1a334c=getIndexObj(_0xd8ff90,_0x4623cb);if(!_0x1a334c)return _0x3e9949[_0x17fc62(0x147)](0x194)['end']();let _0x408a77=config[_0x17fc62(0x18e)](_0x1a334c),_0x4db838=path['join'](config['cachePath'],_0x408a77);if(dbUserTable[_0x17fc62(0x128)](_0xd8ff90,_0x3e9949,_0x278cd6,_0x17fc62(0x159),_0x1a334c[_0x17fc62(0x18d)])==!![]){let _0x4cdea1=path[_0x17fc62(0x178)](_0x1a334c[_0x17fc62(0x18d)],path[_0x17fc62(0x145)],_0x1a334c['filename']);fs[_0x17fc62(0x13f)](_0x4cdea1,(_0x4de56d,_0x462f73)=>{const _0x3922ad=_0x17fc62;if(_0x4de56d)return!_0x1a334c[_0x3922ad(0x140)]?_0x3e9949[_0x3922ad(0x147)](0x194)[_0x3922ad(0x12b)]():fs[_0x3922ad(0x13f)](_0x1a334c[_0x3922ad(0x140)],(_0x5d57c9,_0x4ba5bb)=>{const _0x4d2033=_0x3922ad;return _0x5d57c9||_0x4ba5bb&&!_0x4ba5bb['isFile']()?_0x3e9949['status'](0x194)[_0x4d2033(0x12b)]():_0x3e9949[_0x4d2033(0x164)](_0x1a334c['tiny_path']);});if(!_0x462f73[_0x3922ad(0x13b)]())return _0x3e9949['status'](0x194)[_0x3922ad(0x12b)]();!_0x1a334c['tiny_path']?fs['stat'](_0x4db838,(_0x16793b,_0xb1452)=>{const _0x290229=_0x3922ad;if(_0x16793b)return genTiny(_0x3e9949,_0xd8ff90[_0x290229(0x182)][_0x290229(0x138)],_0x4cdea1,_0x1a334c,_0x166fb3,_0x4db838);return _0xb1452['isFile']()&&_0xb1452[_0x290229(0x184)]>0x7d0?(dbFileIndexTable[_0x290229(0x17e)](_0xd8ff90[_0x290229(0x182)][_0x290229(0x138)],_0x1a334c['id'],_0x290229(0x140),_0x4db838,_0x166fb3),_0x3e9949['sendFile'](_0x4db838)):genTiny(_0x3e9949,_0xd8ff90[_0x290229(0x182)][_0x290229(0x138)],_0x4cdea1,_0x1a334c,_0x166fb3,_0x4db838);}):fs[_0x3922ad(0x13f)](_0x1a334c[_0x3922ad(0x140)],(_0x309454,_0x1bf694)=>{const _0x39243b=_0x3922ad;return _0x309454||!_0x1bf694['isFile']()?genTiny(_0x3e9949,_0xd8ff90[_0x39243b(0x182)][_0x39243b(0x138)],_0x4cdea1,_0x1a334c,_0x166fb3,_0x4db838):_0x3e9949[_0x39243b(0x164)](_0x1a334c[_0x39243b(0x140)]);});});}}),router[_0x50102a(0x173)]('/rawFile*',(_0x583d83,_0x950e08,_0x9eb396)=>{const _0x90ca2b=_0x50102a;let _0x4c2c5a=_0x583d83[_0x90ca2b(0x148)][_0x90ca2b(0x12f)],_0x3f9b7e=_0x583d83[_0x90ca2b(0x148)][_0x90ca2b(0x183)],_0x5f88=getIndexObj(_0x583d83,_0x4c2c5a),_0x292594=getIndexTableName(_0x3f9b7e),_0x307687=_0x583d83[_0x90ca2b(0x148)][_0x90ca2b(0x167)]==0x1,_0x46b18e=_0x583d83[_0x90ca2b(0x148)]['size'],_0x20b09d=_0x583d83[_0x90ca2b(0x148)][_0x90ca2b(0x19c)];if(!_0x5f88)return _0x950e08[_0x90ca2b(0x147)](0x194)['end']();if(dbUserTable[_0x90ca2b(0x128)](_0x583d83,_0x950e08,_0x3f9b7e,_0x90ca2b(0x159),_0x5f88['path'])==!![]){_0x3f9b7e==_0x90ca2b(0x12a)&&(dbMusicIndexTable[_0x90ca2b(0x149)](_0x583d83[_0x90ca2b(0x182)][_0x90ca2b(0x138)],_0x4c2c5a),dbMusicIndexTable[_0x90ca2b(0x18c)](_0x583d83[_0x90ca2b(0x182)][_0x90ca2b(0x138)],_0x4c2c5a));dbFileIndexTable[_0x90ca2b(0x17e)](_0x583d83['app'][_0x90ca2b(0x138)],_0x4c2c5a,_0x90ca2b(0x126),new Date()[_0x90ca2b(0x166)](),_0x292594);let _0x249d5a=_0x5f88[_0x90ca2b(0x18d)]+path['sep']+_0x5f88[_0x90ca2b(0x130)];fs[_0x90ca2b(0x13f)](_0x249d5a,(_0x17b004,_0x837081)=>{const _0x8b1df9=_0x90ca2b;if(_0x17b004||!_0x837081[_0x8b1df9(0x13b)]())return _0x950e08[_0x8b1df9(0x147)](0x194)[_0x8b1df9(0x12b)]();let _0x20d3e6=_0x583d83['query'][_0x8b1df9(0x177)];if(_0x20d3e6&&_0x20d3e6==0x1){if(_0x307687){const _0x21a81c=encodeURIComponent(path[_0x8b1df9(0x172)](_0x249d5a))[_0x8b1df9(0x13e)](/%([0-9A-F]{2})/g,(_0x377112,_0x48359f)=>'%'+_0x48359f['toUpperCase']());_0x950e08[_0x8b1df9(0x12c)](_0x8b1df9(0x17f),'attachment;\x20filename*=UTF-8\x27\x27'+_0x21a81c);}return _0x950e08[_0x8b1df9(0x164)](_0x249d5a);}if(_0x583d83[_0x8b1df9(0x148)][_0x8b1df9(0x15f)]==0x1){_0x950e08[_0x8b1df9(0x16c)]('Content-Type',_0x8b1df9(0x185));const _0x303f67=_0x583d83['headers'][_0x8b1df9(0x193)];if(_0x8b1df9(0x174)==_0x303f67)return _0x950e08[_0x8b1df9(0x164)](_0x249d5a);return musicTransCodeUtil[_0x8b1df9(0x15f)](_0x950e08,_0x249d5a);}else _0x583d83[_0x8b1df9(0x148)][_0x8b1df9(0x17b)]&&_0x583d83[_0x8b1df9(0x148)]['code']==_0x8b1df9(0x197)&&path[_0x8b1df9(0x17a)](_0x249d5a)&&path[_0x8b1df9(0x17a)](_0x249d5a)[_0x8b1df9(0x18b)]()==_0x8b1df9(0x175)?(console['log']('Convert\x20to\x20utf8\x20',_0x249d5a),encodingUtil['getUtf8FileStream'](_0x249d5a)[_0x8b1df9(0x14a)](_0x456c56=>{const _0x3355a4=_0x8b1df9;return _0x456c56?_0x456c56['pipe'](_0x950e08):(console['log'](_0x3355a4(0x123),_0x249d5a),_0x950e08['sendFile'](_0x249d5a));})):sharpUtil[_0x8b1df9(0x186)](_0x950e08,_0x249d5a,_0x307687,_0x46b18e,_0x20b09d);});}}),router[_0x50102a(0x122)](_0x50102a(0x131),(_0x5e7256,_0x558e44,_0x6fea90)=>{const _0x4d02f7=_0x50102a;let _0x5f2bf0=_0x5e7256[_0x4d02f7(0x12d)][_0x4d02f7(0x12f)],_0x33b203=getIndexObj(_0x5e7256,_0x5f2bf0);if(!_0x33b203)return _0x558e44[_0x4d02f7(0x147)](0x194)[_0x4d02f7(0x12b)]();if(dbUserTable['doUserCanGet'](_0x5e7256,_0x558e44,'',_0x4d02f7(0x159),_0x33b203[_0x4d02f7(0x18d)])==!![]){let _0xf25283=_0x33b203['path']+path[_0x4d02f7(0x145)]+_0x33b203[_0x4d02f7(0x130)];exifUtil['parse'](_0xf25283)[_0x4d02f7(0x14a)](_0x5a08f0=>{const _0x143a34=_0x4d02f7;_0x33b203[_0x143a34(0x176)]=_0x5a08f0,_0x558e44[_0x143a34(0x157)]({'code':0x0,'data':_0x33b203});})[_0x4d02f7(0x135)](_0x35c902=>{const _0x4182d7=_0x4d02f7;_0x33b203['exifInfo']=![],_0x558e44[_0x4182d7(0x157)]({'code':0x0,'data':_0x33b203});});}}),router[_0x50102a(0x122)]('/clearTinyImg',(_0x22f988,_0x20c3d0,_0x46ca05)=>{const _0x4c6dc9=_0x50102a;let _0x33ab3e=_0x22f988[_0x4c6dc9(0x12d)][_0x4c6dc9(0x12f)],_0x4052ec=getIndexObj(_0x22f988,_0x33ab3e),_0x2470a6=getIndexTableName(_0x22f988['query']['serverType']);if(!_0x4052ec)return _0x20c3d0[_0x4c6dc9(0x157)]({'code':0x2,'message':_0x4c6dc9(0x153)});try{fs['rm'](_0x4052ec[_0x4c6dc9(0x140)],_0x45caea=>{const _0x19b9d2=_0x4c6dc9;return _0x45caea?fileUtil[_0x19b9d2(0x143)](_0x20c3d0,_0x45caea):(dbFileIndexTable[_0x19b9d2(0x17e)](_0x22f988[_0x19b9d2(0x182)]['dbFileIndex'],_0x33ab3e,_0x19b9d2(0x140),'',_0x2470a6),_0x20c3d0[_0x19b9d2(0x157)]({'code':0x0}));});}catch(_0x3b72e6){return _0x20c3d0[_0x4c6dc9(0x157)]({'code':0x2,'message':'operation\x20fail'});}}),module[_0x50102a(0x137)]=router;