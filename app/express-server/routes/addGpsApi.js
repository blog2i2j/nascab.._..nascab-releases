function _0x810f(_0x3af3e7,_0x5bc65f){const _0x534f98=_0x534f();return _0x810f=function(_0x810f6e,_0x44b82c){_0x810f6e=_0x810f6e-0x1d2;let _0x243d5c=_0x534f98[_0x810f6e];return _0x243d5c;},_0x810f(_0x3af3e7,_0x5bc65f);}function _0x534f(){const _0x42aeac=['getByWhere','doUserCanGet','INDEX_TABLE_NAME_PHOTO','photo','866391RgpcSp','148677dQVAOS','\x27,geohash3=\x27','indexIdList',')\x20\x20','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20mode=\x27','abs','exports','\x27,geohash2=\x27','40bwHEHm','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20(width>=','sep','longitude','\x20order\x20by\x20abs(original_time-','\x20\x20latitude\x20is\x20not\x20null\x20and\x20latitude!=\x27undefined\x27\x20and\x20geohash5\x20!=\x27undefined\x27\x20and\x20original_time\x20between\x20','path','size','../../db/dbUserTable','fullPath','isFile','express','\x27,geohash=\x27','GPSLatitude','1767110UopTEC','latitude','924832Ubursa','readFile','floor','mode','\x27\x20and\x20original_time\x20between\x20','Router','\x20and\x20height>=','6qmzXgn','type','ngeohash','from','dump','updateBySql','getAllByWhere',',ctime=','GPSLongitudeRef',')\x20asc\x20limit\x2050','dbFileIndex','\x20order\x20by\x20original_time\x20limit\x20','GPSIFD','original_time','binary','606495HNpBAa','../../db/dbFileIndexTable','GPS','statSync','log','run','GPSLongitude','round','isVip','app','piexifjs','length','currentUser','\x20latitude=\x27','add_gps_status','\x20\x20and\x20(width>=','updateById','18wzSEmy','undefined','255465tIjAdA','\x27,longitude=\x27','UPDATE\x20file_index_photo\x20set\x20add_gps_status=1\x20WHERE\x20id\x20IN\x20','power_get','proxy.isntVip','body','ctimeMs','mtime','\x27,geohash4=\x27','prepare','toString','load','SKIP','2205234rgciaj','utimes','getById','\x20and\x20','filename','UPDATE\x20file_index_photo\x20set\x20add_gps_status=2\x20WHERE\x20id\x20IN\x20','/getWaitAddGpsIndex','GPSLatitudeRef','\x20size=','json','is_admin','substring','returnErrMsg','join','post','insert','dbOther'];_0x534f=function(){return _0x42aeac;};return _0x534f();}const _0x58c471=_0x810f;(function(_0x1b8af3,_0x3d375f){const _0x183296=_0x810f,_0x538b90=_0x1b8af3();while(!![]){try{const _0x2b30ef=parseInt(_0x183296(0x1f5))/0x1*(-parseInt(_0x183296(0x214))/0x2)+-parseInt(_0x183296(0x1f4))/0x3+parseInt(_0x183296(0x20d))/0x4+-parseInt(_0x183296(0x223))/0x5+parseInt(_0x183296(0x1df))/0x6+-parseInt(_0x183296(0x1d2))/0x7*(-parseInt(_0x183296(0x1fd))/0x8)+parseInt(_0x183296(0x234))/0x9*(parseInt(_0x183296(0x20b))/0xa);if(_0x2b30ef===_0x3d375f)break;else _0x538b90['push'](_0x538b90['shift']());}catch(_0x118b6d){_0x538b90['push'](_0x538b90['shift']());}}}(_0x534f,0x43ff5));let express=require(_0x58c471(0x208)),router=express[_0x58c471(0x212)](),path=require('path');const dbUserTable=require(_0x58c471(0x205)),dbFileIndexTable=require(_0x58c471(0x224));let fs=require('fs'),nasAccountUtil=require('../../express-server/utils/nasAccountUtils'),piexif=require(_0x58c471(0x22d)),geohash=require(_0x58c471(0x216));function getWaitAddGpsIndex(_0x114287,_0x42c4e9){const _0xaf6e71=_0x58c471;let _0x3ee821=0x7d0,_0x24859b=dbFileIndexTable[_0xaf6e71(0x1f0)](_0x114287,_0xaf6e71(0x1fe)+_0x3ee821+_0xaf6e71(0x213)+_0x3ee821+')\x20'+_0x42c4e9,'*',dbFileIndexTable[_0xaf6e71(0x1f2)]);if(_0x24859b){let _0x218bf9=_0x24859b[_0xaf6e71(0x221)]-0xe10*0x3e8*0xc,_0x298006=_0x24859b['original_time']+0xe10*0x3e8*0xc,_0x5eddd3=_0xaf6e71(0x202)+_0x218bf9+_0xaf6e71(0x1e2)+_0x298006+_0xaf6e71(0x232)+_0x3ee821+'\x20or\x20height>='+_0x3ee821+_0xaf6e71(0x1f8)+_0x42c4e9+_0xaf6e71(0x201)+_0x24859b['original_time']+_0xaf6e71(0x21d),_0x57a392=dbFileIndexTable[_0xaf6e71(0x21a)](_0x114287,_0x5eddd3,'*',dbFileIndexTable[_0xaf6e71(0x1f2)]);if(_0x57a392&&_0x57a392[_0xaf6e71(0x22e)]>0x0){let _0x596c8c=[];if(_0x24859b[_0xaf6e71(0x210)]&&_0x24859b['mode']!=_0xaf6e71(0x235)){let _0x25e740=0x32,_0x3d3fda=_0x24859b[_0xaf6e71(0x221)]-0xe10*0x3e8*0x3,_0x4591ed=_0x24859b[_0xaf6e71(0x221)]+0xe10*0x3e8*0x3;_0x24859b[_0xaf6e71(0x210)]&&_0x24859b[_0xaf6e71(0x210)]!='undefined'&&(_0x596c8c=dbFileIndexTable[_0xaf6e71(0x21a)](_0x114287,_0xaf6e71(0x1f9)+_0x24859b[_0xaf6e71(0x210)]+_0xaf6e71(0x211)+_0x3d3fda+_0xaf6e71(0x1e2)+_0x4591ed+'\x20\x20'+_0x42c4e9+_0xaf6e71(0x21f)+_0x25e740,'*',dbFileIndexTable[_0xaf6e71(0x1f2)]));}else _0x596c8c['push'](_0x24859b);for(let _0x4901fc in _0x596c8c){_0x596c8c[_0x4901fc][_0xaf6e71(0x206)]=path[_0xaf6e71(0x1ec)](_0x596c8c[_0x4901fc][_0xaf6e71(0x203)],_0x596c8c[_0x4901fc][_0xaf6e71(0x1e3)]);}if(_0x596c8c['length']==0x1)return dbFileIndexTable[_0xaf6e71(0x233)](_0x114287,_0x596c8c[0x0]['id'],_0xaf6e71(0x231),0x1,dbFileIndexTable[_0xaf6e71(0x1f2)]),getWaitAddGpsIndex(_0x114287,_0x42c4e9);return{'dealList':_0x596c8c,'nearIndex':_0x57a392};}else return dbFileIndexTable[_0xaf6e71(0x233)](_0x114287,_0x24859b['id'],_0xaf6e71(0x231),0x1,dbFileIndexTable[_0xaf6e71(0x1f2)]),getWaitAddGpsIndex(_0x114287,_0x42c4e9);}else return![];}router[_0x58c471(0x1ed)](_0x58c471(0x1e5),(_0x2cba7e,_0x5d48ed,_0x476fe9)=>{const _0x20931d=_0x58c471;let _0x5d009f={'code':0x0,'data':''};if(dbUserTable[_0x20931d(0x1f1)](_0x2cba7e,_0x5d48ed,_0x20931d(0x1f3),_0x20931d(0x1d5))==!![]){let _0x175573='';_0x2cba7e[_0x20931d(0x22f)][_0x20931d(0x1e9)]!=0x1&&(_0x175573=dbUserTable['getUserPathWhere'](_0x2cba7e,'photo',_0x20931d(0x1d5),!![]));let _0x473425=getWaitAddGpsIndex(_0x2cba7e[_0x20931d(0x22c)][_0x20931d(0x21e)],_0x175573);return _0x473425&&(_0x5d009f['data']=_0x473425),_0x5d48ed[_0x20931d(0x1e8)](_0x5d009f);}}),router[_0x58c471(0x1ed)]('/confirmAddGps',(_0x20d841,_0x1b7245,_0x1ed914)=>{const _0x28ab7f=_0x58c471;let _0x4d8e65=_0x20d841['body'][_0x28ab7f(0x215)],_0x537098=_0x20d841[_0x28ab7f(0x1d7)][_0x28ab7f(0x1f7)];if(_0x537098[_0x28ab7f(0x22e)]<0x1)return _0x1b7245['json']({'code':0x0});nasAccountUtil[_0x28ab7f(0x22b)](null,_0x20d841[_0x28ab7f(0x22c)][_0x28ab7f(0x1ef)])['then'](_0xa16b9b=>{const _0xb1b20=_0x28ab7f;if(!_0xa16b9b)return _0x20d841[_0xb1b20(0x22c)][_0xb1b20(0x1eb)](_0x1b7245,_0x1b7245['__'](_0xb1b20(0x1d6)));else _0x58a6ad();});function _0x58a6ad(){const _0x4d1e5a=_0x28ab7f;if(dbUserTable[_0x4d1e5a(0x1f1)](_0x20d841,_0x1b7245,'photo','power_change')==!![]){let _0xd64617='(';for(let _0x5373bd in _0x537098){_0xd64617+=_0x537098[_0x5373bd],_0x5373bd!=_0x537098[_0x4d1e5a(0x22e)]-0x1&&(_0xd64617+=',');}_0xd64617+=')';if(_0x4d8e65==_0x4d1e5a(0x1de))return _0x20d841[_0x4d1e5a(0x22c)][_0x4d1e5a(0x21e)][_0x4d1e5a(0x1db)](_0x4d1e5a(0x1e4)+_0xd64617+'\x20')[_0x4d1e5a(0x228)](),_0x1b7245[_0x4d1e5a(0x1e8)]({'code':0x0});else{if(_0x4d8e65=='CONFIRM'){let _0x34dbc6=_0x20d841[_0x4d1e5a(0x1d7)][_0x4d1e5a(0x20c)],_0x2fa12d=_0x20d841['body'][_0x4d1e5a(0x200)];if(!_0x34dbc6||!_0x2fa12d)return _0x1b7245[_0x4d1e5a(0x1e8)]({'code':0x0});_0x20d841['app'][_0x4d1e5a(0x21e)][_0x4d1e5a(0x1db)](_0x4d1e5a(0x1d4)+_0xd64617+'\x20')[_0x4d1e5a(0x228)]();let _0x5e2a99=0x0,_0x298f99=0x0;for(let _0x5e066e in _0x537098){let _0x142b65=dbFileIndexTable[_0x4d1e5a(0x1e1)](_0x20d841['app']['dbFileIndex'],_0x537098[_0x5e066e]);if(!_0x142b65)continue;let _0x42bb19=path[_0x4d1e5a(0x1ec)](_0x142b65['path'],path[_0x4d1e5a(0x1ff)],_0x142b65[_0x4d1e5a(0x1e3)]),_0x137f34=fs[_0x4d1e5a(0x226)](_0x42bb19);if(!_0x137f34[_0x4d1e5a(0x207)]()){_0x298f99+=0x1,_0x560027();continue;}fs[_0x4d1e5a(0x20e)](_0x42bb19,(_0x151b6f,_0x4f975a)=>{const _0x3a33e7=_0x4d1e5a;if(_0x151b6f)return _0x298f99+=0x1,_0x560027();var _0x216e3c=piexif[_0x3a33e7(0x1dd)](_0x4f975a[_0x3a33e7(0x1dc)](_0x3a33e7(0x222)));if(_0x34dbc6&&_0x2fa12d){function _0x562326(_0x11c797){const _0x19036a=_0x3a33e7;try{_0x11c797=Number(_0x11c797);let _0x5e8f89=Math[_0x19036a(0x20f)](Math[_0x19036a(0x1fa)](_0x11c797)),_0x48c7c4=(Math[_0x19036a(0x1fa)](_0x11c797)-_0x5e8f89)*0x3c,_0x4a690a=Math[_0x19036a(0x20f)](_0x48c7c4),_0x36b501=Math[_0x19036a(0x22a)]((_0x48c7c4-_0x4a690a)*0x3c*0x64);return[[_0x5e8f89,0x1],[_0x4a690a,0x1],[_0x36b501,0x64]];}catch(_0x42d780){return'';}}_0x216e3c[_0x3a33e7(0x225)][piexif[_0x3a33e7(0x220)][_0x3a33e7(0x1e6)]]=_0x34dbc6<0x0?'S':'N',_0x216e3c[_0x3a33e7(0x225)][piexif['GPSIFD'][_0x3a33e7(0x20a)]]=_0x562326(_0x34dbc6),_0x216e3c[_0x3a33e7(0x225)][piexif['GPSIFD'][_0x3a33e7(0x21c)]]=_0x2fa12d<0x0?'W':'E',_0x216e3c[_0x3a33e7(0x225)][piexif[_0x3a33e7(0x220)][_0x3a33e7(0x229)]]=_0x562326(_0x2fa12d);let _0x472d16=geohash['encode'](_0x34dbc6,_0x2fa12d,0x8),_0x2f3668=_0x472d16['substring'](0x0,0x5),_0x5334ba=_0x472d16[_0x3a33e7(0x1ea)](0x0,0x4),_0xe8e642=_0x472d16[_0x3a33e7(0x1ea)](0x0,0x3),_0x2efe0a=_0x472d16[_0x3a33e7(0x1ea)](0x0,0x2);dbFileIndexTable[_0x3a33e7(0x219)](_0x20d841[_0x3a33e7(0x22c)][_0x3a33e7(0x21e)],_0x142b65['id'],_0x3a33e7(0x230)+_0x34dbc6+_0x3a33e7(0x1d3)+_0x2fa12d+_0x3a33e7(0x209)+_0x472d16+'\x27,geohash5=\x27'+_0x2f3668+_0x3a33e7(0x1da)+_0x5334ba+_0x3a33e7(0x1f6)+_0xe8e642+_0x3a33e7(0x1fc)+_0x2efe0a+'\x27\x20');}try{var _0x5b99d0=piexif[_0x3a33e7(0x218)](_0x216e3c),_0x56add2=piexif[_0x3a33e7(0x1ee)](_0x5b99d0,_0x4f975a[_0x3a33e7(0x1dc)](_0x3a33e7(0x222)));let _0x17438e=path[_0x3a33e7(0x1ec)](_0x142b65[_0x3a33e7(0x203)],_0x142b65[_0x3a33e7(0x1e3)]);fs['writeFile'](_0x17438e,Buffer[_0x3a33e7(0x217)](_0x56add2,_0x3a33e7(0x222)),{},_0x27deb4=>{const _0x4186e2=_0x3a33e7;if(_0x27deb4)return _0x298f99+=0x1,_0x560027();fs[_0x4186e2(0x1e0)](_0x17438e,new Date(_0x142b65['mtime']),new Date(_0x142b65[_0x4186e2(0x1d9)]),_0xa50f17=>{const _0x3ce16b=_0x4186e2;_0xa50f17&&console[_0x3ce16b(0x227)](_0xa50f17),fs['stat'](_0x17438e,(_0xd5594d,_0x56bc32)=>{const _0x3b4fb6=_0x3ce16b;if(_0xd5594d)return _0x298f99+=0x1,_0x560027();dbFileIndexTable[_0x3b4fb6(0x219)](_0x20d841['app'][_0x3b4fb6(0x21e)],_0x142b65['id'],_0x3b4fb6(0x1e7)+_0x56bc32[_0x3b4fb6(0x204)]+_0x3b4fb6(0x21b)+_0x56bc32[_0x3b4fb6(0x1d8)]+'\x20'),_0x5e2a99+=0x1,_0x560027();});});});}catch(_0x3fd4b7){return _0x298f99+=0x1,_0x560027();}});}function _0x560027(){if(_0x5e2a99+_0x298f99>=_0x537098['length'])return _0x1b7245['json']({'code':0x0,'sucCount':_0x5e2a99,'errorCount':_0x298f99}),!![];}}}}}}),module[_0x58c471(0x1fb)]=router;