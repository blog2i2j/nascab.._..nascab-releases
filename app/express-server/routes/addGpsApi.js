const _0x438560=_0x3193;(function(_0x41afec,_0x1493b8){const _0x490070=_0x3193,_0x40e111=_0x41afec();while(!![]){try{const _0x2e29c0=parseInt(_0x490070(0xd3))/0x1*(parseInt(_0x490070(0xa7))/0x2)+parseInt(_0x490070(0xcc))/0x3*(parseInt(_0x490070(0xca))/0x4)+parseInt(_0x490070(0xc0))/0x5*(parseInt(_0x490070(0x8e))/0x6)+-parseInt(_0x490070(0xc2))/0x7+parseInt(_0x490070(0xc9))/0x8*(parseInt(_0x490070(0xde))/0x9)+parseInt(_0x490070(0xe3))/0xa+parseInt(_0x490070(0xc3))/0xb*(-parseInt(_0x490070(0x98))/0xc);if(_0x2e29c0===_0x1493b8)break;else _0x40e111['push'](_0x40e111['shift']());}catch(_0x36b4e6){_0x40e111['push'](_0x40e111['shift']());}}}(_0xcc41,0x7591d));let express=require(_0x438560(0x86)),router=express[_0x438560(0x9c)](),path=require('path');function _0xcc41(){const _0x2ed811=[',ctime=','currentUser','8152660jqwDVF','latitude','abs','express','dbFileIndex','\x20\x20and\x20(width>=','getByWhere','add_gps_status','GPSLongitudeRef','dbOther','UPDATE\x20file_index_photo\x20set\x20add_gps_status=1\x20WHERE\x20id\x20IN\x20','2754brVdvC','app','prepare','size','substring','\x27,longitude=\x27','getAllByWhere',')\x20\x20','join','utimes','996XRblUW','\x20size=','doUserCanGet','/confirmAddGps','Router','\x20order\x20by\x20original_time\x20limit\x20','getUserPathWhere',')\x20asc\x20limit\x2050','dump','exports','\x27,geohash5=\x27','then','mtime','../../express-server/utils/nasAccountUtils','/getWaitAddGpsIndex','82dNDNLG','writeFile','\x20and\x20','is_admin','push','longitude','fullPath','json','updateById','from','run','SKIP','\x27,geohash4=\x27','length','mode','GPSLatitudeRef','GPS','ctimeMs','path','data','\x27,geohash3=\x27','\x27\x20and\x20original_time\x20between\x20','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20mode=\x27','type','photo','8215gBonPa','indexIdList','2979802HEJCBg','238117RPlzRM','original_time','updateBySql','undefined','GPSIFD','sep','779816stTJrf','4eQpjho','ngeohash','355038qXNaVf','GPSLatitude','toString','proxy.isntVip','\x20latitude=\x27','UPDATE\x20file_index_photo\x20set\x20add_gps_status=2\x20WHERE\x20id\x20IN\x20','\x20or\x20height>=','12898EFLrRr','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20(width>=','returnErrMsg','INDEX_TABLE_NAME_PHOTO','\x27,geohash=\x27','../../db/dbFileIndexTable','binary','getById','insert','body','post','45CDXGra','filename','power_get'];_0xcc41=function(){return _0x2ed811;};return _0xcc41();}const dbUserTable=require('../../db/dbUserTable'),dbFileIndexTable=require(_0x438560(0xd8));let fs=require('fs'),nasAccountUtil=require(_0x438560(0xa5)),piexif=require('piexifjs'),geohash=require(_0x438560(0xcb));function _0x3193(_0xaf040,_0x3137f9){const _0xcc413e=_0xcc41();return _0x3193=function(_0x31937e,_0xc45f93){_0x31937e=_0x31937e-0x86;let _0x1e7651=_0xcc413e[_0x31937e];return _0x1e7651;},_0x3193(_0xaf040,_0x3137f9);}function getWaitAddGpsIndex(_0x25f269,_0x1555a5){const _0x3ced9b=_0x438560;let _0x1a7acb=0x7d0,_0x568117=dbFileIndexTable[_0x3ced9b(0x89)](_0x25f269,_0x3ced9b(0xd4)+_0x1a7acb+'\x20and\x20height>='+_0x1a7acb+')\x20'+_0x1555a5,'*',dbFileIndexTable[_0x3ced9b(0xd6)]);if(_0x568117){let _0x521eae=_0x568117['original_time']-0xe10*0x3e8*0xc,_0x9e86e2=_0x568117[_0x3ced9b(0xc4)]+0xe10*0x3e8*0xc,_0x31d6ad='\x20\x20latitude\x20is\x20not\x20null\x20and\x20latitude!=\x27undefined\x27\x20and\x20geohash5\x20!=\x27undefined\x27\x20and\x20original_time\x20between\x20'+_0x521eae+_0x3ced9b(0xa9)+_0x9e86e2+_0x3ced9b(0x88)+_0x1a7acb+_0x3ced9b(0xd2)+_0x1a7acb+_0x3ced9b(0x95)+_0x1555a5+'\x20order\x20by\x20abs(original_time-'+_0x568117[_0x3ced9b(0xc4)]+_0x3ced9b(0x9f),_0x5178e7=dbFileIndexTable['getAllByWhere'](_0x25f269,_0x31d6ad,'*',dbFileIndexTable[_0x3ced9b(0xd6)]);if(_0x5178e7&&_0x5178e7[_0x3ced9b(0xb4)]>0x0){let _0x9cf51=[];if(_0x568117['mode']&&_0x568117[_0x3ced9b(0xb5)]!=_0x3ced9b(0xc6)){let _0x258c41=0x32,_0x21ce1c=_0x568117['original_time']-0xe10*0x3e8*0x3,_0x3fceff=_0x568117[_0x3ced9b(0xc4)]+0xe10*0x3e8*0x3;_0x568117[_0x3ced9b(0xb5)]&&_0x568117[_0x3ced9b(0xb5)]!='undefined'&&(_0x9cf51=dbFileIndexTable[_0x3ced9b(0x94)](_0x25f269,_0x3ced9b(0xbd)+_0x568117['mode']+_0x3ced9b(0xbc)+_0x21ce1c+'\x20and\x20'+_0x3fceff+'\x20\x20'+_0x1555a5+_0x3ced9b(0x9d)+_0x258c41,'*',dbFileIndexTable[_0x3ced9b(0xd6)]));}else _0x9cf51[_0x3ced9b(0xab)](_0x568117);for(let _0x1aaf86 in _0x9cf51){_0x9cf51[_0x1aaf86][_0x3ced9b(0xad)]=path['join'](_0x9cf51[_0x1aaf86]['path'],_0x9cf51[_0x1aaf86][_0x3ced9b(0xdf)]);}if(_0x9cf51['length']==0x1)return dbFileIndexTable[_0x3ced9b(0xaf)](_0x25f269,_0x9cf51[0x0]['id'],_0x3ced9b(0x8a),0x1,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),getWaitAddGpsIndex(_0x25f269,_0x1555a5);return{'dealList':_0x9cf51,'nearIndex':_0x5178e7};}else return dbFileIndexTable['updateById'](_0x25f269,_0x568117['id'],_0x3ced9b(0x8a),0x1,dbFileIndexTable[_0x3ced9b(0xd6)]),getWaitAddGpsIndex(_0x25f269,_0x1555a5);}else return![];}router[_0x438560(0xdd)](_0x438560(0xa6),(_0x3a4253,_0x47ce27,_0x3f33f1)=>{const _0x14b45a=_0x438560;let _0x57a1ca={'code':0x0,'data':''};if(dbUserTable['doUserCanGet'](_0x3a4253,_0x47ce27,_0x14b45a(0xbf),_0x14b45a(0xe0))==!![]){let _0x1195b9='';_0x3a4253[_0x14b45a(0xe2)][_0x14b45a(0xaa)]!=0x1&&(_0x1195b9=dbUserTable[_0x14b45a(0x9e)](_0x3a4253,'photo','power_get',!![]));let _0x23f13e=getWaitAddGpsIndex(_0x3a4253[_0x14b45a(0x8f)][_0x14b45a(0x87)],_0x1195b9);return _0x23f13e&&(_0x57a1ca[_0x14b45a(0xba)]=_0x23f13e),_0x47ce27[_0x14b45a(0xae)](_0x57a1ca);}}),router['post'](_0x438560(0x9b),(_0x438b99,_0x403cef,_0x1ad670)=>{const _0x31b7e6=_0x438560;let _0x433a59=_0x438b99['body'][_0x31b7e6(0xbe)],_0x348e6d=_0x438b99['body'][_0x31b7e6(0xc1)];if(_0x348e6d[_0x31b7e6(0xb4)]<0x1)return _0x403cef['json']({'code':0x0});nasAccountUtil['isVip'](null,_0x438b99[_0x31b7e6(0x8f)][_0x31b7e6(0x8c)])[_0x31b7e6(0xa3)](_0x425ccd=>{const _0x133ddb=_0x31b7e6;if(!_0x425ccd)return _0x438b99[_0x133ddb(0x8f)][_0x133ddb(0xd5)](_0x403cef,_0x403cef['__'](_0x133ddb(0xcf)));else _0x1cc696();});function _0x1cc696(){const _0x2ce8e4=_0x31b7e6;if(dbUserTable[_0x2ce8e4(0x9a)](_0x438b99,_0x403cef,_0x2ce8e4(0xbf),'power_change')==!![]){let _0x1ac7cf='(';for(let _0x1ea1b6 in _0x348e6d){_0x1ac7cf+=_0x348e6d[_0x1ea1b6],_0x1ea1b6!=_0x348e6d[_0x2ce8e4(0xb4)]-0x1&&(_0x1ac7cf+=',');}_0x1ac7cf+=')';if(_0x433a59==_0x2ce8e4(0xb2))return _0x438b99[_0x2ce8e4(0x8f)]['dbFileIndex']['prepare'](_0x2ce8e4(0xd1)+_0x1ac7cf+'\x20')[_0x2ce8e4(0xb1)](),_0x403cef[_0x2ce8e4(0xae)]({'code':0x0});else{if(_0x433a59=='CONFIRM'){let _0x4e5735=_0x438b99[_0x2ce8e4(0xdc)][_0x2ce8e4(0xe4)],_0xe3c870=_0x438b99['body'][_0x2ce8e4(0xac)];if(!_0x4e5735||!_0xe3c870)return _0x403cef['json']({'code':0x0});_0x438b99[_0x2ce8e4(0x8f)][_0x2ce8e4(0x87)][_0x2ce8e4(0x90)](_0x2ce8e4(0x8d)+_0x1ac7cf+'\x20')['run']();let _0x2f87ae=0x0,_0x160472=0x0;for(let _0x2441ad in _0x348e6d){let _0x2d2c57=dbFileIndexTable[_0x2ce8e4(0xda)](_0x438b99[_0x2ce8e4(0x8f)][_0x2ce8e4(0x87)],_0x348e6d[_0x2441ad]);if(!_0x2d2c57)continue;let _0x399cab=path[_0x2ce8e4(0x96)](_0x2d2c57['path'],path[_0x2ce8e4(0xc8)],_0x2d2c57[_0x2ce8e4(0xdf)]),_0x774108=fs['statSync'](_0x399cab);if(!_0x774108['isFile']()){_0x160472+=0x1,_0x17adbe();continue;}fs['readFile'](_0x399cab,(_0x1a9135,_0x2993a8)=>{const _0x4a8bbd=_0x2ce8e4;if(_0x1a9135)return _0x160472+=0x1,_0x17adbe();var _0x3bc26a=piexif['load'](_0x2993a8[_0x4a8bbd(0xce)](_0x4a8bbd(0xd9)));if(_0x4e5735&&_0xe3c870){function _0x38f44a(_0x1a721b){const _0x480c28=_0x4a8bbd;try{_0x1a721b=Number(_0x1a721b);let _0x1fe48c=Math['floor'](Math[_0x480c28(0xe5)](_0x1a721b)),_0x529212=(Math['abs'](_0x1a721b)-_0x1fe48c)*0x3c,_0x117d51=Math['floor'](_0x529212),_0x5718ad=Math['round']((_0x529212-_0x117d51)*0x3c*0x64);return[[_0x1fe48c,0x1],[_0x117d51,0x1],[_0x5718ad,0x64]];}catch(_0x576da2){return'';}}_0x3bc26a['GPS'][piexif['GPSIFD'][_0x4a8bbd(0xb6)]]=_0x4e5735<0x0?'S':'N',_0x3bc26a[_0x4a8bbd(0xb7)][piexif['GPSIFD'][_0x4a8bbd(0xcd)]]=_0x38f44a(_0x4e5735),_0x3bc26a[_0x4a8bbd(0xb7)][piexif[_0x4a8bbd(0xc7)][_0x4a8bbd(0x8b)]]=_0xe3c870<0x0?'W':'E',_0x3bc26a[_0x4a8bbd(0xb7)][piexif[_0x4a8bbd(0xc7)]['GPSLongitude']]=_0x38f44a(_0xe3c870);let _0x14f443=geohash['encode'](_0x4e5735,_0xe3c870,0x8),_0x232027=_0x14f443[_0x4a8bbd(0x92)](0x0,0x5),_0x1c58a0=_0x14f443[_0x4a8bbd(0x92)](0x0,0x4),_0x500ff3=_0x14f443['substring'](0x0,0x3),_0xdf0a07=_0x14f443[_0x4a8bbd(0x92)](0x0,0x2);dbFileIndexTable['updateBySql'](_0x438b99['app'][_0x4a8bbd(0x87)],_0x2d2c57['id'],_0x4a8bbd(0xd0)+_0x4e5735+_0x4a8bbd(0x93)+_0xe3c870+_0x4a8bbd(0xd7)+_0x14f443+_0x4a8bbd(0xa2)+_0x232027+_0x4a8bbd(0xb3)+_0x1c58a0+_0x4a8bbd(0xbb)+_0x500ff3+'\x27,geohash2=\x27'+_0xdf0a07+'\x27\x20');}try{var _0x137950=piexif[_0x4a8bbd(0xa0)](_0x3bc26a),_0x50f8f0=piexif[_0x4a8bbd(0xdb)](_0x137950,_0x2993a8[_0x4a8bbd(0xce)](_0x4a8bbd(0xd9)));let _0x89ad4c=path['join'](_0x2d2c57[_0x4a8bbd(0xb9)],_0x2d2c57[_0x4a8bbd(0xdf)]);fs[_0x4a8bbd(0xa8)](_0x89ad4c,Buffer[_0x4a8bbd(0xb0)](_0x50f8f0,_0x4a8bbd(0xd9)),{},_0x56d836=>{const _0x4e8bf9=_0x4a8bbd;if(_0x56d836)return _0x160472+=0x1,_0x17adbe();fs[_0x4e8bf9(0x97)](_0x89ad4c,new Date(_0x2d2c57[_0x4e8bf9(0xa4)]),new Date(_0x2d2c57[_0x4e8bf9(0xa4)]),_0x21f28c=>{_0x21f28c&&console['log'](_0x21f28c),fs['stat'](_0x89ad4c,(_0x44c4c6,_0x155e9f)=>{const _0x48475e=_0x3193;if(_0x44c4c6)return _0x160472+=0x1,_0x17adbe();dbFileIndexTable[_0x48475e(0xc5)](_0x438b99['app'][_0x48475e(0x87)],_0x2d2c57['id'],_0x48475e(0x99)+_0x155e9f[_0x48475e(0x91)]+_0x48475e(0xe1)+_0x155e9f[_0x48475e(0xb8)]+'\x20'),_0x2f87ae+=0x1,_0x17adbe();});});});}catch(_0x446719){return _0x160472+=0x1,_0x17adbe();}});}function _0x17adbe(){const _0x5adf0d=_0x2ce8e4;if(_0x2f87ae+_0x160472>=_0x348e6d[_0x5adf0d(0xb4)])return _0x403cef[_0x5adf0d(0xae)]({'code':0x0,'sucCount':_0x2f87ae,'errorCount':_0x160472}),!![];}}}}}}),module[_0x438560(0xa1)]=router;