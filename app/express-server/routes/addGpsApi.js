function _0x5b9f(_0x57df72,_0x4554a6){const _0x2a9a0b=_0x2a9a();return _0x5b9f=function(_0x5b9f02,_0x53a2a9){_0x5b9f02=_0x5b9f02-0x13b;let _0x4c3a74=_0x2a9a0b[_0x5b9f02];return _0x4c3a74;},_0x5b9f(_0x57df72,_0x4554a6);}const _0x2398a5=_0x5b9f;(function(_0x313ebd,_0x379f16){const _0x1a4f25=_0x5b9f,_0x2e8f8e=_0x313ebd();while(!![]){try{const _0x48ff11=-parseInt(_0x1a4f25(0x13b))/0x1*(parseInt(_0x1a4f25(0x174))/0x2)+parseInt(_0x1a4f25(0x170))/0x3*(parseInt(_0x1a4f25(0x144))/0x4)+parseInt(_0x1a4f25(0x194))/0x5+parseInt(_0x1a4f25(0x18b))/0x6+-parseInt(_0x1a4f25(0x16d))/0x7*(-parseInt(_0x1a4f25(0x16f))/0x8)+-parseInt(_0x1a4f25(0x13d))/0x9*(-parseInt(_0x1a4f25(0x150))/0xa)+-parseInt(_0x1a4f25(0x176))/0xb;if(_0x48ff11===_0x379f16)break;else _0x2e8f8e['push'](_0x2e8f8e['shift']());}catch(_0x2dbaed){_0x2e8f8e['push'](_0x2e8f8e['shift']());}}}(_0x2a9a,0xd600c));let express=require(_0x2398a5(0x14b)),router=express[_0x2398a5(0x13e)](),path=require(_0x2398a5(0x16e));function _0x2a9a(){const _0x50a884=['\x27\x20and\x20original_time\x20between\x20','217814sZfMzV','\x27,longitude=\x27','14139261oHUIJh','Router','ctimeMs','length','updateBySql',')\x20\x20','statSync','8WNlTGk','GPSIFD','filename','mtime','power_get','app','body','express','doUserCanGet','\x27,geohash3=\x27','latitude','getAllByWhere','10qQcsNL','load','exports','is_admin','join','\x20\x20and\x20(width>=','insert','binary','undefined','round','original_time','ngeohash','abs','\x20or\x20height>=','toString','../../express-server/utils/nasAccountUtils','/getWaitAddGpsIndex','\x20and\x20',',ctime=','../../db/dbFileIndexTable','getByWhere','data','piexifjs','\x20and\x20height>=','type','updateById','dbFileIndex','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20(width>=','proxy.isntVip','21WVbrtW','path','1783104bpcVVv','622779VCOLeC','GPSLatitudeRef','CONFIRM','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20mode=\x27','4solAxi','photo','31753590XTUaiY','GPSLatitude','log','longitude','GPSLongitude','\x20\x20latitude\x20is\x20not\x20null\x20and\x20latitude!=\x27undefined\x27\x20and\x20geohash5\x20!=\x27undefined\x27\x20and\x20original_time\x20between\x20','run','\x27,geohash4=\x27','json','currentUser','\x20order\x20by\x20abs(original_time-','prepare','mode','fullPath','getUserPathWhere','post','substring','\x20order\x20by\x20original_time\x20limit\x20','\x20size=','sep','UPDATE\x20file_index_photo\x20set\x20add_gps_status=2\x20WHERE\x20id\x20IN\x20','4508826MrvrJn','GPSLongitudeRef','../../db/dbUserTable','/confirmAddGps','add_gps_status','dbOther','stat','size','GPS','3962620HXONQE','\x27,geohash5=\x27','floor','isVip','INDEX_TABLE_NAME_PHOTO','from','UPDATE\x20file_index_photo\x20set\x20add_gps_status=1\x20WHERE\x20id\x20IN\x20'];_0x2a9a=function(){return _0x50a884;};return _0x2a9a();}const dbUserTable=require(_0x2398a5(0x18d)),dbFileIndexTable=require(_0x2398a5(0x163));let fs=require('fs'),nasAccountUtil=require(_0x2398a5(0x15f)),piexif=require(_0x2398a5(0x166)),geohash=require(_0x2398a5(0x15b));function getWaitAddGpsIndex(_0x3703d1,_0x25a189){const _0x281486=_0x2398a5;let _0x4d81c8=0x7d0,_0x2e99dd=dbFileIndexTable[_0x281486(0x164)](_0x3703d1,_0x281486(0x16b)+_0x4d81c8+_0x281486(0x167)+_0x4d81c8+')\x20'+_0x25a189,'*',dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']);if(_0x2e99dd){let _0x35c102=_0x2e99dd[_0x281486(0x15a)]-0xe10*0x3e8*0xc,_0x5379bb=_0x2e99dd['original_time']+0xe10*0x3e8*0xc,_0x26177c=_0x281486(0x17b)+_0x35c102+_0x281486(0x161)+_0x5379bb+_0x281486(0x155)+_0x4d81c8+_0x281486(0x15d)+_0x4d81c8+_0x281486(0x142)+_0x25a189+_0x281486(0x180)+_0x2e99dd['original_time']+')\x20asc\x20limit\x2050',_0x32ebd8=dbFileIndexTable['getAllByWhere'](_0x3703d1,_0x26177c,'*',dbFileIndexTable[_0x281486(0x198)]);if(_0x32ebd8&&_0x32ebd8[_0x281486(0x140)]>0x0){let _0x4a0606=[];if(_0x2e99dd[_0x281486(0x182)]&&_0x2e99dd[_0x281486(0x182)]!=_0x281486(0x158)){let _0x4208f7=0x32,_0x4763df=_0x2e99dd[_0x281486(0x15a)]-0xe10*0x3e8*0x3,_0x196c2f=_0x2e99dd[_0x281486(0x15a)]+0xe10*0x3e8*0x3;_0x2e99dd['mode']&&_0x2e99dd[_0x281486(0x182)]!=_0x281486(0x158)&&(_0x4a0606=dbFileIndexTable[_0x281486(0x14f)](_0x3703d1,_0x281486(0x173)+_0x2e99dd[_0x281486(0x182)]+_0x281486(0x19b)+_0x4763df+_0x281486(0x161)+_0x196c2f+'\x20\x20'+_0x25a189+_0x281486(0x187)+_0x4208f7,'*',dbFileIndexTable[_0x281486(0x198)]));}else _0x4a0606['push'](_0x2e99dd);for(let _0x359bfa in _0x4a0606){_0x4a0606[_0x359bfa][_0x281486(0x183)]=path[_0x281486(0x154)](_0x4a0606[_0x359bfa]['path'],_0x4a0606[_0x359bfa][_0x281486(0x146)]);}if(_0x4a0606[_0x281486(0x140)]==0x1)return dbFileIndexTable[_0x281486(0x169)](_0x3703d1,_0x4a0606[0x0]['id'],'add_gps_status',0x1,dbFileIndexTable[_0x281486(0x198)]),getWaitAddGpsIndex(_0x3703d1,_0x25a189);return{'dealList':_0x4a0606,'nearIndex':_0x32ebd8};}else return dbFileIndexTable[_0x281486(0x169)](_0x3703d1,_0x2e99dd['id'],_0x281486(0x18f),0x1,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),getWaitAddGpsIndex(_0x3703d1,_0x25a189);}else return![];}router['post'](_0x2398a5(0x160),(_0x1be43b,_0x97820b,_0x5d8ac5)=>{const _0x38b294=_0x2398a5;let _0x347edc={'code':0x0,'data':''};if(dbUserTable[_0x38b294(0x14c)](_0x1be43b,_0x97820b,'photo',_0x38b294(0x148))==!![]){let _0x5079a6='';_0x1be43b[_0x38b294(0x17f)][_0x38b294(0x153)]!=0x1&&(_0x5079a6=dbUserTable[_0x38b294(0x184)](_0x1be43b,_0x38b294(0x175),_0x38b294(0x148),!![]));let _0x1d6e23=getWaitAddGpsIndex(_0x1be43b['app']['dbFileIndex'],_0x5079a6);return _0x1d6e23&&(_0x347edc[_0x38b294(0x165)]=_0x1d6e23),_0x97820b[_0x38b294(0x17e)](_0x347edc);}}),router[_0x2398a5(0x185)](_0x2398a5(0x18e),(_0x4303a8,_0x51b799,_0x22ffe4)=>{const _0x173ecc=_0x2398a5;let _0x4fdf40=_0x4303a8[_0x173ecc(0x14a)][_0x173ecc(0x168)],_0x50c8a9=_0x4303a8[_0x173ecc(0x14a)]['indexIdList'];if(_0x50c8a9[_0x173ecc(0x140)]<0x1)return _0x51b799[_0x173ecc(0x17e)]({'code':0x0});nasAccountUtil[_0x173ecc(0x197)](null,_0x4303a8['app'][_0x173ecc(0x190)])['then'](_0x2df02b=>{const _0x5709a7=_0x173ecc;if(!_0x2df02b)return _0x4303a8[_0x5709a7(0x149)]['returnErrMsg'](_0x51b799,_0x51b799['__'](_0x5709a7(0x16c)));else _0x4b8a22();});function _0x4b8a22(){const _0x5769e3=_0x173ecc;if(dbUserTable['doUserCanGet'](_0x4303a8,_0x51b799,_0x5769e3(0x175),'power_change')==!![]){let _0x5693cd='(';for(let _0x18984f in _0x50c8a9){_0x5693cd+=_0x50c8a9[_0x18984f],_0x18984f!=_0x50c8a9['length']-0x1&&(_0x5693cd+=',');}_0x5693cd+=')';if(_0x4fdf40=='SKIP')return _0x4303a8[_0x5769e3(0x149)][_0x5769e3(0x16a)][_0x5769e3(0x181)](_0x5769e3(0x18a)+_0x5693cd+'\x20')[_0x5769e3(0x17c)](),_0x51b799[_0x5769e3(0x17e)]({'code':0x0});else{if(_0x4fdf40==_0x5769e3(0x172)){let _0x50d338=_0x4303a8[_0x5769e3(0x14a)][_0x5769e3(0x14e)],_0x815015=_0x4303a8['body'][_0x5769e3(0x179)];if(!_0x50d338||!_0x815015)return _0x51b799[_0x5769e3(0x17e)]({'code':0x0});_0x4303a8[_0x5769e3(0x149)][_0x5769e3(0x16a)][_0x5769e3(0x181)](_0x5769e3(0x19a)+_0x5693cd+'\x20')['run']();let _0x141e2a=0x0,_0x5092ef=0x0;for(let _0x49efb2 in _0x50c8a9){let _0x43b882=dbFileIndexTable['getById'](_0x4303a8[_0x5769e3(0x149)][_0x5769e3(0x16a)],_0x50c8a9[_0x49efb2]);if(!_0x43b882)continue;let _0x378252=path[_0x5769e3(0x154)](_0x43b882[_0x5769e3(0x16e)],path[_0x5769e3(0x189)],_0x43b882[_0x5769e3(0x146)]),_0xb18155=fs[_0x5769e3(0x143)](_0x378252);if(!_0xb18155['isFile']()){_0x5092ef+=0x1,_0x25c2b2();continue;}fs['readFile'](_0x378252,(_0x59e242,_0xb47a74)=>{const _0x16fef6=_0x5769e3;if(_0x59e242)return _0x5092ef+=0x1,_0x25c2b2();let _0x463dbc=null;try{_0x463dbc=piexif[_0x16fef6(0x151)](_0xb47a74[_0x16fef6(0x15e)](_0x16fef6(0x157)));}catch(_0x400a65){console[_0x16fef6(0x178)](_0x400a65);}if(!_0x463dbc)return _0x5092ef+=0x1,_0x25c2b2();if(_0x50d338&&_0x815015){function _0x38cde6(_0x168abe){const _0x55312f=_0x16fef6;try{_0x168abe=Number(_0x168abe);let _0x18af2c=Math[_0x55312f(0x196)](Math[_0x55312f(0x15c)](_0x168abe)),_0x1332f4=(Math[_0x55312f(0x15c)](_0x168abe)-_0x18af2c)*0x3c,_0x5999f4=Math[_0x55312f(0x196)](_0x1332f4),_0x57b2ae=Math[_0x55312f(0x159)]((_0x1332f4-_0x5999f4)*0x3c*0x64);return[[_0x18af2c,0x1],[_0x5999f4,0x1],[_0x57b2ae,0x64]];}catch(_0x5856){return'';}}_0x463dbc[_0x16fef6(0x193)][piexif[_0x16fef6(0x145)][_0x16fef6(0x171)]]=_0x50d338<0x0?'S':'N',_0x463dbc[_0x16fef6(0x193)][piexif[_0x16fef6(0x145)][_0x16fef6(0x177)]]=_0x38cde6(_0x50d338),_0x463dbc[_0x16fef6(0x193)][piexif['GPSIFD'][_0x16fef6(0x18c)]]=_0x815015<0x0?'W':'E',_0x463dbc[_0x16fef6(0x193)][piexif[_0x16fef6(0x145)][_0x16fef6(0x17a)]]=_0x38cde6(_0x815015);let _0x1b1406=geohash['encode'](_0x50d338,_0x815015,0x8),_0x50cad1=_0x1b1406['substring'](0x0,0x5),_0x467fd5=_0x1b1406[_0x16fef6(0x186)](0x0,0x4),_0x4216d6=_0x1b1406[_0x16fef6(0x186)](0x0,0x3),_0x4d0ccb=_0x1b1406[_0x16fef6(0x186)](0x0,0x2);dbFileIndexTable[_0x16fef6(0x141)](_0x4303a8[_0x16fef6(0x149)][_0x16fef6(0x16a)],_0x43b882['id'],'\x20latitude=\x27'+_0x50d338+_0x16fef6(0x13c)+_0x815015+'\x27,geohash=\x27'+_0x1b1406+_0x16fef6(0x195)+_0x50cad1+_0x16fef6(0x17d)+_0x467fd5+_0x16fef6(0x14d)+_0x4216d6+'\x27,geohash2=\x27'+_0x4d0ccb+'\x27\x20');}try{var _0x5ca599=piexif['dump'](_0x463dbc),_0x242824=piexif[_0x16fef6(0x156)](_0x5ca599,_0xb47a74[_0x16fef6(0x15e)]('binary'));let _0x2e6012=path['join'](_0x43b882[_0x16fef6(0x16e)],_0x43b882[_0x16fef6(0x146)]);fs['writeFile'](_0x2e6012,Buffer[_0x16fef6(0x199)](_0x242824,_0x16fef6(0x157)),{},_0x1b8ad0=>{const _0x2962c8=_0x16fef6;if(_0x1b8ad0)return _0x5092ef+=0x1,_0x25c2b2();fs['utimes'](_0x2e6012,new Date(_0x43b882['mtime']),new Date(_0x43b882[_0x2962c8(0x147)]),_0x5d9b40=>{const _0x40ae3b=_0x2962c8;_0x5d9b40&&console[_0x40ae3b(0x178)](_0x5d9b40),fs[_0x40ae3b(0x191)](_0x2e6012,(_0x515e38,_0x57760a)=>{const _0x485a6e=_0x40ae3b;if(_0x515e38)return _0x5092ef+=0x1,_0x25c2b2();dbFileIndexTable[_0x485a6e(0x141)](_0x4303a8['app']['dbFileIndex'],_0x43b882['id'],_0x485a6e(0x188)+_0x57760a[_0x485a6e(0x192)]+_0x485a6e(0x162)+_0x57760a[_0x485a6e(0x13f)]+'\x20'),_0x141e2a+=0x1,_0x25c2b2();});});});}catch(_0x51391b){return _0x5092ef+=0x1,_0x25c2b2();}});}function _0x25c2b2(){const _0x259e4b=_0x5769e3;if(_0x141e2a+_0x5092ef>=_0x50c8a9['length'])return _0x51b799[_0x259e4b(0x17e)]({'code':0x0,'sucCount':_0x141e2a,'errorCount':_0x5092ef}),!![];}}}}}}),module[_0x2398a5(0x152)]=router;