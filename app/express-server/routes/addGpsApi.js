const _0x34cab2=_0x2c0f;(function(_0xd4c301,_0x35378d){const _0x5dd93b=_0x2c0f,_0x527e0b=_0xd4c301();while(!![]){try{const _0x2616b2=parseInt(_0x5dd93b(0x1be))/0x1*(-parseInt(_0x5dd93b(0x196))/0x2)+-parseInt(_0x5dd93b(0x1dd))/0x3*(parseInt(_0x5dd93b(0x1a9))/0x4)+-parseInt(_0x5dd93b(0x1cd))/0x5+-parseInt(_0x5dd93b(0x18f))/0x6+parseInt(_0x5dd93b(0x19b))/0x7*(-parseInt(_0x5dd93b(0x1d0))/0x8)+-parseInt(_0x5dd93b(0x1a7))/0x9*(parseInt(_0x5dd93b(0x1b7))/0xa)+parseInt(_0x5dd93b(0x1d5))/0xb;if(_0x2616b2===_0x35378d)break;else _0x527e0b['push'](_0x527e0b['shift']());}catch(_0x90dd8f){_0x527e0b['push'](_0x527e0b['shift']());}}}(_0x6581,0x5cfdc));let express=require(_0x34cab2(0x198)),router=express[_0x34cab2(0x1b0)](),path=require('path');function _0x2c0f(_0x2cef95,_0x3d9e0d){const _0x65819a=_0x6581();return _0x2c0f=function(_0x2c0fc7,_0x3c64d4){_0x2c0fc7=_0x2c0fc7-0x18f;let _0x179050=_0x65819a[_0x2c0fc7];return _0x179050;},_0x2c0f(_0x2cef95,_0x3d9e0d);}const dbUserTable=require('../../db/dbUserTable'),dbFileIndexTable=require('../../db/dbFileIndexTable');let fs=require('fs'),nasAccountUtil=require(_0x34cab2(0x1cb)),piexif=require(_0x34cab2(0x1c2)),geohash=require(_0x34cab2(0x1bf));function getWaitAddGpsIndex(_0x426284,_0xee8f97){const _0x126d04=_0x34cab2;let _0x15a8f2=0x7d0,_0x27663f=dbFileIndexTable[_0x126d04(0x1db)](_0x426284,_0x126d04(0x1c9)+_0x15a8f2+'\x20and\x20height>='+_0x15a8f2+')\x20'+_0xee8f97,'*',dbFileIndexTable[_0x126d04(0x1e7)]);if(_0x27663f){let _0x349649=_0x27663f[_0x126d04(0x1b5)]-0xe10*0x3e8*0xc,_0x277ecb=_0x27663f[_0x126d04(0x1b5)]+0xe10*0x3e8*0xc,_0x1ea36b=_0x126d04(0x1a2)+_0x349649+_0x126d04(0x1c7)+_0x277ecb+'\x20\x20and\x20(width>='+_0x15a8f2+_0x126d04(0x192)+_0x15a8f2+')\x20\x20'+_0xee8f97+_0x126d04(0x1d9)+_0x27663f[_0x126d04(0x1b5)]+_0x126d04(0x1a8),_0x4b8cd2=dbFileIndexTable[_0x126d04(0x1cc)](_0x426284,_0x1ea36b,'*',dbFileIndexTable[_0x126d04(0x1e7)]);if(_0x4b8cd2&&_0x4b8cd2[_0x126d04(0x193)]>0x0){let _0x2ab836=[];if(_0x27663f[_0x126d04(0x1de)]&&_0x27663f[_0x126d04(0x1de)]!=_0x126d04(0x1ac)){let _0x5aed02=0x32,_0x48b9be=_0x27663f[_0x126d04(0x1b5)]-0xe10*0x3e8*0x3,_0x3144bc=_0x27663f[_0x126d04(0x1b5)]+0xe10*0x3e8*0x3;_0x27663f[_0x126d04(0x1de)]&&_0x27663f['mode']!=_0x126d04(0x1ac)&&(_0x2ab836=dbFileIndexTable[_0x126d04(0x1cc)](_0x426284,_0x126d04(0x1c6)+_0x27663f[_0x126d04(0x1de)]+_0x126d04(0x1d2)+_0x48b9be+_0x126d04(0x1c7)+_0x3144bc+'\x20\x20'+_0xee8f97+_0x126d04(0x1d8)+_0x5aed02,'*',dbFileIndexTable[_0x126d04(0x1e7)]));}else _0x2ab836[_0x126d04(0x1e1)](_0x27663f);for(let _0x5f57e4 in _0x2ab836){_0x2ab836[_0x5f57e4][_0x126d04(0x1ad)]=path[_0x126d04(0x1ae)](_0x2ab836[_0x5f57e4][_0x126d04(0x1d6)],_0x2ab836[_0x5f57e4][_0x126d04(0x1ba)]);}if(_0x2ab836[_0x126d04(0x193)]==0x1)return dbFileIndexTable['updateById'](_0x426284,_0x2ab836[0x0]['id'],_0x126d04(0x1a3),0x1,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO']),getWaitAddGpsIndex(_0x426284,_0xee8f97);return{'dealList':_0x2ab836,'nearIndex':_0x4b8cd2};}else return dbFileIndexTable['updateById'](_0x426284,_0x27663f['id'],'add_gps_status',0x1,dbFileIndexTable[_0x126d04(0x1e7)]),getWaitAddGpsIndex(_0x426284,_0xee8f97);}else return![];}router[_0x34cab2(0x1ce)]('/getWaitAddGpsIndex',(_0x221195,_0x4affb1,_0x142e82)=>{const _0x1c5f52=_0x34cab2;let _0x561172={'code':0x0,'data':''};if(dbUserTable[_0x1c5f52(0x1c5)](_0x221195,_0x4affb1,_0x1c5f52(0x195),_0x1c5f52(0x1ca))==!![]){let _0x223a7d='';_0x221195[_0x1c5f52(0x1bd)]['is_admin']!=0x1&&(_0x223a7d=dbUserTable['getUserPathWhere'](_0x221195,_0x1c5f52(0x195),_0x1c5f52(0x1ca),!![]));let _0xbd027f=getWaitAddGpsIndex(_0x221195[_0x1c5f52(0x1c0)][_0x1c5f52(0x1cf)],_0x223a7d);return _0xbd027f&&(_0x561172[_0x1c5f52(0x1af)]=_0xbd027f),_0x4affb1[_0x1c5f52(0x19c)](_0x561172);}}),router[_0x34cab2(0x1ce)](_0x34cab2(0x1ab),(_0x27193c,_0x4775b9,_0x17eaa2)=>{const _0x11665f=_0x34cab2;let _0x40b4a=_0x27193c[_0x11665f(0x19f)]['type'],_0x3fea4d=_0x27193c[_0x11665f(0x19f)][_0x11665f(0x1e2)];if(_0x3fea4d['length']<0x1)return _0x4775b9[_0x11665f(0x19c)]({'code':0x0});nasAccountUtil[_0x11665f(0x1a4)](null,_0x27193c[_0x11665f(0x1c0)][_0x11665f(0x1b1)])[_0x11665f(0x1bc)](_0x53c18b=>{const _0x554d71=_0x11665f;if(!_0x53c18b)return _0x27193c[_0x554d71(0x1c0)][_0x554d71(0x1c3)](_0x4775b9,_0x4775b9['__']('proxy.isntVip'));else _0x47e7e9();});function _0x47e7e9(){const _0x92dc61=_0x11665f;if(dbUserTable['doUserCanGet'](_0x27193c,_0x4775b9,_0x92dc61(0x195),'power_change')==!![]){let _0x1dbda0='(';for(let _0x46642f in _0x3fea4d){_0x1dbda0+=_0x3fea4d[_0x46642f],_0x46642f!=_0x3fea4d['length']-0x1&&(_0x1dbda0+=',');}_0x1dbda0+=')';if(_0x40b4a==_0x92dc61(0x191))return _0x27193c['app'][_0x92dc61(0x1cf)][_0x92dc61(0x1d3)](_0x92dc61(0x1d4)+_0x1dbda0+'\x20')['run'](),_0x4775b9[_0x92dc61(0x19c)]({'code':0x0});else{if(_0x40b4a==_0x92dc61(0x1bb)){let _0xff1452=_0x27193c['body'][_0x92dc61(0x197)],_0x1489a0=_0x27193c[_0x92dc61(0x19f)][_0x92dc61(0x194)];if(!_0xff1452||!_0x1489a0)return _0x4775b9[_0x92dc61(0x19c)]({'code':0x0});_0x27193c[_0x92dc61(0x1c0)][_0x92dc61(0x1cf)]['prepare'](_0x92dc61(0x1d7)+_0x1dbda0+'\x20')[_0x92dc61(0x1c8)]();let _0x157e70=0x0,_0x4b03d1=0x0;for(let _0xeffd05 in _0x3fea4d){let _0x3d7c9e=dbFileIndexTable['getById'](_0x27193c[_0x92dc61(0x1c0)]['dbFileIndex'],_0x3fea4d[_0xeffd05]);if(!_0x3d7c9e)continue;let _0x264069=path[_0x92dc61(0x1ae)](_0x3d7c9e[_0x92dc61(0x1d6)],path['sep'],_0x3d7c9e['filename']),_0x53d37d=fs[_0x92dc61(0x1da)](_0x264069);if(!_0x53d37d[_0x92dc61(0x1e8)]()){_0x4b03d1+=0x1,_0x45d259();continue;}fs[_0x92dc61(0x1b8)](_0x264069,(_0x588677,_0x127c7f)=>{const _0x42151f=_0x92dc61;if(_0x588677)return _0x4b03d1+=0x1,_0x45d259();var _0x38b553=piexif[_0x42151f(0x1b3)](_0x127c7f[_0x42151f(0x1b2)]('binary'));if(_0xff1452&&_0x1489a0){function _0x68878d(_0x366ccb){const _0x1ffdb1=_0x42151f;try{_0x366ccb=Number(_0x366ccb);let _0x43a0ae=Math[_0x1ffdb1(0x1aa)](Math['abs'](_0x366ccb)),_0x1f1889=(Math[_0x1ffdb1(0x19e)](_0x366ccb)-_0x43a0ae)*0x3c,_0x5080d1=Math[_0x1ffdb1(0x1aa)](_0x1f1889),_0xf2e58f=Math['round']((_0x1f1889-_0x5080d1)*0x3c*0x64);return[[_0x43a0ae,0x1],[_0x5080d1,0x1],[_0xf2e58f,0x64]];}catch(_0x259ae6){return'';}}_0x38b553[_0x42151f(0x19a)][piexif[_0x42151f(0x1c4)]['GPSLatitudeRef']]=_0xff1452<0x0?'S':'N',_0x38b553[_0x42151f(0x19a)][piexif[_0x42151f(0x1c4)][_0x42151f(0x1e6)]]=_0x68878d(_0xff1452),_0x38b553[_0x42151f(0x19a)][piexif[_0x42151f(0x1c4)][_0x42151f(0x1e4)]]=_0x1489a0<0x0?'W':'E',_0x38b553[_0x42151f(0x19a)][piexif[_0x42151f(0x1c4)]['GPSLongitude']]=_0x68878d(_0x1489a0);let _0x4dcbb8=geohash[_0x42151f(0x1e0)](_0xff1452,_0x1489a0,0x8),_0x56bf59=_0x4dcbb8[_0x42151f(0x1b6)](0x0,0x5),_0x3f199f=_0x4dcbb8[_0x42151f(0x1b6)](0x0,0x4),_0x530dd6=_0x4dcbb8[_0x42151f(0x1b6)](0x0,0x3),_0x522ef3=_0x4dcbb8[_0x42151f(0x1b6)](0x0,0x2);dbFileIndexTable[_0x42151f(0x1b9)](_0x27193c['app']['dbFileIndex'],_0x3d7c9e['id'],_0x42151f(0x1a1)+_0xff1452+_0x42151f(0x1a6)+_0x1489a0+_0x42151f(0x1e3)+_0x4dcbb8+'\x27,geohash5=\x27'+_0x56bf59+'\x27,geohash4=\x27'+_0x3f199f+'\x27,geohash3=\x27'+_0x530dd6+_0x42151f(0x1e5)+_0x522ef3+'\x27\x20');}try{var _0x1d71b0=piexif['dump'](_0x38b553),_0x29c22b=piexif[_0x42151f(0x199)](_0x1d71b0,_0x127c7f[_0x42151f(0x1b2)](_0x42151f(0x1b4)));let _0x3b1ae2=path[_0x42151f(0x1ae)](_0x3d7c9e[_0x42151f(0x1d6)],_0x3d7c9e[_0x42151f(0x1ba)]);fs[_0x42151f(0x1df)](_0x3b1ae2,Buffer[_0x42151f(0x1a5)](_0x29c22b,_0x42151f(0x1b4)),{},_0x108f6a=>{const _0x589c7e=_0x42151f;if(_0x108f6a)return _0x4b03d1+=0x1,_0x45d259();fs[_0x589c7e(0x1a0)](_0x3b1ae2,new Date(_0x3d7c9e[_0x589c7e(0x1d1)]),new Date(_0x3d7c9e['mtime']),_0xda3180=>{const _0x536bc5=_0x589c7e;_0xda3180&&console[_0x536bc5(0x1dc)](_0xda3180),fs[_0x536bc5(0x19d)](_0x3b1ae2,(_0x4a8a37,_0x46d726)=>{const _0x2fd654=_0x536bc5;if(_0x4a8a37)return _0x4b03d1+=0x1,_0x45d259();dbFileIndexTable['updateBySql'](_0x27193c['app'][_0x2fd654(0x1cf)],_0x3d7c9e['id'],'\x20size='+_0x46d726[_0x2fd654(0x190)]+',ctime='+_0x46d726[_0x2fd654(0x1c1)]+'\x20'),_0x157e70+=0x1,_0x45d259();});});});}catch(_0x566c7d){return _0x4b03d1+=0x1,_0x45d259();}});}function _0x45d259(){const _0x521537=_0x92dc61;if(_0x157e70+_0x4b03d1>=_0x3fea4d[_0x521537(0x193)])return _0x4775b9[_0x521537(0x19c)]({'code':0x0,'sucCount':_0x157e70,'errorCount':_0x4b03d1}),!![];}}}}}}),module['exports']=router;function _0x6581(){const _0x9800c1=['abs','body','utimes','\x20latitude=\x27','\x20\x20latitude\x20is\x20not\x20null\x20and\x20latitude!=\x27undefined\x27\x20and\x20geohash5\x20!=\x27undefined\x27\x20and\x20original_time\x20between\x20','add_gps_status','isVip','from','\x27,longitude=\x27','162063rTNTat',')\x20asc\x20limit\x2050','97832gpEmqy','floor','/confirmAddGps','undefined','fullPath','join','data','Router','dbOther','toString','load','binary','original_time','substring','180TLOqTg','readFile','updateBySql','filename','CONFIRM','then','currentUser','5ByaqSW','ngeohash','app','ctimeMs','piexifjs','returnErrMsg','GPSIFD','doUserCanGet','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20mode=\x27','\x20and\x20','run','\x20add_gps_status=0\x20and\x20type=1\x20and\x20ext\x20in\x20(\x27.jpg\x27,\x27.jpeg\x27,\x27.JPG\x27,\x27.JPEG\x27)\x20and\x20(latitude\x20is\x20null\x20or\x20latitude=\x27undefined\x27)\x20and\x20(width>=','power_get','../../express-server/utils/nasAccountUtils','getAllByWhere','1093810mNqdld','post','dbFileIndex','139352fUBqXr','mtime','\x27\x20and\x20original_time\x20between\x20','prepare','UPDATE\x20file_index_photo\x20set\x20add_gps_status=2\x20WHERE\x20id\x20IN\x20','28813081BjPGOx','path','UPDATE\x20file_index_photo\x20set\x20add_gps_status=1\x20WHERE\x20id\x20IN\x20','\x20order\x20by\x20original_time\x20limit\x20','\x20order\x20by\x20abs(original_time-','statSync','getByWhere','log','39MVAHqn','mode','writeFile','encode','push','indexIdList','\x27,geohash=\x27','GPSLongitudeRef','\x27,geohash2=\x27','GPSLatitude','INDEX_TABLE_NAME_PHOTO','isFile','4414218maEuSv','size','SKIP','\x20or\x20height>=','length','longitude','photo','180130dhGZmA','latitude','express','insert','GPS','77eriqSJ','json','stat'];_0x6581=function(){return _0x9800c1;};return _0x6581();}