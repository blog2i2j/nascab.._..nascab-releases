const _0x20ffcd=_0x1220;(function(_0x19efc5,_0x1828df){const _0x492325=_0x1220,_0x23b308=_0x19efc5();while(!![]){try{const _0x4c41ac=parseInt(_0x492325(0xed))/0x1*(parseInt(_0x492325(0x122))/0x2)+parseInt(_0x492325(0x123))/0x3+-parseInt(_0x492325(0xf5))/0x4*(parseInt(_0x492325(0x14b))/0x5)+parseInt(_0x492325(0x155))/0x6*(parseInt(_0x492325(0x14d))/0x7)+-parseInt(_0x492325(0x163))/0x8*(parseInt(_0x492325(0x16e))/0x9)+-parseInt(_0x492325(0xff))/0xa*(parseInt(_0x492325(0x138))/0xb)+parseInt(_0x492325(0xe7))/0xc;if(_0x4c41ac===_0x1828df)break;else _0x23b308['push'](_0x23b308['shift']());}catch(_0x27d751){_0x23b308['push'](_0x23b308['shift']());}}}(_0x40aa,0xe9492));let express=require('express'),router=express[_0x20ffcd(0xeb)](),path=require(_0x20ffcd(0x16f)),fs=require('fs'),dbBookIndexTable=require(_0x20ffcd(0x148)),dbFileIndexTable=require(_0x20ffcd(0x190)),dbBookListTable=require(_0x20ffcd(0x14c)),dbBookFavorite=require('../../db/dbBookFavorite');function _0x1220(_0xe6634c,_0x592a1a){const _0x40aafb=_0x40aa();return _0x1220=function(_0x122016,_0x1809d1){_0x122016=_0x122016-0xd5;let _0x229f45=_0x40aafb[_0x122016];return _0x229f45;},_0x1220(_0xe6634c,_0x592a1a);}const dbUserTable=require(_0x20ffcd(0x10a)),dbSourceFolderTable=require(_0x20ffcd(0x125));let os=require('os'),config=require(_0x20ffcd(0x193));const bookIndexUtil=require(_0x20ffcd(0x166)),arrayUtil=require('../../utils/arrayUtil'),nfoUtil=require('../../utils/nfoUtil');function getBookSameNameCover(_0x207ace){return new Promise((_0x3ed152,_0x4805f0)=>{const _0x383f2e=_0x1220;try{let _0x967429=_0x207ace[_0x383f2e(0x14a)][_0x383f2e(0x17e)](path[_0x383f2e(0x15a)](_0x207ace['filename']),''),_0x1481ad=path[_0x383f2e(0x119)](_0x207ace['path'],_0x967429+'.jpg'),_0x549f6c='';fs[_0x383f2e(0x170)](_0x1481ad)&&(_0x549f6c=_0x1481ad),_0x3ed152(_0x549f6c);}catch(_0x1ea9fc){_0x3ed152('');}});}router['post'](_0x20ffcd(0x128),(_0x53e7d3,_0x1b0b47,_0x4b5350)=>{const _0x43be41=_0x20ffcd;let _0x679431=_0x53e7d3[_0x43be41(0x184)]['id'],_0x2fc1fe=_0x53e7d3[_0x43be41(0xe2)][_0x43be41(0xe0)],_0x505d2c=_0x53e7d3['body'][_0x43be41(0x134)];if(!_0x2fc1fe&&!_0x505d2c)return _0x53e7d3['app']['returnErrMsg'](_0x1b0b47,'need\x20config\x20json');try{JSON[_0x43be41(0x12a)](_0x2fc1fe);}catch(_0x386eca){return _0x53e7d3[_0x43be41(0x18d)][_0x43be41(0x104)](_0x1b0b47,_0x43be41(0x141));}let _0x5936f1=_0x53e7d3[_0x43be41(0x18d)][_0x43be41(0x15e)][_0x43be41(0x14f)]('SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid=?')[_0x43be41(0xda)](_0x679431);if(_0x5936f1){if(_0x2fc1fe)_0x53e7d3[_0x43be41(0x18d)][_0x43be41(0x15e)][_0x43be41(0x14f)](_0x43be41(0x139))[_0x43be41(0x11f)](_0x2fc1fe,_0x679431);else _0x505d2c&&_0x53e7d3[_0x43be41(0x18d)][_0x43be41(0x15e)]['prepare'](_0x43be41(0x117))[_0x43be41(0x11f)](_0x505d2c,_0x679431);}else _0x53e7d3['app'][_0x43be41(0x15e)][_0x43be41(0x14f)](_0x43be41(0xe4))[_0x43be41(0x11f)](_0x679431,_0x2fc1fe,_0x505d2c);return _0x1b0b47['json']({'code':0x0});}),router['post'](_0x20ffcd(0x140),(_0x4273cc,_0x5aad01,_0x2acb76)=>{const _0x28839b=_0x20ffcd;let _0x54852c=_0x4273cc['currentUser']['id'],_0x2db354=_0x4273cc[_0x28839b(0xe2)][_0x28839b(0xe9)];if(!_0x2db354)return _0x4273cc[_0x28839b(0x18d)][_0x28839b(0x104)](_0x5aad01,_0x28839b(0x161));let _0x5200d7=dbFileIndexTable[_0x28839b(0x100)](_0x4273cc['app'][_0x28839b(0xe8)],_0x2db354,dbFileIndexTable[_0x28839b(0x149)]);if(!_0x5200d7)return _0x4273cc[_0x28839b(0x18d)][_0x28839b(0x104)](_0x5aad01,_0x28839b(0x161));dbUserTable[_0x28839b(0x154)](_0x4273cc,_0x5aad01,'',_0x28839b(0x151),_0x5200d7[_0x28839b(0x16f)])==!![]&&getBookSameNameCover(_0x5200d7)[_0x28839b(0x11b)](_0x412a46=>{const _0xde37bb=_0x28839b;if(!_0x412a46[_0xde37bb(0x187)](_0xde37bb(0xd5)))return _0x4273cc[_0xde37bb(0x18d)][_0xde37bb(0x104)](_0x5aad01,_0xde37bb(0xec));fs[_0xde37bb(0x169)](_0x412a46,(_0x5727e2,_0x358215)=>{const _0x3cb1f7=_0xde37bb;if(_0x5727e2)return console[_0x3cb1f7(0x137)](_0x3cb1f7(0xef)),_0x5aad01[_0x3cb1f7(0x186)]({'code':0x0});fs['rm'](_0x412a46,_0x18c915=>{const _0x1f4b4c=_0x3cb1f7;if(_0x18c915)return _0x4273cc[_0x1f4b4c(0x18d)][_0x1f4b4c(0x104)](_0x5aad01,_0x5aad01['__'](_0x1f4b4c(0x133))+_0x412a46);return console['log'](_0x1f4b4c(0x12e),_0x412a46),_0x5aad01[_0x1f4b4c(0x186)]({'code':0x0});});});});}),router[_0x20ffcd(0xdd)](_0x20ffcd(0x145),(_0x2004b5,_0x31da44,_0x377884)=>{const _0x329a28=_0x20ffcd;let _0x4e50f9=_0x2004b5[_0x329a28(0x184)]['id'],_0x2ece4a=_0x2004b5[_0x329a28(0xe2)]['bookIndexId'];if(!_0x2ece4a)return _0x31da44[_0x329a28(0xf6)](0x194)[_0x329a28(0x13a)]();return dbBookIndexTable[_0x329a28(0x167)](_0x2004b5[_0x329a28(0x18d)][_0x329a28(0xe8)],_0x2ece4a,'check_time',new Date()[_0x329a28(0x192)]()),_0x31da44[_0x329a28(0x186)]({'code':0x0});}),router[_0x20ffcd(0xdd)](_0x20ffcd(0xf9),(_0x55cf45,_0x38eb8b,_0x223b30)=>{const _0xe4cff7=_0x20ffcd;let _0x54151d=_0x55cf45[_0xe4cff7(0x184)]['id'];if(!_0x55cf45[_0xe4cff7(0xe2)][_0xe4cff7(0x116)]||!_0x55cf45[_0xe4cff7(0xe2)][_0xe4cff7(0xe5)]||!_0x55cf45['body']['progress'])return _0x38eb8b[_0xe4cff7(0x186)]({'code':0x0});let _0x5795dd=_0x55cf45[_0xe4cff7(0xe2)][_0xe4cff7(0x116)];_0x5795dd=path[_0xe4cff7(0x179)](_0x55cf45[_0xe4cff7(0xe2)][_0xe4cff7(0x116)]);let _0x2f66e0=path['join'](_0x55cf45[_0xe4cff7(0xe2)]['filePath']),_0x24142d=_0x55cf45[_0xe4cff7(0xe2)][_0xe4cff7(0x143)],_0x19ae54=_0x55cf45['app']['dbFileIndex'][_0xe4cff7(0x14f)]('SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?')[_0xe4cff7(0xda)](_0x54151d,_0x5795dd,_0x2f66e0);return _0x19ae54?_0x55cf45[_0xe4cff7(0x18d)][_0xe4cff7(0xe8)]['prepare'](_0xe4cff7(0x16a))[_0xe4cff7(0x11f)](_0x24142d,Date[_0xe4cff7(0x106)](),_0x54151d,_0x5795dd,_0x2f66e0):_0x55cf45[_0xe4cff7(0x18d)][_0xe4cff7(0xe8)][_0xe4cff7(0x14f)]('REPLACE\x20INTO\x20book_read_record\x20(uid,book_filename,book_path,progress,read_time)\x20VALUES(?,?,?,?,?)')[_0xe4cff7(0x11f)](_0x54151d,_0x5795dd,_0x2f66e0,_0x24142d,Date[_0xe4cff7(0x106)]()),_0x38eb8b[_0xe4cff7(0x186)]({'code':0x0});}),router[_0x20ffcd(0xdd)](_0x20ffcd(0x109),(_0x4918ef,_0x189bce,_0x236c7d)=>{const _0x24b370=_0x20ffcd;let _0x2d1f1d=_0x4918ef['currentUser']['id'],_0x9b6ca9=_0x4918ef[_0x24b370(0x18d)][_0x24b370(0x15e)][_0x24b370(0x14f)](_0x24b370(0x15f))[_0x24b370(0xda)](_0x2d1f1d),_0x1876a1=0x0,_0x379f10=_0x4918ef[_0x24b370(0xe2)][_0x24b370(0x116)],_0x53723e=_0x4918ef[_0x24b370(0xe2)]['filePath'];if(_0x379f10&&_0x53723e){_0x53723e=path[_0x24b370(0x119)](_0x53723e+'');let _0x2a996b=_0x4918ef[_0x24b370(0x18d)][_0x24b370(0xe8)]['prepare']('SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?')[_0x24b370(0xda)](_0x2d1f1d,_0x379f10,_0x53723e);_0x2a996b&&(_0x1876a1=_0x2a996b[_0x24b370(0x143)]);}return _0x189bce['json']({'code':0x0,'progress':_0x1876a1,'readerConfig':_0x9b6ca9});}),router[_0x20ffcd(0xdd)](_0x20ffcd(0x124),(_0x7d2a60,_0x190e12,_0x4e5b66)=>{const _0x263895=_0x20ffcd;let _0x2902c7=_0x7d2a60[_0x263895(0xe2)][_0x263895(0x108)],_0xa5fd0c=_0x7d2a60[_0x263895(0xe2)][_0x263895(0x13d)];if(!_0xa5fd0c||!_0x2902c7)return _0x7d2a60['app']['returnErrMsg'](_0x190e12,_0x263895(0x176));if(_0xa5fd0c!=0x1&&_0xa5fd0c!=0x2)return _0x7d2a60[_0x263895(0x18d)][_0x263895(0x104)](_0x190e12,_0x263895(0x112));let _0x45242d=dbBookIndexTable[_0x263895(0x146)](_0x7d2a60[_0x263895(0x18d)][_0x263895(0xe8)],_0x2902c7);if(!_0x45242d)return _0x7d2a60['app'][_0x263895(0x104)](_0x190e12,_0x263895(0xf2));if(dbUserTable['doUserCanGet'](_0x7d2a60,_0x190e12,_0x263895(0x182),_0x263895(0xd8),_0x45242d[_0x263895(0x16f)])==!![])return dbBookIndexTable[_0x263895(0x167)](_0x7d2a60[_0x263895(0x18d)]['dbFileIndex'],_0x2902c7,_0x263895(0x13d),_0xa5fd0c),_0x190e12['json']({'code':0x0});});function getListByParams(_0x403562,_0x3cf46f,_0x124411,_0x47cf3d,_0x289fef,_0x4702fc,_0x2d7e88,_0x1c2519,_0x4a9deb,_0x2c3025,_0x56031c,_0x1cbeaa,_0x2b5fa5){return new Promise((_0xa01d31,_0x5cbd60)=>{const _0x21fab9=_0x1220;let _0x4effe5=_0x403562[_0x21fab9(0x18d)][_0x21fab9(0xe8)],_0x3d213a=[];if(_0x47cf3d==_0x21fab9(0x173)||_0x47cf3d==_0x21fab9(0x158))_0x3d213a=dbBookIndexTable['getBookList'](_0x4effe5,_0x124411,_0x289fef,_0x4702fc,_0x2d7e88,_0x1c2519,_0x4a9deb,_0x56031c,_0x2c3025,_0x1cbeaa,_0x2b5fa5);else{if(_0x47cf3d==_0x21fab9(0xf7)){let _0x46a5de='',_0x49bf13=[];_0x46a5de+='\x20is_file=1';_0x2c3025&&(_0x2c3025=_0x2c3025[_0x21fab9(0x17e)]('\x27','')[_0x21fab9(0x17e)]('’',''),_0x46a5de+=_0x21fab9(0x132),_0x49bf13[_0x21fab9(0x165)]('%'+_0x2c3025+'%','%'+_0x2c3025+'%','%'+_0x2c3025+'%','%'+_0x2c3025+'%','%'+_0x2c3025+'%','%'+_0x2c3025+'%','%'+_0x2c3025+'%','%'+_0x2c3025+'%'));_0x1cbeaa&&(_0x46a5de+='\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)',_0x49bf13[_0x21fab9(0x165)](_0x1cbeaa,_0x1cbeaa));if(_0x2d7e88&&_0x1c2519){if(_0x2d7e88==_0x21fab9(0xf8))_0x46a5de+='\x20order\x20by\x20f.artist_fl\x20'+_0x1c2519+',f.artist\x20'+_0x1c2519+'\x20';else{if(_0x2d7e88==_0x21fab9(0x181))_0x46a5de+='\x20order\x20by\x20f.title_fl\x20'+_0x1c2519+',f.title\x20'+_0x1c2519+',f.filename_fl\x20'+_0x1c2519+'\x20';else _0x2d7e88=='favorite_time'?_0x46a5de+=_0x21fab9(0x13c)+_0x1c2519+'\x20':_0x46a5de+=_0x21fab9(0x17a)+_0x2d7e88+'\x20'+_0x1c2519+'\x20';}}else _0x46a5de+=_0x21fab9(0xfb);_0x46a5de+='\x20LIMIT\x20?\x20OFFSET\x20?\x20',_0x49bf13[_0x21fab9(0x165)](_0x289fef),_0x49bf13['push'](_0x4702fc),_0x3d213a=dbBookFavorite[_0x21fab9(0xf1)](_0x403562['app']['dbFileIndex'],_0x403562['currentUser']['id'],_0x46a5de,'*',_0x49bf13);}}setBookListProps(_0x403562,_0x3d213a)[_0x21fab9(0x11b)](_0x278551=>{_0xa01d31(_0x278551);});});}function setBookListProps(_0x2178b4,_0x3d1672){return new Promise(async(_0x588039,_0x435df2)=>{const _0xf70d81=_0x1220;for(let _0x54a2ad of _0x3d1672){_0x54a2ad[_0xf70d81(0xf7)]=dbBookFavorite['bookIsFavorite'](_0x2178b4[_0xf70d81(0x18d)][_0xf70d81(0xe8)],_0x54a2ad['id'],_0x2178b4[_0xf70d81(0x184)]['id'])?'1':'0',_0x54a2ad[_0xf70d81(0xe5)]=path[_0xf70d81(0x119)](_0x54a2ad[_0xf70d81(0x16f)],_0x54a2ad['filename']),_0x54a2ad['file_cover_path']=await getBookSameNameCover(_0x54a2ad);}_0x588039(_0x3d1672);});}function _0x40aa(){const _0x4fbcd8=['\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','power_change','sep','get','query','/updateBookNfo','post','sortFileNamesByNumber','name','configJson','add','body','fileExist','REPLACE\x20INTO\x20book_reader_config\x20(uid,config_json,remark)\x20VALUES(?,?,?)','filePath','NO\x20book\x20INDEX','27087084AHvTau','dbFileIndex','bookIndexId','orderField','Router','cover\x20format\x20error','2168vwQSay','edit','封面文件已不存在','fileCount','getAllFavoriteByWhere','book\x20not\x20exist','search','length','2496804HeMylf','status','favorite','artist','/addReadRecord','need\x20\x27name\x27','\x20order\x20by\x20m.update_time\x20DESC\x20','getBookListByPath','getFavoriteCount','getMediaCoverCachePath','4797710ZKOxkc','getById','nfo写入成功','catch','\x20path=?\x20\x20','returnErrMsg','operation','now','groupField','indexId','/getReadRecord','../../db/dbUserTable','power_get','sharpWriteCover','file_cover_path','addBookToBookList','operation\x20error','searchStr','orderType','need\x20type','platform','createBookList','book_count','fileName','UPDATE\x20book_reader_config\x20SET\x20remark=?\x20WHERE\x20uid=?','SELECT\x20id\x20from\x20file_index_book\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','join','\x20FROM\x20file_index_book\x20WHERE\x20','then','coverData','updateBook','deleteFavorite','run','nfo写入失败','substring','928gbQYhu','1699395nQVUBT','/setBookType','../../db/dbSourceFolderTable','folderNotExist','lastIndexOf','/setReaderConfig','letterIndex','parse','getFavorite','isbn','exports','封面文件已删除','size','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_size=?','\x20id,is_file,id,path,filename,type,size,title,artist,ext,cover_path,language,publisher,total_page,type,check_time,create_time','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20OR\x20artist\x20like\x20?\x20OR\x20tag\x20like\x20?\x20OR\x20publisher\x20like\x20?\x20OR\x20isbn\x20like\x20?\x20OR\x20genre\x20like\x20?\x20OR\x20year\x20like\x20?)','deleteFail','remark','/operationBookListIndex','SELECT\x20','log','11AncQzf','UPDATE\x20book_reader_config\x20SET\x20config_json=?\x20WHERE\x20uid=?','end','cover_path','\x20order\x20by\x20m.update_time\x20','type','error','/getBookDetail','/deleteSameNameCover','config\x20json\x20format\x20error','exist','progress','book_path','/refreshCheckTime','getBookIndex','getUserPathWhere','../../db/dbBookIndexTable','INDEX_TABLE_NAME_BOOK','filename','15OLHPmz','../../db/dbBookListTable','1167691IciUrn','all','prepare','index\x20id\x20error','power_delete','listType','recentAddList','doUserCanGet','12BPTUZl','count','delete','bookList','publisher','extname','includes','UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?','.nfo','dbOther','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid\x20=\x20?','updateBookList','need\x20bookIndexId','tag','3421552picQHJ','desc','push','../../myWorkers/index/bookIndexUtil','updateByFiled','year','stat','UPDATE\x20book_read_record\x20SET\x20progress=?,read_time=?\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','sendFile','getBookListById','checkOrderParams','18JnaoKg','path','existsSync','/getBookCover','is_file','list','is_admin','check_time','need\x20type/indexId','removeBookFromList','getPathByType','basename','\x20order\x20by\x20f.','need\x20bookIndexId/bookListId','saveBookNfo','bookListId','replace','/getGroupList','username','title','book','bookListId\x20no\x20exists','currentUser','orderField/orderType\x20error','json','endsWith','getBookListCount','/bookFavorite','offset','language','封面写入成功','app','parent','need\x20index\x20id','../../db/dbFileIndexTable','/operationBookList','getTime','../../myConfig/config','.jpg','play_count'];_0x40aa=function(){return _0x4fbcd8;};return _0x40aa();}router[_0x20ffcd(0xdd)]('/getHomeData',(_0x403b74,_0x337ff7,_0x1d3d6c)=>{const _0x32c9f5=_0x20ffcd;let _0x10e699=_0x403b74[_0x32c9f5(0xe2)][_0x32c9f5(0x156)]?_0x403b74[_0x32c9f5(0xe2)][_0x32c9f5(0x156)]:0xc,_0x4a75dd=_0x403b74[_0x32c9f5(0x184)]['id'],_0x18d7f7=dbUserTable[_0x32c9f5(0x147)](_0x403b74,'book',_0x32c9f5(0x10b),!![]);if(_0x403b74[_0x32c9f5(0x184)][_0x32c9f5(0x174)]!=0x1&&!_0x18d7f7)return _0x337ff7['json']({'code':0x0,'data':null});let _0x296a54=[],_0x7e63e4=_0x403b74[_0x32c9f5(0x18d)][_0x32c9f5(0xe8)][_0x32c9f5(0x14f)]('SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20ORDER\x20BY\x20read_time\x20desc\x20LIMIT\x20?')[_0x32c9f5(0x14e)](_0x4a75dd,_0x10e699);for(let _0x3b30e6 of _0x7e63e4){let _0x2d069c=dbBookIndexTable['getBookIndexByFileName'](_0x403b74[_0x32c9f5(0x18d)][_0x32c9f5(0xe8)],_0x3b30e6[_0x32c9f5(0x144)],_0x3b30e6['book_filename']);_0x2d069c&&dbUserTable[_0x32c9f5(0x154)](_0x403b74,_0x337ff7,_0x32c9f5(0x182),_0x32c9f5(0x10b),_0x2d069c[_0x32c9f5(0x16f)],!![])==!![]&&(_0x2d069c[_0x32c9f5(0x143)]=_0x3b30e6[_0x32c9f5(0x143)],_0x296a54['push'](_0x2d069c));}setBookListProps(_0x403b74,_0x296a54)[_0x32c9f5(0x11b)](_0x3b7401=>{const _0x1602d0=_0x32c9f5;_0x296a54=_0x3b7401,getListByParams(_0x403b74,_0x337ff7,_0x18d7f7,_0x1602d0(0x173),_0x10e699,0x0,_0x1602d0(0x175),_0x1602d0(0x164),null,null,null,null,0x1)[_0x1602d0(0x11b)](_0x26d5b6=>{const _0x33bdd3=_0x1602d0;getListByParams(_0x403b74,_0x337ff7,_0x18d7f7,_0x33bdd3(0x173),_0x10e699,0x0,_0x33bdd3(0x175),_0x33bdd3(0x164),null,null,null,null,0x2)[_0x33bdd3(0x11b)](_0x596b27=>{const _0x46ac69=_0x33bdd3;getListByParams(_0x403b74,_0x337ff7,_0x18d7f7,_0x46ac69(0x173),_0x10e699,0x0,'id',_0x46ac69(0x164))[_0x46ac69(0x11b)](_0x42d999=>{const _0x13c38c=_0x46ac69;let _0x2a5e84={};return _0x296a54&&_0x296a54['length']>0x0&&(_0x2a5e84['recentReadList']=_0x296a54),_0x42d999&&_0x42d999[_0x13c38c(0xf4)]>0x0&&(_0x2a5e84[_0x13c38c(0x153)]=_0x42d999),_0x26d5b6&&_0x26d5b6[_0x13c38c(0xf4)]>0x0&&(_0x2a5e84['bookList']=_0x26d5b6),_0x596b27&&_0x596b27[_0x13c38c(0xf4)]>0x0&&(_0x2a5e84['comicList']=_0x596b27),_0x337ff7[_0x13c38c(0x186)]({'code':0x0,'data':_0x2a5e84,'platform':os[_0x13c38c(0x113)]()});});});});});}),router[_0x20ffcd(0xdd)]('/getBookList',(_0x2d0422,_0x145cbc,_0x3df46a)=>{const _0x55d0ec=_0x20ffcd;let _0xc2672d=_0x2d0422['body'][_0x55d0ec(0x156)]||0x32,_0x3242bb=_0x2d0422[_0x55d0ec(0xe2)][_0x55d0ec(0x18a)]||0x0,_0x31b223=_0x2d0422[_0x55d0ec(0xe2)][_0x55d0ec(0xf8)],_0xfe90ff=_0x2d0422['body'][_0x55d0ec(0xea)]||_0x55d0ec(0x175),_0x43fb56=_0x2d0422[_0x55d0ec(0xe2)][_0x55d0ec(0x111)]||'desc',_0x2098fc=['list','favorite','bookList'],_0x46f69f=_0x2d0422['body'][_0x55d0ec(0x152)]||'list',_0x1c0063=_0x2d0422[_0x55d0ec(0xe2)]['search'],_0x50d471=_0x2d0422[_0x55d0ec(0xe2)][_0x55d0ec(0x129)],_0x4d0f2f=_0x2d0422['body'][_0x55d0ec(0x17d)],_0x1c943c=_0x2d0422[_0x55d0ec(0xe2)]['type'];if(dbBookIndexTable[_0x55d0ec(0x16d)](_0x2d0422,_0x145cbc,_0xfe90ff,_0x43fb56)!==!![])return;if(_0x46f69f==_0x55d0ec(0x158)){if(!_0x4d0f2f)return _0x2d0422[_0x55d0ec(0x18d)][_0x55d0ec(0x104)](_0x145cbc,'need\x20bookListId');}!_0x2098fc[_0x55d0ec(0x15b)](_0x46f69f)&&(_0x46f69f=_0x55d0ec(0x173));_0xc2672d>0x1f4&&(_0xc2672d=0x1f4);let _0x399d80=dbUserTable['getUserPathWhere'](_0x2d0422,_0x55d0ec(0x182),'power_get',!![]);if(_0x2d0422[_0x55d0ec(0x184)][_0x55d0ec(0x174)]!=0x1&&!_0x399d80)return _0x145cbc[_0x55d0ec(0x186)]({'code':0x0,'data':null});getListByParams(_0x2d0422,_0x145cbc,_0x399d80,_0x46f69f,_0xc2672d,_0x3242bb,_0xfe90ff,_0x43fb56,_0x31b223,_0x1c0063,_0x4d0f2f,_0x50d471,_0x1c943c)[_0x55d0ec(0x11b)](_0x2aa771=>{const _0x4ba5b6=_0x55d0ec;let _0xe4d3aa={'code':0x0,'data':_0x2aa771};if(_0x46f69f==_0x4ba5b6(0xf7))_0xe4d3aa[_0x4ba5b6(0x115)]=dbBookFavorite[_0x4ba5b6(0xfd)](_0x2d0422[_0x4ba5b6(0x18d)][_0x4ba5b6(0xe8)],_0x2d0422[_0x4ba5b6(0x184)]['id']);else{if(_0x46f69f==_0x4ba5b6(0x173))_0xe4d3aa['book_count']=dbBookIndexTable[_0x4ba5b6(0x188)](_0x2d0422['app'][_0x4ba5b6(0xe8)],_0x399d80,_0x31b223,_0x1c0063,_0x1c943c);else _0x46f69f==_0x4ba5b6(0x158)&&(_0xe4d3aa['book_count']=dbBookListTable['getBookListBookCount'](_0x2d0422['app'][_0x4ba5b6(0xe8)],_0x4d0f2f));}return _0x145cbc['json'](_0xe4d3aa);});}),router[_0x20ffcd(0xdd)](_0x20ffcd(0x13f),(_0x2cd976,_0x2ce70e,_0xaa9db9)=>{const _0x80f23f=_0x20ffcd;let _0xbb7978=_0x2cd976[_0x80f23f(0xe2)]['id'],_0x206c22=dbFileIndexTable[_0x80f23f(0x100)](_0x2cd976[_0x80f23f(0x18d)][_0x80f23f(0xe8)],_0xbb7978,dbFileIndexTable['INDEX_TABLE_NAME_BOOK']);if(!_0x206c22)return _0x2cd976[_0x80f23f(0x18d)][_0x80f23f(0x104)](_0x2ce70e,_0x80f23f(0xe6));if(dbUserTable[_0x80f23f(0x154)](_0x2cd976,_0x2ce70e,_0x80f23f(0x182),_0x80f23f(0x10b),_0x206c22[_0x80f23f(0x16f)])==!![]){let _0x16dc73=_0x2cd976[_0x80f23f(0x184)]['id'],_0x1c176c=dbBookFavorite[_0x80f23f(0x12b)](_0x2cd976[_0x80f23f(0x18d)][_0x80f23f(0xe8)],_0x16dc73,_0xbb7978);_0x206c22[_0x80f23f(0xf7)]=_0x1c176c?0x1:0x0,_0x206c22[_0x80f23f(0xe5)]=path[_0x80f23f(0x119)](_0x206c22[_0x80f23f(0x16f)],_0x206c22[_0x80f23f(0x14a)]);let _0x186335=dbBookIndexTable[_0x80f23f(0xfc)](_0x2cd976[_0x80f23f(0x18d)][_0x80f23f(0xe8)],_0x206c22[_0x80f23f(0x16f)]);_0x186335[_0x80f23f(0xf4)]>0x0?(_0x186335=arrayUtil[_0x80f23f(0xde)](_0x186335,_0x80f23f(0x14a)),setBookListProps(_0x2cd976,_0x186335)[_0x80f23f(0x11b)](_0x405aa6=>{_0x186335=_0x405aa6,_0xc86de7();})):_0xc86de7;function _0xc86de7(){let _0x37abf9={'code':0x0,'data':_0x206c22,'sameFolderBookList':_0x186335};getBookSameNameCover(_0x206c22)['then'](_0x4d486d=>{const _0x2e0980=_0x1220;_0x206c22[_0x2e0980(0x10d)]=_0x4d486d;let _0x368ea2=_0x2cd976[_0x2e0980(0x18d)][_0x2e0980(0xe8)]['prepare'](_0x2e0980(0x130))[_0x2e0980(0xda)](_0x16dc73,path[_0x2e0980(0x119)](_0x206c22[_0x2e0980(0x16f)],_0x206c22['filename']),_0x206c22['size']);_0x368ea2&&(_0x37abf9[_0x2e0980(0x143)]=_0x368ea2[_0x2e0980(0x143)]),_0x37abf9[_0x2e0980(0xe3)]=fs[_0x2e0980(0x169)](_0x206c22['filePath'],(_0x509787,_0x3b7b50)=>{const _0x1ebe89=_0x2e0980;return _0x509787?_0x37abf9[_0x1ebe89(0x142)]=0x0:_0x37abf9[_0x1ebe89(0x142)]=0x1,_0x2ce70e[_0x1ebe89(0x186)](_0x37abf9);});});}}}),router[_0x20ffcd(0xdd)](_0x20ffcd(0x189),(_0x9da756,_0x5e492d,_0x2feb54)=>{const _0x34dcc1=_0x20ffcd;let _0x327285=_0x9da756[_0x34dcc1(0x184)]['id'];function _0x18f5cf(_0x38b0d7){const _0x2797bc=_0x34dcc1;let _0x23108a=dbFileIndexTable[_0x2797bc(0x100)](_0x9da756['app']['dbFileIndex'],_0x38b0d7,dbFileIndexTable[_0x2797bc(0x149)]);if(!_0x23108a)return;let _0x3a0383=new Date()['getTime']();_0x9da756['app'][_0x2797bc(0xe8)][_0x2797bc(0x14f)](_0x2797bc(0x15c))[_0x2797bc(0x11f)](_0x3a0383,_0x38b0d7),dbBookFavorite['addFavorite'](_0x9da756[_0x2797bc(0x18d)][_0x2797bc(0xe8)],_0x327285,_0x38b0d7);}if(_0x9da756[_0x34dcc1(0xe2)][_0x34dcc1(0x108)]instanceof Array){let _0x17b749=_0x9da756[_0x34dcc1(0xe2)][_0x34dcc1(0x105)];if(_0x17b749==_0x34dcc1(0xe1))for(let _0xc717f5 of _0x9da756[_0x34dcc1(0xe2)][_0x34dcc1(0x108)]){_0x18f5cf(_0xc717f5);}else{if(_0x17b749==_0x34dcc1(0x157))for(let _0x335289 of _0x9da756[_0x34dcc1(0xe2)]['indexId']){dbBookFavorite[_0x34dcc1(0x11e)](_0x9da756['app'][_0x34dcc1(0xe8)],_0x327285,_0x335289);}}return _0x5e492d[_0x34dcc1(0x186)]({'code':0x0});}else{let _0x446f7e=parseInt(_0x9da756[_0x34dcc1(0xe2)][_0x34dcc1(0x108)]),_0x475a69=dbBookFavorite[_0x34dcc1(0x12b)](_0x9da756[_0x34dcc1(0x18d)][_0x34dcc1(0xe8)],_0x327285,_0x446f7e),_0x4fb444=0x0;return _0x475a69?dbBookFavorite[_0x34dcc1(0x11e)](_0x9da756[_0x34dcc1(0x18d)][_0x34dcc1(0xe8)],_0x327285,_0x446f7e):(_0x4fb444=0x1,_0x18f5cf(_0x446f7e)),_0x5e492d['json']({'code':0x0,'favorite':_0x4fb444});}}),router[_0x20ffcd(0xda)](_0x20ffcd(0x171),(_0x2fd3b3,_0x369c1e,_0x562d40)=>{const _0x32a31a=_0x20ffcd;let _0x32b7a9=_0x2fd3b3['query'][_0x32a31a(0x108)],_0x1b48d7=dbBookIndexTable[_0x32a31a(0x146)](_0x2fd3b3[_0x32a31a(0x18d)][_0x32a31a(0xe8)],_0x32b7a9),_0x2b538f=_0x2fd3b3[_0x32a31a(0xdb)][_0x32a31a(0x12f)];!_0x2b538f&&(_0x2b538f=0x200);if(!_0x1b48d7||_0x1b48d7&&!_0x1b48d7['cover_path'])return _0x369c1e[_0x32a31a(0xf6)](0x194)[_0x32a31a(0x13a)]();dbUserTable[_0x32a31a(0x154)](_0x2fd3b3,_0x369c1e,_0x32a31a(0x182),'power_get',_0x1b48d7[_0x32a31a(0x16f)])==!![]&&fs['stat'](_0x1b48d7[_0x32a31a(0x13b)],(_0x2bf55a,_0x1ed160)=>{const _0x1df6da=_0x32a31a;if(_0x2bf55a){let _0x4ffe64=config[_0x1df6da(0xfe)](_0x1b48d7);bookIndexUtil['runGetBookInfoWorker'](_0x1b48d7,_0x4ffe64)[_0x1df6da(0x11b)](_0x47f647=>{const _0x37f697=_0x1df6da;if(_0x47f647[_0x37f697(0x11c)])bookIndexUtil[_0x37f697(0x10c)](_0x47f647['coverData'],_0x4ffe64)[_0x37f697(0x11b)](_0x5414c8=>{const _0x4daa2c=_0x37f697;return console[_0x4daa2c(0x137)](_0x4daa2c(0x18c),_0x5414c8),_0x369c1e[_0x4daa2c(0x16b)](_0x5414c8);})[_0x37f697(0x102)](_0x23b376=>{const _0xdc4006=_0x37f697;return _0x369c1e[_0xdc4006(0xf6)](0x194)[_0xdc4006(0x13a)]();});else return _0x369c1e['status'](0x194)[_0x37f697(0x13a)]();})['catch'](_0x57291c=>{const _0x539f9b=_0x1df6da;return _0x369c1e[_0x539f9b(0xf6)](0x194)[_0x539f9b(0x13a)]();});}else return _0x369c1e[_0x1df6da(0x16b)](_0x1b48d7['cover_path']);});}),router[_0x20ffcd(0xdd)](_0x20ffcd(0x17f),(_0x593862,_0x17a0c9,_0x145cd5)=>{const _0x17dcc0=_0x20ffcd;let _0x3ad1da=_0x593862[_0x17dcc0(0xe2)][_0x17dcc0(0x156)]||0x32,_0x35548e=_0x593862[_0x17dcc0(0xe2)][_0x17dcc0(0x18a)]||0x0,_0x526294=_0x593862[_0x17dcc0(0xe2)][_0x17dcc0(0x107)]||_0x17dcc0(0x158),_0x239682=_0x593862[_0x17dcc0(0xe2)][_0x17dcc0(0xea)]||'check_time',_0x2d9382=_0x593862['body'][_0x17dcc0(0x111)]||_0x17dcc0(0x164),_0x468bf5=_0x593862[_0x17dcc0(0xe2)][_0x17dcc0(0xf3)],_0x43fa76=_0x593862[_0x17dcc0(0xe2)][_0x17dcc0(0x129)];if(dbBookIndexTable[_0x17dcc0(0x16d)](_0x593862,_0x17a0c9,_0x239682,_0x2d9382)!==!![])return;let _0x449925=['check_time',_0x17dcc0(0xd6),_0x17dcc0(0x175),'filename',_0x17dcc0(0x181),_0x17dcc0(0xf8),'birthtime','id',_0x17dcc0(0x159)],_0x15afcf=['asc',_0x17dcc0(0x164)];if(!_0x449925[_0x17dcc0(0x15b)](_0x239682)||!_0x15afcf[_0x17dcc0(0x15b)](_0x2d9382))return _0x593862['app'][_0x17dcc0(0x104)](_0x17a0c9,_0x17dcc0(0x185),_0x239682,_0x2d9382);let _0x52d826=dbUserTable[_0x17dcc0(0x147)](_0x593862,_0x17dcc0(0x182),_0x17dcc0(0x10b),!![]);if(_0x593862[_0x17dcc0(0x184)]['is_admin']!=0x1&&!_0x52d826&&_0x526294!=_0x17dcc0(0x158))return _0x17a0c9[_0x17dcc0(0x186)]({'code':0x0,'data':null});let _0x25e22f=[];if(_0x526294==_0x17dcc0(0xf8))_0x25e22f=dbBookIndexTable['getGroupList'](_0x593862[_0x17dcc0(0x18d)][_0x17dcc0(0xe8)],_0x52d826,_0x526294,_0x3ad1da,_0x35548e,_0x239682,_0x2d9382,_0x468bf5,_0x43fa76);else{if(_0x526294==_0x17dcc0(0x158)){_0x25e22f=dbBookListTable['getBookListList'](_0x593862[_0x17dcc0(0x18d)][_0x17dcc0(0xe8)],_0x593862[_0x17dcc0(0x184)]['id'],_0x3ad1da,_0x35548e,'id',_0x17dcc0(0x164),_0x468bf5);for(let _0x4b05a8 of _0x25e22f){_0x4b05a8['cover']=dbBookIndexTable['getBooklistCover'](_0x593862[_0x17dcc0(0x18d)][_0x17dcc0(0xe8)],_0x4b05a8['id']);}}}return _0x17a0c9['json']({'code':0x0,'data':_0x25e22f});}),router['post'](_0x20ffcd(0x191),(_0x257d8f,_0x11b221,_0x2fb71f)=>{const _0x5359cd=_0x20ffcd;let _0x418690=_0x257d8f[_0x5359cd(0xe2)][_0x5359cd(0xdf)],_0x17d2b2=_0x257d8f[_0x5359cd(0xe2)][_0x5359cd(0x105)];if(_0x17d2b2==_0x5359cd(0xe1)){if(!_0x418690)return _0x257d8f[_0x5359cd(0x18d)]['returnErrMsg'](_0x11b221,_0x5359cd(0xfa));dbBookListTable[_0x5359cd(0x114)](_0x257d8f[_0x5359cd(0x18d)][_0x5359cd(0xe8)],_0x257d8f[_0x5359cd(0x184)]['id'],_0x418690);}else{if(_0x17d2b2==_0x5359cd(0xee)||_0x17d2b2=='delete'){let _0xa4a49a=_0x257d8f['body']['bookListId'],_0x10d359=dbBookListTable[_0x5359cd(0x16c)](_0x257d8f[_0x5359cd(0x18d)][_0x5359cd(0xe8)],_0xa4a49a),_0x4af98b=![];(_0x257d8f[_0x5359cd(0x184)][_0x5359cd(0x174)]==0x1||_0x10d359['uid']==_0x257d8f['currentUser']['id'])&&(_0x4af98b=!![]);if(!_0x4af98b)return _0x11b221[_0x5359cd(0x186)]({'code':0x66});if(_0x17d2b2==_0x5359cd(0x157))dbBookListTable['removeBookList'](_0x257d8f['app'][_0x5359cd(0xe8)],_0xa4a49a);else{if(_0x17d2b2==_0x5359cd(0xee)){if(!_0x418690)return _0x257d8f['app'][_0x5359cd(0x104)](_0x11b221,_0x5359cd(0xfa));dbBookListTable[_0x5359cd(0x160)](_0x257d8f[_0x5359cd(0x18d)][_0x5359cd(0xe8)],_0xa4a49a,_0x418690);}}}else return _0x257d8f['app']['returnErrMsg'](_0x11b221,_0x5359cd(0x10f));}return _0x11b221['json']({'code':0x0});}),router['post'](_0x20ffcd(0x135),(_0x4c9632,_0x3d7af6,_0x5355e4)=>{const _0x5efe69=_0x20ffcd;let _0x23fb80=_0x4c9632['body'][_0x5efe69(0xe9)],_0x3b7cc1=_0x4c9632[_0x5efe69(0xe2)][_0x5efe69(0x17d)];if(!_0x23fb80||!_0x3b7cc1)return _0x4c9632[_0x5efe69(0x18d)][_0x5efe69(0x104)](_0x3d7af6,_0x5efe69(0x17b));let _0x3c58be=dbBookListTable['getBookListById'](_0x4c9632[_0x5efe69(0x18d)]['dbFileIndex'],_0x3b7cc1);if(!_0x3c58be)return _0x4c9632[_0x5efe69(0x18d)][_0x5efe69(0x104)](_0x3d7af6,_0x5efe69(0x183));let _0x2ce740=_0x4c9632[_0x5efe69(0xe2)][_0x5efe69(0x105)];if(_0x2ce740==_0x5efe69(0xe1)){function _0x5cfdd3(_0x1ea1fa){const _0x2822ed=_0x5efe69;let _0x2e3180=dbBookIndexTable[_0x2822ed(0x146)](_0x4c9632['app'][_0x2822ed(0xe8)],_0x1ea1fa);if(!_0x2e3180)return;if(_0x2e3180[_0x2822ed(0x172)]==0x1){dbBookListTable[_0x2822ed(0x10e)](_0x4c9632['app'][_0x2822ed(0xe8)],_0x1ea1fa,_0x3b7cc1);let _0x128bcd=Date[_0x2822ed(0x106)]();_0x4c9632[_0x2822ed(0x18d)][_0x2822ed(0xe8)][_0x2822ed(0x14f)]('UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?')[_0x2822ed(0x11f)](_0x128bcd,_0x2e3180['id']);}else{let _0x26d7ce=path[_0x2822ed(0x119)](_0x2e3180[_0x2822ed(0x16f)],_0x2e3180[_0x2822ed(0x14a)]),_0x2a5366=_0x4c9632['app']['dbFileIndex'][_0x2822ed(0x14f)](_0x2822ed(0x118))[_0x2822ed(0x14e)](_0x26d7ce,_0x26d7ce+path[_0x2822ed(0xd9)]+'%');for(let _0x2c117b of _0x2a5366){dbBookListTable[_0x2822ed(0x10e)](_0x4c9632[_0x2822ed(0x18d)]['dbFileIndex'],_0x2c117b['id'],_0x3b7cc1);}}}if(_0x23fb80 instanceof Array)for(let _0x4024ca of _0x23fb80){_0x5cfdd3(_0x4024ca);}else _0x5cfdd3(_0x23fb80);}else{if(_0x2ce740==_0x5efe69(0x157)){if(_0x23fb80 instanceof Array)for(let _0x49fe89 of _0x23fb80){dbBookListTable[_0x5efe69(0x177)](_0x4c9632[_0x5efe69(0x18d)][_0x5efe69(0xe8)],_0x49fe89,_0x3b7cc1);}else dbBookListTable[_0x5efe69(0x177)](_0x4c9632[_0x5efe69(0x18d)][_0x5efe69(0xe8)],_0x23fb80,_0x3b7cc1);}else return _0x4c9632['app'][_0x5efe69(0x104)](_0x3d7af6,_0x5efe69(0x10f));}return _0x3d7af6[_0x5efe69(0x186)]({'code':0x0,'data':{}});}),router[_0x20ffcd(0xdd)]('/getBookIndexFileTree',(_0x29cc33,_0x312353,_0x1dc3df)=>{const _0x12b8b0=_0x20ffcd;let _0x42ad2c=_0x29cc33[_0x12b8b0(0xe2)][_0x12b8b0(0x18e)],_0xd0babb=_0x29cc33['body'][_0x12b8b0(0x110)],_0x2cb628=_0x12b8b0(0x182);if(dbUserTable[_0x12b8b0(0x154)](_0x29cc33,_0x312353,_0x2cb628,_0x12b8b0(0x10b))==!![]){let _0x26988b=[];if(!_0x42ad2c){let _0x1e6e6b=[];_0x29cc33[_0x12b8b0(0x184)][_0x12b8b0(0x174)]==0x1?_0x1e6e6b=dbSourceFolderTable[_0x12b8b0(0x178)](_0x29cc33['app'][_0x12b8b0(0x15e)],_0x2cb628):_0x1e6e6b=dbUserTable['getUserPower'](_0x29cc33['app']['dbOther'],_0x29cc33[_0x12b8b0(0x184)][_0x12b8b0(0x180)],_0x2cb628);if(_0x1e6e6b)for(let _0x54fce4=0x0;_0x54fce4<_0x1e6e6b[_0x12b8b0(0xf4)];_0x54fce4++){_0x26988b[_0x12b8b0(0x165)]({'path':_0x1e6e6b[_0x54fce4][_0x12b8b0(0x16f)],'is_file':0x0,'filename':path['basename'](_0x1e6e6b[_0x54fce4][_0x12b8b0(0x16f)]),'root':!![]});}}else{let _0x293580=[];if(_0x29cc33[_0x12b8b0(0x184)][_0x12b8b0(0x174)]!=0x1){if(dbUserTable[_0x12b8b0(0x154)](_0x29cc33,_0x312353,_0x2cb628,'power_get',_0x42ad2c)!==!![])return;}_0x42ad2c=path[_0x12b8b0(0x119)](_0x42ad2c);let _0xddfea7=_0x12b8b0(0x103);_0x293580[_0x12b8b0(0x165)](_0x42ad2c);if(_0xd0babb){let _0x149996=_0x12b8b0(0xd7);_0xddfea7+=_0x149996,_0x293580[_0x12b8b0(0x165)]('%'+_0xd0babb+'%'),_0x293580[_0x12b8b0(0x165)]('%'+_0xd0babb+'%');}let _0x1d74d6=_0x12b8b0(0x131);_0x26988b=_0x29cc33[_0x12b8b0(0x18d)][_0x12b8b0(0xe8)][_0x12b8b0(0x14f)](_0x12b8b0(0x136)+_0x1d74d6+_0x12b8b0(0x11a)+_0xddfea7)[_0x12b8b0(0x14e)](_0x293580);}for(let _0xa8393d of _0x26988b){if(_0xa8393d[_0x12b8b0(0x172)]==0x0){let _0x4df642=path[_0x12b8b0(0x119)](_0xa8393d['path'],_0xa8393d[_0x12b8b0(0x14a)]),_0xb9001a=_0x29cc33[_0x12b8b0(0x18d)][_0x12b8b0(0xe8)][_0x12b8b0(0x14f)]('SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_book\x20WHERE\x20path=?\x20and\x20is_file=1')[_0x12b8b0(0xda)](_0x4df642);_0xa8393d[_0x12b8b0(0xf0)]=_0xb9001a[_0x12b8b0(0x156)];}}let _0x342298=path['sep'],_0x3808ef={'code':0x0,'data':_0x26988b,'sep':_0x342298};return _0x312353[_0x12b8b0(0x186)](_0x3808ef);}}),router[_0x20ffcd(0xdd)](_0x20ffcd(0xdc),(_0x4b7262,_0x246767,_0x36c0bf)=>{const _0x3dbeb1=_0x20ffcd;let _0x117bb1=_0x4b7262[_0x3dbeb1(0xe2)][_0x3dbeb1(0xe9)],_0x321484=_0x4b7262[_0x3dbeb1(0xe2)][_0x3dbeb1(0x105)];if(!_0x117bb1)return _0x4b7262['app'][_0x3dbeb1(0x104)](_0x246767,_0x3dbeb1(0x18f));let _0x373f3a=dbBookIndexTable['getBookIndex'](_0x4b7262['app']['dbFileIndex'],_0x117bb1);if(!_0x373f3a)return _0x4b7262['app'][_0x3dbeb1(0x104)](_0x246767,_0x3dbeb1(0x150));if(_0x321484=='update'){let _0x5bcd38={'title':_0x4b7262[_0x3dbeb1(0xe2)][_0x3dbeb1(0x181)],'publish_date':_0x4b7262[_0x3dbeb1(0xe2)]['publish_date'],'year':_0x4b7262[_0x3dbeb1(0xe2)][_0x3dbeb1(0x168)],'isbn':_0x4b7262['body'][_0x3dbeb1(0x12c)],'language':_0x4b7262['body'][_0x3dbeb1(0x18b)],'genre':_0x4b7262[_0x3dbeb1(0xe2)]['genre'],'tag':_0x4b7262[_0x3dbeb1(0xe2)][_0x3dbeb1(0x162)],'publisher':_0x4b7262[_0x3dbeb1(0xe2)]['publisher'],'artist':_0x4b7262[_0x3dbeb1(0xe2)][_0x3dbeb1(0xf8)],'introduction':_0x4b7262[_0x3dbeb1(0xe2)]['introduction']},_0x2a9071=path['join'](_0x373f3a[_0x3dbeb1(0x16f)],_0x373f3a['filename']);fs[_0x3dbeb1(0x169)](_0x2a9071,(_0x2dbbdd,_0x122bd3)=>{const _0x1ff3d5=_0x3dbeb1;if(_0x2dbbdd)return _0x4b7262['app'][_0x1ff3d5(0x104)](_0x246767,_0x246767['__'](_0x1ff3d5(0x126))+_0x2a9071);let _0x24594c=_0x2a9071[_0x1ff3d5(0x121)](0x0,_0x2a9071[_0x1ff3d5(0x127)]('.'))+_0x1ff3d5(0x15d);nfoUtil[_0x1ff3d5(0x17c)](_0x5bcd38,_0x24594c)['then'](()=>{const _0xf7029c=_0x1ff3d5;console[_0xf7029c(0x137)](_0xf7029c(0x101)),dbBookIndexTable['updateBook'](_0x4b7262[_0xf7029c(0x18d)][_0xf7029c(0xe8)],_0x117bb1,_0x5bcd38),_0x373f3a=dbBookIndexTable[_0xf7029c(0x146)](_0x4b7262[_0xf7029c(0x18d)]['dbFileIndex'],_0x117bb1),setBookListProps(_0x4b7262,[_0x373f3a])[_0xf7029c(0x11b)](_0x466186=>{const _0x3664a9=_0xf7029c;return _0x246767[_0x3664a9(0x186)]({'code':0x0,'data':_0x466186[0x0]});});})[_0x1ff3d5(0x102)](_0x414514=>{const _0x543c26=_0x1ff3d5;return console[_0x543c26(0x137)](_0x543c26(0x120),_0x414514),_0x4b7262[_0x543c26(0x18d)]['returnErrMsg'](_0x246767,_0x543c26(0x13e));});});}else{if(_0x321484=='delete'){let _0x3e2261=path[_0x3dbeb1(0x119)](_0x373f3a[_0x3dbeb1(0x16f)],_0x373f3a[_0x3dbeb1(0x14a)]),_0x3b3767=_0x3e2261['substring'](0x0,_0x3e2261[_0x3dbeb1(0x127)]('.'))+_0x3dbeb1(0x15d);fs[_0x3dbeb1(0x169)](_0x3b3767,(_0x5cdc6b,_0xd31e79)=>{const _0x5efbda=_0x3dbeb1;if(_0x5cdc6b)return _0x4b7262['app'][_0x5efbda(0x104)](_0x246767,_0x246767['__'](_0x5efbda(0x126))+_0x3b3767);fs['rm'](_0x3b3767,_0x33082f=>{const _0x387c74=_0x5efbda;if(_0x33082f)return _0x4b7262[_0x387c74(0x18d)][_0x387c74(0x104)](_0x246767,_0x246767['__']('deleteFail')+_0x3b3767);return dbBookIndexTable[_0x387c74(0x11d)](_0x4b7262[_0x387c74(0x18d)][_0x387c74(0xe8)],indexId,{}),_0x246767[_0x387c74(0x186)]({'code':0x0});});});}else return _0x4b7262[_0x3dbeb1(0x18d)]['returnErrMsg'](_0x246767,_0x3dbeb1(0x10f));}}),module[_0x20ffcd(0x12d)]=router;