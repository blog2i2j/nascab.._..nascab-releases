const _0xdf84ee=_0x433f;(function(_0x35b457,_0x2d48e4){const _0x168722=_0x433f,_0x1bc398=_0x35b457();while(!![]){try{const _0x17936c=parseInt(_0x168722(0xbe))/0x1*(parseInt(_0x168722(0xc1))/0x2)+parseInt(_0x168722(0x119))/0x3+parseInt(_0x168722(0xf6))/0x4*(parseInt(_0x168722(0x115))/0x5)+-parseInt(_0x168722(0x12a))/0x6+-parseInt(_0x168722(0x12d))/0x7+-parseInt(_0x168722(0xc4))/0x8*(-parseInt(_0x168722(0x125))/0x9)+parseInt(_0x168722(0xc8))/0xa*(-parseInt(_0x168722(0xd8))/0xb);if(_0x17936c===_0x2d48e4)break;else _0x1bc398['push'](_0x1bc398['shift']());}catch(_0x1b24d7){_0x1bc398['push'](_0x1bc398['shift']());}}}(_0x28a8,0xb8594));let express=require('express'),router=express[_0xdf84ee(0xeb)](),path=require(_0xdf84ee(0xda)),fs=require('fs'),dbBookIndexTable=require('../../db/dbBookIndexTable'),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbBookListTable=require('../../db/dbBookListTable'),dbBookFavorite=require(_0xdf84ee(0xc6));const dbUserTable=require(_0xdf84ee(0xf5)),dbSourceFolderTable=require(_0xdf84ee(0xcd));let os=require('os'),config=require(_0xdf84ee(0xfd));function _0x433f(_0x31ccd1,_0x13b451){const _0x28a832=_0x28a8();return _0x433f=function(_0x433fe4,_0x3551d9){_0x433fe4=_0x433fe4-0xb1;let _0x1f270e=_0x28a832[_0x433fe4];return _0x1f270e;},_0x433f(_0x31ccd1,_0x13b451);}const bookIndexUtil=require(_0xdf84ee(0x154)),arrayUtil=require('../../utils/arrayUtil'),nfoUtil=require(_0xdf84ee(0x14f));function getBookSameNameCover(_0x1889cb){return new Promise((_0x5652de,_0xe41d80)=>{const _0x4234ba=_0x433f;try{let _0x3d021f=_0x1889cb[_0x4234ba(0x144)][_0x4234ba(0xef)](path[_0x4234ba(0xfb)](_0x1889cb['filename']),''),_0x31c0d0=path[_0x4234ba(0xe8)](_0x1889cb[_0x4234ba(0xda)],_0x3d021f+_0x4234ba(0xe3)),_0x5a0b42='';fs[_0x4234ba(0x10d)](_0x31c0d0)&&(_0x5a0b42=_0x31c0d0),_0x5652de(_0x5a0b42);}catch(_0x29ff8b){_0x5652de('');}});}function _0x28a8(){const _0x1450f6=['indexId','stat','11896sleviG','file_cover_path','../../db/dbBookFavorite','sendFile','249850ukSiaD','getBooklistCover','birthtime','catch','addFavorite','../../db/dbSourceFolderTable','deleteFavorite','isbn','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20OR\x20artist\x20like\x20?\x20OR\x20tag\x20like\x20?\x20OR\x20publisher\x20like\x20?\x20OR\x20isbn\x20like\x20?\x20OR\x20genre\x20like\x20?\x20OR\x20year\x20like\x20?)','/setReaderConfig','status','封面文件已删除','query','\x20order\x20by\x20m.update_time\x20DESC\x20','doUserCanGet','list','517yUsLPE','run','path','parse','add','sharpWriteCover','UPDATE\x20book_reader_config\x20SET\x20config_json=?\x20WHERE\x20uid=?','artist','REPLACE\x20INTO\x20book_reader_config\x20(uid,config_json,remark)\x20VALUES(?,?,?)','desc','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','.jpg','createBookList','UPDATE\x20book_read_record\x20SET\x20progress=?,read_time=?\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','removeBookFromList','comicList','join','INDEX_TABLE_NAME_BOOK','config\x20json\x20format\x20error','Router','length','need\x20type/indexId','cover\x20format\x20error','replace','getBookIndexByFileName','index\x20id\x20error','\x20path=?\x20\x20','getGroupList','log','../../db/dbUserTable','2301076dUOvXl','name','/refreshCheckTime','orderField/orderType\x20error','body','extname','all','../../myConfig/config','封面文件已不存在','recentReadList','dbOther','nfo写入成功','exist','type','now',',f.artist\x20','tag','getUserPower','edit','updateBook','post','need\x20index\x20id','updateByFiled','existsSync','orderField','need\x20bookIndexId/bookListId','publish_date','listType','recentAddList','/getBookCover','fileName','5DhDZIf','\x20id,is_file,id,path,filename,type,size,title,artist,ext,cover_path,language,publisher,total_page,type,check_time,create_time','includes','get','3688671ACrdYR','\x20is_file=1','json','/getHomeData','uid',',f.filename_fl\x20','.nfo','bookListId\x20no\x20exists','app','platform','/updateBookNfo','\x20order\x20by\x20f.title_fl\x20','8793ZnEYHA','push',',f.title\x20','power_get','checkOrderParams','7236510iCbkPm','getTime','REPLACE\x20INTO\x20book_read_record\x20(uid,book_filename,book_path,progress,read_time)\x20VALUES(?,?,?,?,?)','7551376aLOzZZ','SELECT\x20id\x20from\x20file_index_book\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','error','/getGroupList','book\x20not\x20exist','getFavorite','configJson','need\x20type','book','progress','is_admin','genre','favorite_time','nfo写入失败','bookIsFavorite','NO\x20book\x20INDEX','/getBookList','basename','year','check_time','/getBookDetail','parent','getBookIndex','filename','operation\x20error','orderType','power_change','/getReadRecord','operation','UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?','end','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20ORDER\x20BY\x20read_time\x20desc\x20LIMIT\x20?','bookList','addBookToBookList','../../utils/nfoUtil','returnErrMsg','currentUser','sortFileNamesByNumber','UPDATE\x20book_reader_config\x20SET\x20remark=?\x20WHERE\x20uid=?','../../myWorkers/index/bookIndexUtil','runGetBookInfoWorker','favorite','dbFileIndex','fileExist','getBookListById','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_size=?','publisher','book_count','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','count','title','filePath','/addReadRecord','search','bookListId','searchStr','prepare','need\x20config\x20json','removeBookList','getById','\x20FROM\x20file_index_book\x20WHERE\x20','power_delete','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid=?','introduction','groupField','letterIndex','getPathByType','asc','getUserPathWhere','SELECT\x20','folderNotExist','delete','cover_path','lastIndexOf','bookIndexId','191323AEDvql','then','deleteFail','10mhckxu'];_0x28a8=function(){return _0x1450f6;};return _0x28a8();}router['post'](_0xdf84ee(0xd1),(_0x4889ce,_0x4586de,_0x51be6a)=>{const _0x1b976b=_0xdf84ee;let _0x522542=_0x4889ce[_0x1b976b(0x151)]['id'],_0x1bdcdb=_0x4889ce[_0x1b976b(0xfa)][_0x1b976b(0x133)],_0x263953=_0x4889ce[_0x1b976b(0xfa)]['remark'];if(!_0x1bdcdb&&!_0x263953)return _0x4889ce[_0x1b976b(0x121)][_0x1b976b(0x150)](_0x4586de,_0x1b976b(0x166));try{JSON[_0x1b976b(0xdb)](_0x1bdcdb);}catch(_0x3d3a72){return _0x4889ce[_0x1b976b(0x121)][_0x1b976b(0x150)](_0x4586de,_0x1b976b(0xea));}let _0x34b5fe=_0x4889ce[_0x1b976b(0x121)][_0x1b976b(0x100)][_0x1b976b(0x165)](_0x1b976b(0xb1))['get'](_0x522542);if(_0x34b5fe){if(_0x1bdcdb)_0x4889ce[_0x1b976b(0x121)][_0x1b976b(0x100)][_0x1b976b(0x165)](_0x1b976b(0xde))[_0x1b976b(0xd9)](_0x1bdcdb,_0x522542);else _0x263953&&_0x4889ce[_0x1b976b(0x121)][_0x1b976b(0x100)][_0x1b976b(0x165)](_0x1b976b(0x153))[_0x1b976b(0xd9)](_0x263953,_0x522542);}else _0x4889ce[_0x1b976b(0x121)][_0x1b976b(0x100)][_0x1b976b(0x165)](_0x1b976b(0xe0))[_0x1b976b(0xd9)](_0x522542,_0x1bdcdb,_0x263953);return _0x4586de[_0x1b976b(0x11b)]({'code':0x0});}),router['post']('/deleteSameNameCover',(_0x4e2486,_0x3d2d96,_0x221526)=>{const _0x2c8362=_0xdf84ee;let _0x20ffd0=_0x4e2486['currentUser']['id'],_0x20e7b1=_0x4e2486[_0x2c8362(0xfa)][_0x2c8362(0xbd)];if(!_0x20e7b1)return _0x4e2486['app'][_0x2c8362(0x150)](_0x3d2d96,'need\x20bookIndexId');let _0xc51792=dbFileIndexTable[_0x2c8362(0x168)](_0x4e2486[_0x2c8362(0x121)]['dbFileIndex'],_0x20e7b1,dbFileIndexTable[_0x2c8362(0xe9)]);if(!_0xc51792)return _0x4e2486[_0x2c8362(0x121)][_0x2c8362(0x150)](_0x3d2d96,'need\x20bookIndexId');dbUserTable['doUserCanGet'](_0x4e2486,_0x3d2d96,'',_0x2c8362(0x16a),_0xc51792[_0x2c8362(0xda)])==!![]&&getBookSameNameCover(_0xc51792)[_0x2c8362(0xbf)](_0x887bbc=>{const _0x12bccb=_0x2c8362;if(!_0x887bbc['endsWith']('.jpg'))return _0x4e2486[_0x12bccb(0x121)]['returnErrMsg'](_0x3d2d96,_0x12bccb(0xee));fs[_0x12bccb(0xc3)](_0x887bbc,(_0x9aa46e,_0x11defc)=>{const _0x69e447=_0x12bccb;if(_0x9aa46e)return console[_0x69e447(0xf4)](_0x69e447(0xfe)),_0x3d2d96[_0x69e447(0x11b)]({'code':0x0});fs['rm'](_0x887bbc,_0xdfb4d9=>{const _0x5a77b8=_0x69e447;if(_0xdfb4d9)return _0x4e2486[_0x5a77b8(0x121)][_0x5a77b8(0x150)](_0x3d2d96,_0x3d2d96['__'](_0x5a77b8(0xc0))+_0x887bbc);return console[_0x5a77b8(0xf4)](_0x5a77b8(0xd3),_0x887bbc),_0x3d2d96[_0x5a77b8(0x11b)]({'code':0x0});});});});}),router[_0xdf84ee(0x10a)](_0xdf84ee(0xf8),(_0x1feb68,_0x291914,_0x2e1002)=>{const _0x24e9fb=_0xdf84ee;let _0x4d51da=_0x1feb68['currentUser']['id'],_0x124ed1=_0x1feb68['body'][_0x24e9fb(0xbd)];if(!_0x124ed1)return _0x291914[_0x24e9fb(0xd2)](0x194)['end']();return dbBookIndexTable[_0x24e9fb(0x10c)](_0x1feb68[_0x24e9fb(0x121)][_0x24e9fb(0x157)],_0x124ed1,_0x24e9fb(0x140),new Date()[_0x24e9fb(0x12b)]()),_0x291914[_0x24e9fb(0x11b)]({'code':0x0});}),router[_0xdf84ee(0x10a)](_0xdf84ee(0x161),(_0x226aed,_0x429bc3,_0x4f7609)=>{const _0xd58829=_0xdf84ee;let _0xd8fca0=_0x226aed[_0xd58829(0x151)]['id'];if(!_0x226aed[_0xd58829(0xfa)]['fileName']||!_0x226aed[_0xd58829(0xfa)][_0xd58829(0x160)]||!_0x226aed[_0xd58829(0xfa)][_0xd58829(0x136)])return _0x429bc3['json']({'code':0x0});let _0x173ca4=_0x226aed[_0xd58829(0xfa)][_0xd58829(0x114)];_0x173ca4=path[_0xd58829(0x13e)](_0x226aed[_0xd58829(0xfa)]['fileName']);let _0x4c2d84=path['join'](_0x226aed[_0xd58829(0xfa)]['filePath']),_0x142f04=_0x226aed[_0xd58829(0xfa)][_0xd58829(0x136)],_0x3d8778=_0x226aed[_0xd58829(0x121)][_0xd58829(0x157)][_0xd58829(0x165)](_0xd58829(0x15d))['get'](_0xd8fca0,_0x173ca4,_0x4c2d84);return _0x3d8778?_0x226aed[_0xd58829(0x121)][_0xd58829(0x157)]['prepare'](_0xd58829(0xe5))['run'](_0x142f04,Date['now'](),_0xd8fca0,_0x173ca4,_0x4c2d84):_0x226aed[_0xd58829(0x121)]['dbFileIndex'][_0xd58829(0x165)](_0xd58829(0x12c))[_0xd58829(0xd9)](_0xd8fca0,_0x173ca4,_0x4c2d84,_0x142f04,Date[_0xd58829(0x104)]()),_0x429bc3[_0xd58829(0x11b)]({'code':0x0});}),router[_0xdf84ee(0x10a)](_0xdf84ee(0x148),(_0x161a3d,_0x3e5fc5,_0x409547)=>{const _0x491e02=_0xdf84ee;let _0x1b57a1=_0x161a3d[_0x491e02(0x151)]['id'],_0x2de0b4=_0x161a3d[_0x491e02(0x121)]['dbOther'][_0x491e02(0x165)]('SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid\x20=\x20?')[_0x491e02(0x118)](_0x1b57a1),_0x6ff3d7=0x0,_0x2cb158=_0x161a3d[_0x491e02(0xfa)][_0x491e02(0x114)],_0x4e9d2f=_0x161a3d['body'][_0x491e02(0x160)];if(_0x2cb158&&_0x4e9d2f){_0x4e9d2f=path[_0x491e02(0xe8)](_0x4e9d2f+'');let _0x182b0e=_0x161a3d[_0x491e02(0x121)][_0x491e02(0x157)][_0x491e02(0x165)](_0x491e02(0x15d))['get'](_0x1b57a1,_0x2cb158,_0x4e9d2f);_0x182b0e&&(_0x6ff3d7=_0x182b0e[_0x491e02(0x136)]);}return _0x3e5fc5[_0x491e02(0x11b)]({'code':0x0,'progress':_0x6ff3d7,'readerConfig':_0x2de0b4});}),router[_0xdf84ee(0x10a)]('/setBookType',(_0x58d38b,_0x33e4bd,_0x290e7c)=>{const _0xf9545b=_0xdf84ee;let _0x5da4eb=_0x58d38b[_0xf9545b(0xfa)][_0xf9545b(0xc2)],_0x351653=_0x58d38b[_0xf9545b(0xfa)][_0xf9545b(0x103)];if(!_0x351653||!_0x5da4eb)return _0x58d38b[_0xf9545b(0x121)][_0xf9545b(0x150)](_0x33e4bd,_0xf9545b(0xed));if(_0x351653!=0x1&&_0x351653!=0x2)return _0x58d38b[_0xf9545b(0x121)][_0xf9545b(0x150)](_0x33e4bd,_0xf9545b(0x134));let _0x45335e=dbBookIndexTable[_0xf9545b(0x143)](_0x58d38b[_0xf9545b(0x121)][_0xf9545b(0x157)],_0x5da4eb);if(!_0x45335e)return _0x58d38b['app'][_0xf9545b(0x150)](_0x33e4bd,_0xf9545b(0x131));if(dbUserTable[_0xf9545b(0xd6)](_0x58d38b,_0x33e4bd,_0xf9545b(0x135),_0xf9545b(0x147),_0x45335e[_0xf9545b(0xda)])==!![])return dbBookIndexTable[_0xf9545b(0x10c)](_0x58d38b[_0xf9545b(0x121)][_0xf9545b(0x157)],_0x5da4eb,_0xf9545b(0x103),_0x351653),_0x33e4bd[_0xf9545b(0x11b)]({'code':0x0});});function getListByParams(_0x23212e,_0x1c41ee,_0x4fbfed,_0x202d3a,_0x409901,_0x28eb8d,_0x455fdf,_0x1b13be,_0x2453ee,_0x10b83a,_0x35a863,_0x17dbc8,_0x3af11e){return new Promise((_0x8e0a88,_0x4c6967)=>{const _0x3473b4=_0x433f;let _0x514976=_0x23212e[_0x3473b4(0x121)][_0x3473b4(0x157)],_0x41698e=[];if(_0x202d3a==_0x3473b4(0xd7)||_0x202d3a==_0x3473b4(0x14d))_0x41698e=dbBookIndexTable['getBookList'](_0x514976,_0x4fbfed,_0x409901,_0x28eb8d,_0x455fdf,_0x1b13be,_0x2453ee,_0x35a863,_0x10b83a,_0x17dbc8,_0x3af11e);else{if(_0x202d3a==_0x3473b4(0x156)){let _0x531e4a='',_0x5550a3=[];_0x531e4a+=_0x3473b4(0x11a);_0x10b83a&&(_0x10b83a=_0x10b83a[_0x3473b4(0xef)]('\x27','')[_0x3473b4(0xef)]('’',''),_0x531e4a+=_0x3473b4(0xd0),_0x5550a3[_0x3473b4(0x126)]('%'+_0x10b83a+'%','%'+_0x10b83a+'%','%'+_0x10b83a+'%','%'+_0x10b83a+'%','%'+_0x10b83a+'%','%'+_0x10b83a+'%','%'+_0x10b83a+'%','%'+_0x10b83a+'%'));_0x17dbc8&&(_0x531e4a+=_0x3473b4(0xe2),_0x5550a3[_0x3473b4(0x126)](_0x17dbc8,_0x17dbc8));if(_0x455fdf&&_0x1b13be){if(_0x455fdf=='artist')_0x531e4a+='\x20order\x20by\x20f.artist_fl\x20'+_0x1b13be+_0x3473b4(0x105)+_0x1b13be+'\x20';else{if(_0x455fdf=='title')_0x531e4a+=_0x3473b4(0x124)+_0x1b13be+_0x3473b4(0x127)+_0x1b13be+_0x3473b4(0x11e)+_0x1b13be+'\x20';else _0x455fdf==_0x3473b4(0x139)?_0x531e4a+='\x20order\x20by\x20m.update_time\x20'+_0x1b13be+'\x20':_0x531e4a+='\x20order\x20by\x20f.'+_0x455fdf+'\x20'+_0x1b13be+'\x20';}}else _0x531e4a+=_0x3473b4(0xd5);_0x531e4a+='\x20LIMIT\x20?\x20OFFSET\x20?\x20',_0x5550a3[_0x3473b4(0x126)](_0x409901),_0x5550a3[_0x3473b4(0x126)](_0x28eb8d),_0x41698e=dbBookFavorite['getAllFavoriteByWhere'](_0x23212e[_0x3473b4(0x121)][_0x3473b4(0x157)],_0x23212e[_0x3473b4(0x151)]['id'],_0x531e4a,'*',_0x5550a3);}}setBookListProps(_0x23212e,_0x41698e)[_0x3473b4(0xbf)](_0x4aabe7=>{_0x8e0a88(_0x4aabe7);});});}function setBookListProps(_0x180039,_0x20925a){return new Promise(async(_0x5009bc,_0x44ae88)=>{const _0x421694=_0x433f;for(let _0x17eeb8 of _0x20925a){_0x17eeb8['favorite']=dbBookFavorite[_0x421694(0x13b)](_0x180039['app']['dbFileIndex'],_0x17eeb8['id'],_0x180039[_0x421694(0x151)]['id'])?'1':'0',_0x17eeb8[_0x421694(0x160)]=path[_0x421694(0xe8)](_0x17eeb8[_0x421694(0xda)],_0x17eeb8['filename']),_0x17eeb8[_0x421694(0xc5)]=await getBookSameNameCover(_0x17eeb8);}_0x5009bc(_0x20925a);});}router[_0xdf84ee(0x10a)](_0xdf84ee(0x11c),(_0x53a8b7,_0xa5d5b8,_0x2c2ca5)=>{const _0x30b410=_0xdf84ee;let _0x4baa6c=_0x53a8b7[_0x30b410(0xfa)][_0x30b410(0x15e)]?_0x53a8b7[_0x30b410(0xfa)]['count']:0xc,_0xb0212c=_0x53a8b7['currentUser']['id'],_0x20c871=dbUserTable[_0x30b410(0xb7)](_0x53a8b7,'book',_0x30b410(0x128),!![]);if(_0x53a8b7[_0x30b410(0x151)][_0x30b410(0x137)]!=0x1&&!_0x20c871)return _0xa5d5b8['json']({'code':0x0,'data':null});let _0x396584=[],_0x361294=_0x53a8b7['app'][_0x30b410(0x157)][_0x30b410(0x165)](_0x30b410(0x14c))[_0x30b410(0xfc)](_0xb0212c,_0x4baa6c);for(let _0x1dfd0d of _0x361294){let _0x2d5bcb=dbBookIndexTable[_0x30b410(0xf0)](_0x53a8b7[_0x30b410(0x121)][_0x30b410(0x157)],_0x1dfd0d['book_path'],_0x1dfd0d['book_filename']);_0x2d5bcb&&dbUserTable[_0x30b410(0xd6)](_0x53a8b7,_0xa5d5b8,_0x30b410(0x135),_0x30b410(0x128),_0x2d5bcb[_0x30b410(0xda)],!![])==!![]&&(_0x2d5bcb[_0x30b410(0x136)]=_0x1dfd0d['progress'],_0x396584[_0x30b410(0x126)](_0x2d5bcb));}setBookListProps(_0x53a8b7,_0x396584)[_0x30b410(0xbf)](_0x2f1599=>{const _0x5dae7b=_0x30b410;_0x396584=_0x2f1599,getListByParams(_0x53a8b7,_0xa5d5b8,_0x20c871,_0x5dae7b(0xd7),_0x4baa6c,0x0,_0x5dae7b(0x140),_0x5dae7b(0xe1),null,null,null,null,0x1)['then'](_0x3dbb5a=>{const _0x3b0600=_0x5dae7b;getListByParams(_0x53a8b7,_0xa5d5b8,_0x20c871,_0x3b0600(0xd7),_0x4baa6c,0x0,'check_time',_0x3b0600(0xe1),null,null,null,null,0x2)[_0x3b0600(0xbf)](_0x33f159=>{const _0x36abe0=_0x3b0600;getListByParams(_0x53a8b7,_0xa5d5b8,_0x20c871,_0x36abe0(0xd7),_0x4baa6c,0x0,'id','desc')[_0x36abe0(0xbf)](_0x4db886=>{const _0x12cb32=_0x36abe0;let _0x40f272={};return _0x396584&&_0x396584[_0x12cb32(0xec)]>0x0&&(_0x40f272[_0x12cb32(0xff)]=_0x396584),_0x4db886&&_0x4db886[_0x12cb32(0xec)]>0x0&&(_0x40f272[_0x12cb32(0x112)]=_0x4db886),_0x3dbb5a&&_0x3dbb5a[_0x12cb32(0xec)]>0x0&&(_0x40f272['bookList']=_0x3dbb5a),_0x33f159&&_0x33f159[_0x12cb32(0xec)]>0x0&&(_0x40f272[_0x12cb32(0xe7)]=_0x33f159),_0xa5d5b8['json']({'code':0x0,'data':_0x40f272,'platform':os[_0x12cb32(0x122)]()});});});});});}),router['post'](_0xdf84ee(0x13d),(_0x3078e9,_0x2a5a3a,_0x411da9)=>{const _0x374e05=_0xdf84ee;let _0x4c607e=_0x3078e9[_0x374e05(0xfa)][_0x374e05(0x15e)]||0x32,_0xd369ce=_0x3078e9['body']['offset']||0x0,_0x596d1d=_0x3078e9['body'][_0x374e05(0xdf)],_0x2a37a1=_0x3078e9[_0x374e05(0xfa)][_0x374e05(0x10e)]||_0x374e05(0x140),_0x14cc4f=_0x3078e9[_0x374e05(0xfa)][_0x374e05(0x146)]||_0x374e05(0xe1),_0x4bf60a=[_0x374e05(0xd7),_0x374e05(0x156),_0x374e05(0x14d)],_0x116405=_0x3078e9[_0x374e05(0xfa)][_0x374e05(0x111)]||_0x374e05(0xd7),_0xc9c0eb=_0x3078e9[_0x374e05(0xfa)][_0x374e05(0x162)],_0xe763e5=_0x3078e9['body'][_0x374e05(0xb4)],_0x29ef81=_0x3078e9[_0x374e05(0xfa)]['bookListId'],_0x4be73d=_0x3078e9[_0x374e05(0xfa)][_0x374e05(0x103)];if(dbBookIndexTable[_0x374e05(0x129)](_0x3078e9,_0x2a5a3a,_0x2a37a1,_0x14cc4f)!==!![])return;if(_0x116405==_0x374e05(0x14d)){if(!_0x29ef81)return _0x3078e9['app'][_0x374e05(0x150)](_0x2a5a3a,'need\x20bookListId');}!_0x4bf60a[_0x374e05(0x117)](_0x116405)&&(_0x116405='list');_0x4c607e>0x1f4&&(_0x4c607e=0x1f4);let _0x1afad4=dbUserTable[_0x374e05(0xb7)](_0x3078e9,_0x374e05(0x135),_0x374e05(0x128),!![]);if(_0x3078e9[_0x374e05(0x151)]['is_admin']!=0x1&&!_0x1afad4)return _0x2a5a3a[_0x374e05(0x11b)]({'code':0x0,'data':null});getListByParams(_0x3078e9,_0x2a5a3a,_0x1afad4,_0x116405,_0x4c607e,_0xd369ce,_0x2a37a1,_0x14cc4f,_0x596d1d,_0xc9c0eb,_0x29ef81,_0xe763e5,_0x4be73d)[_0x374e05(0xbf)](_0x3ecf7a=>{const _0x396e0d=_0x374e05;let _0x4b6cf2={'code':0x0,'data':_0x3ecf7a};if(_0x116405==_0x396e0d(0x156))_0x4b6cf2[_0x396e0d(0x15c)]=dbBookFavorite['getFavoriteCount'](_0x3078e9[_0x396e0d(0x121)][_0x396e0d(0x157)],_0x3078e9['currentUser']['id']);else{if(_0x116405==_0x396e0d(0xd7))_0x4b6cf2[_0x396e0d(0x15c)]=dbBookIndexTable['getBookListCount'](_0x3078e9[_0x396e0d(0x121)][_0x396e0d(0x157)],_0x1afad4,_0x596d1d,_0xc9c0eb,_0x4be73d);else _0x116405=='bookList'&&(_0x4b6cf2[_0x396e0d(0x15c)]=dbBookListTable['getBookListBookCount'](_0x3078e9[_0x396e0d(0x121)][_0x396e0d(0x157)],_0x29ef81));}return _0x2a5a3a[_0x396e0d(0x11b)](_0x4b6cf2);});}),router[_0xdf84ee(0x10a)](_0xdf84ee(0x141),(_0x45ba3b,_0x1ed3f2,_0x17a0fe)=>{const _0x2d0e87=_0xdf84ee;let _0x275597=_0x45ba3b[_0x2d0e87(0xfa)]['id'],_0x3a6d54=dbFileIndexTable['getById'](_0x45ba3b[_0x2d0e87(0x121)][_0x2d0e87(0x157)],_0x275597,dbFileIndexTable[_0x2d0e87(0xe9)]);if(!_0x3a6d54)return _0x45ba3b[_0x2d0e87(0x121)][_0x2d0e87(0x150)](_0x1ed3f2,_0x2d0e87(0x13c));if(dbUserTable[_0x2d0e87(0xd6)](_0x45ba3b,_0x1ed3f2,'book',_0x2d0e87(0x128),_0x3a6d54['path'])==!![]){let _0x17d401=_0x45ba3b[_0x2d0e87(0x151)]['id'],_0x2f9c12=dbBookFavorite['getFavorite'](_0x45ba3b['app'][_0x2d0e87(0x157)],_0x17d401,_0x275597);_0x3a6d54[_0x2d0e87(0x156)]=_0x2f9c12?0x1:0x0,_0x3a6d54['filePath']=path[_0x2d0e87(0xe8)](_0x3a6d54[_0x2d0e87(0xda)],_0x3a6d54[_0x2d0e87(0x144)]);let _0x3ef6ea=dbBookIndexTable['getBookListByPath'](_0x45ba3b['app'][_0x2d0e87(0x157)],_0x3a6d54[_0x2d0e87(0xda)]);_0x3ef6ea['length']>0x0?(_0x3ef6ea=arrayUtil[_0x2d0e87(0x152)](_0x3ef6ea,'filename'),setBookListProps(_0x45ba3b,_0x3ef6ea)[_0x2d0e87(0xbf)](_0x33d6d8=>{_0x3ef6ea=_0x33d6d8,_0x1da53a();})):_0x1da53a;function _0x1da53a(){let _0x27f38a={'code':0x0,'data':_0x3a6d54,'sameFolderBookList':_0x3ef6ea};getBookSameNameCover(_0x3a6d54)['then'](_0x556eb5=>{const _0x1da005=_0x433f;_0x3a6d54[_0x1da005(0xc5)]=_0x556eb5;let _0xcc8148=_0x45ba3b[_0x1da005(0x121)][_0x1da005(0x157)][_0x1da005(0x165)](_0x1da005(0x15a))[_0x1da005(0x118)](_0x17d401,path['join'](_0x3a6d54['path'],_0x3a6d54[_0x1da005(0x144)]),_0x3a6d54['size']);_0xcc8148&&(_0x27f38a[_0x1da005(0x136)]=_0xcc8148[_0x1da005(0x136)]),_0x27f38a[_0x1da005(0x158)]=fs['stat'](_0x3a6d54['filePath'],(_0x4131d0,_0x2d7e6c)=>{const _0x2c8a7f=_0x1da005;return _0x4131d0?_0x27f38a[_0x2c8a7f(0x102)]=0x0:_0x27f38a[_0x2c8a7f(0x102)]=0x1,_0x1ed3f2[_0x2c8a7f(0x11b)](_0x27f38a);});});}}}),router['post']('/bookFavorite',(_0x1b7f21,_0x4e1f3c,_0x3d28a3)=>{const _0x301303=_0xdf84ee;let _0x2f6a19=_0x1b7f21[_0x301303(0x151)]['id'];function _0x353f7c(_0xb1f4ba){const _0x326bde=_0x301303;let _0xe779d4=dbFileIndexTable[_0x326bde(0x168)](_0x1b7f21['app'][_0x326bde(0x157)],_0xb1f4ba,dbFileIndexTable[_0x326bde(0xe9)]);if(!_0xe779d4)return;let _0x17a7e8=new Date()[_0x326bde(0x12b)]();_0x1b7f21[_0x326bde(0x121)][_0x326bde(0x157)][_0x326bde(0x165)]('UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?')[_0x326bde(0xd9)](_0x17a7e8,_0xb1f4ba),dbBookFavorite[_0x326bde(0xcc)](_0x1b7f21[_0x326bde(0x121)]['dbFileIndex'],_0x2f6a19,_0xb1f4ba);}if(_0x1b7f21[_0x301303(0xfa)]['indexId']instanceof Array){let _0x21ba1e=_0x1b7f21['body']['operation'];if(_0x21ba1e==_0x301303(0xdc))for(let _0xb31d25 of _0x1b7f21['body'][_0x301303(0xc2)]){_0x353f7c(_0xb31d25);}else{if(_0x21ba1e==_0x301303(0xba))for(let _0xb269cb of _0x1b7f21[_0x301303(0xfa)]['indexId']){dbBookFavorite[_0x301303(0xce)](_0x1b7f21[_0x301303(0x121)][_0x301303(0x157)],_0x2f6a19,_0xb269cb);}}return _0x4e1f3c[_0x301303(0x11b)]({'code':0x0});}else{let _0x27d603=parseInt(_0x1b7f21[_0x301303(0xfa)][_0x301303(0xc2)]),_0x4c148d=dbBookFavorite[_0x301303(0x132)](_0x1b7f21[_0x301303(0x121)][_0x301303(0x157)],_0x2f6a19,_0x27d603),_0xc5675=0x0;return _0x4c148d?dbBookFavorite[_0x301303(0xce)](_0x1b7f21[_0x301303(0x121)][_0x301303(0x157)],_0x2f6a19,_0x27d603):(_0xc5675=0x1,_0x353f7c(_0x27d603)),_0x4e1f3c[_0x301303(0x11b)]({'code':0x0,'favorite':_0xc5675});}}),router['get'](_0xdf84ee(0x113),(_0x540e3e,_0x36885f,_0x1c1ec5)=>{const _0x65fd76=_0xdf84ee;let _0x3d9d20=_0x540e3e[_0x65fd76(0xd4)]['indexId'],_0x29aa47=dbBookIndexTable[_0x65fd76(0x143)](_0x540e3e[_0x65fd76(0x121)][_0x65fd76(0x157)],_0x3d9d20),_0x1eddb3=_0x540e3e[_0x65fd76(0xd4)]['size'];!_0x1eddb3&&(_0x1eddb3=0x200);if(!_0x29aa47||_0x29aa47&&!_0x29aa47['cover_path'])return _0x36885f[_0x65fd76(0xd2)](0x194)['end']();dbUserTable[_0x65fd76(0xd6)](_0x540e3e,_0x36885f,_0x65fd76(0x135),_0x65fd76(0x128),_0x29aa47[_0x65fd76(0xda)])==!![]&&fs[_0x65fd76(0xc3)](_0x29aa47[_0x65fd76(0xbb)],(_0x5a4934,_0x3b8d2b)=>{const _0x37ac36=_0x65fd76;if(_0x5a4934){let _0x165819=config['getMediaCoverCachePath'](_0x29aa47);bookIndexUtil[_0x37ac36(0x155)](_0x29aa47,_0x165819)['then'](_0x5d0895=>{const _0x499dd8=_0x37ac36;if(_0x5d0895['coverData'])bookIndexUtil[_0x499dd8(0xdd)](_0x5d0895['coverData'],_0x165819)[_0x499dd8(0xbf)](_0x5cb763=>{const _0x2a9eaf=_0x499dd8;return console['log']('封面写入成功',_0x5cb763),_0x36885f[_0x2a9eaf(0xc7)](_0x5cb763);})[_0x499dd8(0xcb)](_0x37802f=>{const _0x27d3f5=_0x499dd8;return _0x36885f[_0x27d3f5(0xd2)](0x194)[_0x27d3f5(0x14b)]();});else return _0x36885f[_0x499dd8(0xd2)](0x194)['end']();})[_0x37ac36(0xcb)](_0x14ad37=>{const _0x204849=_0x37ac36;return _0x36885f[_0x204849(0xd2)](0x194)['end']();});}else return _0x36885f['sendFile'](_0x29aa47[_0x37ac36(0xbb)]);});}),router[_0xdf84ee(0x10a)](_0xdf84ee(0x130),(_0x2364e3,_0x3a16cb,_0x50a602)=>{const _0x5a81f1=_0xdf84ee;let _0x485120=_0x2364e3['body'][_0x5a81f1(0x15e)]||0x32,_0x425080=_0x2364e3[_0x5a81f1(0xfa)]['offset']||0x0,_0x57e43d=_0x2364e3[_0x5a81f1(0xfa)][_0x5a81f1(0xb3)]||_0x5a81f1(0x14d),_0xbf28a5=_0x2364e3[_0x5a81f1(0xfa)][_0x5a81f1(0x10e)]||_0x5a81f1(0x140),_0x59406f=_0x2364e3[_0x5a81f1(0xfa)][_0x5a81f1(0x146)]||_0x5a81f1(0xe1),_0x5afddc=_0x2364e3[_0x5a81f1(0xfa)][_0x5a81f1(0x162)],_0x1f64d4=_0x2364e3[_0x5a81f1(0xfa)][_0x5a81f1(0xb4)];if(dbBookIndexTable[_0x5a81f1(0x129)](_0x2364e3,_0x3a16cb,_0xbf28a5,_0x59406f)!==!![])return;let _0x16bd40=[_0x5a81f1(0x140),'play_count',_0x5a81f1(0x140),'filename',_0x5a81f1(0x15f),_0x5a81f1(0xdf),_0x5a81f1(0xca),'id',_0x5a81f1(0x15b)],_0x1f8702=[_0x5a81f1(0xb6),_0x5a81f1(0xe1)];if(!_0x16bd40[_0x5a81f1(0x117)](_0xbf28a5)||!_0x1f8702['includes'](_0x59406f))return _0x2364e3[_0x5a81f1(0x121)][_0x5a81f1(0x150)](_0x3a16cb,_0x5a81f1(0xf9),_0xbf28a5,_0x59406f);let _0x1ffda5=dbUserTable[_0x5a81f1(0xb7)](_0x2364e3,_0x5a81f1(0x135),_0x5a81f1(0x128),!![]);if(_0x2364e3[_0x5a81f1(0x151)][_0x5a81f1(0x137)]!=0x1&&!_0x1ffda5&&_0x57e43d!=_0x5a81f1(0x14d))return _0x3a16cb[_0x5a81f1(0x11b)]({'code':0x0,'data':null});let _0x250df3=[];if(_0x57e43d==_0x5a81f1(0xdf))_0x250df3=dbBookIndexTable[_0x5a81f1(0xf3)](_0x2364e3[_0x5a81f1(0x121)][_0x5a81f1(0x157)],_0x1ffda5,_0x57e43d,_0x485120,_0x425080,_0xbf28a5,_0x59406f,_0x5afddc,_0x1f64d4);else{if(_0x57e43d==_0x5a81f1(0x14d)){_0x250df3=dbBookListTable['getBookListList'](_0x2364e3[_0x5a81f1(0x121)][_0x5a81f1(0x157)],_0x2364e3[_0x5a81f1(0x151)]['id'],_0x485120,_0x425080,'id','desc',_0x5afddc);for(let _0x49f5ee of _0x250df3){_0x49f5ee['cover']=dbBookIndexTable[_0x5a81f1(0xc9)](_0x2364e3['app'][_0x5a81f1(0x157)],_0x49f5ee['id']);}}}return _0x3a16cb[_0x5a81f1(0x11b)]({'code':0x0,'data':_0x250df3});}),router[_0xdf84ee(0x10a)]('/operationBookList',(_0x4875c6,_0x15760a,_0x2a8565)=>{const _0x233a0b=_0xdf84ee;let _0x2a0090=_0x4875c6['body'][_0x233a0b(0xf7)],_0x2ea5b3=_0x4875c6[_0x233a0b(0xfa)][_0x233a0b(0x149)];if(_0x2ea5b3==_0x233a0b(0xdc)){if(!_0x2a0090)return _0x4875c6['app']['returnErrMsg'](_0x15760a,'need\x20\x27name\x27');dbBookListTable[_0x233a0b(0xe4)](_0x4875c6[_0x233a0b(0x121)]['dbFileIndex'],_0x4875c6['currentUser']['id'],_0x2a0090);}else{if(_0x2ea5b3==_0x233a0b(0x108)||_0x2ea5b3=='delete'){let _0x2ca96f=_0x4875c6[_0x233a0b(0xfa)][_0x233a0b(0x163)],_0x32759c=dbBookListTable[_0x233a0b(0x159)](_0x4875c6['app'][_0x233a0b(0x157)],_0x2ca96f),_0x2c1b78=![];(_0x4875c6[_0x233a0b(0x151)][_0x233a0b(0x137)]==0x1||_0x32759c[_0x233a0b(0x11d)]==_0x4875c6[_0x233a0b(0x151)]['id'])&&(_0x2c1b78=!![]);if(!_0x2c1b78)return _0x15760a[_0x233a0b(0x11b)]({'code':0x66});if(_0x2ea5b3==_0x233a0b(0xba))dbBookListTable[_0x233a0b(0x167)](_0x4875c6['app'][_0x233a0b(0x157)],_0x2ca96f);else{if(_0x2ea5b3==_0x233a0b(0x108)){if(!_0x2a0090)return _0x4875c6[_0x233a0b(0x121)][_0x233a0b(0x150)](_0x15760a,'need\x20\x27name\x27');dbBookListTable['updateBookList'](_0x4875c6[_0x233a0b(0x121)]['dbFileIndex'],_0x2ca96f,_0x2a0090);}}}else return _0x4875c6['app'][_0x233a0b(0x150)](_0x15760a,'operation\x20error');}return _0x15760a[_0x233a0b(0x11b)]({'code':0x0});}),router[_0xdf84ee(0x10a)]('/operationBookListIndex',(_0xe52978,_0x3ee347,_0x564553)=>{const _0x4959f6=_0xdf84ee;let _0x92bb8c=_0xe52978[_0x4959f6(0xfa)][_0x4959f6(0xbd)],_0xe6bb0e=_0xe52978[_0x4959f6(0xfa)][_0x4959f6(0x163)];if(!_0x92bb8c||!_0xe6bb0e)return _0xe52978['app'][_0x4959f6(0x150)](_0x3ee347,_0x4959f6(0x10f));let _0x1cd470=dbBookListTable[_0x4959f6(0x159)](_0xe52978['app'][_0x4959f6(0x157)],_0xe6bb0e);if(!_0x1cd470)return _0xe52978[_0x4959f6(0x121)][_0x4959f6(0x150)](_0x3ee347,_0x4959f6(0x120));let _0xccc320=_0xe52978[_0x4959f6(0xfa)]['operation'];if(_0xccc320=='add'){function _0x32672d(_0x2d7ec6){const _0x4964a7=_0x4959f6;let _0xbc5036=dbBookIndexTable['getBookIndex'](_0xe52978['app']['dbFileIndex'],_0x2d7ec6);if(!_0xbc5036)return;if(_0xbc5036['is_file']==0x1){dbBookListTable[_0x4964a7(0x14e)](_0xe52978['app']['dbFileIndex'],_0x2d7ec6,_0xe6bb0e);let _0x58c7e3=Date[_0x4964a7(0x104)]();_0xe52978[_0x4964a7(0x121)][_0x4964a7(0x157)][_0x4964a7(0x165)](_0x4964a7(0x14a))[_0x4964a7(0xd9)](_0x58c7e3,_0xbc5036['id']);}else{let _0x4fd80d=path[_0x4964a7(0xe8)](_0xbc5036[_0x4964a7(0xda)],_0xbc5036['filename']),_0x81cfca=_0xe52978[_0x4964a7(0x121)][_0x4964a7(0x157)][_0x4964a7(0x165)](_0x4964a7(0x12e))[_0x4964a7(0xfc)](_0x4fd80d,_0x4fd80d+path['sep']+'%');for(let _0x670e09 of _0x81cfca){dbBookListTable[_0x4964a7(0x14e)](_0xe52978[_0x4964a7(0x121)]['dbFileIndex'],_0x670e09['id'],_0xe6bb0e);}}}if(_0x92bb8c instanceof Array)for(let _0x210ff3 of _0x92bb8c){_0x32672d(_0x210ff3);}else _0x32672d(_0x92bb8c);}else{if(_0xccc320==_0x4959f6(0xba)){if(_0x92bb8c instanceof Array)for(let _0x146b02 of _0x92bb8c){dbBookListTable['removeBookFromList'](_0xe52978['app'][_0x4959f6(0x157)],_0x146b02,_0xe6bb0e);}else dbBookListTable[_0x4959f6(0xe6)](_0xe52978[_0x4959f6(0x121)][_0x4959f6(0x157)],_0x92bb8c,_0xe6bb0e);}else return _0xe52978[_0x4959f6(0x121)][_0x4959f6(0x150)](_0x3ee347,_0x4959f6(0x145));}return _0x3ee347[_0x4959f6(0x11b)]({'code':0x0,'data':{}});}),router[_0xdf84ee(0x10a)]('/getBookIndexFileTree',(_0x29b303,_0x3d5d2e,_0x142b0e)=>{const _0x2e099e=_0xdf84ee;let _0x16231b=_0x29b303[_0x2e099e(0xfa)][_0x2e099e(0x142)],_0x36f8ad=_0x29b303[_0x2e099e(0xfa)][_0x2e099e(0x164)],_0x271165='book';if(dbUserTable[_0x2e099e(0xd6)](_0x29b303,_0x3d5d2e,_0x271165,_0x2e099e(0x128))==!![]){let _0x39fa21=[];if(!_0x16231b){let _0x22bc01=[];_0x29b303[_0x2e099e(0x151)][_0x2e099e(0x137)]==0x1?_0x22bc01=dbSourceFolderTable[_0x2e099e(0xb5)](_0x29b303['app'][_0x2e099e(0x100)],_0x271165):_0x22bc01=dbUserTable[_0x2e099e(0x107)](_0x29b303[_0x2e099e(0x121)][_0x2e099e(0x100)],_0x29b303[_0x2e099e(0x151)]['username'],_0x271165);if(_0x22bc01)for(let _0x128bdc=0x0;_0x128bdc<_0x22bc01[_0x2e099e(0xec)];_0x128bdc++){_0x39fa21[_0x2e099e(0x126)]({'path':_0x22bc01[_0x128bdc]['path'],'is_file':0x0,'filename':path[_0x2e099e(0x13e)](_0x22bc01[_0x128bdc][_0x2e099e(0xda)]),'root':!![]});}}else{let _0x9ee6fd=[];if(_0x29b303['currentUser'][_0x2e099e(0x137)]!=0x1){if(dbUserTable[_0x2e099e(0xd6)](_0x29b303,_0x3d5d2e,_0x271165,_0x2e099e(0x128),_0x16231b)!==!![])return;}_0x16231b=path[_0x2e099e(0xe8)](_0x16231b);let _0x278023=_0x2e099e(0xf2);_0x9ee6fd['push'](_0x16231b);if(_0x36f8ad){let _0x3072ae='\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20';_0x278023+=_0x3072ae,_0x9ee6fd[_0x2e099e(0x126)]('%'+_0x36f8ad+'%'),_0x9ee6fd[_0x2e099e(0x126)]('%'+_0x36f8ad+'%');}let _0x40a473=_0x2e099e(0x116);_0x39fa21=_0x29b303[_0x2e099e(0x121)]['dbFileIndex'][_0x2e099e(0x165)](_0x2e099e(0xb8)+_0x40a473+_0x2e099e(0x169)+_0x278023)[_0x2e099e(0xfc)](_0x9ee6fd);}for(let _0x13f178 of _0x39fa21){if(_0x13f178['is_file']==0x0){let _0x483260=path[_0x2e099e(0xe8)](_0x13f178[_0x2e099e(0xda)],_0x13f178[_0x2e099e(0x144)]),_0x3b0fa7=_0x29b303[_0x2e099e(0x121)][_0x2e099e(0x157)][_0x2e099e(0x165)]('SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_book\x20WHERE\x20path=?\x20and\x20is_file=1')[_0x2e099e(0x118)](_0x483260);_0x13f178['fileCount']=_0x3b0fa7[_0x2e099e(0x15e)];}}let _0x5b1b9b=path['sep'],_0xce828d={'code':0x0,'data':_0x39fa21,'sep':_0x5b1b9b};return _0x3d5d2e[_0x2e099e(0x11b)](_0xce828d);}}),router[_0xdf84ee(0x10a)](_0xdf84ee(0x123),(_0x5c4101,_0x146c73,_0x1ef249)=>{const _0x5a301e=_0xdf84ee;let _0x1f5bc6=_0x5c4101['body']['bookIndexId'],_0x290002=_0x5c4101['body'][_0x5a301e(0x149)];if(!_0x1f5bc6)return _0x5c4101[_0x5a301e(0x121)][_0x5a301e(0x150)](_0x146c73,_0x5a301e(0x10b));let _0x4242d2=dbBookIndexTable[_0x5a301e(0x143)](_0x5c4101['app'][_0x5a301e(0x157)],_0x1f5bc6);if(!_0x4242d2)return _0x5c4101[_0x5a301e(0x121)][_0x5a301e(0x150)](_0x146c73,_0x5a301e(0xf1));if(_0x290002=='update'){let _0x2833e9={'title':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0x15f)],'publish_date':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0x110)],'year':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0x13f)],'isbn':_0x5c4101['body'][_0x5a301e(0xcf)],'language':_0x5c4101[_0x5a301e(0xfa)]['language'],'genre':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0x138)],'tag':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0x106)],'publisher':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0x15b)],'artist':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0xdf)],'introduction':_0x5c4101[_0x5a301e(0xfa)][_0x5a301e(0xb2)]},_0x509ab7=path[_0x5a301e(0xe8)](_0x4242d2[_0x5a301e(0xda)],_0x4242d2['filename']);fs[_0x5a301e(0xc3)](_0x509ab7,(_0x9db49d,_0x2e0816)=>{const _0x267839=_0x5a301e;if(_0x9db49d)return _0x5c4101[_0x267839(0x121)][_0x267839(0x150)](_0x146c73,_0x146c73['__'](_0x267839(0xb9))+_0x509ab7);let _0x3ce2d9=_0x509ab7['substring'](0x0,_0x509ab7[_0x267839(0xbc)]('.'))+_0x267839(0x11f);nfoUtil['saveBookNfo'](_0x2833e9,_0x3ce2d9)['then'](()=>{const _0x10e903=_0x267839;console[_0x10e903(0xf4)](_0x10e903(0x101)),dbBookIndexTable[_0x10e903(0x109)](_0x5c4101[_0x10e903(0x121)][_0x10e903(0x157)],_0x1f5bc6,_0x2833e9),_0x4242d2=dbBookIndexTable[_0x10e903(0x143)](_0x5c4101['app'][_0x10e903(0x157)],_0x1f5bc6),setBookListProps(_0x5c4101,[_0x4242d2])[_0x10e903(0xbf)](_0x3de7ef=>{const _0x5b19ff=_0x10e903;return _0x146c73[_0x5b19ff(0x11b)]({'code':0x0,'data':_0x3de7ef[0x0]});});})[_0x267839(0xcb)](_0x3a011f=>{const _0x1ccfb5=_0x267839;return console[_0x1ccfb5(0xf4)](_0x1ccfb5(0x13a),_0x3a011f),_0x5c4101[_0x1ccfb5(0x121)]['returnErrMsg'](_0x146c73,_0x1ccfb5(0x12f));});});}else{if(_0x290002==_0x5a301e(0xba)){let _0x23c0d4=path[_0x5a301e(0xe8)](_0x4242d2[_0x5a301e(0xda)],_0x4242d2[_0x5a301e(0x144)]),_0x309bae=_0x23c0d4['substring'](0x0,_0x23c0d4[_0x5a301e(0xbc)]('.'))+'.nfo';fs['stat'](_0x309bae,(_0x112b45,_0x5345df)=>{const _0x4b1178=_0x5a301e;if(_0x112b45)return _0x5c4101[_0x4b1178(0x121)][_0x4b1178(0x150)](_0x146c73,_0x146c73['__'](_0x4b1178(0xb9))+_0x309bae);fs['rm'](_0x309bae,_0x57314a=>{const _0x444187=_0x4b1178;if(_0x57314a)return _0x5c4101[_0x444187(0x121)][_0x444187(0x150)](_0x146c73,_0x146c73['__'](_0x444187(0xc0))+_0x309bae);return dbBookIndexTable['updateBook'](_0x5c4101[_0x444187(0x121)][_0x444187(0x157)],indexId,{}),_0x146c73[_0x444187(0x11b)]({'code':0x0});});});}else return _0x5c4101[_0x5a301e(0x121)][_0x5a301e(0x150)](_0x146c73,_0x5a301e(0x145));}}),module['exports']=router;