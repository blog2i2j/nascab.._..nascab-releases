const _0x5a4074=_0x4354;(function(_0x39a428,_0x59b57e){const _0x49f57c=_0x4354,_0x462adb=_0x39a428();while(!![]){try{const _0x32fbd3=parseInt(_0x49f57c(0xab))/0x1*(parseInt(_0x49f57c(0x152))/0x2)+parseInt(_0x49f57c(0xbc))/0x3+parseInt(_0x49f57c(0x105))/0x4+-parseInt(_0x49f57c(0xc0))/0x5+parseInt(_0x49f57c(0x137))/0x6+-parseInt(_0x49f57c(0x150))/0x7*(-parseInt(_0x49f57c(0xaf))/0x8)+parseInt(_0x49f57c(0x14f))/0x9*(-parseInt(_0x49f57c(0xe8))/0xa);if(_0x32fbd3===_0x59b57e)break;else _0x462adb['push'](_0x462adb['shift']());}catch(_0x1ec3e1){_0x462adb['push'](_0x462adb['shift']());}}}(_0x46f5,0x73859));let express=require(_0x5a4074(0x100)),router=express['Router'](),path=require(_0x5a4074(0x106)),fs=require('fs'),dbBookIndexTable=require('../../db/dbBookIndexTable'),dbFileIndexTable=require(_0x5a4074(0xfa)),dbBookListTable=require(_0x5a4074(0xf7)),dbBookFavorite=require(_0x5a4074(0xda));function _0x46f5(){const _0x2cacdb=['/getHomeData','getTime','then','/getReadRecord','publish_date',',f.title\x20','../../myConfig/config','play_count','../../db/dbBookFavorite','existsSync','/getBookList','replace','year','basename','removeBookFromList','/deleteSameNameCover','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','substring','\x20order\x20by\x20m.update_time\x20','/operationBookList','/refreshCheckTime','bookList','1000IplkWw','desc','filePath','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_book\x20WHERE\x20path=?\x20and\x20is_file=1','getMediaCoverCachePath','is_file','INDEX_TABLE_NAME_BOOK','book_count','orderType','/addReadRecord','searchStr','need\x20bookIndexId','addFavorite','tag','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid\x20=\x20?','../../db/dbBookListTable','getUserPathWhere','UPDATE\x20book_reader_config\x20SET\x20remark=?\x20WHERE\x20uid=?','../../db/dbFileIndexTable','\x20order\x20by\x20m.update_time\x20DESC\x20','saveBookNfo','need\x20type/indexId','getBookListCount','getBookIndexByFileName','express','updateByFiled','need\x20type','cover_path','deleteFavorite','1598272YdEEfJ','path','name','封面文件已删除','dbOther','isbn','updateBook','status','sharpWriteCover','get','parse','log','/bookFavorite','add','sendFile','post','favorite','getBookListById','title','extname','parent','\x20LIMIT\x20?\x20OFFSET\x20?\x20','length','returnErrMsg','SELECT\x20id\x20from\x20file_index_book\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','now','lastIndexOf','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20ORDER\x20BY\x20read_time\x20desc\x20LIMIT\x20?','offset','exist','check_time','exports','is_admin','REPLACE\x20INTO\x20book_read_record\x20(uid,book_filename,book_path,progress,read_time)\x20VALUES(?,?,?,?,?)','orderField/orderType\x20error','recentReadList','UPDATE\x20book_read_record\x20SET\x20progress=?,read_time=?\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','query','bookIndexId','\x20is_file=1','getById','getFavoriteCount','NO\x20book\x20INDEX','indexId','json','cover','.nfo','prepare','type','search','4844838zRMYFU','edit','getBookListBookCount','\x20order\x20by\x20f.artist_fl\x20','need\x20bookIndexId/bookListId','size','configJson','封面文件已不存在','filename','count','orderField','operation\x20error','nfo写入失败','body','book\x20not\x20exist','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_size=?','getBookListList','UPDATE\x20file_index_book\x20set\x20check_time=?\x20WHERE\x20id=?','endsWith','power_change','/setReaderConfig','SELECT\x20*\x20FROM\x20book_reader_config\x20WHERE\x20uid=?','getBookListByPath','addBookToBookList','222813xUWFpB','3376695rgbokU','removeBookList','4VVPPFh','getBookIndex','/operationBookListIndex','.jpg','book_filename','remark','error','/getBookDetail','all','need\x20\x27name\x27','username',',f.artist\x20','artist','getUserPower','join','asc','need\x20config\x20json',',f.filename_fl\x20','push','progress','UPDATE\x20book_reader_config\x20SET\x20config_json=?\x20WHERE\x20uid=?','run','\x20order\x20by\x20f.title_fl\x20','coverData','nfo写入成功','runGetBookInfoWorker','../../utils/arrayUtil','list','\x20FROM\x20file_index_book\x20WHERE\x20','birthtime','publisher','bookListId','letterIndex','index\x20id\x20error','deleteFail','385816bGEALk','SELECT\x20','recentAddList','../../db/dbUserTable','8dDwkat','end','delete','need\x20index\x20id','updateBookList','/setBookType','/getGroupList','fileName','getFavorite','dbFileIndex','book','comicList','currentUser','2492472PwGWwb','file_cover_path','stat','cover\x20format\x20error','1715025kOgObJ','/updateBookNfo','app','operation','introduction','sep','doUserCanGet','fileCount','SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?','language','power_get','checkOrderParams','catch','../../db/dbSourceFolderTable','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20OR\x20artist\x20like\x20?\x20OR\x20tag\x20like\x20?\x20OR\x20publisher\x20like\x20?\x20OR\x20isbn\x20like\x20?\x20OR\x20genre\x20like\x20?\x20OR\x20year\x20like\x20?)','../../utils/nfoUtil','includes','update'];_0x46f5=function(){return _0x2cacdb;};return _0x46f5();}function _0x4354(_0xc2c037,_0x2ae086){const _0x46f528=_0x46f5();return _0x4354=function(_0x43549a,_0x4b3786){_0x43549a=_0x43549a-0x9b;let _0x115f61=_0x46f528[_0x43549a];return _0x115f61;},_0x4354(_0xc2c037,_0x2ae086);}const dbUserTable=require(_0x5a4074(0xae)),dbSourceFolderTable=require(_0x5a4074(0xcd));let os=require('os'),config=require(_0x5a4074(0xd8));const bookIndexUtil=require('../../myWorkers/index/bookIndexUtil'),arrayUtil=require(_0x5a4074(0xa2)),nfoUtil=require(_0x5a4074(0xcf));function getBookSameNameCover(_0x430931){return new Promise((_0x5bb55e,_0x2350ff)=>{const _0x29014b=_0x4354;try{let _0x232513=_0x430931[_0x29014b(0x13f)][_0x29014b(0xdd)](path[_0x29014b(0x118)](_0x430931['filename']),''),_0x3f7b74=path[_0x29014b(0x160)](_0x430931[_0x29014b(0x106)],_0x232513+_0x29014b(0x155)),_0x58d020='';fs[_0x29014b(0xdb)](_0x3f7b74)&&(_0x58d020=_0x3f7b74),_0x5bb55e(_0x58d020);}catch(_0x41e5c2){_0x5bb55e('');}});}router[_0x5a4074(0x114)](_0x5a4074(0x14b),(_0x308b85,_0x5e66c7,_0x531aa6)=>{const _0x2fa9f7=_0x5a4074;let _0x562d71=_0x308b85[_0x2fa9f7(0xbb)]['id'],_0x54d957=_0x308b85[_0x2fa9f7(0x144)][_0x2fa9f7(0x13d)],_0x402560=_0x308b85[_0x2fa9f7(0x144)][_0x2fa9f7(0x157)];if(!_0x54d957&&!_0x402560)return _0x308b85['app']['returnErrMsg'](_0x5e66c7,_0x2fa9f7(0x162));try{JSON[_0x2fa9f7(0x10f)](_0x54d957);}catch(_0x367b42){return _0x308b85[_0x2fa9f7(0xc2)][_0x2fa9f7(0x11c)](_0x5e66c7,'config\x20json\x20format\x20error');}let _0x44441e=_0x308b85[_0x2fa9f7(0xc2)][_0x2fa9f7(0x109)]['prepare'](_0x2fa9f7(0x14c))[_0x2fa9f7(0x10e)](_0x562d71);if(_0x44441e){if(_0x54d957)_0x308b85[_0x2fa9f7(0xc2)][_0x2fa9f7(0x109)]['prepare'](_0x2fa9f7(0x9c))[_0x2fa9f7(0x9d)](_0x54d957,_0x562d71);else _0x402560&&_0x308b85[_0x2fa9f7(0xc2)][_0x2fa9f7(0x109)][_0x2fa9f7(0x134)](_0x2fa9f7(0xf9))[_0x2fa9f7(0x9d)](_0x402560,_0x562d71);}else _0x308b85['app']['dbOther'][_0x2fa9f7(0x134)]('REPLACE\x20INTO\x20book_reader_config\x20(uid,config_json,remark)\x20VALUES(?,?,?)')[_0x2fa9f7(0x9d)](_0x562d71,_0x54d957,_0x402560);return _0x5e66c7[_0x2fa9f7(0x131)]({'code':0x0});}),router[_0x5a4074(0x114)](_0x5a4074(0xe1),(_0x2f4699,_0x362929,_0x35113c)=>{const _0x17c01e=_0x5a4074;let _0xd2e93a=_0x2f4699[_0x17c01e(0xbb)]['id'],_0x36c904=_0x2f4699[_0x17c01e(0x144)][_0x17c01e(0x12b)];if(!_0x36c904)return _0x2f4699[_0x17c01e(0xc2)]['returnErrMsg'](_0x362929,_0x17c01e(0xf3));let _0x26c81d=dbFileIndexTable[_0x17c01e(0x12d)](_0x2f4699[_0x17c01e(0xc2)][_0x17c01e(0xb8)],_0x36c904,dbFileIndexTable[_0x17c01e(0xee)]);if(!_0x26c81d)return _0x2f4699['app'][_0x17c01e(0x11c)](_0x362929,'need\x20bookIndexId');dbUserTable[_0x17c01e(0xc6)](_0x2f4699,_0x362929,'','power_delete',_0x26c81d['path'])==!![]&&getBookSameNameCover(_0x26c81d)[_0x17c01e(0xd4)](_0x1ca751=>{const _0x2c140d=_0x17c01e;if(!_0x1ca751[_0x2c140d(0x149)](_0x2c140d(0x155)))return _0x2f4699[_0x2c140d(0xc2)][_0x2c140d(0x11c)](_0x362929,_0x2c140d(0xbf));fs[_0x2c140d(0xbe)](_0x1ca751,(_0x29d6c2,_0x43d206)=>{const _0x536700=_0x2c140d;if(_0x29d6c2)return console[_0x536700(0x110)](_0x536700(0x13e)),_0x362929[_0x536700(0x131)]({'code':0x0});fs['rm'](_0x1ca751,_0x29bb3d=>{const _0x4deebc=_0x536700;if(_0x29bb3d)return _0x2f4699[_0x4deebc(0xc2)][_0x4deebc(0x11c)](_0x362929,_0x362929['__'](_0x4deebc(0xaa))+_0x1ca751);return console[_0x4deebc(0x110)](_0x4deebc(0x108),_0x1ca751),_0x362929[_0x4deebc(0x131)]({'code':0x0});});});});}),router[_0x5a4074(0x114)](_0x5a4074(0xe6),(_0x3ce0e6,_0xa5f195,_0x5eb739)=>{const _0x4c9b2d=_0x5a4074;let _0x4f7b9c=_0x3ce0e6['currentUser']['id'],_0x50bc34=_0x3ce0e6['body'][_0x4c9b2d(0x12b)];if(!_0x50bc34)return _0xa5f195[_0x4c9b2d(0x10c)](0x194)[_0x4c9b2d(0xb0)]();return dbBookIndexTable[_0x4c9b2d(0x101)](_0x3ce0e6[_0x4c9b2d(0xc2)][_0x4c9b2d(0xb8)],_0x50bc34,'check_time',new Date()[_0x4c9b2d(0xd3)]()),_0xa5f195[_0x4c9b2d(0x131)]({'code':0x0});}),router['post'](_0x5a4074(0xf1),(_0x54f2ea,_0x315141,_0x21a1e5)=>{const _0x41470a=_0x5a4074;let _0x14fd99=_0x54f2ea[_0x41470a(0xbb)]['id'];if(!_0x54f2ea[_0x41470a(0x144)]['fileName']||!_0x54f2ea[_0x41470a(0x144)]['filePath']||!_0x54f2ea['body'][_0x41470a(0x9b)])return _0x315141[_0x41470a(0x131)]({'code':0x0});let _0x452012=_0x54f2ea[_0x41470a(0x144)][_0x41470a(0xb6)];_0x452012=path[_0x41470a(0xdf)](_0x54f2ea['body'][_0x41470a(0xb6)]);let _0x1e5c86=path['join'](_0x54f2ea[_0x41470a(0x144)]['filePath']),_0x58b717=_0x54f2ea[_0x41470a(0x144)][_0x41470a(0x9b)],_0x269fef=_0x54f2ea[_0x41470a(0xc2)]['dbFileIndex'][_0x41470a(0x134)]('SELECT\x20*\x20FROM\x20book_read_record\x20WHERE\x20uid=?\x20AND\x20book_filename=?\x20AND\x20book_path=?')[_0x41470a(0x10e)](_0x14fd99,_0x452012,_0x1e5c86);return _0x269fef?_0x54f2ea[_0x41470a(0xc2)][_0x41470a(0xb8)]['prepare'](_0x41470a(0x129))[_0x41470a(0x9d)](_0x58b717,Date[_0x41470a(0x11e)](),_0x14fd99,_0x452012,_0x1e5c86):_0x54f2ea[_0x41470a(0xc2)][_0x41470a(0xb8)]['prepare'](_0x41470a(0x126))[_0x41470a(0x9d)](_0x14fd99,_0x452012,_0x1e5c86,_0x58b717,Date['now']()),_0x315141[_0x41470a(0x131)]({'code':0x0});}),router[_0x5a4074(0x114)](_0x5a4074(0xd5),(_0x371a8d,_0x288ffc,_0x377cf2)=>{const _0x2c4333=_0x5a4074;let _0x3a69e7=_0x371a8d['currentUser']['id'],_0x1461bb=_0x371a8d[_0x2c4333(0xc2)][_0x2c4333(0x109)]['prepare'](_0x2c4333(0xf6))[_0x2c4333(0x10e)](_0x3a69e7),_0x367bff=0x0,_0x9a884a=_0x371a8d[_0x2c4333(0x144)][_0x2c4333(0xb6)],_0x279f27=_0x371a8d['body'][_0x2c4333(0xea)];if(_0x9a884a&&_0x279f27){_0x279f27=path['join'](_0x279f27+'');let _0x2c7ea7=_0x371a8d[_0x2c4333(0xc2)]['dbFileIndex']['prepare'](_0x2c4333(0xc8))['get'](_0x3a69e7,_0x9a884a,_0x279f27);_0x2c7ea7&&(_0x367bff=_0x2c7ea7[_0x2c4333(0x9b)]);}return _0x288ffc[_0x2c4333(0x131)]({'code':0x0,'progress':_0x367bff,'readerConfig':_0x1461bb});}),router[_0x5a4074(0x114)](_0x5a4074(0xb4),(_0x5ce6d9,_0x238117,_0xe6b0d9)=>{const _0x4609d1=_0x5a4074;let _0x2537fd=_0x5ce6d9[_0x4609d1(0x144)][_0x4609d1(0x130)],_0x12d8ee=_0x5ce6d9[_0x4609d1(0x144)][_0x4609d1(0x135)];if(!_0x12d8ee||!_0x2537fd)return _0x5ce6d9[_0x4609d1(0xc2)]['returnErrMsg'](_0x238117,_0x4609d1(0xfd));if(_0x12d8ee!=0x1&&_0x12d8ee!=0x2)return _0x5ce6d9[_0x4609d1(0xc2)][_0x4609d1(0x11c)](_0x238117,_0x4609d1(0x102));let _0x3fca48=dbBookIndexTable[_0x4609d1(0x153)](_0x5ce6d9[_0x4609d1(0xc2)][_0x4609d1(0xb8)],_0x2537fd);if(!_0x3fca48)return _0x5ce6d9[_0x4609d1(0xc2)][_0x4609d1(0x11c)](_0x238117,_0x4609d1(0x145));if(dbUserTable[_0x4609d1(0xc6)](_0x5ce6d9,_0x238117,_0x4609d1(0xb9),_0x4609d1(0x14a),_0x3fca48[_0x4609d1(0x106)])==!![])return dbBookIndexTable[_0x4609d1(0x101)](_0x5ce6d9['app']['dbFileIndex'],_0x2537fd,_0x4609d1(0x135),_0x12d8ee),_0x238117[_0x4609d1(0x131)]({'code':0x0});});function getListByParams(_0x10a890,_0x1e2ebe,_0x146575,_0x22adb7,_0x487bdb,_0x577f55,_0x4bfe12,_0xcfabb0,_0x4d6610,_0xd4525c,_0xb55c80,_0x2f8f1c,_0x35f052){return new Promise((_0x4fa3f6,_0x4a074a)=>{const _0x2978ed=_0x4354;let _0x5640c1=_0x10a890[_0x2978ed(0xc2)][_0x2978ed(0xb8)],_0x823e6e=[];if(_0x22adb7==_0x2978ed(0xa3)||_0x22adb7=='bookList')_0x823e6e=dbBookIndexTable['getBookList'](_0x5640c1,_0x146575,_0x487bdb,_0x577f55,_0x4bfe12,_0xcfabb0,_0x4d6610,_0xb55c80,_0xd4525c,_0x2f8f1c,_0x35f052);else{if(_0x22adb7==_0x2978ed(0x115)){let _0x5dc45c='',_0x220a88=[];_0x5dc45c+=_0x2978ed(0x12c);_0xd4525c&&(_0xd4525c=_0xd4525c['replace']('\x27','')['replace']('’',''),_0x5dc45c+=_0x2978ed(0xce),_0x220a88[_0x2978ed(0x164)]('%'+_0xd4525c+'%','%'+_0xd4525c+'%','%'+_0xd4525c+'%','%'+_0xd4525c+'%','%'+_0xd4525c+'%','%'+_0xd4525c+'%','%'+_0xd4525c+'%','%'+_0xd4525c+'%'));_0x2f8f1c&&(_0x5dc45c+='\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)',_0x220a88[_0x2978ed(0x164)](_0x2f8f1c,_0x2f8f1c));if(_0x4bfe12&&_0xcfabb0){if(_0x4bfe12==_0x2978ed(0x15e))_0x5dc45c+=_0x2978ed(0x13a)+_0xcfabb0+_0x2978ed(0x15d)+_0xcfabb0+'\x20';else{if(_0x4bfe12=='title')_0x5dc45c+=_0x2978ed(0x9e)+_0xcfabb0+_0x2978ed(0xd7)+_0xcfabb0+_0x2978ed(0x163)+_0xcfabb0+'\x20';else _0x4bfe12=='favorite_time'?_0x5dc45c+=_0x2978ed(0xe4)+_0xcfabb0+'\x20':_0x5dc45c+='\x20order\x20by\x20f.'+_0x4bfe12+'\x20'+_0xcfabb0+'\x20';}}else _0x5dc45c+=_0x2978ed(0xfb);_0x5dc45c+=_0x2978ed(0x11a),_0x220a88['push'](_0x487bdb),_0x220a88[_0x2978ed(0x164)](_0x577f55),_0x823e6e=dbBookFavorite['getAllFavoriteByWhere'](_0x10a890[_0x2978ed(0xc2)]['dbFileIndex'],_0x10a890[_0x2978ed(0xbb)]['id'],_0x5dc45c,'*',_0x220a88);}}setBookListProps(_0x10a890,_0x823e6e)[_0x2978ed(0xd4)](_0x314ceb=>{_0x4fa3f6(_0x314ceb);});});}function setBookListProps(_0x55d3ba,_0xb5c888){return new Promise(async(_0x68119b,_0x4e5ec4)=>{const _0x8eebed=_0x4354;for(let _0x1bcbcf of _0xb5c888){_0x1bcbcf['favorite']=dbBookFavorite['bookIsFavorite'](_0x55d3ba[_0x8eebed(0xc2)][_0x8eebed(0xb8)],_0x1bcbcf['id'],_0x55d3ba[_0x8eebed(0xbb)]['id'])?'1':'0',_0x1bcbcf[_0x8eebed(0xea)]=path['join'](_0x1bcbcf[_0x8eebed(0x106)],_0x1bcbcf['filename']),_0x1bcbcf[_0x8eebed(0xbd)]=await getBookSameNameCover(_0x1bcbcf);}_0x68119b(_0xb5c888);});}router[_0x5a4074(0x114)](_0x5a4074(0xd2),(_0x1d0c50,_0x82d766,_0x42511b)=>{const _0x348e5f=_0x5a4074;let _0x5e54f2=_0x1d0c50[_0x348e5f(0x144)]['count']?_0x1d0c50[_0x348e5f(0x144)]['count']:0xc,_0x2e4731=_0x1d0c50[_0x348e5f(0xbb)]['id'],_0x251eff=dbUserTable[_0x348e5f(0xf8)](_0x1d0c50,_0x348e5f(0xb9),_0x348e5f(0xca),!![]);if(_0x1d0c50[_0x348e5f(0xbb)][_0x348e5f(0x125)]!=0x1&&!_0x251eff)return _0x82d766['json']({'code':0x0,'data':null});let _0x89e076=[],_0x15cfc7=_0x1d0c50[_0x348e5f(0xc2)][_0x348e5f(0xb8)][_0x348e5f(0x134)](_0x348e5f(0x120))['all'](_0x2e4731,_0x5e54f2);for(let _0x36188f of _0x15cfc7){let _0x370042=dbBookIndexTable[_0x348e5f(0xff)](_0x1d0c50[_0x348e5f(0xc2)]['dbFileIndex'],_0x36188f['book_path'],_0x36188f[_0x348e5f(0x156)]);_0x370042&&dbUserTable[_0x348e5f(0xc6)](_0x1d0c50,_0x82d766,_0x348e5f(0xb9),_0x348e5f(0xca),_0x370042[_0x348e5f(0x106)],!![])==!![]&&(_0x370042[_0x348e5f(0x9b)]=_0x36188f[_0x348e5f(0x9b)],_0x89e076[_0x348e5f(0x164)](_0x370042));}setBookListProps(_0x1d0c50,_0x89e076)[_0x348e5f(0xd4)](_0x128ad1=>{const _0xec6c22=_0x348e5f;_0x89e076=_0x128ad1,getListByParams(_0x1d0c50,_0x82d766,_0x251eff,_0xec6c22(0xa3),_0x5e54f2,0x0,_0xec6c22(0x123),'desc',null,null,null,null,0x1)[_0xec6c22(0xd4)](_0x32ba3d=>{const _0x389904=_0xec6c22;getListByParams(_0x1d0c50,_0x82d766,_0x251eff,_0x389904(0xa3),_0x5e54f2,0x0,_0x389904(0x123),_0x389904(0xe9),null,null,null,null,0x2)[_0x389904(0xd4)](_0x56b4e3=>{const _0x81fe5c=_0x389904;getListByParams(_0x1d0c50,_0x82d766,_0x251eff,_0x81fe5c(0xa3),_0x5e54f2,0x0,'id',_0x81fe5c(0xe9))[_0x81fe5c(0xd4)](_0x5273f8=>{const _0x388431=_0x81fe5c;let _0x3d7ab0={};return _0x89e076&&_0x89e076[_0x388431(0x11b)]>0x0&&(_0x3d7ab0[_0x388431(0x128)]=_0x89e076),_0x5273f8&&_0x5273f8[_0x388431(0x11b)]>0x0&&(_0x3d7ab0[_0x388431(0xad)]=_0x5273f8),_0x32ba3d&&_0x32ba3d[_0x388431(0x11b)]>0x0&&(_0x3d7ab0[_0x388431(0xe7)]=_0x32ba3d),_0x56b4e3&&_0x56b4e3['length']>0x0&&(_0x3d7ab0[_0x388431(0xba)]=_0x56b4e3),_0x82d766[_0x388431(0x131)]({'code':0x0,'data':_0x3d7ab0,'platform':os['platform']()});});});});});}),router[_0x5a4074(0x114)](_0x5a4074(0xdc),(_0x347800,_0x1f4ab7,_0x1c5c1)=>{const _0x1c1911=_0x5a4074;let _0x476d28=_0x347800['body'][_0x1c1911(0x140)]||0x32,_0x2ab18b=_0x347800[_0x1c1911(0x144)][_0x1c1911(0x121)]||0x0,_0x186b63=_0x347800[_0x1c1911(0x144)][_0x1c1911(0x15e)],_0x1546a8=_0x347800[_0x1c1911(0x144)][_0x1c1911(0x141)]||_0x1c1911(0x123),_0x5b360b=_0x347800[_0x1c1911(0x144)][_0x1c1911(0xf0)]||_0x1c1911(0xe9),_0x21262=[_0x1c1911(0xa3),_0x1c1911(0x115),'bookList'],_0x4b72a0=_0x347800[_0x1c1911(0x144)]['listType']||_0x1c1911(0xa3),_0x5ae1a9=_0x347800[_0x1c1911(0x144)][_0x1c1911(0x136)],_0x5d3df7=_0x347800[_0x1c1911(0x144)][_0x1c1911(0xa8)],_0x37f63c=_0x347800[_0x1c1911(0x144)][_0x1c1911(0xa7)],_0x5081ed=_0x347800['body'][_0x1c1911(0x135)];if(dbBookIndexTable[_0x1c1911(0xcb)](_0x347800,_0x1f4ab7,_0x1546a8,_0x5b360b)!==!![])return;if(_0x4b72a0==_0x1c1911(0xe7)){if(!_0x37f63c)return _0x347800[_0x1c1911(0xc2)]['returnErrMsg'](_0x1f4ab7,'need\x20bookListId');}!_0x21262[_0x1c1911(0xd0)](_0x4b72a0)&&(_0x4b72a0=_0x1c1911(0xa3));_0x476d28>0x1f4&&(_0x476d28=0x1f4);let _0x134a79=dbUserTable['getUserPathWhere'](_0x347800,'book','power_get',!![]);if(_0x347800['currentUser'][_0x1c1911(0x125)]!=0x1&&!_0x134a79)return _0x1f4ab7['json']({'code':0x0,'data':null});getListByParams(_0x347800,_0x1f4ab7,_0x134a79,_0x4b72a0,_0x476d28,_0x2ab18b,_0x1546a8,_0x5b360b,_0x186b63,_0x5ae1a9,_0x37f63c,_0x5d3df7,_0x5081ed)[_0x1c1911(0xd4)](_0x26c5d0=>{const _0x2c0a63=_0x1c1911;let _0x2d0d4a={'code':0x0,'data':_0x26c5d0};if(_0x4b72a0==_0x2c0a63(0x115))_0x2d0d4a[_0x2c0a63(0xef)]=dbBookFavorite[_0x2c0a63(0x12e)](_0x347800[_0x2c0a63(0xc2)]['dbFileIndex'],_0x347800[_0x2c0a63(0xbb)]['id']);else{if(_0x4b72a0=='list')_0x2d0d4a[_0x2c0a63(0xef)]=dbBookIndexTable[_0x2c0a63(0xfe)](_0x347800[_0x2c0a63(0xc2)][_0x2c0a63(0xb8)],_0x134a79,_0x186b63,_0x5ae1a9,_0x5081ed);else _0x4b72a0==_0x2c0a63(0xe7)&&(_0x2d0d4a[_0x2c0a63(0xef)]=dbBookListTable[_0x2c0a63(0x139)](_0x347800[_0x2c0a63(0xc2)][_0x2c0a63(0xb8)],_0x37f63c));}return _0x1f4ab7['json'](_0x2d0d4a);});}),router[_0x5a4074(0x114)](_0x5a4074(0x159),(_0x320e56,_0x1282ef,_0x4ac4ae)=>{const _0x4e39f5=_0x5a4074;let _0x33e501=_0x320e56[_0x4e39f5(0x144)]['id'],_0x4302f7=dbFileIndexTable[_0x4e39f5(0x12d)](_0x320e56[_0x4e39f5(0xc2)][_0x4e39f5(0xb8)],_0x33e501,dbFileIndexTable[_0x4e39f5(0xee)]);if(!_0x4302f7)return _0x320e56['app'][_0x4e39f5(0x11c)](_0x1282ef,_0x4e39f5(0x12f));if(dbUserTable[_0x4e39f5(0xc6)](_0x320e56,_0x1282ef,_0x4e39f5(0xb9),_0x4e39f5(0xca),_0x4302f7[_0x4e39f5(0x106)])==!![]){let _0x311c27=_0x320e56['currentUser']['id'],_0xbcff85=dbBookFavorite[_0x4e39f5(0xb7)](_0x320e56[_0x4e39f5(0xc2)][_0x4e39f5(0xb8)],_0x311c27,_0x33e501);_0x4302f7[_0x4e39f5(0x115)]=_0xbcff85?0x1:0x0,_0x4302f7[_0x4e39f5(0xea)]=path[_0x4e39f5(0x160)](_0x4302f7[_0x4e39f5(0x106)],_0x4302f7['filename']);let _0x3ac67f=dbBookIndexTable[_0x4e39f5(0x14d)](_0x320e56[_0x4e39f5(0xc2)]['dbFileIndex'],_0x4302f7[_0x4e39f5(0x106)]);_0x3ac67f[_0x4e39f5(0x11b)]>0x0?(_0x3ac67f=arrayUtil['sortFileNamesByNumber'](_0x3ac67f,_0x4e39f5(0x13f)),setBookListProps(_0x320e56,_0x3ac67f)[_0x4e39f5(0xd4)](_0x5533dc=>{_0x3ac67f=_0x5533dc,_0x13fa18();})):_0x13fa18;function _0x13fa18(){const _0x40b1ab=_0x4e39f5;let _0x13e6ca={'code':0x0,'data':_0x4302f7,'sameFolderBookList':_0x3ac67f};getBookSameNameCover(_0x4302f7)[_0x40b1ab(0xd4)](_0x4cd807=>{const _0x3e756f=_0x40b1ab;_0x4302f7['file_cover_path']=_0x4cd807;let _0x2f77b7=_0x320e56[_0x3e756f(0xc2)][_0x3e756f(0xb8)][_0x3e756f(0x134)](_0x3e756f(0x146))[_0x3e756f(0x10e)](_0x311c27,path[_0x3e756f(0x160)](_0x4302f7[_0x3e756f(0x106)],_0x4302f7['filename']),_0x4302f7[_0x3e756f(0x13c)]);_0x2f77b7&&(_0x13e6ca['progress']=_0x2f77b7['progress']),_0x13e6ca['fileExist']=fs[_0x3e756f(0xbe)](_0x4302f7[_0x3e756f(0xea)],(_0x1778b4,_0x5d6b7c)=>{const _0x57e684=_0x3e756f;return _0x1778b4?_0x13e6ca[_0x57e684(0x122)]=0x0:_0x13e6ca[_0x57e684(0x122)]=0x1,_0x1282ef['json'](_0x13e6ca);});});}}}),router[_0x5a4074(0x114)](_0x5a4074(0x111),(_0x1f5176,_0x2520a6,_0x239a97)=>{const _0x26a0b7=_0x5a4074;let _0x5d686e=_0x1f5176[_0x26a0b7(0xbb)]['id'];function _0x504b6f(_0x295a0f){const _0x5b10c3=_0x26a0b7;let _0x2d00cf=dbFileIndexTable[_0x5b10c3(0x12d)](_0x1f5176[_0x5b10c3(0xc2)][_0x5b10c3(0xb8)],_0x295a0f,dbFileIndexTable[_0x5b10c3(0xee)]);if(!_0x2d00cf)return;let _0x35ef6a=new Date()[_0x5b10c3(0xd3)]();_0x1f5176[_0x5b10c3(0xc2)]['dbFileIndex'][_0x5b10c3(0x134)](_0x5b10c3(0x148))[_0x5b10c3(0x9d)](_0x35ef6a,_0x295a0f),dbBookFavorite[_0x5b10c3(0xf4)](_0x1f5176['app']['dbFileIndex'],_0x5d686e,_0x295a0f);}if(_0x1f5176[_0x26a0b7(0x144)]['indexId']instanceof Array){let _0xe0c51a=_0x1f5176['body'][_0x26a0b7(0xc3)];if(_0xe0c51a==_0x26a0b7(0x112))for(let _0x395219 of _0x1f5176[_0x26a0b7(0x144)][_0x26a0b7(0x130)]){_0x504b6f(_0x395219);}else{if(_0xe0c51a==_0x26a0b7(0xb1))for(let _0x8e942e of _0x1f5176[_0x26a0b7(0x144)]['indexId']){dbBookFavorite[_0x26a0b7(0x104)](_0x1f5176[_0x26a0b7(0xc2)][_0x26a0b7(0xb8)],_0x5d686e,_0x8e942e);}}return _0x2520a6['json']({'code':0x0});}else{let _0x1dcc0c=parseInt(_0x1f5176[_0x26a0b7(0x144)]['indexId']),_0x40f23e=dbBookFavorite[_0x26a0b7(0xb7)](_0x1f5176[_0x26a0b7(0xc2)]['dbFileIndex'],_0x5d686e,_0x1dcc0c),_0x559ddc=0x0;return _0x40f23e?dbBookFavorite[_0x26a0b7(0x104)](_0x1f5176[_0x26a0b7(0xc2)][_0x26a0b7(0xb8)],_0x5d686e,_0x1dcc0c):(_0x559ddc=0x1,_0x504b6f(_0x1dcc0c)),_0x2520a6[_0x26a0b7(0x131)]({'code':0x0,'favorite':_0x559ddc});}}),router[_0x5a4074(0x10e)]('/getBookCover',(_0x290663,_0x23efbd,_0x2eb20f)=>{const _0x3da562=_0x5a4074;let _0x5dfa91=_0x290663[_0x3da562(0x12a)][_0x3da562(0x130)],_0x1fffaf=dbBookIndexTable[_0x3da562(0x153)](_0x290663['app'][_0x3da562(0xb8)],_0x5dfa91),_0x2c1c94=_0x290663[_0x3da562(0x12a)][_0x3da562(0x13c)];!_0x2c1c94&&(_0x2c1c94=0x200);if(!_0x1fffaf||_0x1fffaf&&!_0x1fffaf[_0x3da562(0x103)])return _0x23efbd['status'](0x194)[_0x3da562(0xb0)]();dbUserTable[_0x3da562(0xc6)](_0x290663,_0x23efbd,_0x3da562(0xb9),_0x3da562(0xca),_0x1fffaf['path'])==!![]&&fs[_0x3da562(0xbe)](_0x1fffaf[_0x3da562(0x103)],(_0x825373,_0x44c5ec)=>{const _0x490fc9=_0x3da562;if(_0x825373){let _0x15eba9=config[_0x490fc9(0xec)](_0x1fffaf);bookIndexUtil[_0x490fc9(0xa1)](_0x1fffaf,_0x15eba9)[_0x490fc9(0xd4)](_0x44ac6a=>{const _0x4963b6=_0x490fc9;if(_0x44ac6a[_0x4963b6(0x9f)])bookIndexUtil[_0x4963b6(0x10d)](_0x44ac6a['coverData'],_0x15eba9)[_0x4963b6(0xd4)](_0x20cd31=>{const _0x1bc772=_0x4963b6;return console[_0x1bc772(0x110)]('封面写入成功',_0x20cd31),_0x23efbd[_0x1bc772(0x113)](_0x20cd31);})[_0x4963b6(0xcc)](_0x573dc4=>{const _0x75072d=_0x4963b6;return _0x23efbd['status'](0x194)[_0x75072d(0xb0)]();});else return _0x23efbd[_0x4963b6(0x10c)](0x194)[_0x4963b6(0xb0)]();})[_0x490fc9(0xcc)](_0x5affdd=>{const _0x4f85df=_0x490fc9;return _0x23efbd[_0x4f85df(0x10c)](0x194)['end']();});}else return _0x23efbd[_0x490fc9(0x113)](_0x1fffaf[_0x490fc9(0x103)]);});}),router[_0x5a4074(0x114)](_0x5a4074(0xb5),(_0x29fc9a,_0x26621,_0x11c3b0)=>{const _0x21bcf6=_0x5a4074;let _0x9a311e=_0x29fc9a[_0x21bcf6(0x144)]['count']||0x32,_0xe63120=_0x29fc9a[_0x21bcf6(0x144)][_0x21bcf6(0x121)]||0x0,_0x41a2d7=_0x29fc9a[_0x21bcf6(0x144)]['groupField']||_0x21bcf6(0xe7),_0x517f31=_0x29fc9a[_0x21bcf6(0x144)][_0x21bcf6(0x141)]||'check_time',_0x451774=_0x29fc9a[_0x21bcf6(0x144)][_0x21bcf6(0xf0)]||_0x21bcf6(0xe9),_0x1dabe7=_0x29fc9a[_0x21bcf6(0x144)]['search'],_0x11d902=_0x29fc9a[_0x21bcf6(0x144)][_0x21bcf6(0xa8)];if(dbBookIndexTable[_0x21bcf6(0xcb)](_0x29fc9a,_0x26621,_0x517f31,_0x451774)!==!![])return;let _0x3cfabc=[_0x21bcf6(0x123),_0x21bcf6(0xd9),_0x21bcf6(0x123),_0x21bcf6(0x13f),_0x21bcf6(0x117),'artist',_0x21bcf6(0xa5),'id',_0x21bcf6(0xa6)],_0x88c15a=[_0x21bcf6(0x161),_0x21bcf6(0xe9)];if(!_0x3cfabc[_0x21bcf6(0xd0)](_0x517f31)||!_0x88c15a['includes'](_0x451774))return _0x29fc9a[_0x21bcf6(0xc2)]['returnErrMsg'](_0x26621,_0x21bcf6(0x127),_0x517f31,_0x451774);let _0x4a07e4=dbUserTable[_0x21bcf6(0xf8)](_0x29fc9a,_0x21bcf6(0xb9),'power_get',!![]);if(_0x29fc9a[_0x21bcf6(0xbb)][_0x21bcf6(0x125)]!=0x1&&!_0x4a07e4&&_0x41a2d7!=_0x21bcf6(0xe7))return _0x26621['json']({'code':0x0,'data':null});let _0xace53b=[];if(_0x41a2d7=='artist')_0xace53b=dbBookIndexTable['getGroupList'](_0x29fc9a[_0x21bcf6(0xc2)]['dbFileIndex'],_0x4a07e4,_0x41a2d7,_0x9a311e,_0xe63120,_0x517f31,_0x451774,_0x1dabe7,_0x11d902);else{if(_0x41a2d7==_0x21bcf6(0xe7)){_0xace53b=dbBookListTable[_0x21bcf6(0x147)](_0x29fc9a['app'][_0x21bcf6(0xb8)],_0x29fc9a[_0x21bcf6(0xbb)]['id'],_0x9a311e,_0xe63120,'id',_0x21bcf6(0xe9),_0x1dabe7);for(let _0x5c8827 of _0xace53b){_0x5c8827[_0x21bcf6(0x132)]=dbBookIndexTable['getBooklistCover'](_0x29fc9a[_0x21bcf6(0xc2)][_0x21bcf6(0xb8)],_0x5c8827['id']);}}}return _0x26621[_0x21bcf6(0x131)]({'code':0x0,'data':_0xace53b});}),router[_0x5a4074(0x114)](_0x5a4074(0xe5),(_0x42476e,_0x2a0e42,_0x201f2d)=>{const _0x287fc9=_0x5a4074;let _0x3de118=_0x42476e[_0x287fc9(0x144)][_0x287fc9(0x107)],_0x4535fd=_0x42476e[_0x287fc9(0x144)]['operation'];if(_0x4535fd=='add'){if(!_0x3de118)return _0x42476e['app']['returnErrMsg'](_0x2a0e42,_0x287fc9(0x15b));dbBookListTable['createBookList'](_0x42476e['app'][_0x287fc9(0xb8)],_0x42476e[_0x287fc9(0xbb)]['id'],_0x3de118);}else{if(_0x4535fd==_0x287fc9(0x138)||_0x4535fd==_0x287fc9(0xb1)){let _0x53082f=_0x42476e[_0x287fc9(0x144)][_0x287fc9(0xa7)],_0x28b323=dbBookListTable[_0x287fc9(0x116)](_0x42476e[_0x287fc9(0xc2)][_0x287fc9(0xb8)],_0x53082f),_0x11eb0b=![];(_0x42476e[_0x287fc9(0xbb)][_0x287fc9(0x125)]==0x1||_0x28b323['uid']==_0x42476e['currentUser']['id'])&&(_0x11eb0b=!![]);if(!_0x11eb0b)return _0x2a0e42[_0x287fc9(0x131)]({'code':0x66});if(_0x4535fd==_0x287fc9(0xb1))dbBookListTable[_0x287fc9(0x151)](_0x42476e[_0x287fc9(0xc2)][_0x287fc9(0xb8)],_0x53082f);else{if(_0x4535fd==_0x287fc9(0x138)){if(!_0x3de118)return _0x42476e[_0x287fc9(0xc2)]['returnErrMsg'](_0x2a0e42,_0x287fc9(0x15b));dbBookListTable[_0x287fc9(0xb3)](_0x42476e[_0x287fc9(0xc2)][_0x287fc9(0xb8)],_0x53082f,_0x3de118);}}}else return _0x42476e[_0x287fc9(0xc2)][_0x287fc9(0x11c)](_0x2a0e42,_0x287fc9(0x142));}return _0x2a0e42[_0x287fc9(0x131)]({'code':0x0});}),router['post'](_0x5a4074(0x154),(_0x556ef1,_0x124d41,_0x357caf)=>{const _0x3416e1=_0x5a4074;let _0x2ba5e5=_0x556ef1[_0x3416e1(0x144)][_0x3416e1(0x12b)],_0x351203=_0x556ef1[_0x3416e1(0x144)][_0x3416e1(0xa7)];if(!_0x2ba5e5||!_0x351203)return _0x556ef1[_0x3416e1(0xc2)][_0x3416e1(0x11c)](_0x124d41,_0x3416e1(0x13b));let _0x416825=dbBookListTable[_0x3416e1(0x116)](_0x556ef1[_0x3416e1(0xc2)][_0x3416e1(0xb8)],_0x351203);if(!_0x416825)return _0x556ef1['app'][_0x3416e1(0x11c)](_0x124d41,'bookListId\x20no\x20exists');let _0x257c55=_0x556ef1[_0x3416e1(0x144)][_0x3416e1(0xc3)];if(_0x257c55==_0x3416e1(0x112)){function _0x59a10c(_0x1fd836){const _0x5c0c90=_0x3416e1;let _0x3f60f4=dbBookIndexTable[_0x5c0c90(0x153)](_0x556ef1[_0x5c0c90(0xc2)]['dbFileIndex'],_0x1fd836);if(!_0x3f60f4)return;if(_0x3f60f4[_0x5c0c90(0xed)]==0x1){dbBookListTable[_0x5c0c90(0x14e)](_0x556ef1[_0x5c0c90(0xc2)][_0x5c0c90(0xb8)],_0x1fd836,_0x351203);let _0x587036=Date['now']();_0x556ef1[_0x5c0c90(0xc2)][_0x5c0c90(0xb8)][_0x5c0c90(0x134)](_0x5c0c90(0x148))[_0x5c0c90(0x9d)](_0x587036,_0x3f60f4['id']);}else{let _0x1398c7=path[_0x5c0c90(0x160)](_0x3f60f4[_0x5c0c90(0x106)],_0x3f60f4[_0x5c0c90(0x13f)]),_0xfea9fd=_0x556ef1[_0x5c0c90(0xc2)][_0x5c0c90(0xb8)]['prepare'](_0x5c0c90(0x11d))[_0x5c0c90(0x15a)](_0x1398c7,_0x1398c7+path[_0x5c0c90(0xc5)]+'%');for(let _0x2de262 of _0xfea9fd){dbBookListTable[_0x5c0c90(0x14e)](_0x556ef1[_0x5c0c90(0xc2)][_0x5c0c90(0xb8)],_0x2de262['id'],_0x351203);}}}if(_0x2ba5e5 instanceof Array)for(let _0x34a3e7 of _0x2ba5e5){_0x59a10c(_0x34a3e7);}else _0x59a10c(_0x2ba5e5);}else{if(_0x257c55==_0x3416e1(0xb1)){if(_0x2ba5e5 instanceof Array)for(let _0x1820ad of _0x2ba5e5){dbBookListTable[_0x3416e1(0xe0)](_0x556ef1[_0x3416e1(0xc2)][_0x3416e1(0xb8)],_0x1820ad,_0x351203);}else dbBookListTable[_0x3416e1(0xe0)](_0x556ef1['app'][_0x3416e1(0xb8)],_0x2ba5e5,_0x351203);}else return _0x556ef1[_0x3416e1(0xc2)][_0x3416e1(0x11c)](_0x124d41,_0x3416e1(0x142));}return _0x124d41[_0x3416e1(0x131)]({'code':0x0,'data':{}});}),router[_0x5a4074(0x114)]('/getBookIndexFileTree',(_0x444d31,_0x1918b3,_0x48ca9d)=>{const _0x2f2ec3=_0x5a4074;let _0x519b92=_0x444d31[_0x2f2ec3(0x144)][_0x2f2ec3(0x119)],_0x632191=_0x444d31[_0x2f2ec3(0x144)][_0x2f2ec3(0xf2)],_0x4708eb=_0x2f2ec3(0xb9);if(dbUserTable['doUserCanGet'](_0x444d31,_0x1918b3,_0x4708eb,_0x2f2ec3(0xca))==!![]){let _0x518b58=[];if(!_0x519b92){let _0x1cf3fd=[];_0x444d31['currentUser']['is_admin']==0x1?_0x1cf3fd=dbSourceFolderTable['getPathByType'](_0x444d31[_0x2f2ec3(0xc2)][_0x2f2ec3(0x109)],_0x4708eb):_0x1cf3fd=dbUserTable[_0x2f2ec3(0x15f)](_0x444d31[_0x2f2ec3(0xc2)][_0x2f2ec3(0x109)],_0x444d31['currentUser'][_0x2f2ec3(0x15c)],_0x4708eb);if(_0x1cf3fd)for(let _0x59b6a5=0x0;_0x59b6a5<_0x1cf3fd['length'];_0x59b6a5++){_0x518b58[_0x2f2ec3(0x164)]({'path':_0x1cf3fd[_0x59b6a5][_0x2f2ec3(0x106)],'is_file':0x0,'filename':path[_0x2f2ec3(0xdf)](_0x1cf3fd[_0x59b6a5]['path']),'root':!![]});}}else{let _0x4f24ab=[];if(_0x444d31[_0x2f2ec3(0xbb)][_0x2f2ec3(0x125)]!=0x1){if(dbUserTable[_0x2f2ec3(0xc6)](_0x444d31,_0x1918b3,_0x4708eb,_0x2f2ec3(0xca),_0x519b92)!==!![])return;}_0x519b92=path['join'](_0x519b92);let _0x2c8a73='\x20path=?\x20\x20';_0x4f24ab[_0x2f2ec3(0x164)](_0x519b92);if(_0x632191){let _0x4e694c=_0x2f2ec3(0xe2);_0x2c8a73+=_0x4e694c,_0x4f24ab['push']('%'+_0x632191+'%'),_0x4f24ab['push']('%'+_0x632191+'%');}let _0x170677='\x20id,is_file,id,path,filename,type,size,title,artist,ext,cover_path,language,publisher,total_page,type,check_time,create_time';_0x518b58=_0x444d31['app']['dbFileIndex']['prepare'](_0x2f2ec3(0xac)+_0x170677+_0x2f2ec3(0xa4)+_0x2c8a73)['all'](_0x4f24ab);}for(let _0x53bf4f of _0x518b58){if(_0x53bf4f[_0x2f2ec3(0xed)]==0x0){let _0x56e5dd=path[_0x2f2ec3(0x160)](_0x53bf4f[_0x2f2ec3(0x106)],_0x53bf4f[_0x2f2ec3(0x13f)]),_0x3d66a8=_0x444d31[_0x2f2ec3(0xc2)][_0x2f2ec3(0xb8)][_0x2f2ec3(0x134)](_0x2f2ec3(0xeb))[_0x2f2ec3(0x10e)](_0x56e5dd);_0x53bf4f[_0x2f2ec3(0xc7)]=_0x3d66a8['count'];}}let _0x2071cd=path[_0x2f2ec3(0xc5)],_0x1fef2f={'code':0x0,'data':_0x518b58,'sep':_0x2071cd};return _0x1918b3[_0x2f2ec3(0x131)](_0x1fef2f);}}),router['post'](_0x5a4074(0xc1),(_0x84fa82,_0xa46a55,_0x4d1831)=>{const _0x173ed9=_0x5a4074;let _0x594f34=_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0x12b)],_0x2c27e4=_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0xc3)];if(!_0x594f34)return _0x84fa82[_0x173ed9(0xc2)][_0x173ed9(0x11c)](_0xa46a55,_0x173ed9(0xb2));let _0x30a1fc=dbBookIndexTable['getBookIndex'](_0x84fa82[_0x173ed9(0xc2)][_0x173ed9(0xb8)],_0x594f34);if(!_0x30a1fc)return _0x84fa82[_0x173ed9(0xc2)][_0x173ed9(0x11c)](_0xa46a55,_0x173ed9(0xa9));if(_0x2c27e4==_0x173ed9(0xd1)){let _0xba6d67={'title':_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0x117)],'publish_date':_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0xd6)],'year':_0x84fa82['body'][_0x173ed9(0xde)],'isbn':_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0x10a)],'language':_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0xc9)],'genre':_0x84fa82[_0x173ed9(0x144)]['genre'],'tag':_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0xf5)],'publisher':_0x84fa82['body'][_0x173ed9(0xa6)],'artist':_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0x15e)],'introduction':_0x84fa82[_0x173ed9(0x144)][_0x173ed9(0xc4)]},_0x212d1d=path[_0x173ed9(0x160)](_0x30a1fc[_0x173ed9(0x106)],_0x30a1fc[_0x173ed9(0x13f)]);fs[_0x173ed9(0xbe)](_0x212d1d,(_0xd68e7b,_0x50c4eb)=>{const _0x1b7845=_0x173ed9;if(_0xd68e7b)return _0x84fa82[_0x1b7845(0xc2)]['returnErrMsg'](_0xa46a55,_0xa46a55['__']('folderNotExist')+_0x212d1d);let _0x37fc15=_0x212d1d['substring'](0x0,_0x212d1d['lastIndexOf']('.'))+_0x1b7845(0x133);nfoUtil[_0x1b7845(0xfc)](_0xba6d67,_0x37fc15)[_0x1b7845(0xd4)](()=>{const _0x4b0e70=_0x1b7845;console[_0x4b0e70(0x110)](_0x4b0e70(0xa0)),dbBookIndexTable[_0x4b0e70(0x10b)](_0x84fa82[_0x4b0e70(0xc2)][_0x4b0e70(0xb8)],_0x594f34,_0xba6d67),_0x30a1fc=dbBookIndexTable['getBookIndex'](_0x84fa82[_0x4b0e70(0xc2)][_0x4b0e70(0xb8)],_0x594f34),setBookListProps(_0x84fa82,[_0x30a1fc])[_0x4b0e70(0xd4)](_0x5ef350=>{const _0x1d9bc6=_0x4b0e70;return _0xa46a55[_0x1d9bc6(0x131)]({'code':0x0,'data':_0x5ef350[0x0]});});})['catch'](_0x218af5=>{const _0x130381=_0x1b7845;return console['log'](_0x130381(0x143),_0x218af5),_0x84fa82['app'][_0x130381(0x11c)](_0xa46a55,_0x130381(0x158));});});}else{if(_0x2c27e4==_0x173ed9(0xb1)){let _0xf6665=path[_0x173ed9(0x160)](_0x30a1fc['path'],_0x30a1fc[_0x173ed9(0x13f)]),_0x40b0dd=_0xf6665[_0x173ed9(0xe3)](0x0,_0xf6665[_0x173ed9(0x11f)]('.'))+_0x173ed9(0x133);fs[_0x173ed9(0xbe)](_0x40b0dd,(_0x108781,_0x1b7236)=>{const _0x53c8f0=_0x173ed9;if(_0x108781)return _0x84fa82[_0x53c8f0(0xc2)][_0x53c8f0(0x11c)](_0xa46a55,_0xa46a55['__']('folderNotExist')+_0x40b0dd);fs['rm'](_0x40b0dd,_0x242f01=>{const _0x4a6588=_0x53c8f0;if(_0x242f01)return _0x84fa82[_0x4a6588(0xc2)][_0x4a6588(0x11c)](_0xa46a55,_0xa46a55['__'](_0x4a6588(0xaa))+_0x40b0dd);return dbBookIndexTable[_0x4a6588(0x10b)](_0x84fa82[_0x4a6588(0xc2)]['dbFileIndex'],indexId,{}),_0xa46a55['json']({'code':0x0});});});}else return _0x84fa82[_0x173ed9(0xc2)]['returnErrMsg'](_0xa46a55,'operation\x20error');}}),module[_0x5a4074(0x124)]=router;