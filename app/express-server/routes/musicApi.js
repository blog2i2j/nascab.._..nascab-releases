const _0x40b1c0=_0x4748;(function(_0x3bff45,_0x377838){const _0x192760=_0x4748,_0xa8187c=_0x3bff45();while(!![]){try{const _0x57cd0e=-parseInt(_0x192760(0x225))/0x1+parseInt(_0x192760(0x27a))/0x2+parseInt(_0x192760(0x262))/0x3+parseInt(_0x192760(0x21b))/0x4+parseInt(_0x192760(0x287))/0x5+-parseInt(_0x192760(0x257))/0x6+-parseInt(_0x192760(0x291))/0x7;if(_0x57cd0e===_0x377838)break;else _0xa8187c['push'](_0xa8187c['shift']());}catch(_0xa0956b){_0xa8187c['push'](_0xa8187c['shift']());}}}(_0x16e8,0xbb0bb));let express=require(_0x40b1c0(0x26e)),router=express[_0x40b1c0(0x229)](),config=require('../../myConfig/config'),path=require('path'),fs=require('fs'),dbMusicIndexTable=require(_0x40b1c0(0x285)),dbFileIndexTable=require(_0x40b1c0(0x259)),dbMusicPlaylistTable=require(_0x40b1c0(0x260)),dbMusicFavorite=require(_0x40b1c0(0x290)),jsmediatags=require(_0x40b1c0(0x21a));const dbUserTable=require(_0x40b1c0(0x288));let musicUitls=require(_0x40b1c0(0x1ed)),sharpUtil=require(_0x40b1c0(0x202));const dbSourceFolderTable=require(_0x40b1c0(0x1f1));let nasAccountUtil=require('../utils/nasAccountUtils'),axios=require(_0x40b1c0(0x1f7)),sha256=require(_0x40b1c0(0x276)),os=require('os');function _0x16e8(){const _0x22d910=['filename','trim','post','uid','getUserPathWhere','jsmediatags','2354644sUVwyK','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','lyrics_get_state','base64','maxPlayMusic','play_count\x20desc','searchMusicAlbum','temp.','/getGroupList','coverList','1244485tIxyuR','favorite_time','playlistId','power_add','Router','/operationPlaylistIndex','edit','dbOther','groupField','now',',f.artist\x20','/saveLyric','getPathByType','check_time','includes','file_cover_path','getUserInfo','extname','favorite','add','offset','\x20path=?\x20AND\x20','getFavoriteCount','addFavorite','need\x20\x27name\x27','userInfo','getFavorite','indexId','\x20order\x20by\x20m.update_time\x20DESC\x20','updateByFiled','message','read','getPlaylistCover','\x20(type=3\x20OR\x20is_file=0)','\x20order\x20by\x20f.artist_fl\x20','orderType','/musicFavorite','apiMusicInfoUrl','token','\x20order\x20by\x20f.','delete','artist','orderField/orderType\x20error','asc','title','app','join','end','removePlaylist','playlistId\x20no\x20exists','2444100EdzOkW','createPlaylist','../../db/dbFileIndexTable','\x20order\x20by\x20f.title_fl\x20','existsSync','letterIndex','parent','getGroupList','getMusicSameNameCover','../../db/dbMusicPlaylistTable','is_file','2301387SexFbe','from','need\x20musicIndexId\x20and\x20playlistId','/getMusicCover','getPlaylistById','APIC','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','body','lyrics','musicIsFavorite','prepare','stringify','express','duration','isSearch','checkOrderParams','album','utf-8','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','apiTokenKey','sha256','status','musicIndexId','/operationPlaylist','1778488wiDnIY','ORDER\x20BY\x20','all','operation','skipCount','Lyric\x20is\x20null','music','get','/getMusicIndexFileTree','list','getAllFavoriteByWhere','../../db/dbMusicIndexTable','/getMusicList','4133290aTevvU','../../db/dbUserTable','genre','is_admin','recentAddList','dirname',',f.title\x20','getMusicIndex','\x20is_file=1','../../db/dbMusicFavorite','4576026wuXUdi','inner','cover_path','power_get','file','then',',f.album\x20','path','getTime','searchMusicName','albumCount','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','lrc','returnErrMsg',',id\x20asc','playlist','getCoverByField','getMusicList','last_play_time','recentMusic','orderField','../../utils/musicUtil','/searchLyric','removeMusicFromPlaylist','updatePlaylist','../../db/dbSourceFolderTable','INDEX_TABLE_NAME_MUSIC','doUserCanGet','currentUser','\x20LIMIT\x20?\x20OFFSET\x20?\x20','data','axios','replace','sendFile','deleteFavorite','desc','push','genTinyFile','username','addMusicToPlaylist','basename','abs','../utils/sharpUtils','albumList','\x20FROM\x20file_index_music\x20WHERE\x20','length','SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','.lrc','operation\x20error','year','count','picture','search','/getMusicHomeData','writeFile','run','catch','getById','dbFileIndex','music_count','json'];_0x16e8=function(){return _0x22d910;};return _0x16e8();}function getMusicListByParams(_0x4e2f49,_0x3b4cdc,_0x1b73a2,_0x570f26,_0x5b89d7,_0x3eff4d,_0x3bcb09,_0xf1b7dc,_0x51655a,_0x3cf612,_0x7d73c,_0x4ad136,_0x42fa2f,_0x939acb,_0x49e7cb){const _0x4e110a=_0x40b1c0;let _0x5411ca=_0x4e2f49[_0x4e110a(0x252)][_0x4e110a(0x212)],_0x53eaf3=[];if(_0x570f26==_0x4e110a(0x283)||_0x570f26==_0x4e110a(0x1e7))_0x53eaf3=dbMusicIndexTable[_0x4e110a(0x1e9)](_0x5411ca,_0x1b73a2,_0x5b89d7,_0x3eff4d,_0x3bcb09,_0xf1b7dc,_0x51655a,_0x3cf612,_0x7d73c,_0x4ad136,_0x939acb,_0x42fa2f,_0x49e7cb);else{if(_0x570f26=='favorite'){let _0x2981ca='',_0x5b10ea=[];_0x2981ca+=_0x4e110a(0x28f);_0x42fa2f&&(_0x42fa2f=_0x42fa2f[_0x4e110a(0x1f8)]('\x27','')[_0x4e110a(0x1f8)]('â€™',''),_0x2981ca+='\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)',_0x5b10ea[_0x4e110a(0x1fc)]('%'+_0x42fa2f+'%','%'+_0x42fa2f+'%','%'+_0x42fa2f+'%'));_0x49e7cb&&(_0x2981ca+=_0x4e110a(0x274),_0x5b10ea[_0x4e110a(0x1fc)](_0x49e7cb,_0x49e7cb));if(_0x3bcb09&&_0xf1b7dc){if(_0x3bcb09=='artist')_0x2981ca+=_0x4e110a(0x247)+_0xf1b7dc+_0x4e110a(0x22f)+_0xf1b7dc+'\x20';else{if(_0x3bcb09=='album')_0x2981ca+='\x20order\x20by\x20f.album_fl\x20'+_0xf1b7dc+_0x4e110a(0x297)+_0xf1b7dc+'\x20';else{if(_0x3bcb09=='title')_0x2981ca+=_0x4e110a(0x25a)+_0xf1b7dc+_0x4e110a(0x28d)+_0xf1b7dc+',f.filename_fl\x20'+_0xf1b7dc+'\x20';else _0x3bcb09==_0x4e110a(0x226)?_0x2981ca+='\x20order\x20by\x20m.update_time\x20'+_0xf1b7dc+'\x20':_0x2981ca+=_0x4e110a(0x24c)+_0x3bcb09+'\x20'+_0xf1b7dc+'\x20';}}}else _0x2981ca+=_0x4e110a(0x241);_0x2981ca+=_0x4e110a(0x1f5),_0x5b10ea['push'](_0x5b89d7),_0x5b10ea[_0x4e110a(0x1fc)](_0x3eff4d),_0x53eaf3=dbMusicFavorite[_0x4e110a(0x284)](_0x4e2f49['app'][_0x4e110a(0x212)],_0x4e2f49[_0x4e110a(0x1f4)]['id'],_0x2981ca,'*',_0x5b10ea);}}for(let _0x3824d6 of _0x53eaf3){_0x3824d6[_0x4e110a(0x237)]=dbMusicFavorite['musicIsFavorite'](_0x4e2f49[_0x4e110a(0x252)][_0x4e110a(0x212)],_0x3824d6['id'],_0x4e2f49[_0x4e110a(0x1f4)]['id'])?'1':'0';if(!_0x3824d6[_0x4e110a(0x293)]){let _0x1587f7=!![];_0x3824d6['file_cover_path']&&fs['existsSync'](_0x3824d6[_0x4e110a(0x234)])&&(_0x1587f7=![]),_0x1587f7&&(_0x3824d6[_0x4e110a(0x234)]=musicUitls[_0x4e110a(0x25f)](_0x4e2f49['app'][_0x4e110a(0x212)],_0x3824d6));}_0x3824d6['filePath']=path['join'](_0x3824d6[_0x4e110a(0x1de)],_0x3824d6['filename']),delete _0x3824d6[_0x4e110a(0x1de)];}return _0x53eaf3;}router[_0x40b1c0(0x217)](_0x40b1c0(0x20d),(_0x1d5c96,_0x538df1,_0x4da4e5)=>{const _0x54a5b1=_0x40b1c0;let _0x1bc6d1=_0x1d5c96['app']['dbFileIndex'],_0x25e7db=_0x1d5c96[_0x54a5b1(0x269)][_0x54a5b1(0x20a)]?_0x1d5c96[_0x54a5b1(0x269)][_0x54a5b1(0x20a)]:0xc,_0x27eeb7=_0x1d5c96[_0x54a5b1(0x269)][_0x54a5b1(0x1e1)]?_0x1d5c96[_0x54a5b1(0x269)][_0x54a5b1(0x1e1)]:0xc,_0x109f1a=dbUserTable[_0x54a5b1(0x219)](_0x1d5c96,_0x54a5b1(0x280),_0x54a5b1(0x294),!![]);if(_0x1d5c96[_0x54a5b1(0x1f4)]['is_admin']!=0x1&&!_0x109f1a)return _0x538df1['json']({'code':0x0,'data':null});let _0x2fe4e0=getMusicListByParams(_0x1d5c96,_0x538df1,_0x109f1a,_0x54a5b1(0x283),_0x25e7db,0x0,_0x54a5b1(0x1ea),_0x54a5b1(0x1fb)),_0x5e4e2e=getMusicListByParams(_0x1d5c96,_0x538df1,_0x109f1a,_0x54a5b1(0x283),_0x25e7db,0x0,_0x54a5b1(0x220),_0x54a5b1(0x1e6)),_0x69c9ed=getMusicListByParams(_0x1d5c96,_0x538df1,_0x109f1a,_0x54a5b1(0x283),_0x25e7db,0x0,'id',_0x54a5b1(0x1fb)),_0x46f1f6=dbMusicIndexTable['getGroupList'](_0x1bc6d1,_0x109f1a,_0x54a5b1(0x24e),_0x27eeb7,0x0,_0x54a5b1(0x1ea),_0x54a5b1(0x1fb));for(let _0x7a5f38 of _0x46f1f6){_0x7a5f38[_0x54a5b1(0x224)]=dbMusicIndexTable[_0x54a5b1(0x1e8)](_0x1bc6d1,'artist',_0x7a5f38[_0x54a5b1(0x24e)],0x1,_0x109f1a);}let _0x14f912=dbMusicIndexTable[_0x54a5b1(0x25e)](_0x1bc6d1,_0x109f1a,_0x54a5b1(0x272),_0x27eeb7,0x0,'play_count',_0x54a5b1(0x1fb));for(let _0x5dd768 of _0x14f912){_0x5dd768[_0x54a5b1(0x224)]=dbMusicIndexTable['getCoverByField'](_0x1bc6d1,_0x54a5b1(0x272),_0x5dd768[_0x54a5b1(0x272)],0x1,_0x109f1a);}let _0x1bec5f={};return _0x2fe4e0&&_0x2fe4e0[_0x54a5b1(0x205)]>0x0&&(_0x1bec5f[_0x54a5b1(0x1eb)]=_0x2fe4e0),_0x5e4e2e&&_0x5e4e2e['length']>0x0&&(_0x1bec5f[_0x54a5b1(0x21f)]=_0x5e4e2e),_0x69c9ed&&_0x69c9ed[_0x54a5b1(0x205)]>0x0&&(_0x1bec5f[_0x54a5b1(0x28b)]=_0x69c9ed),_0x46f1f6&&_0x46f1f6['length']>0x0&&(_0x1bec5f['artistList']=_0x46f1f6),_0x14f912&&_0x14f912[_0x54a5b1(0x205)]>0x0&&(_0x1bec5f[_0x54a5b1(0x203)]=_0x14f912),_0x538df1[_0x54a5b1(0x214)]({'code':0x0,'data':_0x1bec5f,'platform':os['platform']()});}),router[_0x40b1c0(0x217)](_0x40b1c0(0x286),(_0x7633f7,_0x557c0c,_0xfbbcb9)=>{const _0x5b5eaa=_0x40b1c0;let _0x48cfe9=_0x7633f7[_0x5b5eaa(0x269)][_0x5b5eaa(0x20a)]||0x32,_0x1a262b=_0x7633f7[_0x5b5eaa(0x269)][_0x5b5eaa(0x239)]||0x0,_0x52e237=_0x7633f7[_0x5b5eaa(0x269)]['album'],_0xbebe54=_0x7633f7[_0x5b5eaa(0x269)][_0x5b5eaa(0x209)],_0x583431=_0x7633f7[_0x5b5eaa(0x269)]['artist'],_0x497b97=_0x7633f7[_0x5b5eaa(0x269)][_0x5b5eaa(0x289)],_0x2215e2=_0x7633f7[_0x5b5eaa(0x269)][_0x5b5eaa(0x1ec)]||_0x5b5eaa(0x1ea),_0x166944=_0x7633f7[_0x5b5eaa(0x269)]['orderType']||_0x5b5eaa(0x1fb),_0x434121=[_0x5b5eaa(0x283),_0x5b5eaa(0x237),_0x5b5eaa(0x1e7)],_0x1e7f7c=_0x7633f7[_0x5b5eaa(0x269)]['listType']||_0x5b5eaa(0x283),_0x1264b1=_0x7633f7['body'][_0x5b5eaa(0x20c)],_0x534f0e=_0x7633f7[_0x5b5eaa(0x269)]['letterIndex'],_0x3c9295=_0x7633f7[_0x5b5eaa(0x269)][_0x5b5eaa(0x227)];if(dbMusicIndexTable[_0x5b5eaa(0x271)](_0x7633f7,_0x557c0c,_0x2215e2,_0x166944)!==!![])return;if(_0x1e7f7c==_0x5b5eaa(0x1e7)){if(!_0x3c9295)return _0x7633f7[_0x5b5eaa(0x252)][_0x5b5eaa(0x1e5)](_0x557c0c,'need\x20playlistId');}!_0x434121[_0x5b5eaa(0x233)](_0x1e7f7c)&&(_0x1e7f7c='list');_0x48cfe9>0x1f4&&(_0x48cfe9=0x1f4);let _0x5315cb=dbUserTable['getUserPathWhere'](_0x7633f7,'music',_0x5b5eaa(0x294),!![]);if(_0x7633f7[_0x5b5eaa(0x1f4)]['is_admin']!=0x1&&!_0x5315cb)return _0x557c0c['json']({'code':0x0,'data':null});let _0x212a51=getMusicListByParams(_0x7633f7,_0x557c0c,_0x5315cb,_0x1e7f7c,_0x48cfe9,_0x1a262b,_0x2215e2,_0x166944,_0x52e237,_0xbebe54,_0x583431,_0x497b97,_0x1264b1,_0x3c9295,_0x534f0e),_0x232783={'code':0x0,'data':_0x212a51};if(_0x1e7f7c==_0x5b5eaa(0x237))_0x232783[_0x5b5eaa(0x213)]=dbMusicFavorite[_0x5b5eaa(0x23b)](_0x7633f7[_0x5b5eaa(0x252)][_0x5b5eaa(0x212)],_0x7633f7[_0x5b5eaa(0x1f4)]['id']);else{if(_0x1e7f7c==_0x5b5eaa(0x283))_0x232783[_0x5b5eaa(0x213)]=dbMusicIndexTable['getMusicListCount'](_0x7633f7[_0x5b5eaa(0x252)]['dbFileIndex'],_0x5315cb,_0x52e237,_0xbebe54,_0x583431,_0x497b97);else _0x1e7f7c=='playlist'&&(_0x232783[_0x5b5eaa(0x213)]=dbMusicPlaylistTable['getPlaylistMusicCount'](_0x7633f7['app']['dbFileIndex'],_0x3c9295));}return _0x557c0c[_0x5b5eaa(0x214)](_0x232783);}),router['post']('/getMusicDetail',(_0x21322b,_0x51de45,_0x132322)=>{const _0x48a8a9=_0x40b1c0;let _0x263308=_0x21322b['body']['id'],_0x235f18=dbFileIndexTable[_0x48a8a9(0x211)](_0x21322b[_0x48a8a9(0x252)][_0x48a8a9(0x212)],_0x263308,dbFileIndexTable[_0x48a8a9(0x1f2)]);if(!_0x235f18)return _0x21322b[_0x48a8a9(0x252)][_0x48a8a9(0x1e5)](_0x51de45,'NO\x20MUSIC\x20INDEX');if(dbUserTable[_0x48a8a9(0x1f3)](_0x21322b,_0x51de45,_0x48a8a9(0x280),_0x48a8a9(0x294),_0x235f18[_0x48a8a9(0x1de)])==!![]){let _0xac02c=_0x21322b[_0x48a8a9(0x1f4)]['id'],_0x4b6675=dbMusicFavorite[_0x48a8a9(0x23f)](_0x21322b[_0x48a8a9(0x252)]['dbFileIndex'],_0xac02c,_0x263308);_0x235f18[_0x48a8a9(0x234)]=musicUitls[_0x48a8a9(0x25f)](_0x21322b['app']['dbFileIndex'],_0x235f18),_0x235f18[_0x48a8a9(0x237)]=_0x4b6675?0x1:0x0,getLyrics(_0x235f18,_0x53554d=>{return _0x235f18['lyricList']=_0x53554d,_0x51de45['json']({'code':0x0,'data':_0x235f18});});}});function updateIndexLyric(_0x4fe276,_0x19f05b,_0x191550,_0x2bd927){const _0x35d99d=_0x40b1c0;if(_0x191550&&_0x191550[_0x35d99d(0x205)]>0x0){let _0x2da58f=_0x2bd927['filename'][_0x35d99d(0x1f8)](path[_0x35d99d(0x236)](_0x2bd927[_0x35d99d(0x215)]),''),_0xaefa69=_0x2da58f+_0x35d99d(0x207),_0x1b7e90=path[_0x35d99d(0x253)](_0x2bd927['path'],_0xaefa69);fs[_0x35d99d(0x20e)](_0x1b7e90,_0x191550,_0x35d99d(0x273),_0x302b48=>{if(!_0x302b48){}});}let _0x14e3c0=JSON[_0x35d99d(0x26d)]({'lyrics':_0x191550?_0x191550:''});_0x4fe276[_0x35d99d(0x26c)](_0x35d99d(0x1e2))['run'](_0x19f05b,_0x14e3c0,_0x2bd927['id']);}function _0x4748(_0x775d9c,_0x4862d0){const _0x16e8da=_0x16e8();return _0x4748=function(_0x474862,_0x526468){_0x474862=_0x474862-0x1de;let _0x507fcd=_0x16e8da[_0x474862];return _0x507fcd;},_0x4748(_0x775d9c,_0x4862d0);}router[_0x40b1c0(0x217)](_0x40b1c0(0x230),(_0x5c0174,_0x57dd6f,_0x36b78f)=>{const _0x4d9085=_0x40b1c0;let _0x28456a=_0x5c0174[_0x4d9085(0x269)]['id'],_0xfb0b67=_0x5c0174[_0x4d9085(0x269)]['lyric'],_0x2ba08e=dbFileIndexTable[_0x4d9085(0x211)](_0x5c0174['app'][_0x4d9085(0x212)],_0x28456a,dbFileIndexTable[_0x4d9085(0x1f2)]);if(!_0x2ba08e)return _0x5c0174['app'][_0x4d9085(0x1e5)](_0x57dd6f,'NO\x20MUSIC\x20INDEX');if(!_0xfb0b67)return _0x5c0174[_0x4d9085(0x252)]['returnErrMsg'](_0x57dd6f,_0x4d9085(0x27f));if(dbUserTable[_0x4d9085(0x1f3)](_0x5c0174,_0x57dd6f,'music',_0x4d9085(0x228),_0x2ba08e['path'])==!![])return updateIndexLyric(_0x5c0174[_0x4d9085(0x252)]['dbFileIndex'],0x1,_0xfb0b67,_0x2ba08e),_0x57dd6f['json']({'code':0x0});}),router[_0x40b1c0(0x217)](_0x40b1c0(0x1ee),(_0x2e1cfc,_0x437e2a,_0x544929)=>{const _0x125c3a=_0x40b1c0;let _0x38c8aa=_0x2e1cfc[_0x125c3a(0x269)]['id'],_0x4cb785=dbFileIndexTable[_0x125c3a(0x211)](_0x2e1cfc[_0x125c3a(0x252)][_0x125c3a(0x212)],_0x38c8aa,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0x4cb785)return _0x2e1cfc[_0x125c3a(0x252)][_0x125c3a(0x1e5)](_0x437e2a,'NO\x20MUSIC\x20INDEX');let _0x138585=_0x2e1cfc[_0x125c3a(0x269)][_0x125c3a(0x1e0)],_0x2ed6cf=_0x2e1cfc[_0x125c3a(0x269)]['searchMusicArtist'],_0x7de67f=_0x2e1cfc[_0x125c3a(0x269)][_0x125c3a(0x221)],_0x54b3a7=_0x2e1cfc[_0x125c3a(0x269)][_0x125c3a(0x270)];if(dbUserTable[_0x125c3a(0x1f3)](_0x2e1cfc,_0x437e2a,_0x125c3a(0x280),_0x125c3a(0x294),_0x4cb785[_0x125c3a(0x1de)])==!![]){nasAccountUtil['getVipInfo'](_0x2e1cfc[_0x125c3a(0x252)][_0x125c3a(0x22c)])[_0x125c3a(0x296)](_0x3efd4a=>{const _0x404c24=_0x125c3a;if(_0x3efd4a)_0x1866b8();else return _0x54b3a7?_0x437e2a[_0x404c24(0x214)]({'code':0xbc}):_0x102264();})[_0x125c3a(0x210)](_0x191eed=>{return _0x102264();});function _0x102264(){return _0x437e2a['json']({'code':0x0,'data':[]});}function _0x1866b8(){const _0x50efb2=_0x125c3a;if(_0x4cb785[_0x50efb2(0x21d)]==0x1&&!_0x54b3a7)return _0x437e2a[_0x50efb2(0x214)]({'code':0x0,'data':[_0x4cb785[_0x50efb2(0x26a)]]});nasAccountUtil[_0x50efb2(0x235)](_0x2e1cfc[_0x50efb2(0x252)][_0x50efb2(0x22c)],!![])[_0x50efb2(0x296)](_0x288f44=>{const _0x17b7c2=_0x50efb2;if(!_0x288f44)return _0x437e2a[_0x17b7c2(0x214)]({'code':0x0,'data':[]});let _0x300754=_0x288f44[_0x17b7c2(0x23e)][_0x17b7c2(0x24b)][_0x288f44[_0x17b7c2(0x23e)][_0x17b7c2(0x24b)][_0x17b7c2(0x205)]-0x1],_0x2db485=_0x2e1cfc[_0x17b7c2(0x269)][_0x17b7c2(0x27e)]||0x0;if(!_0x138585||!_0x138585[_0x17b7c2(0x216)]())return _0x437e2a[_0x17b7c2(0x214)]([]);let _0xe04970={'searchMusicName':_0x138585,'searchMusicArtist':_0x2ed6cf,'searchMusicAlbum':_0x7de67f,'isSearch':_0x54b3a7,'skipCount':_0x2db485,'uniIdToken':_0x300754,'token':sha256(_0x138585+config[_0x17b7c2(0x275)])};axios[_0x17b7c2(0x217)](config[_0x17b7c2(0x24a)],_0xe04970)['then'](_0x4e13e6=>{const _0x4753d8=_0x17b7c2;if(_0x4e13e6[_0x4753d8(0x1f6)]){if(_0x4e13e6[_0x4753d8(0x1f6)]['length']>0x0&&!_0x54b3a7){let _0x57b13f=![],_0x5d7f0b=0x14,_0x8b8a16=0x64,_0x1e76b1=null;for(let _0x4c44da of _0x4e13e6[_0x4753d8(0x1f6)]){if(_0x4c44da[_0x4753d8(0x26f)]){let _0x887818=_0x4c44da[_0x4753d8(0x26f)]/0x3e8,_0x9cb3b4=Math[_0x4753d8(0x201)](_0x887818-_0x4cb785['duration']);_0x9cb3b4<_0x8b8a16&&(_0x8b8a16=_0x9cb3b4,_0x1e76b1=_0x4c44da['lrc']?_0x4c44da[_0x4753d8(0x1e4)]:'');}}return _0x8b8a16<_0x5d7f0b?(_0x57b13f=!![],_0x4cb785[_0x4753d8(0x26a)]=JSON[_0x4753d8(0x26d)]({'lyrics':_0x1e76b1?_0x1e76b1:''}),updateIndexLyric(_0x2e1cfc[_0x4753d8(0x252)][_0x4753d8(0x212)],0x1,_0x1e76b1,_0x4cb785)):updateIndexLyric(_0x2e1cfc[_0x4753d8(0x252)]['dbFileIndex'],0x1,'',_0x4cb785),_0x437e2a[_0x4753d8(0x214)]({'code':0x0,'data':_0x57b13f&&_0x4cb785[_0x4753d8(0x26a)]?[_0x4cb785[_0x4753d8(0x26a)]]:[]});}else return _0x437e2a['json']({'code':0x0,'data':_0x4e13e6[_0x4753d8(0x1f6)]});}})[_0x17b7c2(0x210)](_0x4164fc=>{const _0x332327=_0x17b7c2;return _0x2e1cfc[_0x332327(0x252)][_0x332327(0x1e5)](_0x437e2a,_0x4164fc[_0x332327(0x243)]);});});}}});function getLyrics(_0x4d73c9,_0x86476a){const _0xf6683c=_0x40b1c0;let _0x10bc16=[];try{_0x4d73c9[_0xf6683c(0x26a)]&&_0x4d73c9[_0xf6683c(0x26a)][_0xf6683c(0x205)]>0xa&&_0x10bc16[_0xf6683c(0x1fc)]({'type':_0xf6683c(0x292),'content':_0x4d73c9[_0xf6683c(0x26a)]});let _0x11c3d2=_0x4d73c9['filename'][_0xf6683c(0x1f8)](path[_0xf6683c(0x236)](_0x4d73c9[_0xf6683c(0x215)]),''),_0x14fba4=_0x11c3d2+_0xf6683c(0x207),_0x58d779=path[_0xf6683c(0x253)](_0x4d73c9[_0xf6683c(0x1de)],_0x14fba4);fs['existsSync'](_0x58d779)?fs['readFile'](_0x58d779,(_0x3e561b,_0x37bb1e)=>{const _0x1e3e41=_0xf6683c;let _0x560af7=musicUitls['transStringToUtf8'](_0x37bb1e['toString'](),_0x58d779);_0x10bc16[_0x1e3e41(0x1fc)]({'type':_0x1e3e41(0x295),'filename':_0x14fba4,'content':_0x560af7}),_0x86476a(_0x10bc16);}):_0x86476a(_0x10bc16);}catch(_0x25ba8a){console['log'](_0x25ba8a),_0x86476a(_0x10bc16);}}router['post'](_0x40b1c0(0x249),(_0x39c5d1,_0x22119a,_0x5e615d)=>{const _0x13d632=_0x40b1c0;let _0x5851f9=_0x39c5d1[_0x13d632(0x1f4)]['id'];function _0x2fd8b4(_0x22b793){const _0x1502d8=_0x13d632;let _0x90a3e=dbFileIndexTable['getById'](_0x39c5d1[_0x1502d8(0x252)][_0x1502d8(0x212)],_0x22b793,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0x90a3e)return;let _0x3e3609=new Date()[_0x1502d8(0x1df)]();_0x39c5d1[_0x1502d8(0x252)][_0x1502d8(0x212)][_0x1502d8(0x26c)](_0x1502d8(0x1e3))[_0x1502d8(0x20f)](_0x3e3609,_0x22b793),dbMusicFavorite[_0x1502d8(0x23c)](_0x39c5d1[_0x1502d8(0x252)][_0x1502d8(0x212)],_0x5851f9,_0x22b793);}if(_0x39c5d1[_0x13d632(0x269)][_0x13d632(0x278)]instanceof Array){let _0x4eaefc=_0x39c5d1[_0x13d632(0x269)][_0x13d632(0x27d)];if(_0x4eaefc==_0x13d632(0x238))for(let _0x5df834 of _0x39c5d1[_0x13d632(0x269)][_0x13d632(0x278)]){_0x2fd8b4(_0x5df834);}else{if(_0x4eaefc==_0x13d632(0x24d))for(let _0x2bad5f of _0x39c5d1[_0x13d632(0x269)][_0x13d632(0x278)]){dbMusicFavorite[_0x13d632(0x1fa)](_0x39c5d1[_0x13d632(0x252)][_0x13d632(0x212)],_0x5851f9,_0x2bad5f);}}return _0x22119a['json']({'code':0x0});}else{let _0xeed665=parseInt(_0x39c5d1[_0x13d632(0x269)][_0x13d632(0x278)]),_0x3fc7d4=dbMusicFavorite[_0x13d632(0x23f)](_0x39c5d1[_0x13d632(0x252)][_0x13d632(0x212)],_0x5851f9,_0xeed665),_0x44722d=0x0;return _0x3fc7d4?dbMusicFavorite[_0x13d632(0x1fa)](_0x39c5d1[_0x13d632(0x252)][_0x13d632(0x212)],_0x5851f9,_0xeed665):(_0x44722d=0x1,_0x2fd8b4(_0xeed665)),_0x22119a[_0x13d632(0x214)]({'code':0x0,'favorite':_0x44722d});}}),router[_0x40b1c0(0x281)](_0x40b1c0(0x265),(_0x1e1494,_0xba3dae,_0x358799)=>{const _0x4688ad=_0x40b1c0;let _0x4fef50=_0x1e1494['query'][_0x4688ad(0x240)],_0x54a041=dbMusicIndexTable[_0x4688ad(0x28e)](_0x1e1494['app'][_0x4688ad(0x212)],_0x4fef50),_0x3a39f2=_0x1e1494['query']['size'];!_0x3a39f2&&(_0x3a39f2=0x200);if(!_0x54a041||_0x54a041&&!_0x54a041['cover_path'])return _0xba3dae[_0x4688ad(0x277)](0x194)[_0x4688ad(0x254)]();if(dbUserTable[_0x4688ad(0x1f3)](_0x1e1494,_0xba3dae,'music',_0x4688ad(0x294),_0x54a041[_0x4688ad(0x1de)])==!![]){let _0x5a27de=path[_0x4688ad(0x253)](_0x54a041[_0x4688ad(0x1de)],_0x54a041['filename']),_0x587023=config['getMediaCoverCachePath'](_0x54a041,_0x3a39f2);if(fs[_0x4688ad(0x25b)](_0x587023))return _0xba3dae[_0x4688ad(0x1f9)](_0x587023);jsmediatags[_0x4688ad(0x244)](_0x5a27de,{'onSuccess':function(_0x114562){const _0x2fd95b=_0x4688ad;let _0x21aa51=_0x114562['tags'];var _0x2174da;_0x21aa51['picture']&&_0x21aa51[_0x2fd95b(0x20b)]['data']&&(_0x2174da=_0x21aa51[_0x2fd95b(0x20b)]['data']);!_0x2174da&&_0x21aa51[_0x2fd95b(0x267)]&&_0x21aa51[_0x2fd95b(0x267)][_0x2fd95b(0x1f6)]&&_0x21aa51[_0x2fd95b(0x267)][_0x2fd95b(0x1f6)][_0x2fd95b(0x1f6)]&&(_0x2174da=_0x21aa51['APIC']['data'][_0x2fd95b(0x1f6)]);if(_0x2174da){let _0x470041=path[_0x2fd95b(0x253)](path['dirname'](_0x587023),_0x2fd95b(0x222)+path[_0x2fd95b(0x200)](_0x587023));fs[_0x2fd95b(0x20e)](_0x470041,Buffer[_0x2fd95b(0x263)](_0x2174da),{'encoding':_0x2fd95b(0x21e)},function(_0xa473a9){const _0x18c4cd=_0x2fd95b;if(!_0xa473a9)sharpUtil[_0x18c4cd(0x1fd)](_0x470041,path[_0x18c4cd(0x28c)](_0x587023),path[_0x18c4cd(0x200)](_0x587023),'image',null,_0x5a1266=>{const _0x2ce784=_0x18c4cd;return dbMusicIndexTable[_0x2ce784(0x242)](_0x1e1494[_0x2ce784(0x252)][_0x2ce784(0x212)],_0x54a041['id'],_0x2ce784(0x293),_0x587023),fs['rm'](_0x470041,_0xc0a175=>{}),_0xba3dae[_0x2ce784(0x1f9)](_0x587023);},_0x15f393=>{const _0x277d59=_0x18c4cd;return _0xba3dae[_0x277d59(0x277)](0x194)[_0x277d59(0x254)]();},_0x3a39f2);else return _0xba3dae[_0x18c4cd(0x277)](0x194)['end']();});}else return _0xba3dae[_0x2fd95b(0x277)](0x194)[_0x2fd95b(0x254)]();},'onError':function(_0x15c83e){return _0xba3dae['status'](0x194)['end']();}});}}),router['post'](_0x40b1c0(0x223),(_0x52abee,_0x4c55c1,_0x25fa56)=>{const _0x19b07d=_0x40b1c0;let _0x3c5401=_0x52abee[_0x19b07d(0x269)][_0x19b07d(0x20a)]||0x32,_0x33b792=_0x52abee[_0x19b07d(0x269)][_0x19b07d(0x239)]||0x0,_0x16a0fc=_0x52abee[_0x19b07d(0x269)][_0x19b07d(0x22d)]||_0x19b07d(0x272),_0x71801c=_0x52abee[_0x19b07d(0x269)][_0x19b07d(0x1ec)]||'check_time',_0xb761ae=_0x52abee['body'][_0x19b07d(0x248)]||'desc',_0x500d00=_0x52abee['body'][_0x19b07d(0x20c)],_0x245b57=_0x52abee[_0x19b07d(0x269)][_0x19b07d(0x25c)];if(dbMusicIndexTable[_0x19b07d(0x271)](_0x52abee,_0x4c55c1,_0x71801c,_0xb761ae)!==!![])return;let _0x115159=[_0x19b07d(0x232),'play_count',_0x19b07d(0x1ea),_0x19b07d(0x215),_0x19b07d(0x251),_0x19b07d(0x272),_0x19b07d(0x24e),'birthtime','id'],_0x50b34b=['asc','desc'];if(!_0x115159['includes'](_0x71801c)||!_0x50b34b[_0x19b07d(0x233)](_0xb761ae))return _0x52abee[_0x19b07d(0x252)][_0x19b07d(0x1e5)](_0x4c55c1,_0x19b07d(0x24f),_0x71801c,_0xb761ae);let _0xedf4f5=dbUserTable[_0x19b07d(0x219)](_0x52abee,_0x19b07d(0x280),_0x19b07d(0x294),!![]);if(_0x52abee[_0x19b07d(0x1f4)][_0x19b07d(0x28a)]!=0x1&&!_0xedf4f5&&_0x16a0fc!='playlist')return _0x4c55c1[_0x19b07d(0x214)]({'code':0x0,'data':null});let _0x1218a0=[];if(_0x16a0fc==_0x19b07d(0x272)||_0x16a0fc=='artist'){_0x1218a0=dbMusicIndexTable[_0x19b07d(0x25e)](_0x52abee['app'][_0x19b07d(0x212)],_0xedf4f5,_0x16a0fc,_0x3c5401,_0x33b792,_0x71801c,_0xb761ae,_0x500d00,_0x245b57);for(let _0x363275 of _0x1218a0){_0x363275[_0x19b07d(0x224)]=dbMusicIndexTable[_0x19b07d(0x1e8)](_0x52abee[_0x19b07d(0x252)][_0x19b07d(0x212)],_0x16a0fc,_0x363275[_0x16a0fc],0x1,_0xedf4f5);}}else{if(_0x16a0fc=='playlist'){_0x1218a0=dbMusicPlaylistTable['getPlaylistList'](_0x52abee[_0x19b07d(0x252)][_0x19b07d(0x212)],_0x52abee[_0x19b07d(0x1f4)]['id'],_0x3c5401,_0x33b792,'id',_0x19b07d(0x1fb),_0x500d00);for(let _0x254523 of _0x1218a0){_0x254523[_0x19b07d(0x224)]=dbMusicIndexTable[_0x19b07d(0x245)](_0x52abee[_0x19b07d(0x252)]['dbFileIndex'],_0x254523['id']);}}}return _0x4c55c1['json']({'code':0x0,'data':_0x1218a0});}),router[_0x40b1c0(0x217)](_0x40b1c0(0x279),(_0x358bbf,_0x56a11b,_0x5e7f30)=>{const _0x522472=_0x40b1c0;let _0x52e30b=_0x358bbf[_0x522472(0x269)]['name'],_0x45a506=_0x358bbf[_0x522472(0x269)][_0x522472(0x27d)];if(_0x45a506==_0x522472(0x238)){if(!_0x52e30b)return _0x358bbf[_0x522472(0x252)][_0x522472(0x1e5)](_0x56a11b,_0x522472(0x23d));dbMusicPlaylistTable[_0x522472(0x258)](_0x358bbf[_0x522472(0x252)][_0x522472(0x212)],_0x358bbf['currentUser']['id'],_0x52e30b);}else{if(_0x45a506==_0x522472(0x22b)||_0x45a506==_0x522472(0x24d)){let _0x54d977=_0x358bbf[_0x522472(0x269)][_0x522472(0x227)],_0x155cd9=dbMusicPlaylistTable[_0x522472(0x266)](_0x358bbf[_0x522472(0x252)][_0x522472(0x212)],_0x54d977),_0x5b7c3b=![];(_0x358bbf['currentUser']['is_admin']==0x1||_0x155cd9[_0x522472(0x218)]==_0x358bbf[_0x522472(0x1f4)]['id'])&&(_0x5b7c3b=!![]);if(!_0x5b7c3b)return _0x56a11b['json']({'code':0x66});if(_0x45a506==_0x522472(0x24d))dbMusicPlaylistTable[_0x522472(0x255)](_0x358bbf[_0x522472(0x252)][_0x522472(0x212)],_0x54d977);else{if(_0x45a506==_0x522472(0x22b)){if(!_0x52e30b)return _0x358bbf[_0x522472(0x252)][_0x522472(0x1e5)](_0x56a11b,'need\x20\x27name\x27');dbMusicPlaylistTable[_0x522472(0x1f0)](_0x358bbf[_0x522472(0x252)][_0x522472(0x212)],_0x54d977,_0x52e30b);}}}else return _0x358bbf[_0x522472(0x252)][_0x522472(0x1e5)](_0x56a11b,'operation\x20error');}return _0x56a11b['json']({'code':0x0});}),router[_0x40b1c0(0x217)](_0x40b1c0(0x22a),(_0xa4588f,_0x16ad4d,_0x57bdff)=>{const _0x42913a=_0x40b1c0;let _0x302393=_0xa4588f['body'][_0x42913a(0x278)],_0x2cbaa9=_0xa4588f[_0x42913a(0x269)][_0x42913a(0x227)];if(!_0x302393||!_0x2cbaa9)return _0xa4588f['app'][_0x42913a(0x1e5)](_0x16ad4d,_0x42913a(0x264));let _0x59dbd7=dbMusicPlaylistTable[_0x42913a(0x266)](_0xa4588f['app'][_0x42913a(0x212)],_0x2cbaa9);if(!_0x59dbd7)return _0xa4588f[_0x42913a(0x252)][_0x42913a(0x1e5)](_0x16ad4d,_0x42913a(0x256));let _0x300a25=_0xa4588f['body'][_0x42913a(0x27d)];if(_0x300a25==_0x42913a(0x238)){function _0x36a401(_0x154945){const _0x558a84=_0x42913a;let _0x1e8aa9=dbMusicIndexTable[_0x558a84(0x28e)](_0xa4588f[_0x558a84(0x252)][_0x558a84(0x212)],_0x154945);if(!_0x1e8aa9)return;if(_0x1e8aa9[_0x558a84(0x261)]==0x1){dbMusicPlaylistTable['addMusicToPlaylist'](_0xa4588f[_0x558a84(0x252)]['dbFileIndex'],_0x154945,_0x2cbaa9);let _0x1dd8dc=Date[_0x558a84(0x22e)]();_0xa4588f[_0x558a84(0x252)][_0x558a84(0x212)][_0x558a84(0x26c)](_0x558a84(0x1e3))[_0x558a84(0x20f)](_0x1dd8dc,_0x1e8aa9['id']);}else{let _0x4e9146=path[_0x558a84(0x253)](_0x1e8aa9[_0x558a84(0x1de)],_0x1e8aa9[_0x558a84(0x215)]),_0x3a84dd=_0xa4588f[_0x558a84(0x252)][_0x558a84(0x212)][_0x558a84(0x26c)](_0x558a84(0x206))['all'](_0x4e9146,_0x4e9146+path['sep']+'%');for(let _0x465091 of _0x3a84dd){dbMusicPlaylistTable[_0x558a84(0x1ff)](_0xa4588f[_0x558a84(0x252)][_0x558a84(0x212)],_0x465091['id'],_0x2cbaa9);}}}if(_0x302393 instanceof Array)for(let _0x507cf3 of _0x302393){_0x36a401(_0x507cf3);}else _0x36a401(_0x302393);}else{if(_0x300a25==_0x42913a(0x24d)){if(_0x302393 instanceof Array)for(let _0x5c362d of _0x302393){dbMusicPlaylistTable['removeMusicFromPlaylist'](_0xa4588f['app'][_0x42913a(0x212)],_0x5c362d,_0x2cbaa9);}else dbMusicPlaylistTable[_0x42913a(0x1ef)](_0xa4588f[_0x42913a(0x252)][_0x42913a(0x212)],_0x302393,_0x2cbaa9);}else return _0xa4588f[_0x42913a(0x252)][_0x42913a(0x1e5)](_0x16ad4d,_0x42913a(0x208));}return _0x16ad4d[_0x42913a(0x214)]({'code':0x0,'data':{}});}),router[_0x40b1c0(0x217)](_0x40b1c0(0x282),(_0xed1810,_0xb36218,_0x1670a8)=>{const _0x5bc013=_0x40b1c0;let _0x4b728c=_0xed1810[_0x5bc013(0x269)][_0x5bc013(0x25d)],_0x36458a=_0xed1810[_0x5bc013(0x269)]['searchStr'],_0x155d7b=_0x5bc013(0x280),_0x525398=_0xed1810['body'][_0x5bc013(0x1ec)]??_0x5bc013(0x215),_0x1efd41=_0xed1810[_0x5bc013(0x269)][_0x5bc013(0x248)]??_0x5bc013(0x250);if(dbMusicIndexTable[_0x5bc013(0x271)](_0xed1810,_0xb36218,_0x525398,_0x1efd41)!==!![])return;if(dbUserTable[_0x5bc013(0x1f3)](_0xed1810,_0xb36218,_0x155d7b,_0x5bc013(0x294))==!![]){let _0x5c4dc3=[];if(!_0x4b728c){let _0xccd660=[];_0xed1810['currentUser']['is_admin']==0x1?_0xccd660=dbSourceFolderTable[_0x5bc013(0x231)](_0xed1810[_0x5bc013(0x252)][_0x5bc013(0x22c)],_0x155d7b):_0xccd660=dbUserTable['getUserPower'](_0xed1810[_0x5bc013(0x252)][_0x5bc013(0x22c)],_0xed1810[_0x5bc013(0x1f4)][_0x5bc013(0x1fe)],_0x155d7b);if(_0xccd660)for(let _0x5d43bb=0x0;_0x5d43bb<_0xccd660[_0x5bc013(0x205)];_0x5d43bb++){_0x5c4dc3[_0x5bc013(0x1fc)]({'path':_0xccd660[_0x5d43bb]['path'],'is_file':0x0,'filename':path[_0x5bc013(0x200)](_0xccd660[_0x5d43bb]['path']),'root':!![]});}}else{let _0x3b9d0d=[];if(_0xed1810[_0x5bc013(0x1f4)]['is_admin']!=0x1){if(dbUserTable['doUserCanGet'](_0xed1810,_0xb36218,_0x155d7b,_0x5bc013(0x294),_0x4b728c)!==!![])return;}_0x4b728c=path[_0x5bc013(0x253)](_0x4b728c);let _0x438b9f=_0x5bc013(0x23a);_0x3b9d0d[_0x5bc013(0x1fc)](_0x4b728c),_0x438b9f+=_0x5bc013(0x246);if(_0x36458a){let _0x4a1ad4=_0x5bc013(0x268);_0x438b9f+=_0x4a1ad4,_0x3b9d0d['push']('%'+_0x36458a+'%'),_0x3b9d0d['push']('%'+_0x36458a+'%');}let _0x3a3024=_0x5bc013(0x21c);_0x438b9f+=_0x5bc013(0x27b)+_0x525398+'\x20'+_0x1efd41,_0x5c4dc3=_0xed1810[_0x5bc013(0x252)][_0x5bc013(0x212)][_0x5bc013(0x26c)]('SELECT\x20'+_0x3a3024+_0x5bc013(0x204)+_0x438b9f)[_0x5bc013(0x27c)](_0x3b9d0d);}for(let _0x368cc9 of _0x5c4dc3){_0x368cc9[_0x5bc013(0x237)]=dbMusicFavorite[_0x5bc013(0x26b)](_0xed1810[_0x5bc013(0x252)]['dbFileIndex'],_0x368cc9['id'],_0xed1810[_0x5bc013(0x1f4)]['id'])?'1':'0';}let _0x3d3299=path['sep'],_0x230c49={'code':0x0,'data':_0x5c4dc3,'sep':_0x3d3299};return _0xb36218[_0x5bc013(0x214)](_0x230c49);}}),module['exports']=router;