const _0x19f311=_0xbdb5;(function(_0x5d456d,_0x35854c){const _0x4d2d5c=_0xbdb5,_0x3dc38c=_0x5d456d();while(!![]){try{const _0x529781=-parseInt(_0x4d2d5c(0x232))/0x1*(parseInt(_0x4d2d5c(0x269))/0x2)+parseInt(_0x4d2d5c(0x285))/0x3+parseInt(_0x4d2d5c(0x278))/0x4+parseInt(_0x4d2d5c(0x1ec))/0x5+parseInt(_0x4d2d5c(0x250))/0x6*(parseInt(_0x4d2d5c(0x26e))/0x7)+-parseInt(_0x4d2d5c(0x1f4))/0x8*(parseInt(_0x4d2d5c(0x1e7))/0x9)+-parseInt(_0x4d2d5c(0x273))/0xa;if(_0x529781===_0x35854c)break;else _0x3dc38c['push'](_0x3dc38c['shift']());}catch(_0x5079de){_0x3dc38c['push'](_0x3dc38c['shift']());}}}(_0x1f48,0xa59b1));let express=require(_0x19f311(0x225)),router=express[_0x19f311(0x22d)](),config=require(_0x19f311(0x21e)),path=require(_0x19f311(0x287)),fs=require('fs'),dbMusicIndexTable=require(_0x19f311(0x276)),dbFileIndexTable=require(_0x19f311(0x279)),dbMusicPlaylistTable=require(_0x19f311(0x20a)),dbMusicFavorite=require(_0x19f311(0x240)),jsmediatags=require(_0x19f311(0x24b));const dbUserTable=require('../../db/dbUserTable');let musicUitls=require(_0x19f311(0x226)),sharpUtil=require('../utils/sharpUtils');const dbSourceFolderTable=require('../../db/dbSourceFolderTable');let nasAccountUtil=require(_0x19f311(0x26d)),axios=require(_0x19f311(0x289)),sha256=require(_0x19f311(0x275)),os=require('os');function _0xbdb5(_0x45c173,_0x2f729e){const _0x1f488e=_0x1f48();return _0xbdb5=function(_0xbdb5cd,_0x489384){_0xbdb5cd=_0xbdb5cd-0x1e4;let _0x40f5b0=_0x1f488e[_0xbdb5cd];return _0x40f5b0;},_0xbdb5(_0x45c173,_0x2f729e);}function _0x1f48(){const _0x5c862d=['lyrics_get_state','prepare','transStringToUtf8','../../db/dbMusicPlaylistTable','dbFileIndex','need\x20\x27name\x27','checkOrderParams','/operationPlaylistIndex','indexId','artistList','getFavorite','trim','searchStr','updatePlaylist','addMusicToPlaylist','replace','uid','orderType',',f.artist\x20','size','need\x20playlistId','sep','genre','../../myConfig/config','APIC','data','run','extname','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','\x20FROM\x20file_index_music\x20WHERE\x20','express','../../utils/musicUtil','isSearch','/musicFavorite','getVipInfo','inner','getUserInfo','existsSync','Router','length','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','search','cover_path','11405eiHyFI','body','temp.','albumCount','searchMusicName','operation','add','picture','searchMusicAlbum','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','stringify','duration','post','file_cover_path','../../db/dbMusicFavorite','app','json','push','lyric','skipCount','getGroupList','/getGroupList','getUserPathWhere','edit','\x20order\x20by\x20f.album_fl\x20','jsmediatags','apiTokenKey','title','music','/getMusicHomeData','201612DsWvhJ','toString','.lrc','favorite_time','filename','writeFile','returnErrMsg','playlistId\x20no\x20exists','lyrics','albumList','exports','platform','then','createPlaylist','getById','musicIsFavorite','/saveLyric','orderField/orderType\x20error','end','play_count\x20desc','utf-8','\x20order\x20by\x20f.','operation\x20error','asc','username','122HgzVcj','deleteFavorite','/getMusicDetail','all','../utils/nasAccountUtils','42IpqJUs','lyricList','play_count','\x20path=?\x20AND\x20','album','2124940aCuzLL','getCoverByField','sha256','../../db/dbMusicIndexTable','musicIndexId','5059268gbfQcl','../../db/dbFileIndexTable','lrc','dirname','delete','desc','NO\x20MUSIC\x20INDEX','offset','recentAddList','file','removeMusicFromPlaylist','birthtime','readFile','116328XPkIVL','status','path',',id\x20asc','axios','read','orderField','getFavoriteCount','is_admin','join','playlistId','getMusicIndex','/operationPlaylist','from','music_count','getMusicSameNameCover','playlist','coverList','\x20LIMIT\x20?\x20OFFSET\x20?\x20','dbOther','power_get','count','abs','is_file','getMusicListCount','getPlaylistMusicCount','message','ORDER\x20BY\x20','check_time','recentMusic','apiMusicInfoUrl','basename','searchMusicArtist','addFavorite','list','genTinyFile','9wgkOVE','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','tags','last_play_time','currentUser','6275500MCiqkJ','power_add','doUserCanGet','removePlaylist','base64','includes','getPlaylistCover','favorite','9390280ckeyzK','\x20is_file=1','\x20order\x20by\x20f.title_fl\x20','\x20(type=3\x20OR\x20is_file=0)','INDEX_TABLE_NAME_MUSIC',',f.title\x20','sendFile','\x20order\x20by\x20m.update_time\x20','Lyric\x20is\x20null','image','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre',',f.filename_fl\x20','get','getPlaylistById','userInfo','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','maxPlayMusic','letterIndex','artist'];_0x1f48=function(){return _0x5c862d;};return _0x1f48();}function getMusicListByParams(_0x588025,_0x55b594,_0x404d66,_0x1c8a81,_0x3c03f5,_0x1b57f1,_0x88d03d,_0x2df4ce,_0xaf512d,_0x2ed7fb,_0x3b2ae1,_0x568a30,_0x5242de,_0x155d73,_0x5dceb2){const _0x14cdbb=_0x19f311;let _0x1691ed=_0x588025['app'][_0x14cdbb(0x20b)],_0x36450b=[];if(_0x1c8a81=='list'||_0x1c8a81==_0x14cdbb(0x295))_0x36450b=dbMusicIndexTable['getMusicList'](_0x1691ed,_0x404d66,_0x3c03f5,_0x1b57f1,_0x88d03d,_0x2df4ce,_0xaf512d,_0x2ed7fb,_0x3b2ae1,_0x568a30,_0x155d73,_0x5242de,_0x5dceb2);else{if(_0x1c8a81==_0x14cdbb(0x1f3)){let _0x6bebca='',_0x232362=[];_0x6bebca+=_0x14cdbb(0x1f5);_0x5242de&&(_0x5242de=_0x5242de['replace']('\x27','')[_0x14cdbb(0x216)]('â€™',''),_0x6bebca+=_0x14cdbb(0x23b),_0x232362[_0x14cdbb(0x243)]('%'+_0x5242de+'%','%'+_0x5242de+'%','%'+_0x5242de+'%'));_0x5dceb2&&(_0x6bebca+=_0x14cdbb(0x223),_0x232362['push'](_0x5dceb2,_0x5dceb2));if(_0x88d03d&&_0x2df4ce){if(_0x88d03d==_0x14cdbb(0x206))_0x6bebca+='\x20order\x20by\x20f.artist_fl\x20'+_0x2df4ce+_0x14cdbb(0x219)+_0x2df4ce+'\x20';else{if(_0x88d03d==_0x14cdbb(0x272))_0x6bebca+=_0x14cdbb(0x24a)+_0x2df4ce+',f.album\x20'+_0x2df4ce+'\x20';else{if(_0x88d03d==_0x14cdbb(0x24d))_0x6bebca+=_0x14cdbb(0x1f6)+_0x2df4ce+_0x14cdbb(0x1f9)+_0x2df4ce+_0x14cdbb(0x1ff)+_0x2df4ce+'\x20';else _0x88d03d==_0x14cdbb(0x253)?_0x6bebca+=_0x14cdbb(0x1fb)+_0x2df4ce+'\x20':_0x6bebca+=_0x14cdbb(0x265)+_0x88d03d+'\x20'+_0x2df4ce+'\x20';}}}else _0x6bebca+='\x20order\x20by\x20m.update_time\x20DESC\x20';_0x6bebca+=_0x14cdbb(0x297),_0x232362[_0x14cdbb(0x243)](_0x3c03f5),_0x232362[_0x14cdbb(0x243)](_0x1b57f1),_0x36450b=dbMusicFavorite['getAllFavoriteByWhere'](_0x588025[_0x14cdbb(0x241)][_0x14cdbb(0x20b)],_0x588025['currentUser']['id'],_0x6bebca,'*',_0x232362);}}for(let _0x1387d0 of _0x36450b){_0x1387d0['favorite']=dbMusicFavorite[_0x14cdbb(0x25f)](_0x588025[_0x14cdbb(0x241)]['dbFileIndex'],_0x1387d0['id'],_0x588025[_0x14cdbb(0x1eb)]['id'])?'1':'0';if(!_0x1387d0['cover_path']){let _0x32d38a=!![];_0x1387d0['file_cover_path']&&fs[_0x14cdbb(0x22c)](_0x1387d0[_0x14cdbb(0x23f)])&&(_0x32d38a=![]),_0x32d38a&&(_0x1387d0[_0x14cdbb(0x23f)]=musicUitls[_0x14cdbb(0x294)](_0x588025[_0x14cdbb(0x241)][_0x14cdbb(0x20b)],_0x1387d0));}_0x1387d0['filePath']=path[_0x14cdbb(0x28e)](_0x1387d0[_0x14cdbb(0x287)],_0x1387d0[_0x14cdbb(0x254)]),delete _0x1387d0[_0x14cdbb(0x287)];}return _0x36450b;}router[_0x19f311(0x23e)](_0x19f311(0x24f),(_0xe3f2dc,_0x5741de,_0x46c9ec)=>{const _0x44252e=_0x19f311;let _0x19ef70=_0xe3f2dc[_0x44252e(0x241)][_0x44252e(0x20b)],_0x4e817e=_0xe3f2dc[_0x44252e(0x233)][_0x44252e(0x29a)]?_0xe3f2dc[_0x44252e(0x233)][_0x44252e(0x29a)]:0xc,_0x524ce9=_0xe3f2dc['body'][_0x44252e(0x235)]?_0xe3f2dc[_0x44252e(0x233)]['albumCount']:0xc,_0x4bbfa5=dbUserTable[_0x44252e(0x248)](_0xe3f2dc,_0x44252e(0x24e),_0x44252e(0x299),!![]);if(_0xe3f2dc[_0x44252e(0x1eb)][_0x44252e(0x28d)]!=0x1&&!_0x4bbfa5)return _0x5741de[_0x44252e(0x242)]({'code':0x0,'data':null});let _0x344bd7=getMusicListByParams(_0xe3f2dc,_0x5741de,_0x4bbfa5,_0x44252e(0x1e5),_0x4e817e,0x0,_0x44252e(0x1ea),_0x44252e(0x27d)),_0x2adb76=getMusicListByParams(_0xe3f2dc,_0x5741de,_0x4bbfa5,_0x44252e(0x1e5),_0x4e817e,0x0,_0x44252e(0x263),_0x44252e(0x288)),_0x4ceeaa=getMusicListByParams(_0xe3f2dc,_0x5741de,_0x4bbfa5,_0x44252e(0x1e5),_0x4e817e,0x0,'id',_0x44252e(0x27d)),_0x361712=dbMusicIndexTable[_0x44252e(0x246)](_0x19ef70,_0x4bbfa5,_0x44252e(0x206),_0x524ce9,0x0,_0x44252e(0x1ea),'desc');for(let _0x42ea42 of _0x361712){_0x42ea42[_0x44252e(0x296)]=dbMusicIndexTable[_0x44252e(0x274)](_0x19ef70,_0x44252e(0x206),_0x42ea42[_0x44252e(0x206)],0x1,_0x4bbfa5);}let _0x506988=dbMusicIndexTable[_0x44252e(0x246)](_0x19ef70,_0x4bbfa5,'album',_0x524ce9,0x0,'play_count',_0x44252e(0x27d));for(let _0x4a795d of _0x506988){_0x4a795d[_0x44252e(0x296)]=dbMusicIndexTable['getCoverByField'](_0x19ef70,_0x44252e(0x272),_0x4a795d[_0x44252e(0x272)],0x1,_0x4bbfa5);}let _0x48d1c3={};return _0x344bd7&&_0x344bd7['length']>0x0&&(_0x48d1c3[_0x44252e(0x2a2)]=_0x344bd7),_0x2adb76&&_0x2adb76['length']>0x0&&(_0x48d1c3[_0x44252e(0x204)]=_0x2adb76),_0x4ceeaa&&_0x4ceeaa['length']>0x0&&(_0x48d1c3[_0x44252e(0x280)]=_0x4ceeaa),_0x361712&&_0x361712['length']>0x0&&(_0x48d1c3[_0x44252e(0x210)]=_0x361712),_0x506988&&_0x506988[_0x44252e(0x22e)]>0x0&&(_0x48d1c3[_0x44252e(0x259)]=_0x506988),_0x5741de['json']({'code':0x0,'data':_0x48d1c3,'platform':os[_0x44252e(0x25b)]()});}),router['post']('/getMusicList',(_0x5584c9,_0x181a4f,_0x4d53cf)=>{const _0x195682=_0x19f311;let _0x2800f2=_0x5584c9[_0x195682(0x233)][_0x195682(0x29a)]||0x32,_0x18eef7=_0x5584c9['body'][_0x195682(0x27f)]||0x0,_0x44da6a=_0x5584c9[_0x195682(0x233)][_0x195682(0x272)],_0x11ebbc=_0x5584c9['body']['year'],_0x5b30a0=_0x5584c9[_0x195682(0x233)][_0x195682(0x206)],_0x39b557=_0x5584c9['body'][_0x195682(0x21d)],_0x1b49ac=_0x5584c9[_0x195682(0x233)][_0x195682(0x28b)]||_0x195682(0x1ea),_0x57d7a1=_0x5584c9['body'][_0x195682(0x218)]||_0x195682(0x27d),_0x1c9cd7=[_0x195682(0x1e5),_0x195682(0x1f3),'playlist'],_0x3e8caa=_0x5584c9[_0x195682(0x233)]['listType']||'list',_0x1bccef=_0x5584c9['body'][_0x195682(0x230)],_0x30beca=_0x5584c9[_0x195682(0x233)][_0x195682(0x205)],_0x377f2d=_0x5584c9[_0x195682(0x233)]['playlistId'];if(dbMusicIndexTable[_0x195682(0x20d)](_0x5584c9,_0x181a4f,_0x1b49ac,_0x57d7a1)!==!![])return;if(_0x3e8caa==_0x195682(0x295)){if(!_0x377f2d)return _0x5584c9[_0x195682(0x241)][_0x195682(0x256)](_0x181a4f,_0x195682(0x21b));}!_0x1c9cd7['includes'](_0x3e8caa)&&(_0x3e8caa=_0x195682(0x1e5));_0x2800f2>0x1f4&&(_0x2800f2=0x1f4);let _0x404a54=dbUserTable[_0x195682(0x248)](_0x5584c9,_0x195682(0x24e),_0x195682(0x299),!![]);if(_0x5584c9['currentUser'][_0x195682(0x28d)]!=0x1&&!_0x404a54)return _0x181a4f[_0x195682(0x242)]({'code':0x0,'data':null});let _0x1b8ff4=getMusicListByParams(_0x5584c9,_0x181a4f,_0x404a54,_0x3e8caa,_0x2800f2,_0x18eef7,_0x1b49ac,_0x57d7a1,_0x44da6a,_0x11ebbc,_0x5b30a0,_0x39b557,_0x1bccef,_0x377f2d,_0x30beca),_0x454ded={'code':0x0,'data':_0x1b8ff4};if(_0x3e8caa==_0x195682(0x1f3))_0x454ded['music_count']=dbMusicFavorite[_0x195682(0x28c)](_0x5584c9['app'][_0x195682(0x20b)],_0x5584c9['currentUser']['id']);else{if(_0x3e8caa==_0x195682(0x1e5))_0x454ded[_0x195682(0x293)]=dbMusicIndexTable[_0x195682(0x29d)](_0x5584c9[_0x195682(0x241)][_0x195682(0x20b)],_0x404a54,_0x44da6a,_0x11ebbc,_0x5b30a0,_0x39b557);else _0x3e8caa=='playlist'&&(_0x454ded[_0x195682(0x293)]=dbMusicPlaylistTable[_0x195682(0x29e)](_0x5584c9[_0x195682(0x241)][_0x195682(0x20b)],_0x377f2d));}return _0x181a4f[_0x195682(0x242)](_0x454ded);}),router['post'](_0x19f311(0x26b),(_0x4fee5c,_0x40893d,_0x332630)=>{const _0x2df444=_0x19f311;let _0x4bbae5=_0x4fee5c[_0x2df444(0x233)]['id'],_0x414a63=dbFileIndexTable['getById'](_0x4fee5c[_0x2df444(0x241)][_0x2df444(0x20b)],_0x4bbae5,dbFileIndexTable[_0x2df444(0x1f8)]);if(!_0x414a63)return _0x4fee5c[_0x2df444(0x241)]['returnErrMsg'](_0x40893d,_0x2df444(0x27e));if(dbUserTable[_0x2df444(0x1ee)](_0x4fee5c,_0x40893d,_0x2df444(0x24e),_0x2df444(0x299),_0x414a63[_0x2df444(0x287)])==!![]){let _0x21e8bb=_0x4fee5c[_0x2df444(0x1eb)]['id'],_0x741d7c=dbMusicFavorite[_0x2df444(0x211)](_0x4fee5c[_0x2df444(0x241)][_0x2df444(0x20b)],_0x21e8bb,_0x4bbae5);_0x414a63['file_cover_path']=musicUitls[_0x2df444(0x294)](_0x4fee5c['app'][_0x2df444(0x20b)],_0x414a63),_0x414a63[_0x2df444(0x1f3)]=_0x741d7c?0x1:0x0,getLyrics(_0x414a63,_0xdb61f8=>{const _0x4382a8=_0x2df444;return _0x414a63[_0x4382a8(0x26f)]=_0xdb61f8,_0x40893d[_0x4382a8(0x242)]({'code':0x0,'data':_0x414a63});});}});function updateIndexLyric(_0x43cb20,_0x181311,_0x11180a,_0x3a18fd){const _0x909953=_0x19f311;if(_0x11180a&&_0x11180a[_0x909953(0x22e)]>0x0){let _0x3edaa9=_0x3a18fd['filename'][_0x909953(0x216)](path[_0x909953(0x222)](_0x3a18fd['filename']),''),_0x4cc5bb=_0x3edaa9+_0x909953(0x252),_0x3f0c46=path['join'](_0x3a18fd['path'],_0x4cc5bb);fs[_0x909953(0x255)](_0x3f0c46,_0x11180a,_0x909953(0x264),_0x117251=>{if(!_0x117251){}});}let _0x164e1f=JSON[_0x909953(0x23c)]({'lyrics':_0x11180a?_0x11180a:''});_0x43cb20['prepare'](_0x909953(0x203))[_0x909953(0x221)](_0x181311,_0x164e1f,_0x3a18fd['id']);}router[_0x19f311(0x23e)](_0x19f311(0x260),(_0x5c372c,_0x3a8e49,_0x953f6c)=>{const _0x4e6ce4=_0x19f311;let _0x44c651=_0x5c372c[_0x4e6ce4(0x233)]['id'],_0x1ed2b3=_0x5c372c['body'][_0x4e6ce4(0x244)],_0xe0f5cb=dbFileIndexTable['getById'](_0x5c372c[_0x4e6ce4(0x241)]['dbFileIndex'],_0x44c651,dbFileIndexTable[_0x4e6ce4(0x1f8)]);if(!_0xe0f5cb)return _0x5c372c[_0x4e6ce4(0x241)][_0x4e6ce4(0x256)](_0x3a8e49,_0x4e6ce4(0x27e));if(!_0x1ed2b3)return _0x5c372c[_0x4e6ce4(0x241)][_0x4e6ce4(0x256)](_0x3a8e49,_0x4e6ce4(0x1fc));if(dbUserTable[_0x4e6ce4(0x1ee)](_0x5c372c,_0x3a8e49,_0x4e6ce4(0x24e),_0x4e6ce4(0x1ed),_0xe0f5cb[_0x4e6ce4(0x287)])==!![])return updateIndexLyric(_0x5c372c[_0x4e6ce4(0x241)][_0x4e6ce4(0x20b)],0x1,_0x1ed2b3,_0xe0f5cb),_0x3a8e49[_0x4e6ce4(0x242)]({'code':0x0});}),router[_0x19f311(0x23e)]('/searchLyric',(_0x1cfa4f,_0x5bfb8e,_0xdbf73a)=>{const _0xa27807=_0x19f311;let _0x1deb80=_0x1cfa4f[_0xa27807(0x233)]['id'],_0x78a946=dbFileIndexTable['getById'](_0x1cfa4f['app'][_0xa27807(0x20b)],_0x1deb80,dbFileIndexTable[_0xa27807(0x1f8)]);if(!_0x78a946)return _0x1cfa4f[_0xa27807(0x241)][_0xa27807(0x256)](_0x5bfb8e,_0xa27807(0x27e));let _0xdf0acf=_0x1cfa4f[_0xa27807(0x233)][_0xa27807(0x236)],_0x4d078c=_0x1cfa4f['body'][_0xa27807(0x2a5)],_0xf66951=_0x1cfa4f['body'][_0xa27807(0x23a)],_0x1adbe0=_0x1cfa4f['body'][_0xa27807(0x227)];if(dbUserTable['doUserCanGet'](_0x1cfa4f,_0x5bfb8e,_0xa27807(0x24e),_0xa27807(0x299),_0x78a946[_0xa27807(0x287)])==!![]){nasAccountUtil[_0xa27807(0x229)](_0x1cfa4f[_0xa27807(0x241)][_0xa27807(0x298)])[_0xa27807(0x25c)](_0x454592=>{const _0x3e9bf1=_0xa27807;if(_0x454592)_0x1ee84a();else return _0x1adbe0?_0x5bfb8e[_0x3e9bf1(0x242)]({'code':0xbc}):_0x22d49d();})['catch'](_0x4603af=>{return _0x22d49d();});function _0x22d49d(){const _0x324c2b=_0xa27807;return _0x5bfb8e[_0x324c2b(0x242)]({'code':0x0,'data':[]});}function _0x1ee84a(){const _0x24197f=_0xa27807;if(_0x78a946[_0x24197f(0x207)]==0x1&&!_0x1adbe0)return _0x5bfb8e['json']({'code':0x0,'data':[_0x78a946[_0x24197f(0x258)]]});nasAccountUtil[_0x24197f(0x22b)](_0x1cfa4f[_0x24197f(0x241)][_0x24197f(0x298)],!![])[_0x24197f(0x25c)](_0x468112=>{const _0x340871=_0x24197f;if(!_0x468112)return _0x5bfb8e[_0x340871(0x242)]({'code':0x0,'data':[]});let _0x5e5b3e=_0x468112['userInfo']['token'][_0x468112[_0x340871(0x202)]['token'][_0x340871(0x22e)]-0x1],_0x3b04f1=_0x1cfa4f[_0x340871(0x233)][_0x340871(0x245)]||0x0;if(!_0xdf0acf||!_0xdf0acf[_0x340871(0x212)]())return _0x5bfb8e['json']([]);let _0x4d76d7={'searchMusicName':_0xdf0acf,'searchMusicArtist':_0x4d078c,'searchMusicAlbum':_0xf66951,'isSearch':_0x1adbe0,'skipCount':_0x3b04f1,'uniIdToken':_0x5e5b3e,'token':sha256(_0xdf0acf+config[_0x340871(0x24c)])};axios['post'](config[_0x340871(0x2a3)],_0x4d76d7)['then'](_0x376b2c=>{const _0x51acaa=_0x340871;if(_0x376b2c[_0x51acaa(0x220)]){if(_0x376b2c['data'][_0x51acaa(0x22e)]>0x0&&!_0x1adbe0){let _0x556f4a=![],_0x2fd7f3=0x14,_0x54ecba=0x64,_0x5a864e=null;for(let _0x1af8aa of _0x376b2c[_0x51acaa(0x220)]){if(_0x1af8aa[_0x51acaa(0x23d)]){let _0x3967fb=_0x1af8aa[_0x51acaa(0x23d)]/0x3e8,_0x139500=Math[_0x51acaa(0x29b)](_0x3967fb-_0x78a946['duration']);_0x139500<_0x54ecba&&(_0x54ecba=_0x139500,_0x5a864e=_0x1af8aa[_0x51acaa(0x27a)]?_0x1af8aa[_0x51acaa(0x27a)]:'');}}return _0x54ecba<_0x2fd7f3?(_0x556f4a=!![],_0x78a946[_0x51acaa(0x258)]=JSON[_0x51acaa(0x23c)]({'lyrics':_0x5a864e?_0x5a864e:''}),updateIndexLyric(_0x1cfa4f[_0x51acaa(0x241)][_0x51acaa(0x20b)],0x1,_0x5a864e,_0x78a946)):updateIndexLyric(_0x1cfa4f[_0x51acaa(0x241)][_0x51acaa(0x20b)],0x1,'',_0x78a946),_0x5bfb8e[_0x51acaa(0x242)]({'code':0x0,'data':_0x556f4a&&_0x78a946[_0x51acaa(0x258)]?[_0x78a946[_0x51acaa(0x258)]]:[]});}else return _0x5bfb8e['json']({'code':0x0,'data':_0x376b2c[_0x51acaa(0x220)]});}})['catch'](_0x17f9c9=>{const _0xb91bf8=_0x340871;return _0x1cfa4f[_0xb91bf8(0x241)]['returnErrMsg'](_0x5bfb8e,_0x17f9c9[_0xb91bf8(0x29f)]);});});}}});function getLyrics(_0x324e7c,_0x2a9089){const _0x56f66a=_0x19f311;let _0x2a6330=[];try{_0x324e7c[_0x56f66a(0x258)]&&_0x324e7c[_0x56f66a(0x258)]['length']>0xa&&_0x2a6330[_0x56f66a(0x243)]({'type':_0x56f66a(0x22a),'content':_0x324e7c[_0x56f66a(0x258)]});let _0x174ea4=_0x324e7c['filename'][_0x56f66a(0x216)](path[_0x56f66a(0x222)](_0x324e7c[_0x56f66a(0x254)]),''),_0x511d54=_0x174ea4+_0x56f66a(0x252),_0x59e1a1=path['join'](_0x324e7c['path'],_0x511d54);fs[_0x56f66a(0x22c)](_0x59e1a1)?fs[_0x56f66a(0x284)](_0x59e1a1,(_0x5614a6,_0x165f39)=>{const _0x1a9ba7=_0x56f66a;let _0x21fe2c=musicUitls[_0x1a9ba7(0x209)](_0x165f39[_0x1a9ba7(0x251)](),_0x59e1a1);_0x2a6330[_0x1a9ba7(0x243)]({'type':_0x1a9ba7(0x281),'filename':_0x511d54,'content':_0x21fe2c}),_0x2a9089(_0x2a6330);}):_0x2a9089(_0x2a6330);}catch(_0x1d4d9f){console['log'](_0x1d4d9f),_0x2a9089(_0x2a6330);}}router[_0x19f311(0x23e)](_0x19f311(0x228),(_0x191ffb,_0x34d9c3,_0x62839)=>{const _0x12617f=_0x19f311;let _0x7c5ebb=_0x191ffb[_0x12617f(0x1eb)]['id'];function _0x4758d2(_0x45e1d4){const _0x19a5f3=_0x12617f;let _0x5c9abe=dbFileIndexTable[_0x19a5f3(0x25e)](_0x191ffb['app'][_0x19a5f3(0x20b)],_0x45e1d4,dbFileIndexTable[_0x19a5f3(0x1f8)]);if(!_0x5c9abe)return;let _0x2d9ec3=new Date()['getTime']();_0x191ffb[_0x19a5f3(0x241)][_0x19a5f3(0x20b)][_0x19a5f3(0x208)](_0x19a5f3(0x1e8))[_0x19a5f3(0x221)](_0x2d9ec3,_0x45e1d4),dbMusicFavorite[_0x19a5f3(0x1e4)](_0x191ffb[_0x19a5f3(0x241)][_0x19a5f3(0x20b)],_0x7c5ebb,_0x45e1d4);}if(_0x191ffb[_0x12617f(0x233)][_0x12617f(0x277)]instanceof Array){let _0x5e4e34=_0x191ffb[_0x12617f(0x233)]['operation'];if(_0x5e4e34==_0x12617f(0x238))for(let _0x8fc33f of _0x191ffb[_0x12617f(0x233)][_0x12617f(0x277)]){_0x4758d2(_0x8fc33f);}else{if(_0x5e4e34=='delete')for(let _0x2ad1d7 of _0x191ffb['body']['musicIndexId']){dbMusicFavorite['deleteFavorite'](_0x191ffb['app'][_0x12617f(0x20b)],_0x7c5ebb,_0x2ad1d7);}}return _0x34d9c3['json']({'code':0x0});}else{let _0x20f966=parseInt(_0x191ffb[_0x12617f(0x233)]['musicIndexId']),_0x4158c8=dbMusicFavorite[_0x12617f(0x211)](_0x191ffb['app'][_0x12617f(0x20b)],_0x7c5ebb,_0x20f966),_0x427b4a=0x0;return _0x4158c8?dbMusicFavorite[_0x12617f(0x26a)](_0x191ffb[_0x12617f(0x241)][_0x12617f(0x20b)],_0x7c5ebb,_0x20f966):(_0x427b4a=0x1,_0x4758d2(_0x20f966)),_0x34d9c3['json']({'code':0x0,'favorite':_0x427b4a});}}),router[_0x19f311(0x200)]('/getMusicCover',(_0x2db8b4,_0xef7264,_0x2b62e6)=>{const _0x4cde68=_0x19f311;let _0x2281fc=_0x2db8b4['query'][_0x4cde68(0x20f)],_0x3ef314=dbMusicIndexTable[_0x4cde68(0x290)](_0x2db8b4['app'][_0x4cde68(0x20b)],_0x2281fc),_0x48ed00=_0x2db8b4['query'][_0x4cde68(0x21a)];!_0x48ed00&&(_0x48ed00=0x200);if(!_0x3ef314||_0x3ef314&&!_0x3ef314['cover_path'])return _0xef7264[_0x4cde68(0x286)](0x194)['end']();if(dbUserTable[_0x4cde68(0x1ee)](_0x2db8b4,_0xef7264,_0x4cde68(0x24e),_0x4cde68(0x299),_0x3ef314[_0x4cde68(0x287)])==!![]){let _0x2fb814=path[_0x4cde68(0x28e)](_0x3ef314['path'],_0x3ef314['filename']),_0x443f90=config['getMediaCoverCachePath'](_0x3ef314,_0x48ed00);if(fs[_0x4cde68(0x22c)](_0x443f90))return _0xef7264[_0x4cde68(0x1fa)](_0x443f90);jsmediatags[_0x4cde68(0x28a)](_0x2fb814,{'onSuccess':function(_0x11aa8a){const _0x15f9c2=_0x4cde68;let _0x36e582=_0x11aa8a[_0x15f9c2(0x1e9)];var _0x120e26;_0x36e582[_0x15f9c2(0x239)]&&_0x36e582[_0x15f9c2(0x239)]['data']&&(_0x120e26=_0x36e582[_0x15f9c2(0x239)][_0x15f9c2(0x220)]);!_0x120e26&&_0x36e582[_0x15f9c2(0x21f)]&&_0x36e582[_0x15f9c2(0x21f)][_0x15f9c2(0x220)]&&_0x36e582['APIC'][_0x15f9c2(0x220)]['data']&&(_0x120e26=_0x36e582[_0x15f9c2(0x21f)]['data'][_0x15f9c2(0x220)]);if(_0x120e26){let _0x1149a2=path['join'](path['dirname'](_0x443f90),_0x15f9c2(0x234)+path[_0x15f9c2(0x2a4)](_0x443f90));fs[_0x15f9c2(0x255)](_0x1149a2,Buffer[_0x15f9c2(0x292)](_0x120e26),{'encoding':_0x15f9c2(0x1f0)},function(_0x131755){const _0x4d6d0a=_0x15f9c2;if(!_0x131755)sharpUtil[_0x4d6d0a(0x1e6)](_0x1149a2,path[_0x4d6d0a(0x27b)](_0x443f90),path[_0x4d6d0a(0x2a4)](_0x443f90),_0x4d6d0a(0x1fd),null,_0x18decb=>{const _0x536264=_0x4d6d0a;return dbMusicIndexTable['updateByFiled'](_0x2db8b4[_0x536264(0x241)][_0x536264(0x20b)],_0x3ef314['id'],_0x536264(0x231),_0x443f90),fs['rm'](_0x1149a2,_0x32f340=>{}),_0xef7264[_0x536264(0x1fa)](_0x443f90);},_0x50d65d=>{const _0x4f665a=_0x4d6d0a;return _0xef7264['status'](0x194)[_0x4f665a(0x262)]();},_0x48ed00);else return _0xef7264[_0x4d6d0a(0x286)](0x194)[_0x4d6d0a(0x262)]();});}else return _0xef7264[_0x15f9c2(0x286)](0x194)[_0x15f9c2(0x262)]();},'onError':function(_0x52fb16){const _0x5734e4=_0x4cde68;return _0xef7264[_0x5734e4(0x286)](0x194)[_0x5734e4(0x262)]();}});}}),router[_0x19f311(0x23e)](_0x19f311(0x247),(_0x2f758c,_0x2a70e4,_0x281ea5)=>{const _0x41fd0c=_0x19f311;let _0x45d9b0=_0x2f758c[_0x41fd0c(0x233)]['count']||0x32,_0x30c375=_0x2f758c[_0x41fd0c(0x233)]['offset']||0x0,_0x501c6b=_0x2f758c[_0x41fd0c(0x233)]['groupField']||'album',_0x4ff845=_0x2f758c['body'][_0x41fd0c(0x28b)]||_0x41fd0c(0x2a1),_0x3aad2a=_0x2f758c['body'][_0x41fd0c(0x218)]||_0x41fd0c(0x27d),_0x4e630e=_0x2f758c[_0x41fd0c(0x233)]['search'],_0xb491ae=_0x2f758c[_0x41fd0c(0x233)]['letterIndex'];if(dbMusicIndexTable['checkOrderParams'](_0x2f758c,_0x2a70e4,_0x4ff845,_0x3aad2a)!==!![])return;let _0x53c439=['check_time',_0x41fd0c(0x270),_0x41fd0c(0x1ea),_0x41fd0c(0x254),_0x41fd0c(0x24d),_0x41fd0c(0x272),_0x41fd0c(0x206),_0x41fd0c(0x283),'id'],_0x50f137=[_0x41fd0c(0x267),_0x41fd0c(0x27d)];if(!_0x53c439[_0x41fd0c(0x1f1)](_0x4ff845)||!_0x50f137[_0x41fd0c(0x1f1)](_0x3aad2a))return _0x2f758c[_0x41fd0c(0x241)][_0x41fd0c(0x256)](_0x2a70e4,_0x41fd0c(0x261),_0x4ff845,_0x3aad2a);let _0x2fd00b=dbUserTable[_0x41fd0c(0x248)](_0x2f758c,_0x41fd0c(0x24e),'power_get',!![]);if(_0x2f758c[_0x41fd0c(0x1eb)][_0x41fd0c(0x28d)]!=0x1&&!_0x2fd00b&&_0x501c6b!=_0x41fd0c(0x295))return _0x2a70e4[_0x41fd0c(0x242)]({'code':0x0,'data':null});let _0x215c73=[];if(_0x501c6b==_0x41fd0c(0x272)||_0x501c6b==_0x41fd0c(0x206)){_0x215c73=dbMusicIndexTable[_0x41fd0c(0x246)](_0x2f758c[_0x41fd0c(0x241)][_0x41fd0c(0x20b)],_0x2fd00b,_0x501c6b,_0x45d9b0,_0x30c375,_0x4ff845,_0x3aad2a,_0x4e630e,_0xb491ae);for(let _0x128844 of _0x215c73){_0x128844['coverList']=dbMusicIndexTable[_0x41fd0c(0x274)](_0x2f758c[_0x41fd0c(0x241)][_0x41fd0c(0x20b)],_0x501c6b,_0x128844[_0x501c6b],0x1,_0x2fd00b);}}else{if(_0x501c6b==_0x41fd0c(0x295)){_0x215c73=dbMusicPlaylistTable['getPlaylistList'](_0x2f758c[_0x41fd0c(0x241)][_0x41fd0c(0x20b)],_0x2f758c[_0x41fd0c(0x1eb)]['id'],_0x45d9b0,_0x30c375,'id',_0x41fd0c(0x27d),_0x4e630e);for(let _0xfc0222 of _0x215c73){_0xfc0222[_0x41fd0c(0x296)]=dbMusicIndexTable[_0x41fd0c(0x1f2)](_0x2f758c[_0x41fd0c(0x241)][_0x41fd0c(0x20b)],_0xfc0222['id']);}}}return _0x2a70e4[_0x41fd0c(0x242)]({'code':0x0,'data':_0x215c73});}),router['post'](_0x19f311(0x291),(_0x4b34b8,_0x39e03c,_0x117175)=>{const _0x37beab=_0x19f311;let _0x5d6475=_0x4b34b8[_0x37beab(0x233)]['name'],_0x49a4e1=_0x4b34b8[_0x37beab(0x233)][_0x37beab(0x237)];if(_0x49a4e1==_0x37beab(0x238)){if(!_0x5d6475)return _0x4b34b8[_0x37beab(0x241)][_0x37beab(0x256)](_0x39e03c,_0x37beab(0x20c));dbMusicPlaylistTable[_0x37beab(0x25d)](_0x4b34b8['app'][_0x37beab(0x20b)],_0x4b34b8['currentUser']['id'],_0x5d6475);}else{if(_0x49a4e1==_0x37beab(0x249)||_0x49a4e1==_0x37beab(0x27c)){let _0x5877cc=_0x4b34b8[_0x37beab(0x233)][_0x37beab(0x28f)],_0x450363=dbMusicPlaylistTable['getPlaylistById'](_0x4b34b8[_0x37beab(0x241)][_0x37beab(0x20b)],_0x5877cc),_0x8b1b20=![];(_0x4b34b8[_0x37beab(0x1eb)]['is_admin']==0x1||_0x450363[_0x37beab(0x217)]==_0x4b34b8[_0x37beab(0x1eb)]['id'])&&(_0x8b1b20=!![]);if(!_0x8b1b20)return _0x39e03c[_0x37beab(0x242)]({'code':0x66});if(_0x49a4e1==_0x37beab(0x27c))dbMusicPlaylistTable[_0x37beab(0x1ef)](_0x4b34b8[_0x37beab(0x241)][_0x37beab(0x20b)],_0x5877cc);else{if(_0x49a4e1==_0x37beab(0x249)){if(!_0x5d6475)return _0x4b34b8[_0x37beab(0x241)][_0x37beab(0x256)](_0x39e03c,_0x37beab(0x20c));dbMusicPlaylistTable[_0x37beab(0x214)](_0x4b34b8['app']['dbFileIndex'],_0x5877cc,_0x5d6475);}}}else return _0x4b34b8['app']['returnErrMsg'](_0x39e03c,_0x37beab(0x266));}return _0x39e03c[_0x37beab(0x242)]({'code':0x0});}),router['post'](_0x19f311(0x20e),(_0x7674a0,_0x4b8075,_0x3874c2)=>{const _0x4786a4=_0x19f311;let _0x31855b=_0x7674a0[_0x4786a4(0x233)]['musicIndexId'],_0x249537=_0x7674a0[_0x4786a4(0x233)][_0x4786a4(0x28f)];if(!_0x31855b||!_0x249537)return _0x7674a0[_0x4786a4(0x241)]['returnErrMsg'](_0x4b8075,'need\x20musicIndexId\x20and\x20playlistId');let _0x27e9b2=dbMusicPlaylistTable[_0x4786a4(0x201)](_0x7674a0[_0x4786a4(0x241)][_0x4786a4(0x20b)],_0x249537);if(!_0x27e9b2)return _0x7674a0[_0x4786a4(0x241)]['returnErrMsg'](_0x4b8075,_0x4786a4(0x257));let _0x4b0175=_0x7674a0[_0x4786a4(0x233)][_0x4786a4(0x237)];if(_0x4b0175==_0x4786a4(0x238)){function _0x3ba12b(_0x12496b){const _0x1cffbc=_0x4786a4;let _0x19b81c=dbMusicIndexTable['getMusicIndex'](_0x7674a0[_0x1cffbc(0x241)][_0x1cffbc(0x20b)],_0x12496b);if(!_0x19b81c)return;if(_0x19b81c[_0x1cffbc(0x29c)]==0x1){dbMusicPlaylistTable[_0x1cffbc(0x215)](_0x7674a0['app']['dbFileIndex'],_0x12496b,_0x249537);let _0x166ba3=Date['now']();_0x7674a0[_0x1cffbc(0x241)][_0x1cffbc(0x20b)][_0x1cffbc(0x208)](_0x1cffbc(0x1e8))[_0x1cffbc(0x221)](_0x166ba3,_0x19b81c['id']);}else{let _0x15cac0=path['join'](_0x19b81c[_0x1cffbc(0x287)],_0x19b81c[_0x1cffbc(0x254)]),_0x486360=_0x7674a0[_0x1cffbc(0x241)][_0x1cffbc(0x20b)][_0x1cffbc(0x208)]('SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?')[_0x1cffbc(0x26c)](_0x15cac0,_0x15cac0+path['sep']+'%');for(let _0x893f02 of _0x486360){dbMusicPlaylistTable[_0x1cffbc(0x215)](_0x7674a0['app']['dbFileIndex'],_0x893f02['id'],_0x249537);}}}if(_0x31855b instanceof Array)for(let _0x355f38 of _0x31855b){_0x3ba12b(_0x355f38);}else _0x3ba12b(_0x31855b);}else{if(_0x4b0175==_0x4786a4(0x27c)){if(_0x31855b instanceof Array)for(let _0x226d61 of _0x31855b){dbMusicPlaylistTable[_0x4786a4(0x282)](_0x7674a0['app'][_0x4786a4(0x20b)],_0x226d61,_0x249537);}else dbMusicPlaylistTable[_0x4786a4(0x282)](_0x7674a0[_0x4786a4(0x241)][_0x4786a4(0x20b)],_0x31855b,_0x249537);}else return _0x7674a0[_0x4786a4(0x241)][_0x4786a4(0x256)](_0x4b8075,'operation\x20error');}return _0x4b8075[_0x4786a4(0x242)]({'code':0x0,'data':{}});}),router[_0x19f311(0x23e)]('/getMusicIndexFileTree',(_0x16a363,_0x41051d,_0x4b50ad)=>{const _0x74979c=_0x19f311;let _0x5a2918=_0x16a363[_0x74979c(0x233)]['parent'],_0x161e3a=_0x16a363[_0x74979c(0x233)][_0x74979c(0x213)],_0x25bae5='music',_0x3a681d=_0x16a363['body'][_0x74979c(0x28b)]??_0x74979c(0x254),_0x27bea9=_0x16a363[_0x74979c(0x233)]['orderType']??_0x74979c(0x267);if(dbMusicIndexTable['checkOrderParams'](_0x16a363,_0x41051d,_0x3a681d,_0x27bea9)!==!![])return;if(dbUserTable[_0x74979c(0x1ee)](_0x16a363,_0x41051d,_0x25bae5,_0x74979c(0x299))==!![]){let _0x357fcd=[];if(!_0x5a2918){let _0x43b1b5=[];_0x16a363['currentUser'][_0x74979c(0x28d)]==0x1?_0x43b1b5=dbSourceFolderTable['getPathByType'](_0x16a363[_0x74979c(0x241)][_0x74979c(0x298)],_0x25bae5):_0x43b1b5=dbUserTable['getUserPower'](_0x16a363[_0x74979c(0x241)][_0x74979c(0x298)],_0x16a363[_0x74979c(0x1eb)][_0x74979c(0x268)],_0x25bae5);if(_0x43b1b5)for(let _0x411b3b=0x0;_0x411b3b<_0x43b1b5['length'];_0x411b3b++){_0x357fcd['push']({'path':_0x43b1b5[_0x411b3b][_0x74979c(0x287)],'is_file':0x0,'filename':path[_0x74979c(0x2a4)](_0x43b1b5[_0x411b3b][_0x74979c(0x287)]),'root':!![]});}}else{let _0x1e3deb=[];if(_0x16a363[_0x74979c(0x1eb)][_0x74979c(0x28d)]!=0x1){if(dbUserTable[_0x74979c(0x1ee)](_0x16a363,_0x41051d,_0x25bae5,_0x74979c(0x299),_0x5a2918)!==!![])return;}_0x5a2918=path[_0x74979c(0x28e)](_0x5a2918);let _0x22196d=_0x74979c(0x271);_0x1e3deb[_0x74979c(0x243)](_0x5a2918),_0x22196d+=_0x74979c(0x1f7);if(_0x161e3a){let _0x260f10=_0x74979c(0x22f);_0x22196d+=_0x260f10,_0x1e3deb['push']('%'+_0x161e3a+'%'),_0x1e3deb[_0x74979c(0x243)]('%'+_0x161e3a+'%');}let _0x3d5c60=_0x74979c(0x1fe);_0x22196d+=_0x74979c(0x2a0)+_0x3a681d+'\x20'+_0x27bea9,_0x357fcd=_0x16a363[_0x74979c(0x241)]['dbFileIndex']['prepare']('SELECT\x20'+_0x3d5c60+_0x74979c(0x224)+_0x22196d)['all'](_0x1e3deb);}for(let _0x5e7c43 of _0x357fcd){_0x5e7c43[_0x74979c(0x1f3)]=dbMusicFavorite[_0x74979c(0x25f)](_0x16a363[_0x74979c(0x241)][_0x74979c(0x20b)],_0x5e7c43['id'],_0x16a363[_0x74979c(0x1eb)]['id'])?'1':'0';}let _0x4d49f3=path[_0x74979c(0x21c)],_0x55293f={'code':0x0,'data':_0x357fcd,'sep':_0x4d49f3};return _0x41051d['json'](_0x55293f);}}),module[_0x19f311(0x25a)]=router;