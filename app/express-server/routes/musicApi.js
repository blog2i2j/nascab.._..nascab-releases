const _0x3fb2b6=_0x376a;(function(_0x2efc84,_0x1f311a){const _0x3a7478=_0x376a,_0x1526d4=_0x2efc84();while(!![]){try{const _0x1a2591=parseInt(_0x3a7478(0x1a6))/0x1+parseInt(_0x3a7478(0x111))/0x2*(-parseInt(_0x3a7478(0x1ba))/0x3)+parseInt(_0x3a7478(0x14e))/0x4+-parseInt(_0x3a7478(0x153))/0x5*(-parseInt(_0x3a7478(0x1ae))/0x6)+-parseInt(_0x3a7478(0x19b))/0x7*(parseInt(_0x3a7478(0x15b))/0x8)+parseInt(_0x3a7478(0x132))/0x9+parseInt(_0x3a7478(0x150))/0xa*(-parseInt(_0x3a7478(0x123))/0xb);if(_0x1a2591===_0x1f311a)break;else _0x1526d4['push'](_0x1526d4['shift']());}catch(_0x45d3e3){_0x1526d4['push'](_0x1526d4['shift']());}}}(_0x4d7c,0x88abd));let express=require('express'),router=express[_0x3fb2b6(0x113)](),config=require(_0x3fb2b6(0x170)),path=require(_0x3fb2b6(0x17f)),fs=require('fs'),dbMusicIndexTable=require(_0x3fb2b6(0x199)),dbFileIndexTable=require(_0x3fb2b6(0x12f)),dbMusicPlaylistTable=require(_0x3fb2b6(0x1bf)),dbMusicFavorite=require(_0x3fb2b6(0x178)),jsmediatags=require(_0x3fb2b6(0x1b1));const dbUserTable=require(_0x3fb2b6(0x149));let musicUitls=require(_0x3fb2b6(0x165)),sharpUtil=require(_0x3fb2b6(0x182));const dbSourceFolderTable=require('../../db/dbSourceFolderTable');let nasAccountUtil=require(_0x3fb2b6(0x13a)),axios=require(_0x3fb2b6(0x161)),sha256=require(_0x3fb2b6(0x1a2)),os=require('os');function getMusicListByParams(_0x117b35,_0x5b7de4,_0x50370c,_0x15529b,_0x2c5245,_0x137306,_0x1df917,_0x2bdb64,_0x82d044,_0x131958,_0xd44dda,_0xb2428a,_0x3e43d9,_0x3d7e0a,_0x53ad40){const _0x3265dc=_0x3fb2b6;let _0x28eef6=_0x117b35[_0x3265dc(0x11f)][_0x3265dc(0x17b)],_0x5d9d0b=[];if(_0x15529b==_0x3265dc(0x184)||_0x15529b=='playlist')_0x5d9d0b=dbMusicIndexTable['getMusicList'](_0x28eef6,_0x50370c,_0x2c5245,_0x137306,_0x1df917,_0x2bdb64,_0x82d044,_0x131958,_0xd44dda,_0xb2428a,_0x3d7e0a,_0x3e43d9,_0x53ad40);else{if(_0x15529b=='favorite'){let _0x1339c7='',_0x3d6e09=[];_0x1339c7+=_0x3265dc(0x1ad);_0x3e43d9&&(_0x3e43d9=_0x3e43d9[_0x3265dc(0x1c1)]('\x27','')[_0x3265dc(0x1c1)]('â€™',''),_0x1339c7+=_0x3265dc(0x140),_0x3d6e09['push']('%'+_0x3e43d9+'%','%'+_0x3e43d9+'%','%'+_0x3e43d9+'%'));_0x53ad40&&(_0x1339c7+=_0x3265dc(0x107),_0x3d6e09['push'](_0x53ad40,_0x53ad40));if(_0x1df917&&_0x2bdb64){if(_0x1df917==_0x3265dc(0x1b8))_0x1339c7+=_0x3265dc(0x158)+_0x2bdb64+_0x3265dc(0x124)+_0x2bdb64+'\x20';else{if(_0x1df917==_0x3265dc(0x1ab))_0x1339c7+=_0x3265dc(0x198)+_0x2bdb64+',f.album\x20'+_0x2bdb64+'\x20';else{if(_0x1df917=='title')_0x1339c7+=_0x3265dc(0x179)+_0x2bdb64+_0x3265dc(0x18a)+_0x2bdb64+_0x3265dc(0x1bd)+_0x2bdb64+'\x20';else _0x1df917==_0x3265dc(0x176)?_0x1339c7+=_0x3265dc(0x14a)+_0x2bdb64+'\x20':_0x1339c7+=_0x3265dc(0x15e)+_0x1df917+'\x20'+_0x2bdb64+'\x20';}}}else _0x1339c7+=_0x3265dc(0x1c3);_0x1339c7+='\x20LIMIT\x20?\x20OFFSET\x20?\x20',_0x3d6e09[_0x3265dc(0x145)](_0x2c5245),_0x3d6e09['push'](_0x137306),_0x5d9d0b=dbMusicFavorite[_0x3265dc(0x14d)](_0x117b35[_0x3265dc(0x11f)][_0x3265dc(0x17b)],_0x117b35[_0x3265dc(0x194)]['id'],_0x1339c7,'*',_0x3d6e09);}}for(let _0x50ddad of _0x5d9d0b){_0x50ddad['favorite']=dbMusicFavorite[_0x3265dc(0x16e)](_0x117b35[_0x3265dc(0x11f)][_0x3265dc(0x17b)],_0x50ddad['id'],_0x117b35['currentUser']['id'])?'1':'0';if(!_0x50ddad[_0x3265dc(0x173)]){let _0x5212e3=!![];_0x50ddad['file_cover_path']&&fs[_0x3265dc(0x188)](_0x50ddad[_0x3265dc(0x162)])&&(_0x5212e3=![]),_0x5212e3&&(_0x50ddad[_0x3265dc(0x162)]=musicUitls[_0x3265dc(0x15c)](_0x117b35[_0x3265dc(0x11f)][_0x3265dc(0x17b)],_0x50ddad));}_0x50ddad['filePath']=path[_0x3265dc(0x14c)](_0x50ddad['path'],_0x50ddad[_0x3265dc(0x1af)]),delete _0x50ddad[_0x3265dc(0x17f)];}return _0x5d9d0b;}router[_0x3fb2b6(0x1ac)](_0x3fb2b6(0x11d),(_0x7601b0,_0x587027,_0x54419b)=>{const _0x111e79=_0x3fb2b6;let _0x37cdc7=_0x7601b0[_0x111e79(0x11f)][_0x111e79(0x17b)],_0xcdf0f4=_0x7601b0[_0x111e79(0x18d)]['count']?_0x7601b0[_0x111e79(0x18d)][_0x111e79(0x118)]:0xc,_0x42f6c4=_0x7601b0[_0x111e79(0x18d)]['albumCount']?_0x7601b0[_0x111e79(0x18d)][_0x111e79(0x17e)]:0xc,_0x891eef=dbUserTable[_0x111e79(0x1b7)](_0x7601b0,_0x111e79(0x18f),_0x111e79(0x19e),!![]);if(_0x7601b0[_0x111e79(0x194)][_0x111e79(0x1b6)]!=0x1&&!_0x891eef)return _0x587027[_0x111e79(0x13d)]({'code':0x0,'data':null});let _0x176101=getMusicListByParams(_0x7601b0,_0x587027,_0x891eef,_0x111e79(0x184),_0xcdf0f4,0x0,'last_play_time','desc'),_0x4be5e4=getMusicListByParams(_0x7601b0,_0x587027,_0x891eef,_0x111e79(0x184),_0xcdf0f4,0x0,_0x111e79(0x1c5),',id\x20asc'),_0x3bd7f4=getMusicListByParams(_0x7601b0,_0x587027,_0x891eef,_0x111e79(0x184),_0xcdf0f4,0x0,'id',_0x111e79(0x196)),_0x1dc27b=dbMusicIndexTable[_0x111e79(0x129)](_0x37cdc7,_0x891eef,'artist',_0x42f6c4,0x0,_0x111e79(0x120),_0x111e79(0x196));for(let _0x31629d of _0x1dc27b){_0x31629d['coverList']=dbMusicIndexTable['getCoverByField'](_0x37cdc7,'artist',_0x31629d[_0x111e79(0x1b8)],0x1,_0x891eef);}let _0x410c05=dbMusicIndexTable[_0x111e79(0x129)](_0x37cdc7,_0x891eef,_0x111e79(0x1ab),_0x42f6c4,0x0,_0x111e79(0x139),'desc');for(let _0x24f78b of _0x410c05){_0x24f78b[_0x111e79(0x15f)]=dbMusicIndexTable[_0x111e79(0x152)](_0x37cdc7,_0x111e79(0x1ab),_0x24f78b['album'],0x1,_0x891eef);}let _0x57a45e={};return _0x176101&&_0x176101[_0x111e79(0x163)]>0x0&&(_0x57a45e[_0x111e79(0x12e)]=_0x176101),_0x4be5e4&&_0x4be5e4[_0x111e79(0x163)]>0x0&&(_0x57a45e[_0x111e79(0x190)]=_0x4be5e4),_0x3bd7f4&&_0x3bd7f4[_0x111e79(0x163)]>0x0&&(_0x57a45e[_0x111e79(0x11e)]=_0x3bd7f4),_0x1dc27b&&_0x1dc27b[_0x111e79(0x163)]>0x0&&(_0x57a45e[_0x111e79(0x1a8)]=_0x1dc27b),_0x410c05&&_0x410c05[_0x111e79(0x163)]>0x0&&(_0x57a45e[_0x111e79(0x115)]=_0x410c05),_0x587027[_0x111e79(0x13d)]({'code':0x0,'data':_0x57a45e,'platform':os[_0x111e79(0x13c)]()});}),router[_0x3fb2b6(0x1ac)]('/getMusicList',(_0x46fdf3,_0x56ac8c,_0x5934af)=>{const _0xde8b18=_0x3fb2b6;let _0x54f685=_0x46fdf3['body']['count']||0x32,_0x1636c1=_0x46fdf3[_0xde8b18(0x18d)][_0xde8b18(0x1a7)]||0x0,_0x4f8965=_0x46fdf3[_0xde8b18(0x18d)][_0xde8b18(0x1ab)],_0x32487c=_0x46fdf3[_0xde8b18(0x18d)][_0xde8b18(0x10c)],_0xbefcf9=_0x46fdf3[_0xde8b18(0x18d)][_0xde8b18(0x1b8)],_0x1f82e0=_0x46fdf3[_0xde8b18(0x18d)]['genre'],_0x117867=_0x46fdf3[_0xde8b18(0x18d)]['orderField']||'last_play_time',_0x250e0a=_0x46fdf3['body'][_0xde8b18(0x121)]||_0xde8b18(0x196),_0x42aaf2=[_0xde8b18(0x184),_0xde8b18(0x137),_0xde8b18(0x12c)],_0x47bc8c=_0x46fdf3[_0xde8b18(0x18d)][_0xde8b18(0x110)]||'list',_0x34a703=_0x46fdf3[_0xde8b18(0x18d)]['search'],_0x2ed5ef=_0x46fdf3[_0xde8b18(0x18d)][_0xde8b18(0x1a9)],_0x554c0e=_0x46fdf3['body'][_0xde8b18(0x14b)];if(dbMusicIndexTable[_0xde8b18(0x17c)](_0x46fdf3,_0x56ac8c,_0x117867,_0x250e0a)!==!![])return;if(_0x47bc8c==_0xde8b18(0x12c)){if(!_0x554c0e)return _0x46fdf3[_0xde8b18(0x11f)]['returnErrMsg'](_0x56ac8c,_0xde8b18(0x18b));}!_0x42aaf2['includes'](_0x47bc8c)&&(_0x47bc8c=_0xde8b18(0x184));_0x54f685>0x1f4&&(_0x54f685=0x1f4);let _0x3bfed6=dbUserTable[_0xde8b18(0x1b7)](_0x46fdf3,_0xde8b18(0x18f),_0xde8b18(0x19e),!![]);if(_0x46fdf3[_0xde8b18(0x194)]['is_admin']!=0x1&&!_0x3bfed6)return _0x56ac8c[_0xde8b18(0x13d)]({'code':0x0,'data':null});let _0x1c8f61=getMusicListByParams(_0x46fdf3,_0x56ac8c,_0x3bfed6,_0x47bc8c,_0x54f685,_0x1636c1,_0x117867,_0x250e0a,_0x4f8965,_0x32487c,_0xbefcf9,_0x1f82e0,_0x34a703,_0x554c0e,_0x2ed5ef),_0x3dfade={'code':0x0,'data':_0x1c8f61};if(_0x47bc8c=='favorite')_0x3dfade[_0xde8b18(0x136)]=dbMusicFavorite[_0xde8b18(0x134)](_0x46fdf3[_0xde8b18(0x11f)][_0xde8b18(0x17b)],_0x46fdf3[_0xde8b18(0x194)]['id']);else{if(_0x47bc8c==_0xde8b18(0x184))_0x3dfade[_0xde8b18(0x136)]=dbMusicIndexTable[_0xde8b18(0x186)](_0x46fdf3[_0xde8b18(0x11f)][_0xde8b18(0x17b)],_0x3bfed6,_0x4f8965,_0x32487c,_0xbefcf9,_0x1f82e0);else _0x47bc8c==_0xde8b18(0x12c)&&(_0x3dfade[_0xde8b18(0x136)]=dbMusicPlaylistTable[_0xde8b18(0x1c2)](_0x46fdf3[_0xde8b18(0x11f)][_0xde8b18(0x17b)],_0x554c0e));}return _0x56ac8c[_0xde8b18(0x13d)](_0x3dfade);}),router[_0x3fb2b6(0x1ac)](_0x3fb2b6(0x1bb),(_0x132247,_0x59bbda,_0x455b84)=>{const _0x11f387=_0x3fb2b6;let _0xcab14=_0x132247['body']['id'],_0x18d1d6=dbFileIndexTable[_0x11f387(0x119)](_0x132247[_0x11f387(0x11f)][_0x11f387(0x17b)],_0xcab14,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0x18d1d6)return _0x132247['app'][_0x11f387(0x11a)](_0x59bbda,'NO\x20MUSIC\x20INDEX');if(dbUserTable[_0x11f387(0x106)](_0x132247,_0x59bbda,_0x11f387(0x18f),_0x11f387(0x19e),_0x18d1d6[_0x11f387(0x17f)])==!![]){let _0xbfcea1=_0x132247['currentUser']['id'],_0xf1037=dbMusicFavorite['getFavorite'](_0x132247[_0x11f387(0x11f)][_0x11f387(0x17b)],_0xbfcea1,_0xcab14);_0x18d1d6['file_cover_path']=musicUitls[_0x11f387(0x15c)](_0x132247['app'][_0x11f387(0x17b)],_0x18d1d6),_0x18d1d6[_0x11f387(0x137)]=_0xf1037?0x1:0x0,getLyrics(_0x18d1d6,_0x1ba574=>{return _0x18d1d6['lyricList']=_0x1ba574,_0x59bbda['json']({'code':0x0,'data':_0x18d1d6});});}});function updateIndexLyric(_0x45eb1c,_0x2365b2,_0x2e919d,_0x4b0f06){const _0x2a0162=_0x3fb2b6;if(_0x2e919d&&_0x2e919d['length']>0x0){let _0x194912=_0x4b0f06[_0x2a0162(0x1af)][_0x2a0162(0x1c1)](path[_0x2a0162(0x195)](_0x4b0f06[_0x2a0162(0x1af)]),''),_0x18107e=_0x194912+_0x2a0162(0x108),_0x8b78c0=path[_0x2a0162(0x14c)](_0x4b0f06[_0x2a0162(0x17f)],_0x18107e);fs[_0x2a0162(0x167)](_0x8b78c0,_0x2e919d,_0x2a0162(0x17d),_0x24ab94=>{if(!_0x24ab94){}});}let _0x1136f2=JSON['stringify']({'lyrics':_0x2e919d?_0x2e919d:''});_0x45eb1c[_0x2a0162(0x1a5)](_0x2a0162(0x148))[_0x2a0162(0x185)](_0x2365b2,_0x1136f2,_0x4b0f06['id']);}router[_0x3fb2b6(0x1ac)](_0x3fb2b6(0x16d),(_0x48a2fa,_0x591a3,_0x47c7ad)=>{const _0x49114f=_0x3fb2b6;let _0xb10d77=_0x48a2fa[_0x49114f(0x18d)]['id'],_0x23acfc=_0x48a2fa['body']['lyric'],_0x12cced=dbFileIndexTable[_0x49114f(0x119)](_0x48a2fa[_0x49114f(0x11f)][_0x49114f(0x17b)],_0xb10d77,dbFileIndexTable[_0x49114f(0x11b)]);if(!_0x12cced)return _0x48a2fa[_0x49114f(0x11f)][_0x49114f(0x11a)](_0x591a3,_0x49114f(0x133));if(!_0x23acfc)return _0x48a2fa[_0x49114f(0x11f)][_0x49114f(0x11a)](_0x591a3,'Lyric\x20is\x20null');if(dbUserTable[_0x49114f(0x106)](_0x48a2fa,_0x591a3,_0x49114f(0x18f),_0x49114f(0x147),_0x12cced[_0x49114f(0x17f)])==!![])return updateIndexLyric(_0x48a2fa[_0x49114f(0x11f)][_0x49114f(0x17b)],0x1,_0x23acfc,_0x12cced),_0x591a3[_0x49114f(0x13d)]({'code':0x0});}),router['post']('/searchLyric',(_0xb603bc,_0x18bb0e,_0x432aa9)=>{const _0xded98b=_0x3fb2b6;let _0x5b705b=_0xb603bc[_0xded98b(0x18d)]['id'],_0x4491ce=dbFileIndexTable[_0xded98b(0x119)](_0xb603bc['app']['dbFileIndex'],_0x5b705b,dbFileIndexTable[_0xded98b(0x11b)]);if(!_0x4491ce)return _0xb603bc[_0xded98b(0x11f)]['returnErrMsg'](_0x18bb0e,'NO\x20MUSIC\x20INDEX');let _0x2d12e4=_0xb603bc[_0xded98b(0x18d)][_0xded98b(0x1a3)],_0xd92d9e=_0xb603bc['body']['searchMusicArtist'],_0x233fd6=_0xb603bc['body'][_0xded98b(0x193)],_0x183524=_0xb603bc[_0xded98b(0x18d)][_0xded98b(0x15a)];if(dbUserTable[_0xded98b(0x106)](_0xb603bc,_0x18bb0e,_0xded98b(0x18f),_0xded98b(0x19e),_0x4491ce[_0xded98b(0x17f)])==!![]){nasAccountUtil[_0xded98b(0x114)](_0xb603bc[_0xded98b(0x11f)][_0xded98b(0x16b)])[_0xded98b(0x177)](_0x4e6f97=>{const _0x3a3f7a=_0xded98b;if(_0x4e6f97)_0x42642f();else return _0x183524?_0x18bb0e[_0x3a3f7a(0x13d)]({'code':0xbc}):_0xc7b526();})[_0xded98b(0x10f)](_0x11d4d5=>{return _0xc7b526();});function _0xc7b526(){const _0x56d2d1=_0xded98b;return _0x18bb0e[_0x56d2d1(0x13d)]({'code':0x0,'data':[]});}function _0x42642f(){const _0x247101=_0xded98b;if(_0x4491ce[_0x247101(0x174)]==0x1&&!_0x183524)return _0x18bb0e[_0x247101(0x13d)]({'code':0x0,'data':[_0x4491ce[_0x247101(0x181)]]});nasAccountUtil[_0x247101(0x142)](_0xb603bc['app'][_0x247101(0x16b)],!![])[_0x247101(0x177)](_0xac9d49=>{const _0x3d21c0=_0x247101;if(!_0xac9d49)return _0x18bb0e[_0x3d21c0(0x13d)]({'code':0x0,'data':[]});let _0x8fea2d=_0xac9d49[_0x3d21c0(0x126)][_0x3d21c0(0x112)][_0xac9d49[_0x3d21c0(0x126)]['token'][_0x3d21c0(0x163)]-0x1],_0x2b3992=_0xb603bc[_0x3d21c0(0x18d)][_0x3d21c0(0x1be)]||0x0;if(!_0x2d12e4||!_0x2d12e4[_0x3d21c0(0x155)]())return _0x18bb0e[_0x3d21c0(0x13d)]([]);let _0x5b4cc2={'searchMusicName':_0x2d12e4,'searchMusicArtist':_0xd92d9e,'searchMusicAlbum':_0x233fd6,'isSearch':_0x183524,'skipCount':_0x2b3992,'uniIdToken':_0x8fea2d,'token':sha256(_0x2d12e4+config[_0x3d21c0(0x12d)])};axios['post'](config['apiMusicInfoUrl'],_0x5b4cc2)['then'](_0x451a2e=>{const _0x5906ed=_0x3d21c0;if(_0x451a2e['data']){if(_0x451a2e[_0x5906ed(0x183)][_0x5906ed(0x163)]>0x0&&!_0x183524){let _0x18c9c0=![],_0x454dbe=0x14,_0x570fb3=0x64,_0x57969b=null;for(let _0x5a85b3 of _0x451a2e['data']){if(_0x5a85b3[_0x5906ed(0x19d)]){let _0x49b9a1=_0x5a85b3['duration']/0x3e8,_0xd272d6=Math['abs'](_0x49b9a1-_0x4491ce[_0x5906ed(0x19d)]);_0xd272d6<_0x570fb3&&(_0x570fb3=_0xd272d6,_0x57969b=_0x5a85b3[_0x5906ed(0x164)]?_0x5a85b3[_0x5906ed(0x164)]:'');}}return _0x570fb3<_0x454dbe?(_0x18c9c0=!![],_0x4491ce[_0x5906ed(0x181)]=JSON[_0x5906ed(0x10e)]({'lyrics':_0x57969b?_0x57969b:''}),updateIndexLyric(_0xb603bc['app']['dbFileIndex'],0x1,_0x57969b,_0x4491ce)):updateIndexLyric(_0xb603bc[_0x5906ed(0x11f)][_0x5906ed(0x17b)],0x1,'',_0x4491ce),_0x18bb0e[_0x5906ed(0x13d)]({'code':0x0,'data':_0x18c9c0&&_0x4491ce[_0x5906ed(0x181)]?[_0x4491ce['lyrics']]:[]});}else return _0x18bb0e[_0x5906ed(0x13d)]({'code':0x0,'data':_0x451a2e['data']});}})[_0x3d21c0(0x10f)](_0x3516df=>{const _0x1acb9c=_0x3d21c0;return _0xb603bc[_0x1acb9c(0x11f)][_0x1acb9c(0x11a)](_0x18bb0e,_0x3516df[_0x1acb9c(0x160)]);});});}}});function _0x376a(_0x5585c7,_0x560eb5){const _0x4d7c8a=_0x4d7c();return _0x376a=function(_0x376a02,_0x5e66fe){_0x376a02=_0x376a02-0x104;let _0x250bc6=_0x4d7c8a[_0x376a02];return _0x250bc6;},_0x376a(_0x5585c7,_0x560eb5);}function _0x4d7c(){const _0x3193e1=['\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','.lrc','readFile','\x20path=?\x20AND\x20','removeMusicFromPlaylist','year','exports','stringify','catch','listType','711338FCDYKJ','token','Router','getVipInfo','albumList','searchStr','end','count','getById','returnErrMsg','INDEX_TABLE_NAME_MUSIC','temp.','/getMusicHomeData','recentAddList','app','last_play_time','orderType','image','473TkKWnl',',f.artist\x20','getMusicIndex','userInfo','add','deleteFavorite','getGroupList','tags','query','playlist','apiTokenKey','recentMusic','../../db/dbFileIndexTable','read','orderField/orderType\x20error','8552529sZiicA','NO\x20MUSIC\x20INDEX','getFavoriteCount','addFavorite','music_count','favorite','/getMusicIndexFileTree','play_count','../utils/nasAccountUtils','dirname','platform','json','removePlaylist','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','toString','getUserInfo','genTinyFile','size','push','SELECT\x20','power_add','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','../../db/dbUserTable','\x20order\x20by\x20m.update_time\x20','playlistId','join','getAllFavoriteByWhere','2962872PCbdYq','need\x20musicIndexId\x20and\x20playlistId','250330WNlXUt','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','getCoverByField','2035790LOXlmz','APIC','trim','getPlaylistList','search','\x20order\x20by\x20f.artist_fl\x20','addMusicToPlaylist','isSearch','1729824XLhTbM','getMusicSameNameCover','base64','\x20order\x20by\x20f.','coverList','message','axios','file_cover_path','length','lrc','../../utils/musicUtil','includes','writeFile','getPathByType','asc','delete','dbOther','\x20FROM\x20file_index_music\x20WHERE\x20','/saveLyric','musicIsFavorite','parent','../../myConfig/config','get','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','cover_path','lyrics_get_state','from','favorite_time','then','../../db/dbMusicFavorite','\x20order\x20by\x20f.title_fl\x20','/operationPlaylist','dbFileIndex','checkOrderParams','utf-8','albumCount','path','musicIndexId','lyrics','../utils/sharpUtils','data','list','run','getMusicListCount','birthtime','existsSync','transStringToUtf8',',f.title\x20','need\x20playlistId','all','body','orderField','music','maxPlayMusic','inner','/getMusicCover','searchMusicAlbum','currentUser','extname','desc','username','\x20order\x20by\x20f.album_fl\x20','../../db/dbMusicIndexTable','need\x20\x27name\x27','21tnvFWc','getFavorite','duration','power_get','sendFile','title','now','sha256','searchMusicName','operation','prepare','490931NTnoAL','offset','artistList','letterIndex','status','album','post','\x20is_file=1','12ssALsm','filename','groupField','jsmediatags','log','getPlaylistById','sep','createPlaylist','is_admin','getUserPathWhere','artist','uid','6Gznemw','/getMusicDetail','SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?',',f.filename_fl\x20','skipCount','../../db/dbMusicPlaylistTable','operation\x20error','replace','getPlaylistMusicCount','\x20order\x20by\x20m.update_time\x20DESC\x20','getPlaylistCover','play_count\x20desc','updatePlaylist','basename','is_file','doUserCanGet'];_0x4d7c=function(){return _0x3193e1;};return _0x4d7c();}function getLyrics(_0x2d8f61,_0x3510c8){const _0x3d9051=_0x3fb2b6;let _0x56624e=[];try{_0x2d8f61[_0x3d9051(0x181)]&&_0x2d8f61[_0x3d9051(0x181)]['length']>0xa&&_0x56624e[_0x3d9051(0x145)]({'type':_0x3d9051(0x191),'content':_0x2d8f61[_0x3d9051(0x181)]});let _0x393ed7=_0x2d8f61['filename'][_0x3d9051(0x1c1)](path[_0x3d9051(0x195)](_0x2d8f61[_0x3d9051(0x1af)]),''),_0x2fa44=_0x393ed7+_0x3d9051(0x108),_0x548ed3=path[_0x3d9051(0x14c)](_0x2d8f61[_0x3d9051(0x17f)],_0x2fa44);fs[_0x3d9051(0x188)](_0x548ed3)?fs[_0x3d9051(0x109)](_0x548ed3,(_0x4a8256,_0x1d62c1)=>{const _0x1e1fc4=_0x3d9051;let _0x5dc3bb=musicUitls[_0x1e1fc4(0x189)](_0x1d62c1[_0x1e1fc4(0x141)](),_0x548ed3);_0x56624e[_0x1e1fc4(0x145)]({'type':'file','filename':_0x2fa44,'content':_0x5dc3bb}),_0x3510c8(_0x56624e);}):_0x3510c8(_0x56624e);}catch(_0x3c900d){console[_0x3d9051(0x1b2)](_0x3c900d),_0x3510c8(_0x56624e);}}router[_0x3fb2b6(0x1ac)]('/musicFavorite',(_0x46bb04,_0x15056b,_0x2c923d)=>{const _0x3b79df=_0x3fb2b6;let _0x42e8b6=_0x46bb04[_0x3b79df(0x194)]['id'];function _0xac4eaf(_0x452cbc){const _0x72d48e=_0x3b79df;let _0x23cc06=dbFileIndexTable['getById'](_0x46bb04['app'][_0x72d48e(0x17b)],_0x452cbc,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0x23cc06)return;let _0x1dca3e=new Date()['getTime']();_0x46bb04['app'][_0x72d48e(0x17b)][_0x72d48e(0x1a5)](_0x72d48e(0x13f))[_0x72d48e(0x185)](_0x1dca3e,_0x452cbc),dbMusicFavorite[_0x72d48e(0x135)](_0x46bb04['app'][_0x72d48e(0x17b)],_0x42e8b6,_0x452cbc);}if(_0x46bb04['body'][_0x3b79df(0x180)]instanceof Array){let _0x33a490=_0x46bb04['body'][_0x3b79df(0x1a4)];if(_0x33a490==_0x3b79df(0x127))for(let _0x2d2792 of _0x46bb04['body']['musicIndexId']){_0xac4eaf(_0x2d2792);}else{if(_0x33a490==_0x3b79df(0x16a))for(let _0x199c96 of _0x46bb04['body'][_0x3b79df(0x180)]){dbMusicFavorite[_0x3b79df(0x128)](_0x46bb04[_0x3b79df(0x11f)][_0x3b79df(0x17b)],_0x42e8b6,_0x199c96);}}return _0x15056b[_0x3b79df(0x13d)]({'code':0x0});}else{let _0x358078=parseInt(_0x46bb04['body']['musicIndexId']),_0x2cc89d=dbMusicFavorite[_0x3b79df(0x19c)](_0x46bb04[_0x3b79df(0x11f)]['dbFileIndex'],_0x42e8b6,_0x358078),_0x462970=0x0;return _0x2cc89d?dbMusicFavorite['deleteFavorite'](_0x46bb04[_0x3b79df(0x11f)][_0x3b79df(0x17b)],_0x42e8b6,_0x358078):(_0x462970=0x1,_0xac4eaf(_0x358078)),_0x15056b[_0x3b79df(0x13d)]({'code':0x0,'favorite':_0x462970});}}),router[_0x3fb2b6(0x171)](_0x3fb2b6(0x192),(_0x49ad8b,_0x48b466,_0x2571f7)=>{const _0x3ddec9=_0x3fb2b6;let _0x558b80=_0x49ad8b[_0x3ddec9(0x12b)]['indexId'],_0xa264fa=dbMusicIndexTable['getMusicIndex'](_0x49ad8b[_0x3ddec9(0x11f)][_0x3ddec9(0x17b)],_0x558b80),_0x16bd3d=_0x49ad8b[_0x3ddec9(0x12b)][_0x3ddec9(0x144)];!_0x16bd3d&&(_0x16bd3d=0x200);if(!_0xa264fa||_0xa264fa&&!_0xa264fa[_0x3ddec9(0x173)])return _0x48b466[_0x3ddec9(0x1aa)](0x194)[_0x3ddec9(0x117)]();if(dbUserTable[_0x3ddec9(0x106)](_0x49ad8b,_0x48b466,_0x3ddec9(0x18f),'power_get',_0xa264fa['path'])==!![]){let _0x27bac7=path[_0x3ddec9(0x14c)](_0xa264fa['path'],_0xa264fa[_0x3ddec9(0x1af)]),_0x1024db=config['getMediaCoverCachePath'](_0xa264fa,_0x16bd3d);if(fs[_0x3ddec9(0x188)](_0x1024db))return _0x48b466[_0x3ddec9(0x19f)](_0x1024db);jsmediatags[_0x3ddec9(0x130)](_0x27bac7,{'onSuccess':function(_0x289679){const _0x591e29=_0x3ddec9;let _0x864e57=_0x289679[_0x591e29(0x12a)];var _0x2cb939;_0x864e57['picture']&&_0x864e57['picture']['data']&&(_0x2cb939=_0x864e57['picture']['data']);!_0x2cb939&&_0x864e57[_0x591e29(0x154)]&&_0x864e57[_0x591e29(0x154)][_0x591e29(0x183)]&&_0x864e57[_0x591e29(0x154)]['data'][_0x591e29(0x183)]&&(_0x2cb939=_0x864e57['APIC'][_0x591e29(0x183)][_0x591e29(0x183)]);if(_0x2cb939){let _0x8d2db6=path['join'](path[_0x591e29(0x13b)](_0x1024db),_0x591e29(0x11c)+path[_0x591e29(0x104)](_0x1024db));fs[_0x591e29(0x167)](_0x8d2db6,Buffer[_0x591e29(0x175)](_0x2cb939),{'encoding':_0x591e29(0x15d)},function(_0x5f7664){const _0x918e27=_0x591e29;if(!_0x5f7664)sharpUtil[_0x918e27(0x143)](_0x8d2db6,path[_0x918e27(0x13b)](_0x1024db),path[_0x918e27(0x104)](_0x1024db),_0x918e27(0x122),null,_0x5a8e23=>{const _0x3178c3=_0x918e27;return dbMusicIndexTable['updateByFiled'](_0x49ad8b['app'][_0x3178c3(0x17b)],_0xa264fa['id'],_0x3178c3(0x173),_0x1024db),fs['rm'](_0x8d2db6,_0x514dba=>{}),_0x48b466[_0x3178c3(0x19f)](_0x1024db);},_0x3525f4=>{const _0x237376=_0x918e27;return _0x48b466[_0x237376(0x1aa)](0x194)['end']();},_0x16bd3d);else return _0x48b466[_0x918e27(0x1aa)](0x194)[_0x918e27(0x117)]();});}else return _0x48b466[_0x591e29(0x1aa)](0x194)[_0x591e29(0x117)]();},'onError':function(_0x17b000){const _0x272100=_0x3ddec9;return _0x48b466[_0x272100(0x1aa)](0x194)[_0x272100(0x117)]();}});}}),router[_0x3fb2b6(0x1ac)]('/getGroupList',(_0x5bcc29,_0x516b35,_0x120e04)=>{const _0x167214=_0x3fb2b6;let _0xaf5867=_0x5bcc29[_0x167214(0x18d)]['count']||0x32,_0x4eade6=_0x5bcc29[_0x167214(0x18d)][_0x167214(0x1a7)]||0x0,_0x1c686c=_0x5bcc29[_0x167214(0x18d)][_0x167214(0x1b0)]||'album',_0x1402b4=_0x5bcc29[_0x167214(0x18d)][_0x167214(0x18e)]||'check_time',_0x52d207=_0x5bcc29[_0x167214(0x18d)][_0x167214(0x121)]||_0x167214(0x196),_0x4dd283=_0x5bcc29[_0x167214(0x18d)][_0x167214(0x157)],_0xb6ca3f=_0x5bcc29[_0x167214(0x18d)]['letterIndex'];if(dbMusicIndexTable[_0x167214(0x17c)](_0x5bcc29,_0x516b35,_0x1402b4,_0x52d207)!==!![])return;let _0x296247=['check_time',_0x167214(0x139),_0x167214(0x120),'filename',_0x167214(0x1a0),_0x167214(0x1ab),_0x167214(0x1b8),_0x167214(0x187),'id'],_0x36b573=[_0x167214(0x169),_0x167214(0x196)];if(!_0x296247[_0x167214(0x166)](_0x1402b4)||!_0x36b573['includes'](_0x52d207))return _0x5bcc29[_0x167214(0x11f)][_0x167214(0x11a)](_0x516b35,_0x167214(0x131),_0x1402b4,_0x52d207);let _0x353771=dbUserTable[_0x167214(0x1b7)](_0x5bcc29,_0x167214(0x18f),_0x167214(0x19e),!![]);if(_0x5bcc29[_0x167214(0x194)][_0x167214(0x1b6)]!=0x1&&!_0x353771&&_0x1c686c!='playlist')return _0x516b35['json']({'code':0x0,'data':null});let _0xecabd1=[];if(_0x1c686c==_0x167214(0x1ab)||_0x1c686c=='artist'){_0xecabd1=dbMusicIndexTable[_0x167214(0x129)](_0x5bcc29[_0x167214(0x11f)][_0x167214(0x17b)],_0x353771,_0x1c686c,_0xaf5867,_0x4eade6,_0x1402b4,_0x52d207,_0x4dd283,_0xb6ca3f);for(let _0x5ba760 of _0xecabd1){_0x5ba760['coverList']=dbMusicIndexTable[_0x167214(0x152)](_0x5bcc29[_0x167214(0x11f)][_0x167214(0x17b)],_0x1c686c,_0x5ba760[_0x1c686c],0x1,_0x353771);}}else{if(_0x1c686c==_0x167214(0x12c)){_0xecabd1=dbMusicPlaylistTable[_0x167214(0x156)](_0x5bcc29['app']['dbFileIndex'],_0x5bcc29[_0x167214(0x194)]['id'],_0xaf5867,_0x4eade6,'id',_0x167214(0x196),_0x4dd283);for(let _0x2d7a6d of _0xecabd1){_0x2d7a6d[_0x167214(0x15f)]=dbMusicIndexTable[_0x167214(0x1c4)](_0x5bcc29[_0x167214(0x11f)][_0x167214(0x17b)],_0x2d7a6d['id']);}}}return _0x516b35['json']({'code':0x0,'data':_0xecabd1});}),router[_0x3fb2b6(0x1ac)](_0x3fb2b6(0x17a),(_0x38a63d,_0x50dd02,_0x41c980)=>{const _0xfa261b=_0x3fb2b6;let _0x65195a=_0x38a63d[_0xfa261b(0x18d)]['name'],_0x34defc=_0x38a63d[_0xfa261b(0x18d)]['operation'];if(_0x34defc==_0xfa261b(0x127)){if(!_0x65195a)return _0x38a63d[_0xfa261b(0x11f)]['returnErrMsg'](_0x50dd02,_0xfa261b(0x19a));dbMusicPlaylistTable[_0xfa261b(0x1b5)](_0x38a63d[_0xfa261b(0x11f)][_0xfa261b(0x17b)],_0x38a63d['currentUser']['id'],_0x65195a);}else{if(_0x34defc=='edit'||_0x34defc==_0xfa261b(0x16a)){let _0xfae09a=_0x38a63d[_0xfa261b(0x18d)][_0xfa261b(0x14b)],_0x3ee611=dbMusicPlaylistTable[_0xfa261b(0x1b3)](_0x38a63d[_0xfa261b(0x11f)][_0xfa261b(0x17b)],_0xfae09a),_0x3bed68=![];(_0x38a63d[_0xfa261b(0x194)][_0xfa261b(0x1b6)]==0x1||_0x3ee611[_0xfa261b(0x1b9)]==_0x38a63d[_0xfa261b(0x194)]['id'])&&(_0x3bed68=!![]);if(!_0x3bed68)return _0x50dd02[_0xfa261b(0x13d)]({'code':0x66});if(_0x34defc==_0xfa261b(0x16a))dbMusicPlaylistTable[_0xfa261b(0x13e)](_0x38a63d[_0xfa261b(0x11f)]['dbFileIndex'],_0xfae09a);else{if(_0x34defc=='edit'){if(!_0x65195a)return _0x38a63d['app'][_0xfa261b(0x11a)](_0x50dd02,_0xfa261b(0x19a));dbMusicPlaylistTable[_0xfa261b(0x1c6)](_0x38a63d[_0xfa261b(0x11f)]['dbFileIndex'],_0xfae09a,_0x65195a);}}}else return _0x38a63d['app'][_0xfa261b(0x11a)](_0x50dd02,_0xfa261b(0x1c0));}return _0x50dd02['json']({'code':0x0});}),router['post']('/operationPlaylistIndex',(_0x6a4e86,_0x5e0e03,_0x7c75b5)=>{const _0x2b855d=_0x3fb2b6;let _0xa6aa7c=_0x6a4e86[_0x2b855d(0x18d)][_0x2b855d(0x180)],_0x5d9623=_0x6a4e86[_0x2b855d(0x18d)][_0x2b855d(0x14b)];if(!_0xa6aa7c||!_0x5d9623)return _0x6a4e86[_0x2b855d(0x11f)][_0x2b855d(0x11a)](_0x5e0e03,_0x2b855d(0x14f));let _0x14890b=dbMusicPlaylistTable[_0x2b855d(0x1b3)](_0x6a4e86[_0x2b855d(0x11f)][_0x2b855d(0x17b)],_0x5d9623);if(!_0x14890b)return _0x6a4e86['app'][_0x2b855d(0x11a)](_0x5e0e03,'playlistId\x20no\x20exists');let _0x3ccc46=_0x6a4e86[_0x2b855d(0x18d)][_0x2b855d(0x1a4)];if(_0x3ccc46==_0x2b855d(0x127)){function _0x42c747(_0x3f068a){const _0x59bf66=_0x2b855d;let _0x40a25b=dbMusicIndexTable[_0x59bf66(0x125)](_0x6a4e86['app'][_0x59bf66(0x17b)],_0x3f068a);if(!_0x40a25b)return;if(_0x40a25b[_0x59bf66(0x105)]==0x1){dbMusicPlaylistTable['addMusicToPlaylist'](_0x6a4e86['app'][_0x59bf66(0x17b)],_0x3f068a,_0x5d9623);let _0x563f05=Date[_0x59bf66(0x1a1)]();_0x6a4e86[_0x59bf66(0x11f)][_0x59bf66(0x17b)][_0x59bf66(0x1a5)](_0x59bf66(0x13f))['run'](_0x563f05,_0x40a25b['id']);}else{let _0x32ff28=path[_0x59bf66(0x14c)](_0x40a25b[_0x59bf66(0x17f)],_0x40a25b[_0x59bf66(0x1af)]),_0x382ee6=_0x6a4e86[_0x59bf66(0x11f)][_0x59bf66(0x17b)][_0x59bf66(0x1a5)](_0x59bf66(0x1bc))['all'](_0x32ff28,_0x32ff28+path[_0x59bf66(0x1b4)]+'%');for(let _0x19fdb4 of _0x382ee6){dbMusicPlaylistTable[_0x59bf66(0x159)](_0x6a4e86[_0x59bf66(0x11f)][_0x59bf66(0x17b)],_0x19fdb4['id'],_0x5d9623);}}}if(_0xa6aa7c instanceof Array)for(let _0xeb4c3d of _0xa6aa7c){_0x42c747(_0xeb4c3d);}else _0x42c747(_0xa6aa7c);}else{if(_0x3ccc46==_0x2b855d(0x16a)){if(_0xa6aa7c instanceof Array)for(let _0x820149 of _0xa6aa7c){dbMusicPlaylistTable[_0x2b855d(0x10b)](_0x6a4e86[_0x2b855d(0x11f)]['dbFileIndex'],_0x820149,_0x5d9623);}else dbMusicPlaylistTable[_0x2b855d(0x10b)](_0x6a4e86[_0x2b855d(0x11f)][_0x2b855d(0x17b)],_0xa6aa7c,_0x5d9623);}else return _0x6a4e86['app'][_0x2b855d(0x11a)](_0x5e0e03,'operation\x20error');}return _0x5e0e03[_0x2b855d(0x13d)]({'code':0x0,'data':{}});}),router[_0x3fb2b6(0x1ac)](_0x3fb2b6(0x138),(_0x29e88f,_0x324087,_0x263079)=>{const _0x564924=_0x3fb2b6;let _0x4c945b=_0x29e88f['body'][_0x564924(0x16f)],_0x2e043a=_0x29e88f['body'][_0x564924(0x116)],_0x9e7fd9=_0x564924(0x18f),_0x20a40f=_0x29e88f['body'][_0x564924(0x18e)]??'filename',_0x32a4fe=_0x29e88f['body']['orderType']??_0x564924(0x169);if(dbMusicIndexTable[_0x564924(0x17c)](_0x29e88f,_0x324087,_0x20a40f,_0x32a4fe)!==!![])return;if(dbUserTable['doUserCanGet'](_0x29e88f,_0x324087,_0x9e7fd9,_0x564924(0x19e))==!![]){let _0x482f14=[];if(!_0x4c945b){let _0x5e3552=[];_0x29e88f['currentUser']['is_admin']==0x1?_0x5e3552=dbSourceFolderTable[_0x564924(0x168)](_0x29e88f[_0x564924(0x11f)][_0x564924(0x16b)],_0x9e7fd9):_0x5e3552=dbUserTable['getUserPower'](_0x29e88f[_0x564924(0x11f)][_0x564924(0x16b)],_0x29e88f['currentUser'][_0x564924(0x197)],_0x9e7fd9);if(_0x5e3552)for(let _0x36105e=0x0;_0x36105e<_0x5e3552[_0x564924(0x163)];_0x36105e++){_0x482f14[_0x564924(0x145)]({'path':_0x5e3552[_0x36105e]['path'],'is_file':0x0,'filename':path['basename'](_0x5e3552[_0x36105e][_0x564924(0x17f)]),'root':!![]});}}else{let _0x5727c8=[];if(_0x29e88f[_0x564924(0x194)][_0x564924(0x1b6)]!=0x1){if(dbUserTable['doUserCanGet'](_0x29e88f,_0x324087,_0x9e7fd9,'power_get',_0x4c945b)!==!![])return;}_0x4c945b=path[_0x564924(0x14c)](_0x4c945b);let _0x2b9a26=_0x564924(0x10a);_0x5727c8[_0x564924(0x145)](_0x4c945b),_0x2b9a26+='\x20(type=3\x20OR\x20is_file=0)';if(_0x2e043a){let _0x42287e=_0x564924(0x151);_0x2b9a26+=_0x42287e,_0x5727c8['push']('%'+_0x2e043a+'%'),_0x5727c8[_0x564924(0x145)]('%'+_0x2e043a+'%');}let _0x59957e=_0x564924(0x172);_0x2b9a26+='ORDER\x20BY\x20'+_0x20a40f+'\x20'+_0x32a4fe,_0x482f14=_0x29e88f[_0x564924(0x11f)][_0x564924(0x17b)][_0x564924(0x1a5)](_0x564924(0x146)+_0x59957e+_0x564924(0x16c)+_0x2b9a26)[_0x564924(0x18c)](_0x5727c8);}for(let _0x180a88 of _0x482f14){_0x180a88['favorite']=dbMusicFavorite['musicIsFavorite'](_0x29e88f[_0x564924(0x11f)][_0x564924(0x17b)],_0x180a88['id'],_0x29e88f[_0x564924(0x194)]['id'])?'1':'0';}let _0x2565b5=path[_0x564924(0x1b4)],_0x347587={'code':0x0,'data':_0x482f14,'sep':_0x2565b5};return _0x324087['json'](_0x347587);}}),module[_0x3fb2b6(0x10d)]=router;