function _0x5107(_0x4c6436,_0x33646f){const _0x5bc493=_0x5bc4();return _0x5107=function(_0x5107b2,_0x28a391){_0x5107b2=_0x5107b2-0x135;let _0x1da521=_0x5bc493[_0x5107b2];return _0x1da521;},_0x5107(_0x4c6436,_0x33646f);}const _0x209c0e=_0x5107;(function(_0x50a63c,_0x868138){const _0x506715=_0x5107,_0x2e89c7=_0x50a63c();while(!![]){try{const _0xbbf63d=parseInt(_0x506715(0x1d8))/0x1+parseInt(_0x506715(0x135))/0x2*(-parseInt(_0x506715(0x1b1))/0x3)+-parseInt(_0x506715(0x1b0))/0x4+parseInt(_0x506715(0x173))/0x5*(-parseInt(_0x506715(0x152))/0x6)+-parseInt(_0x506715(0x146))/0x7+parseInt(_0x506715(0x1c9))/0x8*(parseInt(_0x506715(0x182))/0x9)+parseInt(_0x506715(0x1eb))/0xa;if(_0xbbf63d===_0x868138)break;else _0x2e89c7['push'](_0x2e89c7['shift']());}catch(_0x424741){_0x2e89c7['push'](_0x2e89c7['shift']());}}}(_0x5bc4,0xb48d8));let express=require(_0x209c0e(0x1a9)),router=express[_0x209c0e(0x1bd)](),config=require(_0x209c0e(0x14d)),path=require(_0x209c0e(0x1ca)),fs=require('fs'),dbMusicIndexTable=require(_0x209c0e(0x16a)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbMusicPlaylistTable=require(_0x209c0e(0x164)),dbMusicFavorite=require('../../db/dbMusicFavorite'),jsmediatags=require(_0x209c0e(0x1c6));const dbUserTable=require('../../db/dbUserTable');let musicUitls=require(_0x209c0e(0x18d)),sharpUtil=require(_0x209c0e(0x1d0));const dbSourceFolderTable=require(_0x209c0e(0x1cd));function _0x5bc4(){const _0x159aff=['readFile','removeMusicFromPlaylist','abs','../../utils/musicUtil','getFavoriteCount','music','search','ORDER\x20BY\x20','tags','getPlaylistCover','list','music_count','musicIndexId','operation\x20error','\x20order\x20by\x20f.artist_fl\x20','count','INDEX_TABLE_NAME_MUSIC','APIC','returnErrMsg','join','\x20path=?\x20AND\x20','getVipInfo','\x20order\x20by\x20f.','/searchLyric','all','name','existsSync','\x20is_file=1','token','getUserPathWhere','albumList','express','\x20is_file,id,path,filename,type,duration,size,title,album,artist,year,genre','play_count','title','then','duration','isSearch','951108GKoelK','3spOCBy',',f.artist\x20','checkOrderParams','getMusicIndex','artist','apiMusicInfoUrl','image','utf-8','asc','\x20AND\x20(filename\x20like\x20?\x20\x20OR\x20title\x20\x20like\x20?\x20\x20OR\x20genre\x20like\x20?\x20)','sendFile','data','Router','album','username','length','status','push','recentAddList','last_play_time','\x20AND\x20(filename_fl\x20=?\x20or\x20title_fl=?\x20)','jsmediatags','\x20FROM\x20file_index_music\x20WHERE\x20','coverList','8uLiGLP','path','favorite_time','base64','../../db/dbSourceFolderTable','lyricList','writeFile','../utils/sharpUtils','axios','getPlaylistMusicCount',',f.filename_fl\x20','cover_path','query','transStringToUtf8','getMusicSameNameCover','154686Zepvnp','catch','add','basename','/getMusicIndexFileTree','getMusicList','addMusicToPlaylist','doUserCanGet','desc','NO\x20MUSIC\x20INDEX','\x20LIMIT\x20?\x20OFFSET\x20?\x20','edit','dbOther','getFavorite','sha256','extname','removePlaylist','artistList','userInfo','23687370JHSyrl','offset','663108ttqkwy','favorite','searchStr','body','getCoverByField','playlist','orderField/orderType\x20error','letterIndex','recentMusic','power_get','../utils/nasAccountUtils','addFavorite','genTinyFile','skipCount','dirname','orderField','log','4783114LGXRZk','albumCount','trim','musicIsFavorite','delete','groupField','dbFileIndex','../../myConfig/config','updatePlaylist','replace','deleteFavorite','getById','190578gQOpoR','getTime','need\x20\x27name\x27','getUserInfo','UPDATE\x20file_index_music\x20set\x20lyrics_get_state=?,\x20lyrics=?\x20WHERE\x20id=?','orderType','getPlaylistById','stringify','file_cover_path','getGroupList','includes','/getMusicCover','lyrics_get_state','searchMusicName','\x20\x20AND\x20(filename\x20LIKE\x20?\x20OR\x20title\x20\x20LIKE\x20?)\x20','app','picture','from','../../db/dbMusicPlaylistTable','UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?','post','temp.','sep','SELECT\x20id\x20from\x20file_index_music\x20where\x20is_file=1\x20and\x20path\x20=?\x20or\x20path\x20like\x20?','../../db/dbMusicIndexTable','lyrics','file','play_count\x20desc','parent','currentUser','operation',',f.album\x20','end','215TBhnhn','/getMusicList','playlistId','\x20order\x20by\x20f.title_fl\x20','year','listType','lrc','filePath','\x20order\x20by\x20m.update_time\x20DESC\x20','json','is_admin','genre','message','prepare','updateByFiled','7511067QLWZvT','maxPlayMusic','indexId','run','.lrc','getMusicListCount','filename','toString'];_0x5bc4=function(){return _0x159aff;};return _0x5bc4();}let nasAccountUtil=require(_0x209c0e(0x13f)),axios=require(_0x209c0e(0x1d1)),sha256=require(_0x209c0e(0x1e6)),os=require('os');function getMusicListByParams(_0x45d34a,_0x571af7,_0x814600,_0x5b1c13,_0x5a0655,_0x391a74,_0x932f87,_0x3984dc,_0x1e8a27,_0x37e079,_0x25716f,_0x1a0d03,_0x4e293e,_0x94164c,_0x449a4b){const _0x37c564=_0x209c0e;let _0x5e9caf=_0x45d34a[_0x37c564(0x161)][_0x37c564(0x14c)],_0x5757cb=[];if(_0x5b1c13==_0x37c564(0x194)||_0x5b1c13==_0x37c564(0x13a))_0x5757cb=dbMusicIndexTable[_0x37c564(0x1dd)](_0x5e9caf,_0x814600,_0x5a0655,_0x391a74,_0x932f87,_0x3984dc,_0x1e8a27,_0x37e079,_0x25716f,_0x1a0d03,_0x94164c,_0x4e293e,_0x449a4b);else{if(_0x5b1c13=='favorite'){let _0x6115af='',_0x155a43=[];_0x6115af+=_0x37c564(0x1a5);_0x4e293e&&(_0x4e293e=_0x4e293e[_0x37c564(0x14f)]('\x27','')[_0x37c564(0x14f)]('â€™',''),_0x6115af+=_0x37c564(0x1ba),_0x155a43[_0x37c564(0x1c2)]('%'+_0x4e293e+'%','%'+_0x4e293e+'%','%'+_0x4e293e+'%'));_0x449a4b&&(_0x6115af+=_0x37c564(0x1c5),_0x155a43[_0x37c564(0x1c2)](_0x449a4b,_0x449a4b));if(_0x932f87&&_0x3984dc){if(_0x932f87==_0x37c564(0x1b5))_0x6115af+=_0x37c564(0x198)+_0x3984dc+_0x37c564(0x1b2)+_0x3984dc+'\x20';else{if(_0x932f87==_0x37c564(0x1be))_0x6115af+='\x20order\x20by\x20f.album_fl\x20'+_0x3984dc+_0x37c564(0x171)+_0x3984dc+'\x20';else{if(_0x932f87==_0x37c564(0x1ac))_0x6115af+=_0x37c564(0x176)+_0x3984dc+',f.title\x20'+_0x3984dc+_0x37c564(0x1d3)+_0x3984dc+'\x20';else _0x932f87==_0x37c564(0x1cb)?_0x6115af+='\x20order\x20by\x20m.update_time\x20'+_0x3984dc+'\x20':_0x6115af+=_0x37c564(0x1a0)+_0x932f87+'\x20'+_0x3984dc+'\x20';}}}else _0x6115af+=_0x37c564(0x17b);_0x6115af+=_0x37c564(0x1e2),_0x155a43[_0x37c564(0x1c2)](_0x5a0655),_0x155a43['push'](_0x391a74),_0x5757cb=dbMusicFavorite['getAllFavoriteByWhere'](_0x45d34a['app'][_0x37c564(0x14c)],_0x45d34a['currentUser']['id'],_0x6115af,'*',_0x155a43);}}for(let _0xfa8ca6 of _0x5757cb){_0xfa8ca6[_0x37c564(0x136)]=dbMusicFavorite[_0x37c564(0x149)](_0x45d34a[_0x37c564(0x161)]['dbFileIndex'],_0xfa8ca6['id'],_0x45d34a[_0x37c564(0x16f)]['id'])?'1':'0';if(!_0xfa8ca6[_0x37c564(0x1d4)]){let _0x3d6a52=!![];_0xfa8ca6[_0x37c564(0x15a)]&&fs[_0x37c564(0x1a4)](_0xfa8ca6[_0x37c564(0x15a)])&&(_0x3d6a52=![]),_0x3d6a52&&(_0xfa8ca6[_0x37c564(0x15a)]=musicUitls[_0x37c564(0x1d7)](_0x45d34a[_0x37c564(0x161)]['dbFileIndex'],_0xfa8ca6));}_0xfa8ca6[_0x37c564(0x17a)]=path[_0x37c564(0x19d)](_0xfa8ca6[_0x37c564(0x1ca)],_0xfa8ca6[_0x37c564(0x188)]),delete _0xfa8ca6[_0x37c564(0x1ca)];}return _0x5757cb;}router['post']('/getMusicHomeData',(_0x114a77,_0x4a8f92,_0xe4ae42)=>{const _0x3ca062=_0x209c0e;let _0x3323b6=_0x114a77[_0x3ca062(0x161)][_0x3ca062(0x14c)],_0x281e34=_0x114a77[_0x3ca062(0x138)]['count']?_0x114a77[_0x3ca062(0x138)][_0x3ca062(0x199)]:0xc,_0x537626=_0x114a77[_0x3ca062(0x138)]['albumCount']?_0x114a77['body'][_0x3ca062(0x147)]:0xc,_0x37676a=dbUserTable['getUserPathWhere'](_0x114a77,_0x3ca062(0x18f),_0x3ca062(0x13e),!![]);if(_0x114a77[_0x3ca062(0x16f)][_0x3ca062(0x17d)]!=0x1&&!_0x37676a)return _0x4a8f92[_0x3ca062(0x17c)]({'code':0x0,'data':null});let _0x17390b=getMusicListByParams(_0x114a77,_0x4a8f92,_0x37676a,_0x3ca062(0x194),_0x281e34,0x0,_0x3ca062(0x1c4),_0x3ca062(0x1e0)),_0x1e0544=getMusicListByParams(_0x114a77,_0x4a8f92,_0x37676a,_0x3ca062(0x194),_0x281e34,0x0,_0x3ca062(0x16d),',id\x20asc'),_0x4cc299=getMusicListByParams(_0x114a77,_0x4a8f92,_0x37676a,_0x3ca062(0x194),_0x281e34,0x0,'id','desc'),_0x3cbf14=dbMusicIndexTable[_0x3ca062(0x15b)](_0x3323b6,_0x37676a,_0x3ca062(0x1b5),_0x537626,0x0,'last_play_time',_0x3ca062(0x1e0));for(let _0x37c067 of _0x3cbf14){_0x37c067[_0x3ca062(0x1c8)]=dbMusicIndexTable['getCoverByField'](_0x3323b6,_0x3ca062(0x1b5),_0x37c067['artist'],0x1,_0x37676a);}let _0x31d91a=dbMusicIndexTable['getGroupList'](_0x3323b6,_0x37676a,_0x3ca062(0x1be),_0x537626,0x0,_0x3ca062(0x1ab),_0x3ca062(0x1e0));for(let _0x510c0a of _0x31d91a){_0x510c0a[_0x3ca062(0x1c8)]=dbMusicIndexTable[_0x3ca062(0x139)](_0x3323b6,_0x3ca062(0x1be),_0x510c0a[_0x3ca062(0x1be)],0x1,_0x37676a);}let _0x2c31c8={};return _0x17390b&&_0x17390b[_0x3ca062(0x1c0)]>0x0&&(_0x2c31c8[_0x3ca062(0x13d)]=_0x17390b),_0x1e0544&&_0x1e0544['length']>0x0&&(_0x2c31c8[_0x3ca062(0x183)]=_0x1e0544),_0x4cc299&&_0x4cc299[_0x3ca062(0x1c0)]>0x0&&(_0x2c31c8[_0x3ca062(0x1c3)]=_0x4cc299),_0x3cbf14&&_0x3cbf14[_0x3ca062(0x1c0)]>0x0&&(_0x2c31c8[_0x3ca062(0x1e9)]=_0x3cbf14),_0x31d91a&&_0x31d91a[_0x3ca062(0x1c0)]>0x0&&(_0x2c31c8[_0x3ca062(0x1a8)]=_0x31d91a),_0x4a8f92[_0x3ca062(0x17c)]({'code':0x0,'data':_0x2c31c8,'platform':os['platform']()});}),router[_0x209c0e(0x166)](_0x209c0e(0x174),(_0x5046b5,_0x240960,_0x5f3874)=>{const _0x5ab4d9=_0x209c0e;let _0x43da96=_0x5046b5[_0x5ab4d9(0x138)][_0x5ab4d9(0x199)]||0x32,_0x546d61=_0x5046b5[_0x5ab4d9(0x138)][_0x5ab4d9(0x1ec)]||0x0,_0x2d4df4=_0x5046b5['body'][_0x5ab4d9(0x1be)],_0x3c59f7=_0x5046b5['body'][_0x5ab4d9(0x177)],_0x43153c=_0x5046b5[_0x5ab4d9(0x138)][_0x5ab4d9(0x1b5)],_0x3e1076=_0x5046b5['body'][_0x5ab4d9(0x17e)],_0x1e6593=_0x5046b5[_0x5ab4d9(0x138)]['orderField']||_0x5ab4d9(0x1c4),_0x523e87=_0x5046b5['body'][_0x5ab4d9(0x157)]||_0x5ab4d9(0x1e0),_0x5f02e3=[_0x5ab4d9(0x194),'favorite','playlist'],_0x44bc31=_0x5046b5[_0x5ab4d9(0x138)][_0x5ab4d9(0x178)]||_0x5ab4d9(0x194),_0x7dee72=_0x5046b5[_0x5ab4d9(0x138)][_0x5ab4d9(0x190)],_0x1b4ee1=_0x5046b5[_0x5ab4d9(0x138)][_0x5ab4d9(0x13c)],_0x373e5a=_0x5046b5[_0x5ab4d9(0x138)][_0x5ab4d9(0x175)];if(dbMusicIndexTable[_0x5ab4d9(0x1b3)](_0x5046b5,_0x240960,_0x1e6593,_0x523e87)!==!![])return;if(_0x44bc31=='playlist'){if(!_0x373e5a)return _0x5046b5[_0x5ab4d9(0x161)][_0x5ab4d9(0x19c)](_0x240960,'need\x20playlistId');}!_0x5f02e3['includes'](_0x44bc31)&&(_0x44bc31=_0x5ab4d9(0x194));_0x43da96>0x1f4&&(_0x43da96=0x1f4);let _0x3726b5=dbUserTable[_0x5ab4d9(0x1a7)](_0x5046b5,_0x5ab4d9(0x18f),_0x5ab4d9(0x13e),!![]);if(_0x5046b5['currentUser'][_0x5ab4d9(0x17d)]!=0x1&&!_0x3726b5)return _0x240960[_0x5ab4d9(0x17c)]({'code':0x0,'data':null});let _0x31a074=getMusicListByParams(_0x5046b5,_0x240960,_0x3726b5,_0x44bc31,_0x43da96,_0x546d61,_0x1e6593,_0x523e87,_0x2d4df4,_0x3c59f7,_0x43153c,_0x3e1076,_0x7dee72,_0x373e5a,_0x1b4ee1),_0x40ab10={'code':0x0,'data':_0x31a074};if(_0x44bc31==_0x5ab4d9(0x136))_0x40ab10[_0x5ab4d9(0x195)]=dbMusicFavorite[_0x5ab4d9(0x18e)](_0x5046b5['app'][_0x5ab4d9(0x14c)],_0x5046b5[_0x5ab4d9(0x16f)]['id']);else{if(_0x44bc31==_0x5ab4d9(0x194))_0x40ab10[_0x5ab4d9(0x195)]=dbMusicIndexTable[_0x5ab4d9(0x187)](_0x5046b5['app']['dbFileIndex'],_0x3726b5,_0x2d4df4,_0x3c59f7,_0x43153c,_0x3e1076);else _0x44bc31==_0x5ab4d9(0x13a)&&(_0x40ab10['music_count']=dbMusicPlaylistTable[_0x5ab4d9(0x1d2)](_0x5046b5['app'][_0x5ab4d9(0x14c)],_0x373e5a));}return _0x240960[_0x5ab4d9(0x17c)](_0x40ab10);}),router[_0x209c0e(0x166)]('/getMusicDetail',(_0x18ea2c,_0x40770c,_0x258f6b)=>{const _0x45d4a7=_0x209c0e;let _0x3f601d=_0x18ea2c[_0x45d4a7(0x138)]['id'],_0x2396b0=dbFileIndexTable['getById'](_0x18ea2c[_0x45d4a7(0x161)][_0x45d4a7(0x14c)],_0x3f601d,dbFileIndexTable[_0x45d4a7(0x19a)]);if(!_0x2396b0)return _0x18ea2c['app'][_0x45d4a7(0x19c)](_0x40770c,_0x45d4a7(0x1e1));if(dbUserTable[_0x45d4a7(0x1df)](_0x18ea2c,_0x40770c,'music','power_get',_0x2396b0[_0x45d4a7(0x1ca)])==!![]){let _0x33f248=_0x18ea2c['currentUser']['id'],_0x2f4ce3=dbMusicFavorite[_0x45d4a7(0x1e5)](_0x18ea2c[_0x45d4a7(0x161)]['dbFileIndex'],_0x33f248,_0x3f601d);_0x2396b0[_0x45d4a7(0x15a)]=musicUitls['getMusicSameNameCover'](_0x18ea2c[_0x45d4a7(0x161)][_0x45d4a7(0x14c)],_0x2396b0),_0x2396b0[_0x45d4a7(0x136)]=_0x2f4ce3?0x1:0x0,getLyrics(_0x2396b0,_0x55e3e5=>{const _0x2dd457=_0x45d4a7;return _0x2396b0[_0x2dd457(0x1ce)]=_0x55e3e5,_0x40770c['json']({'code':0x0,'data':_0x2396b0});});}});function updateIndexLyric(_0x25d0b4,_0x9ab59a,_0x1a9b93,_0x33fe75){const _0x21bd39=_0x209c0e;if(_0x1a9b93&&_0x1a9b93['length']>0x0){let _0x1adf79=_0x33fe75[_0x21bd39(0x188)][_0x21bd39(0x14f)](path['extname'](_0x33fe75[_0x21bd39(0x188)]),''),_0x20c341=_0x1adf79+'.lrc',_0x4f9675=path['join'](_0x33fe75[_0x21bd39(0x1ca)],_0x20c341);fs[_0x21bd39(0x1cf)](_0x4f9675,_0x1a9b93,_0x21bd39(0x1b8),_0x51d056=>{if(!_0x51d056){}});}let _0x3ec9a4=JSON[_0x21bd39(0x159)]({'lyrics':_0x1a9b93?_0x1a9b93:''});_0x25d0b4['prepare'](_0x21bd39(0x156))[_0x21bd39(0x185)](_0x9ab59a,_0x3ec9a4,_0x33fe75['id']);}router[_0x209c0e(0x166)]('/saveLyric',(_0xa5938a,_0x405bb3,_0x572eb1)=>{const _0x45a710=_0x209c0e;let _0x1806d3=_0xa5938a[_0x45a710(0x138)]['id'],_0x4c2630=_0xa5938a[_0x45a710(0x138)]['lyric'],_0x588fb5=dbFileIndexTable[_0x45a710(0x151)](_0xa5938a['app'][_0x45a710(0x14c)],_0x1806d3,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0x588fb5)return _0xa5938a[_0x45a710(0x161)][_0x45a710(0x19c)](_0x405bb3,_0x45a710(0x1e1));if(!_0x4c2630)return _0xa5938a['app']['returnErrMsg'](_0x405bb3,'Lyric\x20is\x20null');if(dbUserTable['doUserCanGet'](_0xa5938a,_0x405bb3,'music','power_add',_0x588fb5[_0x45a710(0x1ca)])==!![])return updateIndexLyric(_0xa5938a['app']['dbFileIndex'],0x1,_0x4c2630,_0x588fb5),_0x405bb3[_0x45a710(0x17c)]({'code':0x0});}),router[_0x209c0e(0x166)](_0x209c0e(0x1a1),(_0x2803a9,_0x6fb311,_0x5f3b4a)=>{const _0x3436dd=_0x209c0e;let _0x456b3c=_0x2803a9[_0x3436dd(0x138)]['id'],_0x3a32e3=dbFileIndexTable[_0x3436dd(0x151)](_0x2803a9['app'][_0x3436dd(0x14c)],_0x456b3c,dbFileIndexTable[_0x3436dd(0x19a)]);if(!_0x3a32e3)return _0x2803a9['app'][_0x3436dd(0x19c)](_0x6fb311,_0x3436dd(0x1e1));let _0x23265c=_0x2803a9[_0x3436dd(0x138)][_0x3436dd(0x15f)],_0x15e045=_0x2803a9[_0x3436dd(0x138)]['searchMusicArtist'],_0x2231a1=_0x2803a9[_0x3436dd(0x138)]['searchMusicAlbum'],_0x192c4b=_0x2803a9[_0x3436dd(0x138)][_0x3436dd(0x1af)];if(dbUserTable[_0x3436dd(0x1df)](_0x2803a9,_0x6fb311,_0x3436dd(0x18f),_0x3436dd(0x13e),_0x3a32e3[_0x3436dd(0x1ca)])==!![]){nasAccountUtil[_0x3436dd(0x19f)](_0x2803a9[_0x3436dd(0x161)][_0x3436dd(0x1e4)])[_0x3436dd(0x1ad)](_0x4b3e9a=>{const _0x11b705=_0x3436dd;if(_0x4b3e9a)_0x418e0b();else return _0x192c4b?_0x6fb311[_0x11b705(0x17c)]({'code':0xbc}):_0x163b51();})[_0x3436dd(0x1d9)](_0x5d250f=>{return _0x163b51();});function _0x163b51(){const _0x1b2bbd=_0x3436dd;return _0x6fb311[_0x1b2bbd(0x17c)]({'code':0x0,'data':[]});}function _0x418e0b(){const _0x4bea64=_0x3436dd;if(_0x3a32e3[_0x4bea64(0x15e)]==0x1&&!_0x192c4b)return _0x6fb311['json']({'code':0x0,'data':[_0x3a32e3[_0x4bea64(0x16b)]]});nasAccountUtil[_0x4bea64(0x155)](_0x2803a9[_0x4bea64(0x161)][_0x4bea64(0x1e4)],!![])[_0x4bea64(0x1ad)](_0x2b2f10=>{const _0x145086=_0x4bea64;if(!_0x2b2f10)return _0x6fb311[_0x145086(0x17c)]({'code':0x0,'data':[]});let _0x3a8e1b=_0x2b2f10[_0x145086(0x1ea)][_0x145086(0x1a6)][_0x2b2f10[_0x145086(0x1ea)][_0x145086(0x1a6)][_0x145086(0x1c0)]-0x1],_0x199e22=_0x2803a9[_0x145086(0x138)][_0x145086(0x142)]||0x0;if(!_0x23265c||!_0x23265c[_0x145086(0x148)]())return _0x6fb311[_0x145086(0x17c)]([]);let _0x1e1d3e={'searchMusicName':_0x23265c,'searchMusicArtist':_0x15e045,'searchMusicAlbum':_0x2231a1,'isSearch':_0x192c4b,'skipCount':_0x199e22,'uniIdToken':_0x3a8e1b,'token':sha256(_0x23265c+config['apiTokenKey'])};axios['post'](config[_0x145086(0x1b6)],_0x1e1d3e)[_0x145086(0x1ad)](_0x61361d=>{const _0x39294d=_0x145086;if(_0x61361d[_0x39294d(0x1bc)]){if(_0x61361d['data'][_0x39294d(0x1c0)]>0x0&&!_0x192c4b){let _0xc69714=![],_0x2ee6d4=0x14,_0x40f42b=0x64,_0x353d4d=null;for(let _0x5a2f56 of _0x61361d[_0x39294d(0x1bc)]){if(_0x5a2f56[_0x39294d(0x1ae)]){let _0x2b022a=_0x5a2f56['duration']/0x3e8,_0x55f7a9=Math[_0x39294d(0x18c)](_0x2b022a-_0x3a32e3[_0x39294d(0x1ae)]);_0x55f7a9<_0x40f42b&&(_0x40f42b=_0x55f7a9,_0x353d4d=_0x5a2f56[_0x39294d(0x179)]?_0x5a2f56[_0x39294d(0x179)]:'');}}return _0x40f42b<_0x2ee6d4?(_0xc69714=!![],_0x3a32e3[_0x39294d(0x16b)]=JSON['stringify']({'lyrics':_0x353d4d?_0x353d4d:''}),updateIndexLyric(_0x2803a9[_0x39294d(0x161)]['dbFileIndex'],0x1,_0x353d4d,_0x3a32e3)):updateIndexLyric(_0x2803a9['app'][_0x39294d(0x14c)],0x1,'',_0x3a32e3),_0x6fb311['json']({'code':0x0,'data':_0xc69714&&_0x3a32e3[_0x39294d(0x16b)]?[_0x3a32e3['lyrics']]:[]});}else return _0x6fb311[_0x39294d(0x17c)]({'code':0x0,'data':_0x61361d[_0x39294d(0x1bc)]});}})[_0x145086(0x1d9)](_0x712c09=>{const _0x3af6c2=_0x145086;return _0x2803a9[_0x3af6c2(0x161)]['returnErrMsg'](_0x6fb311,_0x712c09[_0x3af6c2(0x17f)]);});});}}});function getLyrics(_0x27e81e,_0xfc04a1){const _0x53e6c7=_0x209c0e;let _0x4f5529=[];try{_0x27e81e['lyrics']&&_0x27e81e[_0x53e6c7(0x16b)][_0x53e6c7(0x1c0)]>0xa&&_0x4f5529['push']({'type':'inner','content':_0x27e81e['lyrics']});let _0x1f6f41=_0x27e81e[_0x53e6c7(0x188)][_0x53e6c7(0x14f)](path[_0x53e6c7(0x1e7)](_0x27e81e[_0x53e6c7(0x188)]),''),_0x4e13e9=_0x1f6f41+_0x53e6c7(0x186),_0x1dab1a=path['join'](_0x27e81e[_0x53e6c7(0x1ca)],_0x4e13e9);fs['existsSync'](_0x1dab1a)?fs[_0x53e6c7(0x18a)](_0x1dab1a,(_0x5943eb,_0x341c69)=>{const _0x21adac=_0x53e6c7;let _0x3a2259=musicUitls[_0x21adac(0x1d6)](_0x341c69[_0x21adac(0x189)](),_0x1dab1a);_0x4f5529[_0x21adac(0x1c2)]({'type':_0x21adac(0x16c),'filename':_0x4e13e9,'content':_0x3a2259}),_0xfc04a1(_0x4f5529);}):_0xfc04a1(_0x4f5529);}catch(_0x3937aa){console[_0x53e6c7(0x145)](_0x3937aa),_0xfc04a1(_0x4f5529);}}router[_0x209c0e(0x166)]('/musicFavorite',(_0x31ad5f,_0x1a94c2,_0x40c174)=>{const _0x2168b3=_0x209c0e;let _0x30c7b1=_0x31ad5f['currentUser']['id'];function _0x435d18(_0x24f20d){const _0x1be5a1=_0x5107;let _0xe0d864=dbFileIndexTable[_0x1be5a1(0x151)](_0x31ad5f['app'][_0x1be5a1(0x14c)],_0x24f20d,dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);if(!_0xe0d864)return;let _0x3d5f37=new Date()[_0x1be5a1(0x153)]();_0x31ad5f[_0x1be5a1(0x161)][_0x1be5a1(0x14c)]['prepare'](_0x1be5a1(0x165))[_0x1be5a1(0x185)](_0x3d5f37,_0x24f20d),dbMusicFavorite[_0x1be5a1(0x140)](_0x31ad5f[_0x1be5a1(0x161)][_0x1be5a1(0x14c)],_0x30c7b1,_0x24f20d);}if(_0x31ad5f[_0x2168b3(0x138)][_0x2168b3(0x196)]instanceof Array){let _0x222980=_0x31ad5f[_0x2168b3(0x138)][_0x2168b3(0x170)];if(_0x222980==_0x2168b3(0x1da))for(let _0xffa5e2 of _0x31ad5f[_0x2168b3(0x138)][_0x2168b3(0x196)]){_0x435d18(_0xffa5e2);}else{if(_0x222980==_0x2168b3(0x14a))for(let _0x851703 of _0x31ad5f[_0x2168b3(0x138)][_0x2168b3(0x196)]){dbMusicFavorite[_0x2168b3(0x150)](_0x31ad5f['app'][_0x2168b3(0x14c)],_0x30c7b1,_0x851703);}}return _0x1a94c2[_0x2168b3(0x17c)]({'code':0x0});}else{let _0x270cc7=parseInt(_0x31ad5f['body'][_0x2168b3(0x196)]),_0x931f89=dbMusicFavorite[_0x2168b3(0x1e5)](_0x31ad5f[_0x2168b3(0x161)][_0x2168b3(0x14c)],_0x30c7b1,_0x270cc7),_0x4b69a6=0x0;return _0x931f89?dbMusicFavorite['deleteFavorite'](_0x31ad5f['app'][_0x2168b3(0x14c)],_0x30c7b1,_0x270cc7):(_0x4b69a6=0x1,_0x435d18(_0x270cc7)),_0x1a94c2[_0x2168b3(0x17c)]({'code':0x0,'favorite':_0x4b69a6});}}),router['get'](_0x209c0e(0x15d),(_0x50a182,_0x564b19,_0x325f73)=>{const _0x4ae80e=_0x209c0e;let _0x635243=_0x50a182[_0x4ae80e(0x1d5)][_0x4ae80e(0x184)],_0x10f234=dbMusicIndexTable[_0x4ae80e(0x1b4)](_0x50a182[_0x4ae80e(0x161)]['dbFileIndex'],_0x635243),_0x54ed1d=_0x50a182['query']['size'];!_0x54ed1d&&(_0x54ed1d=0x200);if(!_0x10f234||_0x10f234&&!_0x10f234['cover_path'])return _0x564b19['status'](0x194)[_0x4ae80e(0x172)]();if(dbUserTable['doUserCanGet'](_0x50a182,_0x564b19,'music',_0x4ae80e(0x13e),_0x10f234['path'])==!![]){let _0xc57d90=path['join'](_0x10f234[_0x4ae80e(0x1ca)],_0x10f234[_0x4ae80e(0x188)]),_0x2ba375=config['getMediaCoverCachePath'](_0x10f234,_0x54ed1d);if(fs[_0x4ae80e(0x1a4)](_0x2ba375))return _0x564b19['sendFile'](_0x2ba375);jsmediatags['read'](_0xc57d90,{'onSuccess':function(_0x167a1b){const _0x340c05=_0x4ae80e;let _0x491ff4=_0x167a1b[_0x340c05(0x192)];var _0x14f60a;_0x491ff4[_0x340c05(0x162)]&&_0x491ff4[_0x340c05(0x162)]['data']&&(_0x14f60a=_0x491ff4[_0x340c05(0x162)][_0x340c05(0x1bc)]);!_0x14f60a&&_0x491ff4[_0x340c05(0x19b)]&&_0x491ff4[_0x340c05(0x19b)][_0x340c05(0x1bc)]&&_0x491ff4[_0x340c05(0x19b)][_0x340c05(0x1bc)][_0x340c05(0x1bc)]&&(_0x14f60a=_0x491ff4['APIC']['data'][_0x340c05(0x1bc)]);if(_0x14f60a){let _0x2d0f3b=path[_0x340c05(0x19d)](path['dirname'](_0x2ba375),_0x340c05(0x167)+path[_0x340c05(0x1db)](_0x2ba375));fs[_0x340c05(0x1cf)](_0x2d0f3b,Buffer[_0x340c05(0x163)](_0x14f60a),{'encoding':_0x340c05(0x1cc)},function(_0x54dad4){const _0x337c3c=_0x340c05;if(!_0x54dad4)sharpUtil[_0x337c3c(0x141)](_0x2d0f3b,path[_0x337c3c(0x143)](_0x2ba375),path['basename'](_0x2ba375),_0x337c3c(0x1b7),null,_0xd41bfb=>{const _0x2d7008=_0x337c3c;return dbMusicIndexTable[_0x2d7008(0x181)](_0x50a182[_0x2d7008(0x161)][_0x2d7008(0x14c)],_0x10f234['id'],_0x2d7008(0x1d4),_0x2ba375),fs['rm'](_0x2d0f3b,_0x3abd2c=>{}),_0x564b19[_0x2d7008(0x1bb)](_0x2ba375);},_0xde11a9=>{const _0xb28dbb=_0x337c3c;return _0x564b19[_0xb28dbb(0x1c1)](0x194)[_0xb28dbb(0x172)]();},_0x54ed1d);else return _0x564b19[_0x337c3c(0x1c1)](0x194)[_0x337c3c(0x172)]();});}else return _0x564b19[_0x340c05(0x1c1)](0x194)[_0x340c05(0x172)]();},'onError':function(_0xf96390){const _0x39c0f3=_0x4ae80e;return _0x564b19['status'](0x194)[_0x39c0f3(0x172)]();}});}}),router[_0x209c0e(0x166)]('/getGroupList',(_0x203925,_0x213405,_0x4b56e4)=>{const _0x36d783=_0x209c0e;let _0x1f41a8=_0x203925[_0x36d783(0x138)][_0x36d783(0x199)]||0x32,_0x3604a2=_0x203925['body']['offset']||0x0,_0x3dcf3b=_0x203925[_0x36d783(0x138)][_0x36d783(0x14b)]||'album',_0x3d36ac=_0x203925['body'][_0x36d783(0x144)]||'check_time',_0x59d504=_0x203925['body'][_0x36d783(0x157)]||'desc',_0x25c517=_0x203925['body'][_0x36d783(0x190)],_0x3b7436=_0x203925[_0x36d783(0x138)][_0x36d783(0x13c)];if(dbMusicIndexTable[_0x36d783(0x1b3)](_0x203925,_0x213405,_0x3d36ac,_0x59d504)!==!![])return;let _0xfacdae=['check_time',_0x36d783(0x1ab),_0x36d783(0x1c4),_0x36d783(0x188),_0x36d783(0x1ac),_0x36d783(0x1be),_0x36d783(0x1b5),'birthtime','id'],_0x248f22=[_0x36d783(0x1b9),_0x36d783(0x1e0)];if(!_0xfacdae[_0x36d783(0x15c)](_0x3d36ac)||!_0x248f22[_0x36d783(0x15c)](_0x59d504))return _0x203925[_0x36d783(0x161)][_0x36d783(0x19c)](_0x213405,_0x36d783(0x13b),_0x3d36ac,_0x59d504);let _0x54a90f=dbUserTable[_0x36d783(0x1a7)](_0x203925,'music','power_get',!![]);if(_0x203925[_0x36d783(0x16f)][_0x36d783(0x17d)]!=0x1&&!_0x54a90f&&_0x3dcf3b!=_0x36d783(0x13a))return _0x213405['json']({'code':0x0,'data':null});let _0x423a4a=[];if(_0x3dcf3b==_0x36d783(0x1be)||_0x3dcf3b==_0x36d783(0x1b5)){_0x423a4a=dbMusicIndexTable['getGroupList'](_0x203925[_0x36d783(0x161)]['dbFileIndex'],_0x54a90f,_0x3dcf3b,_0x1f41a8,_0x3604a2,_0x3d36ac,_0x59d504,_0x25c517,_0x3b7436);for(let _0x9dd1 of _0x423a4a){_0x9dd1[_0x36d783(0x1c8)]=dbMusicIndexTable[_0x36d783(0x139)](_0x203925[_0x36d783(0x161)]['dbFileIndex'],_0x3dcf3b,_0x9dd1[_0x3dcf3b],0x1,_0x54a90f);}}else{if(_0x3dcf3b=='playlist'){_0x423a4a=dbMusicPlaylistTable['getPlaylistList'](_0x203925[_0x36d783(0x161)][_0x36d783(0x14c)],_0x203925[_0x36d783(0x16f)]['id'],_0x1f41a8,_0x3604a2,'id','desc',_0x25c517);for(let _0x3c347e of _0x423a4a){_0x3c347e[_0x36d783(0x1c8)]=dbMusicIndexTable[_0x36d783(0x193)](_0x203925[_0x36d783(0x161)][_0x36d783(0x14c)],_0x3c347e['id']);}}}return _0x213405['json']({'code':0x0,'data':_0x423a4a});}),router['post']('/operationPlaylist',(_0x5cf6d5,_0x514771,_0x1a0cf6)=>{const _0x26b093=_0x209c0e;let _0x351ba7=_0x5cf6d5[_0x26b093(0x138)][_0x26b093(0x1a3)],_0x238368=_0x5cf6d5['body'][_0x26b093(0x170)];if(_0x238368==_0x26b093(0x1da)){if(!_0x351ba7)return _0x5cf6d5['app']['returnErrMsg'](_0x514771,'need\x20\x27name\x27');dbMusicPlaylistTable['createPlaylist'](_0x5cf6d5[_0x26b093(0x161)][_0x26b093(0x14c)],_0x5cf6d5[_0x26b093(0x16f)]['id'],_0x351ba7);}else{if(_0x238368==_0x26b093(0x1e3)||_0x238368==_0x26b093(0x14a)){let _0xa5dfd9=_0x5cf6d5[_0x26b093(0x138)][_0x26b093(0x175)],_0x333b16=dbMusicPlaylistTable[_0x26b093(0x158)](_0x5cf6d5['app']['dbFileIndex'],_0xa5dfd9),_0x3f95b3=![];(_0x5cf6d5[_0x26b093(0x16f)][_0x26b093(0x17d)]==0x1||_0x333b16['uid']==_0x5cf6d5[_0x26b093(0x16f)]['id'])&&(_0x3f95b3=!![]);if(!_0x3f95b3)return _0x514771[_0x26b093(0x17c)]({'code':0x66});if(_0x238368=='delete')dbMusicPlaylistTable[_0x26b093(0x1e8)](_0x5cf6d5[_0x26b093(0x161)][_0x26b093(0x14c)],_0xa5dfd9);else{if(_0x238368==_0x26b093(0x1e3)){if(!_0x351ba7)return _0x5cf6d5[_0x26b093(0x161)][_0x26b093(0x19c)](_0x514771,_0x26b093(0x154));dbMusicPlaylistTable[_0x26b093(0x14e)](_0x5cf6d5[_0x26b093(0x161)]['dbFileIndex'],_0xa5dfd9,_0x351ba7);}}}else return _0x5cf6d5[_0x26b093(0x161)][_0x26b093(0x19c)](_0x514771,_0x26b093(0x197));}return _0x514771['json']({'code':0x0});}),router[_0x209c0e(0x166)]('/operationPlaylistIndex',(_0xfc35c6,_0x16af3a,_0x23ab07)=>{const _0x3f5821=_0x209c0e;let _0x3e0ff1=_0xfc35c6['body'][_0x3f5821(0x196)],_0x1aeb1f=_0xfc35c6['body'][_0x3f5821(0x175)];if(!_0x3e0ff1||!_0x1aeb1f)return _0xfc35c6[_0x3f5821(0x161)][_0x3f5821(0x19c)](_0x16af3a,'need\x20musicIndexId\x20and\x20playlistId');let _0x2f6b85=dbMusicPlaylistTable[_0x3f5821(0x158)](_0xfc35c6['app'][_0x3f5821(0x14c)],_0x1aeb1f);if(!_0x2f6b85)return _0xfc35c6[_0x3f5821(0x161)][_0x3f5821(0x19c)](_0x16af3a,'playlistId\x20no\x20exists');let _0xacbc9d=_0xfc35c6[_0x3f5821(0x138)][_0x3f5821(0x170)];if(_0xacbc9d=='add'){function _0x58c72e(_0x3722f6){const _0x3722c4=_0x3f5821;let _0xe266f5=dbMusicIndexTable[_0x3722c4(0x1b4)](_0xfc35c6[_0x3722c4(0x161)][_0x3722c4(0x14c)],_0x3722f6);if(!_0xe266f5)return;if(_0xe266f5['is_file']==0x1){dbMusicPlaylistTable['addMusicToPlaylist'](_0xfc35c6[_0x3722c4(0x161)][_0x3722c4(0x14c)],_0x3722f6,_0x1aeb1f);let _0x1810c1=Date['now']();_0xfc35c6[_0x3722c4(0x161)][_0x3722c4(0x14c)][_0x3722c4(0x180)]('UPDATE\x20file_index_music\x20set\x20check_time=?\x20WHERE\x20id=?')['run'](_0x1810c1,_0xe266f5['id']);}else{let _0x1a8f85=path['join'](_0xe266f5[_0x3722c4(0x1ca)],_0xe266f5[_0x3722c4(0x188)]),_0x28b518=_0xfc35c6[_0x3722c4(0x161)][_0x3722c4(0x14c)][_0x3722c4(0x180)](_0x3722c4(0x169))[_0x3722c4(0x1a2)](_0x1a8f85,_0x1a8f85+path[_0x3722c4(0x168)]+'%');for(let _0xf16444 of _0x28b518){dbMusicPlaylistTable[_0x3722c4(0x1de)](_0xfc35c6['app']['dbFileIndex'],_0xf16444['id'],_0x1aeb1f);}}}if(_0x3e0ff1 instanceof Array)for(let _0x1a5d17 of _0x3e0ff1){_0x58c72e(_0x1a5d17);}else _0x58c72e(_0x3e0ff1);}else{if(_0xacbc9d==_0x3f5821(0x14a)){if(_0x3e0ff1 instanceof Array)for(let _0x2a1e03 of _0x3e0ff1){dbMusicPlaylistTable[_0x3f5821(0x18b)](_0xfc35c6[_0x3f5821(0x161)]['dbFileIndex'],_0x2a1e03,_0x1aeb1f);}else dbMusicPlaylistTable[_0x3f5821(0x18b)](_0xfc35c6[_0x3f5821(0x161)][_0x3f5821(0x14c)],_0x3e0ff1,_0x1aeb1f);}else return _0xfc35c6['app'][_0x3f5821(0x19c)](_0x16af3a,_0x3f5821(0x197));}return _0x16af3a['json']({'code':0x0,'data':{}});}),router['post'](_0x209c0e(0x1dc),(_0x1446c9,_0x9b1f2c,_0x31b86a)=>{const _0x3df4ff=_0x209c0e;let _0x2c92a9=_0x1446c9[_0x3df4ff(0x138)][_0x3df4ff(0x16e)],_0x10bb4c=_0x1446c9['body'][_0x3df4ff(0x137)],_0x35cdfc=_0x3df4ff(0x18f),_0xe75cda=_0x1446c9[_0x3df4ff(0x138)]['orderField']??_0x3df4ff(0x188),_0x3d9ff8=_0x1446c9['body'][_0x3df4ff(0x157)]??_0x3df4ff(0x1b9);if(dbMusicIndexTable['checkOrderParams'](_0x1446c9,_0x9b1f2c,_0xe75cda,_0x3d9ff8)!==!![])return;if(dbUserTable[_0x3df4ff(0x1df)](_0x1446c9,_0x9b1f2c,_0x35cdfc,'power_get')==!![]){let _0x268d7e=[];if(!_0x2c92a9){let _0x2d4922=[];_0x1446c9[_0x3df4ff(0x16f)][_0x3df4ff(0x17d)]==0x1?_0x2d4922=dbSourceFolderTable['getPathByType'](_0x1446c9[_0x3df4ff(0x161)][_0x3df4ff(0x1e4)],_0x35cdfc):_0x2d4922=dbUserTable['getUserPower'](_0x1446c9[_0x3df4ff(0x161)]['dbOther'],_0x1446c9[_0x3df4ff(0x16f)][_0x3df4ff(0x1bf)],_0x35cdfc);if(_0x2d4922)for(let _0xd824ce=0x0;_0xd824ce<_0x2d4922[_0x3df4ff(0x1c0)];_0xd824ce++){_0x268d7e['push']({'path':_0x2d4922[_0xd824ce]['path'],'is_file':0x0,'filename':path[_0x3df4ff(0x1db)](_0x2d4922[_0xd824ce][_0x3df4ff(0x1ca)]),'root':!![]});}}else{let _0x2b8c3c=[];if(_0x1446c9[_0x3df4ff(0x16f)][_0x3df4ff(0x17d)]!=0x1){if(dbUserTable[_0x3df4ff(0x1df)](_0x1446c9,_0x9b1f2c,_0x35cdfc,_0x3df4ff(0x13e),_0x2c92a9)!==!![])return;}_0x2c92a9=path['join'](_0x2c92a9);let _0xca737d=_0x3df4ff(0x19e);_0x2b8c3c['push'](_0x2c92a9),_0xca737d+='\x20(type=3\x20OR\x20is_file=0)';if(_0x10bb4c){let _0xbbdff8=_0x3df4ff(0x160);_0xca737d+=_0xbbdff8,_0x2b8c3c[_0x3df4ff(0x1c2)]('%'+_0x10bb4c+'%'),_0x2b8c3c[_0x3df4ff(0x1c2)]('%'+_0x10bb4c+'%');}let _0x4d8170=_0x3df4ff(0x1aa);_0xca737d+=_0x3df4ff(0x191)+_0xe75cda+'\x20'+_0x3d9ff8,_0x268d7e=_0x1446c9['app'][_0x3df4ff(0x14c)][_0x3df4ff(0x180)]('SELECT\x20'+_0x4d8170+_0x3df4ff(0x1c7)+_0xca737d)[_0x3df4ff(0x1a2)](_0x2b8c3c);}for(let _0x366045 of _0x268d7e){_0x366045['favorite']=dbMusicFavorite[_0x3df4ff(0x149)](_0x1446c9['app'][_0x3df4ff(0x14c)],_0x366045['id'],_0x1446c9[_0x3df4ff(0x16f)]['id'])?'1':'0';}let _0x168e7c=path['sep'],_0x59a5ef={'code':0x0,'data':_0x268d7e,'sep':_0x168e7c};return _0x9b1f2c[_0x3df4ff(0x17c)](_0x59a5ef);}}),module['exports']=router;