const _0x21a5d1=_0x211f;(function(_0x46c43b,_0x138926){const _0x1d8da2=_0x211f,_0x10acc5=_0x46c43b();while(!![]){try{const _0x13580c=-parseInt(_0x1d8da2(0xb7))/0x1*(-parseInt(_0x1d8da2(0xa9))/0x2)+parseInt(_0x1d8da2(0x97))/0x3+-parseInt(_0x1d8da2(0xa3))/0x4*(parseInt(_0x1d8da2(0xaa))/0x5)+-parseInt(_0x1d8da2(0xc5))/0x6+parseInt(_0x1d8da2(0xb8))/0x7+parseInt(_0x1d8da2(0x8f))/0x8*(-parseInt(_0x1d8da2(0xc3))/0x9)+parseInt(_0x1d8da2(0xb9))/0xa;if(_0x13580c===_0x138926)break;else _0x10acc5['push'](_0x10acc5['shift']());}catch(_0x39de14){_0x10acc5['push'](_0x10acc5['shift']());}}}(_0x33cd,0xcc473));var express=require(_0x21a5d1(0x9a)),router=express[_0x21a5d1(0xa4)]();function _0x211f(_0x2d62fa,_0x340ab0){const _0x33cd9f=_0x33cd();return _0x211f=function(_0x211f71,_0x32b63e){_0x211f71=_0x211f71-0x8b;let _0x1bcea2=_0x33cd9f[_0x211f71];return _0x1bcea2;},_0x211f(_0x2d62fa,_0x340ab0);}function _0x33cd(){const _0x3fd5ee=['deleteIndexFromAlbum','power_add','2JuuIme','10otmOCD','delete','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','share','../../db/dbFileIndexTable','\x20AND\x20id=','/addAlbum','end','exports','asc','body','is_admin','getIndexByWhere','413123dfSWkR','1027173SzKakH','39463530UXpbNR','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','orderType','power_get','getAllByWhere','currentUser','parentPath','power_change','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','includes','18FlZPhA','app','4389954VQkrJh','getByName','in_trash','imgList','username','/deleteFromAlbum','getPathAll','indexIdArr','getList','/addToAlbum','search','desc','/deleteAlbum','offset','album.sameNameExist','returnErrMsg','photo','\x20\x20is_file=1\x20','lastInsertRowid','index_id','album\x20id\x20invalid','status','length','addIndexToAlbum','doUserCanGet','../../db/dbUserTable','6320216ITkzIz','create','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','operation\x20fail','albumId','json','/setAlbumCover','getUserPathWhere','247839lXyVGg','name','udpateCover','express','/updateAlbum','changes','/getAllAlbum','dbFileIndex','udpateName','power_delete','id\x20not\x20exist','../../db/dbOrdinaryAlbumTable','2880784UUzRii','Router','post','getById'];_0x33cd=function(){return _0x3fd5ee;};return _0x33cd();}const dbFileIndexTable=require(_0x21a5d1(0xae)),dbUserTable=require(_0x21a5d1(0x8e)),dbOrdinaryAlbumTable=require(_0x21a5d1(0xa2));router[_0x21a5d1(0xa5)](_0x21a5d1(0xb0),(_0x11ac23,_0x213a8c,_0x3c310d)=>{const _0x5a2476=_0x21a5d1;if(dbUserTable[_0x5a2476(0x8d)](_0x11ac23,_0x213a8c,_0x5a2476(0xd5),_0x5a2476(0xa8))==!![]){let _0x351084=_0x11ac23[_0x5a2476(0xb4)]['name'],_0x9a82f7=_0x11ac23[_0x5a2476(0xb4)][_0x5a2476(0xbf)],_0x123023=_0x11ac23[_0x5a2476(0xb4)][_0x5a2476(0xad)];_0x123023!='1'&&(_0x123023='0');let _0x3300ed=dbOrdinaryAlbumTable[_0x5a2476(0xc6)](_0x11ac23[_0x5a2476(0xc4)][_0x5a2476(0x9e)],_0x351084);if(_0x3300ed)return _0x11ac23['app']['returnErrMsg'](_0x213a8c,_0x213a8c['__'](_0x5a2476(0xd3)));let _0x400acc=dbOrdinaryAlbumTable[_0x5a2476(0x90)](_0x11ac23[_0x5a2476(0xc4)]['dbFileIndex'],{'name':_0x351084,'username':_0x11ac23[_0x5a2476(0xbe)][_0x5a2476(0xc9)],'share':_0x123023});if(_0x400acc['changes']>0x0){if(_0x9a82f7){let _0x5da171=_0x400acc[_0x5a2476(0xd7)];if(_0x5da171){let _0xdb4311=dbFileIndexTable[_0x5a2476(0xcb)](_0x11ac23['app'][_0x5a2476(0x9e)],_0x9a82f7,dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],'id');for(let _0x358a9f in _0xdb4311){dbOrdinaryAlbumTable[_0x5a2476(0x8c)](_0x11ac23[_0x5a2476(0xc4)][_0x5a2476(0x9e)],{'album_id':_0x5da171,'index_id':_0xdb4311[_0x358a9f]['id']});}}}_0x213a8c['json']({'code':0x0,'result':_0x400acc});}else _0x213a8c[_0x5a2476(0x94)]({'code':0x1,'message':_0x5a2476(0x92)});}}),router[_0x21a5d1(0xa5)](_0x21a5d1(0xd1),(_0x44646f,_0x9d7985,_0x3308b4)=>{const _0x5b5ad0=_0x21a5d1;let _0x122637=_0x44646f[_0x5b5ad0(0xb4)]['id'],_0x5dcc3a=dbOrdinaryAlbumTable['getById'](_0x44646f[_0x5b5ad0(0xc4)]['dbFileIndex'],_0x122637);if(!_0x5dcc3a)return _0x44646f[_0x5b5ad0(0xc4)][_0x5b5ad0(0xd4)](_0x9d7985,'id\x20not\x20exist');if(_0x5dcc3a[_0x5b5ad0(0xc9)]==_0x44646f['currentUser']['username']||dbUserTable['doUserCanGet'](_0x44646f,_0x9d7985,'photo',_0x5b5ad0(0xa0))==!![]){let _0x6fcbf1=dbOrdinaryAlbumTable[_0x5b5ad0(0xab)](_0x44646f[_0x5b5ad0(0xc4)][_0x5b5ad0(0x9e)],_0x122637);_0x6fcbf1[_0x5b5ad0(0x9c)]>0x0?_0x9d7985[_0x5b5ad0(0x94)]({'code':0x0,'result':_0x6fcbf1}):_0x9d7985['json']({'code':0x1,'message':_0x5b5ad0(0x92)});}}),router[_0x21a5d1(0xa5)](_0x21a5d1(0x9b),(_0x1c2c75,_0x33880b,_0x16088a)=>{const _0x3c9518=_0x21a5d1;let _0x2cea40=_0x1c2c75['body']['id'],_0x15a5c5=dbOrdinaryAlbumTable[_0x3c9518(0xa6)](_0x1c2c75[_0x3c9518(0xc4)][_0x3c9518(0x9e)],_0x2cea40);if(!_0x15a5c5)return _0x1c2c75[_0x3c9518(0xc4)]['returnErrMsg'](_0x33880b,_0x3c9518(0xa1));if(_0x15a5c5[_0x3c9518(0xc9)]==_0x1c2c75['currentUser'][_0x3c9518(0xc9)]||dbUserTable[_0x3c9518(0x8d)](_0x1c2c75,_0x33880b,_0x3c9518(0xd5),'power_change')==!![]){let _0x215c29=_0x1c2c75[_0x3c9518(0xb4)][_0x3c9518(0x98)],_0x4943cd=_0x1c2c75[_0x3c9518(0xb4)][_0x3c9518(0xad)];_0x4943cd!='1'&&(_0x4943cd='0');let _0x50bc38=dbOrdinaryAlbumTable[_0x3c9518(0x9f)](_0x1c2c75[_0x3c9518(0xc4)][_0x3c9518(0x9e)],_0x2cea40,_0x215c29,_0x4943cd);_0x50bc38['changes']>0x0?_0x33880b['json']({'code':0x0,'result':_0x50bc38}):_0x33880b[_0x3c9518(0x94)]({'code':0x1,'message':'operation\x20fail'});}}),router[_0x21a5d1(0xa5)](_0x21a5d1(0x9d),(_0x3815e9,_0x58456c,_0x8edf6b)=>{const _0xca6240=_0x21a5d1;if(dbUserTable['doUserCanGet'](_0x3815e9,_0x58456c,_0xca6240(0xd5),_0xca6240(0xbc))==!![]){let _0x1bd41f=dbUserTable[_0xca6240(0x96)](_0x3815e9,_0xca6240(0xd5),_0xca6240(0xbc),!![]),_0x1a84ff=_0x3815e9['body']['count']||0x14,_0xf7c06f=_0x3815e9[_0xca6240(0xb4)][_0xca6240(0xd2)]||0x0,_0x18ed26=_0x3815e9[_0xca6240(0xb4)]['orderField']||'id',_0x1b6de2=_0x3815e9[_0xca6240(0xb4)][_0xca6240(0xbb)]||_0xca6240(0xd0),_0x2dda73=_0x3815e9[_0xca6240(0xb4)][_0xca6240(0xcf)];(![_0xca6240(0x98),'id'][_0xca6240(0xc2)](_0x18ed26)||![_0xca6240(0xb3),_0xca6240(0xd0)][_0xca6240(0xc2)](_0x1b6de2))&&_0x58456c[_0xca6240(0x94)]({'code':0x0,'data':[]});let _0x291356=dbOrdinaryAlbumTable[_0xca6240(0xcd)](_0x3815e9[_0xca6240(0xc4)][_0xca6240(0x9e)],_0x1a84ff,_0xf7c06f,_0x18ed26,_0x1b6de2,_0x2dda73),_0x19fed9=_0x291356;if(_0x3815e9[_0xca6240(0xbe)][_0xca6240(0xb5)]!=0x1){_0x19fed9=[];for(let _0x3fa18c=0x0;_0x3fa18c<_0x291356['length'];_0x3fa18c++){let _0x50bdd9=_0x291356[_0x3fa18c];(_0x50bdd9[_0xca6240(0xad)]==0x1||_0x50bdd9[_0xca6240(0xc9)]==_0x3815e9['currentUser'][_0xca6240(0xc9)])&&_0x19fed9['push'](_0x50bdd9);}}for(let _0x3f584a=0x0;_0x3f584a<_0x19fed9['length'];_0x3f584a++){let _0x2ae352=_0xca6240(0xd6);_0x2ae352+=_0x1bd41f;let _0x2b23ad=dbOrdinaryAlbumTable[_0xca6240(0xb6)](_0x3815e9[_0xca6240(0xc4)][_0xca6240(0x9e)],_0xca6240(0xba),[_0x19fed9[_0x3f584a]['id']]);!_0x2b23ad&&(_0x2b23ad=dbOrdinaryAlbumTable[_0xca6240(0xb6)](_0x3815e9[_0xca6240(0xc4)][_0xca6240(0x9e)],_0xca6240(0xac),[_0x19fed9[_0x3f584a]['id']]));if(_0x2b23ad){let _0x23b067=dbFileIndexTable['getById'](_0x3815e9['app'][_0xca6240(0x9e)],_0x2b23ad[_0xca6240(0xd8)]);_0x23b067&&_0x23b067[_0xca6240(0xc7)]!=0x1&&(_0x2ae352+=_0xca6240(0xaf)+_0x2b23ad[_0xca6240(0xd8)]);}else{_0x19fed9[_0x3f584a][_0xca6240(0xc8)]=[];continue;}_0x2ae352+=_0xca6240(0xc1),_0x2ae352+=_0xca6240(0x91);let _0x5d8568=dbFileIndexTable[_0xca6240(0xbd)](_0x3815e9[_0xca6240(0xc4)]['dbFileIndex'],_0x2ae352);_0x19fed9[_0x3f584a][_0xca6240(0xc8)]=_0x5d8568;}_0x58456c[_0xca6240(0x94)]({'code':0x0,'data':_0x19fed9});}}),router[_0x21a5d1(0xa5)](_0x21a5d1(0xce),(_0x72d473,_0x4566d9,_0x2a959f)=>{const _0x186e5c=_0x21a5d1;if(dbUserTable['doUserCanGet'](_0x72d473,_0x4566d9,'photo',_0x186e5c(0xa8))==!![]){let _0x50362c=_0x72d473[_0x186e5c(0xb4)]['indexIdArr'],_0x442cfc=_0x72d473['body']['albumId'],_0x44d3f3=dbOrdinaryAlbumTable['getById'](_0x72d473[_0x186e5c(0xc4)][_0x186e5c(0x9e)],_0x442cfc);if(!_0x44d3f3)return _0x4566d9[_0x186e5c(0xda)](0x194)[_0x186e5c(0xb1)]();let _0xe2f6ec=0x0;if(_0x50362c&&_0x50362c[_0x186e5c(0x8b)]>0x0)for(let _0x3ea932=0x0;_0x3ea932<_0x50362c[_0x186e5c(0x8b)];_0x3ea932++){let _0x38e56f=_0x50362c[_0x3ea932],_0x442ec7=dbFileIndexTable[_0x186e5c(0xa6)](_0x72d473[_0x186e5c(0xc4)][_0x186e5c(0x9e)],_0x38e56f);if(!_0x442ec7)continue;let _0x111a3d=dbOrdinaryAlbumTable['addIndexToAlbum'](_0x72d473[_0x186e5c(0xc4)][_0x186e5c(0x9e)],{'album_id':_0x442cfc,'index_id':_0x38e56f});_0x111a3d[_0x186e5c(0x9c)]>0x0&&(_0xe2f6ec+=0x1);}_0x4566d9['json']({'code':0x0,'sucCount':_0xe2f6ec});}}),router[_0x21a5d1(0xa5)](_0x21a5d1(0xca),(_0x3a8b83,_0x41cf21,_0x117690)=>{const _0x1a9466=_0x21a5d1;if(dbUserTable[_0x1a9466(0x8d)](_0x3a8b83,_0x41cf21,_0x1a9466(0xd5),_0x1a9466(0xa0))==!![]){let _0xc7d415=_0x3a8b83[_0x1a9466(0xb4)][_0x1a9466(0xcc)],_0x1d8ed2=_0x3a8b83['body'][_0x1a9466(0x93)],_0x30c10a=dbOrdinaryAlbumTable[_0x1a9466(0xa6)](_0x3a8b83[_0x1a9466(0xc4)][_0x1a9466(0x9e)],_0x1d8ed2);if(!_0x30c10a)return _0x41cf21[_0x1a9466(0x94)]({'code':0x1,'message':_0x1a9466(0xd9)});if(_0xc7d415&&_0xc7d415['length']>0x0){let _0x1dc87e='(';for(let _0xbb69ae=0x0;_0xbb69ae<_0xc7d415['length'];_0xbb69ae++){let _0x1cd69d=_0xc7d415[_0xbb69ae],_0x40800e=dbFileIndexTable[_0x1a9466(0xa6)](_0x3a8b83[_0x1a9466(0xc4)][_0x1a9466(0x9e)],_0x1cd69d);if(!_0x40800e)continue;_0x1dc87e+=_0x1cd69d,_0xbb69ae!=_0xc7d415[_0x1a9466(0x8b)]-0x1&&(_0x1dc87e+=',');}_0x1dc87e+=')';let _0x58e53e=dbOrdinaryAlbumTable[_0x1a9466(0xa7)](_0x3a8b83[_0x1a9466(0xc4)][_0x1a9466(0x9e)],_0x1d8ed2,_0x1dc87e);_0x41cf21[_0x1a9466(0x94)]({'code':0x0,'sucCount':_0x58e53e[_0x1a9466(0x9c)]});}else _0x41cf21[_0x1a9466(0x94)]({'code':0x0,'sucCount':0x0});}}),router[_0x21a5d1(0xa5)](_0x21a5d1(0x95),(_0x3fc45b,_0x5ebad0,_0x560e6c)=>{const _0x3344e0=_0x21a5d1;if(dbUserTable[_0x3344e0(0x8d)](_0x3fc45b,_0x5ebad0,_0x3344e0(0xd5),_0x3344e0(0xc0))==!![]){let _0x576124=_0x3fc45b[_0x3344e0(0xb4)]['indexId'],_0x49347b=_0x3fc45b[_0x3344e0(0xb4)][_0x3344e0(0x93)],_0x1fa29e=dbOrdinaryAlbumTable[_0x3344e0(0xa6)](_0x3fc45b[_0x3344e0(0xc4)][_0x3344e0(0x9e)],_0x49347b);if(!_0x1fa29e)return _0x5ebad0['json']({'code':0x1,'message':_0x3344e0(0xd9)});let _0x2a9ea8=dbFileIndexTable[_0x3344e0(0xa6)](_0x3fc45b[_0x3344e0(0xc4)][_0x3344e0(0x9e)],_0x576124);if(!_0x2a9ea8)return _0x5ebad0[_0x3344e0(0x94)]({'code':0x1,'message':'index\x20id\x20invalid'});return dbOrdinaryAlbumTable[_0x3344e0(0x99)](_0x3fc45b['app'][_0x3344e0(0x9e)],_0x49347b,_0x576124),_0x5ebad0[_0x3344e0(0x94)]({'code':0x0});}}),module[_0x21a5d1(0xb2)]=router;