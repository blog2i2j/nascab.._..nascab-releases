function _0x347e(_0x1d03ec,_0x15a232){const _0x582460=_0x5824();return _0x347e=function(_0x347e9a,_0x41872a){_0x347e9a=_0x347e9a-0x1f4;let _0x5d1012=_0x582460[_0x347e9a];return _0x5d1012;},_0x347e(_0x1d03ec,_0x15a232);}function _0x5824(){const _0x54a8e9=['/deleteAlbum','874830BVVMdP','orderType','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','981783DgIvjy','offset','36zZaXTI','doUserCanGet','is_admin','desc','username','index\x20id\x20invalid','/getAllAlbum','express','parentPath','post','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','3822208umNQBe','push','name','currentUser','body','getList','INDEX_TABLE_NAME_PHOTO','indexIdArr','679180OpZcbZ','/deleteFromAlbum','../../db/dbOrdinaryAlbumTable','power_add','getAllByWhere','power_delete','count','changes','getIndexByWhere','app','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','4620532ofFhso','150xqEzae','282270LXJspd','photo','delete','operation\x20fail','udpateName','Router','status','share','orderField','power_change','243801TuGYrH','create','index_id','getUserPathWhere','album.sameNameExist','json','/updateAlbum','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','/addToAlbum','lastInsertRowid','deleteIndexFromAlbum','returnErrMsg','28gOzCNf','addIndexToAlbum','length','search','exports','udpateCover','imgList','end','includes','getPathAll','in_trash','getById','/addAlbum','getByName','albumId','id\x20not\x20exist','dbFileIndex'];_0x5824=function(){return _0x54a8e9;};return _0x5824();}const _0x2c7dda=_0x347e;(function(_0x45658d,_0xc4da02){const _0x46dff4=_0x347e,_0x4c9110=_0x45658d();while(!![]){try{const _0x50af10=parseInt(_0x46dff4(0x221))/0x1+parseInt(_0x46dff4(0x236))/0x2+-parseInt(_0x46dff4(0x1f6))/0x3*(-parseInt(_0x46dff4(0x20c))/0x4)+-parseInt(_0x46dff4(0x21e))/0x5*(parseInt(_0x46dff4(0x223))/0x6)+parseInt(_0x46dff4(0x1f4))/0x7+-parseInt(_0x46dff4(0x22e))/0x8+parseInt(_0x46dff4(0x200))/0x9*(-parseInt(_0x46dff4(0x1f5))/0xa);if(_0x50af10===_0xc4da02)break;else _0x4c9110['push'](_0x4c9110['shift']());}catch(_0x41ec5e){_0x4c9110['push'](_0x4c9110['shift']());}}}(_0x5824,0xac67c));var express=require(_0x2c7dda(0x22a)),router=express[_0x2c7dda(0x1fb)]();const dbFileIndexTable=require('../../db/dbFileIndexTable'),dbUserTable=require('../../db/dbUserTable'),dbOrdinaryAlbumTable=require(_0x2c7dda(0x238));router[_0x2c7dda(0x22c)](_0x2c7dda(0x218),(_0x42e9c3,_0x45c952,_0x76e45d)=>{const _0x28e87c=_0x2c7dda;if(dbUserTable[_0x28e87c(0x224)](_0x42e9c3,_0x45c952,_0x28e87c(0x1f7),_0x28e87c(0x239))==!![]){let _0x18fb5c=_0x42e9c3[_0x28e87c(0x232)][_0x28e87c(0x230)],_0x5df880=_0x42e9c3['body'][_0x28e87c(0x22b)],_0x3c2999=_0x42e9c3[_0x28e87c(0x232)][_0x28e87c(0x1fd)];_0x3c2999!='1'&&(_0x3c2999='0');let _0x5cc6a0=dbOrdinaryAlbumTable[_0x28e87c(0x219)](_0x42e9c3['app']['dbFileIndex'],_0x18fb5c);if(_0x5cc6a0)return _0x42e9c3[_0x28e87c(0x23f)][_0x28e87c(0x20b)](_0x45c952,_0x45c952['__'](_0x28e87c(0x204)));let _0x4bd5e1=dbOrdinaryAlbumTable[_0x28e87c(0x201)](_0x42e9c3['app']['dbFileIndex'],{'name':_0x18fb5c,'username':_0x42e9c3[_0x28e87c(0x231)]['username'],'share':_0x3c2999});if(_0x4bd5e1[_0x28e87c(0x23d)]>0x0){if(_0x5df880){let _0x4e80f9=_0x4bd5e1[_0x28e87c(0x209)];if(_0x4e80f9){let _0x497783=dbFileIndexTable[_0x28e87c(0x215)](_0x42e9c3['app'][_0x28e87c(0x21c)],_0x5df880,dbFileIndexTable[_0x28e87c(0x234)],'id');for(let _0x4d24a9 in _0x497783){dbOrdinaryAlbumTable[_0x28e87c(0x20d)](_0x42e9c3['app']['dbFileIndex'],{'album_id':_0x4e80f9,'index_id':_0x497783[_0x4d24a9]['id']});}}}_0x45c952[_0x28e87c(0x205)]({'code':0x0,'result':_0x4bd5e1});}else _0x45c952[_0x28e87c(0x205)]({'code':0x1,'message':_0x28e87c(0x1f9)});}}),router['post'](_0x2c7dda(0x21d),(_0x1eaa87,_0x26325d,_0x2cef6c)=>{const _0x5e5d89=_0x2c7dda;let _0x298227=_0x1eaa87['body']['id'],_0x519b33=dbOrdinaryAlbumTable['getById'](_0x1eaa87[_0x5e5d89(0x23f)][_0x5e5d89(0x21c)],_0x298227);if(!_0x519b33)return _0x1eaa87[_0x5e5d89(0x23f)]['returnErrMsg'](_0x26325d,'id\x20not\x20exist');if(_0x519b33[_0x5e5d89(0x227)]==_0x1eaa87['currentUser'][_0x5e5d89(0x227)]||dbUserTable[_0x5e5d89(0x224)](_0x1eaa87,_0x26325d,_0x5e5d89(0x1f7),_0x5e5d89(0x23b))==!![]){let _0x52a243=dbOrdinaryAlbumTable[_0x5e5d89(0x1f8)](_0x1eaa87[_0x5e5d89(0x23f)][_0x5e5d89(0x21c)],_0x298227);_0x52a243[_0x5e5d89(0x23d)]>0x0?_0x26325d[_0x5e5d89(0x205)]({'code':0x0,'result':_0x52a243}):_0x26325d[_0x5e5d89(0x205)]({'code':0x1,'message':_0x5e5d89(0x1f9)});}}),router['post'](_0x2c7dda(0x206),(_0x417557,_0xcd8b01,_0x140eb0)=>{const _0x1f8129=_0x2c7dda;let _0x57b135=_0x417557[_0x1f8129(0x232)]['id'],_0x3555aa=dbOrdinaryAlbumTable['getById'](_0x417557[_0x1f8129(0x23f)]['dbFileIndex'],_0x57b135);if(!_0x3555aa)return _0x417557[_0x1f8129(0x23f)][_0x1f8129(0x20b)](_0xcd8b01,_0x1f8129(0x21b));if(_0x3555aa[_0x1f8129(0x227)]==_0x417557['currentUser']['username']||dbUserTable[_0x1f8129(0x224)](_0x417557,_0xcd8b01,_0x1f8129(0x1f7),'power_change')==!![]){let _0x4d4fad=_0x417557[_0x1f8129(0x232)]['name'],_0x2f8792=_0x417557[_0x1f8129(0x232)][_0x1f8129(0x1fd)];_0x2f8792!='1'&&(_0x2f8792='0');let _0x218543=dbOrdinaryAlbumTable[_0x1f8129(0x1fa)](_0x417557[_0x1f8129(0x23f)][_0x1f8129(0x21c)],_0x57b135,_0x4d4fad,_0x2f8792);_0x218543['changes']>0x0?_0xcd8b01['json']({'code':0x0,'result':_0x218543}):_0xcd8b01[_0x1f8129(0x205)]({'code':0x1,'message':_0x1f8129(0x1f9)});}}),router[_0x2c7dda(0x22c)](_0x2c7dda(0x229),(_0x283b59,_0x4985eb,_0x54e3be)=>{const _0x169d18=_0x2c7dda;if(dbUserTable[_0x169d18(0x224)](_0x283b59,_0x4985eb,_0x169d18(0x1f7),'power_get')==!![]){let _0x109274=dbUserTable[_0x169d18(0x203)](_0x283b59,_0x169d18(0x1f7),'power_get',!![]),_0x278f99=_0x283b59[_0x169d18(0x232)][_0x169d18(0x23c)]||0x14,_0x55b519=_0x283b59[_0x169d18(0x232)][_0x169d18(0x222)]||0x0,_0x2719a1=_0x283b59['body'][_0x169d18(0x1fe)]||'id',_0x153c44=_0x283b59[_0x169d18(0x232)][_0x169d18(0x21f)]||'desc',_0x111384=_0x283b59[_0x169d18(0x232)][_0x169d18(0x20f)];(![_0x169d18(0x230),'id'][_0x169d18(0x214)](_0x2719a1)||!['asc',_0x169d18(0x226)]['includes'](_0x153c44))&&_0x4985eb[_0x169d18(0x205)]({'code':0x0,'data':[]});let _0x188cc0=dbOrdinaryAlbumTable[_0x169d18(0x233)](_0x283b59[_0x169d18(0x23f)][_0x169d18(0x21c)],_0x278f99,_0x55b519,_0x2719a1,_0x153c44,_0x111384),_0x4ef9a4=_0x188cc0;if(_0x283b59[_0x169d18(0x231)][_0x169d18(0x225)]!=0x1){_0x4ef9a4=[];for(let _0x57ff0f=0x0;_0x57ff0f<_0x188cc0[_0x169d18(0x20e)];_0x57ff0f++){let _0x42b849=_0x188cc0[_0x57ff0f];(_0x42b849['share']==0x1||_0x42b849[_0x169d18(0x227)]==_0x283b59[_0x169d18(0x231)][_0x169d18(0x227)])&&_0x4ef9a4[_0x169d18(0x22f)](_0x42b849);}}for(let _0x5a9ea9=0x0;_0x5a9ea9<_0x4ef9a4[_0x169d18(0x20e)];_0x5a9ea9++){let _0x152f40='\x20\x20is_file=1\x20';_0x152f40+=_0x109274;let _0x25f102=dbOrdinaryAlbumTable[_0x169d18(0x23e)](_0x283b59[_0x169d18(0x23f)][_0x169d18(0x21c)],_0x169d18(0x220),[_0x4ef9a4[_0x5a9ea9]['id']]);!_0x25f102&&(_0x25f102=dbOrdinaryAlbumTable[_0x169d18(0x23e)](_0x283b59['app'][_0x169d18(0x21c)],_0x169d18(0x207),[_0x4ef9a4[_0x5a9ea9]['id']]));if(_0x25f102){let _0x190662=dbFileIndexTable[_0x169d18(0x217)](_0x283b59[_0x169d18(0x23f)][_0x169d18(0x21c)],_0x25f102[_0x169d18(0x202)]);_0x190662&&_0x190662[_0x169d18(0x216)]!=0x1&&(_0x152f40+='\x20AND\x20id='+_0x25f102['index_id']);}else{_0x4ef9a4[_0x5a9ea9][_0x169d18(0x212)]=[];continue;}_0x152f40+=_0x169d18(0x22d),_0x152f40+=_0x169d18(0x240);let _0x503721=dbFileIndexTable[_0x169d18(0x23a)](_0x283b59[_0x169d18(0x23f)][_0x169d18(0x21c)],_0x152f40);_0x4ef9a4[_0x5a9ea9][_0x169d18(0x212)]=_0x503721;}_0x4985eb['json']({'code':0x0,'data':_0x4ef9a4});}}),router[_0x2c7dda(0x22c)](_0x2c7dda(0x208),(_0x331504,_0x3f3068,_0x2b2739)=>{const _0x1b53a9=_0x2c7dda;if(dbUserTable['doUserCanGet'](_0x331504,_0x3f3068,'photo',_0x1b53a9(0x239))==!![]){let _0x2e17a4=_0x331504[_0x1b53a9(0x232)][_0x1b53a9(0x235)],_0x1697b0=_0x331504[_0x1b53a9(0x232)][_0x1b53a9(0x21a)],_0x9bdc56=dbOrdinaryAlbumTable['getById'](_0x331504[_0x1b53a9(0x23f)][_0x1b53a9(0x21c)],_0x1697b0);if(!_0x9bdc56)return _0x3f3068[_0x1b53a9(0x1fc)](0x194)[_0x1b53a9(0x213)]();let _0x2003b6=0x0;if(_0x2e17a4&&_0x2e17a4[_0x1b53a9(0x20e)]>0x0)for(let _0xb4bdc9=0x0;_0xb4bdc9<_0x2e17a4[_0x1b53a9(0x20e)];_0xb4bdc9++){let _0x1d4b9c=_0x2e17a4[_0xb4bdc9],_0x4f7379=dbFileIndexTable[_0x1b53a9(0x217)](_0x331504[_0x1b53a9(0x23f)]['dbFileIndex'],_0x1d4b9c);if(!_0x4f7379)continue;let _0x321359=dbOrdinaryAlbumTable[_0x1b53a9(0x20d)](_0x331504[_0x1b53a9(0x23f)][_0x1b53a9(0x21c)],{'album_id':_0x1697b0,'index_id':_0x1d4b9c});_0x321359['changes']>0x0&&(_0x2003b6+=0x1);}_0x3f3068['json']({'code':0x0,'sucCount':_0x2003b6});}}),router[_0x2c7dda(0x22c)](_0x2c7dda(0x237),(_0x962eb0,_0x5ac955,_0x41a5d2)=>{const _0x5e18cd=_0x2c7dda;if(dbUserTable[_0x5e18cd(0x224)](_0x962eb0,_0x5ac955,_0x5e18cd(0x1f7),_0x5e18cd(0x23b))==!![]){let _0x4b4781=_0x962eb0[_0x5e18cd(0x232)]['indexIdArr'],_0x23ac83=_0x962eb0[_0x5e18cd(0x232)][_0x5e18cd(0x21a)],_0x224e4a=dbOrdinaryAlbumTable[_0x5e18cd(0x217)](_0x962eb0[_0x5e18cd(0x23f)][_0x5e18cd(0x21c)],_0x23ac83);if(!_0x224e4a)return _0x5ac955[_0x5e18cd(0x205)]({'code':0x1,'message':'album\x20id\x20invalid'});if(_0x4b4781&&_0x4b4781[_0x5e18cd(0x20e)]>0x0){let _0x35203e='(';for(let _0x5aeeaf=0x0;_0x5aeeaf<_0x4b4781[_0x5e18cd(0x20e)];_0x5aeeaf++){let _0x315d2a=_0x4b4781[_0x5aeeaf],_0x3cf949=dbFileIndexTable[_0x5e18cd(0x217)](_0x962eb0[_0x5e18cd(0x23f)][_0x5e18cd(0x21c)],_0x315d2a);if(!_0x3cf949)continue;_0x35203e+=_0x315d2a,_0x5aeeaf!=_0x4b4781[_0x5e18cd(0x20e)]-0x1&&(_0x35203e+=',');}_0x35203e+=')';let _0x49597d=dbOrdinaryAlbumTable[_0x5e18cd(0x20a)](_0x962eb0[_0x5e18cd(0x23f)][_0x5e18cd(0x21c)],_0x23ac83,_0x35203e);_0x5ac955[_0x5e18cd(0x205)]({'code':0x0,'sucCount':_0x49597d['changes']});}else _0x5ac955[_0x5e18cd(0x205)]({'code':0x0,'sucCount':0x0});}}),router[_0x2c7dda(0x22c)]('/setAlbumCover',(_0x1106cf,_0x28b40d,_0x3ac39e)=>{const _0x2743b3=_0x2c7dda;if(dbUserTable[_0x2743b3(0x224)](_0x1106cf,_0x28b40d,_0x2743b3(0x1f7),_0x2743b3(0x1ff))==!![]){let _0x4bdcc2=_0x1106cf[_0x2743b3(0x232)]['indexId'],_0x5889f0=_0x1106cf[_0x2743b3(0x232)][_0x2743b3(0x21a)],_0x3495d4=dbOrdinaryAlbumTable[_0x2743b3(0x217)](_0x1106cf[_0x2743b3(0x23f)][_0x2743b3(0x21c)],_0x5889f0);if(!_0x3495d4)return _0x28b40d[_0x2743b3(0x205)]({'code':0x1,'message':'album\x20id\x20invalid'});let _0x28f5f5=dbFileIndexTable[_0x2743b3(0x217)](_0x1106cf[_0x2743b3(0x23f)][_0x2743b3(0x21c)],_0x4bdcc2);if(!_0x28f5f5)return _0x28b40d['json']({'code':0x1,'message':_0x2743b3(0x228)});return dbOrdinaryAlbumTable[_0x2743b3(0x211)](_0x1106cf[_0x2743b3(0x23f)][_0x2743b3(0x21c)],_0x5889f0,_0x4bdcc2),_0x28b40d[_0x2743b3(0x205)]({'code':0x0});}}),module[_0x2c7dda(0x210)]=router;