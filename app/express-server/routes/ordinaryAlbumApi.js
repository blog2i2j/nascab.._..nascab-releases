const _0x39d543=_0x153d;function _0x153d(_0x5aeb2c,_0x225e23){const _0x3468c3=_0x3468();return _0x153d=function(_0x153d43,_0x565184){_0x153d43=_0x153d43-0x1dd;let _0x32d417=_0x3468c3[_0x153d43];return _0x32d417;},_0x153d(_0x5aeb2c,_0x225e23);}(function(_0x3d8a19,_0x4132cc){const _0x4ec489=_0x153d,_0x1fb9fd=_0x3d8a19();while(!![]){try{const _0x2c1b1c=-parseInt(_0x4ec489(0x221))/0x1*(parseInt(_0x4ec489(0x1e9))/0x2)+-parseInt(_0x4ec489(0x205))/0x3+-parseInt(_0x4ec489(0x1f8))/0x4+-parseInt(_0x4ec489(0x225))/0x5*(parseInt(_0x4ec489(0x214))/0x6)+parseInt(_0x4ec489(0x219))/0x7+parseInt(_0x4ec489(0x224))/0x8+parseInt(_0x4ec489(0x210))/0x9;if(_0x2c1b1c===_0x4132cc)break;else _0x1fb9fd['push'](_0x1fb9fd['shift']());}catch(_0x464e5d){_0x1fb9fd['push'](_0x1fb9fd['shift']());}}}(_0x3468,0x867a7));function _0x3468(){const _0x978a1c=['json','../../db/dbOrdinaryAlbumTable','share','create','orderField','11521152ZivbyY','length','INDEX_TABLE_NAME_PHOTO','express','6kLXnuT','desc','currentUser','/addToAlbum','deleteIndexFromAlbum','3027346LGuLxG','name','getPathAll','getById','dbFileIndex','doUserCanGet','changes','power_add','1rGWzsN','count','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','2957208PUffkL','1522355wmLVBj','/deleteFromAlbum','in_trash','../../db/dbFileIndexTable','udpateCover','getList','end','photo','orderType','albumId','getIndexByWhere','post','../../db/dbUserTable','Router','927224fZiNlA','exports','power_change','includes','imgList','returnErrMsg','getByName','asc','/addAlbum','album.sameNameExist','/setAlbumCover','power_delete','power_get','operation\x20fail','udpateName','829208nwuKfi','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','\x20AND\x20id=','index\x20id\x20invalid','addIndexToAlbum','body','\x20\x20is_file=1\x20','album\x20id\x20invalid','app','status','getUserPathWhere','offset','id\x20not\x20exist','1668147NUYLKa','push','username','parentPath','index_id','/updateAlbum'];_0x3468=function(){return _0x978a1c;};return _0x3468();}var express=require(_0x39d543(0x213)),router=express[_0x39d543(0x1e8)]();const dbFileIndexTable=require(_0x39d543(0x1de)),dbUserTable=require(_0x39d543(0x1e7)),dbOrdinaryAlbumTable=require(_0x39d543(0x20c));router[_0x39d543(0x1e6)](_0x39d543(0x1f1),(_0x5065ca,_0x5035ea,_0x332d0e)=>{const _0x247b9f=_0x39d543;if(dbUserTable[_0x247b9f(0x21e)](_0x5065ca,_0x5035ea,'photo',_0x247b9f(0x220))==!![]){let _0x4eee7e=_0x5065ca[_0x247b9f(0x1fd)][_0x247b9f(0x21a)],_0x5004e2=_0x5065ca[_0x247b9f(0x1fd)][_0x247b9f(0x208)],_0x3f4033=_0x5065ca['body'][_0x247b9f(0x20d)];_0x3f4033!='1'&&(_0x3f4033='0');let _0x138647=dbOrdinaryAlbumTable[_0x247b9f(0x1ef)](_0x5065ca[_0x247b9f(0x200)]['dbFileIndex'],_0x4eee7e);if(_0x138647)return _0x5065ca[_0x247b9f(0x200)][_0x247b9f(0x1ee)](_0x5035ea,_0x5035ea['__'](_0x247b9f(0x1f2)));let _0x11301b=dbOrdinaryAlbumTable[_0x247b9f(0x20e)](_0x5065ca[_0x247b9f(0x200)][_0x247b9f(0x21d)],{'name':_0x4eee7e,'username':_0x5065ca[_0x247b9f(0x216)][_0x247b9f(0x207)],'share':_0x3f4033});if(_0x11301b[_0x247b9f(0x21f)]>0x0){if(_0x5004e2){let _0x2ad1ce=_0x11301b['lastInsertRowid'];if(_0x2ad1ce){let _0x11170b=dbFileIndexTable[_0x247b9f(0x21b)](_0x5065ca[_0x247b9f(0x200)]['dbFileIndex'],_0x5004e2,dbFileIndexTable[_0x247b9f(0x212)],'id');for(let _0x58a830 in _0x11170b){dbOrdinaryAlbumTable[_0x247b9f(0x1fc)](_0x5065ca[_0x247b9f(0x200)]['dbFileIndex'],{'album_id':_0x2ad1ce,'index_id':_0x11170b[_0x58a830]['id']});}}}_0x5035ea['json']({'code':0x0,'result':_0x11301b});}else _0x5035ea[_0x247b9f(0x20b)]({'code':0x1,'message':_0x247b9f(0x1f6)});}}),router['post']('/deleteAlbum',(_0x29dec7,_0x24baf0,_0x328e69)=>{const _0x51ff0b=_0x39d543;let _0x488530=_0x29dec7[_0x51ff0b(0x1fd)]['id'],_0x2aaa07=dbOrdinaryAlbumTable[_0x51ff0b(0x21c)](_0x29dec7['app'][_0x51ff0b(0x21d)],_0x488530);if(!_0x2aaa07)return _0x29dec7[_0x51ff0b(0x200)][_0x51ff0b(0x1ee)](_0x24baf0,_0x51ff0b(0x204));if(_0x2aaa07[_0x51ff0b(0x207)]==_0x29dec7[_0x51ff0b(0x216)][_0x51ff0b(0x207)]||dbUserTable[_0x51ff0b(0x21e)](_0x29dec7,_0x24baf0,_0x51ff0b(0x1e2),_0x51ff0b(0x1f4))==!![]){let _0x10f56f=dbOrdinaryAlbumTable['delete'](_0x29dec7['app']['dbFileIndex'],_0x488530);_0x10f56f['changes']>0x0?_0x24baf0[_0x51ff0b(0x20b)]({'code':0x0,'result':_0x10f56f}):_0x24baf0['json']({'code':0x1,'message':_0x51ff0b(0x1f6)});}}),router[_0x39d543(0x1e6)](_0x39d543(0x20a),(_0x6c82a1,_0x5a2e91,_0x9fc540)=>{const _0x150d85=_0x39d543;let _0x4a04ad=_0x6c82a1[_0x150d85(0x1fd)]['id'],_0x3a99fa=dbOrdinaryAlbumTable[_0x150d85(0x21c)](_0x6c82a1[_0x150d85(0x200)]['dbFileIndex'],_0x4a04ad);if(!_0x3a99fa)return _0x6c82a1[_0x150d85(0x200)][_0x150d85(0x1ee)](_0x5a2e91,_0x150d85(0x204));if(_0x3a99fa[_0x150d85(0x207)]==_0x6c82a1[_0x150d85(0x216)]['username']||dbUserTable['doUserCanGet'](_0x6c82a1,_0x5a2e91,_0x150d85(0x1e2),_0x150d85(0x1eb))==!![]){let _0x245382=_0x6c82a1[_0x150d85(0x1fd)]['name'],_0x31a7d1=_0x6c82a1['body'][_0x150d85(0x20d)];_0x31a7d1!='1'&&(_0x31a7d1='0');let _0x36ac6d=dbOrdinaryAlbumTable[_0x150d85(0x1f7)](_0x6c82a1['app'][_0x150d85(0x21d)],_0x4a04ad,_0x245382,_0x31a7d1);_0x36ac6d[_0x150d85(0x21f)]>0x0?_0x5a2e91[_0x150d85(0x20b)]({'code':0x0,'result':_0x36ac6d}):_0x5a2e91[_0x150d85(0x20b)]({'code':0x1,'message':_0x150d85(0x1f6)});}}),router['post']('/getAllAlbum',(_0xd065ca,_0x497b94,_0x41b3b7)=>{const _0x37f730=_0x39d543;if(dbUserTable[_0x37f730(0x21e)](_0xd065ca,_0x497b94,_0x37f730(0x1e2),_0x37f730(0x1f5))==!![]){let _0x4001bd=dbUserTable[_0x37f730(0x202)](_0xd065ca,'photo',_0x37f730(0x1f5),!![]),_0x329a1d=_0xd065ca[_0x37f730(0x1fd)][_0x37f730(0x222)]||0x14,_0x3a16c9=_0xd065ca[_0x37f730(0x1fd)][_0x37f730(0x203)]||0x0,_0x73f2ce=_0xd065ca[_0x37f730(0x1fd)][_0x37f730(0x20f)]||'id',_0x4b778f=_0xd065ca[_0x37f730(0x1fd)][_0x37f730(0x1e3)]||_0x37f730(0x215),_0x2893ab=_0xd065ca[_0x37f730(0x1fd)]['search'];(![_0x37f730(0x21a),'id']['includes'](_0x73f2ce)||![_0x37f730(0x1f0),_0x37f730(0x215)][_0x37f730(0x1ec)](_0x4b778f))&&_0x497b94[_0x37f730(0x20b)]({'code':0x0,'data':[]});let _0x28261b=dbOrdinaryAlbumTable[_0x37f730(0x1e0)](_0xd065ca['app'][_0x37f730(0x21d)],_0x329a1d,_0x3a16c9,_0x73f2ce,_0x4b778f,_0x2893ab),_0x3fe333=_0x28261b;if(_0xd065ca[_0x37f730(0x216)]['is_admin']!=0x1){_0x3fe333=[];for(let _0x5095b3=0x0;_0x5095b3<_0x28261b['length'];_0x5095b3++){let _0x4920c7=_0x28261b[_0x5095b3];(_0x4920c7[_0x37f730(0x20d)]==0x1||_0x4920c7['username']==_0xd065ca[_0x37f730(0x216)]['username'])&&_0x3fe333[_0x37f730(0x206)](_0x4920c7);}}for(let _0x56632c=0x0;_0x56632c<_0x3fe333[_0x37f730(0x211)];_0x56632c++){let _0x54eb01=_0x37f730(0x1fe);_0x54eb01+=_0x4001bd;let _0x28065d=dbOrdinaryAlbumTable['getIndexByWhere'](_0xd065ca[_0x37f730(0x200)][_0x37f730(0x21d)],'\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201',[_0x3fe333[_0x56632c]['id']]);!_0x28065d&&(_0x28065d=dbOrdinaryAlbumTable[_0x37f730(0x1e5)](_0xd065ca[_0x37f730(0x200)]['dbFileIndex'],_0x37f730(0x1f9),[_0x3fe333[_0x56632c]['id']]));if(_0x28065d){let _0x245669=dbFileIndexTable[_0x37f730(0x21c)](_0xd065ca[_0x37f730(0x200)][_0x37f730(0x21d)],_0x28065d[_0x37f730(0x209)]);_0x245669&&_0x245669[_0x37f730(0x1dd)]!=0x1&&(_0x54eb01+=_0x37f730(0x1fa)+_0x28065d[_0x37f730(0x209)]);}else{_0x3fe333[_0x56632c][_0x37f730(0x1ed)]=[];continue;}_0x54eb01+=_0x37f730(0x223),_0x54eb01+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';let _0x2ca0f0=dbFileIndexTable['getAllByWhere'](_0xd065ca['app']['dbFileIndex'],_0x54eb01);_0x3fe333[_0x56632c][_0x37f730(0x1ed)]=_0x2ca0f0;}_0x497b94[_0x37f730(0x20b)]({'code':0x0,'data':_0x3fe333});}}),router[_0x39d543(0x1e6)](_0x39d543(0x217),(_0x2a87d9,_0xcb9c16,_0x21f5af)=>{const _0x4ec38f=_0x39d543;if(dbUserTable[_0x4ec38f(0x21e)](_0x2a87d9,_0xcb9c16,'photo','power_add')==!![]){let _0x52169f=_0x2a87d9[_0x4ec38f(0x1fd)]['indexIdArr'],_0x13fc9b=_0x2a87d9[_0x4ec38f(0x1fd)][_0x4ec38f(0x1e4)],_0x5df7cb=dbOrdinaryAlbumTable[_0x4ec38f(0x21c)](_0x2a87d9[_0x4ec38f(0x200)][_0x4ec38f(0x21d)],_0x13fc9b);if(!_0x5df7cb)return _0xcb9c16[_0x4ec38f(0x201)](0x194)[_0x4ec38f(0x1e1)]();let _0x31d2f7=0x0;if(_0x52169f&&_0x52169f[_0x4ec38f(0x211)]>0x0)for(let _0x1018d6=0x0;_0x1018d6<_0x52169f[_0x4ec38f(0x211)];_0x1018d6++){let _0x18b4c3=_0x52169f[_0x1018d6],_0x5882ac=dbFileIndexTable['getById'](_0x2a87d9[_0x4ec38f(0x200)]['dbFileIndex'],_0x18b4c3);if(!_0x5882ac)continue;let _0x4347db=dbOrdinaryAlbumTable[_0x4ec38f(0x1fc)](_0x2a87d9[_0x4ec38f(0x200)][_0x4ec38f(0x21d)],{'album_id':_0x13fc9b,'index_id':_0x18b4c3});_0x4347db[_0x4ec38f(0x21f)]>0x0&&(_0x31d2f7+=0x1);}_0xcb9c16[_0x4ec38f(0x20b)]({'code':0x0,'sucCount':_0x31d2f7});}}),router[_0x39d543(0x1e6)](_0x39d543(0x226),(_0x1289ba,_0x5f08ae,_0x418c12)=>{const _0x23a491=_0x39d543;if(dbUserTable['doUserCanGet'](_0x1289ba,_0x5f08ae,'photo',_0x23a491(0x1f4))==!![]){let _0x4ba6ca=_0x1289ba[_0x23a491(0x1fd)]['indexIdArr'],_0x32678d=_0x1289ba[_0x23a491(0x1fd)][_0x23a491(0x1e4)],_0x16eb06=dbOrdinaryAlbumTable[_0x23a491(0x21c)](_0x1289ba['app'][_0x23a491(0x21d)],_0x32678d);if(!_0x16eb06)return _0x5f08ae[_0x23a491(0x20b)]({'code':0x1,'message':_0x23a491(0x1ff)});if(_0x4ba6ca&&_0x4ba6ca[_0x23a491(0x211)]>0x0){let _0x60cfc1='(';for(let _0xf0b0d0=0x0;_0xf0b0d0<_0x4ba6ca[_0x23a491(0x211)];_0xf0b0d0++){let _0x39ba4a=_0x4ba6ca[_0xf0b0d0],_0x1aa4a1=dbFileIndexTable[_0x23a491(0x21c)](_0x1289ba[_0x23a491(0x200)][_0x23a491(0x21d)],_0x39ba4a);if(!_0x1aa4a1)continue;_0x60cfc1+=_0x39ba4a,_0xf0b0d0!=_0x4ba6ca[_0x23a491(0x211)]-0x1&&(_0x60cfc1+=',');}_0x60cfc1+=')';let _0x11a584=dbOrdinaryAlbumTable[_0x23a491(0x218)](_0x1289ba[_0x23a491(0x200)][_0x23a491(0x21d)],_0x32678d,_0x60cfc1);_0x5f08ae[_0x23a491(0x20b)]({'code':0x0,'sucCount':_0x11a584[_0x23a491(0x21f)]});}else _0x5f08ae[_0x23a491(0x20b)]({'code':0x0,'sucCount':0x0});}}),router[_0x39d543(0x1e6)](_0x39d543(0x1f3),(_0x150d73,_0xf19844,_0x59df54)=>{const _0x1e4e2a=_0x39d543;if(dbUserTable[_0x1e4e2a(0x21e)](_0x150d73,_0xf19844,'photo',_0x1e4e2a(0x1eb))==!![]){let _0x183ac4=_0x150d73[_0x1e4e2a(0x1fd)]['indexId'],_0x188f83=_0x150d73['body'][_0x1e4e2a(0x1e4)],_0x38b469=dbOrdinaryAlbumTable[_0x1e4e2a(0x21c)](_0x150d73[_0x1e4e2a(0x200)][_0x1e4e2a(0x21d)],_0x188f83);if(!_0x38b469)return _0xf19844[_0x1e4e2a(0x20b)]({'code':0x1,'message':_0x1e4e2a(0x1ff)});let _0x53cf0b=dbFileIndexTable[_0x1e4e2a(0x21c)](_0x150d73['app']['dbFileIndex'],_0x183ac4);if(!_0x53cf0b)return _0xf19844[_0x1e4e2a(0x20b)]({'code':0x1,'message':_0x1e4e2a(0x1fb)});return dbOrdinaryAlbumTable[_0x1e4e2a(0x1df)](_0x150d73[_0x1e4e2a(0x200)][_0x1e4e2a(0x21d)],_0x188f83,_0x183ac4),_0xf19844[_0x1e4e2a(0x20b)]({'code':0x0});}}),module[_0x39d543(0x1ea)]=router;