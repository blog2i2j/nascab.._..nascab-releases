const _0x248e24=_0xc807;(function(_0x152392,_0x5968be){const _0x4056ea=_0xc807,_0x1770e0=_0x152392();while(!![]){try{const _0x271260=-parseInt(_0x4056ea(0x1fa))/0x1*(-parseInt(_0x4056ea(0x1ca))/0x2)+parseInt(_0x4056ea(0x1ff))/0x3*(-parseInt(_0x4056ea(0x1eb))/0x4)+-parseInt(_0x4056ea(0x1d1))/0x5+parseInt(_0x4056ea(0x1d8))/0x6*(-parseInt(_0x4056ea(0x204))/0x7)+-parseInt(_0x4056ea(0x1d7))/0x8*(parseInt(_0x4056ea(0x209))/0x9)+parseInt(_0x4056ea(0x1ed))/0xa+-parseInt(_0x4056ea(0x1e2))/0xb*(-parseInt(_0x4056ea(0x1f6))/0xc);if(_0x271260===_0x5968be)break;else _0x1770e0['push'](_0x1770e0['shift']());}catch(_0x48ea83){_0x1770e0['push'](_0x1770e0['shift']());}}}(_0x42ee,0xe291b));var express=require('express'),router=express[_0x248e24(0x1c2)]();function _0x42ee(){const _0x571f93=['create','json','217LuHRCd','index\x20id\x20invalid','/addToAlbum','includes','../../db/dbUserTable','9byAQLd','power_delete','getIndexByWhere','deleteIndexFromAlbum','index_id','Router','/setAlbumCover','\x20AND\x20id=','count','orderField','indexId','doUserCanGet','asc','133932VkiDmM','lastInsertRowid','/addAlbum','status','operation\x20fail','photo','desc','7174640VkwlwS','albumId','exports','parentPath','/deleteFromAlbum','dbFileIndex','6277744wEtLOs','47256fumGiT','app','album\x20id\x20invalid','imgList','end','getUserPathWhere','/getAllAlbum','body','id\x20not\x20exist','currentUser','11LpJZVH','../../db/dbFileIndexTable','udpateCover','post','returnErrMsg','is_admin','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','getById','share','2246404NvxtiL','addIndexToAlbum','10968610OULWWE','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','power_get','orderType','username','power_add','getList','indexIdArr','offset','23832132pNHcDj','getByName','\x20\x20is_file=1\x20','INDEX_TABLE_NAME_PHOTO','13xpSaSo','name','power_change','search','changes','3ApYNun','push','length'];_0x42ee=function(){return _0x571f93;};return _0x42ee();}function _0xc807(_0x5f4de2,_0x2ec1a1){const _0x42eef5=_0x42ee();return _0xc807=function(_0xc8070,_0x28f648){_0xc8070=_0xc8070-0x1c1;let _0x546633=_0x42eef5[_0xc8070];return _0x546633;},_0xc807(_0x5f4de2,_0x2ec1a1);}const dbFileIndexTable=require(_0x248e24(0x1e3)),dbUserTable=require(_0x248e24(0x208)),dbOrdinaryAlbumTable=require('../../db/dbOrdinaryAlbumTable');router[_0x248e24(0x1e5)](_0x248e24(0x1cc),(_0x28e409,_0x522ccb,_0x34320e)=>{const _0x5d6c2d=_0x248e24;if(dbUserTable['doUserCanGet'](_0x28e409,_0x522ccb,_0x5d6c2d(0x1cf),_0x5d6c2d(0x1f2))==!![]){let _0xc2b0=_0x28e409[_0x5d6c2d(0x1df)]['name'],_0x538e4d=_0x28e409[_0x5d6c2d(0x1df)][_0x5d6c2d(0x1d4)],_0xc5fd27=_0x28e409[_0x5d6c2d(0x1df)]['share'];_0xc5fd27!='1'&&(_0xc5fd27='0');let _0x412c1b=dbOrdinaryAlbumTable[_0x5d6c2d(0x1f7)](_0x28e409[_0x5d6c2d(0x1d9)][_0x5d6c2d(0x1d6)],_0xc2b0);if(_0x412c1b)return _0x28e409[_0x5d6c2d(0x1d9)][_0x5d6c2d(0x1e6)](_0x522ccb,_0x522ccb['__']('album.sameNameExist'));let _0x19259c=dbOrdinaryAlbumTable[_0x5d6c2d(0x202)](_0x28e409['app'][_0x5d6c2d(0x1d6)],{'name':_0xc2b0,'username':_0x28e409[_0x5d6c2d(0x1e1)][_0x5d6c2d(0x1f1)],'share':_0xc5fd27});if(_0x19259c[_0x5d6c2d(0x1fe)]>0x0){if(_0x538e4d){let _0x1dd08e=_0x19259c[_0x5d6c2d(0x1cb)];if(_0x1dd08e){let _0x49ef99=dbFileIndexTable['getPathAll'](_0x28e409[_0x5d6c2d(0x1d9)][_0x5d6c2d(0x1d6)],_0x538e4d,dbFileIndexTable[_0x5d6c2d(0x1f9)],'id');for(let _0x2b65d4 in _0x49ef99){dbOrdinaryAlbumTable[_0x5d6c2d(0x1ec)](_0x28e409[_0x5d6c2d(0x1d9)]['dbFileIndex'],{'album_id':_0x1dd08e,'index_id':_0x49ef99[_0x2b65d4]['id']});}}}_0x522ccb[_0x5d6c2d(0x203)]({'code':0x0,'result':_0x19259c});}else _0x522ccb[_0x5d6c2d(0x203)]({'code':0x1,'message':'operation\x20fail'});}}),router['post']('/deleteAlbum',(_0x1c6cc0,_0x1d27d7,_0x14ee78)=>{const _0xc05926=_0x248e24;let _0x8655e=_0x1c6cc0[_0xc05926(0x1df)]['id'],_0x2addde=dbOrdinaryAlbumTable[_0xc05926(0x1e9)](_0x1c6cc0[_0xc05926(0x1d9)][_0xc05926(0x1d6)],_0x8655e);if(!_0x2addde)return _0x1c6cc0['app'][_0xc05926(0x1e6)](_0x1d27d7,_0xc05926(0x1e0));if(_0x2addde[_0xc05926(0x1f1)]==_0x1c6cc0[_0xc05926(0x1e1)]['username']||dbUserTable[_0xc05926(0x1c8)](_0x1c6cc0,_0x1d27d7,_0xc05926(0x1cf),_0xc05926(0x20a))==!![]){let _0x4b3244=dbOrdinaryAlbumTable['delete'](_0x1c6cc0['app']['dbFileIndex'],_0x8655e);_0x4b3244[_0xc05926(0x1fe)]>0x0?_0x1d27d7[_0xc05926(0x203)]({'code':0x0,'result':_0x4b3244}):_0x1d27d7[_0xc05926(0x203)]({'code':0x1,'message':_0xc05926(0x1ce)});}}),router[_0x248e24(0x1e5)]('/updateAlbum',(_0xcb82f1,_0x3b749b,_0x30de95)=>{const _0xe76b6=_0x248e24;let _0xc36aac=_0xcb82f1[_0xe76b6(0x1df)]['id'],_0x132c3a=dbOrdinaryAlbumTable[_0xe76b6(0x1e9)](_0xcb82f1[_0xe76b6(0x1d9)][_0xe76b6(0x1d6)],_0xc36aac);if(!_0x132c3a)return _0xcb82f1[_0xe76b6(0x1d9)][_0xe76b6(0x1e6)](_0x3b749b,_0xe76b6(0x1e0));if(_0x132c3a['username']==_0xcb82f1['currentUser'][_0xe76b6(0x1f1)]||dbUserTable[_0xe76b6(0x1c8)](_0xcb82f1,_0x3b749b,_0xe76b6(0x1cf),_0xe76b6(0x1fc))==!![]){let _0x54ea40=_0xcb82f1['body']['name'],_0x5e09d6=_0xcb82f1[_0xe76b6(0x1df)][_0xe76b6(0x1ea)];_0x5e09d6!='1'&&(_0x5e09d6='0');let _0x10d909=dbOrdinaryAlbumTable['udpateName'](_0xcb82f1[_0xe76b6(0x1d9)][_0xe76b6(0x1d6)],_0xc36aac,_0x54ea40,_0x5e09d6);_0x10d909[_0xe76b6(0x1fe)]>0x0?_0x3b749b[_0xe76b6(0x203)]({'code':0x0,'result':_0x10d909}):_0x3b749b[_0xe76b6(0x203)]({'code':0x1,'message':'operation\x20fail'});}}),router[_0x248e24(0x1e5)](_0x248e24(0x1de),(_0x3a8bc0,_0x46ff4d,_0x1fd18a)=>{const _0x4a5537=_0x248e24;if(dbUserTable[_0x4a5537(0x1c8)](_0x3a8bc0,_0x46ff4d,'photo',_0x4a5537(0x1ef))==!![]){let _0x3d405c=dbUserTable[_0x4a5537(0x1dd)](_0x3a8bc0,'photo',_0x4a5537(0x1ef),!![]),_0x2145f9=_0x3a8bc0[_0x4a5537(0x1df)][_0x4a5537(0x1c5)]||0x14,_0x4be43e=_0x3a8bc0['body'][_0x4a5537(0x1f5)]||0x0,_0x1940b5=_0x3a8bc0[_0x4a5537(0x1df)][_0x4a5537(0x1c6)]||'id',_0x5d72f8=_0x3a8bc0[_0x4a5537(0x1df)][_0x4a5537(0x1f0)]||_0x4a5537(0x1d0),_0x25aebc=_0x3a8bc0['body'][_0x4a5537(0x1fd)];(![_0x4a5537(0x1fb),'id'][_0x4a5537(0x207)](_0x1940b5)||![_0x4a5537(0x1c9),_0x4a5537(0x1d0)]['includes'](_0x5d72f8))&&_0x46ff4d[_0x4a5537(0x203)]({'code':0x0,'data':[]});let _0x308f70=dbOrdinaryAlbumTable[_0x4a5537(0x1f3)](_0x3a8bc0[_0x4a5537(0x1d9)][_0x4a5537(0x1d6)],_0x2145f9,_0x4be43e,_0x1940b5,_0x5d72f8,_0x25aebc),_0x198175=_0x308f70;if(_0x3a8bc0[_0x4a5537(0x1e1)][_0x4a5537(0x1e7)]!=0x1){_0x198175=[];for(let _0x22da68=0x0;_0x22da68<_0x308f70[_0x4a5537(0x201)];_0x22da68++){let _0x253e51=_0x308f70[_0x22da68];(_0x253e51[_0x4a5537(0x1ea)]==0x1||_0x253e51[_0x4a5537(0x1f1)]==_0x3a8bc0[_0x4a5537(0x1e1)][_0x4a5537(0x1f1)])&&_0x198175[_0x4a5537(0x200)](_0x253e51);}}for(let _0x41db8a=0x0;_0x41db8a<_0x198175[_0x4a5537(0x201)];_0x41db8a++){let _0x1f7076=_0x4a5537(0x1f8);_0x1f7076+=_0x3d405c;let _0x5cf5ed=dbOrdinaryAlbumTable[_0x4a5537(0x20b)](_0x3a8bc0[_0x4a5537(0x1d9)]['dbFileIndex'],'\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201',[_0x198175[_0x41db8a]['id']]);!_0x5cf5ed&&(_0x5cf5ed=dbOrdinaryAlbumTable[_0x4a5537(0x20b)](_0x3a8bc0['app'][_0x4a5537(0x1d6)],_0x4a5537(0x1ee),[_0x198175[_0x41db8a]['id']]));if(_0x5cf5ed){let _0x2c28a8=dbFileIndexTable['getById'](_0x3a8bc0[_0x4a5537(0x1d9)][_0x4a5537(0x1d6)],_0x5cf5ed['index_id']);_0x2c28a8&&_0x2c28a8['in_trash']!=0x1&&(_0x1f7076+=_0x4a5537(0x1c4)+_0x5cf5ed[_0x4a5537(0x1c1)]);}else{_0x198175[_0x41db8a][_0x4a5537(0x1db)]=[];continue;}_0x1f7076+=_0x4a5537(0x1e8),_0x1f7076+='\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201';let _0xfc82f=dbFileIndexTable['getAllByWhere'](_0x3a8bc0['app'][_0x4a5537(0x1d6)],_0x1f7076);_0x198175[_0x41db8a][_0x4a5537(0x1db)]=_0xfc82f;}_0x46ff4d[_0x4a5537(0x203)]({'code':0x0,'data':_0x198175});}}),router[_0x248e24(0x1e5)](_0x248e24(0x206),(_0x237f02,_0x34783b,_0x26f81e)=>{const _0x3b7598=_0x248e24;if(dbUserTable[_0x3b7598(0x1c8)](_0x237f02,_0x34783b,_0x3b7598(0x1cf),_0x3b7598(0x1f2))==!![]){let _0x30502b=_0x237f02[_0x3b7598(0x1df)][_0x3b7598(0x1f4)],_0x1bc977=_0x237f02[_0x3b7598(0x1df)][_0x3b7598(0x1d2)],_0x45bf82=dbOrdinaryAlbumTable[_0x3b7598(0x1e9)](_0x237f02['app'][_0x3b7598(0x1d6)],_0x1bc977);if(!_0x45bf82)return _0x34783b[_0x3b7598(0x1cd)](0x194)[_0x3b7598(0x1dc)]();let _0x434686=0x0;if(_0x30502b&&_0x30502b[_0x3b7598(0x201)]>0x0)for(let _0x586640=0x0;_0x586640<_0x30502b[_0x3b7598(0x201)];_0x586640++){let _0xc2e762=_0x30502b[_0x586640],_0x5554cb=dbFileIndexTable[_0x3b7598(0x1e9)](_0x237f02[_0x3b7598(0x1d9)][_0x3b7598(0x1d6)],_0xc2e762);if(!_0x5554cb)continue;let _0xfc3a8c=dbOrdinaryAlbumTable['addIndexToAlbum'](_0x237f02[_0x3b7598(0x1d9)][_0x3b7598(0x1d6)],{'album_id':_0x1bc977,'index_id':_0xc2e762});_0xfc3a8c['changes']>0x0&&(_0x434686+=0x1);}_0x34783b[_0x3b7598(0x203)]({'code':0x0,'sucCount':_0x434686});}}),router[_0x248e24(0x1e5)](_0x248e24(0x1d5),(_0x2aaa3b,_0xe72a50,_0x28bb9b)=>{const _0x44333f=_0x248e24;if(dbUserTable[_0x44333f(0x1c8)](_0x2aaa3b,_0xe72a50,_0x44333f(0x1cf),_0x44333f(0x20a))==!![]){let _0x21eb0c=_0x2aaa3b[_0x44333f(0x1df)]['indexIdArr'],_0x5334c6=_0x2aaa3b[_0x44333f(0x1df)]['albumId'],_0x3f08d8=dbOrdinaryAlbumTable[_0x44333f(0x1e9)](_0x2aaa3b[_0x44333f(0x1d9)][_0x44333f(0x1d6)],_0x5334c6);if(!_0x3f08d8)return _0xe72a50[_0x44333f(0x203)]({'code':0x1,'message':'album\x20id\x20invalid'});if(_0x21eb0c&&_0x21eb0c['length']>0x0){let _0x78704f='(';for(let _0x352a37=0x0;_0x352a37<_0x21eb0c[_0x44333f(0x201)];_0x352a37++){let _0x2ec350=_0x21eb0c[_0x352a37],_0x278a04=dbFileIndexTable[_0x44333f(0x1e9)](_0x2aaa3b[_0x44333f(0x1d9)]['dbFileIndex'],_0x2ec350);if(!_0x278a04)continue;_0x78704f+=_0x2ec350,_0x352a37!=_0x21eb0c['length']-0x1&&(_0x78704f+=',');}_0x78704f+=')';let _0x56c393=dbOrdinaryAlbumTable[_0x44333f(0x20c)](_0x2aaa3b['app']['dbFileIndex'],_0x5334c6,_0x78704f);_0xe72a50[_0x44333f(0x203)]({'code':0x0,'sucCount':_0x56c393[_0x44333f(0x1fe)]});}else _0xe72a50[_0x44333f(0x203)]({'code':0x0,'sucCount':0x0});}}),router[_0x248e24(0x1e5)](_0x248e24(0x1c3),(_0xd7d740,_0x1d982f,_0x7cf058)=>{const _0x34a1d6=_0x248e24;if(dbUserTable[_0x34a1d6(0x1c8)](_0xd7d740,_0x1d982f,'photo',_0x34a1d6(0x1fc))==!![]){let _0x561ecf=_0xd7d740[_0x34a1d6(0x1df)][_0x34a1d6(0x1c7)],_0x1be930=_0xd7d740[_0x34a1d6(0x1df)][_0x34a1d6(0x1d2)],_0x3d32b5=dbOrdinaryAlbumTable[_0x34a1d6(0x1e9)](_0xd7d740[_0x34a1d6(0x1d9)][_0x34a1d6(0x1d6)],_0x1be930);if(!_0x3d32b5)return _0x1d982f['json']({'code':0x1,'message':_0x34a1d6(0x1da)});let _0x16ca4d=dbFileIndexTable[_0x34a1d6(0x1e9)](_0xd7d740[_0x34a1d6(0x1d9)][_0x34a1d6(0x1d6)],_0x561ecf);if(!_0x16ca4d)return _0x1d982f[_0x34a1d6(0x203)]({'code':0x1,'message':_0x34a1d6(0x205)});return dbOrdinaryAlbumTable[_0x34a1d6(0x1e4)](_0xd7d740[_0x34a1d6(0x1d9)][_0x34a1d6(0x1d6)],_0x1be930,_0x561ecf),_0x1d982f[_0x34a1d6(0x203)]({'code':0x0});}}),module[_0x248e24(0x1d3)]=router;