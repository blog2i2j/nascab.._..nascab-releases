const _0x32afb4=_0x718a;(function(_0x56f556,_0x24e286){const _0x37c0ab=_0x718a,_0x4ae036=_0x56f556();while(!![]){try{const _0x348e9e=-parseInt(_0x37c0ab(0xc3))/0x1*(parseInt(_0x37c0ab(0xc5))/0x2)+-parseInt(_0x37c0ab(0x8e))/0x3*(parseInt(_0x37c0ab(0x83))/0x4)+-parseInt(_0x37c0ab(0x7b))/0x5*(parseInt(_0x37c0ab(0xa4))/0x6)+-parseInt(_0x37c0ab(0x86))/0x7*(parseInt(_0x37c0ab(0x80))/0x8)+parseInt(_0x37c0ab(0xa3))/0x9+-parseInt(_0x37c0ab(0x91))/0xa*(parseInt(_0x37c0ab(0x87))/0xb)+-parseInt(_0x37c0ab(0xb1))/0xc*(-parseInt(_0x37c0ab(0xbb))/0xd);if(_0x348e9e===_0x24e286)break;else _0x4ae036['push'](_0x4ae036['shift']());}catch(_0x2a3ce0){_0x4ae036['push'](_0x4ae036['shift']());}}}(_0x2120,0x7ff61));var express=require(_0x32afb4(0xbd)),router=express[_0x32afb4(0xb4)]();function _0x2120(){const _0x5db0c6=['3rvdcZN','in_trash','index_id','4363060PQUVFp','\x20album_id=?\x20AND\x20is_cover=1\x20LIMIT\x201','INDEX_TABLE_NAME_PHOTO','/getAllAlbum','getAllByWhere','changes','post','../../db/dbFileIndexTable','\x20AND\x20(type=1\x20or\x20type=2)\x20AND\x20in_trash=0','is_admin','operation\x20fail','push','power_add','power_change','name','getPathAll','/setAlbumCover','album.sameNameExist','8473194rCkjoN','1302JDmcPk','app','power_delete','/deleteFromAlbum','album\x20id\x20invalid','delete','exports','username','\x20album_id=?\x20ORDER\x20BY\x20create_time\x20DESC\x20LIMIT\x201','power_get','\x20ORDER\x20BY\x20original_time\x20DESC\x20LIMIT\x201','albumId','/deleteAlbum','660YKeiiF','\x20\x20is_file=1\x20','id\x20not\x20exist','Router','udpateCover','getUserPathWhere','addIndexToAlbum','getById','/addAlbum','indexId','419614vZBHiF','indexIdArr','express','getIndexByWhere','offset','currentUser','getByName','share','12384JvROxE','../../db/dbUserTable','20xWQmaw','body','asc','doUserCanGet','1285oqSAyc','includes','/addToAlbum','length','orderField','10232lyfIjc','imgList','udpateName','4034676BnpHzE','parentPath','json','721YbCYjN','22rXIBwu','getList','/updateAlbum','returnErrMsg','desc','dbFileIndex','photo'];_0x2120=function(){return _0x5db0c6;};return _0x2120();}function _0x718a(_0xc4f239,_0x21f294){const _0x212065=_0x2120();return _0x718a=function(_0x718af9,_0x5b4273){_0x718af9=_0x718af9-0x7a;let _0x2a678f=_0x212065[_0x718af9];return _0x2a678f;},_0x718a(_0xc4f239,_0x21f294);}const dbFileIndexTable=require(_0x32afb4(0x98)),dbUserTable=require(_0x32afb4(0xc4)),dbOrdinaryAlbumTable=require('../../db/dbOrdinaryAlbumTable');router['post'](_0x32afb4(0xb9),(_0x1bb5ca,_0x26b38c,_0x1a3cb4)=>{const _0x3918c9=_0x32afb4;if(dbUserTable['doUserCanGet'](_0x1bb5ca,_0x26b38c,_0x3918c9(0x8d),_0x3918c9(0x9d))==!![]){let _0x453818=_0x1bb5ca[_0x3918c9(0xc6)][_0x3918c9(0x9f)],_0x5db18c=_0x1bb5ca[_0x3918c9(0xc6)][_0x3918c9(0x84)],_0x156d02=_0x1bb5ca[_0x3918c9(0xc6)][_0x3918c9(0xc2)];_0x156d02!='1'&&(_0x156d02='0');let _0x375901=dbOrdinaryAlbumTable[_0x3918c9(0xc1)](_0x1bb5ca[_0x3918c9(0xa5)][_0x3918c9(0x8c)],_0x453818);if(_0x375901)return _0x1bb5ca[_0x3918c9(0xa5)]['returnErrMsg'](_0x26b38c,_0x26b38c['__'](_0x3918c9(0xa2)));let _0x4b680c=dbOrdinaryAlbumTable['create'](_0x1bb5ca[_0x3918c9(0xa5)][_0x3918c9(0x8c)],{'name':_0x453818,'username':_0x1bb5ca['currentUser'][_0x3918c9(0xab)],'share':_0x156d02});if(_0x4b680c[_0x3918c9(0x96)]>0x0){if(_0x5db18c){let _0x5ab92a=_0x4b680c['lastInsertRowid'];if(_0x5ab92a){let _0x148487=dbFileIndexTable[_0x3918c9(0xa0)](_0x1bb5ca[_0x3918c9(0xa5)]['dbFileIndex'],_0x5db18c,dbFileIndexTable[_0x3918c9(0x93)],'id');for(let _0x37f5de in _0x148487){dbOrdinaryAlbumTable[_0x3918c9(0xb7)](_0x1bb5ca[_0x3918c9(0xa5)][_0x3918c9(0x8c)],{'album_id':_0x5ab92a,'index_id':_0x148487[_0x37f5de]['id']});}}}_0x26b38c[_0x3918c9(0x85)]({'code':0x0,'result':_0x4b680c});}else _0x26b38c[_0x3918c9(0x85)]({'code':0x1,'message':_0x3918c9(0x9b)});}}),router[_0x32afb4(0x97)](_0x32afb4(0xb0),(_0x1ad3d3,_0xb8fff3,_0x273061)=>{const _0x3f9059=_0x32afb4;let _0x2b0f21=_0x1ad3d3[_0x3f9059(0xc6)]['id'],_0x279cc2=dbOrdinaryAlbumTable[_0x3f9059(0xb8)](_0x1ad3d3[_0x3f9059(0xa5)][_0x3f9059(0x8c)],_0x2b0f21);if(!_0x279cc2)return _0x1ad3d3[_0x3f9059(0xa5)][_0x3f9059(0x8a)](_0xb8fff3,_0x3f9059(0xb3));if(_0x279cc2[_0x3f9059(0xab)]==_0x1ad3d3['currentUser'][_0x3f9059(0xab)]||dbUserTable[_0x3f9059(0x7a)](_0x1ad3d3,_0xb8fff3,_0x3f9059(0x8d),'power_delete')==!![]){let _0x4be5a6=dbOrdinaryAlbumTable[_0x3f9059(0xa9)](_0x1ad3d3['app'][_0x3f9059(0x8c)],_0x2b0f21);_0x4be5a6[_0x3f9059(0x96)]>0x0?_0xb8fff3['json']({'code':0x0,'result':_0x4be5a6}):_0xb8fff3[_0x3f9059(0x85)]({'code':0x1,'message':'operation\x20fail'});}}),router[_0x32afb4(0x97)](_0x32afb4(0x89),(_0xbc5889,_0x17f923,_0x8c4576)=>{const _0x1949de=_0x32afb4;let _0x1f187a=_0xbc5889[_0x1949de(0xc6)]['id'],_0x38f736=dbOrdinaryAlbumTable[_0x1949de(0xb8)](_0xbc5889[_0x1949de(0xa5)][_0x1949de(0x8c)],_0x1f187a);if(!_0x38f736)return _0xbc5889['app'][_0x1949de(0x8a)](_0x17f923,'id\x20not\x20exist');if(_0x38f736[_0x1949de(0xab)]==_0xbc5889[_0x1949de(0xc0)][_0x1949de(0xab)]||dbUserTable[_0x1949de(0x7a)](_0xbc5889,_0x17f923,_0x1949de(0x8d),_0x1949de(0x9e))==!![]){let _0x243aea=_0xbc5889[_0x1949de(0xc6)][_0x1949de(0x9f)],_0x3e5dab=_0xbc5889[_0x1949de(0xc6)][_0x1949de(0xc2)];_0x3e5dab!='1'&&(_0x3e5dab='0');let _0x27621e=dbOrdinaryAlbumTable[_0x1949de(0x82)](_0xbc5889['app'][_0x1949de(0x8c)],_0x1f187a,_0x243aea,_0x3e5dab);_0x27621e[_0x1949de(0x96)]>0x0?_0x17f923[_0x1949de(0x85)]({'code':0x0,'result':_0x27621e}):_0x17f923[_0x1949de(0x85)]({'code':0x1,'message':_0x1949de(0x9b)});}}),router[_0x32afb4(0x97)](_0x32afb4(0x94),(_0x2ea080,_0x4a4802,_0x47a928)=>{const _0x167fc8=_0x32afb4;if(dbUserTable['doUserCanGet'](_0x2ea080,_0x4a4802,_0x167fc8(0x8d),_0x167fc8(0xad))==!![]){let _0x280d43=dbUserTable[_0x167fc8(0xb6)](_0x2ea080,'photo','power_get',!![]),_0x13d55b=_0x2ea080[_0x167fc8(0xc6)]['count']||0x14,_0x22eb04=_0x2ea080['body'][_0x167fc8(0xbf)]||0x0,_0x19e9d1=_0x2ea080[_0x167fc8(0xc6)][_0x167fc8(0x7f)]||'id',_0x1efd47=_0x2ea080[_0x167fc8(0xc6)]['orderType']||_0x167fc8(0x8b),_0x28ac6e=_0x2ea080[_0x167fc8(0xc6)]['search'];(!['name','id'][_0x167fc8(0x7c)](_0x19e9d1)||![_0x167fc8(0xc7),_0x167fc8(0x8b)][_0x167fc8(0x7c)](_0x1efd47))&&_0x4a4802[_0x167fc8(0x85)]({'code':0x0,'data':[]});let _0x1a45c1=dbOrdinaryAlbumTable[_0x167fc8(0x88)](_0x2ea080['app'][_0x167fc8(0x8c)],_0x13d55b,_0x22eb04,_0x19e9d1,_0x1efd47,_0x28ac6e),_0x55a891=_0x1a45c1;if(_0x2ea080['currentUser'][_0x167fc8(0x9a)]!=0x1){_0x55a891=[];for(let _0x147321=0x0;_0x147321<_0x1a45c1[_0x167fc8(0x7e)];_0x147321++){let _0x1cc153=_0x1a45c1[_0x147321];(_0x1cc153[_0x167fc8(0xc2)]==0x1||_0x1cc153[_0x167fc8(0xab)]==_0x2ea080[_0x167fc8(0xc0)][_0x167fc8(0xab)])&&_0x55a891[_0x167fc8(0x9c)](_0x1cc153);}}for(let _0x2beb40=0x0;_0x2beb40<_0x55a891[_0x167fc8(0x7e)];_0x2beb40++){let _0x325112=_0x167fc8(0xb2);_0x325112+=_0x280d43;let _0x26dd56=dbOrdinaryAlbumTable[_0x167fc8(0xbe)](_0x2ea080[_0x167fc8(0xa5)][_0x167fc8(0x8c)],_0x167fc8(0x92),[_0x55a891[_0x2beb40]['id']]);!_0x26dd56&&(_0x26dd56=dbOrdinaryAlbumTable[_0x167fc8(0xbe)](_0x2ea080[_0x167fc8(0xa5)][_0x167fc8(0x8c)],_0x167fc8(0xac),[_0x55a891[_0x2beb40]['id']]));if(_0x26dd56){let _0xefaed2=dbFileIndexTable[_0x167fc8(0xb8)](_0x2ea080[_0x167fc8(0xa5)][_0x167fc8(0x8c)],_0x26dd56[_0x167fc8(0x90)]);_0xefaed2&&_0xefaed2[_0x167fc8(0x8f)]!=0x1&&(_0x325112+='\x20AND\x20id='+_0x26dd56['index_id']);}else{_0x55a891[_0x2beb40][_0x167fc8(0x81)]=[];continue;}_0x325112+=_0x167fc8(0x99),_0x325112+=_0x167fc8(0xae);let _0x49fd74=dbFileIndexTable[_0x167fc8(0x95)](_0x2ea080[_0x167fc8(0xa5)][_0x167fc8(0x8c)],_0x325112);_0x55a891[_0x2beb40][_0x167fc8(0x81)]=_0x49fd74;}_0x4a4802[_0x167fc8(0x85)]({'code':0x0,'data':_0x55a891});}}),router[_0x32afb4(0x97)](_0x32afb4(0x7d),(_0x31b158,_0x43dd8a,_0x4a4b78)=>{const _0x289543=_0x32afb4;if(dbUserTable[_0x289543(0x7a)](_0x31b158,_0x43dd8a,_0x289543(0x8d),'power_add')==!![]){let _0x26b929=_0x31b158[_0x289543(0xc6)]['indexIdArr'],_0x464997=_0x31b158['body'][_0x289543(0xaf)],_0x15931b=dbOrdinaryAlbumTable['getById'](_0x31b158[_0x289543(0xa5)][_0x289543(0x8c)],_0x464997);if(!_0x15931b)return _0x43dd8a['status'](0x194)['end']();let _0x3cbbcb=0x0;if(_0x26b929&&_0x26b929[_0x289543(0x7e)]>0x0)for(let _0x57c428=0x0;_0x57c428<_0x26b929[_0x289543(0x7e)];_0x57c428++){let _0xf426e9=_0x26b929[_0x57c428],_0x16034f=dbFileIndexTable[_0x289543(0xb8)](_0x31b158['app']['dbFileIndex'],_0xf426e9);if(!_0x16034f)continue;let _0x14083b=dbOrdinaryAlbumTable['addIndexToAlbum'](_0x31b158[_0x289543(0xa5)][_0x289543(0x8c)],{'album_id':_0x464997,'index_id':_0xf426e9});_0x14083b[_0x289543(0x96)]>0x0&&(_0x3cbbcb+=0x1);}_0x43dd8a[_0x289543(0x85)]({'code':0x0,'sucCount':_0x3cbbcb});}}),router[_0x32afb4(0x97)](_0x32afb4(0xa7),(_0x3a586c,_0x4caa89,_0x359805)=>{const _0x38a46f=_0x32afb4;if(dbUserTable[_0x38a46f(0x7a)](_0x3a586c,_0x4caa89,_0x38a46f(0x8d),_0x38a46f(0xa6))==!![]){let _0x199c33=_0x3a586c[_0x38a46f(0xc6)][_0x38a46f(0xbc)],_0x14cab9=_0x3a586c['body']['albumId'],_0x51bc73=dbOrdinaryAlbumTable[_0x38a46f(0xb8)](_0x3a586c['app'][_0x38a46f(0x8c)],_0x14cab9);if(!_0x51bc73)return _0x4caa89['json']({'code':0x1,'message':_0x38a46f(0xa8)});if(_0x199c33&&_0x199c33[_0x38a46f(0x7e)]>0x0){let _0x3beaa9='(';for(let _0x5ea921=0x0;_0x5ea921<_0x199c33[_0x38a46f(0x7e)];_0x5ea921++){let _0x1a0875=_0x199c33[_0x5ea921],_0x31ec9e=dbFileIndexTable[_0x38a46f(0xb8)](_0x3a586c['app'][_0x38a46f(0x8c)],_0x1a0875);if(!_0x31ec9e)continue;_0x3beaa9+=_0x1a0875,_0x5ea921!=_0x199c33[_0x38a46f(0x7e)]-0x1&&(_0x3beaa9+=',');}_0x3beaa9+=')';let _0xe7a89b=dbOrdinaryAlbumTable['deleteIndexFromAlbum'](_0x3a586c[_0x38a46f(0xa5)]['dbFileIndex'],_0x14cab9,_0x3beaa9);_0x4caa89[_0x38a46f(0x85)]({'code':0x0,'sucCount':_0xe7a89b[_0x38a46f(0x96)]});}else _0x4caa89[_0x38a46f(0x85)]({'code':0x0,'sucCount':0x0});}}),router[_0x32afb4(0x97)](_0x32afb4(0xa1),(_0x50cc4f,_0x5a8ae1,_0x147648)=>{const _0xc87334=_0x32afb4;if(dbUserTable[_0xc87334(0x7a)](_0x50cc4f,_0x5a8ae1,_0xc87334(0x8d),_0xc87334(0x9e))==!![]){let _0x4864b0=_0x50cc4f[_0xc87334(0xc6)][_0xc87334(0xba)],_0x35a85a=_0x50cc4f[_0xc87334(0xc6)][_0xc87334(0xaf)],_0x849c20=dbOrdinaryAlbumTable[_0xc87334(0xb8)](_0x50cc4f[_0xc87334(0xa5)][_0xc87334(0x8c)],_0x35a85a);if(!_0x849c20)return _0x5a8ae1['json']({'code':0x1,'message':_0xc87334(0xa8)});let _0x129cd0=dbFileIndexTable[_0xc87334(0xb8)](_0x50cc4f['app']['dbFileIndex'],_0x4864b0);if(!_0x129cd0)return _0x5a8ae1[_0xc87334(0x85)]({'code':0x1,'message':'index\x20id\x20invalid'});return dbOrdinaryAlbumTable[_0xc87334(0xb5)](_0x50cc4f[_0xc87334(0xa5)][_0xc87334(0x8c)],_0x35a85a,_0x4864b0),_0x5a8ae1[_0xc87334(0x85)]({'code':0x0});}}),module[_0x32afb4(0xaa)]=router;