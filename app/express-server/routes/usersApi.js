function _0x4a73(_0x189af9,_0x228b91){const _0x180908=_0x1809();return _0x4a73=function(_0x4a73cf,_0x49809d){_0x4a73cf=_0x4a73cf-0x1e7;let _0x5b00a2=_0x180908[_0x4a73cf];return _0x5b00a2;},_0x4a73(_0x189af9,_0x228b91);}const _0x176d2c=_0x4a73;(function(_0x270535,_0x33877b){const _0x310ace=_0x4a73,_0x31597c=_0x270535();while(!![]){try{const _0x8906b8=parseInt(_0x310ace(0x28b))/0x1+parseInt(_0x310ace(0x27f))/0x2+parseInt(_0x310ace(0x25a))/0x3+-parseInt(_0x310ace(0x2a3))/0x4*(parseInt(_0x310ace(0x24c))/0x5)+-parseInt(_0x310ace(0x1fc))/0x6+-parseInt(_0x310ace(0x2ba))/0x7+parseInt(_0x310ace(0x2c5))/0x8;if(_0x8906b8===_0x33877b)break;else _0x31597c['push'](_0x31597c['shift']());}catch(_0xc2eec8){_0x31597c['push'](_0x31597c['shift']());}}}(_0x1809,0x830b3));let sha256=require('sha256'),express=require('express'),router=express[_0x176d2c(0x1fe)](),cryptoUtils=require(_0x176d2c(0x2b6)),netUtils=require('../utils/netUtils'),config=require('../../myConfig/config'),pathUtil=require(_0x176d2c(0x2c2)),nasAccountUtil=require(_0x176d2c(0x29c)),checkUtil=require(_0x176d2c(0x2c6));var package=require(_0x176d2c(0x1f7));const OS=require('os'),dbUserTable=require(_0x176d2c(0x290)),dbLoginTable=require(_0x176d2c(0x225)),dbConfigTable=require(_0x176d2c(0x291)),dbNoticeCenterTable=require(_0x176d2c(0x27a)),dbMusicIndexTable=require(_0x176d2c(0x28f)),fileUtil=require(_0x176d2c(0x208)),fs=require('fs'),path=require(_0x176d2c(0x2c2)),dbMovieFavorite=require(_0x176d2c(0x292)),dbMusicFavorite=require(_0x176d2c(0x283));router['post']('/hasAdmin',(_0x4e1f58,_0x264549,_0x17c7b3)=>{const _0x4cb5d8=_0x176d2c;let _0x53edf6=dbUserTable[_0x4cb5d8(0x251)](_0x4e1f58[_0x4cb5d8(0x218)][_0x4cb5d8(0x28c)]),_0x592964=dbConfigTable[_0x4cb5d8(0x1e7)](_0x4e1f58[_0x4cb5d8(0x218)][_0x4cb5d8(0x28c)],_0x4cb5d8(0x2aa));_0x264549[_0x4cb5d8(0x2a6)]({'code':0x0,'hasAdmin':_0x53edf6?'1':'0','customConfig':_0x592964,'hostName':OS['hostname']()});});let banIpList=[];function _0x1809(){const _0x135828=['push','fileShareRestart','end','exist','DELETE\x20FROM\x20music_playlist','asc','/setUserPower','freeVersionSubuserCount','all','\x20offset\x20','83735cdxgQS','hostname','login.adminAdded','log','/registAdmin','getAdmin','DELETE\x20FROM\x20book_list_index','getUserByToken','publicUserName','getUserCount','globalIpList','nasProxyRestart','err','/tokenLogin','1701750oUibYw','/resetPwd','then','body','updateRemarkByUsername','operationFail','DELETE\x20FROM\x20movie_library','DELETE\x20FROM\x20source_folder','/getUserPower','version','DELETE\x20FROM\x20file_index_book','exports','usernameAndPwdCannotBeSame','parse','login.wrongNameOrPwd','/resetPwdInfo','count','findByUsername','dbFileIndex','login.pwdErr','\x20type=\x27','pwdCannotBeChinese','stringify','banTime','usernameTooEasy','DELETE\x20FROM\x20private_space_token','state','login.loginFailAlert','deleteFavoriteByUid','user-agent','SELECT\x20id,username,is_admin,user_remark\x20FROM\x20user\x20','apiServerHttps','../../db/dbNoticeCenterTable','client','getVipInfo','DELETE\x20FROM\x20music_playlist_index','\x20end_timestamp\x20is\x20not\x20null\x20and\x20end_timestamp<','953740PYWrWC','getAllRecordByWhere','isAdmin','DELETE\x20FROM\x20share_temp','../../db/dbMusicFavorite','updateByUsername','deleteUserTokenByWhere','httpsIsRunning','create','DELETE\x20FROM\x20file_record','username\x20error','join','857617ZUjsls','dbOther','encryptString','/getCurrentUserInfo','../../db/dbMusicIndexTable','../../db/dbUserTable','../../db/dbConfigTable','../../db/dbMovieFavorite','returnErrMsg','status','pageSize','cancelUserPathPower','\x20type=?','TokenExpired','/getIpList','DELETE\x20FROM\x20backup_task','\x20id\x20in(SELECT\x20id\x20FROM\x20login_record\x20ORDER\x20BY\x20id\x20LIMIT\x20','../utils/nasAccountUtils','/remarkUser','security.thisIpCannotAddList','/changeQuestion','account.subAccountMax','DELETE\x20FROM\x20file_index_photo','DELETE\x20FROM\x20file_index_music','212TJvvkj','page','DELETE\x20FROM\x20file_index_movie','json','DELETE\x20FROM\x20file_share','includes','DELETE\x20FROM\x20notice_center','(\x27customLogoImage\x27,\x27customLoginTitle\x27,\x27customLoginImage\x27,\x27customHomeBgImage\x27)','/resetSystem','\x20order\x20by\x20id\x20desc\x20limit\x20','DELETE\x20FROM\x20album_ordinary','startsWith','add','getTime','DELETE\x20FROM\x20book_favorite','DELETE\x20FROM\x20config\x20where\x20title\x20in\x20(\x27nasAccountInfo\x27)','Error','ipList','searchKey','../utils/cryptoUtils','changes','post','DELETE\x20FROM\x20login_record','11760aoIXty','path.parentPathExist','/checkIsNasServer','value','password','getRecordCountByWhere','currentUser','passwordKey','path','NodeNasServer','DELETE\x20FROM\x20music_favorite','1383064uIQjPI','../utils/checkUtil','addLoginRecord','DELETE\x20FROM\x20book_list','findByTitleArr','catch','uid','findByTitle','sub_account_num','login.pwdErrCountTooMuch','/changePassword','\x20WHERE\x20username\x20like\x20?\x20or\x20user_remark\x20like\x20?','DELETE\x20FROM\x20file_share_user','orderType','deletePowerByUsername','error','\x20WHERE\x20token\x20=?','sep','test','DELETE\x20FROM\x20photo_faces','../../../package.json','headers','WebDav','answerQuestionCannotBeSame','type','3891564NWAhYk','menuList','Router','desc','server_type','menus','send','ipv4','getIpListCountByWhere','refreshIpList','usernameReg','DELETE\x20FROM\x20play_record','../utils/fileUtils','run','127.0.0.1','decodeBase64','answerNotSeqNumOrChar','DELETE\x20FROM\x20backup_task_msg','DELETE\x20FROM\x20ai_classes','/getAllUser','orderField','DELETE\x20FROM\x20bg_task','delete','updateById','addIpToList','FTP','newPassword','login','app','/setUserMenu','DELETE\x20FROM\x20movie_collection','ipv6','DELETE\x20FROM\x20private_space','answer','username','/addIpToList','question','apiPort','twoStepLogin','splice','dialog','../../db/dbLoginTable','is_admin','checkAnswer','deleteIpByWhere','login.tooManyPwdTestIpBan','DELETE\x20FROM\x20file_operation_record','\x20ORDER\x20BY\x20','remark','ceil','DELETE\x20FROM\x20album_ordinary_index','^[0-9a-zA-Z]*$','/cancelUserPathPower','newQuestion','testCount','prepare','length','Need\x20token','cacheParentPath','DELETE\x20FROM\x20user_token','token','getUserByUserName','query','apiPortHttps','get','need\x20username/menuList','getClientIp','DELETE\x20FROM\x20config','localhost','black'];_0x1809=function(){return _0x135828;};return _0x1809();}router[_0x176d2c(0x2b8)]('/login',(_0x4ecdad,_0x1f23ba,_0x12ab6)=>{const _0x196acf=_0x176d2c;let _0xddc27d=_0x4ecdad[_0x196acf(0x25d)]['username'],_0x478485=_0x4ecdad['body'][_0x196acf(0x2be)];if(!_0xddc27d||!_0x478485)return _0x1f23ba['status'](0x194)['end']();_0x478485=fileUtil[_0x196acf(0x20b)](_0x478485);let _0x118c1f=netUtils[_0x196acf(0x23e)](_0x4ecdad),_0x107d8f=![],_0x5726da=0x1,_0x645164=0x1;if(_0x118c1f!=_0x196acf(0x240)){let _0x3bfe49=dbConfigTable[_0x196acf(0x1ea)](_0x4ecdad[_0x196acf(0x218)][_0x196acf(0x28c)],'ipBan');_0x3bfe49&&(_0x3bfe49=JSON[_0x196acf(0x267)](_0x3bfe49[_0x196acf(0x2bd)]),_0x3bfe49&&(_0x3bfe49['enable']&&(_0x107d8f=!![]),_0x5726da=_0x3bfe49['testCount'],_0x645164=_0x3bfe49[_0x196acf(0x271)]));}cryptoUtils[_0x196acf(0x28d)](config[_0x196acf(0x2c1)],_0x478485)[_0x196acf(0x25c)](_0x5bde02=>{const _0x1655c=_0x196acf;let _0x19f3ca=dbUserTable[_0x1655c(0x217)](_0x4ecdad[_0x1655c(0x218)][_0x1655c(0x28c)],_0xddc27d,_0x5bde02);if(_0x19f3ca){function _0x46ce38(){const _0x2ed688=_0x1655c;if(_0x118c1f!=_0x2ed688(0x240)){let _0x379b0b=dbConfigTable[_0x2ed688(0x1ea)](_0x4ecdad['app'][_0x2ed688(0x28c)],_0x2ed688(0x222));if(_0x379b0b&&_0x379b0b[_0x2ed688(0x2bd)]=='1'){let _0x12035b=_0x4ecdad[_0x2ed688(0x25d)][_0x2ed688(0x21d)];if(_0x12035b){_0x12035b=sha256(_0x12035b);let _0x518e24=dbUserTable[_0x2ed688(0x227)](_0x4ecdad[_0x2ed688(0x218)]['dbOther'],_0xddc27d,_0x12035b);if(!_0x518e24)return _0x4ecdad['app'][_0x2ed688(0x293)](_0x1f23ba,_0x1f23ba['__']('login.answerIsWrong'));}else return _0x1f23ba[_0x2ed688(0x2a6)]({'code':0x2,'question':_0x19f3ca[_0x2ed688(0x220)]});}}dbLoginTable[_0x2ed688(0x2c7)](_0x4ecdad[_0x2ed688(0x218)]['dbOther'],_0x2ed688(0x217),_0xddc27d,_0x118c1f,_0x4ecdad[_0x2ed688(0x25d)]['client'],_0x4ecdad[_0x2ed688(0x1f8)][_0x2ed688(0x277)]);let _0xec5c5=sha256(new Date()[_0x2ed688(0x2b0)]()+_0xddc27d+_0x5bde02);var _0x394616=_0x4ecdad[_0x2ed688(0x1f8)]['user-agent'];return dbUserTable['createToken'](_0x4ecdad[_0x2ed688(0x218)]['dbOther'],_0x19f3ca['id'],_0xec5c5,_0x118c1f,_0x394616),_0x19f3ca['password']='',_0x19f3ca['answer']='',_0x1f23ba[_0x2ed688(0x2a6)]({'code':0x0,'token':_0xec5c5,'user':_0x19f3ca,'version':package[_0x2ed688(0x263)],'reqIp':_0x118c1f});}if(_0x19f3ca['is_admin']!=0x1)nasAccountUtil[_0x1655c(0x27c)](_0x4ecdad['app'][_0x1655c(0x28c)])[_0x1655c(0x25c)](_0x5f26d9=>{const _0x1afbee=_0x1655c;let _0x360938=dbUserTable[_0x1afbee(0x255)](_0x4ecdad['app']['dbOther']);if(!_0x5f26d9){if(_0x360938>parseInt(config[_0x1afbee(0x249)])+0x1)return _0x4ecdad['app'][_0x1afbee(0x293)](_0x1f23ba,_0x1f23ba['__'](_0x1afbee(0x2a0)));return _0x46ce38();}else return _0x5f26d9[_0x1afbee(0x1fb)]<0x2&&_0x5f26d9[_0x1afbee(0x1eb)]&&_0x360938>parseInt(_0x5f26d9[_0x1afbee(0x1eb)])+0x1?_0x4ecdad[_0x1afbee(0x218)]['returnErrMsg'](_0x1f23ba,_0x1f23ba['__'](_0x1afbee(0x2a0))):_0x46ce38();});else return _0x46ce38();}else{if(_0x107d8f){let _0x1bf51b=null;for(let _0x57e9e4 in banIpList){banIpList[_0x57e9e4]['ip']==_0x118c1f&&(_0x1bf51b=banIpList[_0x57e9e4],banIpList[_0x57e9e4][_0x1655c(0x232)]+=0x1);}!_0x1bf51b&&(_0x1bf51b={'ip':_0x118c1f,'testCount':0x1},banIpList[_0x1655c(0x242)](_0x1bf51b));if(_0x1bf51b['testCount']>=_0x5726da){let _0x554384=new Date()[_0x1655c(0x2b0)](),_0x2afa8b=_0x554384+_0x645164*0x3c*0x3e8;dbLoginTable[_0x1655c(0x214)](_0x4ecdad[_0x1655c(0x218)][_0x1655c(0x28c)],_0x1655c(0x241),_0x118c1f,_0x2afa8b,_0x1f23ba['__'](_0x1655c(0x1ec))),_0x4ecdad[_0x1655c(0x218)]['refreshIpList'](),dbNoticeCenterTable['create'](_0x4ecdad['app']['dbOther'],{'title':_0x1f23ba['__'](_0x1655c(0x275)),'level':_0x1655c(0x1f2),'content':_0x1f23ba['__'](_0x1655c(0x229))+('['+_0x118c1f+']')});for(let _0x378c88 in banIpList){banIpList[_0x378c88]['ip']==_0x118c1f&&banIpList[_0x1655c(0x223)](_0x378c88,0x1);}}}return dbLoginTable[_0x1655c(0x2c7)](_0x4ecdad[_0x1655c(0x218)][_0x1655c(0x28c)],_0x1f23ba['__'](_0x1655c(0x268)),_0xddc27d,_0x118c1f,_0x4ecdad['body']['client'],_0x4ecdad['headers'][_0x1655c(0x277)]),_0x4ecdad[_0x1655c(0x218)][_0x1655c(0x293)](_0x1f23ba,_0x1f23ba['__'](_0x1655c(0x268)));}})['catch'](_0x5aec17=>{const _0x4bddc4=_0x196acf;return console[_0x4bddc4(0x24f)](_0x5aec17),_0x4ecdad[_0x4bddc4(0x218)][_0x4bddc4(0x293)](_0x1f23ba,_0x1f23ba['__'](_0x4bddc4(0x25f)));});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x259),(_0x3d4b73,_0x3e8a3e,_0x41b459)=>{const _0x203446=_0x176d2c;let _0x1217a2=netUtils[_0x203446(0x23e)](_0x3d4b73),_0x5aad44=_0x3d4b73['body'][_0x203446(0x238)];if(!_0x5aad44)return _0x3d4b73[_0x203446(0x218)]['returnErrMsg'](_0x3e8a3e,_0x203446(0x235));let _0xa6b77b=dbUserTable[_0x203446(0x253)](_0x3d4b73[_0x203446(0x218)][_0x203446(0x28c)],_0x5aad44);if(!_0xa6b77b)return _0x3d4b73[_0x203446(0x218)]['returnErrMsg'](_0x3e8a3e,_0x3e8a3e['__'](_0x203446(0x298)));return _0xa6b77b[_0x203446(0x2be)]='',_0xa6b77b[_0x203446(0x21d)]='',_0x3e8a3e[_0x203446(0x2a6)]({'code':0x0,'token':_0x5aad44,'user':_0xa6b77b,'reqIp':_0x1217a2});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x2ab),(_0x51fb15,_0x408445,_0x3007b4)=>{const _0x5d4a94=_0x176d2c;let _0x10bae9=_0x51fb15[_0x5d4a94(0x25d)][_0x5d4a94(0x2be)];if(_0x51fb15[_0x5d4a94(0x2c0)]&&_0x51fb15[_0x5d4a94(0x2c0)]['is_admin']!=0x1)return _0x408445['json']({'code':0x66});cryptoUtils[_0x5d4a94(0x28d)](config['passwordKey'],_0x10bae9)[_0x5d4a94(0x25c)](_0x2b953d=>{const _0x254431=_0x5d4a94;if(_0x51fb15[_0x254431(0x2c0)][_0x254431(0x2be)]!=_0x2b953d)return _0x408445[_0x254431(0x2a6)]({'code':0x1,'message':_0x408445['__'](_0x254431(0x26d))});fs['rm'](path[_0x254431(0x28a)](config[_0x254431(0x236)]),{'recursive':!![]},_0x262da7=>{const _0x531999=_0x254431;if(_0x262da7)return _0x408445[_0x531999(0x2a6)]({'code':0x1,'message':_0x531999(0x2b3)});return _0x51fb15[_0x531999(0x218)]['dbOther'][_0x531999(0x233)](_0x531999(0x23f))[_0x531999(0x209)](),_0x51fb15['app'][_0x531999(0x28c)][_0x531999(0x233)]('DELETE\x20FROM\x20album')[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x29a))['run'](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x20d))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)]('DELETE\x20FROM\x20backup_task_record')['run'](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x211))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x2b2))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbOther'][_0x531999(0x233)](_0x531999(0x22a))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)]['prepare'](_0x531999(0x288))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbOther']['prepare'](_0x531999(0x2a7))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbOther'][_0x531999(0x233)](_0x531999(0x1ef))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)]('DELETE\x20FROM\x20login_ip_list')[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x2b9))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x2a9))['run'](),_0x51fb15['app'][_0x531999(0x28c)]['prepare'](_0x531999(0x207))['run'](),_0x51fb15['app'][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x21c))['run'](),_0x51fb15['app'][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x273))[_0x531999(0x209)](),_0x51fb15['app'][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x282))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)]['prepare'](_0x531999(0x261))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbOther'][_0x531999(0x233)]('DELETE\x20FROM\x20user')['run'](),_0x51fb15['app'][_0x531999(0x28c)][_0x531999(0x233)](_0x531999(0x237))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x28c)][_0x531999(0x233)]('DELETE\x20FROM\x20user_power')[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbFileIndex'][_0x531999(0x233)](_0x531999(0x20e))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)]('DELETE\x20FROM\x20ai_classes2index')[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)]['prepare'](_0x531999(0x2ad))['run'](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x22e))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x2a5))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbFileIndex'][_0x531999(0x233)](_0x531999(0x2a1))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x2a2))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x264))[_0x531999(0x209)](),_0x51fb15['app'][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x1f6))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbFileIndex'][_0x531999(0x233)]('DELETE\x20FROM\x20photo_faces2index')[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbFileIndex'][_0x531999(0x233)]('DELETE\x20FROM\x20movie_keys')[_0x531999(0x209)](),_0x51fb15['app'][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x21a))[_0x531999(0x209)](),_0x51fb15['app']['dbFileIndex'][_0x531999(0x233)]('DELETE\x20FROM\x20movie_history')[_0x531999(0x209)](),_0x51fb15['app'][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x260))[_0x531999(0x209)](),_0x51fb15['app']['dbFileIndex'][_0x531999(0x233)]('DELETE\x20FROM\x20photo_phash_similar')[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x2c4))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbFileIndex']['prepare'](_0x531999(0x246))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)]['dbFileIndex'][_0x531999(0x233)](_0x531999(0x27d))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)]['prepare'](_0x531999(0x2b1))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)]['prepare'](_0x531999(0x2c8))[_0x531999(0x209)](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)](_0x531999(0x252))['run'](),_0x51fb15[_0x531999(0x218)][_0x531999(0x26c)][_0x531999(0x233)]('DELETE\x20FROM\x20book_read_record')[_0x531999(0x209)](),process[_0x531999(0x202)]({'type':'fileShareRestart','shareType':_0x531999(0x215)}),process['send']({'type':_0x531999(0x243),'shareType':_0x531999(0x1f9)}),process[_0x531999(0x202)]({'type':_0x531999(0x257)}),process['send']({'type':'createUserFolder'}),_0x408445[_0x531999(0x2a6)]({'code':0x0});});});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x269),(_0xa7e56d,_0x3c6370,_0x1fb5f0)=>{const _0x286304=_0x176d2c;let _0x6878b=netUtils[_0x286304(0x23e)](_0xa7e56d),_0x460e0e=dbUserTable['getAdmin'](_0xa7e56d[_0x286304(0x218)][_0x286304(0x28c)]),_0x21b88b={};_0x6878b==_0x286304(0x240)&&(_0x21b88b[_0x286304(0x21e)]=_0x460e0e[_0x286304(0x21e)]),_0x21b88b[_0x286304(0x220)]=_0x460e0e['question'],_0x3c6370[_0x286304(0x2a6)]({'code':0x0,'data':_0x21b88b});}),router[_0x176d2c(0x24a)](_0x176d2c(0x2bc),(_0x4dfceb,_0x28951a,_0x129ecf)=>{const _0x2f174f=_0x176d2c;let _0x329c4f={'code':0x0,'message':_0x2f174f(0x2c3),'version':package[_0x2f174f(0x263)],'hostName':OS[_0x2f174f(0x24d)]()},_0x4e68e8=_0x4dfceb[_0x2f174f(0x23a)]['ignoreIp'];if(_0x4e68e8&&_0x4e68e8==0x1)return _0x28951a['json'](_0x329c4f);let _0x168f75=0x50,_0x3e9fbf=dbConfigTable[_0x2f174f(0x1ea)](_0x4dfceb[_0x2f174f(0x218)][_0x2f174f(0x28c)],_0x2f174f(0x221));_0x3e9fbf&&_0x3e9fbf[_0x2f174f(0x2bd)]&&(_0x168f75=_0x3e9fbf[_0x2f174f(0x2bd)]);let _0x43827e=0x1bb,_0x4f9f67=dbConfigTable[_0x2f174f(0x1ea)](_0x4dfceb[_0x2f174f(0x218)]['dbOther'],_0x2f174f(0x23b));_0x4f9f67&&_0x4f9f67[_0x2f174f(0x2bd)]&&_0x4f9f67[_0x2f174f(0x2bd)]>0x0&&_0x4f9f67['value']<0xffff&&(_0x43827e=_0x4f9f67[_0x2f174f(0x2bd)]);let _0x13ca89=0x0,_0x582b0a=dbConfigTable[_0x2f174f(0x1ea)](_0x4dfceb[_0x2f174f(0x218)]['dbOther'],_0x2f174f(0x279));if(_0x582b0a&&_0x582b0a[_0x2f174f(0x2bd)])try{_0x582b0a=JSON[_0x2f174f(0x267)](_0x582b0a[_0x2f174f(0x2bd)]),_0x582b0a[_0x2f174f(0x274)]==_0x2f174f(0x209)&&(_0x13ca89=0x1);}catch(_0x2d61fa){}try{let _0x588595=dbConfigTable[_0x2f174f(0x1ea)](_0x4dfceb['app'][_0x2f174f(0x28c)],_0x2f174f(0x256)),_0x34ee82=dbConfigTable[_0x2f174f(0x1ea)](_0x4dfceb[_0x2f174f(0x218)][_0x2f174f(0x28c)],'ddnsIpv6Address');if(_0x588595){_0x588595=JSON[_0x2f174f(0x267)](_0x588595['value']);let _0x4bd797=[];if(_0x34ee82&&_0x34ee82[_0x2f174f(0x2bd)]){for(let _0x1317f0 in _0x588595){let _0x8fc67d=_0x588595[_0x1317f0];_0x8fc67d[_0x2f174f(0x1fb)]==_0x2f174f(0x203)&&_0x4bd797[_0x2f174f(0x242)](_0x8fc67d);}_0x4bd797[_0x2f174f(0x242)]({'type':_0x2f174f(0x21b),'ip':_0x34ee82[_0x2f174f(0x2bd)],'ddns':0x1}),_0x588595=_0x4bd797;}}return _0x329c4f[_0x2f174f(0x2b4)]=_0x588595,_0x329c4f[_0x2f174f(0x221)]=parseInt(_0x168f75),_0x329c4f['apiPortHttps']=parseInt(_0x43827e),_0x329c4f[_0x2f174f(0x286)]=_0x13ca89,_0x28951a[_0x2f174f(0x2a6)](_0x329c4f);}catch(_0x4ace68){return _0x28951a[_0x2f174f(0x2a6)](_0x329c4f);}}),router[_0x176d2c(0x2b8)](_0x176d2c(0x25b),(_0x3fa97d,_0xe86c08,_0x351d95)=>{const _0x2a8f78=_0x176d2c;let _0xbe81ae=_0x3fa97d[_0x2a8f78(0x25d)]['username'],_0x13facf=_0x3fa97d[_0x2a8f78(0x25d)]['password'],_0x49e88a=_0x3fa97d[_0x2a8f78(0x25d)][_0x2a8f78(0x21d)],_0x104fd7=_0x3fa97d[_0x2a8f78(0x218)][_0x2a8f78(0x28c)][_0x2a8f78(0x233)]('SELECT\x20*\x20FROM\x20user\x20WHERE\x20username=?')[_0x2a8f78(0x23c)](_0xbe81ae);if(!_0x104fd7)return _0x3fa97d[_0x2a8f78(0x218)][_0x2a8f78(0x293)](_0xe86c08,_0xe86c08['__']('userNotExist'));try{_0x49e88a=sha256(_0x49e88a);let _0x5e488c=dbUserTable[_0x2a8f78(0x227)](_0x3fa97d[_0x2a8f78(0x218)][_0x2a8f78(0x28c)],_0xbe81ae,_0x49e88a);if(_0x5e488c)cryptoUtils[_0x2a8f78(0x28d)](config[_0x2a8f78(0x2c1)],_0x13facf)[_0x2a8f78(0x25c)](_0x1f1474=>{const _0x3cbc74=_0x2a8f78;dbUserTable[_0x3cbc74(0x284)](_0x3fa97d[_0x3cbc74(0x218)]['dbOther'],_0xbe81ae,'password',_0x1f1474);let _0x588bf6=sha256(new Date()[_0x3cbc74(0x2b0)]()+_0xbe81ae+_0x13facf);dbUserTable['updateByUsername'](_0x3fa97d['app'][_0x3cbc74(0x28c)],_0xbe81ae,'token',_0x588bf6),_0xe86c08[_0x3cbc74(0x2a6)]({'code':0x0});})['catch'](_0x1da2a0=>{const _0x52dcef=_0x2a8f78;return console[_0x52dcef(0x24f)](_0x52dcef(0x1f2),_0x1da2a0),_0x3fa97d[_0x52dcef(0x218)]['returnErrMsg'](_0xe86c08,_0xe86c08['__'](_0x52dcef(0x25f)));});else return _0x3fa97d[_0x2a8f78(0x218)]['returnErrMsg'](_0xe86c08,_0xe86c08['__']('login.answerIsWrong'));}catch(_0x29f03f){return console['log'](_0x2a8f78(0x258),_0x29f03f),_0xe86c08[_0x2a8f78(0x294)](0x194)[_0x2a8f78(0x244)]();}});function newUserCheck(_0x5e4262,_0x55d711,_0x25a1a5,_0x12d8cc,_0x563b60,_0x49455e){const _0xdd3e01=_0x176d2c;if(!_0x12d8cc||!_0x25a1a5||!_0x5e4262||!_0x55d711)return _0x563b60[_0xdd3e01(0x218)][_0xdd3e01(0x293)](_0x49455e,_0x49455e['__']('newUserParamsNull'));let _0x216f53=new RegExp(_0xdd3e01(0x22f));if(!_0x216f53[_0xdd3e01(0x1f5)](_0x5e4262)||_0x5e4262==config[_0xdd3e01(0x254)])return _0x563b60[_0xdd3e01(0x218)][_0xdd3e01(0x293)](_0x49455e,_0x49455e['__'](_0xdd3e01(0x206)));if(_0x5e4262==_0x55d711)return _0x563b60[_0xdd3e01(0x218)][_0xdd3e01(0x293)](_0x49455e,_0x49455e['__'](_0xdd3e01(0x266)));if(checkUtil['isEasyUsername'](_0x5e4262))return _0x563b60['app'][_0xdd3e01(0x293)](_0x49455e,_0x49455e['__'](_0xdd3e01(0x272)));if(_0x25a1a5==_0x12d8cc)return _0x563b60[_0xdd3e01(0x218)][_0xdd3e01(0x293)](_0x49455e,_0x49455e['__']('answerQuestionCannotBeSame'));if(checkUtil['isIncludeChinese'](_0x55d711))return _0x563b60[_0xdd3e01(0x218)]['returnErrMsg'](_0x49455e,_0x49455e['__'](_0xdd3e01(0x26f)));return!![];}router[_0x176d2c(0x2b8)](_0x176d2c(0x250),(_0x4ba940,_0x1872d6,_0x361883)=>{const _0x157c2d=_0x176d2c;let _0x3c3bcb=_0x4ba940[_0x157c2d(0x25d)]['username'],_0x1a3265=_0x4ba940['body'][_0x157c2d(0x2be)],_0x52ec8e=_0x4ba940[_0x157c2d(0x25d)]['question'],_0xad8622=_0x4ba940[_0x157c2d(0x25d)][_0x157c2d(0x21d)];if(!_0xad8622||!_0x52ec8e||!_0x3c3bcb||!_0x1a3265)return _0x1872d6[_0x157c2d(0x2a6)]({'code':0x1,'message':'params\x20error'});let _0x30587f=dbUserTable[_0x157c2d(0x251)](_0x4ba940[_0x157c2d(0x218)][_0x157c2d(0x28c)]);if(_0x30587f)_0x1872d6['json']({'code':0x1,'message':_0x1872d6['__']('login.adminExist')});else{if(newUserCheck(_0x3c3bcb,_0x1a3265,_0x52ec8e,_0xad8622,_0x4ba940,_0x1872d6)!==!![])return;_0xad8622=sha256(_0xad8622),cryptoUtils[_0x157c2d(0x28d)](config[_0x157c2d(0x2c1)],_0x1a3265)[_0x157c2d(0x25c)](_0x485636=>{const _0x54a1a7=_0x157c2d;let _0x2d395f=dbUserTable[_0x54a1a7(0x287)](_0x4ba940[_0x54a1a7(0x218)]['dbOther'],{'username':_0x3c3bcb,'password':_0x485636,'question':_0x52ec8e,'answer':_0xad8622,'is_admin':0x1});if(_0x2d395f[_0x54a1a7(0x2b7)]>0x0){let _0x539b11=dbUserTable['getAdmin'](_0x4ba940[_0x54a1a7(0x218)][_0x54a1a7(0x28c)]),_0x38f4ee=sha256(new Date()['getTime']()+_0x3c3bcb+_0x485636),_0x2dba0f=netUtils[_0x54a1a7(0x23e)](_0x4ba940);var _0x35be94=_0x4ba940[_0x54a1a7(0x1f8)][_0x54a1a7(0x277)];return dbUserTable['createToken'](_0x4ba940['app'][_0x54a1a7(0x28c)],_0x539b11['id'],_0x38f4ee,_0x2dba0f,_0x35be94),_0x539b11[_0x54a1a7(0x2be)]='',_0x1872d6[_0x54a1a7(0x2a6)]({'code':0x0,'token':_0x38f4ee,'user':_0x539b11});}})[_0x157c2d(0x1e8)](_0x257cb7=>{const _0x9a4f19=_0x157c2d;return console['log'](_0x9a4f19(0x1f2),_0x257cb7),_0x4ba940['app']['returnErrMsg'](_0x1872d6,_0x1872d6['__']('operationFail'));});}}),router['post'](_0x176d2c(0x29d),(_0x22af4b,_0x5d0839,_0x3b3ad3)=>{const _0x70ea1b=_0x176d2c;if(_0x22af4b['currentUser'][_0x70ea1b(0x226)]!=0x1)return _0x5d0839[_0x70ea1b(0x2a6)]({'code':0x66});let _0x2f41f0=_0x22af4b['body'][_0x70ea1b(0x21e)],_0x599aed=_0x22af4b[_0x70ea1b(0x25d)][_0x70ea1b(0x22c)];return _0x2f41f0&&_0x599aed&&dbUserTable[_0x70ea1b(0x25e)](_0x22af4b[_0x70ea1b(0x218)][_0x70ea1b(0x28c)],_0x2f41f0,_0x599aed),_0x5d0839[_0x70ea1b(0x2a6)]({'code':0x0});}),router['post']('/addUser',(_0xa923ae,_0x1ca304,_0x11d549)=>{const _0x58d80f=_0x176d2c;nasAccountUtil[_0x58d80f(0x27c)](_0xa923ae[_0x58d80f(0x218)][_0x58d80f(0x28c)])['then'](_0x49be01=>{const _0x2f9ed0=_0x58d80f;let _0x46c654=dbUserTable[_0x2f9ed0(0x255)](_0xa923ae[_0x2f9ed0(0x218)][_0x2f9ed0(0x28c)]);if(!_0x49be01){if(_0x46c654>=parseInt(config[_0x2f9ed0(0x249)])+0x1){let _0x1146e6=dbUserTable[_0x2f9ed0(0x239)](_0xa923ae['app'][_0x2f9ed0(0x28c)],_0xa923ae[_0x2f9ed0(0x25d)][_0x2f9ed0(0x21e)]);if(!_0x1146e6)return _0xa923ae[_0x2f9ed0(0x218)][_0x2f9ed0(0x293)](_0x1ca304,_0x1ca304['__'](_0x2f9ed0(0x2a0)));}_0x19c31e();}else{if(_0x49be01[_0x2f9ed0(0x1fb)]<0x2&&_0x49be01['sub_account_num']&&_0x46c654>=parseInt(_0x49be01[_0x2f9ed0(0x1eb)])+0x1)return _0xa923ae[_0x2f9ed0(0x218)][_0x2f9ed0(0x293)](_0x1ca304,_0x1ca304['__']('account.subAccountMax'));else _0x19c31e();}function _0x19c31e(){const _0x3b0445=_0x2f9ed0;let _0x3b2948=_0xa923ae['body'][_0x3b0445(0x21e)],_0x26d985=_0xa923ae[_0x3b0445(0x25d)]['password'],_0x4a737c=_0xa923ae[_0x3b0445(0x25d)][_0x3b0445(0x220)],_0xc574be=_0xa923ae['body'][_0x3b0445(0x21d)],_0x2815ae=_0xa923ae[_0x3b0445(0x25d)][_0x3b0445(0x22c)];if(newUserCheck(_0x3b2948,_0x26d985,_0x4a737c,_0xc574be,_0xa923ae,_0x1ca304)!==!![])return;let _0x5e46fc=_0xa923ae[_0x3b0445(0x25d)][_0x3b0445(0x1fb)];if(dbUserTable[_0x3b0445(0x281)](_0xa923ae,_0x1ca304)===!![]){if(_0x5e46fc==_0x3b0445(0x2af)){let _0x578090=dbUserTable[_0x3b0445(0x26b)](_0xa923ae[_0x3b0445(0x218)]['dbOther'],_0x3b2948);if(_0x578090)return _0xa923ae[_0x3b0445(0x218)][_0x3b0445(0x293)](_0x1ca304,_0x1ca304['__']('login.sameUsernameExist'));}cryptoUtils[_0x3b0445(0x28d)](config['passwordKey'],_0x26d985)[_0x3b0445(0x25c)](_0x3587b7=>{const _0x209009=_0x3b0445;let _0x37242c=dbUserTable['create'](_0xa923ae['app'][_0x209009(0x28c)],{'username':_0x3b2948,'password':_0x3587b7,'question':_0x4a737c,'answer':sha256(_0xc574be),'remark':_0x2815ae});return _0x37242c[_0x209009(0x2b7)]>=0x1?_0x1ca304[_0x209009(0x2a6)]({'code':0x0}):_0xa923ae['app']['returnErrMsg'](_0x1ca304,_0x1ca304['__'](_0x209009(0x25f)));})[_0x3b0445(0x1e8)](_0x546176=>{const _0x4617d4=_0x3b0445;return console[_0x4617d4(0x24f)](_0x4617d4(0x1f2),_0x546176),_0xa923ae[_0x4617d4(0x218)]['returnErrMsg'](_0x1ca304,_0x1ca304['__']('operationFail'));});}}});}),router['post']('/removeUser',(_0x4dd4f2,_0x2641b6,_0x48a313)=>{const _0x20fbf0=_0x176d2c;let _0x2b8df2=_0x4dd4f2[_0x20fbf0(0x25d)][_0x20fbf0(0x1e9)];if(dbUserTable[_0x20fbf0(0x281)](_0x4dd4f2,_0x2641b6)===!![]){let _0x21f372=dbUserTable['find'](_0x4dd4f2[_0x20fbf0(0x218)][_0x20fbf0(0x28c)],_0x2b8df2);if(_0x21f372&&_0x21f372[_0x20fbf0(0x226)]==0x1)return _0x2641b6[_0x20fbf0(0x2a6)]({'code':0x1,'message':'You\x20can\x27t\x20delete\x20admin\x20account'});dbUserTable[_0x20fbf0(0x1f1)](_0x4dd4f2[_0x20fbf0(0x218)][_0x20fbf0(0x28c)],_0x21f372[_0x20fbf0(0x21e)]),dbMusicIndexTable['removeUserPlayList'](_0x4dd4f2[_0x20fbf0(0x218)][_0x20fbf0(0x26c)],_0x21f372['id']),dbMusicFavorite[_0x20fbf0(0x276)](_0x4dd4f2['app'][_0x20fbf0(0x26c)],_0x21f372['id']),dbMovieFavorite[_0x20fbf0(0x276)](_0x4dd4f2[_0x20fbf0(0x218)][_0x20fbf0(0x26c)],_0x21f372['id']);let _0x195380=dbUserTable[_0x20fbf0(0x212)](_0x4dd4f2[_0x20fbf0(0x218)][_0x20fbf0(0x28c)],_0x2b8df2);return _0x195380['changes']>=0x1?_0x2641b6[_0x20fbf0(0x2a6)]({'code':0x0}):_0x4dd4f2[_0x20fbf0(0x218)][_0x20fbf0(0x293)](_0x2641b6,_0x2641b6['__']('operationFail'));}}),router[_0x176d2c(0x2b8)](_0x176d2c(0x20f),(_0x244a2d,_0xfaec6,_0x33b00)=>{const _0x3d9132=_0x176d2c;if(dbUserTable[_0x3d9132(0x281)](_0x244a2d,_0xfaec6)===!![]){let _0x43a269=_0x244a2d[_0x3d9132(0x25d)][_0x3d9132(0x210)]||'id',_0x2be46f=_0x244a2d[_0x3d9132(0x25d)][_0x3d9132(0x1f0)]||_0x3d9132(0x247),_0x472eb9=_0x244a2d[_0x3d9132(0x25d)][_0x3d9132(0x2b5)];(!['id',_0x3d9132(0x21e),'user_remark'][_0x3d9132(0x2a8)](_0x43a269)||![_0x3d9132(0x247),_0x3d9132(0x1ff)]['includes'](_0x2be46f))&&(_0x43a269='id',_0x2be46f=_0x3d9132(0x247));let _0x5795cd=_0x3d9132(0x278),_0x558ef5=[];_0x472eb9&&(_0x5795cd+=_0x3d9132(0x1ee),_0x558ef5[_0x3d9132(0x242)]('%'+_0x472eb9+'%','%'+_0x472eb9+'%'));_0x5795cd+=_0x3d9132(0x22b)+_0x43a269+'\x20'+_0x2be46f;let _0x436950=_0x244a2d[_0x3d9132(0x218)][_0x3d9132(0x28c)][_0x3d9132(0x233)](_0x5795cd)['all'](_0x558ef5);return _0xfaec6['json']({'code':0x0,'userList':_0x436950});}}),router[_0x176d2c(0x2b8)](_0x176d2c(0x262),(_0x370f5a,_0x3d8c59,_0x3c35a4)=>{const _0x2f97be=_0x176d2c;let _0xe17378=_0x370f5a[_0x2f97be(0x25d)][_0x2f97be(0x21e)],_0x238175=null;if(_0xe17378!=config['publicUserName']){_0x238175=dbUserTable[_0x2f97be(0x239)](_0x370f5a['app'][_0x2f97be(0x28c)],_0xe17378);if(!_0x238175)return _0x370f5a['app'][_0x2f97be(0x293)](_0x3d8c59,_0x2f97be(0x289));}if(dbUserTable[_0x2f97be(0x281)](_0x370f5a,_0x3d8c59)===!![]||_0xe17378==_0x370f5a[_0x2f97be(0x2c0)][_0x2f97be(0x21e)]){let _0x3331a2=dbUserTable['getUserPower'](_0x370f5a['app']['dbOther'],_0xe17378,null,null,!![]),_0x410509=0x0;if(_0x3331a2['length']<0x1)return _0x3d8c59[_0x2f97be(0x2a6)]({'code':0x0,'userPower':_0x3331a2,'userMenu':_0x238175?_0x238175[_0x2f97be(0x201)]:[]});for(let _0x10962c=0x0;_0x10962c<_0x3331a2['length'];_0x10962c++){let _0xcac79d=_0x3331a2[_0x10962c][_0x2f97be(0x2c2)];fs['stat'](_0xcac79d,(_0x1a4199,_0x5cab9e)=>{const _0x494152=_0x2f97be;_0x410509+=0x1;_0x1a4199?_0x3331a2[_0x10962c]['exist']=0x0:_0x3331a2[_0x10962c][_0x494152(0x245)]=0x1;if(_0x410509==_0x3331a2[_0x494152(0x234)])return _0x3d8c59['json']({'code':0x0,'userPower':_0x3331a2,'userMenu':_0x238175?_0x238175['menus']:[]});});}}}),router[_0x176d2c(0x2b8)](_0x176d2c(0x248),(_0x1fa04f,_0x2e9789,_0x4d1616)=>{const _0x28de49=_0x176d2c;let _0x5d4f2d=_0x1fa04f[_0x28de49(0x25d)][_0x28de49(0x21e)],_0x5d36c5=_0x1fa04f['body']['path'],_0x2cbff0=_0x1fa04f[_0x28de49(0x25d)][_0x28de49(0x200)];if(!_0x5d4f2d||!_0x5d36c5||!_0x2cbff0)return _0x1fa04f[_0x28de49(0x218)][_0x28de49(0x293)](_0x2e9789,_0x2e9789['__'](_0x28de49(0x25f)));let _0x5ca573=null;if(_0x5d4f2d!=config['publicUserName']){_0x5ca573=dbUserTable[_0x28de49(0x239)](_0x1fa04f[_0x28de49(0x218)][_0x28de49(0x28c)],_0x5d4f2d);if(!_0x5ca573)return _0x1fa04f[_0x28de49(0x218)]['returnErrMsg'](_0x2e9789,_0x28de49(0x289));}_0x5d36c5=pathUtil[_0x28de49(0x28a)](_0x5d36c5);if(dbUserTable[_0x28de49(0x281)](_0x1fa04f,_0x2e9789)===!![]){let _0x29a8bc=dbUserTable['getUserPower'](_0x1fa04f[_0x28de49(0x218)][_0x28de49(0x28c)],_0x5d4f2d,_0x2cbff0,null,!![]);for(let _0x368a48 of _0x29a8bc){let _0x5b5788=_0x368a48[_0x28de49(0x2c2)];if(_0x5d36c5[_0x28de49(0x2ae)](pathUtil['join'](_0x5b5788,pathUtil[_0x28de49(0x1f4)]))&&_0x5d36c5!=_0x5b5788)return _0x1fa04f[_0x28de49(0x218)][_0x28de49(0x293)](_0x2e9789,_0x2e9789['__'](_0x28de49(0x2bb))+_0x5b5788,_0x28de49(0x224));if(_0x5b5788[_0x28de49(0x2ae)](pathUtil[_0x28de49(0x28a)](_0x5d36c5,pathUtil['sep']))&&_0x5d36c5!=_0x5b5788)return _0x1fa04f[_0x28de49(0x218)][_0x28de49(0x293)](_0x2e9789,_0x2e9789['__'](_0x28de49(0x2bb))+_0x5b5788,_0x28de49(0x224));}let _0x53b0d8=dbUserTable['createOrUpdatePower'](_0x1fa04f[_0x28de49(0x218)][_0x28de49(0x28c)],_0x1fa04f[_0x28de49(0x25d)]);return _0x2e9789[_0x28de49(0x2a6)]({'code':0x0,'result':_0x53b0d8});}}),router[_0x176d2c(0x2b8)](_0x176d2c(0x219),(_0x3ad6a0,_0x40630d,_0x629e54)=>{const _0xcb17c5=_0x176d2c;let _0x107a6c=_0x3ad6a0[_0xcb17c5(0x25d)][_0xcb17c5(0x21e)],_0x4dbd28=_0x3ad6a0[_0xcb17c5(0x25d)][_0xcb17c5(0x1fd)];if(!_0x107a6c||!(_0x4dbd28 instanceof Array))return _0x3ad6a0[_0xcb17c5(0x218)][_0xcb17c5(0x293)](_0x40630d,_0xcb17c5(0x23d));let _0xeab355=dbUserTable['getUserByUserName'](_0x3ad6a0['app'][_0xcb17c5(0x28c)],_0x107a6c);if(!_0xeab355)return _0x3ad6a0[_0xcb17c5(0x218)][_0xcb17c5(0x293)](_0x40630d,_0xcb17c5(0x289));if(dbUserTable[_0xcb17c5(0x281)](_0x3ad6a0,_0x40630d)===!![])return dbUserTable[_0xcb17c5(0x284)](_0x3ad6a0[_0xcb17c5(0x218)][_0xcb17c5(0x28c)],_0x107a6c,'menus',JSON[_0xcb17c5(0x270)](_0x4dbd28)),_0x40630d[_0xcb17c5(0x2a6)]({'code':0x0});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x230),(_0xd1fcff,_0x18ec51,_0x5e5a1a)=>{const _0x1546ec=_0x176d2c;let _0x492560=dbUserTable[_0x1546ec(0x296)](_0xd1fcff[_0x1546ec(0x218)]['dbOther'],_0xd1fcff[_0x1546ec(0x25d)]);return _0x492560['changes']>0x0?_0x18ec51['json']({'code':0x0}):_0xd1fcff[_0x1546ec(0x218)]['returnErrMsg'](_0x18ec51,_0x18ec51['__']('operationFail'));}),router[_0x176d2c(0x2b8)](_0x176d2c(0x1ed),(_0x2511fa,_0x1a4353,_0x5ca53f)=>{const _0x3892d5=_0x176d2c;let _0x50bd25=_0x2511fa[_0x3892d5(0x25d)]['oldPassword'],_0xd6f426=_0x2511fa['body'][_0x3892d5(0x216)];cryptoUtils[_0x3892d5(0x28d)](config[_0x3892d5(0x2c1)],_0x50bd25)[_0x3892d5(0x25c)](_0x5d345e=>{const _0x20a52a=_0x3892d5;if(_0x2511fa['currentUser'][_0x20a52a(0x2be)]!=_0x5d345e)return _0x1a4353[_0x20a52a(0x2a6)]({'code':0x2,'message':_0x1a4353['__']('login.oldPwdErr')});else cryptoUtils[_0x20a52a(0x28d)](config[_0x20a52a(0x2c1)],_0xd6f426)['then'](_0x5684e1=>{const _0xa796d9=_0x20a52a;dbUserTable[_0xa796d9(0x213)](_0x2511fa[_0xa796d9(0x218)][_0xa796d9(0x28c)],_0x2511fa[_0xa796d9(0x2c0)]['id'],_0xa796d9(0x2be),_0x5684e1);let _0x34c11c=sha256(new Date()['getTime']()+_0x2511fa[_0xa796d9(0x2c0)][_0xa796d9(0x21e)]+_0x2511fa['currentUser'][_0xa796d9(0x2be)]);dbUserTable['updateById'](_0x2511fa['app']['dbOther'],_0x2511fa['currentUser']['id'],_0xa796d9(0x238),_0x34c11c);let _0x31d7d5=netUtils['getClientIp'](_0x2511fa);return dbLoginTable[_0xa796d9(0x2c7)](_0x2511fa[_0xa796d9(0x218)][_0xa796d9(0x28c)],'changePassword',_0x2511fa[_0xa796d9(0x2c0)]['id'],_0x31d7d5,_0x2511fa[_0xa796d9(0x25d)][_0xa796d9(0x27b)],''),_0x1a4353[_0xa796d9(0x2a6)]({'code':0x0});})[_0x20a52a(0x1e8)](_0x167144=>{const _0x46e60a=_0x20a52a;return console[_0x46e60a(0x24f)](_0x46e60a(0x1f2),_0x167144),_0x2511fa[_0x46e60a(0x218)][_0x46e60a(0x293)](_0x1a4353,_0x1a4353['__']('operationFail'));});});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x29f),(_0x11b3a5,_0x29e537,_0x344313)=>{const _0x20346e=_0x176d2c;let _0x39d223=_0x11b3a5[_0x20346e(0x25d)][_0x20346e(0x231)],_0x52f625=_0x11b3a5[_0x20346e(0x25d)]['answer'];if(checkUtil['isSameStr'](_0x52f625))return _0x11b3a5[_0x20346e(0x218)][_0x20346e(0x293)](_0x29e537,_0x29e537['__'](_0x20346e(0x20c)));if(_0x39d223==_0x52f625)return _0x11b3a5[_0x20346e(0x218)][_0x20346e(0x293)](_0x29e537,_0x29e537['__'](_0x20346e(0x1fa)));return dbUserTable['updateQuestionById'](_0x11b3a5[_0x20346e(0x218)][_0x20346e(0x28c)],_0x11b3a5['currentUser']['id'],_0x39d223,sha256(_0x52f625)),_0x29e537[_0x20346e(0x2a6)]({'code':0x0});}),router[_0x176d2c(0x2b8)]('/logout',(_0x300372,_0x1ae278,_0x59d4dd)=>{const _0x24fd64=_0x176d2c;let _0x265926=_0x300372[_0x24fd64(0x25d)][_0x24fd64(0x238)];return _0x265926&&dbUserTable[_0x24fd64(0x285)](_0x300372['app'][_0x24fd64(0x28c)],_0x24fd64(0x1f3),[_0x265926]),_0x1ae278['json']({'code':0x0});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x28e),(_0x6ba1b7,_0x4ce641,_0x456046)=>{const _0x8df6da=_0x176d2c;let _0x21e427=dbUserTable['find'](_0x6ba1b7[_0x8df6da(0x218)][_0x8df6da(0x28c)],_0x6ba1b7[_0x8df6da(0x2c0)]['id']);return _0x21e427?(_0x21e427[_0x8df6da(0x2be)]='',_0x21e427[_0x8df6da(0x21d)]='',_0x4ce641['json']({'code':0x0,'userInfo':_0x21e427})):_0x4ce641[_0x8df6da(0x2a6)]({'code':0x65});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x21f),(_0x484c87,_0x23fd23,_0x393f9f)=>{const _0x15ccb9=_0x176d2c;if(_0x484c87['currentUser'][_0x15ccb9(0x226)]!=0x1)return _0x23fd23[_0x15ccb9(0x2a6)]({'code':0x66});let _0x86a016=_0x484c87[_0x15ccb9(0x25d)]['ip'];if(_0x86a016==_0x15ccb9(0x240)||_0x86a016==_0x15ccb9(0x20a))return _0x484c87[_0x15ccb9(0x218)][_0x15ccb9(0x293)](_0x23fd23,_0x23fd23['__'](_0x15ccb9(0x29e)));let _0x7ab374=_0x484c87['body'][_0x15ccb9(0x1fb)],_0x59d510=_0x484c87[_0x15ccb9(0x25d)]['banTimeStamp'];return dbLoginTable['addIpToList'](_0x484c87['app']['dbOther'],_0x7ab374,_0x86a016,_0x59d510,_0x23fd23['__'](_0x15ccb9(0x24e))),_0x484c87[_0x15ccb9(0x218)][_0x15ccb9(0x205)](),_0x23fd23[_0x15ccb9(0x2a6)]({'code':0x0});}),router[_0x176d2c(0x2b8)]('/removeIp',(_0x20e521,_0x5291c4,_0x1b43e9)=>{const _0x12640e=_0x176d2c;if(_0x20e521[_0x12640e(0x2c0)]['is_admin']!=0x1)return _0x5291c4[_0x12640e(0x2a6)]({'code':0x66});let _0x1c3963=_0x20e521['body']['id'];return dbLoginTable['deleteIp'](_0x20e521[_0x12640e(0x218)][_0x12640e(0x28c)],_0x1c3963),_0x20e521[_0x12640e(0x218)][_0x12640e(0x205)](),_0x5291c4[_0x12640e(0x2a6)]({'code':0x0});}),router[_0x176d2c(0x2b8)](_0x176d2c(0x299),(_0x195750,_0x389967,_0x52b88f)=>{const _0x498682=_0x176d2c;let _0x4eeb0b=_0x195750[_0x498682(0x25d)][_0x498682(0x2a4)],_0x5a4638=_0x195750[_0x498682(0x25d)][_0x498682(0x295)],_0x4cab72=_0x195750['body'][_0x498682(0x1fb)],_0x4d76d1=new Date()[_0x498682(0x2b0)]();dbLoginTable[_0x498682(0x228)](_0x195750[_0x498682(0x218)][_0x498682(0x28c)],_0x498682(0x27e)+_0x4d76d1);let _0x58097b=_0x498682(0x26e)+_0x4cab72+'\x27',_0x28cab1=dbLoginTable[_0x498682(0x204)](_0x195750[_0x498682(0x218)][_0x498682(0x28c)],_0x58097b),_0x4f9b8a=(_0x4eeb0b-0x1)*_0x5a4638;_0x58097b+=_0x498682(0x2ac)+_0x5a4638+_0x498682(0x24b)+_0x4f9b8a;let _0x1cf538=dbLoginTable['getAllIpListByWhere'](_0x195750[_0x498682(0x218)][_0x498682(0x28c)],_0x58097b);return _0x389967[_0x498682(0x2a6)]({'code':0x0,'data':_0x1cf538,'pageCount':Math[_0x498682(0x22d)](_0x28cab1[_0x498682(0x26a)]/_0x5a4638)});}),router[_0x176d2c(0x2b8)]('/getRecordList',(_0x46335e,_0x1e5853,_0x50e014)=>{const _0x32939a=_0x176d2c;if(_0x46335e['currentUser'][_0x32939a(0x226)]!=0x1)return _0x1e5853[_0x32939a(0x2a6)]({'code':0x66});let _0x615a99=0x1388,_0x410eb8=_0x46335e[_0x32939a(0x25d)][_0x32939a(0x2a4)],_0x563544=_0x46335e[_0x32939a(0x25d)][_0x32939a(0x295)],_0x4ff260=_0x46335e['body']['type'],_0x38ceef='',_0x2a5a1f=[];_0x4ff260?(_0x38ceef+=_0x32939a(0x297),_0x2a5a1f[_0x32939a(0x242)](_0x4ff260)):_0x38ceef='\x201=1';let _0x68987a=dbLoginTable[_0x32939a(0x2bf)](_0x46335e[_0x32939a(0x218)][_0x32939a(0x28c)],_0x38ceef,_0x2a5a1f)['count'];if(_0x68987a>_0x615a99){let _0x2e02d1=0x64,_0x192896=dbLoginTable['deleteRecordByWhere'](_0x46335e[_0x32939a(0x218)][_0x32939a(0x28c)],_0x32939a(0x29b)+_0x2e02d1+')');_0x192896['changes']>0x0&&(_0x68987a=_0x68987a-_0x192896[_0x32939a(0x2b7)]);}let _0x2f3f2e=(_0x410eb8-0x1)*_0x563544;_0x38ceef+='\x20order\x20by\x20id\x20desc\x20limit\x20?\x20offset\x20?',_0x2a5a1f[_0x32939a(0x242)](_0x563544),_0x2a5a1f[_0x32939a(0x242)](_0x2f3f2e);let _0x3669ef=dbLoginTable[_0x32939a(0x280)](_0x46335e[_0x32939a(0x218)][_0x32939a(0x28c)],_0x38ceef,_0x2a5a1f);return _0x1e5853['json']({'code':0x0,'data':_0x3669ef,'pageCount':Math[_0x32939a(0x22d)](_0x68987a/_0x563544)});}),module[_0x176d2c(0x265)]=router;