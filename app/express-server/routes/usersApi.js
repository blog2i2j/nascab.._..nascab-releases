const _0x2a3f88=_0x4381;function _0x4c44(){const _0x5f4968=['login.tooManyPwdTestIpBan','\x20WHERE\x20token\x20=?','DELETE\x20FROM\x20backup_task','username','DELETE\x20FROM\x20file_index_photo','isIncludeChinese','DELETE\x20FROM\x20file_share_user','operationFail','find','status','count','../../db/dbMovieFavorite','1401340SboQHt','\x20offset\x20','getClientIp','35TrGsbT','335464YFQTsM','oldPassword','dbFileIndex','apiPort','newUserParamsNull','checkAnswer','removeUserPlayList','add','../../db/dbLoginTable','DELETE\x20FROM\x20config','menuList','password','login.answerIsWrong','apiPortHttps','updateById','/getAllUser','sep','DELETE\x20FROM\x20book_read_record','/hasAdmin','get','DELETE\x20FROM\x20album','findByTitle','DELETE\x20FROM\x20music_playlist_index','\x201=1','/resetSystem','login.loginFailAlert','changes','/resetPwd','publicUserName','DELETE\x20FROM\x20book_list_index','client','push','fileShareRestart','decodeBase64','currentUser','../utils/nasAccountUtils','DELETE\x20FROM\x20file_share','user-agent','\x20order\x20by\x20id\x20desc\x20limit\x20','all','DELETE\x20FROM\x20album_ordinary','/getCurrentUserInfo','getUserCount','DELETE\x20FROM\x20file_operation_record','DELETE\x20FROM\x20movie_keys','question','ipv6','getAdmin','login','../utils/netUtils','DELETE\x20FROM\x20bg_task','DELETE\x20FROM\x20user_token','getAllIpListByWhere','DELETE\x20FROM\x20ai_classes2index','769050xjUwGT','createToken','DELETE\x20FROM\x20user','is_admin','\x20ORDER\x20BY\x20','banTime','httpsIsRunning','updateRemarkByUsername','DELETE\x20FROM\x20private_space_token','end','DELETE\x20FROM\x20config\x20where\x20title\x20in\x20(\x27nasAccountInfo\x27)','then','path.parentPathExist','searchKey','You\x20can\x27t\x20delete\x20admin\x20account','1181025vIVNJv','FTP','type','usernameTooEasy','login.pwdErr','localhost','DELETE\x20FROM\x20share_temp','isSameStr','security.thisIpCannotAddList','length','/remarkUser','uid','/logout','page','twoStepLogin','asc','DELETE\x20FROM\x20file_index_music','DELETE\x20FROM\x20ai_classes','DELETE\x20FROM\x20album_ordinary_index','/tokenLogin','newPassword','json','body','ddnsIpv6Address','login.adminAdded','/removeUser','findByUsername','createUserFolder','login.sameUsernameExist','../utils/cryptoUtils','create','usernameReg','value','server_type','1368633agVNRO','DELETE\x20FROM\x20play_record','getTime','ipv4','login.oldPwdErr','Error','2248752DnbShO','returnErrMsg','region','userNotExist','/registAdmin','/changeQuestion','DELETE\x20FROM\x20photo_faces2index','../../db/dbNoticeCenterTable','headers','../../myConfig/config','hostname','stat','getAllRecordByWhere','testCount','updateByUsername','addIpToList','../../../package.json','language','error','ignoreIp','sha256','path','\x20order\x20by\x20id\x20desc\x20limit\x20?\x20offset\x20?','pageSize','DELETE\x20FROM\x20notice_center','nasProxyRestart','DELETE\x20FROM\x20user_power','isEasyUsername','log','dialog','DELETE\x20FROM\x20login_record','refreshIpList','token','DELETE\x20FROM\x20music_playlist','/login','\x20WHERE\x20username\x20like\x20?\x20or\x20user_remark\x20like\x20?','version','/changePassword','includes','banTimeStamp','findByTitleArr','login.adminExist','/setUserMenu','deleteIp','/getUserPower','deleteIpByWhere','deleteUserTokenByWhere','prepare','parse','newQuestion','send','ceil','DELETE\x20FROM\x20movie_collection','../utils/checkUtil','createOrUpdatePower','deleteFavoriteByUid','\x20type=?','need\x20username/menuList','DELETE\x20FROM\x20music_favorite','err','remark','\x20id\x20in(SELECT\x20id\x20FROM\x20login_record\x20ORDER\x20BY\x20id\x20LIMIT\x20','WebDav','DELETE\x20FROM\x20backup_task_msg','2410YFaqpT','usernameAndPwdCannotBeSame','^[0-9a-zA-Z]*$','updateQuestionById','3auVYem','run','pwdCannotBeChinese','DELETE\x20FROM\x20source_folder','splice','answer','menus','DELETE\x20FROM\x20movie_library','exist','deleteRecordByWhere','dbOther','cancelUserPathPower','\x20end_timestamp\x20is\x20not\x20null\x20and\x20end_timestamp<','isAdmin','passwordKey','../../db/dbMusicFavorite','account.subAccountMax','app','express','getUserByUserName','addLoginRecord','post','catch','SELECT\x20id,username,is_admin,user_remark\x20FROM\x20user\x20','Router','params\x20error','login.wrongNameOrPwd','61524OodSib','desc','/cancelUserPathPower','encryptString','ipBan','sub_account_num','enable','join','black','test','deletePowerByUsername','ipList','../../db/dbUserTable','getVipInfo','/getIpList','getIpListCountByWhere'];_0x4c44=function(){return _0x5f4968;};return _0x4c44();}(function(_0x1e7a1b,_0x4734fb){const _0x5d6dcc=_0x4381,_0x4534fb=_0x1e7a1b();while(!![]){try{const _0x293ad6=-parseInt(_0x5d6dcc(0x20d))/0x1+parseInt(_0x5d6dcc(0x1a2))/0x2+parseInt(_0x5d6dcc(0x16b))/0x3*(-parseInt(_0x5d6dcc(0x213))/0x4)+-parseInt(_0x5d6dcc(0x1eb))/0x5+-parseInt(_0x5d6dcc(0x1dc))/0x6*(-parseInt(_0x5d6dcc(0x1a5))/0x7)+parseInt(_0x5d6dcc(0x1a6))/0x8+parseInt(_0x5d6dcc(0x186))/0x9*(parseInt(_0x5d6dcc(0x167))/0xa);if(_0x293ad6===_0x4734fb)break;else _0x4534fb['push'](_0x4534fb['shift']());}catch(_0x160bfd){_0x4534fb['push'](_0x4534fb['shift']());}}}(_0x4c44,0xd2eb8));let sha256=require(_0x2a3f88(0x227)),express=require(_0x2a3f88(0x17d)),router=express[_0x2a3f88(0x183)](),cryptoUtils=require(_0x2a3f88(0x208)),netUtils=require(_0x2a3f88(0x1d7)),config=require(_0x2a3f88(0x21c)),pathUtil=require('path'),nasAccountUtil=require(_0x2a3f88(0x1c9)),checkUtil=require(_0x2a3f88(0x15c));var package=require(_0x2a3f88(0x223));const OS=require('os'),dbUserTable=require(_0x2a3f88(0x192)),dbLoginTable=require(_0x2a3f88(0x1ae)),dbConfigTable=require('../../db/dbConfigTable'),dbNoticeCenterTable=require(_0x2a3f88(0x21a)),dbMusicIndexTable=require('../../db/dbMusicIndexTable'),fileUtil=require('../utils/fileUtils'),fs=require('fs'),path=require(_0x2a3f88(0x228)),dbMovieFavorite=require(_0x2a3f88(0x1a1)),dbMusicFavorite=require(_0x2a3f88(0x17a));router[_0x2a3f88(0x180)](_0x2a3f88(0x1b8),(_0x1a4e3b,_0x312eaf,_0x2c7d37)=>{const _0x44d1e9=_0x2a3f88;let _0x1d8ee8=dbUserTable[_0x44d1e9(0x1d5)](_0x1a4e3b['app'][_0x44d1e9(0x175)]),_0x5aa061=dbConfigTable[_0x44d1e9(0x14f)](_0x1a4e3b[_0x44d1e9(0x17c)]['dbOther'],'(\x27customLogoImage\x27,\x27customLoginTitle\x27,\x27customLoginImage\x27,\x27customHomeBgImage\x27)');_0x312eaf[_0x44d1e9(0x200)]({'code':0x0,'hasAdmin':_0x1d8ee8?'1':'0','customConfig':_0x5aa061,'hostName':OS[_0x44d1e9(0x21d)]()});});function _0x4381(_0x1bc884,_0x335425){const _0x4c4429=_0x4c44();return _0x4381=function(_0x438155,_0x3a26b5){_0x438155=_0x438155-0x142;let _0x33bace=_0x4c4429[_0x438155];return _0x33bace;},_0x4381(_0x1bc884,_0x335425);}let banIpList=[];router[_0x2a3f88(0x180)](_0x2a3f88(0x149),(_0x49296f,_0x4ef68b,_0x43eca9)=>{const _0x447e0b=_0x2a3f88;let _0xb516be=_0x49296f[_0x447e0b(0x201)]['username'],_0x1f6fed=_0x49296f['body'][_0x447e0b(0x1b1)];if(!_0xb516be||!_0x1f6fed)return _0x4ef68b[_0x447e0b(0x19f)](0x194)[_0x447e0b(0x1e5)]();_0x1f6fed=fileUtil[_0x447e0b(0x1c7)](_0x1f6fed);let _0x1c904f=netUtils[_0x447e0b(0x1a4)](_0x49296f),_0x523a2c=![],_0x5f2f95=0x1,_0x6f671b=0x1;if(_0x1c904f!=_0x447e0b(0x1f0)){let _0x563c40=dbConfigTable[_0x447e0b(0x1bb)](_0x49296f[_0x447e0b(0x17c)][_0x447e0b(0x175)],_0x447e0b(0x18a));_0x563c40&&(_0x563c40=JSON[_0x447e0b(0x157)](_0x563c40['value']),_0x563c40&&(_0x563c40[_0x447e0b(0x18c)]&&(_0x523a2c=!![]),_0x5f2f95=_0x563c40[_0x447e0b(0x220)],_0x6f671b=_0x563c40[_0x447e0b(0x1e1)]));}cryptoUtils[_0x447e0b(0x189)](config[_0x447e0b(0x179)],_0x1f6fed)[_0x447e0b(0x1e7)](_0x5ac9b5=>{const _0x55b45b=_0x447e0b;let _0x1fc45b=dbUserTable['login'](_0x49296f[_0x55b45b(0x17c)][_0x55b45b(0x175)],_0xb516be,_0x5ac9b5);if(_0x1fc45b){function _0x49e10f(){const _0xd40c4b=_0x55b45b;if(_0x1c904f!=_0xd40c4b(0x1f0)){let _0x4b2a6b=dbConfigTable['findByTitle'](_0x49296f[_0xd40c4b(0x17c)][_0xd40c4b(0x175)],_0xd40c4b(0x1f9));if(_0x4b2a6b&&_0x4b2a6b[_0xd40c4b(0x20b)]=='1'){let _0x272f43=_0x49296f[_0xd40c4b(0x201)]['answer'];if(_0x272f43){_0x272f43=sha256(_0x272f43);let _0x37dde9=dbUserTable[_0xd40c4b(0x1ab)](_0x49296f[_0xd40c4b(0x17c)][_0xd40c4b(0x175)],_0xb516be,_0x272f43);if(!_0x37dde9)return _0x49296f[_0xd40c4b(0x17c)][_0xd40c4b(0x214)](_0x4ef68b,_0x4ef68b['__'](_0xd40c4b(0x1b2)));}else return _0x4ef68b[_0xd40c4b(0x200)]({'code':0x2,'question':_0x1fc45b['question']});}}dbLoginTable[_0xd40c4b(0x17f)](_0x49296f['app'][_0xd40c4b(0x175)],_0xd40c4b(0x1d6),_0xb516be,_0x1c904f,_0x49296f['body'][_0xd40c4b(0x1c4)],_0x49296f[_0xd40c4b(0x21b)][_0xd40c4b(0x1cb)]);let _0x4488b2=sha256(new Date()[_0xd40c4b(0x20f)]()+_0xb516be+_0x5ac9b5);var _0x2ec191=_0x49296f[_0xd40c4b(0x21b)][_0xd40c4b(0x1cb)];return dbUserTable['createToken'](_0x49296f[_0xd40c4b(0x17c)]['dbOther'],_0x1fc45b['id'],_0x4488b2,_0x1c904f,_0x2ec191),_0x1fc45b[_0xd40c4b(0x1b1)]='',_0x1fc45b[_0xd40c4b(0x170)]='',_0x4ef68b[_0xd40c4b(0x200)]({'code':0x0,'token':_0x4488b2,'user':_0x1fc45b,'version':package[_0xd40c4b(0x14b)],'reqIp':_0x1c904f});}if(_0x1fc45b[_0x55b45b(0x1df)]!=0x1)nasAccountUtil[_0x55b45b(0x193)](_0x49296f['app'][_0x55b45b(0x175)])[_0x55b45b(0x1e7)](_0x242408=>{const _0x4427e0=_0x55b45b;let _0x927947=dbUserTable[_0x4427e0(0x1d0)](_0x49296f[_0x4427e0(0x17c)][_0x4427e0(0x175)]);if(!_0x242408){if(_0x927947>parseInt(config['freeVersionSubuserCount'])+0x1)return _0x49296f[_0x4427e0(0x17c)][_0x4427e0(0x214)](_0x4ef68b,_0x4ef68b['__'](_0x4427e0(0x17b)));return _0x49e10f();}else return _0x242408['type']<0x2&&_0x242408[_0x4427e0(0x18b)]&&_0x927947>parseInt(_0x242408['sub_account_num'])+0x1?_0x49296f[_0x4427e0(0x17c)][_0x4427e0(0x214)](_0x4ef68b,_0x4ef68b['__']('account.subAccountMax')):_0x49e10f();});else return _0x49e10f();}else{if(_0x523a2c){let _0x56bb08=null;for(let _0x4bf2be in banIpList){banIpList[_0x4bf2be]['ip']==_0x1c904f&&(_0x56bb08=banIpList[_0x4bf2be],banIpList[_0x4bf2be][_0x55b45b(0x220)]+=0x1);}!_0x56bb08&&(_0x56bb08={'ip':_0x1c904f,'testCount':0x1},banIpList[_0x55b45b(0x1c5)](_0x56bb08));if(_0x56bb08[_0x55b45b(0x220)]>=_0x5f2f95){let _0x577c1e=new Date()[_0x55b45b(0x20f)](),_0x5ddf7f=_0x577c1e+_0x6f671b*0x3c*0x3e8;dbLoginTable[_0x55b45b(0x222)](_0x49296f[_0x55b45b(0x17c)][_0x55b45b(0x175)],_0x55b45b(0x18e),_0x1c904f,_0x5ddf7f,_0x4ef68b['__']('login.pwdErrCountTooMuch')),_0x49296f[_0x55b45b(0x17c)][_0x55b45b(0x146)](),dbNoticeCenterTable['create'](_0x49296f['app'][_0x55b45b(0x175)],{'title':_0x4ef68b['__'](_0x55b45b(0x1bf)),'level':'error','content':_0x4ef68b['__'](_0x55b45b(0x196))+('['+_0x1c904f+']')});for(let _0x1c2eae in banIpList){banIpList[_0x1c2eae]['ip']==_0x1c904f&&banIpList[_0x55b45b(0x16f)](_0x1c2eae,0x1);}}}return dbLoginTable[_0x55b45b(0x17f)](_0x49296f[_0x55b45b(0x17c)][_0x55b45b(0x175)],_0x4ef68b['__'](_0x55b45b(0x185)),_0xb516be,_0x1c904f,_0x49296f['body'][_0x55b45b(0x1c4)],_0x49296f['headers']['user-agent']),_0x49296f['app'][_0x55b45b(0x214)](_0x4ef68b,_0x4ef68b['__'](_0x55b45b(0x185)));}})[_0x447e0b(0x181)](_0x4fa3ab=>{const _0x14c62e=_0x447e0b;return console[_0x14c62e(0x143)](_0x4fa3ab),_0x49296f[_0x14c62e(0x17c)][_0x14c62e(0x214)](_0x4ef68b,_0x4ef68b['__'](_0x14c62e(0x19d)));});}),router['post'](_0x2a3f88(0x1fe),(_0x4ffd4d,_0x2f343c,_0x3b763f)=>{const _0x591f3e=_0x2a3f88;let _0x2e1790=netUtils['getClientIp'](_0x4ffd4d),_0x3e4914=_0x4ffd4d[_0x591f3e(0x201)][_0x591f3e(0x147)];if(!_0x3e4914)return _0x4ffd4d[_0x591f3e(0x17c)]['returnErrMsg'](_0x2f343c,'Need\x20token');let _0x46a1c6=dbUserTable['getUserByToken'](_0x4ffd4d['app'][_0x591f3e(0x175)],_0x3e4914);if(!_0x46a1c6)return _0x4ffd4d[_0x591f3e(0x17c)][_0x591f3e(0x214)](_0x2f343c,_0x2f343c['__']('TokenExpired'));return _0x46a1c6[_0x591f3e(0x1b1)]='',_0x46a1c6[_0x591f3e(0x170)]='',_0x2f343c[_0x591f3e(0x200)]({'code':0x0,'token':_0x3e4914,'user':_0x46a1c6,'reqIp':_0x2e1790});}),router[_0x2a3f88(0x180)](_0x2a3f88(0x1be),(_0x27441a,_0x3c1dc0,_0x5118c1)=>{const _0x3bbaa0=_0x2a3f88;let _0x3a4cc7=_0x27441a[_0x3bbaa0(0x201)]['password'];if(_0x27441a[_0x3bbaa0(0x1c8)]&&_0x27441a['currentUser'][_0x3bbaa0(0x1df)]!=0x1)return _0x3c1dc0[_0x3bbaa0(0x200)]({'code':0x66});cryptoUtils['encryptString'](config[_0x3bbaa0(0x179)],_0x3a4cc7)[_0x3bbaa0(0x1e7)](_0x468119=>{const _0x49141a=_0x3bbaa0;if(_0x27441a[_0x49141a(0x1c8)][_0x49141a(0x1b1)]!=_0x468119)return _0x3c1dc0[_0x49141a(0x200)]({'code':0x1,'message':_0x3c1dc0['__'](_0x49141a(0x1ef))});fs['rm'](path[_0x49141a(0x18d)](config['cacheParentPath']),{'recursive':!![]},_0x1f6f24=>{const _0x4dcd3a=_0x49141a;if(_0x1f6f24)return _0x3c1dc0[_0x4dcd3a(0x200)]({'code':0x1,'message':_0x4dcd3a(0x212)});return _0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1af))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1ba))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x198))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x166))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20backup_task_record')['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)]['prepare'](_0x4dcd3a(0x1d8))['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)]['prepare'](_0x4dcd3a(0x1e6))[_0x4dcd3a(0x16c)](),_0x27441a['app'][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1d1))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20file_record')[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)]['dbOther']['prepare'](_0x4dcd3a(0x1ca))['run'](),_0x27441a['app']['dbOther']['prepare'](_0x4dcd3a(0x19c))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)]['dbOther'][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20login_ip_list')['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)]['prepare'](_0x4dcd3a(0x145))['run'](),_0x27441a[_0x4dcd3a(0x17c)]['dbOther'][_0x4dcd3a(0x156)](_0x4dcd3a(0x22b))['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)]['prepare'](_0x4dcd3a(0x20e))[_0x4dcd3a(0x16c)](),_0x27441a['app'][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20private_space')[_0x4dcd3a(0x16c)](),_0x27441a['app']['dbOther'][_0x4dcd3a(0x156)](_0x4dcd3a(0x1e4))['run'](),_0x27441a['app'][_0x4dcd3a(0x175)]['prepare'](_0x4dcd3a(0x1f1))[_0x4dcd3a(0x16c)](),_0x27441a['app'][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x16e))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)]['prepare'](_0x4dcd3a(0x1de))[_0x4dcd3a(0x16c)](),_0x27441a['app'][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1d9))['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x175)][_0x4dcd3a(0x156)](_0x4dcd3a(0x22d))[_0x4dcd3a(0x16c)](),_0x27441a['app'][_0x4dcd3a(0x1a8)]['prepare'](_0x4dcd3a(0x1fc))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)]['prepare'](_0x4dcd3a(0x1db))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)]['dbFileIndex']['prepare'](_0x4dcd3a(0x1ce))['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1fd))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20file_index_movie')[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)]['dbFileIndex'][_0x4dcd3a(0x156)](_0x4dcd3a(0x19a))['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1fb))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)]['prepare']('DELETE\x20FROM\x20file_index_book')[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20photo_faces')['run'](),_0x27441a['app']['dbFileIndex'][_0x4dcd3a(0x156)](_0x4dcd3a(0x219))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)]['prepare'](_0x4dcd3a(0x1d2))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x15b))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20movie_history')['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x172))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)]['prepare']('DELETE\x20FROM\x20photo_phash_similar')[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)]['dbFileIndex'][_0x4dcd3a(0x156)](_0x4dcd3a(0x161))[_0x4dcd3a(0x16c)](),_0x27441a['app'][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x148))[_0x4dcd3a(0x16c)](),_0x27441a['app'][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1bc))[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20book_favorite')[_0x4dcd3a(0x16c)](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)]('DELETE\x20FROM\x20book_list')['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1c3))['run'](),_0x27441a[_0x4dcd3a(0x17c)][_0x4dcd3a(0x1a8)][_0x4dcd3a(0x156)](_0x4dcd3a(0x1b7))['run'](),process['send']({'type':_0x4dcd3a(0x1c6),'shareType':_0x4dcd3a(0x1ec)}),process[_0x4dcd3a(0x159)]({'type':'fileShareRestart','shareType':_0x4dcd3a(0x165)}),process[_0x4dcd3a(0x159)]({'type':_0x4dcd3a(0x22c)}),process[_0x4dcd3a(0x159)]({'type':_0x4dcd3a(0x206)}),_0x3c1dc0[_0x4dcd3a(0x200)]({'code':0x0});});});}),router[_0x2a3f88(0x180)]('/resetPwdInfo',(_0x4d674c,_0x45f767,_0x41e0dc)=>{const _0x1dbcc6=_0x2a3f88;let _0x23987f=netUtils[_0x1dbcc6(0x1a4)](_0x4d674c),_0x18a3e9=dbUserTable[_0x1dbcc6(0x1d5)](_0x4d674c[_0x1dbcc6(0x17c)][_0x1dbcc6(0x175)]),_0x5d1347={};_0x23987f==_0x1dbcc6(0x1f0)&&(_0x5d1347[_0x1dbcc6(0x199)]=_0x18a3e9['username']),_0x5d1347[_0x1dbcc6(0x1d3)]=_0x18a3e9[_0x1dbcc6(0x1d3)],_0x45f767[_0x1dbcc6(0x200)]({'code':0x0,'data':_0x5d1347});}),router[_0x2a3f88(0x1cd)]('/checkIsNasServer',(_0x3a66e5,_0x2b5cba,_0x58ef35)=>{const _0x4c8774=_0x2a3f88;let _0x4e6bf3={'code':0x0,'message':'NodeNasServer','version':package['version'],'hostName':OS[_0x4c8774(0x21d)]()},_0x18c737=_0x3a66e5['query'][_0x4c8774(0x226)];if(_0x18c737&&_0x18c737==0x1)return _0x2b5cba[_0x4c8774(0x200)](_0x4e6bf3);let _0x2631e2=0x50,_0x1557f8=dbConfigTable[_0x4c8774(0x1bb)](_0x3a66e5[_0x4c8774(0x17c)][_0x4c8774(0x175)],_0x4c8774(0x1a9));_0x1557f8&&_0x1557f8[_0x4c8774(0x20b)]&&(_0x2631e2=_0x1557f8['value']);let _0x37c841=0x1bb,_0x3846f4=dbConfigTable[_0x4c8774(0x1bb)](_0x3a66e5[_0x4c8774(0x17c)][_0x4c8774(0x175)],_0x4c8774(0x1b3));_0x3846f4&&_0x3846f4[_0x4c8774(0x20b)]&&_0x3846f4['value']>0x0&&_0x3846f4[_0x4c8774(0x20b)]<0xffff&&(_0x37c841=_0x3846f4[_0x4c8774(0x20b)]);let _0x4dab64=0x0,_0x45c0ee=dbConfigTable['findByTitle'](_0x3a66e5[_0x4c8774(0x17c)]['dbOther'],'apiServerHttps');if(_0x45c0ee&&_0x45c0ee['value'])try{_0x45c0ee=JSON[_0x4c8774(0x157)](_0x45c0ee[_0x4c8774(0x20b)]),_0x45c0ee['state']==_0x4c8774(0x16c)&&(_0x4dab64=0x1);}catch(_0x29b077){}try{let _0x177e1b=dbConfigTable['findByTitle'](_0x3a66e5['app'][_0x4c8774(0x175)],'globalIpList'),_0x2355d0=dbConfigTable[_0x4c8774(0x1bb)](_0x3a66e5[_0x4c8774(0x17c)][_0x4c8774(0x175)],_0x4c8774(0x202));if(_0x177e1b){_0x177e1b=JSON['parse'](_0x177e1b['value']);let _0x27dae2=[];if(_0x2355d0&&_0x2355d0[_0x4c8774(0x20b)]){for(let _0x2b5694 in _0x177e1b){let _0x1712c0=_0x177e1b[_0x2b5694];_0x1712c0[_0x4c8774(0x1ed)]==_0x4c8774(0x210)&&_0x27dae2['push'](_0x1712c0);}_0x27dae2[_0x4c8774(0x1c5)]({'type':_0x4c8774(0x1d4),'ip':_0x2355d0[_0x4c8774(0x20b)],'ddns':0x1}),_0x177e1b=_0x27dae2;}}return _0x4e6bf3[_0x4c8774(0x191)]=_0x177e1b,_0x4e6bf3['apiPort']=parseInt(_0x2631e2),_0x4e6bf3[_0x4c8774(0x1b3)]=parseInt(_0x37c841),_0x4e6bf3[_0x4c8774(0x1e2)]=_0x4dab64,_0x2b5cba['json'](_0x4e6bf3);}catch(_0x2ffb87){return _0x2b5cba[_0x4c8774(0x200)](_0x4e6bf3);}}),router[_0x2a3f88(0x180)](_0x2a3f88(0x1c1),(_0x56467f,_0x203662,_0x99f319)=>{const _0x1c6a05=_0x2a3f88;let _0x1fdd36=_0x56467f[_0x1c6a05(0x201)]['username'],_0x2aeaf8=_0x56467f['body'][_0x1c6a05(0x1b1)],_0x57f58c=_0x56467f[_0x1c6a05(0x201)][_0x1c6a05(0x170)],_0x58c07a=_0x56467f[_0x1c6a05(0x17c)][_0x1c6a05(0x175)][_0x1c6a05(0x156)]('SELECT\x20*\x20FROM\x20user\x20WHERE\x20username=?')[_0x1c6a05(0x1b9)](_0x1fdd36);if(!_0x58c07a)return _0x56467f[_0x1c6a05(0x17c)][_0x1c6a05(0x214)](_0x203662,_0x203662['__'](_0x1c6a05(0x216)));try{_0x57f58c=sha256(_0x57f58c);let _0x6ed59f=dbUserTable[_0x1c6a05(0x1ab)](_0x56467f['app'][_0x1c6a05(0x175)],_0x1fdd36,_0x57f58c);if(_0x6ed59f)cryptoUtils[_0x1c6a05(0x189)](config[_0x1c6a05(0x179)],_0x2aeaf8)['then'](_0x5a8827=>{const _0x39e5cd=_0x1c6a05;dbUserTable['updateByUsername'](_0x56467f[_0x39e5cd(0x17c)][_0x39e5cd(0x175)],_0x1fdd36,_0x39e5cd(0x1b1),_0x5a8827);let _0x440e57=sha256(new Date()[_0x39e5cd(0x20f)]()+_0x1fdd36+_0x2aeaf8);dbUserTable[_0x39e5cd(0x221)](_0x56467f[_0x39e5cd(0x17c)][_0x39e5cd(0x175)],_0x1fdd36,_0x39e5cd(0x147),_0x440e57),_0x203662[_0x39e5cd(0x200)]({'code':0x0});})[_0x1c6a05(0x181)](_0x36469f=>{const _0x359dc4=_0x1c6a05;return console[_0x359dc4(0x143)](_0x359dc4(0x225),_0x36469f),_0x56467f[_0x359dc4(0x17c)][_0x359dc4(0x214)](_0x203662,_0x203662['__'](_0x359dc4(0x19d)));});else return _0x56467f[_0x1c6a05(0x17c)][_0x1c6a05(0x214)](_0x203662,_0x203662['__']('login.answerIsWrong'));}catch(_0x593b7b){return console[_0x1c6a05(0x143)](_0x1c6a05(0x162),_0x593b7b),_0x203662[_0x1c6a05(0x19f)](0x194)[_0x1c6a05(0x1e5)]();}});function newUserCheck(_0x567dfc,_0x2fe993,_0x26296a,_0x2fa4df,_0x534162,_0x515c63){const _0x5e76c1=_0x2a3f88;if(!_0x2fa4df||!_0x26296a||!_0x567dfc||!_0x2fe993)return _0x534162[_0x5e76c1(0x17c)]['returnErrMsg'](_0x515c63,_0x515c63['__'](_0x5e76c1(0x1aa)));let _0x399ade=new RegExp(_0x5e76c1(0x169));if(!_0x399ade[_0x5e76c1(0x18f)](_0x567dfc)||_0x567dfc==config['publicUserName'])return _0x534162[_0x5e76c1(0x17c)][_0x5e76c1(0x214)](_0x515c63,_0x515c63['__'](_0x5e76c1(0x20a)));if(_0x567dfc==_0x2fe993)return _0x534162[_0x5e76c1(0x17c)][_0x5e76c1(0x214)](_0x515c63,_0x515c63['__'](_0x5e76c1(0x168)));if(checkUtil[_0x5e76c1(0x142)](_0x567dfc))return _0x534162[_0x5e76c1(0x17c)]['returnErrMsg'](_0x515c63,_0x515c63['__'](_0x5e76c1(0x1ee)));if(_0x26296a==_0x2fa4df)return _0x534162[_0x5e76c1(0x17c)][_0x5e76c1(0x214)](_0x515c63,_0x515c63['__']('answerQuestionCannotBeSame'));if(checkUtil[_0x5e76c1(0x19b)](_0x2fe993))return _0x534162[_0x5e76c1(0x17c)]['returnErrMsg'](_0x515c63,_0x515c63['__'](_0x5e76c1(0x16d)));return!![];}router[_0x2a3f88(0x180)](_0x2a3f88(0x217),(_0x34599b,_0x379c24,_0x2bcff3)=>{const _0x31168e=_0x2a3f88;let _0x4a7ff2=_0x34599b['body'][_0x31168e(0x199)],_0x57b443=_0x34599b[_0x31168e(0x201)][_0x31168e(0x1b1)],_0x4afce1=_0x34599b[_0x31168e(0x201)][_0x31168e(0x1d3)],_0x4167a7=_0x34599b[_0x31168e(0x201)]['answer'];if(!_0x4167a7||!_0x4afce1||!_0x4a7ff2||!_0x57b443)return _0x379c24[_0x31168e(0x200)]({'code':0x1,'message':_0x31168e(0x184)});let _0x51e929=dbUserTable[_0x31168e(0x1d5)](_0x34599b[_0x31168e(0x17c)][_0x31168e(0x175)]);if(_0x51e929)_0x379c24[_0x31168e(0x200)]({'code':0x1,'message':_0x379c24['__'](_0x31168e(0x150))});else{if(newUserCheck(_0x4a7ff2,_0x57b443,_0x4afce1,_0x4167a7,_0x34599b,_0x379c24)!==!![])return;_0x4167a7=sha256(_0x4167a7),cryptoUtils[_0x31168e(0x189)](config[_0x31168e(0x179)],_0x57b443)[_0x31168e(0x1e7)](_0x2929ee=>{const _0x459498=_0x31168e;let _0x31b90d=dbUserTable[_0x459498(0x209)](_0x34599b[_0x459498(0x17c)]['dbOther'],{'username':_0x4a7ff2,'password':_0x2929ee,'question':_0x4afce1,'answer':_0x4167a7,'is_admin':0x1});if(_0x31b90d['changes']>0x0){let _0x13d37a=dbUserTable[_0x459498(0x1d5)](_0x34599b[_0x459498(0x17c)][_0x459498(0x175)]),_0x33bf46=sha256(new Date()[_0x459498(0x20f)]()+_0x4a7ff2+_0x2929ee),_0x2f7e3e=netUtils['getClientIp'](_0x34599b);var _0x4e58dd=_0x34599b['headers'][_0x459498(0x1cb)];dbUserTable[_0x459498(0x1dd)](_0x34599b[_0x459498(0x17c)]['dbOther'],_0x13d37a['id'],_0x33bf46,_0x2f7e3e,_0x4e58dd),_0x13d37a['password']='';let _0x294f9c=_0x34599b[_0x459498(0x201)][_0x459498(0x224)],_0x18fbd8=_0x34599b[_0x459498(0x201)][_0x459498(0x215)];if(_0x294f9c){let _0x60da66=dbConfigTable[_0x459498(0x209)](_0x34599b[_0x459498(0x17c)][_0x459498(0x175)],{'title':_0x459498(0x224),'value':_0x294f9c});}if(_0x18fbd8){let _0x8b4e00=dbConfigTable[_0x459498(0x209)](_0x34599b[_0x459498(0x17c)][_0x459498(0x175)],{'title':_0x459498(0x215),'value':_0x18fbd8});}return _0x379c24['json']({'code':0x0,'token':_0x33bf46,'user':_0x13d37a});}})[_0x31168e(0x181)](_0x2d730e=>{const _0x2dc506=_0x31168e;return console[_0x2dc506(0x143)](_0x2dc506(0x225),_0x2d730e),_0x34599b[_0x2dc506(0x17c)][_0x2dc506(0x214)](_0x379c24,_0x379c24['__'](_0x2dc506(0x19d)));});}}),router['post'](_0x2a3f88(0x1f5),(_0x5b334a,_0xba7a40,_0x2b1499)=>{const _0x51d2e5=_0x2a3f88;if(_0x5b334a[_0x51d2e5(0x1c8)][_0x51d2e5(0x1df)]!=0x1)return _0xba7a40[_0x51d2e5(0x200)]({'code':0x66});let _0x369c64=_0x5b334a[_0x51d2e5(0x201)]['username'],_0x4948df=_0x5b334a[_0x51d2e5(0x201)][_0x51d2e5(0x163)];return _0x369c64&&_0x4948df&&dbUserTable[_0x51d2e5(0x1e3)](_0x5b334a[_0x51d2e5(0x17c)][_0x51d2e5(0x175)],_0x369c64,_0x4948df),_0xba7a40['json']({'code':0x0});}),router[_0x2a3f88(0x180)]('/addUser',(_0x593e6a,_0x2b09bf,_0x1f5d80)=>{const _0x1838e0=_0x2a3f88;nasAccountUtil[_0x1838e0(0x193)](_0x593e6a[_0x1838e0(0x17c)]['dbOther'])[_0x1838e0(0x1e7)](_0x373ff4=>{const _0x460933=_0x1838e0;let _0x5f121d=dbUserTable['getUserCount'](_0x593e6a[_0x460933(0x17c)][_0x460933(0x175)]);if(!_0x373ff4){if(_0x5f121d>=parseInt(config['freeVersionSubuserCount'])+0x1){let _0x535709=dbUserTable[_0x460933(0x17e)](_0x593e6a[_0x460933(0x17c)][_0x460933(0x175)],_0x593e6a['body'][_0x460933(0x199)]);if(!_0x535709)return _0x593e6a[_0x460933(0x17c)]['returnErrMsg'](_0x2b09bf,_0x2b09bf['__'](_0x460933(0x17b)));}_0x34aeda();}else{if(_0x373ff4[_0x460933(0x1ed)]<0x2&&_0x373ff4['sub_account_num']&&_0x5f121d>=parseInt(_0x373ff4[_0x460933(0x18b)])+0x1)return _0x593e6a[_0x460933(0x17c)][_0x460933(0x214)](_0x2b09bf,_0x2b09bf['__'](_0x460933(0x17b)));else _0x34aeda();}function _0x34aeda(){const _0x2b874b=_0x460933;let _0x1ef02d=_0x593e6a[_0x2b874b(0x201)][_0x2b874b(0x199)],_0x2a40b7=_0x593e6a[_0x2b874b(0x201)][_0x2b874b(0x1b1)],_0x4731e9=_0x593e6a[_0x2b874b(0x201)][_0x2b874b(0x1d3)],_0x3e0f2c=_0x593e6a[_0x2b874b(0x201)][_0x2b874b(0x170)],_0x2bf3fd=_0x593e6a['body']['remark'];if(newUserCheck(_0x1ef02d,_0x2a40b7,_0x4731e9,_0x3e0f2c,_0x593e6a,_0x2b09bf)!==!![])return;let _0x33cc17=_0x593e6a['body'][_0x2b874b(0x1ed)];if(dbUserTable[_0x2b874b(0x178)](_0x593e6a,_0x2b09bf)===!![]){if(_0x33cc17==_0x2b874b(0x1ad)){let _0x5601ff=dbUserTable[_0x2b874b(0x205)](_0x593e6a[_0x2b874b(0x17c)][_0x2b874b(0x175)],_0x1ef02d);if(_0x5601ff)return _0x593e6a[_0x2b874b(0x17c)][_0x2b874b(0x214)](_0x2b09bf,_0x2b09bf['__'](_0x2b874b(0x207)));}cryptoUtils[_0x2b874b(0x189)](config[_0x2b874b(0x179)],_0x2a40b7)[_0x2b874b(0x1e7)](_0x160419=>{const _0x96c10f=_0x2b874b;let _0x2dbb92=dbUserTable['create'](_0x593e6a[_0x96c10f(0x17c)][_0x96c10f(0x175)],{'username':_0x1ef02d,'password':_0x160419,'question':_0x4731e9,'answer':sha256(_0x3e0f2c),'remark':_0x2bf3fd});return _0x2dbb92['changes']>=0x1?_0x2b09bf[_0x96c10f(0x200)]({'code':0x0}):_0x593e6a[_0x96c10f(0x17c)][_0x96c10f(0x214)](_0x2b09bf,_0x2b09bf['__'](_0x96c10f(0x19d)));})[_0x2b874b(0x181)](_0x5c3ccc=>{const _0x5bd773=_0x2b874b;return console['log'](_0x5bd773(0x225),_0x5c3ccc),_0x593e6a['app'][_0x5bd773(0x214)](_0x2b09bf,_0x2b09bf['__'](_0x5bd773(0x19d)));});}}});}),router[_0x2a3f88(0x180)](_0x2a3f88(0x204),(_0x5d4e0d,_0x534521,_0x3ca44c)=>{const _0x334c94=_0x2a3f88;let _0x2de17a=_0x5d4e0d[_0x334c94(0x201)][_0x334c94(0x1f6)];if(dbUserTable[_0x334c94(0x178)](_0x5d4e0d,_0x534521)===!![]){let _0x41e6e7=dbUserTable[_0x334c94(0x19e)](_0x5d4e0d[_0x334c94(0x17c)][_0x334c94(0x175)],_0x2de17a);if(_0x41e6e7&&_0x41e6e7[_0x334c94(0x1df)]==0x1)return _0x534521[_0x334c94(0x200)]({'code':0x1,'message':_0x334c94(0x1ea)});dbUserTable[_0x334c94(0x190)](_0x5d4e0d[_0x334c94(0x17c)][_0x334c94(0x175)],_0x41e6e7['username']),dbMusicIndexTable[_0x334c94(0x1ac)](_0x5d4e0d[_0x334c94(0x17c)]['dbFileIndex'],_0x41e6e7['id']),dbMusicFavorite[_0x334c94(0x15e)](_0x5d4e0d[_0x334c94(0x17c)][_0x334c94(0x1a8)],_0x41e6e7['id']),dbMovieFavorite[_0x334c94(0x15e)](_0x5d4e0d[_0x334c94(0x17c)]['dbFileIndex'],_0x41e6e7['id']);let _0x154293=dbUserTable['delete'](_0x5d4e0d[_0x334c94(0x17c)][_0x334c94(0x175)],_0x2de17a);return _0x154293[_0x334c94(0x1c0)]>=0x1?_0x534521['json']({'code':0x0}):_0x5d4e0d['app'][_0x334c94(0x214)](_0x534521,_0x534521['__'](_0x334c94(0x19d)));}}),router[_0x2a3f88(0x180)](_0x2a3f88(0x1b5),(_0x22b3cf,_0x5d48e4,_0x34ef36)=>{const _0x4aa7e3=_0x2a3f88;if(dbUserTable[_0x4aa7e3(0x178)](_0x22b3cf,_0x5d48e4)===!![]){let _0x10910d=_0x22b3cf[_0x4aa7e3(0x201)]['orderField']||'id',_0x384007=_0x22b3cf[_0x4aa7e3(0x201)]['orderType']||_0x4aa7e3(0x1fa),_0x664a8f=_0x22b3cf['body'][_0x4aa7e3(0x1e9)];(!['id',_0x4aa7e3(0x199),'user_remark'][_0x4aa7e3(0x14d)](_0x10910d)||!['asc',_0x4aa7e3(0x187)][_0x4aa7e3(0x14d)](_0x384007))&&(_0x10910d='id',_0x384007=_0x4aa7e3(0x1fa));let _0x2f55db=_0x4aa7e3(0x182),_0x355ec6=[];_0x664a8f&&(_0x2f55db+=_0x4aa7e3(0x14a),_0x355ec6[_0x4aa7e3(0x1c5)]('%'+_0x664a8f+'%','%'+_0x664a8f+'%'));_0x2f55db+=_0x4aa7e3(0x1e0)+_0x10910d+'\x20'+_0x384007;let _0x317e35=_0x22b3cf['app'][_0x4aa7e3(0x175)][_0x4aa7e3(0x156)](_0x2f55db)[_0x4aa7e3(0x1cd)](_0x355ec6);return _0x5d48e4[_0x4aa7e3(0x200)]({'code':0x0,'userList':_0x317e35});}}),router[_0x2a3f88(0x180)](_0x2a3f88(0x153),(_0x153b5e,_0x5f3028,_0xaf818b)=>{const _0x557afe=_0x2a3f88;let _0x2db156=_0x153b5e[_0x557afe(0x201)]['username'],_0x1f105d=null;if(_0x2db156!=config[_0x557afe(0x1c2)]){_0x1f105d=dbUserTable['getUserByUserName'](_0x153b5e[_0x557afe(0x17c)][_0x557afe(0x175)],_0x2db156);if(!_0x1f105d)return _0x153b5e[_0x557afe(0x17c)][_0x557afe(0x214)](_0x5f3028,'username\x20error');}if(dbUserTable[_0x557afe(0x178)](_0x153b5e,_0x5f3028)===!![]||_0x2db156==_0x153b5e[_0x557afe(0x1c8)][_0x557afe(0x199)]){let _0x1444d0=dbUserTable['getUserPower'](_0x153b5e['app']['dbOther'],_0x2db156,null,null,!![]),_0xc47962=0x0;if(_0x1444d0['length']<0x1)return _0x5f3028[_0x557afe(0x200)]({'code':0x0,'userPower':_0x1444d0,'userMenu':_0x1f105d?_0x1f105d[_0x557afe(0x171)]:[]});for(let _0x1ae377=0x0;_0x1ae377<_0x1444d0[_0x557afe(0x1f4)];_0x1ae377++){let _0xf8942a=_0x1444d0[_0x1ae377]['path'];fs[_0x557afe(0x21e)](_0xf8942a,(_0x2af1e1,_0x470eec)=>{const _0x323195=_0x557afe;_0xc47962+=0x1;_0x2af1e1?_0x1444d0[_0x1ae377][_0x323195(0x173)]=0x0:_0x1444d0[_0x1ae377][_0x323195(0x173)]=0x1;if(_0xc47962==_0x1444d0['length'])return _0x5f3028[_0x323195(0x200)]({'code':0x0,'userPower':_0x1444d0,'userMenu':_0x1f105d?_0x1f105d[_0x323195(0x171)]:[]});});}}}),router['post']('/setUserPower',(_0xc6b9d4,_0x2d72d1,_0x1376be)=>{const _0x1e35f3=_0x2a3f88;let _0x13e125=_0xc6b9d4[_0x1e35f3(0x201)]['username'],_0x3ac521=_0xc6b9d4[_0x1e35f3(0x201)][_0x1e35f3(0x228)],_0x1d4186=_0xc6b9d4[_0x1e35f3(0x201)][_0x1e35f3(0x20c)];if(!_0x13e125||!_0x3ac521||!_0x1d4186)return _0xc6b9d4[_0x1e35f3(0x17c)][_0x1e35f3(0x214)](_0x2d72d1,_0x2d72d1['__'](_0x1e35f3(0x19d)));let _0x30ea0a=null;if(_0x13e125!=config[_0x1e35f3(0x1c2)]){_0x30ea0a=dbUserTable[_0x1e35f3(0x17e)](_0xc6b9d4[_0x1e35f3(0x17c)]['dbOther'],_0x13e125);if(!_0x30ea0a)return _0xc6b9d4[_0x1e35f3(0x17c)][_0x1e35f3(0x214)](_0x2d72d1,'username\x20error');}_0x3ac521=pathUtil[_0x1e35f3(0x18d)](_0x3ac521);if(dbUserTable['isAdmin'](_0xc6b9d4,_0x2d72d1)===!![]){let _0x2e481a=dbUserTable['getUserPower'](_0xc6b9d4[_0x1e35f3(0x17c)][_0x1e35f3(0x175)],_0x13e125,_0x1d4186,null,!![]);for(let _0x367175 of _0x2e481a){let _0x4df0d4=_0x367175['path'];if(_0x3ac521['startsWith'](pathUtil[_0x1e35f3(0x18d)](_0x4df0d4,pathUtil[_0x1e35f3(0x1b6)]))&&_0x3ac521!=_0x4df0d4)return _0xc6b9d4['app']['returnErrMsg'](_0x2d72d1,_0x2d72d1['__'](_0x1e35f3(0x1e8))+_0x4df0d4,_0x1e35f3(0x144));if(_0x4df0d4['startsWith'](pathUtil['join'](_0x3ac521,pathUtil[_0x1e35f3(0x1b6)]))&&_0x3ac521!=_0x4df0d4)return _0xc6b9d4[_0x1e35f3(0x17c)]['returnErrMsg'](_0x2d72d1,_0x2d72d1['__'](_0x1e35f3(0x1e8))+_0x4df0d4,'dialog');}let _0x50060a=dbUserTable[_0x1e35f3(0x15d)](_0xc6b9d4[_0x1e35f3(0x17c)][_0x1e35f3(0x175)],_0xc6b9d4[_0x1e35f3(0x201)]);return _0x2d72d1[_0x1e35f3(0x200)]({'code':0x0,'result':_0x50060a});}}),router['post'](_0x2a3f88(0x151),(_0x26cfa0,_0x27f11f,_0x54804d)=>{const _0x5e774f=_0x2a3f88;let _0x325d9c=_0x26cfa0[_0x5e774f(0x201)][_0x5e774f(0x199)],_0x1cb129=_0x26cfa0['body'][_0x5e774f(0x1b0)];if(!_0x325d9c||!(_0x1cb129 instanceof Array))return _0x26cfa0[_0x5e774f(0x17c)]['returnErrMsg'](_0x27f11f,_0x5e774f(0x160));let _0x187388=dbUserTable[_0x5e774f(0x17e)](_0x26cfa0[_0x5e774f(0x17c)][_0x5e774f(0x175)],_0x325d9c);if(!_0x187388)return _0x26cfa0[_0x5e774f(0x17c)][_0x5e774f(0x214)](_0x27f11f,'username\x20error');if(dbUserTable[_0x5e774f(0x178)](_0x26cfa0,_0x27f11f)===!![])return dbUserTable[_0x5e774f(0x221)](_0x26cfa0[_0x5e774f(0x17c)][_0x5e774f(0x175)],_0x325d9c,_0x5e774f(0x171),JSON['stringify'](_0x1cb129)),_0x27f11f['json']({'code':0x0});}),router[_0x2a3f88(0x180)](_0x2a3f88(0x188),(_0x48fac6,_0x32b82b,_0x9d4184)=>{const _0x4d1c1a=_0x2a3f88;let _0x4e1098=dbUserTable[_0x4d1c1a(0x176)](_0x48fac6['app']['dbOther'],_0x48fac6[_0x4d1c1a(0x201)]);return _0x4e1098['changes']>0x0?_0x32b82b[_0x4d1c1a(0x200)]({'code':0x0}):_0x48fac6['app']['returnErrMsg'](_0x32b82b,_0x32b82b['__']('operationFail'));}),router[_0x2a3f88(0x180)](_0x2a3f88(0x14c),(_0x551368,_0x3fa758,_0x40b669)=>{const _0x14be89=_0x2a3f88;let _0x43f2d2=_0x551368[_0x14be89(0x201)][_0x14be89(0x1a7)],_0x3d60d1=_0x551368[_0x14be89(0x201)][_0x14be89(0x1ff)];cryptoUtils[_0x14be89(0x189)](config['passwordKey'],_0x43f2d2)[_0x14be89(0x1e7)](_0x191159=>{const _0x4f429b=_0x14be89;if(_0x551368[_0x4f429b(0x1c8)][_0x4f429b(0x1b1)]!=_0x191159)return _0x3fa758[_0x4f429b(0x200)]({'code':0x2,'message':_0x3fa758['__'](_0x4f429b(0x211))});else cryptoUtils[_0x4f429b(0x189)](config[_0x4f429b(0x179)],_0x3d60d1)[_0x4f429b(0x1e7)](_0x3c856f=>{const _0x26e77b=_0x4f429b;dbUserTable[_0x26e77b(0x1b4)](_0x551368[_0x26e77b(0x17c)]['dbOther'],_0x551368['currentUser']['id'],_0x26e77b(0x1b1),_0x3c856f);let _0x1dd766=sha256(new Date()['getTime']()+_0x551368[_0x26e77b(0x1c8)][_0x26e77b(0x199)]+_0x551368[_0x26e77b(0x1c8)][_0x26e77b(0x1b1)]);dbUserTable[_0x26e77b(0x1b4)](_0x551368[_0x26e77b(0x17c)][_0x26e77b(0x175)],_0x551368[_0x26e77b(0x1c8)]['id'],_0x26e77b(0x147),_0x1dd766);let _0x4ecbb2=netUtils[_0x26e77b(0x1a4)](_0x551368);return dbLoginTable[_0x26e77b(0x17f)](_0x551368[_0x26e77b(0x17c)][_0x26e77b(0x175)],'changePassword',_0x551368[_0x26e77b(0x1c8)]['id'],_0x4ecbb2,_0x551368['body']['client'],''),_0x3fa758['json']({'code':0x0});})['catch'](_0x1ba4e3=>{const _0x1dc57e=_0x4f429b;return console[_0x1dc57e(0x143)]('error',_0x1ba4e3),_0x551368[_0x1dc57e(0x17c)][_0x1dc57e(0x214)](_0x3fa758,_0x3fa758['__'](_0x1dc57e(0x19d)));});});}),router[_0x2a3f88(0x180)](_0x2a3f88(0x218),(_0x5ef077,_0xbce39,_0x44e3b4)=>{const _0x296fc8=_0x2a3f88;let _0x2c1511=_0x5ef077[_0x296fc8(0x201)][_0x296fc8(0x158)],_0xd136d5=_0x5ef077[_0x296fc8(0x201)][_0x296fc8(0x170)];if(checkUtil[_0x296fc8(0x1f2)](_0xd136d5))return _0x5ef077[_0x296fc8(0x17c)][_0x296fc8(0x214)](_0xbce39,_0xbce39['__']('answerNotSeqNumOrChar'));if(_0x2c1511==_0xd136d5)return _0x5ef077['app'][_0x296fc8(0x214)](_0xbce39,_0xbce39['__']('answerQuestionCannotBeSame'));return dbUserTable[_0x296fc8(0x16a)](_0x5ef077[_0x296fc8(0x17c)][_0x296fc8(0x175)],_0x5ef077[_0x296fc8(0x1c8)]['id'],_0x2c1511,sha256(_0xd136d5)),_0xbce39[_0x296fc8(0x200)]({'code':0x0});}),router[_0x2a3f88(0x180)](_0x2a3f88(0x1f7),(_0x17d6bc,_0x465219,_0x871ea7)=>{const _0x3653d2=_0x2a3f88;let _0x556ae0=_0x17d6bc[_0x3653d2(0x201)]['token'];return _0x556ae0&&dbUserTable[_0x3653d2(0x155)](_0x17d6bc['app'][_0x3653d2(0x175)],_0x3653d2(0x197),[_0x556ae0]),_0x465219[_0x3653d2(0x200)]({'code':0x0});}),router[_0x2a3f88(0x180)](_0x2a3f88(0x1cf),(_0x3947a2,_0x1986eb,_0x3c2192)=>{const _0x1d4a48=_0x2a3f88;let _0x78fe7e=dbUserTable[_0x1d4a48(0x19e)](_0x3947a2[_0x1d4a48(0x17c)][_0x1d4a48(0x175)],_0x3947a2[_0x1d4a48(0x1c8)]['id']);return _0x78fe7e?(_0x78fe7e['password']='',_0x78fe7e[_0x1d4a48(0x170)]='',_0x1986eb[_0x1d4a48(0x200)]({'code':0x0,'userInfo':_0x78fe7e})):_0x1986eb[_0x1d4a48(0x200)]({'code':0x65});}),router['post']('/addIpToList',(_0x45edf6,_0x15be6e,_0x4927e2)=>{const _0x4ee7e1=_0x2a3f88;if(_0x45edf6[_0x4ee7e1(0x1c8)]['is_admin']!=0x1)return _0x15be6e[_0x4ee7e1(0x200)]({'code':0x66});let _0x181bae=_0x45edf6[_0x4ee7e1(0x201)]['ip'];if(_0x181bae==_0x4ee7e1(0x1f0)||_0x181bae=='127.0.0.1')return _0x45edf6['app'][_0x4ee7e1(0x214)](_0x15be6e,_0x15be6e['__'](_0x4ee7e1(0x1f3)));let _0x147159=_0x45edf6[_0x4ee7e1(0x201)][_0x4ee7e1(0x1ed)],_0x4b5248=_0x45edf6[_0x4ee7e1(0x201)][_0x4ee7e1(0x14e)];return dbLoginTable[_0x4ee7e1(0x222)](_0x45edf6[_0x4ee7e1(0x17c)][_0x4ee7e1(0x175)],_0x147159,_0x181bae,_0x4b5248,_0x15be6e['__'](_0x4ee7e1(0x203))),_0x45edf6[_0x4ee7e1(0x17c)][_0x4ee7e1(0x146)](),_0x15be6e[_0x4ee7e1(0x200)]({'code':0x0});}),router['post']('/removeIp',(_0x3beb8d,_0x6ef6f8,_0x273a1c)=>{const _0x301ef5=_0x2a3f88;if(_0x3beb8d[_0x301ef5(0x1c8)][_0x301ef5(0x1df)]!=0x1)return _0x6ef6f8[_0x301ef5(0x200)]({'code':0x66});let _0x1f021e=_0x3beb8d[_0x301ef5(0x201)]['id'];return dbLoginTable[_0x301ef5(0x152)](_0x3beb8d[_0x301ef5(0x17c)][_0x301ef5(0x175)],_0x1f021e),_0x3beb8d['app'][_0x301ef5(0x146)](),_0x6ef6f8[_0x301ef5(0x200)]({'code':0x0});}),router[_0x2a3f88(0x180)](_0x2a3f88(0x194),(_0x1629c9,_0x33d718,_0x29d739)=>{const _0x4cd3a2=_0x2a3f88;let _0x4d28dc=_0x1629c9[_0x4cd3a2(0x201)][_0x4cd3a2(0x1f8)],_0x2b1202=_0x1629c9[_0x4cd3a2(0x201)][_0x4cd3a2(0x22a)],_0x402500=_0x1629c9[_0x4cd3a2(0x201)]['type'],_0x1eaf5d=new Date()[_0x4cd3a2(0x20f)]();dbLoginTable[_0x4cd3a2(0x154)](_0x1629c9[_0x4cd3a2(0x17c)][_0x4cd3a2(0x175)],_0x4cd3a2(0x177)+_0x1eaf5d);let _0x201ca2='\x20type=\x27'+_0x402500+'\x27',_0x58ff2e=dbLoginTable[_0x4cd3a2(0x195)](_0x1629c9[_0x4cd3a2(0x17c)][_0x4cd3a2(0x175)],_0x201ca2),_0x5d4eaa=(_0x4d28dc-0x1)*_0x2b1202;_0x201ca2+=_0x4cd3a2(0x1cc)+_0x2b1202+_0x4cd3a2(0x1a3)+_0x5d4eaa;let _0x3275d8=dbLoginTable[_0x4cd3a2(0x1da)](_0x1629c9[_0x4cd3a2(0x17c)][_0x4cd3a2(0x175)],_0x201ca2);return _0x33d718[_0x4cd3a2(0x200)]({'code':0x0,'data':_0x3275d8,'pageCount':Math[_0x4cd3a2(0x15a)](_0x58ff2e[_0x4cd3a2(0x1a0)]/_0x2b1202)});}),router[_0x2a3f88(0x180)]('/getRecordList',(_0x34fbc7,_0x1f1676,_0x37947f)=>{const _0x4a0a42=_0x2a3f88;if(_0x34fbc7[_0x4a0a42(0x1c8)]['is_admin']!=0x1)return _0x1f1676['json']({'code':0x66});let _0x42b5d4=0x1388,_0x34301a=_0x34fbc7[_0x4a0a42(0x201)][_0x4a0a42(0x1f8)],_0x473400=_0x34fbc7[_0x4a0a42(0x201)]['pageSize'],_0x31d63d=_0x34fbc7['body'][_0x4a0a42(0x1ed)],_0x12b90b='',_0x3273c4=[];_0x31d63d?(_0x12b90b+=_0x4a0a42(0x15f),_0x3273c4['push'](_0x31d63d)):_0x12b90b=_0x4a0a42(0x1bd);let _0x2f065a=dbLoginTable['getRecordCountByWhere'](_0x34fbc7[_0x4a0a42(0x17c)][_0x4a0a42(0x175)],_0x12b90b,_0x3273c4)[_0x4a0a42(0x1a0)];if(_0x2f065a>_0x42b5d4){let _0x2c4f8f=0x64,_0x77fb0a=dbLoginTable[_0x4a0a42(0x174)](_0x34fbc7[_0x4a0a42(0x17c)][_0x4a0a42(0x175)],_0x4a0a42(0x164)+_0x2c4f8f+')');_0x77fb0a[_0x4a0a42(0x1c0)]>0x0&&(_0x2f065a=_0x2f065a-_0x77fb0a[_0x4a0a42(0x1c0)]);}let _0x56ef0e=(_0x34301a-0x1)*_0x473400;_0x12b90b+=_0x4a0a42(0x229),_0x3273c4[_0x4a0a42(0x1c5)](_0x473400),_0x3273c4[_0x4a0a42(0x1c5)](_0x56ef0e);let _0x59e469=dbLoginTable[_0x4a0a42(0x21f)](_0x34fbc7[_0x4a0a42(0x17c)][_0x4a0a42(0x175)],_0x12b90b,_0x3273c4);return _0x1f1676[_0x4a0a42(0x200)]({'code':0x0,'data':_0x59e469,'pageCount':Math[_0x4a0a42(0x15a)](_0x2f065a/_0x473400)});}),module['exports']=router;