function _0x4a53(_0x397dbf,_0x19fd49){const _0x38d23b=_0x38d2();return _0x4a53=function(_0x4a53d7,_0x3117de){_0x4a53d7=_0x4a53d7-0xa5;let _0x1354c9=_0x38d23b[_0x4a53d7];return _0x1354c9;},_0x4a53(_0x397dbf,_0x19fd49);}const _0x44c6c5=_0x4a53;(function(_0xa7dac6,_0x18e93c){const _0x2d287f=_0x4a53,_0x57200a=_0xa7dac6();while(!![]){try{const _0x25d26e=-parseInt(_0x2d287f(0x151))/0x1*(-parseInt(_0x2d287f(0x169))/0x2)+-parseInt(_0x2d287f(0x100))/0x3+-parseInt(_0x2d287f(0xb0))/0x4+-parseInt(_0x2d287f(0x143))/0x5*(-parseInt(_0x2d287f(0xc6))/0x6)+parseInt(_0x2d287f(0x112))/0x7*(-parseInt(_0x2d287f(0x152))/0x8)+parseInt(_0x2d287f(0x12f))/0x9*(-parseInt(_0x2d287f(0x136))/0xa)+-parseInt(_0x2d287f(0xf7))/0xb*(-parseInt(_0x2d287f(0x188))/0xc);if(_0x25d26e===_0x18e93c)break;else _0x57200a['push'](_0x57200a['shift']());}catch(_0x5b7f90){_0x57200a['push'](_0x57200a['shift']());}}}(_0x38d2,0xd928a));let sha256=require('sha256'),express=require(_0x44c6c5(0xb1)),router=express[_0x44c6c5(0x146)](),cryptoUtils=require(_0x44c6c5(0x13a)),netUtils=require('../utils/netUtils'),config=require(_0x44c6c5(0x181)),pathUtil=require(_0x44c6c5(0x154)),nasAccountUtil=require(_0x44c6c5(0xe1)),checkUtil=require('../utils/checkUtil');var package=require(_0x44c6c5(0xfa));const OS=require('os'),dbUserTable=require(_0x44c6c5(0xeb)),dbLoginTable=require(_0x44c6c5(0x17d)),dbConfigTable=require(_0x44c6c5(0x133)),dbNoticeCenterTable=require(_0x44c6c5(0xa9)),dbMusicIndexTable=require(_0x44c6c5(0xda)),fileUtil=require('../utils/fileUtils'),fs=require('fs'),path=require('path'),dbMovieFavorite=require('../../db/dbMovieFavorite'),dbMusicFavorite=require(_0x44c6c5(0xe3));router[_0x44c6c5(0x189)](_0x44c6c5(0xb4),(_0x35fbb9,_0x13dd34,_0xade5ed)=>{const _0xb0f099=_0x44c6c5;let _0x3020b2=dbUserTable[_0xb0f099(0x141)](_0x35fbb9[_0xb0f099(0x14f)][_0xb0f099(0x16d)]),_0x6da808=dbConfigTable[_0xb0f099(0x110)](_0x35fbb9[_0xb0f099(0x14f)]['dbOther'],_0xb0f099(0xdb));_0x13dd34[_0xb0f099(0xa6)]({'code':0x0,'hasAdmin':_0x3020b2?'1':'0','customConfig':_0x6da808,'hostName':OS[_0xb0f099(0xbe)]()});});let banIpList=[];router['post']('/login',(_0x351a06,_0x4b556a,_0x5a1873)=>{const _0x2d7495=_0x44c6c5;let _0x50e9a5=_0x351a06['body']['username'],_0x27c3a3=_0x351a06[_0x2d7495(0x173)]['password'];if(!_0x50e9a5||!_0x27c3a3)return _0x4b556a[_0x2d7495(0x148)](0x194)[_0x2d7495(0xae)]();_0x27c3a3=fileUtil[_0x2d7495(0x131)](_0x27c3a3);let _0x196053=netUtils['getClientIp'](_0x351a06),_0x11b032=![],_0x37a721=0x1,_0xb91777=0x1;if(_0x196053!='localhost'){let _0x5d6e61=dbConfigTable[_0x2d7495(0xc8)](_0x351a06[_0x2d7495(0x14f)][_0x2d7495(0x16d)],_0x2d7495(0x139));_0x5d6e61&&(_0x5d6e61=JSON['parse'](_0x5d6e61[_0x2d7495(0xc2)]),_0x5d6e61&&(_0x5d6e61[_0x2d7495(0x185)]&&(_0x11b032=!![]),_0x37a721=_0x5d6e61[_0x2d7495(0xf9)],_0xb91777=_0x5d6e61['banTime']));}cryptoUtils[_0x2d7495(0x170)](config['passwordKey'],_0x27c3a3)[_0x2d7495(0x164)](_0x87382a=>{const _0x380060=_0x2d7495;let _0x5ddf43=dbUserTable[_0x380060(0xb8)](_0x351a06['app'][_0x380060(0x16d)],_0x50e9a5,_0x87382a);if(_0x5ddf43){function _0x4ff266(){const _0xb9fa5c=_0x380060;if(_0x196053!=_0xb9fa5c(0x108)){let _0x16ec9d=dbConfigTable[_0xb9fa5c(0xc8)](_0x351a06[_0xb9fa5c(0x14f)][_0xb9fa5c(0x16d)],_0xb9fa5c(0xaf));if(_0x16ec9d&&_0x16ec9d[_0xb9fa5c(0xc2)]=='1'){let _0x5396e3=_0x351a06[_0xb9fa5c(0x173)][_0xb9fa5c(0xa8)];if(_0x5396e3){_0x5396e3=sha256(_0x5396e3);let _0x266ec9=dbUserTable[_0xb9fa5c(0xf1)](_0x351a06['app'][_0xb9fa5c(0x16d)],_0x50e9a5,_0x5396e3);if(!_0x266ec9)return _0x351a06['app'][_0xb9fa5c(0x10a)](_0x4b556a,_0x4b556a['__']('login.answerIsWrong'));}else return _0x4b556a[_0xb9fa5c(0xa6)]({'code':0x2,'question':_0x5ddf43[_0xb9fa5c(0x120)]});}}dbLoginTable[_0xb9fa5c(0xd5)](_0x351a06['app'][_0xb9fa5c(0x16d)],_0xb9fa5c(0xb8),_0x50e9a5,_0x196053,_0x351a06['body'][_0xb9fa5c(0xcd)],_0x351a06[_0xb9fa5c(0x128)][_0xb9fa5c(0x13e)]);let _0x20340e=sha256(new Date()['getTime']()+_0x50e9a5+_0x87382a);var _0x32ca5b=_0x351a06[_0xb9fa5c(0x128)][_0xb9fa5c(0x13e)];return dbUserTable[_0xb9fa5c(0x175)](_0x351a06[_0xb9fa5c(0x14f)]['dbOther'],_0x5ddf43['id'],_0x20340e,_0x196053,_0x32ca5b),_0x5ddf43[_0xb9fa5c(0xd9)]='',_0x5ddf43[_0xb9fa5c(0xa8)]='',_0x4b556a[_0xb9fa5c(0xa6)]({'code':0x0,'token':_0x20340e,'user':_0x5ddf43,'version':package[_0xb9fa5c(0xe7)],'reqIp':_0x196053});}if(_0x5ddf43[_0x380060(0xd4)]!=0x1)nasAccountUtil['getVipInfo'](_0x351a06[_0x380060(0x14f)][_0x380060(0x16d)])['then'](_0x25066b=>{const _0xd6f602=_0x380060;let _0x58d3cd=dbUserTable['getUserCount'](_0x351a06[_0xd6f602(0x14f)][_0xd6f602(0x16d)]);if(!_0x25066b){if(_0x58d3cd>parseInt(config[_0xd6f602(0x160)])+0x1)return _0x351a06[_0xd6f602(0x14f)][_0xd6f602(0x10a)](_0x4b556a,_0x4b556a['__'](_0xd6f602(0x10c)));return _0x4ff266();}else return _0x25066b[_0xd6f602(0xef)]<0x2&&_0x25066b[_0xd6f602(0x11e)]&&_0x58d3cd>parseInt(_0x25066b[_0xd6f602(0x11e)])+0x1?_0x351a06['app'][_0xd6f602(0x10a)](_0x4b556a,_0x4b556a['__'](_0xd6f602(0x10c))):_0x4ff266();});else return _0x4ff266();}else{if(_0x11b032){let _0x5130fd=null;for(let _0xa8e306 in banIpList){banIpList[_0xa8e306]['ip']==_0x196053&&(_0x5130fd=banIpList[_0xa8e306],banIpList[_0xa8e306]['testCount']+=0x1);}!_0x5130fd&&(_0x5130fd={'ip':_0x196053,'testCount':0x1},banIpList[_0x380060(0x15e)](_0x5130fd));if(_0x5130fd[_0x380060(0xf9)]>=_0x37a721){let _0x205ab5=new Date()[_0x380060(0x16a)](),_0x1dd8c3=_0x205ab5+_0xb91777*0x3c*0x3e8;dbLoginTable[_0x380060(0x17b)](_0x351a06[_0x380060(0x14f)]['dbOther'],_0x380060(0x16c),_0x196053,_0x1dd8c3,_0x4b556a['__'](_0x380060(0x107))),_0x351a06[_0x380060(0x14f)]['refreshIpList'](),dbNoticeCenterTable[_0x380060(0x140)](_0x351a06[_0x380060(0x14f)][_0x380060(0x16d)],{'title':_0x4b556a['__'](_0x380060(0x124)),'level':_0x380060(0x138),'content':_0x4b556a['__'](_0x380060(0x10d))+('['+_0x196053+']')});for(let _0x50848b in banIpList){banIpList[_0x50848b]['ip']==_0x196053&&banIpList['splice'](_0x50848b,0x1);}}}return dbLoginTable['addLoginRecord'](_0x351a06[_0x380060(0x14f)][_0x380060(0x16d)],_0x4b556a['__'](_0x380060(0x15b)),_0x50e9a5,_0x196053,_0x351a06[_0x380060(0x173)]['client'],_0x351a06[_0x380060(0x128)][_0x380060(0x13e)]),_0x351a06[_0x380060(0x14f)][_0x380060(0x10a)](_0x4b556a,_0x4b556a['__'](_0x380060(0x15b)));}})[_0x2d7495(0x114)](_0x586491=>{const _0x4916c6=_0x2d7495;return console[_0x4916c6(0x155)](_0x586491),_0x351a06['app']['returnErrMsg'](_0x4b556a,_0x4b556a['__']('operationFail'));});}),router[_0x44c6c5(0x189)]('/tokenLogin',(_0x32a0ec,_0x1d7677,_0x338995)=>{const _0x4f5d47=_0x44c6c5;let _0x1ad854=netUtils[_0x4f5d47(0x116)](_0x32a0ec),_0x389e2f=_0x32a0ec[_0x4f5d47(0x173)][_0x4f5d47(0x121)];if(!_0x389e2f)return _0x32a0ec[_0x4f5d47(0x14f)][_0x4f5d47(0x10a)](_0x1d7677,_0x4f5d47(0xd2));let _0x36eae2=dbUserTable[_0x4f5d47(0xad)](_0x32a0ec[_0x4f5d47(0x14f)][_0x4f5d47(0x16d)],_0x389e2f);if(!_0x36eae2)return _0x32a0ec['app'][_0x4f5d47(0x10a)](_0x1d7677,_0x1d7677['__'](_0x4f5d47(0x13d)));return _0x36eae2[_0x4f5d47(0xd9)]='',_0x36eae2[_0x4f5d47(0xa8)]='',_0x1d7677[_0x4f5d47(0xa6)]({'code':0x0,'token':_0x389e2f,'user':_0x36eae2,'reqIp':_0x1ad854});}),router[_0x44c6c5(0x189)](_0x44c6c5(0x17a),(_0x5d738c,_0x4eb620,_0x4df84a)=>{const _0x44cc63=_0x44c6c5;let _0x550e01=_0x5d738c['body'][_0x44cc63(0xd9)];if(_0x5d738c[_0x44cc63(0x125)]&&_0x5d738c[_0x44cc63(0x125)][_0x44cc63(0xd4)]!=0x1)return _0x4eb620[_0x44cc63(0xa6)]({'code':0x66});cryptoUtils[_0x44cc63(0x170)](config[_0x44cc63(0x15a)],_0x550e01)[_0x44cc63(0x164)](_0x2e9d48=>{const _0x4b0896=_0x44cc63;if(_0x5d738c['currentUser'][_0x4b0896(0xd9)]!=_0x2e9d48)return _0x4eb620[_0x4b0896(0xa6)]({'code':0x1,'message':_0x4eb620['__'](_0x4b0896(0x126))});fs['rm'](path[_0x4b0896(0x117)](config[_0x4b0896(0xab)]),{'recursive':!![]},_0x9be966=>{const _0x1b0e21=_0x4b0896;if(_0x9be966)return _0x4eb620[_0x1b0e21(0xa6)]({'code':0x1,'message':_0x1b0e21(0xca)});return _0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)]['prepare']('DELETE\x20FROM\x20config')['run'](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x17e))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20backup_task')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x174))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x15c))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0xc3))['run'](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)]['prepare'](_0x1b0e21(0xdd))[_0x1b0e21(0x105)](),_0x5d738c['app']['dbOther'][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20file_operation_record')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)]['prepare'](_0x1b0e21(0xb3))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x103))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x11d))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0xc7))[_0x1b0e21(0x105)](),_0x5d738c['app'][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x171))['run'](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x113))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)]['dbOther'][_0x1b0e21(0xa7)](_0x1b0e21(0x14d))[_0x1b0e21(0x105)](),_0x5d738c['app'][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x157))[_0x1b0e21(0x105)](),_0x5d738c['app'][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x123))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0x12e))[_0x1b0e21(0x105)](),_0x5d738c['app'][_0x1b0e21(0x16d)]['prepare'](_0x1b0e21(0x17c))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)](_0x1b0e21(0xd7))['run'](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20user_token')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x16d)][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20user_power')['run'](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)]['prepare']('DELETE\x20FROM\x20ai_classes')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)]['prepare'](_0x1b0e21(0x144))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0xee))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0x172))[_0x1b0e21(0x105)](),_0x5d738c['app'][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0xc0))[_0x1b0e21(0x105)](),_0x5d738c['app'][_0x1b0e21(0x178)][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20file_index_photo')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)]['dbFileIndex'][_0x1b0e21(0xa7)](_0x1b0e21(0xc5))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0xce))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)]['prepare']('DELETE\x20FROM\x20photo_faces')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20photo_faces2index')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0x168))['run'](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0x150))['run'](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0xbb))[_0x1b0e21(0x105)](),_0x5d738c['app'][_0x1b0e21(0x178)]['prepare']('DELETE\x20FROM\x20movie_library')[_0x1b0e21(0x105)](),_0x5d738c['app']['dbFileIndex'][_0x1b0e21(0xa7)](_0x1b0e21(0xea))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)](_0x1b0e21(0x134))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20music_playlist')[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)]['prepare'](_0x1b0e21(0x184))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)]['dbFileIndex'][_0x1b0e21(0xa7)](_0x1b0e21(0xe5))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)][_0x1b0e21(0x178)]['prepare'](_0x1b0e21(0x122))[_0x1b0e21(0x105)](),_0x5d738c[_0x1b0e21(0x14f)]['dbFileIndex'][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20book_list_index')[_0x1b0e21(0x105)](),_0x5d738c['app']['dbFileIndex'][_0x1b0e21(0xa7)]('DELETE\x20FROM\x20book_read_record')[_0x1b0e21(0x105)](),process[_0x1b0e21(0xd6)]({'type':_0x1b0e21(0x12d),'shareType':_0x1b0e21(0x13c)}),process[_0x1b0e21(0xd6)]({'type':_0x1b0e21(0x12d),'shareType':_0x1b0e21(0x158)}),process['send']({'type':'nasProxyRestart'}),process[_0x1b0e21(0xd6)]({'type':_0x1b0e21(0xed)}),_0x4eb620[_0x1b0e21(0xa6)]({'code':0x0});});});}),router[_0x44c6c5(0x189)](_0x44c6c5(0x132),(_0xde0413,_0x5e8b01,_0x103ba4)=>{const _0xff174c=_0x44c6c5;let _0x250f13=netUtils['getClientIp'](_0xde0413),_0x5a99ad=dbUserTable['getAdmin'](_0xde0413[_0xff174c(0x14f)][_0xff174c(0x16d)]),_0x3bca9c={};_0x250f13=='localhost'&&(_0x3bca9c[_0xff174c(0x111)]=_0x5a99ad[_0xff174c(0x111)]),_0x3bca9c[_0xff174c(0x120)]=_0x5a99ad[_0xff174c(0x120)],_0x5e8b01[_0xff174c(0xa6)]({'code':0x0,'data':_0x3bca9c});}),router[_0x44c6c5(0x16f)]('/checkIsNasServer',(_0xb3223e,_0x2fefe3,_0x7696f5)=>{const _0x287738=_0x44c6c5;let _0x3761f5={'code':0x0,'message':_0x287738(0xdf),'version':package['version'],'hostName':OS[_0x287738(0xbe)]()},_0x11e2a1=_0xb3223e[_0x287738(0xe9)]['ignoreIp'];if(_0x11e2a1&&_0x11e2a1==0x1)return _0x2fefe3[_0x287738(0xa6)](_0x3761f5);let _0x3aec16=0x50,_0x586872=dbConfigTable[_0x287738(0xc8)](_0xb3223e[_0x287738(0x14f)][_0x287738(0x16d)],_0x287738(0x14a));_0x586872&&_0x586872[_0x287738(0xc2)]&&(_0x3aec16=_0x586872[_0x287738(0xc2)]);let _0x42a2c8=0x1bb,_0x35ac19=dbConfigTable[_0x287738(0xc8)](_0xb3223e['app'][_0x287738(0x16d)],'apiPortHttps');_0x35ac19&&_0x35ac19[_0x287738(0xc2)]&&_0x35ac19[_0x287738(0xc2)]>0x0&&_0x35ac19['value']<0xffff&&(_0x42a2c8=_0x35ac19[_0x287738(0xc2)]);let _0x1ad6b0=0x0,_0x45d25d=dbConfigTable['findByTitle'](_0xb3223e['app'][_0x287738(0x16d)],_0x287738(0xb6));if(_0x45d25d&&_0x45d25d[_0x287738(0xc2)])try{_0x45d25d=JSON[_0x287738(0xb5)](_0x45d25d[_0x287738(0xc2)]),_0x45d25d['state']==_0x287738(0x105)&&(_0x1ad6b0=0x1);}catch(_0x1ea2c7){}try{let _0x2a72af=dbConfigTable[_0x287738(0xc8)](_0xb3223e[_0x287738(0x14f)]['dbOther'],_0x287738(0x149)),_0x150229=dbConfigTable[_0x287738(0xc8)](_0xb3223e[_0x287738(0x14f)][_0x287738(0x16d)],_0x287738(0xc1));if(_0x2a72af){_0x2a72af=JSON[_0x287738(0xb5)](_0x2a72af[_0x287738(0xc2)]);let _0x4abe3e=[];if(_0x150229&&_0x150229[_0x287738(0xc2)]){for(let _0x4278c in _0x2a72af){let _0x283357=_0x2a72af[_0x4278c];_0x283357[_0x287738(0xef)]==_0x287738(0x167)&&_0x4abe3e['push'](_0x283357);}_0x4abe3e[_0x287738(0x15e)]({'type':'ipv6','ip':_0x150229[_0x287738(0xc2)],'ddns':0x1}),_0x2a72af=_0x4abe3e;}}return _0x3761f5['ipList']=_0x2a72af,_0x3761f5['apiPort']=parseInt(_0x3aec16),_0x3761f5[_0x287738(0xbc)]=parseInt(_0x42a2c8),_0x3761f5[_0x287738(0xbf)]=_0x1ad6b0,_0x2fefe3[_0x287738(0xa6)](_0x3761f5);}catch(_0x500d2e){return _0x2fefe3['json'](_0x3761f5);}}),router['post']('/resetPwd',(_0x455ce5,_0x44fbac,_0x222f98)=>{const _0x247e4c=_0x44c6c5;let _0x436b4b=_0x455ce5['body']['username'],_0x4cd9f1=_0x455ce5['body'][_0x247e4c(0xd9)],_0x43c9f6=_0x455ce5[_0x247e4c(0x173)]['answer'],_0x5be8e5=_0x455ce5[_0x247e4c(0x14f)]['dbOther']['prepare'](_0x247e4c(0xb7))[_0x247e4c(0x16e)](_0x436b4b);if(!_0x5be8e5)return _0x455ce5[_0x247e4c(0x14f)][_0x247e4c(0x10a)](_0x44fbac,_0x44fbac['__']('userNotExist'));try{_0x43c9f6=sha256(_0x43c9f6);let _0x3997af=dbUserTable[_0x247e4c(0xf1)](_0x455ce5[_0x247e4c(0x14f)][_0x247e4c(0x16d)],_0x436b4b,_0x43c9f6);if(_0x3997af)cryptoUtils['encryptString'](config[_0x247e4c(0x15a)],_0x4cd9f1)['then'](_0x3e3204=>{const _0x4eff04=_0x247e4c;dbUserTable['updateByUsername'](_0x455ce5[_0x4eff04(0x14f)][_0x4eff04(0x16d)],_0x436b4b,_0x4eff04(0xd9),_0x3e3204);let _0x4fdde5=sha256(new Date()[_0x4eff04(0x16a)]()+_0x436b4b+_0x4cd9f1);dbUserTable[_0x4eff04(0x147)](_0x455ce5['app'][_0x4eff04(0x16d)],_0x436b4b,_0x4eff04(0x121),_0x4fdde5),_0x44fbac['json']({'code':0x0});})[_0x247e4c(0x114)](_0x1f1e0c=>{const _0xca9374=_0x247e4c;return console[_0xca9374(0x155)]('error',_0x1f1e0c),_0x455ce5[_0xca9374(0x14f)][_0xca9374(0x10a)](_0x44fbac,_0x44fbac['__'](_0xca9374(0xd8)));});else return _0x455ce5[_0x247e4c(0x14f)]['returnErrMsg'](_0x44fbac,_0x44fbac['__']('login.answerIsWrong'));}catch(_0x199bab){return console['log'](_0x247e4c(0x101),_0x199bab),_0x44fbac[_0x247e4c(0x148)](0x194)[_0x247e4c(0xae)]();}});function newUserCheck(_0x673f05,_0x1ecea0,_0x41d1ff,_0x28076,_0x56132a,_0x49ce98){const _0x4ff27c=_0x44c6c5;if(!_0x28076||!_0x41d1ff||!_0x673f05||!_0x1ecea0)return _0x56132a['app'][_0x4ff27c(0x10a)](_0x49ce98,_0x49ce98['__']('newUserParamsNull'));let _0x47e791=new RegExp('^[0-9a-zA-Z]*$');if(!_0x47e791['test'](_0x673f05)||_0x673f05==config[_0x4ff27c(0xe6)])return _0x56132a[_0x4ff27c(0x14f)][_0x4ff27c(0x10a)](_0x49ce98,_0x49ce98['__'](_0x4ff27c(0x102)));if(_0x673f05==_0x1ecea0)return _0x56132a['app']['returnErrMsg'](_0x49ce98,_0x49ce98['__'](_0x4ff27c(0x10e)));if(checkUtil[_0x4ff27c(0xe2)](_0x673f05))return _0x56132a['app'][_0x4ff27c(0x10a)](_0x49ce98,_0x49ce98['__'](_0x4ff27c(0x159)));if(_0x41d1ff==_0x28076)return _0x56132a[_0x4ff27c(0x14f)][_0x4ff27c(0x10a)](_0x49ce98,_0x49ce98['__'](_0x4ff27c(0x118)));if(checkUtil[_0x4ff27c(0xfd)](_0x1ecea0))return _0x56132a[_0x4ff27c(0x14f)][_0x4ff27c(0x10a)](_0x49ce98,_0x49ce98['__'](_0x4ff27c(0x15f)));return!![];}function _0x38d2(){const _0x2c9220=['createUserFolder','DELETE\x20FROM\x20album_ordinary','type','\x20order\x20by\x20id\x20desc\x20limit\x20?\x20offset\x20?','checkAnswer','need\x20username/menuList','desc','dialog','deleteIp','getUserCount','6077038sdPKZX','refreshIpList','testCount','../../../package.json','searchKey','find','isIncludeChinese','security.thisIpCannotAddList','getUserByUserName','728868xzvrlL','err','usernameReg','DELETE\x20FROM\x20file_share','answerNotSeqNumOrChar','run','login.oldPwdErr','login.pwdErrCountTooMuch','localhost','getRecordCountByWhere','returnErrMsg','/removeUser','account.subAccountMax','login.tooManyPwdTestIpBan','usernameAndPwdCannotBeSame','/getIpList','findByTitleArr','username','7AAeKea','DELETE\x20FROM\x20notice_center','catch','username\x20error','getClientIp','join','answerQuestionCannotBeSame','exports','page','\x20id\x20in(SELECT\x20id\x20FROM\x20login_record\x20ORDER\x20BY\x20id\x20LIMIT\x20','banTimeStamp','DELETE\x20FROM\x20file_share_user','sub_account_num','/setUserPower','question','token','DELETE\x20FROM\x20book_list','DELETE\x20FROM\x20private_space_token','login.loginFailAlert','currentUser','login.pwdErr','\x20WHERE\x20username\x20like\x20?\x20or\x20user_remark\x20like\x20?','headers','getUserPower','length','/getRecordList','orderField','fileShareRestart','DELETE\x20FROM\x20share_temp','43371RZnkHr','includes','decodeBase64','/resetPwdInfo','../../db/dbConfigTable','DELETE\x20FROM\x20music_favorite','deletePowerByUsername','2490bcUAnb','\x20end_timestamp\x20is\x20not\x20null\x20and\x20end_timestamp<','error','ipBan','../utils/cryptoUtils','startsWith','FTP','TokenExpired','user-agent','updateRemarkByUsername','create','getAdmin','changePassword','126635kWvtKR','DELETE\x20FROM\x20ai_classes2index','remark','Router','updateByUsername','status','globalIpList','apiPort','SELECT\x20id,username,is_admin,user_remark\x20FROM\x20user\x20','updateQuestionById','DELETE\x20FROM\x20play_record','menuList','app','DELETE\x20FROM\x20movie_collection','7153sMMJWV','11723632HlaEZB','login.sameUsernameExist','path','log','\x20order\x20by\x20id\x20desc\x20limit\x20','DELETE\x20FROM\x20private_space','WebDav','usernameTooEasy','passwordKey','login.wrongNameOrPwd','DELETE\x20FROM\x20backup_task_record','You\x20can\x27t\x20delete\x20admin\x20account','push','pwdCannotBeChinese','freeVersionSubuserCount','\x201=1','login.adminExist','deleteUserTokenByWhere','then','menus','\x20WHERE\x20token\x20=?','ipv4','DELETE\x20FROM\x20movie_keys','44UZAkBQ','getTime','path.parentPathExist','black','dbOther','get','all','encryptString','DELETE\x20FROM\x20login_record','DELETE\x20FROM\x20album_ordinary_index','body','DELETE\x20FROM\x20backup_task_msg','createToken','exist','changes','dbFileIndex','deleteFavoriteByUid','/resetSystem','addIpToList','DELETE\x20FROM\x20source_folder','../../db/dbLoginTable','DELETE\x20FROM\x20album','\x20offset\x20','getVipInfo','../../myConfig/config','stringify','server_type','DELETE\x20FROM\x20music_playlist_index','enable','stat','pageSize','72ZdGPRI','post','newPassword','json','prepare','answer','../../db/dbNoticeCenterTable','ceil','cacheParentPath','\x20type=?','getUserByToken','end','twoStepLogin','419400Xlvgry','express','sep','DELETE\x20FROM\x20file_record','/hasAdmin','parse','apiServerHttps','SELECT\x20*\x20FROM\x20user\x20WHERE\x20username=?','login','params\x20error','newQuestion','DELETE\x20FROM\x20movie_history','apiPortHttps','createOrUpdatePower','hostname','httpsIsRunning','DELETE\x20FROM\x20file_index_movie','ddnsIpv6Address','value','DELETE\x20FROM\x20bg_task','/getCurrentUserInfo','DELETE\x20FROM\x20file_index_music','102FzmAHK','DELETE\x20FROM\x20login_ip_list','findByTitle','user_remark','Error','/addIpToList','/changeQuestion','client','DELETE\x20FROM\x20file_index_book','findByUsername','asc','/logout','Need\x20token','uid','is_admin','addLoginRecord','send','DELETE\x20FROM\x20user','operationFail','password','../../db/dbMusicIndexTable','(\x27customLogoImage\x27,\x27customLoginTitle\x27,\x27customLoginImage\x27,\x27customHomeBgImage\x27)','updateById','DELETE\x20FROM\x20config\x20where\x20title\x20in\x20(\x27nasAccountInfo\x27)','getIpListCountByWhere','NodeNasServer','login.adminAdded','../utils/nasAccountUtils','isEasyUsername','../../db/dbMusicFavorite','count','DELETE\x20FROM\x20book_favorite','publicUserName','version','/remarkUser','query','DELETE\x20FROM\x20photo_phash_similar','../../db/dbUserTable','isAdmin'];_0x38d2=function(){return _0x2c9220;};return _0x38d2();}router[_0x44c6c5(0x189)]('/registAdmin',(_0x2f0849,_0x50f254,_0x383908)=>{const _0x56f1f7=_0x44c6c5;let _0x165bbc=_0x2f0849[_0x56f1f7(0x173)]['username'],_0x26cce4=_0x2f0849[_0x56f1f7(0x173)][_0x56f1f7(0xd9)],_0x4ecadf=_0x2f0849[_0x56f1f7(0x173)][_0x56f1f7(0x120)],_0x4f3386=_0x2f0849[_0x56f1f7(0x173)][_0x56f1f7(0xa8)];if(!_0x4f3386||!_0x4ecadf||!_0x165bbc||!_0x26cce4)return _0x50f254[_0x56f1f7(0xa6)]({'code':0x1,'message':_0x56f1f7(0xb9)});let _0x5361e1=dbUserTable[_0x56f1f7(0x141)](_0x2f0849[_0x56f1f7(0x14f)][_0x56f1f7(0x16d)]);if(_0x5361e1)_0x50f254['json']({'code':0x1,'message':_0x50f254['__'](_0x56f1f7(0x162))});else{if(newUserCheck(_0x165bbc,_0x26cce4,_0x4ecadf,_0x4f3386,_0x2f0849,_0x50f254)!==!![])return;_0x4f3386=sha256(_0x4f3386),cryptoUtils[_0x56f1f7(0x170)](config[_0x56f1f7(0x15a)],_0x26cce4)[_0x56f1f7(0x164)](_0x14be74=>{const _0x318184=_0x56f1f7;let _0x47768f=dbUserTable['create'](_0x2f0849[_0x318184(0x14f)]['dbOther'],{'username':_0x165bbc,'password':_0x14be74,'question':_0x4ecadf,'answer':_0x4f3386,'is_admin':0x1});if(_0x47768f[_0x318184(0x177)]>0x0){let _0x15bf48=dbUserTable['getAdmin'](_0x2f0849['app'][_0x318184(0x16d)]),_0x9da736=sha256(new Date()[_0x318184(0x16a)]()+_0x165bbc+_0x14be74),_0x35e9bc=netUtils[_0x318184(0x116)](_0x2f0849);var _0x15ea98=_0x2f0849[_0x318184(0x128)][_0x318184(0x13e)];return dbUserTable[_0x318184(0x175)](_0x2f0849[_0x318184(0x14f)][_0x318184(0x16d)],_0x15bf48['id'],_0x9da736,_0x35e9bc,_0x15ea98),_0x15bf48[_0x318184(0xd9)]='',_0x50f254[_0x318184(0xa6)]({'code':0x0,'token':_0x9da736,'user':_0x15bf48});}})[_0x56f1f7(0x114)](_0x466c63=>{const _0x3910e9=_0x56f1f7;return console['log'](_0x3910e9(0x138),_0x466c63),_0x2f0849[_0x3910e9(0x14f)][_0x3910e9(0x10a)](_0x50f254,_0x50f254['__'](_0x3910e9(0xd8)));});}}),router[_0x44c6c5(0x189)](_0x44c6c5(0xe8),(_0x5a8b73,_0x273f3f,_0x2576d2)=>{const _0x8572a3=_0x44c6c5;if(_0x5a8b73[_0x8572a3(0x125)][_0x8572a3(0xd4)]!=0x1)return _0x273f3f['json']({'code':0x66});let _0x197717=_0x5a8b73['body'][_0x8572a3(0x111)],_0x576c28=_0x5a8b73[_0x8572a3(0x173)][_0x8572a3(0x145)];return _0x197717&&_0x576c28&&dbUserTable[_0x8572a3(0x13f)](_0x5a8b73[_0x8572a3(0x14f)]['dbOther'],_0x197717,_0x576c28),_0x273f3f[_0x8572a3(0xa6)]({'code':0x0});}),router[_0x44c6c5(0x189)]('/addUser',(_0x15a084,_0x501870,_0x418533)=>{const _0x5ee518=_0x44c6c5;nasAccountUtil[_0x5ee518(0x180)](_0x15a084[_0x5ee518(0x14f)][_0x5ee518(0x16d)])[_0x5ee518(0x164)](_0x11cdc4=>{const _0x116484=_0x5ee518;let _0x145ddf=dbUserTable[_0x116484(0xf6)](_0x15a084[_0x116484(0x14f)]['dbOther']);if(!_0x11cdc4){if(_0x145ddf>=parseInt(config['freeVersionSubuserCount'])+0x1){let _0x2af316=dbUserTable[_0x116484(0xff)](_0x15a084[_0x116484(0x14f)][_0x116484(0x16d)],_0x15a084[_0x116484(0x173)]['username']);if(!_0x2af316)return _0x15a084[_0x116484(0x14f)][_0x116484(0x10a)](_0x501870,_0x501870['__']('account.subAccountMax'));}_0x14f267();}else{if(_0x11cdc4[_0x116484(0xef)]<0x2&&_0x11cdc4[_0x116484(0x11e)]&&_0x145ddf>=parseInt(_0x11cdc4[_0x116484(0x11e)])+0x1)return _0x15a084[_0x116484(0x14f)][_0x116484(0x10a)](_0x501870,_0x501870['__'](_0x116484(0x10c)));else _0x14f267();}function _0x14f267(){const _0x475930=_0x116484;let _0x7d2159=_0x15a084[_0x475930(0x173)][_0x475930(0x111)],_0x329af1=_0x15a084['body']['password'],_0x40953d=_0x15a084[_0x475930(0x173)]['question'],_0x1fd37b=_0x15a084['body'][_0x475930(0xa8)],_0x31f878=_0x15a084[_0x475930(0x173)][_0x475930(0x145)];if(newUserCheck(_0x7d2159,_0x329af1,_0x40953d,_0x1fd37b,_0x15a084,_0x501870)!==!![])return;let _0x1cf091=_0x15a084[_0x475930(0x173)][_0x475930(0xef)];if(dbUserTable[_0x475930(0xec)](_0x15a084,_0x501870)===!![]){if(_0x1cf091=='add'){let _0x54125c=dbUserTable[_0x475930(0xcf)](_0x15a084[_0x475930(0x14f)][_0x475930(0x16d)],_0x7d2159);if(_0x54125c)return _0x15a084['app'][_0x475930(0x10a)](_0x501870,_0x501870['__'](_0x475930(0x153)));}cryptoUtils[_0x475930(0x170)](config[_0x475930(0x15a)],_0x329af1)['then'](_0x5b3c79=>{const _0x29d147=_0x475930;let _0x5d44b5=dbUserTable['create'](_0x15a084['app'][_0x29d147(0x16d)],{'username':_0x7d2159,'password':_0x5b3c79,'question':_0x40953d,'answer':sha256(_0x1fd37b),'remark':_0x31f878});return _0x5d44b5[_0x29d147(0x177)]>=0x1?_0x501870[_0x29d147(0xa6)]({'code':0x0}):_0x15a084[_0x29d147(0x14f)]['returnErrMsg'](_0x501870,_0x501870['__'](_0x29d147(0xd8)));})[_0x475930(0x114)](_0x5a8e75=>{const _0xb3b0c2=_0x475930;return console['log'](_0xb3b0c2(0x138),_0x5a8e75),_0x15a084[_0xb3b0c2(0x14f)]['returnErrMsg'](_0x501870,_0x501870['__'](_0xb3b0c2(0xd8)));});}}});}),router[_0x44c6c5(0x189)](_0x44c6c5(0x10b),(_0x3ed6a1,_0x57cdf2,_0x1155c4)=>{const _0x22c1ca=_0x44c6c5;let _0x4e9991=_0x3ed6a1['body'][_0x22c1ca(0xd3)];if(dbUserTable[_0x22c1ca(0xec)](_0x3ed6a1,_0x57cdf2)===!![]){let _0x4dd973=dbUserTable[_0x22c1ca(0xfc)](_0x3ed6a1[_0x22c1ca(0x14f)][_0x22c1ca(0x16d)],_0x4e9991);if(_0x4dd973&&_0x4dd973[_0x22c1ca(0xd4)]==0x1)return _0x57cdf2[_0x22c1ca(0xa6)]({'code':0x1,'message':_0x22c1ca(0x15d)});dbUserTable[_0x22c1ca(0x135)](_0x3ed6a1[_0x22c1ca(0x14f)][_0x22c1ca(0x16d)],_0x4dd973[_0x22c1ca(0x111)]),dbMusicIndexTable['removeUserPlayList'](_0x3ed6a1['app']['dbFileIndex'],_0x4dd973['id']),dbMusicFavorite[_0x22c1ca(0x179)](_0x3ed6a1['app'][_0x22c1ca(0x178)],_0x4dd973['id']),dbMovieFavorite[_0x22c1ca(0x179)](_0x3ed6a1[_0x22c1ca(0x14f)][_0x22c1ca(0x178)],_0x4dd973['id']);let _0x2d0a19=dbUserTable['delete'](_0x3ed6a1[_0x22c1ca(0x14f)][_0x22c1ca(0x16d)],_0x4e9991);return _0x2d0a19[_0x22c1ca(0x177)]>=0x1?_0x57cdf2['json']({'code':0x0}):_0x3ed6a1[_0x22c1ca(0x14f)]['returnErrMsg'](_0x57cdf2,_0x57cdf2['__'](_0x22c1ca(0xd8)));}}),router['post']('/getAllUser',(_0x3b76ae,_0x11eacd,_0x3f5a59)=>{const _0x4d955f=_0x44c6c5;if(dbUserTable[_0x4d955f(0xec)](_0x3b76ae,_0x11eacd)===!![]){let _0x21b677=_0x3b76ae[_0x4d955f(0x173)][_0x4d955f(0x12c)]||'id',_0x5056e0=_0x3b76ae[_0x4d955f(0x173)]['orderType']||_0x4d955f(0xd0),_0x1e534c=_0x3b76ae[_0x4d955f(0x173)][_0x4d955f(0xfb)];(!['id',_0x4d955f(0x111),_0x4d955f(0xc9)]['includes'](_0x21b677)||![_0x4d955f(0xd0),_0x4d955f(0xf3)][_0x4d955f(0x130)](_0x5056e0))&&(_0x21b677='id',_0x5056e0=_0x4d955f(0xd0));let _0x3bfc4d=_0x4d955f(0x14b),_0x364fdd=[];_0x1e534c&&(_0x3bfc4d+=_0x4d955f(0x127),_0x364fdd[_0x4d955f(0x15e)]('%'+_0x1e534c+'%','%'+_0x1e534c+'%'));_0x3bfc4d+='\x20ORDER\x20BY\x20'+_0x21b677+'\x20'+_0x5056e0;let _0x3f0254=_0x3b76ae['app']['dbOther'][_0x4d955f(0xa7)](_0x3bfc4d)[_0x4d955f(0x16f)](_0x364fdd);return _0x11eacd[_0x4d955f(0xa6)]({'code':0x0,'userList':_0x3f0254});}}),router[_0x44c6c5(0x189)]('/getUserPower',(_0x369e06,_0x46ed2f,_0x50d638)=>{const _0x29dbe2=_0x44c6c5;let _0x1c6f61=_0x369e06['body'][_0x29dbe2(0x111)],_0x3c4fd3=null;if(_0x1c6f61!=config['publicUserName']){_0x3c4fd3=dbUserTable['getUserByUserName'](_0x369e06[_0x29dbe2(0x14f)][_0x29dbe2(0x16d)],_0x1c6f61);if(!_0x3c4fd3)return _0x369e06[_0x29dbe2(0x14f)][_0x29dbe2(0x10a)](_0x46ed2f,'username\x20error');}if(dbUserTable['isAdmin'](_0x369e06,_0x46ed2f)===!![]||_0x1c6f61==_0x369e06[_0x29dbe2(0x125)][_0x29dbe2(0x111)]){let _0x19217d=dbUserTable[_0x29dbe2(0x129)](_0x369e06['app'][_0x29dbe2(0x16d)],_0x1c6f61,null,null,!![]),_0x46993e=0x0;if(_0x19217d[_0x29dbe2(0x12a)]<0x1)return _0x46ed2f['json']({'code':0x0,'userPower':_0x19217d,'userMenu':_0x3c4fd3?_0x3c4fd3[_0x29dbe2(0x165)]:[]});for(let _0x4a9955=0x0;_0x4a9955<_0x19217d[_0x29dbe2(0x12a)];_0x4a9955++){let _0x35a59d=_0x19217d[_0x4a9955][_0x29dbe2(0x154)];fs[_0x29dbe2(0x186)](_0x35a59d,(_0x2aef80,_0x220398)=>{const _0x443998=_0x29dbe2;_0x46993e+=0x1;_0x2aef80?_0x19217d[_0x4a9955][_0x443998(0x176)]=0x0:_0x19217d[_0x4a9955][_0x443998(0x176)]=0x1;if(_0x46993e==_0x19217d[_0x443998(0x12a)])return _0x46ed2f[_0x443998(0xa6)]({'code':0x0,'userPower':_0x19217d,'userMenu':_0x3c4fd3?_0x3c4fd3[_0x443998(0x165)]:[]});});}}}),router[_0x44c6c5(0x189)](_0x44c6c5(0x11f),(_0x4fbb5,_0x108cf1,_0x1c82c1)=>{const _0x696ea8=_0x44c6c5;let _0x1e3803=_0x4fbb5[_0x696ea8(0x173)]['username'],_0x10e205=_0x4fbb5['body'][_0x696ea8(0x154)],_0x32cfc3=_0x4fbb5[_0x696ea8(0x173)][_0x696ea8(0x183)];if(!_0x1e3803||!_0x10e205||!_0x32cfc3)return _0x4fbb5[_0x696ea8(0x14f)][_0x696ea8(0x10a)](_0x108cf1,_0x108cf1['__']('operationFail'));let _0x414d71=null;if(_0x1e3803!=config[_0x696ea8(0xe6)]){_0x414d71=dbUserTable[_0x696ea8(0xff)](_0x4fbb5[_0x696ea8(0x14f)][_0x696ea8(0x16d)],_0x1e3803);if(!_0x414d71)return _0x4fbb5[_0x696ea8(0x14f)][_0x696ea8(0x10a)](_0x108cf1,_0x696ea8(0x115));}_0x10e205=pathUtil['join'](_0x10e205);if(dbUserTable[_0x696ea8(0xec)](_0x4fbb5,_0x108cf1)===!![]){let _0x3f6b31=dbUserTable[_0x696ea8(0x129)](_0x4fbb5['app'][_0x696ea8(0x16d)],_0x1e3803,_0x32cfc3,null,!![]);for(let _0x8160b8 of _0x3f6b31){let _0x2eefdc=_0x8160b8[_0x696ea8(0x154)];if(_0x10e205['startsWith'](pathUtil['join'](_0x2eefdc,pathUtil['sep']))&&_0x10e205!=_0x2eefdc)return _0x4fbb5['app'][_0x696ea8(0x10a)](_0x108cf1,_0x108cf1['__'](_0x696ea8(0x16b))+_0x2eefdc,'dialog');if(_0x2eefdc[_0x696ea8(0x13b)](pathUtil['join'](_0x10e205,pathUtil[_0x696ea8(0xb2)]))&&_0x10e205!=_0x2eefdc)return _0x4fbb5[_0x696ea8(0x14f)][_0x696ea8(0x10a)](_0x108cf1,_0x108cf1['__']('path.parentPathExist')+_0x2eefdc,_0x696ea8(0xf4));}let _0x3e5252=dbUserTable[_0x696ea8(0xbd)](_0x4fbb5[_0x696ea8(0x14f)]['dbOther'],_0x4fbb5[_0x696ea8(0x173)]);return _0x108cf1[_0x696ea8(0xa6)]({'code':0x0,'result':_0x3e5252});}}),router[_0x44c6c5(0x189)]('/setUserMenu',(_0x58e442,_0x5f3cbf,_0x4cc55b)=>{const _0x5d1e65=_0x44c6c5;let _0x419294=_0x58e442['body'][_0x5d1e65(0x111)],_0x16ce11=_0x58e442[_0x5d1e65(0x173)][_0x5d1e65(0x14e)];if(!_0x419294||!(_0x16ce11 instanceof Array))return _0x58e442['app'][_0x5d1e65(0x10a)](_0x5f3cbf,_0x5d1e65(0xf2));let _0x285c6b=dbUserTable[_0x5d1e65(0xff)](_0x58e442[_0x5d1e65(0x14f)]['dbOther'],_0x419294);if(!_0x285c6b)return _0x58e442[_0x5d1e65(0x14f)][_0x5d1e65(0x10a)](_0x5f3cbf,'username\x20error');if(dbUserTable[_0x5d1e65(0xec)](_0x58e442,_0x5f3cbf)===!![])return dbUserTable[_0x5d1e65(0x147)](_0x58e442[_0x5d1e65(0x14f)][_0x5d1e65(0x16d)],_0x419294,_0x5d1e65(0x165),JSON[_0x5d1e65(0x182)](_0x16ce11)),_0x5f3cbf[_0x5d1e65(0xa6)]({'code':0x0});}),router['post']('/cancelUserPathPower',(_0x16e26c,_0xbb4a31,_0x29801a)=>{const _0x1a3a6a=_0x44c6c5;let _0x269933=dbUserTable['cancelUserPathPower'](_0x16e26c[_0x1a3a6a(0x14f)]['dbOther'],_0x16e26c[_0x1a3a6a(0x173)]);return _0x269933[_0x1a3a6a(0x177)]>0x0?_0xbb4a31[_0x1a3a6a(0xa6)]({'code':0x0}):_0x16e26c['app'][_0x1a3a6a(0x10a)](_0xbb4a31,_0xbb4a31['__']('operationFail'));}),router['post']('/changePassword',(_0x28f6c1,_0x469c49,_0xae8b79)=>{const _0x5cddbf=_0x44c6c5;let _0x31253f=_0x28f6c1[_0x5cddbf(0x173)]['oldPassword'],_0x1ff210=_0x28f6c1[_0x5cddbf(0x173)][_0x5cddbf(0xa5)];cryptoUtils[_0x5cddbf(0x170)](config['passwordKey'],_0x31253f)['then'](_0x122a7b=>{const _0x597ad7=_0x5cddbf;if(_0x28f6c1[_0x597ad7(0x125)][_0x597ad7(0xd9)]!=_0x122a7b)return _0x469c49[_0x597ad7(0xa6)]({'code':0x2,'message':_0x469c49['__'](_0x597ad7(0x106))});else cryptoUtils[_0x597ad7(0x170)](config[_0x597ad7(0x15a)],_0x1ff210)[_0x597ad7(0x164)](_0x4cc230=>{const _0x2915a0=_0x597ad7;dbUserTable[_0x2915a0(0xdc)](_0x28f6c1[_0x2915a0(0x14f)]['dbOther'],_0x28f6c1[_0x2915a0(0x125)]['id'],'password',_0x4cc230);let _0x1db0fd=sha256(new Date()['getTime']()+_0x28f6c1[_0x2915a0(0x125)][_0x2915a0(0x111)]+_0x28f6c1['currentUser'][_0x2915a0(0xd9)]);dbUserTable['updateById'](_0x28f6c1[_0x2915a0(0x14f)][_0x2915a0(0x16d)],_0x28f6c1[_0x2915a0(0x125)]['id'],_0x2915a0(0x121),_0x1db0fd);let _0x525e3c=netUtils[_0x2915a0(0x116)](_0x28f6c1);return dbLoginTable[_0x2915a0(0xd5)](_0x28f6c1[_0x2915a0(0x14f)][_0x2915a0(0x16d)],_0x2915a0(0x142),_0x28f6c1[_0x2915a0(0x125)]['id'],_0x525e3c,_0x28f6c1['body']['client'],''),_0x469c49[_0x2915a0(0xa6)]({'code':0x0});})[_0x597ad7(0x114)](_0xb1aaf9=>{const _0x2a8bc5=_0x597ad7;return console[_0x2a8bc5(0x155)](_0x2a8bc5(0x138),_0xb1aaf9),_0x28f6c1['app']['returnErrMsg'](_0x469c49,_0x469c49['__'](_0x2a8bc5(0xd8)));});});}),router[_0x44c6c5(0x189)](_0x44c6c5(0xcc),(_0x382bf9,_0x5f53c4,_0x2193c4)=>{const _0x3f8412=_0x44c6c5;let _0x177e34=_0x382bf9[_0x3f8412(0x173)][_0x3f8412(0xba)],_0x2d0ba1=_0x382bf9[_0x3f8412(0x173)][_0x3f8412(0xa8)];if(checkUtil['isSameStr'](_0x2d0ba1))return _0x382bf9[_0x3f8412(0x14f)]['returnErrMsg'](_0x5f53c4,_0x5f53c4['__'](_0x3f8412(0x104)));if(_0x177e34==_0x2d0ba1)return _0x382bf9[_0x3f8412(0x14f)][_0x3f8412(0x10a)](_0x5f53c4,_0x5f53c4['__'](_0x3f8412(0x118)));return dbUserTable[_0x3f8412(0x14c)](_0x382bf9['app'][_0x3f8412(0x16d)],_0x382bf9[_0x3f8412(0x125)]['id'],_0x177e34,sha256(_0x2d0ba1)),_0x5f53c4[_0x3f8412(0xa6)]({'code':0x0});}),router[_0x44c6c5(0x189)](_0x44c6c5(0xd1),(_0x7440fe,_0x25fc44,_0x32fd9b)=>{const _0x279571=_0x44c6c5;let _0x3e3b77=_0x7440fe[_0x279571(0x173)][_0x279571(0x121)];return _0x3e3b77&&dbUserTable[_0x279571(0x163)](_0x7440fe[_0x279571(0x14f)]['dbOther'],_0x279571(0x166),[_0x3e3b77]),_0x25fc44[_0x279571(0xa6)]({'code':0x0});}),router[_0x44c6c5(0x189)](_0x44c6c5(0xc4),(_0x4f529d,_0x56d898,_0x15ddf3)=>{const _0x18dc78=_0x44c6c5;let _0x45d14=dbUserTable[_0x18dc78(0xfc)](_0x4f529d[_0x18dc78(0x14f)]['dbOther'],_0x4f529d[_0x18dc78(0x125)]['id']);return _0x45d14?(_0x45d14[_0x18dc78(0xd9)]='',_0x45d14['answer']='',_0x56d898[_0x18dc78(0xa6)]({'code':0x0,'userInfo':_0x45d14})):_0x56d898['json']({'code':0x65});}),router['post'](_0x44c6c5(0xcb),(_0x5d560f,_0x3b5ffb,_0x23bea2)=>{const _0x5aa013=_0x44c6c5;if(_0x5d560f[_0x5aa013(0x125)][_0x5aa013(0xd4)]!=0x1)return _0x3b5ffb[_0x5aa013(0xa6)]({'code':0x66});let _0x542bec=_0x5d560f['body']['ip'];if(_0x542bec==_0x5aa013(0x108)||_0x542bec=='127.0.0.1')return _0x5d560f['app'][_0x5aa013(0x10a)](_0x3b5ffb,_0x3b5ffb['__'](_0x5aa013(0xfe)));let _0xc5caf5=_0x5d560f[_0x5aa013(0x173)]['type'],_0x2f96b9=_0x5d560f[_0x5aa013(0x173)][_0x5aa013(0x11c)];return dbLoginTable['addIpToList'](_0x5d560f[_0x5aa013(0x14f)][_0x5aa013(0x16d)],_0xc5caf5,_0x542bec,_0x2f96b9,_0x3b5ffb['__'](_0x5aa013(0xe0))),_0x5d560f['app'][_0x5aa013(0xf8)](),_0x3b5ffb[_0x5aa013(0xa6)]({'code':0x0});}),router[_0x44c6c5(0x189)]('/removeIp',(_0x4df7e1,_0x1d0d72,_0x1a445f)=>{const _0x38656e=_0x44c6c5;if(_0x4df7e1['currentUser']['is_admin']!=0x1)return _0x1d0d72['json']({'code':0x66});let _0x3ea0a6=_0x4df7e1[_0x38656e(0x173)]['id'];return dbLoginTable[_0x38656e(0xf5)](_0x4df7e1[_0x38656e(0x14f)]['dbOther'],_0x3ea0a6),_0x4df7e1[_0x38656e(0x14f)]['refreshIpList'](),_0x1d0d72[_0x38656e(0xa6)]({'code':0x0});}),router[_0x44c6c5(0x189)](_0x44c6c5(0x10f),(_0x249323,_0x39cb6a,_0x512486)=>{const _0x5b27a8=_0x44c6c5;let _0x54299f=_0x249323[_0x5b27a8(0x173)][_0x5b27a8(0x11a)],_0x8dcc1a=_0x249323['body']['pageSize'],_0x1aac91=_0x249323['body'][_0x5b27a8(0xef)],_0x36b18d=new Date()[_0x5b27a8(0x16a)]();dbLoginTable['deleteIpByWhere'](_0x249323[_0x5b27a8(0x14f)][_0x5b27a8(0x16d)],_0x5b27a8(0x137)+_0x36b18d);let _0x274baa='\x20type=\x27'+_0x1aac91+'\x27',_0x53acac=dbLoginTable[_0x5b27a8(0xde)](_0x249323['app'][_0x5b27a8(0x16d)],_0x274baa),_0x2330e8=(_0x54299f-0x1)*_0x8dcc1a;_0x274baa+=_0x5b27a8(0x156)+_0x8dcc1a+_0x5b27a8(0x17f)+_0x2330e8;let _0x514ac5=dbLoginTable['getAllIpListByWhere'](_0x249323['app'][_0x5b27a8(0x16d)],_0x274baa);return _0x39cb6a[_0x5b27a8(0xa6)]({'code':0x0,'data':_0x514ac5,'pageCount':Math[_0x5b27a8(0xaa)](_0x53acac[_0x5b27a8(0xe4)]/_0x8dcc1a)});}),router[_0x44c6c5(0x189)](_0x44c6c5(0x12b),(_0x1f58c3,_0x37c4ce,_0x52427b)=>{const _0x3ed9b4=_0x44c6c5;if(_0x1f58c3['currentUser']['is_admin']!=0x1)return _0x37c4ce['json']({'code':0x66});let _0x48fa52=0x1388,_0x37ace2=_0x1f58c3['body'][_0x3ed9b4(0x11a)],_0x132693=_0x1f58c3[_0x3ed9b4(0x173)][_0x3ed9b4(0x187)],_0x2e6c71=_0x1f58c3[_0x3ed9b4(0x173)][_0x3ed9b4(0xef)],_0x155f00='',_0xe08783=[];_0x2e6c71?(_0x155f00+=_0x3ed9b4(0xac),_0xe08783[_0x3ed9b4(0x15e)](_0x2e6c71)):_0x155f00=_0x3ed9b4(0x161);let _0x1a481f=dbLoginTable[_0x3ed9b4(0x109)](_0x1f58c3[_0x3ed9b4(0x14f)][_0x3ed9b4(0x16d)],_0x155f00,_0xe08783)[_0x3ed9b4(0xe4)];if(_0x1a481f>_0x48fa52){let _0x54dace=0x64,_0x4b8f0a=dbLoginTable['deleteRecordByWhere'](_0x1f58c3[_0x3ed9b4(0x14f)][_0x3ed9b4(0x16d)],_0x3ed9b4(0x11b)+_0x54dace+')');_0x4b8f0a['changes']>0x0&&(_0x1a481f=_0x1a481f-_0x4b8f0a['changes']);}let _0x4f1332=(_0x37ace2-0x1)*_0x132693;_0x155f00+=_0x3ed9b4(0xf0),_0xe08783[_0x3ed9b4(0x15e)](_0x132693),_0xe08783['push'](_0x4f1332);let _0x3bfc3a=dbLoginTable['getAllRecordByWhere'](_0x1f58c3[_0x3ed9b4(0x14f)]['dbOther'],_0x155f00,_0xe08783);return _0x37c4ce['json']({'code':0x0,'data':_0x3bfc3a,'pageCount':Math[_0x3ed9b4(0xaa)](_0x1a481f/_0x132693)});}),module[_0x44c6c5(0x119)]=router;