const _0xaf16a1=_0x2023;(function(_0x9909b7,_0x15ecca){const _0xc4b146=_0x2023,_0x324052=_0x9909b7();while(!![]){try{const _0x1d300e=parseInt(_0xc4b146(0xf0))/0x1+-parseInt(_0xc4b146(0x175))/0x2*(-parseInt(_0xc4b146(0x12b))/0x3)+-parseInt(_0xc4b146(0x19d))/0x4+parseInt(_0xc4b146(0x129))/0x5*(parseInt(_0xc4b146(0x160))/0x6)+-parseInt(_0xc4b146(0x148))/0x7+-parseInt(_0xc4b146(0x189))/0x8+parseInt(_0xc4b146(0x10b))/0x9*(parseInt(_0xc4b146(0x16f))/0xa);if(_0x1d300e===_0x15ecca)break;else _0x324052['push'](_0x324052['shift']());}catch(_0x45aabd){_0x324052['push'](_0x324052['shift']());}}}(_0x1362,0xac8f6));let express=require(_0xaf16a1(0x15f)),router=express[_0xaf16a1(0xe7)]();const Database=require(_0xaf16a1(0x15d));let dbPrivateSpaceTable=require('../../db/dbPrivateSpaceTable'),path=require('path'),fs=require('fs'),cryptoUtils=require(_0xaf16a1(0x100));const config=require(_0xaf16a1(0x185));let privateSpaceUtils=require(_0xaf16a1(0x193));var faststart=require('../utils/faststart'),exifUtil=require(_0xaf16a1(0x176));let uploadUtil=require(_0xaf16a1(0x123));const PassThrough=require(_0xaf16a1(0x154))[_0xaf16a1(0xf8)],{Readable}=require(_0xaf16a1(0x154));let sha256=require(_0xaf16a1(0x127));const videoStreamUtil=require(_0xaf16a1(0x13f));let fileUtil=require(_0xaf16a1(0x194));const folderSignString=_0xaf16a1(0x178),folderSignFileName=_0xaf16a1(0x130),configFolderName=_0xaf16a1(0x177),noCheckFileList=[_0xaf16a1(0x14c)];let FFmpeg=require(_0xaf16a1(0x1a3))['FFmpeg'];const uploadPrivateUtil=require(_0xaf16a1(0x18c)),privateSharpUtil=require(_0xaf16a1(0x193)),sharpUtil=require(_0xaf16a1(0x196)),transCodeUtil=require(_0xaf16a1(0x188));let dbArr=[];function checkSpaceId(_0x1f3df8,_0x5ea971){const _0x1bb9f7=_0xaf16a1;let _0x4a8920=_0x1f3df8[_0x1bb9f7(0x166)]['spaceId']||_0x1f3df8[_0x1bb9f7(0x181)][_0x1bb9f7(0x1a9)];if(!_0x4a8920)return _0x1f3df8[_0x1bb9f7(0x131)][_0x1bb9f7(0x1aa)](_0x5ea971,'space\x20id\x20is\x20null');let _0x40ff7b=dbPrivateSpaceTable[_0x1bb9f7(0x126)](_0x1f3df8[_0x1bb9f7(0x131)]['dbOther'],_0x4a8920);if(!_0x40ff7b)return _0x1f3df8[_0x1bb9f7(0x131)][_0x1bb9f7(0x1aa)](_0x5ea971,_0x1bb9f7(0x117));return!![];}function checkSpaceName(_0x1abb58,_0x541b84,_0x3ce1ed){const _0x1cea77=_0xaf16a1;if(!_0x3ce1ed)return _0x1abb58[_0x1cea77(0x131)][_0x1cea77(0x1aa)](_0x541b84,_0x541b84['__'](_0x1cea77(0x19b)));if(_0x3ce1ed['length']>0x1e)return _0x1abb58[_0x1cea77(0x131)][_0x1cea77(0x1aa)](_0x541b84,_0x541b84['__'](_0x1cea77(0x168)));return!![];}function _0x2023(_0x5aaa57,_0x4216f2){const _0x1362f8=_0x1362();return _0x2023=function(_0x2023b0,_0x5d5572){_0x2023b0=_0x2023b0-0xe4;let _0x12a2aa=_0x1362f8[_0x2023b0];return _0x12a2aa;},_0x2023(_0x5aaa57,_0x4216f2);}function getPrivateIndexDb(_0x2e4a04){const _0x5d57b4=_0xaf16a1;let _0x5a291d=config[_0x5d57b4(0x112)](_0x2e4a04);for(let _0x47f02a in dbArr){if(dbArr[_0x47f02a][_0x5d57b4(0x192)]==_0x5a291d)return dbArr[_0x47f02a]['db'];}let _0xaa6ced=new Database(_0x5a291d,{});return _0xaa6ced[_0x5d57b4(0x167)](_0x5d57b4(0x144)),dbArr[_0x5d57b4(0x147)]({'dbPath':_0x5a291d,'db':_0xaa6ced}),_0xaa6ced;}router[_0xaf16a1(0x172)](_0xaf16a1(0x14a),(_0x55083d,_0x489113,_0x191980)=>{const _0x2c3895=_0xaf16a1;let _0x1006a2=_0x55083d[_0x2c3895(0x166)][_0x2c3895(0x138)],_0x3ffaca=_0x55083d[_0x2c3895(0x166)]['spaceName'],_0x2d294a=_0x55083d[_0x2c3895(0x198)],_0x48bbe4=_0x55083d[_0x2c3895(0x166)]['spacePwd'];if(checkSpaceName(_0x55083d,_0x489113,_0x3ffaca)!==!![])return;if(!_0x48bbe4||_0x48bbe4['length']<0x4)return _0x55083d[_0x2c3895(0x131)][_0x2c3895(0x1aa)](_0x489113,_0x489113['__'](_0x2c3895(0x150)));function _0x424368(){return new Promise((_0x89d17a,_0xf037af)=>{const _0x92a159=_0x2023;fs[_0x92a159(0x13e)](_0x1006a2,(_0x526c67,_0x10d0ff)=>{const _0x268a72=_0x92a159;if(_0x526c67)return _0xf037af(_0x489113['__'](_0x268a72(0x12e)));if(_0x10d0ff[_0x268a72(0x18d)]>0x400*0x400*0x400)return _0x55083d[_0x268a72(0x131)][_0x268a72(0x1aa)](_0x489113,_0x489113['__']('needEmptyFolderPrivateSpace'));fs[_0x268a72(0x11a)](_0x1006a2,(_0x2c172f,_0x4e7e27)=>{const _0x51d83a=_0x268a72;for(let _0x33baa4 of _0x4e7e27){if(noCheckFileList[_0x51d83a(0x142)](_0x33baa4)||_0x33baa4[_0x51d83a(0xfd)]('.')||_0x33baa4['startsWith']('@'))continue;return _0xf037af(_0x489113['__'](_0x51d83a(0x12e)));}_0x89d17a();});});});}fs['access'](_0x1006a2,fs[_0x2c3895(0x180)][_0x2c3895(0x14b)]|fs[_0x2c3895(0x180)]['W_OK'],_0xa00578=>{const _0x130a4b=_0x2c3895;if(_0xa00578)return _0x55083d[_0x130a4b(0x131)]['returnErrMsg'](_0x489113,_0x489113['__'](_0x130a4b(0xea)));_0x424368()[_0x130a4b(0xeb)](()=>{const _0x18b6e3=_0x130a4b;let _0x5ea668=dbPrivateSpaceTable[_0x18b6e3(0x1a7)](_0x55083d[_0x18b6e3(0x131)]['dbOther'],_0x3ffaca);if(_0x5ea668)return _0x55083d[_0x18b6e3(0x131)][_0x18b6e3(0x1aa)](_0x489113,_0x489113['__'](_0x18b6e3(0x14d)));let _0x2d6817=path[_0x18b6e3(0x1a2)](_0x1006a2,configFolderName);fs[_0x18b6e3(0x157)](_0x2d6817,{'recursive':!![]},_0x15c668=>{const _0x5ef89a=_0x18b6e3;if(_0x15c668)return _0x55083d[_0x5ef89a(0x131)]['returnErrMsg'](_0x489113,_0x489113['__']('operationFail')+JSON[_0x5ef89a(0x119)](_0x15c668));let _0x1ed865=getPrivateIndexDb(_0x1006a2);dbPrivateSpaceTable['createIndexDb'](_0x1ed865,_0x1006a2),cryptoUtils[_0x5ef89a(0xec)](_0x48bbe4,folderSignString)[_0x5ef89a(0xeb)](_0x25a518=>{const _0x40b45c=_0x5ef89a;let _0xa79762=path[_0x40b45c(0x1a2)](_0x2d6817,folderSignFileName);fs[_0x40b45c(0x18f)](_0xa79762,_0x25a518,_0x28e9a6=>{const _0x53effd=_0x40b45c;if(_0x28e9a6)return _0x55083d['app'][_0x53effd(0x1aa)](_0x489113,_0x489113['__'](_0x53effd(0x162))+JSON[_0x53effd(0x119)](_0x28e9a6));return dbPrivateSpaceTable[_0x53effd(0x16e)](_0x55083d[_0x53effd(0x131)]['dbOther'],{'folder_path':_0x1006a2,'space_name':_0x3ffaca,'create_uid':_0x2d294a['id']}),_0x489113[_0x53effd(0x16d)]({'code':0x0});});})[_0x5ef89a(0x190)](_0x206dbc=>{const _0xc617a8=_0x5ef89a;return console[_0xc617a8(0x13a)](_0xc617a8(0x1a6),_0x206dbc),_0x55083d['app'][_0xc617a8(0x1aa)](_0x489113,_0x489113['__'](_0xc617a8(0x162))+JSON[_0xc617a8(0x119)](_0x206dbc));});});})[_0x130a4b(0x190)](_0x3c7dad=>{const _0x1ea92b=_0x130a4b;return _0x55083d[_0x1ea92b(0x131)][_0x1ea92b(0x1aa)](_0x489113,_0x3c7dad);});});}),router[_0xaf16a1(0x172)](_0xaf16a1(0xe5),(_0x3f87c2,_0x1ec2e8,_0xdb0d75)=>{const _0x6facb9=_0xaf16a1;let _0x6e8075=[];return _0x3f87c2[_0x6facb9(0x198)][_0x6facb9(0x183)]==0x1?_0x6e8075=dbPrivateSpaceTable['getAll'](_0x3f87c2[_0x6facb9(0x131)]['dbOther']):_0x6e8075=dbPrivateSpaceTable['getAllByUid'](_0x3f87c2[_0x6facb9(0x131)][_0x6facb9(0xf1)],_0x3f87c2[_0x6facb9(0x198)]['id']),_0x1ec2e8[_0x6facb9(0x16d)]({'code':0x0,'data':_0x6e8075});});function checkSpacePwd(_0x225fbc,_0x2b4408,_0x3e05e0){return new Promise((_0x2f8c77,_0x1649ea)=>{const _0x20dce4=_0x2023;_0x2b4408=Buffer[_0x20dce4(0xe6)](_0x2b4408,_0x20dce4(0x111))[_0x20dce4(0x104)]();let _0x32d80d=path[_0x20dce4(0x1a2)](_0x3e05e0,configFolderName,folderSignFileName);fs['stat'](_0x32d80d,(_0x1e1a67,_0x45d4de)=>{const _0x4d9ea9=_0x20dce4;if(_0x1e1a67)return _0x1649ea(_0x225fbc['__'](_0x4d9ea9(0x136)));fs[_0x4d9ea9(0x18e)](_0x32d80d,_0x4d9ea9(0x1a0),(_0x20bb36,_0x17e04e)=>{const _0x3f2e75=_0x4d9ea9;if(_0x20bb36)return _0x1649ea(_0x225fbc['__'](_0x3f2e75(0x136)));else cryptoUtils['decryptString'](_0x2b4408,_0x17e04e)[_0x3f2e75(0xeb)](_0x1c283b=>{const _0x22a7ce=_0x3f2e75;return _0x1c283b==folderSignString?_0x2f8c77(_0x2b4408):_0x1649ea(_0x225fbc['__'](_0x22a7ce(0xf9)));})[_0x3f2e75(0x190)](_0x1e4645=>{const _0x5206b7=_0x3f2e75;return console[_0x5206b7(0x13a)]('error',_0x1e4645),_0x1649ea(_0x225fbc['__'](_0x5206b7(0xf9)));});});});});}router[_0xaf16a1(0x172)](_0xaf16a1(0xf7),(_0x17bb59,_0x5aedfb,_0x1fd398)=>{const _0x4ed8fe=_0xaf16a1;let _0x534311=_0x17bb59['body'][_0x4ed8fe(0x1a1)],_0x2faa51=_0x17bb59[_0x4ed8fe(0x166)][_0x4ed8fe(0x1a9)],_0x3848dc=dbPrivateSpaceTable[_0x4ed8fe(0x126)](_0x17bb59[_0x4ed8fe(0x131)][_0x4ed8fe(0xf1)],_0x2faa51);if(!_0x3848dc)return _0x17bb59[_0x4ed8fe(0x131)][_0x4ed8fe(0x1aa)](_0x5aedfb,_0x4ed8fe(0x121));fs[_0x4ed8fe(0x13e)](_0x3848dc[_0x4ed8fe(0x174)],(_0x2d74a8,_0x11bc81)=>{const _0x3121dc=_0x4ed8fe;if(_0x2d74a8)return _0x17bb59[_0x3121dc(0x131)][_0x3121dc(0x1aa)](_0x5aedfb,_0x5aedfb['__'](_0x3121dc(0x15b)));checkSpacePwd(_0x5aedfb,_0x534311,_0x3848dc['folder_path'])[_0x3121dc(0xeb)](_0x542a32=>{const _0x41090f=_0x3121dc;let _0x183845=sha256(new Date()[_0x41090f(0x164)]()+_0x2faa51+_0x542a32);cryptoUtils[_0x41090f(0xec)](config['tokenPwdEncryptKey'],_0x542a32)[_0x41090f(0xeb)](_0x2650da=>{const _0x1a6eec=_0x41090f;return dbPrivateSpaceTable['createToken'](_0x17bb59[_0x1a6eec(0x131)][_0x1a6eec(0xf1)],{'space_id':_0x2faa51,'pwd':_0x2650da,'token':_0x183845}),_0x5aedfb[_0x1a6eec(0x16d)]({'code':0x0,'token':_0x183845});});})[_0x3121dc(0x190)](_0x4ff034=>{const _0x56196a=_0x3121dc;return console['log'](_0x56196a(0x1a6),_0x4ff034),_0x17bb59[_0x56196a(0x131)][_0x56196a(0x1aa)](_0x5aedfb,_0x4ff034);});});});function ffprobeSync(_0x3feed7){return new Promise((_0x3af14d,_0x5073bc)=>{const _0x3f9677=_0x2023;try{FFmpeg(transCodeUtil['dealFFmpegPath'](_0x3feed7))[_0x3f9677(0x11b)]((_0xad6804,_0x23d88a)=>{_0xad6804?_0x5073bc(_0xad6804):_0x3af14d(_0x23d88a);});}catch(_0xe7abb7){console[_0x3f9677(0x13a)](_0x3f9677(0x1a6),_0xe7abb7),_0x5073bc(_0xe7abb7);}});}function deleteFile(_0x1d55c9){fs['rm'](_0x1d55c9,{'maxRetries':0xa,'retryDelay':0x3e8},_0x2eb3a2=>{});}function uploadFail(_0x531d4e,_0x5d47d4,_0x3bb54e,_0x155869){const _0x3bbd9b=_0xaf16a1;return deleteFile(_0x5d47d4),_0x3bb54e[_0x3bbd9b(0x131)]['returnErrMsg'](_0x155869,_0x155869['__']('private.uploadErrTryAgain'));}function dealUploadImageOrFile(_0x13ef2c,_0x555f54,_0x44f239,_0x228336,_0x5f5dd5,_0x4a03d7,_0x403efc,_0x3218b6,_0x23ba7a){const _0x3cc947=_0xaf16a1;uploadPrivateUtil[_0x3cc947(0xe8)](_0x44f239,_0x228336,_0x5f5dd5,_0x4a03d7,_0x3bd5cf=>{const _0x2bf071=_0x3cc947;let _0x19b748=_0x3bd5cf[_0x2bf071(0xf3)],_0x126c77=cryptoUtils[_0x2bf071(0x145)](_0x4a03d7,_0x19b748),_0x530c4d=dbPrivateSpaceTable[_0x2bf071(0xfc)](_0x13ef2c,{'filename':new Buffer[(_0x2bf071(0xe6))](_0x3218b6)[_0x2bf071(0x104)](_0x2bf071(0x111)),'filename_enc':_0x5f5dd5,'file_type':_0x403efc,'ext':_0x23ba7a});if(_0x530c4d['changes']<0x1)return uploadFail(_0x13ef2c,_0x19b748,_0x44f239,_0x228336);let _0x1db5e0=_0x530c4d[_0x2bf071(0x184)];_0x228336[_0x2bf071(0x16d)]({'code':0x0});let _0x47ee40=new Date()[_0x2bf071(0x164)]();if(_0x403efc==_0x2bf071(0x13d)){var _0x1b3b6f=[];let _0x34eaca=new PassThrough()[_0x2bf071(0x15a)](_0x126c77);_0x34eaca['on'](_0x2bf071(0x1a5),function(_0x25c519){_0x1b3b6f['push'](_0x25c519);}),_0x34eaca['on'](_0x2bf071(0x109),function(){const _0x532c14=_0x2bf071;var _0xed693f=Buffer[_0x532c14(0x114)](_0x1b3b6f);function _0x428aaa(){const _0x3c7fba=_0x532c14;exifUtil[_0x3c7fba(0xe9)](_0xed693f)['then'](_0x29414d=>{const _0x390311=_0x3c7fba;if(_0x29414d){let _0x5f38b9=_0x29414d[_0x390311(0x17f)];_0x29414d[_0x390311(0x105)]&&!_0x5f38b9&&(_0x5f38b9=_0x29414d[_0x390311(0x105)]),_0x5f38b9&&(_0x47ee40=new Date(_0x5f38b9)[_0x390311(0x164)](),_0x13ef2c['prepare'](_0x390311(0x13c)+_0x47ee40+_0x390311(0x18b)+_0x1db5e0)[_0x390311(0x106)]());}})[_0x3c7fba(0x190)](_0x54605d=>{});}privateSpaceUtils['genImageTinyFile'](_0x23ba7a,_0xed693f,_0x30cff9=>{const _0x44dcc4=_0x532c14,_0x3bebdb=Readable[_0x44dcc4(0xe6)](_0x30cff9);let _0x40bf5e=path['join'](_0x555f54,_0x5f5dd5);cryptoUtils[_0x44dcc4(0x10d)](_0x4a03d7,_0x3bebdb,_0x40bf5e)['then'](_0x4c6c34=>{const _0x22320a=_0x44dcc4;let _0x2535c=path['join'](configFolderName,'tiny',_0x5f5dd5);_0x13ef2c[_0x22320a(0x155)](_0x22320a(0x108)+_0x2535c+_0x22320a(0x18b)+_0x1db5e0)[_0x22320a(0x106)](),_0x428aaa();});},_0x57837f=>{_0x428aaa();});});}});}function dealUploadVideo(_0x25bef8,_0x248fc2,_0x410f8c,_0x3e8274,_0x52332a,_0x818c4a,_0x8e19d1,_0x5280a7,_0x1d1567,_0x4db9a4,_0x1791cb){const _0x332168=_0xaf16a1;_0x52332a['query']['savePath']=_0x3e8274,_0x52332a[_0x332168(0x181)][_0x332168(0x13b)]=_0x332168(0x15c),uploadUtil[_0x332168(0xe8)](_0x52332a,_0x818c4a,![],!![],![],_0x1efbb2=>{const _0x4a238b=_0x332168;let _0x206029=_0x1efbb2[_0x4a238b(0xf3)],_0x4c7370=path[_0x4a238b(0x1a2)](_0x1efbb2[_0x4a238b(0xf6)]);function _0x302dd8(_0x314638){const _0x19ff8b=_0x4a238b;ffprobeSync(_0x206029)[_0x19ff8b(0xeb)](_0xcdf604=>{const _0x555268=_0x19ff8b;let _0xa89f35=0x0;_0xa89f35=videoStreamUtil[_0x555268(0x143)](_0xcdf604);let _0x37cbae=JSON[_0x555268(0x119)](_0xcdf604['streams']),_0x39db18=videoStreamUtil[_0x555268(0x171)](_0xcdf604);fs[_0x555268(0x13e)](_0x206029,(_0x5f1881,_0x4c89d8)=>{const _0xd970b7=_0x555268;if(_0x5f1881){deleteFile(_0x206029);return;}let _0x436de7=_0xd970b7(0xff);_0x25bef8['prepare'](_0x436de7)[_0xd970b7(0x106)](_0x39db18,parseInt(_0xa89f35),_0x4c89d8[_0xd970b7(0x18d)],_0x37cbae,_0x314638);let _0x2c8459=_0xd970b7(0x152)+Buffer['from'](_0x4db9a4)[_0xd970b7(0x104)]('base64');privateSpaceUtils[_0xd970b7(0x156)](_0x206029,_0x4c7370,_0x2c8459,_0x55ccf3=>{fs['stat'](_0x55ccf3,(_0x43d8af,_0xba9755)=>{const _0xa1189b=_0x2023;if(_0x43d8af){deleteFile(_0x206029);return;}let _0xc575ce=path[_0xa1189b(0x1a2)](_0x410f8c,_0x8e19d1);cryptoUtils[_0xa1189b(0x125)](_0x5280a7,_0x55ccf3,_0xc575ce)['then'](_0x3b77ba=>{const _0x2e6c71=_0xa1189b;let _0x4a7563=path[_0x2e6c71(0x1a2)](configFolderName,_0x2e6c71(0x103),_0x8e19d1);_0x25bef8[_0x2e6c71(0x155)]('UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27'+_0x4a7563+_0x2e6c71(0x18b)+_0x314638)[_0x2e6c71(0x106)](),deleteFile(_0x55ccf3),deleteFile(_0x206029);});});},_0x525aa1=>{deleteFile(_0x206029);});});})['catch'](_0x3caaa6=>{deleteFile(_0x206029);});}function _0x1444aa(){const _0x316e97=_0x4a238b;let _0x110e9a=dbPrivateSpaceTable[_0x316e97(0xfc)](_0x25bef8,{'filename':new Buffer['from'](_0x4db9a4)[_0x316e97(0x104)](_0x316e97(0x111)),'filename_enc':_0x8e19d1,'file_type':_0x1d1567,'ext':_0x1791cb});return _0x110e9a[_0x316e97(0xf2)]<0x1?uploadFail(_0x25bef8,_0x206029,_0x52332a,_0x818c4a):(_0x302dd8(_0x110e9a[_0x316e97(0x184)]),_0x818c4a[_0x316e97(0x16d)]({'code':0x0}));}function _0x52de6e(_0x387838,_0x1f6905,_0x520a84){const _0x44da91=_0x4a238b;cryptoUtils[_0x44da91(0x125)](_0x5280a7,_0x387838,_0x1f6905)[_0x44da91(0xeb)](_0x34e3a5=>{_0x520a84(_0x34e3a5);})[_0x44da91(0x190)](_0x1a435d=>{const _0x169ff3=_0x44da91;console[_0x169ff3(0x13a)](_0x1a435d),uploadFail(_0x25bef8,_0x387838,_0x52332a,_0x818c4a);});}let _0x4c6041=path['join'](_0x248fc2[_0x4a238b(0x174)],_0x8e19d1);if(_0x1791cb==_0x4a238b(0xfe)||_0x1791cb==_0x4a238b(0x199)){var _0x375983=faststart[_0x4a238b(0x153)](_0x206029,{'errorCallBack':_0x289e5b=>{_0x52de6e(_0x206029,_0x4c6041,_0x1444aa);}});_0x375983['on']('close',function(){const _0x3a1ebe=_0x4a238b;_0x375983[_0x3a1ebe(0x107)]();}),cryptoUtils[_0x4a238b(0x10d)](_0x5280a7,_0x375983,_0x4c6041)['then'](_0x4294d5=>{_0x1444aa();})['catch'](_0x5a3351=>{const _0x59e9c2=_0x4a238b;console[_0x59e9c2(0x13a)](_0x59e9c2(0x1a6),_0x5a3351),uploadFail(_0x25bef8,_0x206029,_0x52332a,_0x818c4a);});}else _0x52de6e(_0x206029,_0x4c6041,_0x1444aa);});}function _0x1362(){const _0x3677a7=['path','/exportSpace','other','destination','/checkPwd','PassThrough','private.passwordIncorrect','getTokenObjByToken','ids','createIndex','startsWith','.mp4','UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?','../utils/cryptoUtils','decryptString','/exitSpaceId','tiny','toString','CreateDate','run','destroy','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','end','access','1926ltUFyR','START_WORKER_BG_TASK','encryptFileFromInputPipe','get','spaceName','imgTypeList','base64','getPrivateDbPath','setHeader','concat','getIndexByFileName','type','space\x20id\x20is\x20invalid','updateSpaceName','stringify','readdir','ffprobe','W_OK','spaceToken','decryptFile','updateIndexField','videoTypeList','error\x20space\x20id','headers','../utils/uploadUtils','attachment;\x20filename*=UTF-8\x27\x27','encryptFile','getById','sha256','err','5pQWqOs','unlink','186492obGgZY','\x20offset\x20','indexId','needEmptyFolderPrivateSpace','Content-Disposition','nascabconfigenc','app','length','extname','\x20WHERE\x20file_type=\x27','private.spaceConfigFileBroken','private.configFileReadFail','privateSpaceKey','folderPath','deleteSpaceToken','log','overMode','UPDATE\x20private_space_index\x20SET\x20original_time=\x27','image','stat','../../utils/videoStreamUtil','ifExtIsSpecialFormat','/getDecodeFile*','includes','getDurationFromStream','journal_mode\x20=\x20WAL','decryptFileGetStream','tokenPwdEncryptKey','push','7035980xllWoQ','indexOf','/addPrivateSpace','R_OK','.DS_Store','private.hasSameNameSpace','\x20limit\x20','send','private.spacePwdGtFour','\x20id=','tiny-','createReadStream','stream','prepare','genVideoTinyFile','mkdir','savePath','filename','pipe','private.spaceFolderNotExist','over','better-sqlite3','streamToBuffer','express','364638WQNiUO','space\x20id\x20is\x20null','operationFail','create_uid','getTime','video','body','pragma','private.spaceNameTooLong','toLowerCase','message','space_id','deleteIndex','json','create','78040MLBQMl','orderField','getVideoOriginalTime','post','space/index\x20id\x20is\x20null','folder_path','12xhglsr','exifr','nascabconfig','nascabisthebest','download','private.onlyAdminCanDelete','/importSpace','fileType','string','count','DateTimeOriginal','constants','query','space_token','is_admin','lastInsertRowid','../../myConfig/config','private.fileNameTooLong','EXPORT_PRIVATE_SPACE','../../utils/transCodeUtil','2138312XGWOzS','undefined','\x27\x20where\x20id=','../utils/uploadPrivateUtils','size','readFile','writeFile','catch','targetFolderPath','dbPath','../utils/privateSpaceUtils','../utils/fileUtils','offsetCount','../utils/sharpUtils','/deleteSpaceFiles','currentUser','.mov','spacePwd','private.spaceNameCantNull','tiny_path','2866152OULfoV','getIndexById','ext','utf-8','checkStr','join','../../libs/nasTrans','orderType','data','error','getBySpaceName','encodeFilename','spaceId','returnErrMsg','decodePath','/getAllSpace','from','Router','uploadFile','parse','noWritePermission','then','encryptString','all','buffer','status','591960ziBGwg','dbOther','changes'];_0x1362=function(){return _0x3677a7;};return _0x1362();}router[_0xaf16a1(0x172)]('/regularUpload',function(_0x1a2153,_0x212997,_0x6412a6){const _0x59e7ea=_0xaf16a1;let _0x27f055=_0x1a2153[_0x59e7ea(0x181)]['spaceId']||_0x1a2153[_0x59e7ea(0x166)][_0x59e7ea(0x1a9)]||_0x1a2153[_0x59e7ea(0x122)][_0x59e7ea(0x16b)],_0x475602=_0x1a2153[_0x59e7ea(0x181)][_0x59e7ea(0x159)]||_0x1a2153[_0x59e7ea(0x122)]['filename'],_0x5f1354=decodeURIComponent(_0x475602);_0x1a2153[_0x59e7ea(0x181)][_0x59e7ea(0x1a8)]&&(_0x5f1354=fileUtil[_0x59e7ea(0xe4)](_0x1a2153[_0x59e7ea(0x181)][_0x59e7ea(0x1a8)])),getPwdFromToken(_0x1a2153,_0x212997,_0x5811c6=>{const _0x1b5544=_0x59e7ea;let _0xbe5ab8=dbPrivateSpaceTable['getById'](_0x1a2153[_0x1b5544(0x131)][_0x1b5544(0xf1)],_0x27f055);if(!_0xbe5ab8)return _0x1a2153[_0x1b5544(0x131)][_0x1b5544(0x1aa)](_0x212997,_0x212997['__']('private.noExist'));_0x1a2153[_0x1b5544(0x181)][_0x1b5544(0x158)]=_0xbe5ab8['folder_path'];let _0x404872=getPrivateIndexDb(_0xbe5ab8['folder_path']),_0xa4e7c9=dbPrivateSpaceTable[_0x1b5544(0x115)](_0x404872,new Buffer[(_0x1b5544(0xe6))](_0x5f1354)[_0x1b5544(0x104)](_0x1b5544(0x111)));if(_0xa4e7c9)return _0x1a2153[_0x1b5544(0x131)]['returnErrMsg'](_0x212997,_0x212997['__']('private.alreadyHasSameNameFile'));let _0x251ca5=path[_0x1b5544(0x133)](_0x5f1354)?path['extname'](_0x5f1354)[_0x1b5544(0x169)]():null,_0x1669ba=_0x1b5544(0xf5);if(_0x251ca5){if(config[_0x1b5544(0x110)][_0x1b5544(0x142)](_0x251ca5['toLowerCase']())||config['rawImgTypeList'][_0x1b5544(0x142)](_0x251ca5[_0x1b5544(0x169)]()))_0x1669ba='image';else config[_0x1b5544(0x120)][_0x1b5544(0x142)](_0x251ca5[_0x1b5544(0x169)]())&&(_0x1669ba=_0x1b5544(0x165));}let _0x16c932=path['join'](_0xbe5ab8[_0x1b5544(0x174)],configFolderName,_0x1b5544(0x103)),_0x18e640=path['join'](_0xbe5ab8[_0x1b5544(0x174)],configFolderName,'temp');function _0x36b1b2(){const _0x3184f7=_0x1b5544;cryptoUtils[_0x3184f7(0xec)](_0x5811c6,_0x5f1354)[_0x3184f7(0xeb)](_0x49ae5d=>{const _0x85f42f=_0x3184f7;if(_0x49ae5d[_0x85f42f(0x132)]>0xf0)return _0x1a2153[_0x85f42f(0x131)]['returnErrMsg'](_0x212997,_0x212997['__'](_0x85f42f(0x186)));_0x1669ba==_0x85f42f(0x165)?dealUploadVideo(_0x404872,_0xbe5ab8,_0x16c932,_0x18e640,_0x1a2153,_0x212997,_0x49ae5d,_0x5811c6,_0x1669ba,_0x5f1354,_0x251ca5):dealUploadImageOrFile(_0x404872,_0x16c932,_0x1a2153,_0x212997,_0x49ae5d,_0x5811c6,_0x1669ba,_0x5f1354,_0x251ca5);});}fs['stat'](_0x16c932,(_0x51445f,_0x192f37)=>{const _0x31756a=_0x1b5544;function _0x323c72(){fs['stat'](_0x18e640,(_0x1f1854,_0xe58c9b)=>{const _0x5c73aa=_0x2023;_0x1f1854?fs[_0x5c73aa(0x157)](_0x18e640,{'recursive':!![]},_0x1b9724=>{_0x36b1b2();}):_0x36b1b2();});}_0x51445f?fs[_0x31756a(0x157)](_0x16c932,{'recursive':!![]},_0x4e3a2d=>{_0x323c72();}):_0x323c72();});});}),router[_0xaf16a1(0x172)](_0xaf16a1(0x17b),(_0x2f115d,_0x515a06,_0x432ab1)=>{const _0x48efcf=_0xaf16a1;let _0x2fcbe0=_0x2f115d[_0x48efcf(0x166)][_0x48efcf(0x138)],_0x41d09b=_0x2f115d[_0x48efcf(0x166)][_0x48efcf(0x10f)],_0x304f2f=_0x2f115d['currentUser'],_0x1e1f16=_0x2f115d[_0x48efcf(0x166)]['spacePwd'];if(!_0x41d09b)return _0x2f115d[_0x48efcf(0x131)]['returnErrMsg'](_0x515a06,_0x515a06['__'](_0x48efcf(0x19b)));let _0x2840e0=dbPrivateSpaceTable[_0x48efcf(0x1a7)](_0x2f115d[_0x48efcf(0x131)]['dbOther'],_0x41d09b);if(_0x2840e0)return _0x2f115d['app'][_0x48efcf(0x1aa)](_0x515a06,_0x515a06['__'](_0x48efcf(0x14d)));if(!_0x1e1f16)return _0x2f115d[_0x48efcf(0x131)][_0x48efcf(0x1aa)](_0x515a06,_0x515a06['__']('private.spacePwdGtFour'));fs['access'](_0x2fcbe0,_0x1350ee=>{const _0xec19e8=_0x48efcf;if(_0x1350ee)return _0x2f115d[_0xec19e8(0x131)][_0xec19e8(0x1aa)](_0x515a06,_0x515a06['__'](_0xec19e8(0xea)));checkSpacePwd(_0x515a06,_0x1e1f16,_0x2fcbe0)[_0xec19e8(0xeb)](()=>{const _0x3cf4d6=_0xec19e8;let _0xbfc7b7=config['getPrivateDbPath'](_0x2fcbe0);fs[_0x3cf4d6(0x13e)](_0xbfc7b7,(_0x5ae7e8,_0x115d65)=>{const _0xec2987=_0x3cf4d6;if(_0x5ae7e8)return _0x2f115d[_0xec2987(0x131)][_0xec2987(0x1aa)](_0x515a06,_0x515a06['__'](_0xec2987(0x135)));return dbPrivateSpaceTable['create'](_0x2f115d[_0xec2987(0x131)][_0xec2987(0xf1)],{'folder_path':_0x2fcbe0,'space_name':_0x41d09b,'create_uid':_0x304f2f['id']}),_0x515a06[_0xec2987(0x16d)]({'code':0x0});});})[_0xec19e8(0x190)](_0x2cb38b=>{const _0x5db521=_0xec19e8;return _0x2f115d[_0x5db521(0x131)][_0x5db521(0x1aa)](_0x515a06,_0x2cb38b);});});}),router['post'](_0xaf16a1(0xf4),(_0x2895eb,_0x169e71,_0xec119e)=>{const _0x293d3f=_0xaf16a1;let _0x2fecc1=_0x2895eb[_0x293d3f(0x166)][_0x293d3f(0x138)],_0x4d3024=_0x2895eb[_0x293d3f(0x166)][_0x293d3f(0x19a)],_0x23ebf3=_0x2895eb[_0x293d3f(0x166)][_0x293d3f(0x191)];if(!_0x4d3024)return _0x2895eb[_0x293d3f(0x131)][_0x293d3f(0x1aa)](_0x169e71,_0x169e71['__']('private.spacePwdGtFour'));fs[_0x293d3f(0x10a)](_0x2fecc1,fs[_0x293d3f(0x180)][_0x293d3f(0x14b)],_0x13f981=>{const _0x11adc6=_0x293d3f;if(_0x13f981)return _0x2895eb[_0x11adc6(0x131)][_0x11adc6(0x1aa)](_0x169e71,_0x169e71['__']('noWritePermission'));fs[_0x11adc6(0x10a)](_0x23ebf3,fs[_0x11adc6(0x180)][_0x11adc6(0x11c)],_0x1d7148=>{const _0x485b19=_0x11adc6;if(_0x1d7148)return _0x2895eb[_0x485b19(0x131)][_0x485b19(0x1aa)](_0x169e71,_0x169e71['__'](_0x485b19(0xea)));function _0x414b10(_0x415229){const _0x5219a6=_0x485b19;cryptoUtils[_0x5219a6(0xec)](config[_0x5219a6(0x137)],_0x4d3024)[_0x5219a6(0xeb)](_0xd18264=>{const _0x31d857=_0x5219a6;return _0x415229[_0x31d857(0x131)][_0x31d857(0xf1)]['prepare']('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')['run'](_0x31d857(0x187),JSON[_0x31d857(0x119)]({'folderPath':_0x2fecc1,'targetFolderPath':_0x23ebf3,'spacePwd':_0xd18264})),process[_0x31d857(0x14f)]({'type':_0x31d857(0x10c)}),_0x169e71[_0x31d857(0x16d)]({'code':0x0});});}let _0x11d177=path[_0x485b19(0x1a2)](_0x2fecc1,configFolderName,folderSignFileName);fs['stat'](_0x11d177,(_0x368c43,_0x28c647)=>{const _0x2da86e=_0x485b19;_0x368c43?_0x414b10(_0x2895eb):checkSpacePwd(_0x169e71,_0x4d3024,_0x2fecc1)[_0x2da86e(0xeb)](()=>{_0x414b10(_0x2895eb);})[_0x2da86e(0x190)](_0x21a202=>{const _0x3abc5d=_0x2da86e;return console[_0x3abc5d(0x13a)](_0x21a202),_0x2895eb[_0x3abc5d(0x131)]['returnErrMsg'](_0x169e71,_0x169e71['__'](_0x3abc5d(0xf9)));});});});});}),router[_0xaf16a1(0x172)](_0xaf16a1(0x197),(_0x33afbb,_0x400682,_0x589377)=>{const _0x56df6a=_0xaf16a1;let _0x2e842e=_0x33afbb[_0x56df6a(0x166)][_0x56df6a(0x1a9)],_0x16fab2=_0x33afbb[_0x56df6a(0x166)][_0x56df6a(0xfb)];if(!_0x16fab2||_0x16fab2[_0x56df6a(0x132)]<0x1)return _0x400682[_0x56df6a(0xef)](0x194)[_0x56df6a(0x109)]();let _0x472908=dbPrivateSpaceTable[_0x56df6a(0x126)](_0x33afbb[_0x56df6a(0x131)][_0x56df6a(0xf1)],_0x2e842e);if(!_0x472908)return _0x400682['status'](0x194)[_0x56df6a(0x109)]();if(_0x33afbb[_0x56df6a(0x198)][_0x56df6a(0x183)]!=0x1){if(_0x472908[_0x56df6a(0x163)]!=_0x33afbb['currentUser']['id'])return _0x400682['json']({'code':0x1,'message':_0x400682['__']('private.onlyAdminCanDelete')});}try{let _0x2f136a=getPrivateIndexDb(_0x472908['folder_path']),_0x1f2988=JSON['parse'](_0x16fab2),_0x54d024=0x0,_0x189f9f=[],_0x159f55=0x0,_0x321c0f=0x0;if(_0x1f2988['length']<0x1)return _0x400682[_0x56df6a(0x16d)]({'code':0x0,'deleteList':_0x189f9f,'deleteCount':_0x54d024,'errCount':_0x159f55});for(let _0x2e04aa=0x0;_0x2e04aa<_0x1f2988[_0x56df6a(0x132)];_0x2e04aa++){let _0x4cfcdb=dbPrivateSpaceTable['getIndexByWhere'](_0x2f136a,_0x56df6a(0x151)+_0x1f2988[_0x2e04aa]);if(!_0x4cfcdb)return _0x33afbb[_0x56df6a(0x131)]['returnErrMsg'](_0x400682,_0x400682['__']('folderNotExist'));let _0x339535=path[_0x56df6a(0x1a2)](_0x472908[_0x56df6a(0x174)],_0x4cfcdb['filename_enc']);if(_0x4cfcdb['tiny_path']&&_0x4cfcdb[_0x56df6a(0x19c)]!=_0x56df6a(0x18a)){let _0x47a387=path['join'](_0x472908['folder_path'],_0x4cfcdb['tiny_path']);try{fs[_0x56df6a(0x12a)](_0x47a387,_0x31e4c1=>{});}catch(_0x1eb636){}}fs[_0x56df6a(0x12a)](_0x339535,_0x6795fb=>{const _0x20dcbf=_0x56df6a;_0x321c0f+=0x1;_0x6795fb?(console[_0x20dcbf(0x13a)](_0x20dcbf(0x128),_0x6795fb[_0x20dcbf(0x16a)]),_0x159f55+=0x1):(_0x54d024+=0x1,_0x189f9f[_0x20dcbf(0x147)](_0x1f2988[_0x2e04aa]));dbPrivateSpaceTable[_0x20dcbf(0x16c)](_0x2f136a,_0x1f2988[_0x2e04aa]);if(_0x321c0f==_0x1f2988[_0x20dcbf(0x132)])return _0x400682[_0x20dcbf(0x16d)]({'code':0x0,'deleteList':_0x189f9f,'deleteCount':_0x54d024,'errCount':_0x159f55});});}}catch(_0x477263){return console[_0x56df6a(0x13a)](_0x56df6a(0x1a6),_0x477263),_0x400682['json']({'code':0x1,'message':JSON[_0x56df6a(0x119)](_0x477263)});}}),router[_0xaf16a1(0x172)]('/deleteSpace',(_0x3d625e,_0x3517f2,_0x4918e0)=>{const _0x367e13=_0xaf16a1;if(checkSpaceId(_0x3d625e,_0x3517f2)!==!![])return;let _0x2f897a=_0x3d625e['body'][_0x367e13(0x1a9)],_0x12c3cf=dbPrivateSpaceTable['getById'](_0x3d625e[_0x367e13(0x131)][_0x367e13(0xf1)],_0x2f897a);if(_0x3d625e['currentUser'][_0x367e13(0x183)]!=0x1){if(_0x12c3cf[_0x367e13(0x163)]!=_0x3d625e[_0x367e13(0x198)]['id'])return _0x3517f2[_0x367e13(0x16d)]({'code':0x1,'message':_0x3517f2['__'](_0x367e13(0x17a))});}return dbPrivateSpaceTable['delete'](_0x3d625e[_0x367e13(0x131)][_0x367e13(0xf1)],_0x2f897a),_0x3517f2['json']({'code':0x0});}),router[_0xaf16a1(0x172)]('/updateSpaceName',(_0x242aae,_0x2827bd,_0x5102fb)=>{const _0x3ade1b=_0xaf16a1;let _0x178eba=_0x242aae['body'][_0x3ade1b(0x10f)],_0x3063ec=_0x242aae[_0x3ade1b(0x166)][_0x3ade1b(0x1a9)];if(checkSpaceId(_0x242aae,_0x2827bd)!==!![])return;if(checkSpaceName(_0x242aae,_0x2827bd,_0x178eba)!==!![])return;let _0x25e170=dbPrivateSpaceTable['getById'](_0x242aae['app'][_0x3ade1b(0xf1)],_0x3063ec);if(_0x242aae[_0x3ade1b(0x198)][_0x3ade1b(0x183)]!=0x1){if(_0x25e170['create_uid']!=_0x242aae[_0x3ade1b(0x198)]['id'])return _0x2827bd['json']({'code':0x1,'message':_0x2827bd['__'](_0x3ade1b(0x17a))});}return dbPrivateSpaceTable[_0x3ade1b(0x118)](_0x242aae[_0x3ade1b(0x131)][_0x3ade1b(0xf1)],_0x178eba,_0x3063ec),_0x2827bd[_0x3ade1b(0x16d)]({'code':0x0});}),router[_0xaf16a1(0x172)]('/getFileList',(_0x1d9442,_0x212d51,_0x512963)=>{const _0x282c23=_0xaf16a1;let _0x13692a=_0x1d9442[_0x282c23(0x166)][_0x282c23(0x1a9)];if(!_0x13692a)return _0x1d9442['app'][_0x282c23(0x1aa)](_0x212d51,_0x282c23(0x161));let _0x477d0d=dbPrivateSpaceTable[_0x282c23(0x126)](_0x1d9442['app']['dbOther'],_0x13692a);if(!_0x477d0d)return _0x1d9442[_0x282c23(0x131)][_0x282c23(0x1aa)](_0x212d51,_0x282c23(0x117));let _0x3d6f0e=config[_0x282c23(0x112)](_0x477d0d['folder_path']);fs['stat'](_0x3d6f0e,(_0x24e881,_0x42c7fa)=>{const _0x341c84=_0x282c23;if(_0x24e881)return _0x1d9442['app'][_0x341c84(0x1aa)](_0x212d51,_0x212d51['__'](_0x341c84(0x135)));let _0x3b1b74=_0x1d9442[_0x341c84(0x166)][_0x341c84(0x17e)]||0x64,_0x2366e3=_0x1d9442[_0x341c84(0x166)][_0x341c84(0x195)]||0x0,_0x27cea7=_0x1d9442[_0x341c84(0x166)][_0x341c84(0x170)]||'id',_0xde1b4e=_0x1d9442['body'][_0x341c84(0x1a4)]||'desc',_0x28bfd0=_0x1d9442['body'][_0x341c84(0x17c)],_0x38e4e6=getPrivateIndexDb(_0x477d0d[_0x341c84(0x174)]),_0x5aa661='';_0x28bfd0&&_0x28bfd0!=_0x341c84(0xed)&&(_0x5aa661+=_0x341c84(0x134)+_0x28bfd0+'\x27');_0x5aa661+='\x20order\x20by\x20'+_0x27cea7+'\x20'+_0xde1b4e+_0x341c84(0x14e)+_0x3b1b74+_0x341c84(0x12c)+_0x2366e3;let _0xed2126=dbPrivateSpaceTable['getAllIndexByWhere'](_0x38e4e6,_0x5aa661);return _0x212d51[_0x341c84(0x16d)]({'code':0x0,'data':_0xed2126});});});function getPwdFromToken(_0x1ec7db,_0x56c741,_0x152224){const _0x1e09e7=_0xaf16a1;let _0x168572=_0x1ec7db[_0x1e09e7(0x181)][_0x1e09e7(0x11d)]||_0x1ec7db['body'][_0x1e09e7(0x11d)]||_0x1ec7db[_0x1e09e7(0x122)][_0x1e09e7(0x182)],_0x33a785=dbPrivateSpaceTable[_0x1e09e7(0xfa)](_0x1ec7db['app'][_0x1e09e7(0xf1)],_0x168572);if(!_0x33a785)return _0x56c741[_0x1e09e7(0x16d)]({'code':0x68});let _0x30b054=_0x33a785['pwd'];cryptoUtils[_0x1e09e7(0x101)](config[_0x1e09e7(0x146)],_0x30b054)[_0x1e09e7(0xeb)](_0x17f4c6=>{_0x152224(_0x17f4c6);})[_0x1e09e7(0x190)](_0x549875=>{const _0x498c23=_0x1e09e7;console[_0x498c23(0x13a)](_0x549875);});}router[_0xaf16a1(0x10e)](_0xaf16a1(0x141),(_0x22a719,_0x38b22b,_0x497010)=>{const _0x111f4c=_0xaf16a1;try{let _0x5624be=_0x22a719[_0x111f4c(0x181)][_0x111f4c(0x1a9)],_0x607cb0=_0x22a719[_0x111f4c(0x181)][_0x111f4c(0x12d)],_0x3f78cb=_0x22a719[_0x111f4c(0x181)][_0x111f4c(0x179)],_0xfb447d=_0x22a719[_0x111f4c(0x181)][_0x111f4c(0x116)];if(!_0x5624be||!_0x607cb0)return _0x22a719['app'][_0x111f4c(0x1aa)](_0x38b22b,_0x111f4c(0x173));let _0xcd3806=dbPrivateSpaceTable[_0x111f4c(0x126)](_0x22a719[_0x111f4c(0x131)][_0x111f4c(0xf1)],_0x5624be);if(!_0xcd3806)return _0x22a719['app'][_0x111f4c(0x1aa)](_0x38b22b,'space\x20id\x20is\x20invalid');getPwdFromToken(_0x22a719,_0x38b22b,_0x454519=>{const _0x3114b1=_0x111f4c;let _0x218c7a=getPrivateIndexDb(_0xcd3806[_0x3114b1(0x174)]),_0x50ed0f=dbPrivateSpaceTable[_0x3114b1(0x19e)](_0x218c7a,_0x607cb0);if(!_0x50ed0f)return _0x38b22b['status'](0x194)[_0x3114b1(0x109)]();let _0x9df57c='';_0xfb447d==_0x3114b1(0x103)?_0x9df57c=path['join'](_0xcd3806[_0x3114b1(0x174)],_0x50ed0f[_0x3114b1(0x19c)]):_0x9df57c=path['join'](_0xcd3806[_0x3114b1(0x174)],_0x50ed0f['filename_enc']);if(_0x3f78cb==0x1)try{let _0x84ec1b=Buffer[_0x3114b1(0xe6)](_0x50ed0f[_0x3114b1(0x159)],_0x3114b1(0x111))['toString']();const _0xde341=encodeURIComponent(_0x84ec1b)['replace'](/%([0-9A-F]{2})/g,(_0x445f4e,_0x9aca03)=>'%'+_0x9aca03['toUpperCase']());_0x38b22b[_0x3114b1(0x113)](_0x3114b1(0x12f),_0x3114b1(0x124)+_0xde341);}catch(_0x17c1d4){console[_0x3114b1(0x13a)](_0x17c1d4);}fs[_0x3114b1(0x13e)](_0x9df57c,(_0x47e915,_0x41dff1)=>{const _0x4a06fb=_0x3114b1;if(_0x47e915)return _0x38b22b['status'](0x194)[_0x4a06fb(0x109)]();if(_0x9df57c[_0x4a06fb(0x149)](_0x4a06fb(0x103))==-0x1){let _0xef5623=dbPrivateSpaceTable[_0x4a06fb(0x11f)](_0x218c7a,'check_time',new Date()[_0x4a06fb(0x164)](),_0x607cb0);}if(sharpUtil[_0x4a06fb(0x140)](_0x50ed0f['ext'])&&_0xfb447d!='tiny'){let _0x271294=cryptoUtils[_0x4a06fb(0x145)](_0x454519,_0x9df57c);fileUtil[_0x4a06fb(0x15e)](_0x271294)[_0x4a06fb(0xeb)](_0x42dc36=>{const _0x3b6be1=_0x4a06fb;sharpUtil['transSpcielFormatFromBuffer'](_0x50ed0f[_0x3b6be1(0x19f)],_0x42dc36,(_0x8b3ea2,_0x2628ba,_0x5bf915)=>{const _0x3aa7e3=_0x3b6be1;sharpUtil[_0x3aa7e3(0x140)](_0x50ed0f[_0x3aa7e3(0x19f)][_0x3aa7e3(0x169)]())?sharpUtil['sharpDealImg'](_0x8b3ea2,null,![],null,_0x3aa7e3(0xee),null,_0x21c89a=>{const _0x24752c=_0x3aa7e3;_0x38b22b[_0x24752c(0x14f)](Buffer['from'](_0x21c89a));},_0x3f91c8=>{const _0x160a06=_0x3aa7e3;return console[_0x160a06(0x13a)](_0x3f91c8),_0x38b22b[_0x160a06(0xef)](0x194)[_0x160a06(0x109)]();},_0x2628ba,_0x5bf915):typeof _0x8b3ea2==_0x3aa7e3(0x17d)?(_0x38b22b['sendFile'](_0x8b3ea2),_0x38b22b['on']('close',()=>{_0x2628ba&&fs['rm'](_0x8b3ea2,_0x319e96=>{});})):_0x38b22b[_0x3aa7e3(0x14f)](_0x8b3ea2);});});}else cryptoUtils[_0x4a06fb(0x11e)](_0x454519,_0x9df57c,_0x38b22b,_0x38b22b);return;});});}catch(_0xeca95a){return console[_0x111f4c(0x13a)](_0xeca95a),_0x38b22b['status'](0x194)[_0x111f4c(0x109)]();}}),router[_0xaf16a1(0x172)](_0xaf16a1(0x102),(_0x4f7ebe,_0x2be117,_0x13989c)=>{const _0x59a445=_0xaf16a1;try{return dbPrivateSpaceTable[_0x59a445(0x139)](_0x4f7ebe[_0x59a445(0x131)][_0x59a445(0xf1)],_0x4f7ebe[_0x59a445(0x166)][_0x59a445(0x1a9)]),_0x2be117[_0x59a445(0xef)](0xc8)[_0x59a445(0x109)]();}catch(_0x47ab88){return console['log'](_0x47ab88),_0x2be117[_0x59a445(0xef)](0x194)[_0x59a445(0x109)]();}}),module['exports']=router;