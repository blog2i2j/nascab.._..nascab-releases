const _0x467462=_0x31f9;(function(_0x352629,_0x4e4e86){const _0x4beee0=_0x31f9,_0x1aae96=_0x352629();while(!![]){try{const _0x34f6a8=-parseInt(_0x4beee0(0xe8))/0x1*(-parseInt(_0x4beee0(0xfa))/0x2)+-parseInt(_0x4beee0(0xbe))/0x3+parseInt(_0x4beee0(0xcd))/0x4+-parseInt(_0x4beee0(0x10f))/0x5*(parseInt(_0x4beee0(0x130))/0x6)+parseInt(_0x4beee0(0xfd))/0x7+-parseInt(_0x4beee0(0xcf))/0x8+-parseInt(_0x4beee0(0x145))/0x9*(parseInt(_0x4beee0(0x139))/0xa);if(_0x34f6a8===_0x4e4e86)break;else _0x1aae96['push'](_0x1aae96['shift']());}catch(_0x2933f4){_0x1aae96['push'](_0x1aae96['shift']());}}}(_0x2ab8,0xd1e7e));let express=require('express'),router=express[_0x467462(0xa8)]();const Database=require('better-sqlite3');let dbPrivateSpaceTable=require(_0x467462(0xb0)),path=require(_0x467462(0x14f)),fs=require('fs'),cryptoUtils=require('../utils/cryptoUtils');const config=require(_0x467462(0x143));let privateSpaceUtils=require(_0x467462(0x110));var faststart=require(_0x467462(0x9c)),exifUtil=require(_0x467462(0x9b));let uploadUtil=require('../utils/uploadUtils');const PassThrough=require(_0x467462(0x13e))[_0x467462(0xec)],{Readable}=require(_0x467462(0x13e));let sha256=require('sha256');const videoStreamUtil=require(_0x467462(0xde));let fileUtil=require(_0x467462(0x107));const folderSignString='nascabisthebest',folderSignFileName=_0x467462(0x104),configFolderName=_0x467462(0x13a),noCheckFileList=['.DS_Store'];let FFmpeg=require(_0x467462(0x12c))[_0x467462(0xd9)];const uploadPrivateUtil=require(_0x467462(0x123)),privateSharpUtil=require(_0x467462(0x110)),sharpUtil=require(_0x467462(0x92)),transCodeUtil=require(_0x467462(0xc7));function _0x31f9(_0x48df1f,_0x432f8f){const _0x2ab87d=_0x2ab8();return _0x31f9=function(_0x31f9ee,_0x282632){_0x31f9ee=_0x31f9ee-0x91;let _0x51864f=_0x2ab87d[_0x31f9ee];return _0x51864f;},_0x31f9(_0x48df1f,_0x432f8f);}let dbArr=[];function checkSpaceId(_0x2ee7f1,_0x16fd31){const _0x7b24c9=_0x467462;let _0x2f0fa6=_0x2ee7f1[_0x7b24c9(0x106)][_0x7b24c9(0x11f)]||_0x2ee7f1['query'][_0x7b24c9(0x11f)];if(!_0x2f0fa6)return _0x2ee7f1[_0x7b24c9(0x124)][_0x7b24c9(0xaf)](_0x16fd31,_0x7b24c9(0xf7));let _0xfecc99=dbPrivateSpaceTable[_0x7b24c9(0xf9)](_0x2ee7f1['app'][_0x7b24c9(0xed)],_0x2f0fa6);if(!_0xfecc99)return _0x2ee7f1[_0x7b24c9(0x124)][_0x7b24c9(0xaf)](_0x16fd31,_0x7b24c9(0x91));return!![];}function checkSpaceName(_0x2fb874,_0x5eb535,_0x2f4319){const _0x39e14f=_0x467462;if(!_0x2f4319)return _0x2fb874[_0x39e14f(0x124)][_0x39e14f(0xaf)](_0x5eb535,_0x5eb535['__']('private.spaceNameCantNull'));if(_0x2f4319['length']>0x1e)return _0x2fb874[_0x39e14f(0x124)][_0x39e14f(0xaf)](_0x5eb535,_0x5eb535['__'](_0x39e14f(0x135)));return!![];}function _0x2ab8(){const _0x4f0735=['../utils/sharpUtils','private.spacePwdGtFour','dbPath','\x20id=','streamToBuffer','offsetCount','pragma','utf-8','getIndexByFileName','exifr','../utils/faststart','/deleteSpace','Content-Disposition','private.onlyAdminCanDelete','mkdir','indexOf','orderField','getAllIndexByWhere','/exitSpaceId','R_OK','getBySpaceName','headers','Router','from','other','lastInsertRowid','rawImgTypeList','createIndexDb','\x20limit\x20','returnErrMsg','../../db/dbPrivateSpaceTable','readFile','getVideoOriginalTime','private.alreadyHasSameNameFile','join','encryptFile','\x20order\x20by\x20','private.spaceConfigFileBroken','filename','download','base64','/deleteSpaceFiles','encodeFilename','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','3074358DegkoA','genImageTinyFile','W_OK','journal_mode\x20=\x20WAL','encryptFileFromInputPipe','\x20WHERE\x20file_type=\x27','json','extname','send','../../utils/transCodeUtil','tokenPwdEncryptKey','getAll','transSpcielFormatFromBuffer','image','tiny_path','5729716SmXWhP','spaceToken','4731912dLSkOM','create','fileType','private.spaceFolderNotExist','check_time','createReadStream','/regularUpload','buffer','error\x20space\x20id','dealFFmpegPath','FFmpeg','prepare','close','deleteIndex','targetFolderPath','../../utils/videoStreamUtil','private.fileNameTooLong','/updateSpaceName','deleteSpaceToken','space_token','type','length','attachment;\x20filename*=UTF-8\x27\x27','streams','decryptString','14ZbYvsE','end','/importSpace','message','PassThrough','dbOther','pipe','createIndex','/exportSpace','checkStr','toString','getTokenObjByToken','exports','constants','getPrivateDbPath','space\x20id\x20is\x20null','tiny','getById','200386GHzDat','size','getAllByUid','3091991kTuJRE','post','toLowerCase','status','folder_path','operationFail','then','nascabconfigenc','replace','body','../utils/fileUtils','privateSpaceKey','push','CreateDate','ext','encryptString','private.spaceNameCantNull','readdir','5cSjCmg','../utils/privateSpaceUtils','space_id','stringify','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','error','private.uploadErrTryAgain','ifExtIsSpecialFormat','concat','sendFile','/checkPwd','delete','createToken','noWritePermission','includes','/addPrivateSpace','spaceId','temp','create_uid','over','../utils/uploadPrivateUtils','app','private.noExist','decryptFile','data','/getDecodeFile*','unlink','\x20offset\x20','query','../../libs/nasTrans','currentUser','genVideoTinyFile','savePath','3206388VkeAYL','decryptFileGetStream','private.passwordIncorrect','.mov','is_admin','private.spaceNameTooLong','changes','parse','folderPath','10HhlDbM','nascabconfig','indexId','startsWith','\x27\x20where\x20id=','stream','UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?','videoTypeList','spacePwd','getTime','../../myConfig/config','log','2397573yFzFge','run','private.hasSameNameSpace','access','destroy','err','video','updateIndexField','private.configFileReadFail','getDurationFromStream','path','tiny-','string','needEmptyFolderPrivateSpace','stat','spaceName','all','catch','/getFileList','folderNotExist','filename_enc','getIndexById','space\x20id\x20is\x20invalid'];_0x2ab8=function(){return _0x4f0735;};return _0x2ab8();}function getPrivateIndexDb(_0x2f09ad){const _0x113da5=_0x467462;let _0x8b1720=config[_0x113da5(0xf6)](_0x2f09ad);for(let _0x2ecb58 in dbArr){if(dbArr[_0x2ecb58][_0x113da5(0x94)]==_0x8b1720)return dbArr[_0x2ecb58]['db'];}let _0x4326ea=new Database(_0x8b1720,{});return _0x4326ea[_0x113da5(0x98)](_0x113da5(0xc1)),dbArr['push']({'dbPath':_0x8b1720,'db':_0x4326ea}),_0x4326ea;}router[_0x467462(0xfe)](_0x467462(0x11e),(_0x4caae5,_0x2bf294,_0x3e9b45)=>{const _0x1f3fd5=_0x467462;let _0x256e2d=_0x4caae5['body'][_0x1f3fd5(0x138)],_0x2f5f9a=_0x4caae5[_0x1f3fd5(0x106)]['spaceName'],_0xe8cce=_0x4caae5[_0x1f3fd5(0x12d)],_0x5ee802=_0x4caae5[_0x1f3fd5(0x106)][_0x1f3fd5(0x141)];if(checkSpaceName(_0x4caae5,_0x2bf294,_0x2f5f9a)!==!![])return;if(!_0x5ee802||_0x5ee802[_0x1f3fd5(0xe4)]<0x4)return _0x4caae5['app'][_0x1f3fd5(0xaf)](_0x2bf294,_0x2bf294['__'](_0x1f3fd5(0x93)));function _0x11766d(){return new Promise((_0x5acf36,_0x293540)=>{const _0x394a93=_0x31f9;fs[_0x394a93(0x153)](_0x256e2d,(_0x7aa53c,_0x5aedc5)=>{const _0x54533b=_0x394a93;if(_0x7aa53c)return _0x293540(_0x2bf294['__'](_0x54533b(0x152)));if(_0x5aedc5[_0x54533b(0xfb)]>0x400*0x400*0x400)return _0x4caae5['app'][_0x54533b(0xaf)](_0x2bf294,_0x2bf294['__']('needEmptyFolderPrivateSpace'));fs[_0x54533b(0x10e)](_0x256e2d,(_0x32ee3a,_0x18ebac)=>{const _0x52b76e=_0x54533b;for(let _0x404c97 of _0x18ebac){if(noCheckFileList[_0x52b76e(0x11d)](_0x404c97)||_0x404c97['startsWith']('.')||_0x404c97[_0x52b76e(0x13c)]('@'))continue;return _0x293540(_0x2bf294['__'](_0x52b76e(0x152)));}_0x5acf36();});});});}fs[_0x1f3fd5(0x148)](_0x256e2d,fs['constants'][_0x1f3fd5(0xa5)]|fs[_0x1f3fd5(0xf5)][_0x1f3fd5(0xc0)],_0xe5ac3f=>{const _0x353dee=_0x1f3fd5;if(_0xe5ac3f)return _0x4caae5[_0x353dee(0x124)][_0x353dee(0xaf)](_0x2bf294,_0x2bf294['__'](_0x353dee(0x11c)));_0x11766d()[_0x353dee(0x103)](()=>{const _0x158fff=_0x353dee;let _0x50cd02=dbPrivateSpaceTable[_0x158fff(0xa6)](_0x4caae5[_0x158fff(0x124)][_0x158fff(0xed)],_0x2f5f9a);if(_0x50cd02)return _0x4caae5[_0x158fff(0x124)][_0x158fff(0xaf)](_0x2bf294,_0x2bf294['__'](_0x158fff(0x147)));let _0xe742ec=path['join'](_0x256e2d,configFolderName);fs[_0x158fff(0xa0)](_0xe742ec,{'recursive':!![]},_0x595966=>{const _0x4c5399=_0x158fff;if(_0x595966)return _0x4caae5[_0x4c5399(0x124)]['returnErrMsg'](_0x2bf294,_0x2bf294['__'](_0x4c5399(0x102))+JSON[_0x4c5399(0x112)](_0x595966));let _0x209a24=getPrivateIndexDb(_0x256e2d);dbPrivateSpaceTable[_0x4c5399(0xad)](_0x209a24,_0x256e2d),cryptoUtils['encryptString'](_0x5ee802,folderSignString)[_0x4c5399(0x103)](_0x31e33f=>{const _0x435d78=_0x4c5399;let _0x5bf290=path[_0x435d78(0xb4)](_0xe742ec,folderSignFileName);fs['writeFile'](_0x5bf290,_0x31e33f,_0x55f100=>{const _0x4be8e9=_0x435d78;if(_0x55f100)return _0x4caae5[_0x4be8e9(0x124)][_0x4be8e9(0xaf)](_0x2bf294,_0x2bf294['__'](_0x4be8e9(0x102))+JSON[_0x4be8e9(0x112)](_0x55f100));return dbPrivateSpaceTable[_0x4be8e9(0xd0)](_0x4caae5[_0x4be8e9(0x124)]['dbOther'],{'folder_path':_0x256e2d,'space_name':_0x2f5f9a,'create_uid':_0xe8cce['id']}),_0x2bf294[_0x4be8e9(0xc4)]({'code':0x0});});})['catch'](_0x2dbd6f=>{const _0x5b16dc=_0x4c5399;return console['log']('error',_0x2dbd6f),_0x4caae5['app']['returnErrMsg'](_0x2bf294,_0x2bf294['__'](_0x5b16dc(0x102))+JSON[_0x5b16dc(0x112)](_0x2dbd6f));});});})[_0x353dee(0x156)](_0x550a52=>{const _0x534f56=_0x353dee;return _0x4caae5[_0x534f56(0x124)][_0x534f56(0xaf)](_0x2bf294,_0x550a52);});});}),router['post']('/getAllSpace',(_0x42d096,_0x1cc93c,_0x2842c1)=>{const _0xfef06d=_0x467462;let _0x21c62d=[];return _0x42d096[_0xfef06d(0x12d)][_0xfef06d(0x134)]==0x1?_0x21c62d=dbPrivateSpaceTable[_0xfef06d(0xc9)](_0x42d096['app'][_0xfef06d(0xed)]):_0x21c62d=dbPrivateSpaceTable[_0xfef06d(0xfc)](_0x42d096[_0xfef06d(0x124)][_0xfef06d(0xed)],_0x42d096[_0xfef06d(0x12d)]['id']),_0x1cc93c[_0xfef06d(0xc4)]({'code':0x0,'data':_0x21c62d});});function checkSpacePwd(_0x3278f6,_0x1a6500,_0x26657d){return new Promise((_0x5c3a87,_0x3398ef)=>{const _0x5c1b90=_0x31f9;_0x1a6500=Buffer[_0x5c1b90(0xa9)](_0x1a6500,_0x5c1b90(0xba))[_0x5c1b90(0xf2)]();let _0x553228=path[_0x5c1b90(0xb4)](_0x26657d,configFolderName,folderSignFileName);fs[_0x5c1b90(0x153)](_0x553228,(_0x126e95,_0x33b973)=>{const _0x2e098a=_0x5c1b90;if(_0x126e95)return _0x3398ef(_0x3278f6['__'](_0x2e098a(0x14d)));fs[_0x2e098a(0xb1)](_0x553228,_0x2e098a(0x99),(_0x4f6264,_0x1deacc)=>{const _0x3d1c99=_0x2e098a;if(_0x4f6264)return _0x3398ef(_0x3278f6['__']('private.configFileReadFail'));else cryptoUtils[_0x3d1c99(0xe7)](_0x1a6500,_0x1deacc)[_0x3d1c99(0x103)](_0x535214=>{const _0x4bcdca=_0x3d1c99;return _0x535214==folderSignString?_0x5c3a87(_0x1a6500):_0x3398ef(_0x3278f6['__'](_0x4bcdca(0x132)));})[_0x3d1c99(0x156)](_0x100921=>{const _0x39a9de=_0x3d1c99;return console[_0x39a9de(0x144)](_0x39a9de(0x114),_0x100921),_0x3398ef(_0x3278f6['__'](_0x39a9de(0x132)));});});});});}router[_0x467462(0xfe)](_0x467462(0x119),(_0x511bee,_0x30909b,_0x2070fc)=>{const _0x285b97=_0x467462;let _0x35eda5=_0x511bee[_0x285b97(0x106)][_0x285b97(0xf1)],_0x13b014=_0x511bee[_0x285b97(0x106)][_0x285b97(0x11f)],_0x4c4b68=dbPrivateSpaceTable[_0x285b97(0xf9)](_0x511bee[_0x285b97(0x124)][_0x285b97(0xed)],_0x13b014);if(!_0x4c4b68)return _0x511bee[_0x285b97(0x124)][_0x285b97(0xaf)](_0x30909b,_0x285b97(0xd7));fs[_0x285b97(0x153)](_0x4c4b68[_0x285b97(0x101)],(_0x50c61b,_0x57c9dc)=>{const _0x72eff7=_0x285b97;if(_0x50c61b)return _0x511bee['app']['returnErrMsg'](_0x30909b,_0x30909b['__'](_0x72eff7(0xd2)));checkSpacePwd(_0x30909b,_0x35eda5,_0x4c4b68['folder_path'])[_0x72eff7(0x103)](_0x6bd29=>{const _0x13348d=_0x72eff7;let _0x5c02f5=sha256(new Date()[_0x13348d(0x142)]()+_0x13b014+_0x6bd29);cryptoUtils[_0x13348d(0x10c)](config[_0x13348d(0xc8)],_0x6bd29)[_0x13348d(0x103)](_0x4412ee=>{const _0x309607=_0x13348d;return dbPrivateSpaceTable[_0x309607(0x11b)](_0x511bee['app'][_0x309607(0xed)],{'space_id':_0x13b014,'pwd':_0x4412ee,'token':_0x5c02f5}),_0x30909b[_0x309607(0xc4)]({'code':0x0,'token':_0x5c02f5});});})[_0x72eff7(0x156)](_0x8461c4=>{const _0xc767ca=_0x72eff7;return console[_0xc767ca(0x144)](_0xc767ca(0x114),_0x8461c4),_0x511bee['app']['returnErrMsg'](_0x30909b,_0x8461c4);});});});function ffprobeSync(_0x47fbb8){return new Promise((_0x4d3cd1,_0x2c79e0)=>{const _0x25b148=_0x31f9;try{FFmpeg(transCodeUtil[_0x25b148(0xd8)](_0x47fbb8))['ffprobe']((_0x21570f,_0xd57bf4)=>{_0x21570f?_0x2c79e0(_0x21570f):_0x4d3cd1(_0xd57bf4);});}catch(_0x15a28d){console[_0x25b148(0x144)](_0x25b148(0x114),_0x15a28d),_0x2c79e0(_0x15a28d);}});}function deleteFile(_0x1215e5){fs['rm'](_0x1215e5,{'maxRetries':0xa,'retryDelay':0x3e8},_0x30bb3a=>{});}function uploadFail(_0x752f69,_0x2fcb1b,_0x3cd8d2,_0x2df7a8){const _0x5ca6e2=_0x467462;return deleteFile(_0x2fcb1b),_0x3cd8d2[_0x5ca6e2(0x124)][_0x5ca6e2(0xaf)](_0x2df7a8,_0x2df7a8['__'](_0x5ca6e2(0x115)));}function dealUploadImageOrFile(_0x6b2ba5,_0x171039,_0x593627,_0x27392b,_0x27e455,_0x2bb4d3,_0x468a58,_0x4ad442,_0x17c900){uploadPrivateUtil['uploadFile'](_0x593627,_0x27392b,_0x27e455,_0x2bb4d3,_0x471724=>{const _0x265c95=_0x31f9;let _0x1dde3e=_0x471724[_0x265c95(0x14f)],_0x2b2a1e=cryptoUtils[_0x265c95(0x131)](_0x2bb4d3,_0x1dde3e),_0x2d2bca=dbPrivateSpaceTable[_0x265c95(0xef)](_0x6b2ba5,{'filename':new Buffer[(_0x265c95(0xa9))](_0x4ad442)[_0x265c95(0xf2)](_0x265c95(0xba)),'filename_enc':_0x27e455,'file_type':_0x468a58,'ext':_0x17c900});if(_0x2d2bca[_0x265c95(0x136)]<0x1)return uploadFail(_0x6b2ba5,_0x1dde3e,_0x593627,_0x27392b);let _0x1934b8=_0x2d2bca[_0x265c95(0xab)];_0x27392b[_0x265c95(0xc4)]({'code':0x0});let _0x45ecb6=new Date()[_0x265c95(0x142)]();if(_0x468a58==_0x265c95(0xcb)){var _0xab6b2c=[];let _0x157ae9=new PassThrough()[_0x265c95(0xee)](_0x2b2a1e);_0x157ae9['on'](_0x265c95(0x127),function(_0x469d14){const _0x3c7419=_0x265c95;_0xab6b2c[_0x3c7419(0x109)](_0x469d14);}),_0x157ae9['on'](_0x265c95(0xe9),function(){const _0xb0f8f6=_0x265c95;var _0x43fea2=Buffer[_0xb0f8f6(0x117)](_0xab6b2c);function _0x3d1eb5(){const _0x4cbc28=_0xb0f8f6;exifUtil['parse'](_0x43fea2)[_0x4cbc28(0x103)](_0x239e99=>{const _0x2859fd=_0x4cbc28;if(_0x239e99){let _0x568d99=_0x239e99['DateTimeOriginal'];_0x239e99[_0x2859fd(0x10a)]&&!_0x568d99&&(_0x568d99=_0x239e99['CreateDate']),_0x568d99&&(_0x45ecb6=new Date(_0x568d99)[_0x2859fd(0x142)](),_0x6b2ba5['prepare']('UPDATE\x20private_space_index\x20SET\x20original_time=\x27'+_0x45ecb6+_0x2859fd(0x13d)+_0x1934b8)['run']());}})[_0x4cbc28(0x156)](_0x6031bd=>{});}privateSpaceUtils[_0xb0f8f6(0xbf)](_0x17c900,_0x43fea2,_0x579065=>{const _0x957bcc=_0xb0f8f6,_0xf56f97=Readable['from'](_0x579065);let _0x393ab2=path[_0x957bcc(0xb4)](_0x171039,_0x27e455);cryptoUtils['encryptFileFromInputPipe'](_0x2bb4d3,_0xf56f97,_0x393ab2)[_0x957bcc(0x103)](_0x5bdf65=>{const _0x5241e0=_0x957bcc;let _0x1e6a8d=path[_0x5241e0(0xb4)](configFolderName,'tiny',_0x27e455);_0x6b2ba5['prepare']('UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27'+_0x1e6a8d+_0x5241e0(0x13d)+_0x1934b8)[_0x5241e0(0x146)](),_0x3d1eb5();});},_0xdb22b8=>{_0x3d1eb5();});});}});}function dealUploadVideo(_0x55f78d,_0x17ed0a,_0x9405d1,_0x2bc570,_0x2b13ea,_0x673148,_0x3c9e7a,_0x513383,_0x3b1763,_0x51d795,_0x1dfac6){const _0x3a1cb6=_0x467462;_0x2b13ea[_0x3a1cb6(0x12b)]['savePath']=_0x2bc570,_0x2b13ea[_0x3a1cb6(0x12b)]['overMode']=_0x3a1cb6(0x122),uploadUtil['uploadFile'](_0x2b13ea,_0x673148,![],!![],![],_0x4f94e4=>{const _0x22c116=_0x3a1cb6;let _0x498cbc=_0x4f94e4[_0x22c116(0x14f)],_0x32d032=path[_0x22c116(0xb4)](_0x4f94e4['destination']);function _0xd2ddea(_0x380398){const _0x44d6cd=_0x22c116;ffprobeSync(_0x498cbc)['then'](_0x5d7706=>{const _0x4b26e2=_0x31f9;let _0x443a96=0x0;_0x443a96=videoStreamUtil[_0x4b26e2(0x14e)](_0x5d7706);let _0x440504=JSON[_0x4b26e2(0x112)](_0x5d7706[_0x4b26e2(0xe6)]),_0x368d03=videoStreamUtil[_0x4b26e2(0xb2)](_0x5d7706);fs[_0x4b26e2(0x153)](_0x498cbc,(_0x3f3b8a,_0x13df09)=>{const _0x3566d4=_0x4b26e2;if(_0x3f3b8a){deleteFile(_0x498cbc);return;}let _0x103dbc=_0x3566d4(0x13f);_0x55f78d[_0x3566d4(0xda)](_0x103dbc)[_0x3566d4(0x146)](_0x368d03,parseInt(_0x443a96),_0x13df09[_0x3566d4(0xfb)],_0x440504,_0x380398);let _0x33c861=_0x3566d4(0x150)+Buffer[_0x3566d4(0xa9)](_0x51d795)[_0x3566d4(0xf2)](_0x3566d4(0xba));privateSpaceUtils[_0x3566d4(0x12e)](_0x498cbc,_0x32d032,_0x33c861,_0x4ba26a=>{const _0x27b65f=_0x3566d4;fs[_0x27b65f(0x153)](_0x4ba26a,(_0x3205af,_0x923849)=>{const _0x51e120=_0x27b65f;if(_0x3205af){deleteFile(_0x498cbc);return;}let _0x193e77=path[_0x51e120(0xb4)](_0x9405d1,_0x3c9e7a);cryptoUtils[_0x51e120(0xb5)](_0x513383,_0x4ba26a,_0x193e77)[_0x51e120(0x103)](_0x5b7cbf=>{const _0x319c47=_0x51e120;let _0x5282f9=path[_0x319c47(0xb4)](configFolderName,_0x319c47(0xf8),_0x3c9e7a);_0x55f78d['prepare'](_0x319c47(0xbd)+_0x5282f9+_0x319c47(0x13d)+_0x380398)[_0x319c47(0x146)](),deleteFile(_0x4ba26a),deleteFile(_0x498cbc);});});},_0x521ae5=>{deleteFile(_0x498cbc);});});})[_0x44d6cd(0x156)](_0xff98aa=>{deleteFile(_0x498cbc);});}function _0x12ca5(){const _0x3bf009=_0x22c116;let _0x11a73b=dbPrivateSpaceTable[_0x3bf009(0xef)](_0x55f78d,{'filename':new Buffer['from'](_0x51d795)[_0x3bf009(0xf2)]('base64'),'filename_enc':_0x3c9e7a,'file_type':_0x3b1763,'ext':_0x1dfac6});return _0x11a73b[_0x3bf009(0x136)]<0x1?uploadFail(_0x55f78d,_0x498cbc,_0x2b13ea,_0x673148):(_0xd2ddea(_0x11a73b[_0x3bf009(0xab)]),_0x673148[_0x3bf009(0xc4)]({'code':0x0}));}function _0x5932e5(_0x145980,_0x2e770b,_0x34a5e5){const _0x4d2fa4=_0x22c116;cryptoUtils[_0x4d2fa4(0xb5)](_0x513383,_0x145980,_0x2e770b)[_0x4d2fa4(0x103)](_0x459fe8=>{_0x34a5e5(_0x459fe8);})['catch'](_0x2aecf3=>{const _0x36502c=_0x4d2fa4;console[_0x36502c(0x144)](_0x2aecf3),uploadFail(_0x55f78d,_0x145980,_0x2b13ea,_0x673148);});}let _0x307460=path[_0x22c116(0xb4)](_0x17ed0a[_0x22c116(0x101)],_0x3c9e7a);if(_0x1dfac6=='.mp4'||_0x1dfac6==_0x22c116(0x133)){var _0x4fd510=faststart[_0x22c116(0xd4)](_0x498cbc,{'errorCallBack':_0x4aab1d=>{_0x5932e5(_0x498cbc,_0x307460,_0x12ca5);}});_0x4fd510['on'](_0x22c116(0xdb),function(){const _0x240bbd=_0x22c116;_0x4fd510[_0x240bbd(0x149)]();}),cryptoUtils[_0x22c116(0xc2)](_0x513383,_0x4fd510,_0x307460)[_0x22c116(0x103)](_0x254526=>{_0x12ca5();})[_0x22c116(0x156)](_0x2cd1fa=>{const _0x3fbd52=_0x22c116;console['log'](_0x3fbd52(0x114),_0x2cd1fa),uploadFail(_0x55f78d,_0x498cbc,_0x2b13ea,_0x673148);});}else _0x5932e5(_0x498cbc,_0x307460,_0x12ca5);});}router[_0x467462(0xfe)](_0x467462(0xd5),function(_0x2c7b44,_0x51d24b,_0x3517d2){const _0x2d7e84=_0x467462;let _0x8bb1d8=_0x2c7b44[_0x2d7e84(0x12b)][_0x2d7e84(0x11f)]||_0x2c7b44[_0x2d7e84(0x106)][_0x2d7e84(0x11f)]||_0x2c7b44[_0x2d7e84(0xa7)][_0x2d7e84(0x111)],_0x47420f=_0x2c7b44[_0x2d7e84(0x12b)][_0x2d7e84(0xb8)]||_0x2c7b44[_0x2d7e84(0xa7)][_0x2d7e84(0xb8)],_0x322139=decodeURIComponent(_0x47420f);_0x2c7b44[_0x2d7e84(0x12b)][_0x2d7e84(0xbc)]&&(_0x322139=fileUtil['decodePath'](_0x2c7b44[_0x2d7e84(0x12b)][_0x2d7e84(0xbc)])),getPwdFromToken(_0x2c7b44,_0x51d24b,_0xa6a503=>{const _0x24e6ff=_0x2d7e84;let _0x514659=dbPrivateSpaceTable[_0x24e6ff(0xf9)](_0x2c7b44[_0x24e6ff(0x124)][_0x24e6ff(0xed)],_0x8bb1d8);if(!_0x514659)return _0x2c7b44[_0x24e6ff(0x124)]['returnErrMsg'](_0x51d24b,_0x51d24b['__'](_0x24e6ff(0x125)));_0x2c7b44[_0x24e6ff(0x12b)][_0x24e6ff(0x12f)]=_0x514659[_0x24e6ff(0x101)];let _0x35776c=getPrivateIndexDb(_0x514659[_0x24e6ff(0x101)]),_0x552e7a=dbPrivateSpaceTable[_0x24e6ff(0x9a)](_0x35776c,new Buffer[(_0x24e6ff(0xa9))](_0x322139)['toString'](_0x24e6ff(0xba)));if(_0x552e7a)return _0x2c7b44['app'][_0x24e6ff(0xaf)](_0x51d24b,_0x51d24b['__'](_0x24e6ff(0xb3)));let _0x1bcd25=path['extname'](_0x322139)?path[_0x24e6ff(0xc5)](_0x322139)[_0x24e6ff(0xff)]():null,_0x45d5c4=_0x24e6ff(0xaa);if(_0x1bcd25){if(config['imgTypeList']['includes'](_0x1bcd25[_0x24e6ff(0xff)]())||config[_0x24e6ff(0xac)][_0x24e6ff(0x11d)](_0x1bcd25[_0x24e6ff(0xff)]()))_0x45d5c4=_0x24e6ff(0xcb);else config[_0x24e6ff(0x140)]['includes'](_0x1bcd25[_0x24e6ff(0xff)]())&&(_0x45d5c4=_0x24e6ff(0x14b));}let _0x539300=path['join'](_0x514659[_0x24e6ff(0x101)],configFolderName,'tiny'),_0x19cf22=path[_0x24e6ff(0xb4)](_0x514659[_0x24e6ff(0x101)],configFolderName,_0x24e6ff(0x120));function _0x42f78e(){const _0x1ebc97=_0x24e6ff;cryptoUtils[_0x1ebc97(0x10c)](_0xa6a503,_0x322139)[_0x1ebc97(0x103)](_0x38223e=>{const _0x50ffd0=_0x1ebc97;if(_0x38223e[_0x50ffd0(0xe4)]>0xf0)return _0x2c7b44[_0x50ffd0(0x124)][_0x50ffd0(0xaf)](_0x51d24b,_0x51d24b['__'](_0x50ffd0(0xdf)));_0x45d5c4=='video'?dealUploadVideo(_0x35776c,_0x514659,_0x539300,_0x19cf22,_0x2c7b44,_0x51d24b,_0x38223e,_0xa6a503,_0x45d5c4,_0x322139,_0x1bcd25):dealUploadImageOrFile(_0x35776c,_0x539300,_0x2c7b44,_0x51d24b,_0x38223e,_0xa6a503,_0x45d5c4,_0x322139,_0x1bcd25);});}fs[_0x24e6ff(0x153)](_0x539300,(_0x227ba5,_0x1f05a8)=>{const _0x42fb3f=_0x24e6ff;function _0x19febb(){const _0x508420=_0x31f9;fs[_0x508420(0x153)](_0x19cf22,(_0x3e997f,_0x2cd830)=>{_0x3e997f?fs['mkdir'](_0x19cf22,{'recursive':!![]},_0xef5062=>{_0x42f78e();}):_0x42f78e();});}_0x227ba5?fs[_0x42fb3f(0xa0)](_0x539300,{'recursive':!![]},_0x52efb5=>{_0x19febb();}):_0x19febb();});});}),router[_0x467462(0xfe)](_0x467462(0xea),(_0x2dca12,_0x44ed01,_0x361873)=>{const _0x5e4326=_0x467462;let _0x218f68=_0x2dca12[_0x5e4326(0x106)][_0x5e4326(0x138)],_0x2ab51a=_0x2dca12[_0x5e4326(0x106)][_0x5e4326(0x154)],_0x3ed428=_0x2dca12[_0x5e4326(0x12d)],_0x1358ea=_0x2dca12[_0x5e4326(0x106)][_0x5e4326(0x141)];if(!_0x2ab51a)return _0x2dca12[_0x5e4326(0x124)][_0x5e4326(0xaf)](_0x44ed01,_0x44ed01['__'](_0x5e4326(0x10d)));let _0x422661=dbPrivateSpaceTable[_0x5e4326(0xa6)](_0x2dca12[_0x5e4326(0x124)]['dbOther'],_0x2ab51a);if(_0x422661)return _0x2dca12[_0x5e4326(0x124)][_0x5e4326(0xaf)](_0x44ed01,_0x44ed01['__'](_0x5e4326(0x147)));if(!_0x1358ea)return _0x2dca12[_0x5e4326(0x124)][_0x5e4326(0xaf)](_0x44ed01,_0x44ed01['__'](_0x5e4326(0x93)));fs['access'](_0x218f68,_0x18fc17=>{const _0x105e36=_0x5e4326;if(_0x18fc17)return _0x2dca12['app'][_0x105e36(0xaf)](_0x44ed01,_0x44ed01['__'](_0x105e36(0x11c)));checkSpacePwd(_0x44ed01,_0x1358ea,_0x218f68)[_0x105e36(0x103)](()=>{const _0x5cba3a=_0x105e36;let _0x98255c=config[_0x5cba3a(0xf6)](_0x218f68);fs[_0x5cba3a(0x153)](_0x98255c,(_0x1e6385,_0x558ee2)=>{const _0x446284=_0x5cba3a;if(_0x1e6385)return _0x2dca12['app'][_0x446284(0xaf)](_0x44ed01,_0x44ed01['__']('private.spaceConfigFileBroken'));return dbPrivateSpaceTable['create'](_0x2dca12[_0x446284(0x124)]['dbOther'],{'folder_path':_0x218f68,'space_name':_0x2ab51a,'create_uid':_0x3ed428['id']}),_0x44ed01[_0x446284(0xc4)]({'code':0x0});});})[_0x105e36(0x156)](_0x34dc9c=>{const _0xd4560=_0x105e36;return _0x2dca12[_0xd4560(0x124)][_0xd4560(0xaf)](_0x44ed01,_0x34dc9c);});});}),router[_0x467462(0xfe)](_0x467462(0xf0),(_0x1177bb,_0x13c6ca,_0xbed4ba)=>{const _0x30b3b3=_0x467462;let _0x58217d=_0x1177bb[_0x30b3b3(0x106)][_0x30b3b3(0x138)],_0x336de3=_0x1177bb['body']['spacePwd'],_0x7c8456=_0x1177bb[_0x30b3b3(0x106)][_0x30b3b3(0xdd)];if(!_0x336de3)return _0x1177bb[_0x30b3b3(0x124)][_0x30b3b3(0xaf)](_0x13c6ca,_0x13c6ca['__'](_0x30b3b3(0x93)));fs['access'](_0x58217d,fs['constants']['R_OK'],_0x4b5bd2=>{const _0x38188a=_0x30b3b3;if(_0x4b5bd2)return _0x1177bb[_0x38188a(0x124)][_0x38188a(0xaf)](_0x13c6ca,_0x13c6ca['__'](_0x38188a(0x11c)));fs[_0x38188a(0x148)](_0x7c8456,fs[_0x38188a(0xf5)][_0x38188a(0xc0)],_0x1a33ac=>{const _0x2fe1b0=_0x38188a;if(_0x1a33ac)return _0x1177bb[_0x2fe1b0(0x124)][_0x2fe1b0(0xaf)](_0x13c6ca,_0x13c6ca['__'](_0x2fe1b0(0x11c)));function _0x4ebe06(_0x2512d4){const _0x3daae8=_0x2fe1b0;cryptoUtils['encryptString'](config[_0x3daae8(0x108)],_0x336de3)[_0x3daae8(0x103)](_0x35d0b8=>{const _0x1c65a5=_0x3daae8;return _0x2512d4[_0x1c65a5(0x124)]['dbOther'][_0x1c65a5(0xda)](_0x1c65a5(0x113))[_0x1c65a5(0x146)]('EXPORT_PRIVATE_SPACE',JSON['stringify']({'folderPath':_0x58217d,'targetFolderPath':_0x7c8456,'spacePwd':_0x35d0b8})),process[_0x1c65a5(0xc6)]({'type':'START_WORKER_BG_TASK'}),_0x13c6ca['json']({'code':0x0});});}let _0x483f17=path[_0x2fe1b0(0xb4)](_0x58217d,configFolderName,folderSignFileName);fs['stat'](_0x483f17,(_0x43dbde,_0x248b99)=>{const _0x1eae92=_0x2fe1b0;_0x43dbde?_0x4ebe06(_0x1177bb):checkSpacePwd(_0x13c6ca,_0x336de3,_0x58217d)[_0x1eae92(0x103)](()=>{_0x4ebe06(_0x1177bb);})['catch'](_0x4cac50=>{const _0x6bf097=_0x1eae92;return console[_0x6bf097(0x144)](_0x4cac50),_0x1177bb[_0x6bf097(0x124)]['returnErrMsg'](_0x13c6ca,_0x13c6ca['__']('private.passwordIncorrect'));});});});});}),router[_0x467462(0xfe)](_0x467462(0xbb),(_0x576a11,_0x17f703,_0x21d8c7)=>{const _0x11f0c8=_0x467462;let _0x2dc782=_0x576a11['body']['spaceId'],_0x593659=_0x576a11[_0x11f0c8(0x106)]['ids'];if(!_0x593659||_0x593659[_0x11f0c8(0xe4)]<0x1)return _0x17f703[_0x11f0c8(0x100)](0x194)[_0x11f0c8(0xe9)]();let _0x253891=dbPrivateSpaceTable[_0x11f0c8(0xf9)](_0x576a11[_0x11f0c8(0x124)][_0x11f0c8(0xed)],_0x2dc782);if(!_0x253891)return _0x17f703[_0x11f0c8(0x100)](0x194)[_0x11f0c8(0xe9)]();if(_0x576a11[_0x11f0c8(0x12d)][_0x11f0c8(0x134)]!=0x1){if(_0x253891[_0x11f0c8(0x121)]!=_0x576a11['currentUser']['id'])return _0x17f703[_0x11f0c8(0xc4)]({'code':0x1,'message':_0x17f703['__'](_0x11f0c8(0x9f))});}try{let _0x5c21cd=getPrivateIndexDb(_0x253891['folder_path']),_0x4f44b1=JSON[_0x11f0c8(0x137)](_0x593659),_0x2a5cdb=0x0,_0x3c3f0a=[],_0x44ebdb=0x0,_0x52417f=0x0;if(_0x4f44b1[_0x11f0c8(0xe4)]<0x1)return _0x17f703[_0x11f0c8(0xc4)]({'code':0x0,'deleteList':_0x3c3f0a,'deleteCount':_0x2a5cdb,'errCount':_0x44ebdb});for(let _0x2814f5=0x0;_0x2814f5<_0x4f44b1[_0x11f0c8(0xe4)];_0x2814f5++){let _0x462a97=dbPrivateSpaceTable['getIndexByWhere'](_0x5c21cd,_0x11f0c8(0x95)+_0x4f44b1[_0x2814f5]);if(!_0x462a97)return _0x576a11[_0x11f0c8(0x124)][_0x11f0c8(0xaf)](_0x17f703,_0x17f703['__'](_0x11f0c8(0x158)));let _0x2f0197=path['join'](_0x253891[_0x11f0c8(0x101)],_0x462a97[_0x11f0c8(0x159)]);if(_0x462a97[_0x11f0c8(0xcc)]&&_0x462a97['tiny_path']!='undefined'){let _0x3b8cb9=path[_0x11f0c8(0xb4)](_0x253891[_0x11f0c8(0x101)],_0x462a97[_0x11f0c8(0xcc)]);try{fs[_0x11f0c8(0x129)](_0x3b8cb9,_0x558d06=>{});}catch(_0xc6f8d1){}}fs[_0x11f0c8(0x129)](_0x2f0197,_0x591cc5=>{const _0xe8b4bd=_0x11f0c8;_0x52417f+=0x1;_0x591cc5?(console[_0xe8b4bd(0x144)](_0xe8b4bd(0x14a),_0x591cc5[_0xe8b4bd(0xeb)]),_0x44ebdb+=0x1):(_0x2a5cdb+=0x1,_0x3c3f0a['push'](_0x4f44b1[_0x2814f5]));dbPrivateSpaceTable[_0xe8b4bd(0xdc)](_0x5c21cd,_0x4f44b1[_0x2814f5]);if(_0x52417f==_0x4f44b1[_0xe8b4bd(0xe4)])return _0x17f703[_0xe8b4bd(0xc4)]({'code':0x0,'deleteList':_0x3c3f0a,'deleteCount':_0x2a5cdb,'errCount':_0x44ebdb});});}}catch(_0x550a04){return console[_0x11f0c8(0x144)]('error',_0x550a04),_0x17f703[_0x11f0c8(0xc4)]({'code':0x1,'message':JSON[_0x11f0c8(0x112)](_0x550a04)});}}),router[_0x467462(0xfe)](_0x467462(0x9d),(_0x5bb706,_0xe340b7,_0x287893)=>{const _0x3b16a7=_0x467462;if(checkSpaceId(_0x5bb706,_0xe340b7)!==!![])return;let _0x366325=_0x5bb706['body'][_0x3b16a7(0x11f)],_0x3b3fb3=dbPrivateSpaceTable[_0x3b16a7(0xf9)](_0x5bb706['app'][_0x3b16a7(0xed)],_0x366325);if(_0x5bb706['currentUser'][_0x3b16a7(0x134)]!=0x1){if(_0x3b3fb3[_0x3b16a7(0x121)]!=_0x5bb706[_0x3b16a7(0x12d)]['id'])return _0xe340b7[_0x3b16a7(0xc4)]({'code':0x1,'message':_0xe340b7['__'](_0x3b16a7(0x9f))});}return dbPrivateSpaceTable[_0x3b16a7(0x11a)](_0x5bb706[_0x3b16a7(0x124)][_0x3b16a7(0xed)],_0x366325),_0xe340b7[_0x3b16a7(0xc4)]({'code':0x0});}),router[_0x467462(0xfe)](_0x467462(0xe0),(_0x70fd9a,_0x220c2c,_0x1094b3)=>{const _0x5a07a1=_0x467462;let _0x2bbd08=_0x70fd9a[_0x5a07a1(0x106)][_0x5a07a1(0x154)],_0x177ca5=_0x70fd9a[_0x5a07a1(0x106)][_0x5a07a1(0x11f)];if(checkSpaceId(_0x70fd9a,_0x220c2c)!==!![])return;if(checkSpaceName(_0x70fd9a,_0x220c2c,_0x2bbd08)!==!![])return;let _0x540725=dbPrivateSpaceTable[_0x5a07a1(0xf9)](_0x70fd9a[_0x5a07a1(0x124)][_0x5a07a1(0xed)],_0x177ca5);if(_0x70fd9a[_0x5a07a1(0x12d)]['is_admin']!=0x1){if(_0x540725[_0x5a07a1(0x121)]!=_0x70fd9a[_0x5a07a1(0x12d)]['id'])return _0x220c2c[_0x5a07a1(0xc4)]({'code':0x1,'message':_0x220c2c['__'](_0x5a07a1(0x9f))});}return dbPrivateSpaceTable['updateSpaceName'](_0x70fd9a['app'][_0x5a07a1(0xed)],_0x2bbd08,_0x177ca5),_0x220c2c[_0x5a07a1(0xc4)]({'code':0x0});}),router[_0x467462(0xfe)](_0x467462(0x157),(_0x48d822,_0x251db9,_0x38dedc)=>{const _0x4b7636=_0x467462;let _0x324ad6=_0x48d822['body'][_0x4b7636(0x11f)];if(!_0x324ad6)return _0x48d822[_0x4b7636(0x124)][_0x4b7636(0xaf)](_0x251db9,_0x4b7636(0xf7));let _0x5a23b7=dbPrivateSpaceTable[_0x4b7636(0xf9)](_0x48d822[_0x4b7636(0x124)][_0x4b7636(0xed)],_0x324ad6);if(!_0x5a23b7)return _0x48d822['app']['returnErrMsg'](_0x251db9,_0x4b7636(0x91));let _0x5e5f92=config['getPrivateDbPath'](_0x5a23b7[_0x4b7636(0x101)]);fs[_0x4b7636(0x153)](_0x5e5f92,(_0x23cb4c,_0x4b86ed)=>{const _0xfa2f8b=_0x4b7636;if(_0x23cb4c)return _0x48d822[_0xfa2f8b(0x124)]['returnErrMsg'](_0x251db9,_0x251db9['__'](_0xfa2f8b(0xb7)));let _0x52ef4b=_0x48d822['body']['count']||0x64,_0x23bd43=_0x48d822[_0xfa2f8b(0x106)][_0xfa2f8b(0x97)]||0x0,_0x47a2f6=_0x48d822[_0xfa2f8b(0x106)][_0xfa2f8b(0xa2)]||'id',_0x457ebe=_0x48d822[_0xfa2f8b(0x106)]['orderType']||'desc',_0x33d277=_0x48d822[_0xfa2f8b(0x106)][_0xfa2f8b(0xd1)],_0x4607f5=getPrivateIndexDb(_0x5a23b7[_0xfa2f8b(0x101)]),_0x5ea7f6='';_0x33d277&&_0x33d277!=_0xfa2f8b(0x155)&&(_0x5ea7f6+=_0xfa2f8b(0xc3)+_0x33d277+'\x27');_0x5ea7f6+=_0xfa2f8b(0xb6)+_0x47a2f6+'\x20'+_0x457ebe+_0xfa2f8b(0xae)+_0x52ef4b+_0xfa2f8b(0x12a)+_0x23bd43;let _0x5a2f15=dbPrivateSpaceTable[_0xfa2f8b(0xa3)](_0x4607f5,_0x5ea7f6);return _0x251db9[_0xfa2f8b(0xc4)]({'code':0x0,'data':_0x5a2f15});});});function getPwdFromToken(_0x2df2a8,_0x3e7fa9,_0xea6ad6){const _0x4ee8ba=_0x467462;let _0x533f1b=_0x2df2a8[_0x4ee8ba(0x12b)]['spaceToken']||_0x2df2a8[_0x4ee8ba(0x106)][_0x4ee8ba(0xce)]||_0x2df2a8[_0x4ee8ba(0xa7)][_0x4ee8ba(0xe2)],_0x4922b3=dbPrivateSpaceTable[_0x4ee8ba(0xf3)](_0x2df2a8[_0x4ee8ba(0x124)][_0x4ee8ba(0xed)],_0x533f1b);if(!_0x4922b3)return _0x3e7fa9[_0x4ee8ba(0xc4)]({'code':0x68});let _0x38ea41=_0x4922b3['pwd'];cryptoUtils['decryptString'](config[_0x4ee8ba(0xc8)],_0x38ea41)[_0x4ee8ba(0x103)](_0x5ca699=>{_0xea6ad6(_0x5ca699);})[_0x4ee8ba(0x156)](_0x4e913c=>{const _0x190e36=_0x4ee8ba;console[_0x190e36(0x144)](_0x4e913c);});}router['get'](_0x467462(0x128),(_0x9cde1b,_0x4dc4b9,_0x535f0a)=>{const _0x551a8d=_0x467462;try{let _0x459381=_0x9cde1b['query'][_0x551a8d(0x11f)],_0x36d90=_0x9cde1b['query'][_0x551a8d(0x13b)],_0x4a12cb=_0x9cde1b[_0x551a8d(0x12b)][_0x551a8d(0xb9)],_0x3a4e8f=_0x9cde1b['query'][_0x551a8d(0xe3)];if(!_0x459381||!_0x36d90)return _0x9cde1b[_0x551a8d(0x124)][_0x551a8d(0xaf)](_0x4dc4b9,'space/index\x20id\x20is\x20null');let _0x4f2c60=dbPrivateSpaceTable[_0x551a8d(0xf9)](_0x9cde1b['app']['dbOther'],_0x459381);if(!_0x4f2c60)return _0x9cde1b['app'][_0x551a8d(0xaf)](_0x4dc4b9,_0x551a8d(0x91));getPwdFromToken(_0x9cde1b,_0x4dc4b9,_0x565b04=>{const _0x412164=_0x551a8d;let _0x28ce41=getPrivateIndexDb(_0x4f2c60[_0x412164(0x101)]),_0x4a2a29=dbPrivateSpaceTable[_0x412164(0x15a)](_0x28ce41,_0x36d90);if(!_0x4a2a29)return _0x4dc4b9[_0x412164(0x100)](0x194)[_0x412164(0xe9)]();let _0x43481b='';_0x3a4e8f==_0x412164(0xf8)?_0x43481b=path[_0x412164(0xb4)](_0x4f2c60[_0x412164(0x101)],_0x4a2a29[_0x412164(0xcc)]):_0x43481b=path[_0x412164(0xb4)](_0x4f2c60[_0x412164(0x101)],_0x4a2a29[_0x412164(0x159)]);if(_0x4a12cb==0x1)try{let _0x19d83f=Buffer[_0x412164(0xa9)](_0x4a2a29[_0x412164(0xb8)],_0x412164(0xba))[_0x412164(0xf2)]();const _0x8b2835=encodeURIComponent(_0x19d83f)[_0x412164(0x105)](/%([0-9A-F]{2})/g,(_0x13efed,_0x411186)=>'%'+_0x411186['toUpperCase']());_0x4dc4b9['setHeader'](_0x412164(0x9e),_0x412164(0xe5)+_0x8b2835);}catch(_0x518bb7){console[_0x412164(0x144)](_0x518bb7);}fs[_0x412164(0x153)](_0x43481b,(_0x3caab2,_0x323615)=>{const _0x382156=_0x412164;if(_0x3caab2)return _0x4dc4b9[_0x382156(0x100)](0x194)[_0x382156(0xe9)]();if(_0x43481b[_0x382156(0xa1)](_0x382156(0xf8))==-0x1){let _0x6632e1=dbPrivateSpaceTable[_0x382156(0x14c)](_0x28ce41,_0x382156(0xd3),new Date()[_0x382156(0x142)](),_0x36d90);}if(sharpUtil[_0x382156(0x116)](_0x4a2a29[_0x382156(0x10b)])&&_0x3a4e8f!=_0x382156(0xf8)){let _0x2bb9c9=cryptoUtils['decryptFileGetStream'](_0x565b04,_0x43481b);fileUtil[_0x382156(0x96)](_0x2bb9c9)[_0x382156(0x103)](_0x4eeaf3=>{const _0x1ca5d1=_0x382156;sharpUtil[_0x1ca5d1(0xca)](_0x4a2a29[_0x1ca5d1(0x10b)],_0x4eeaf3,(_0x373be9,_0x3dfc7a,_0x46299f)=>{const _0x4a888b=_0x1ca5d1;sharpUtil[_0x4a888b(0x116)](_0x4a2a29[_0x4a888b(0x10b)][_0x4a888b(0xff)]())?sharpUtil['sharpDealImg'](_0x373be9,null,![],null,_0x4a888b(0xd6),null,_0x588c70=>{const _0x298eb7=_0x4a888b;_0x4dc4b9['send'](Buffer[_0x298eb7(0xa9)](_0x588c70));},_0x3f5fdf=>{const _0xb99ab=_0x4a888b;return console[_0xb99ab(0x144)](_0x3f5fdf),_0x4dc4b9[_0xb99ab(0x100)](0x194)[_0xb99ab(0xe9)]();},_0x3dfc7a,_0x46299f):typeof _0x373be9==_0x4a888b(0x151)?(_0x4dc4b9[_0x4a888b(0x118)](_0x373be9),_0x4dc4b9['on'](_0x4a888b(0xdb),()=>{_0x3dfc7a&&fs['rm'](_0x373be9,_0x5f1d22=>{});})):_0x4dc4b9[_0x4a888b(0xc6)](_0x373be9);});});}else cryptoUtils[_0x382156(0x126)](_0x565b04,_0x43481b,_0x4dc4b9,_0x4dc4b9);return;});});}catch(_0x3d9d29){return console[_0x551a8d(0x144)](_0x3d9d29),_0x4dc4b9[_0x551a8d(0x100)](0x194)[_0x551a8d(0xe9)]();}}),router['post'](_0x467462(0xa4),(_0x295203,_0x39114b,_0x4d288f)=>{const _0x555977=_0x467462;try{return dbPrivateSpaceTable[_0x555977(0xe1)](_0x295203['app']['dbOther'],_0x295203[_0x555977(0x106)]['spaceId']),_0x39114b[_0x555977(0x100)](0xc8)['end']();}catch(_0x596cce){return console[_0x555977(0x144)](_0x596cce),_0x39114b[_0x555977(0x100)](0x194)['end']();}}),module[_0x467462(0xf4)]=router;