const _0x141839=_0x29fb;(function(_0xf8a663,_0xfa5246){const _0x4719a8=_0x29fb,_0x54f6cf=_0xf8a663();while(!![]){try{const _0x1b2c8b=parseInt(_0x4719a8(0x1fa))/0x1+parseInt(_0x4719a8(0x26c))/0x2*(-parseInt(_0x4719a8(0x1c4))/0x3)+parseInt(_0x4719a8(0x1d1))/0x4*(parseInt(_0x4719a8(0x256))/0x5)+-parseInt(_0x4719a8(0x1f4))/0x6*(parseInt(_0x4719a8(0x268))/0x7)+parseInt(_0x4719a8(0x1e0))/0x8+parseInt(_0x4719a8(0x244))/0x9*(-parseInt(_0x4719a8(0x22d))/0xa)+-parseInt(_0x4719a8(0x1f9))/0xb*(-parseInt(_0x4719a8(0x1b9))/0xc);if(_0x1b2c8b===_0xfa5246)break;else _0x54f6cf['push'](_0x54f6cf['shift']());}catch(_0x3cbb3d){_0x54f6cf['push'](_0x54f6cf['shift']());}}}(_0x14b5,0xf339c));let express=require(_0x141839(0x228)),router=express[_0x141839(0x1d3)]();const Database=require(_0x141839(0x1d0));let dbPrivateSpaceTable=require(_0x141839(0x26b)),path=require(_0x141839(0x20c)),fs=require('fs'),cryptoUtils=require('../utils/cryptoUtils');const config=require(_0x141839(0x1eb));let privateSpaceUtils=require(_0x141839(0x25e));var faststart=require('../utils/faststart'),exifUtil=require(_0x141839(0x254));let uploadUtil=require(_0x141839(0x1f8));const PassThrough=require('stream')[_0x141839(0x1b7)],{Readable}=require(_0x141839(0x215));let sha256=require(_0x141839(0x213));const videoStreamUtil=require(_0x141839(0x250));let fileUtil=require(_0x141839(0x214));const folderSignString=_0x141839(0x24a),folderSignFileName=_0x141839(0x1c7),configFolderName=_0x141839(0x230),noCheckFileList=[_0x141839(0x23f)];let FFmpeg=require(_0x141839(0x1d8))['FFmpeg'];const uploadPrivateUtil=require('../utils/uploadPrivateUtils'),privateSharpUtil=require(_0x141839(0x25e)),sharpUtil=require(_0x141839(0x1ed)),transCodeUtil=require(_0x141839(0x221));let dbArr=[];function checkSpaceId(_0x3b7de2,_0x372997){const _0x4052a2=_0x141839;let _0x2e4b84=_0x3b7de2[_0x4052a2(0x274)][_0x4052a2(0x1e4)]||_0x3b7de2[_0x4052a2(0x1f6)][_0x4052a2(0x1e4)];if(!_0x2e4b84)return _0x3b7de2['app'][_0x4052a2(0x264)](_0x372997,'space\x20id\x20is\x20null');let _0x25569f=dbPrivateSpaceTable[_0x4052a2(0x1c8)](_0x3b7de2[_0x4052a2(0x1db)]['dbOther'],_0x2e4b84);if(!_0x25569f)return _0x3b7de2[_0x4052a2(0x1db)][_0x4052a2(0x264)](_0x372997,_0x4052a2(0x258));return!![];}function checkSpaceName(_0x2eca08,_0x389806,_0x324b34){const _0x59cc9e=_0x141839;if(!_0x324b34)return _0x2eca08[_0x59cc9e(0x1db)][_0x59cc9e(0x264)](_0x389806,_0x389806['__'](_0x59cc9e(0x1cb)));if(_0x324b34[_0x59cc9e(0x1d2)]>0x1e)return _0x2eca08['app'][_0x59cc9e(0x264)](_0x389806,_0x389806['__'](_0x59cc9e(0x216)));return!![];}function getPrivateIndexDb(_0x3749ce){const _0x5b47b6=_0x141839;let _0x3905a6=config['getPrivateDbPath'](_0x3749ce);for(let _0x3c54b1 in dbArr){if(dbArr[_0x3c54b1][_0x5b47b6(0x1e3)]==_0x3905a6)return dbArr[_0x3c54b1]['db'];}let _0x448527=new Database(_0x3905a6,{});return _0x448527[_0x5b47b6(0x238)](_0x5b47b6(0x1c3)),dbArr['push']({'dbPath':_0x3905a6,'db':_0x448527}),_0x448527;}router[_0x141839(0x229)]('/addPrivateSpace',(_0x197781,_0x55c8fa,_0x5b4650)=>{const _0x564344=_0x141839;let _0x2b4c25=_0x197781[_0x564344(0x274)][_0x564344(0x1ee)],_0x2f11a3=_0x197781[_0x564344(0x274)][_0x564344(0x243)],_0x2675cf=_0x197781[_0x564344(0x1d5)],_0xe72a3b=_0x197781[_0x564344(0x274)]['spacePwd'];if(checkSpaceName(_0x197781,_0x55c8fa,_0x2f11a3)!==!![])return;if(!_0xe72a3b||_0xe72a3b[_0x564344(0x1d2)]<0x4)return _0x197781[_0x564344(0x1db)][_0x564344(0x264)](_0x55c8fa,_0x55c8fa['__'](_0x564344(0x1e6)));function _0x4e83cd(){return new Promise((_0x335815,_0x1a34f4)=>{const _0x939fdd=_0x29fb;fs[_0x939fdd(0x227)](_0x2b4c25,(_0xd86ae,_0x5eabbc)=>{const _0x3af935=_0x939fdd;if(_0xd86ae)return _0x1a34f4(_0x55c8fa['__'](_0x3af935(0x1c9)));if(_0x5eabbc[_0x3af935(0x237)]>0x400*0x400*0x400)return _0x197781[_0x3af935(0x1db)]['returnErrMsg'](_0x55c8fa,_0x55c8fa['__'](_0x3af935(0x1c9)));fs['readdir'](_0x2b4c25,(_0x36d8ba,_0x5574cb)=>{const _0x2a260f=_0x3af935;for(let _0x28f6b9 of _0x5574cb){if(noCheckFileList[_0x2a260f(0x1d9)](_0x28f6b9)||_0x28f6b9[_0x2a260f(0x271)]('.')||_0x28f6b9[_0x2a260f(0x271)]('@'))continue;return _0x1a34f4(_0x55c8fa['__']('needEmptyFolderPrivateSpace'));}_0x335815();});});});}fs[_0x564344(0x219)](_0x2b4c25,fs['constants'][_0x564344(0x21a)]|fs[_0x564344(0x1b8)]['W_OK'],_0x466a62=>{const _0x59e36a=_0x564344;if(_0x466a62)return _0x197781['app'][_0x59e36a(0x264)](_0x55c8fa,_0x55c8fa['__']('noWritePermission'));_0x4e83cd()[_0x59e36a(0x1ec)](()=>{const _0x35f9eb=_0x59e36a;let _0xdcbf3a=dbPrivateSpaceTable[_0x35f9eb(0x245)](_0x197781[_0x35f9eb(0x1db)]['dbOther'],_0x2f11a3);if(_0xdcbf3a)return _0x197781['app'][_0x35f9eb(0x264)](_0x55c8fa,_0x55c8fa['__']('private.hasSameNameSpace'));let _0x1d566e=path[_0x35f9eb(0x1ea)](_0x2b4c25,configFolderName);fs[_0x35f9eb(0x1bb)](_0x1d566e,{'recursive':!![]},_0x354319=>{const _0x18a2a0=_0x35f9eb;if(_0x354319)return _0x197781[_0x18a2a0(0x1db)][_0x18a2a0(0x264)](_0x55c8fa,_0x55c8fa['__'](_0x18a2a0(0x204))+JSON[_0x18a2a0(0x257)](_0x354319));let _0x1750d3=getPrivateIndexDb(_0x2b4c25);dbPrivateSpaceTable[_0x18a2a0(0x1e5)](_0x1750d3,_0x2b4c25),cryptoUtils[_0x18a2a0(0x202)](_0xe72a3b,folderSignString)[_0x18a2a0(0x1ec)](_0x35b8b3=>{const _0x4f313f=_0x18a2a0;let _0xbcb6c0=path[_0x4f313f(0x1ea)](_0x1d566e,folderSignFileName);fs[_0x4f313f(0x1bd)](_0xbcb6c0,_0x35b8b3,_0x8f4990=>{const _0x58b138=_0x4f313f;if(_0x8f4990)return _0x197781['app'][_0x58b138(0x264)](_0x55c8fa,_0x55c8fa['__'](_0x58b138(0x204))+JSON[_0x58b138(0x257)](_0x8f4990));return dbPrivateSpaceTable[_0x58b138(0x1e1)](_0x197781['app'][_0x58b138(0x21e)],{'folder_path':_0x2b4c25,'space_name':_0x2f11a3,'create_uid':_0x2675cf['id']}),_0x55c8fa[_0x58b138(0x20b)]({'code':0x0});});})[_0x18a2a0(0x270)](_0x13e16b=>{const _0x49af7e=_0x18a2a0;return console[_0x49af7e(0x206)](_0x49af7e(0x20d),_0x13e16b),_0x197781[_0x49af7e(0x1db)][_0x49af7e(0x264)](_0x55c8fa,_0x55c8fa['__'](_0x49af7e(0x204))+JSON[_0x49af7e(0x257)](_0x13e16b));});});})['catch'](_0x46043a=>{const _0x48b35a=_0x59e36a;return _0x197781[_0x48b35a(0x1db)]['returnErrMsg'](_0x55c8fa,_0x46043a);});});}),router[_0x141839(0x229)]('/getAllSpace',(_0x4d00fc,_0x3df604,_0x3d4562)=>{const _0x31cd9c=_0x141839;let _0x2ae245=[];return _0x4d00fc['currentUser'][_0x31cd9c(0x1b6)]==0x1?_0x2ae245=dbPrivateSpaceTable['getAll'](_0x4d00fc[_0x31cd9c(0x1db)][_0x31cd9c(0x21e)]):_0x2ae245=dbPrivateSpaceTable[_0x31cd9c(0x21b)](_0x4d00fc['app'][_0x31cd9c(0x21e)],_0x4d00fc['currentUser']['id']),_0x3df604['json']({'code':0x0,'data':_0x2ae245});});function checkSpacePwd(_0x4a0056,_0x45cf0f,_0x2e5269){return new Promise((_0x189029,_0x288ff9)=>{const _0x83e041=_0x29fb;_0x45cf0f=Buffer[_0x83e041(0x273)](_0x45cf0f,'base64')['toString']();let _0x29790d=path[_0x83e041(0x1ea)](_0x2e5269,configFolderName,folderSignFileName);fs[_0x83e041(0x227)](_0x29790d,(_0x1ba5b4,_0x348fc6)=>{const _0x241e8e=_0x83e041;if(_0x1ba5b4)return _0x288ff9(_0x4a0056['__'](_0x241e8e(0x1f1)));fs['readFile'](_0x29790d,_0x241e8e(0x240),(_0x46713c,_0x2d4e2d)=>{const _0x17047a=_0x241e8e;if(_0x46713c)return _0x288ff9(_0x4a0056['__']('private.configFileReadFail'));else cryptoUtils['decryptString'](_0x45cf0f,_0x2d4e2d)[_0x17047a(0x1ec)](_0x34a977=>{const _0x4bd887=_0x17047a;return _0x34a977==folderSignString?_0x189029(_0x45cf0f):_0x288ff9(_0x4a0056['__'](_0x4bd887(0x225)));})[_0x17047a(0x270)](_0x455d39=>{const _0x48ee7c=_0x17047a;return console[_0x48ee7c(0x206)]('error',_0x455d39),_0x288ff9(_0x4a0056['__'](_0x48ee7c(0x225)));});});});});}function _0x29fb(_0x556612,_0x1530a4){const _0x14b532=_0x14b5();return _0x29fb=function(_0x29fb97,_0x204c7f){_0x29fb97=_0x29fb97-0x1b0;let _0x366c8f=_0x14b532[_0x29fb97];return _0x366c8f;},_0x29fb(_0x556612,_0x1530a4);}router[_0x141839(0x229)](_0x141839(0x205),(_0x48420f,_0x5d5267,_0xf7e986)=>{const _0x417b7e=_0x141839;let _0x13cd0a=_0x48420f[_0x417b7e(0x274)][_0x417b7e(0x255)],_0x6206af=_0x48420f[_0x417b7e(0x274)][_0x417b7e(0x1e4)],_0x51063b=dbPrivateSpaceTable[_0x417b7e(0x1c8)](_0x48420f[_0x417b7e(0x1db)]['dbOther'],_0x6206af);if(!_0x51063b)return _0x48420f[_0x417b7e(0x1db)][_0x417b7e(0x264)](_0x5d5267,'error\x20space\x20id');fs[_0x417b7e(0x227)](_0x51063b[_0x417b7e(0x1f0)],(_0xc5fb86,_0x3bc016)=>{const _0x1988b4=_0x417b7e;if(_0xc5fb86)return _0x48420f[_0x1988b4(0x1db)]['returnErrMsg'](_0x5d5267,_0x5d5267['__']('private.spaceFolderNotExist'));checkSpacePwd(_0x5d5267,_0x13cd0a,_0x51063b[_0x1988b4(0x1f0)])[_0x1988b4(0x1ec)](_0x16543d=>{const _0x1db4cc=_0x1988b4;let _0x14cbc1=sha256(new Date()[_0x1db4cc(0x266)]()+_0x6206af+_0x16543d);cryptoUtils[_0x1db4cc(0x202)](config[_0x1db4cc(0x1bc)],_0x16543d)['then'](_0x3d3595=>{const _0x3ebf26=_0x1db4cc;return dbPrivateSpaceTable[_0x3ebf26(0x1e2)](_0x48420f[_0x3ebf26(0x1db)][_0x3ebf26(0x21e)],{'space_id':_0x6206af,'pwd':_0x3d3595,'token':_0x14cbc1}),_0x5d5267[_0x3ebf26(0x20b)]({'code':0x0,'token':_0x14cbc1});});})[_0x1988b4(0x270)](_0x1dcb77=>{const _0x4f4349=_0x1988b4;return console[_0x4f4349(0x206)](_0x4f4349(0x20d),_0x1dcb77),_0x48420f['app'][_0x4f4349(0x264)](_0x5d5267,_0x1dcb77);});});});function ffprobeSync(_0x56ba54){return new Promise((_0x2fe208,_0x3f57dd)=>{const _0x1d24ec=_0x29fb;try{FFmpeg(transCodeUtil[_0x1d24ec(0x1dd)](_0x56ba54))[_0x1d24ec(0x23d)]((_0x1513df,_0x59c256)=>{_0x1513df?_0x3f57dd(_0x1513df):_0x2fe208(_0x59c256);});}catch(_0x643b45){console[_0x1d24ec(0x206)](_0x1d24ec(0x20d),_0x643b45),_0x3f57dd(_0x643b45);}});}function deleteFile(_0x500c97){fs['rm'](_0x500c97,{'maxRetries':0xa,'retryDelay':0x3e8},_0x2245a3=>{});}function uploadFail(_0x11954f,_0x50477f,_0x2831d9,_0x26cc40){const _0x6afb54=_0x141839;return deleteFile(_0x50477f),_0x2831d9[_0x6afb54(0x1db)][_0x6afb54(0x264)](_0x26cc40,_0x26cc40['__'](_0x6afb54(0x241)));}function dealUploadImageOrFile(_0x1ebdfb,_0x43d52c,_0x5a8dc7,_0xd192ef,_0x2c5c84,_0x3d4185,_0x2d9c55,_0x33b213,_0x430053){const _0x43383f=_0x141839;uploadPrivateUtil[_0x43383f(0x1cd)](_0x5a8dc7,_0xd192ef,_0x2c5c84,_0x3d4185,_0x48b4e5=>{const _0x210ebb=_0x43383f;let _0x59081f=_0x48b4e5[_0x210ebb(0x20c)],_0x54a827=cryptoUtils[_0x210ebb(0x20f)](_0x3d4185,_0x59081f),_0x12a4de=dbPrivateSpaceTable[_0x210ebb(0x251)](_0x1ebdfb,{'filename':new Buffer[(_0x210ebb(0x273))](_0x33b213)[_0x210ebb(0x200)](_0x210ebb(0x22e)),'filename_enc':_0x2c5c84,'file_type':_0x2d9c55,'ext':_0x430053});if(_0x12a4de[_0x210ebb(0x1dc)]<0x1)return uploadFail(_0x1ebdfb,_0x59081f,_0x5a8dc7,_0xd192ef);let _0x59825e=_0x12a4de[_0x210ebb(0x203)];_0xd192ef['json']({'code':0x0});let _0x557b69=new Date()[_0x210ebb(0x266)]();if(_0x2d9c55==_0x210ebb(0x218)){var _0x4d7539=[];let _0x152a79=new PassThrough()['pipe'](_0x54a827);_0x152a79['on']('data',function(_0x2f20f3){_0x4d7539['push'](_0x2f20f3);}),_0x152a79['on'](_0x210ebb(0x1d7),function(){const _0x1a70a1=_0x210ebb;var _0x42bb0a=Buffer[_0x1a70a1(0x222)](_0x4d7539);function _0x2d700f(){const _0x42d199=_0x1a70a1;exifUtil[_0x42d199(0x1da)](_0x42bb0a)[_0x42d199(0x1ec)](_0x1ed45e=>{const _0x5167c2=_0x42d199;if(_0x1ed45e){let _0x1ce7c7=_0x1ed45e[_0x5167c2(0x226)];_0x1ed45e[_0x5167c2(0x1c1)]&&!_0x1ce7c7&&(_0x1ce7c7=_0x1ed45e['CreateDate']),_0x1ce7c7&&(_0x557b69=new Date(_0x1ce7c7)[_0x5167c2(0x266)](),_0x1ebdfb[_0x5167c2(0x1f3)]('UPDATE\x20private_space_index\x20SET\x20original_time=\x27'+_0x557b69+_0x5167c2(0x1e9)+_0x59825e)[_0x5167c2(0x262)]());}})[_0x42d199(0x270)](_0xa7c429=>{});}privateSpaceUtils[_0x1a70a1(0x1fe)](_0x430053,_0x42bb0a,_0x6fee29=>{const _0x4952a6=_0x1a70a1,_0x42c0c4=Readable[_0x4952a6(0x273)](_0x6fee29);let _0x587104=path['join'](_0x43d52c,_0x2c5c84);cryptoUtils[_0x4952a6(0x24d)](_0x3d4185,_0x42c0c4,_0x587104)[_0x4952a6(0x1ec)](_0x47a5c3=>{const _0x3cabbd=_0x4952a6;let _0x38c3ec=path[_0x3cabbd(0x1ea)](configFolderName,'tiny',_0x2c5c84);_0x1ebdfb[_0x3cabbd(0x1f3)](_0x3cabbd(0x26a)+_0x38c3ec+_0x3cabbd(0x1e9)+_0x59825e)[_0x3cabbd(0x262)](),_0x2d700f();});},_0x261854=>{_0x2d700f();});});}});}function dealUploadVideo(_0x112b2a,_0x539c1b,_0x119ce2,_0x442bfa,_0x4ac2a7,_0x1baeea,_0x426f84,_0x316281,_0x2a805b,_0x101321,_0x1ab7c8){const _0x1831b6=_0x141839;_0x4ac2a7[_0x1831b6(0x1f6)][_0x1831b6(0x1b4)]=_0x442bfa,_0x4ac2a7['query']['overMode']=_0x1831b6(0x23c),uploadUtil[_0x1831b6(0x1cd)](_0x4ac2a7,_0x1baeea,![],!![],![],_0xb7d0ce=>{const _0x553856=_0x1831b6;let _0x223e5a=_0xb7d0ce[_0x553856(0x20c)],_0x501b1e=path[_0x553856(0x1ea)](_0xb7d0ce[_0x553856(0x209)]);function _0x4650c2(_0x471195){const _0x1c835e=_0x553856;ffprobeSync(_0x223e5a)[_0x1c835e(0x1ec)](_0x53ec4a=>{const _0x4fbc86=_0x1c835e;let _0x35e5b8=0x0;_0x35e5b8=videoStreamUtil[_0x4fbc86(0x1d4)](_0x53ec4a);let _0x3709e8=JSON[_0x4fbc86(0x257)](_0x53ec4a[_0x4fbc86(0x1fc)]),_0x155544=videoStreamUtil['getVideoOriginalTime'](_0x53ec4a);fs[_0x4fbc86(0x227)](_0x223e5a,(_0x5c5b5a,_0x527d63)=>{const _0x565f1d=_0x4fbc86;if(_0x5c5b5a){deleteFile(_0x223e5a);return;}let _0x169af9=_0x565f1d(0x248);_0x112b2a[_0x565f1d(0x1f3)](_0x169af9)[_0x565f1d(0x262)](_0x155544,parseInt(_0x35e5b8),_0x527d63[_0x565f1d(0x237)],_0x3709e8,_0x471195);let _0x1b1556=_0x565f1d(0x1e8)+Buffer[_0x565f1d(0x273)](_0x101321)['toString']('base64');privateSpaceUtils[_0x565f1d(0x21d)](_0x223e5a,_0x501b1e,_0x1b1556,_0xecd079=>{const _0x9ceab6=_0x565f1d;fs[_0x9ceab6(0x227)](_0xecd079,(_0x1c4677,_0x42ed90)=>{const _0x1395bb=_0x9ceab6;if(_0x1c4677){deleteFile(_0x223e5a);return;}let _0x53d839=path['join'](_0x119ce2,_0x426f84);cryptoUtils[_0x1395bb(0x224)](_0x316281,_0xecd079,_0x53d839)[_0x1395bb(0x1ec)](_0x1bee8a=>{const _0xddb971=_0x1395bb;let _0x4d13d4=path[_0xddb971(0x1ea)](configFolderName,_0xddb971(0x1ba),_0x426f84);_0x112b2a[_0xddb971(0x1f3)](_0xddb971(0x26a)+_0x4d13d4+_0xddb971(0x1e9)+_0x471195)['run'](),deleteFile(_0xecd079),deleteFile(_0x223e5a);});});},_0x3e4473=>{deleteFile(_0x223e5a);});});})[_0x1c835e(0x270)](_0x19a530=>{deleteFile(_0x223e5a);});}function _0x37e49c(){const _0x6cbee9=_0x553856;let _0x3574a8=dbPrivateSpaceTable[_0x6cbee9(0x251)](_0x112b2a,{'filename':new Buffer[(_0x6cbee9(0x273))](_0x101321)[_0x6cbee9(0x200)](_0x6cbee9(0x22e)),'filename_enc':_0x426f84,'file_type':_0x2a805b,'ext':_0x1ab7c8});return _0x3574a8[_0x6cbee9(0x1dc)]<0x1?uploadFail(_0x112b2a,_0x223e5a,_0x4ac2a7,_0x1baeea):(_0x4650c2(_0x3574a8[_0x6cbee9(0x203)]),_0x1baeea[_0x6cbee9(0x20b)]({'code':0x0}));}function _0x4159c4(_0xbb2fc0,_0x108fcb,_0x2e3c74){const _0x5279f4=_0x553856;cryptoUtils[_0x5279f4(0x224)](_0x316281,_0xbb2fc0,_0x108fcb)['then'](_0x25718c=>{_0x2e3c74(_0x25718c);})[_0x5279f4(0x270)](_0x40a833=>{console['log'](_0x40a833),uploadFail(_0x112b2a,_0xbb2fc0,_0x4ac2a7,_0x1baeea);});}let _0x4feb71=path[_0x553856(0x1ea)](_0x539c1b[_0x553856(0x1f0)],_0x426f84);if(_0x1ab7c8==_0x553856(0x21c)||_0x1ab7c8=='.mov'){var _0x68178e=faststart[_0x553856(0x201)](_0x223e5a,{'errorCallBack':_0x38422b=>{_0x4159c4(_0x223e5a,_0x4feb71,_0x37e49c);}});_0x68178e['on'](_0x553856(0x1ce),function(){const _0x23a8f2=_0x553856;_0x68178e[_0x23a8f2(0x25b)]();}),cryptoUtils['encryptFileFromInputPipe'](_0x316281,_0x68178e,_0x4feb71)[_0x553856(0x1ec)](_0x31b80b=>{_0x37e49c();})[_0x553856(0x270)](_0xd16921=>{const _0x15a7b8=_0x553856;console[_0x15a7b8(0x206)]('error',_0xd16921),uploadFail(_0x112b2a,_0x223e5a,_0x4ac2a7,_0x1baeea);});}else _0x4159c4(_0x223e5a,_0x4feb71,_0x37e49c);});}router[_0x141839(0x229)](_0x141839(0x1cf),function(_0x2f3df4,_0x52d5bb,_0x5030b3){const _0x17d30b=_0x141839;let _0x282b85=_0x2f3df4[_0x17d30b(0x1f6)]['spaceId']||_0x2f3df4['body'][_0x17d30b(0x1e4)]||_0x2f3df4[_0x17d30b(0x21f)][_0x17d30b(0x24f)],_0x135905=_0x2f3df4[_0x17d30b(0x1f6)]['filename']||_0x2f3df4[_0x17d30b(0x21f)][_0x17d30b(0x1c5)],_0x25564d=decodeURIComponent(_0x135905);_0x2f3df4['query'][_0x17d30b(0x1b5)]&&(_0x25564d=fileUtil['decodePath'](_0x2f3df4[_0x17d30b(0x1f6)][_0x17d30b(0x1b5)])),getPwdFromToken(_0x2f3df4,_0x52d5bb,_0x2524b3=>{const _0xfb8420=_0x17d30b;let _0x37dfad=dbPrivateSpaceTable[_0xfb8420(0x1c8)](_0x2f3df4[_0xfb8420(0x1db)][_0xfb8420(0x21e)],_0x282b85);if(!_0x37dfad)return _0x2f3df4['app'][_0xfb8420(0x264)](_0x52d5bb,_0x52d5bb['__'](_0xfb8420(0x207)));_0x2f3df4[_0xfb8420(0x1f6)][_0xfb8420(0x1b4)]=_0x37dfad[_0xfb8420(0x1f0)];let _0x398ae0=getPrivateIndexDb(_0x37dfad[_0xfb8420(0x1f0)]),_0x274ddb=dbPrivateSpaceTable[_0xfb8420(0x210)](_0x398ae0,new Buffer[(_0xfb8420(0x273))](_0x25564d)[_0xfb8420(0x200)](_0xfb8420(0x22e)));if(_0x274ddb)return _0x2f3df4[_0xfb8420(0x1db)][_0xfb8420(0x264)](_0x52d5bb,_0x52d5bb['__']('private.alreadyHasSameNameFile'));let _0x41894b=path[_0xfb8420(0x25a)](_0x25564d)?path['extname'](_0x25564d)[_0xfb8420(0x23a)]():null,_0x28861c=_0xfb8420(0x1ef);if(_0x41894b){if(config['imgTypeList']['includes'](_0x41894b[_0xfb8420(0x23a)]())||config['rawImgTypeList']['includes'](_0x41894b[_0xfb8420(0x23a)]()))_0x28861c=_0xfb8420(0x218);else config['videoTypeList']['includes'](_0x41894b[_0xfb8420(0x23a)]())&&(_0x28861c=_0xfb8420(0x1b1));}let _0x5d6a66=path[_0xfb8420(0x1ea)](_0x37dfad[_0xfb8420(0x1f0)],configFolderName,'tiny'),_0x5e7a3e=path[_0xfb8420(0x1ea)](_0x37dfad[_0xfb8420(0x1f0)],configFolderName,_0xfb8420(0x1cc));function _0x56d568(){const _0x5853dd=_0xfb8420;cryptoUtils['encryptString'](_0x2524b3,_0x25564d)[_0x5853dd(0x1ec)](_0x33a93a=>{const _0x19f435=_0x5853dd;if(_0x33a93a[_0x19f435(0x1d2)]>0xf0)return _0x2f3df4[_0x19f435(0x1db)][_0x19f435(0x264)](_0x52d5bb,_0x52d5bb['__'](_0x19f435(0x1f5)));_0x28861c==_0x19f435(0x1b1)?dealUploadVideo(_0x398ae0,_0x37dfad,_0x5d6a66,_0x5e7a3e,_0x2f3df4,_0x52d5bb,_0x33a93a,_0x2524b3,_0x28861c,_0x25564d,_0x41894b):dealUploadImageOrFile(_0x398ae0,_0x5d6a66,_0x2f3df4,_0x52d5bb,_0x33a93a,_0x2524b3,_0x28861c,_0x25564d,_0x41894b);});}fs[_0xfb8420(0x227)](_0x5d6a66,(_0xa4af9b,_0x973c87)=>{const _0x54fc0a=_0xfb8420;function _0x8e1db3(){const _0x380fbf=_0x29fb;fs[_0x380fbf(0x227)](_0x5e7a3e,(_0x51f80b,_0x3415a7)=>{const _0x3f203a=_0x380fbf;_0x51f80b?fs[_0x3f203a(0x1bb)](_0x5e7a3e,{'recursive':!![]},_0x56c383=>{_0x56d568();}):_0x56d568();});}_0xa4af9b?fs[_0x54fc0a(0x1bb)](_0x5d6a66,{'recursive':!![]},_0x12467b=>{_0x8e1db3();}):_0x8e1db3();});});}),router[_0x141839(0x229)]('/importSpace',(_0x516097,_0x25edfd,_0x47a63d)=>{const _0x3bfb9c=_0x141839;let _0x5eb528=_0x516097[_0x3bfb9c(0x274)][_0x3bfb9c(0x1ee)],_0x301789=_0x516097[_0x3bfb9c(0x274)][_0x3bfb9c(0x243)],_0x21c3ba=_0x516097[_0x3bfb9c(0x1d5)],_0x22ad85=_0x516097[_0x3bfb9c(0x274)][_0x3bfb9c(0x24c)];if(!_0x301789)return _0x516097[_0x3bfb9c(0x1db)]['returnErrMsg'](_0x25edfd,_0x25edfd['__'](_0x3bfb9c(0x1cb)));let _0x6072c4=dbPrivateSpaceTable['getBySpaceName'](_0x516097[_0x3bfb9c(0x1db)][_0x3bfb9c(0x21e)],_0x301789);if(_0x6072c4)return _0x516097['app'][_0x3bfb9c(0x264)](_0x25edfd,_0x25edfd['__'](_0x3bfb9c(0x22f)));if(!_0x22ad85)return _0x516097[_0x3bfb9c(0x1db)][_0x3bfb9c(0x264)](_0x25edfd,_0x25edfd['__']('private.spacePwdGtFour'));fs[_0x3bfb9c(0x219)](_0x5eb528,_0x40ea44=>{const _0x53354d=_0x3bfb9c;if(_0x40ea44)return _0x516097['app']['returnErrMsg'](_0x25edfd,_0x25edfd['__']('noWritePermission'));checkSpacePwd(_0x25edfd,_0x22ad85,_0x5eb528)[_0x53354d(0x1ec)](()=>{const _0x328b4d=_0x53354d;let _0x1f048f=config[_0x328b4d(0x208)](_0x5eb528);fs['stat'](_0x1f048f,(_0x30c6b3,_0x4387de)=>{const _0x991d4e=_0x328b4d;if(_0x30c6b3)return _0x516097['app'][_0x991d4e(0x264)](_0x25edfd,_0x25edfd['__']('private.spaceConfigFileBroken'));return dbPrivateSpaceTable[_0x991d4e(0x1e1)](_0x516097[_0x991d4e(0x1db)][_0x991d4e(0x21e)],{'folder_path':_0x5eb528,'space_name':_0x301789,'create_uid':_0x21c3ba['id']}),_0x25edfd[_0x991d4e(0x20b)]({'code':0x0});});})['catch'](_0x1110e6=>{const _0x2e31bb=_0x53354d;return _0x516097[_0x2e31bb(0x1db)][_0x2e31bb(0x264)](_0x25edfd,_0x1110e6);});});}),router[_0x141839(0x229)](_0x141839(0x22a),(_0x4aadd8,_0x51d212,_0x3a7cd5)=>{const _0x5b9dd5=_0x141839;let _0x380e1d=_0x4aadd8[_0x5b9dd5(0x274)]['folderPath'],_0x461411=_0x4aadd8[_0x5b9dd5(0x274)][_0x5b9dd5(0x24c)],_0x2f7891=_0x4aadd8[_0x5b9dd5(0x274)][_0x5b9dd5(0x263)];if(!_0x461411)return _0x4aadd8[_0x5b9dd5(0x1db)][_0x5b9dd5(0x264)](_0x51d212,_0x51d212['__'](_0x5b9dd5(0x1e6)));fs[_0x5b9dd5(0x219)](_0x380e1d,fs['constants']['R_OK'],_0x4f0f79=>{const _0x5bea54=_0x5b9dd5;if(_0x4f0f79)return _0x4aadd8[_0x5bea54(0x1db)][_0x5bea54(0x264)](_0x51d212,_0x51d212['__'](_0x5bea54(0x1b3)));fs[_0x5bea54(0x219)](_0x2f7891,fs[_0x5bea54(0x1b8)][_0x5bea54(0x217)],_0xfe4f7f=>{const _0x5b662c=_0x5bea54;if(_0xfe4f7f)return _0x4aadd8['app'][_0x5b662c(0x264)](_0x51d212,_0x51d212['__'](_0x5b662c(0x1b3)));function _0x21dc13(_0x25b5c0){const _0x3ee554=_0x5b662c;cryptoUtils[_0x3ee554(0x202)](config['privateSpaceKey'],_0x461411)['then'](_0x2748fa=>{const _0x1f1a1a=_0x3ee554;return _0x25b5c0[_0x1f1a1a(0x1db)]['dbOther']['prepare'](_0x1f1a1a(0x1d6))['run'](_0x1f1a1a(0x259),JSON[_0x1f1a1a(0x257)]({'folderPath':_0x380e1d,'targetFolderPath':_0x2f7891,'spacePwd':_0x2748fa})),process[_0x1f1a1a(0x223)]({'type':_0x1f1a1a(0x261)}),_0x51d212[_0x1f1a1a(0x20b)]({'code':0x0});});}let _0x371b18=path[_0x5b662c(0x1ea)](_0x380e1d,configFolderName,folderSignFileName);fs[_0x5b662c(0x227)](_0x371b18,(_0x3200d6,_0x294518)=>{const _0x5c10a4=_0x5b662c;_0x3200d6?_0x21dc13(_0x4aadd8):checkSpacePwd(_0x51d212,_0x461411,_0x380e1d)[_0x5c10a4(0x1ec)](()=>{_0x21dc13(_0x4aadd8);})['catch'](_0x582b70=>{const _0x375b19=_0x5c10a4;return console['log'](_0x582b70),_0x4aadd8[_0x375b19(0x1db)][_0x375b19(0x264)](_0x51d212,_0x51d212['__']('private.passwordIncorrect'));});});});});}),router[_0x141839(0x229)](_0x141839(0x25d),(_0x2dda0e,_0x4ee9ec,_0xf7624c)=>{const _0x1f2764=_0x141839;let _0x1c1458=_0x2dda0e[_0x1f2764(0x274)]['spaceId'],_0x32960b=_0x2dda0e[_0x1f2764(0x274)][_0x1f2764(0x26f)];if(!_0x32960b||_0x32960b[_0x1f2764(0x1d2)]<0x1)return _0x4ee9ec['status'](0x194)['end']();let _0xb36fb4=dbPrivateSpaceTable['getById'](_0x2dda0e[_0x1f2764(0x1db)][_0x1f2764(0x21e)],_0x1c1458);if(!_0xb36fb4)return _0x4ee9ec[_0x1f2764(0x211)](0x194)[_0x1f2764(0x1d7)]();if(_0x2dda0e['currentUser'][_0x1f2764(0x1b6)]!=0x1){if(_0xb36fb4[_0x1f2764(0x236)]!=_0x2dda0e[_0x1f2764(0x1d5)]['id'])return _0x4ee9ec[_0x1f2764(0x20b)]({'code':0x1,'message':_0x4ee9ec['__']('private.onlyAdminCanDelete')});}try{let _0x1d80de=getPrivateIndexDb(_0xb36fb4[_0x1f2764(0x1f0)]),_0x176bea=JSON[_0x1f2764(0x1da)](_0x32960b),_0x586de0=0x0,_0x17f65a=[],_0x2b6300=0x0,_0x52c3f5=0x0;if(_0x176bea[_0x1f2764(0x1d2)]<0x1)return _0x4ee9ec[_0x1f2764(0x20b)]({'code':0x0,'deleteList':_0x17f65a,'deleteCount':_0x586de0,'errCount':_0x2b6300});for(let _0x27311b=0x0;_0x27311b<_0x176bea['length'];_0x27311b++){let _0x59f0aa=dbPrivateSpaceTable[_0x1f2764(0x24b)](_0x1d80de,_0x1f2764(0x246)+_0x176bea[_0x27311b]);if(!_0x59f0aa)return _0x2dda0e['app']['returnErrMsg'](_0x4ee9ec,_0x4ee9ec['__'](_0x1f2764(0x220)));let _0x17ab3c=path['join'](_0xb36fb4[_0x1f2764(0x1f0)],_0x59f0aa[_0x1f2764(0x1b0)]);if(_0x59f0aa['tiny_path']&&_0x59f0aa[_0x1f2764(0x272)]!=_0x1f2764(0x1ff)){let _0x5b12ae=path['join'](_0xb36fb4[_0x1f2764(0x1f0)],_0x59f0aa[_0x1f2764(0x272)]);try{fs[_0x1f2764(0x1df)](_0x5b12ae,_0x4bcdc7=>{});}catch(_0x56181d){}}fs['unlink'](_0x17ab3c,_0x489f58=>{const _0x192086=_0x1f2764;_0x52c3f5+=0x1;_0x489f58?(console[_0x192086(0x206)](_0x192086(0x1c6),_0x489f58[_0x192086(0x247)]),_0x2b6300+=0x1):(_0x586de0+=0x1,_0x17f65a['push'](_0x176bea[_0x27311b]));dbPrivateSpaceTable[_0x192086(0x234)](_0x1d80de,_0x176bea[_0x27311b]);if(_0x52c3f5==_0x176bea['length'])return _0x4ee9ec[_0x192086(0x20b)]({'code':0x0,'deleteList':_0x17f65a,'deleteCount':_0x586de0,'errCount':_0x2b6300});});}}catch(_0x1a1b60){return console['log'](_0x1f2764(0x20d),_0x1a1b60),_0x4ee9ec[_0x1f2764(0x20b)]({'code':0x1,'message':JSON['stringify'](_0x1a1b60)});}}),router[_0x141839(0x229)](_0x141839(0x1ca),(_0x2c7805,_0x3ab188,_0x58f576)=>{const _0x51656b=_0x141839;if(checkSpaceId(_0x2c7805,_0x3ab188)!==!![])return;let _0x20db33=_0x2c7805[_0x51656b(0x274)][_0x51656b(0x1e4)],_0x23f9e4=dbPrivateSpaceTable[_0x51656b(0x1c8)](_0x2c7805[_0x51656b(0x1db)][_0x51656b(0x21e)],_0x20db33);if(_0x2c7805['currentUser'][_0x51656b(0x1b6)]!=0x1){if(_0x23f9e4['create_uid']!=_0x2c7805['currentUser']['id'])return _0x3ab188['json']({'code':0x1,'message':_0x3ab188['__'](_0x51656b(0x265))});}return dbPrivateSpaceTable[_0x51656b(0x269)](_0x2c7805[_0x51656b(0x1db)]['dbOther'],_0x20db33),_0x3ab188[_0x51656b(0x20b)]({'code':0x0});}),router['post'](_0x141839(0x1fd),(_0x35b31e,_0x298060,_0x518c71)=>{const _0x321ba5=_0x141839;let _0x318692=_0x35b31e[_0x321ba5(0x274)][_0x321ba5(0x243)],_0x4b72dc=_0x35b31e[_0x321ba5(0x274)][_0x321ba5(0x1e4)];if(checkSpaceId(_0x35b31e,_0x298060)!==!![])return;if(checkSpaceName(_0x35b31e,_0x298060,_0x318692)!==!![])return;let _0x57b761=dbPrivateSpaceTable[_0x321ba5(0x1c8)](_0x35b31e[_0x321ba5(0x1db)]['dbOther'],_0x4b72dc);if(_0x35b31e[_0x321ba5(0x1d5)]['is_admin']!=0x1){if(_0x57b761[_0x321ba5(0x236)]!=_0x35b31e[_0x321ba5(0x1d5)]['id'])return _0x298060['json']({'code':0x1,'message':_0x298060['__'](_0x321ba5(0x265))});}return dbPrivateSpaceTable[_0x321ba5(0x1c2)](_0x35b31e[_0x321ba5(0x1db)][_0x321ba5(0x21e)],_0x318692,_0x4b72dc),_0x298060[_0x321ba5(0x20b)]({'code':0x0});}),router[_0x141839(0x229)]('/getFileList',(_0x2ad2e1,_0x290103,_0x4042f9)=>{const _0x2ae79a=_0x141839;let _0x3ed516=_0x2ad2e1[_0x2ae79a(0x274)][_0x2ae79a(0x1e4)];if(!_0x3ed516)return _0x2ad2e1[_0x2ae79a(0x1db)][_0x2ae79a(0x264)](_0x290103,_0x2ae79a(0x239));let _0xf2e106=dbPrivateSpaceTable[_0x2ae79a(0x1c8)](_0x2ad2e1[_0x2ae79a(0x1db)][_0x2ae79a(0x21e)],_0x3ed516);if(!_0xf2e106)return _0x2ad2e1[_0x2ae79a(0x1db)]['returnErrMsg'](_0x290103,_0x2ae79a(0x258));let _0x5e5c74=config[_0x2ae79a(0x208)](_0xf2e106[_0x2ae79a(0x1f0)]);fs['stat'](_0x5e5c74,(_0x3d2578,_0x4f74f9)=>{const _0x3087b6=_0x2ae79a;if(_0x3d2578)return _0x2ad2e1[_0x3087b6(0x1db)][_0x3087b6(0x264)](_0x290103,_0x290103['__']('private.spaceConfigFileBroken'));let _0xa731d8=_0x2ad2e1[_0x3087b6(0x274)][_0x3087b6(0x23b)]||0x64,_0x264ffc=_0x2ad2e1[_0x3087b6(0x274)][_0x3087b6(0x260)]||0x0,_0x565d18=_0x2ad2e1[_0x3087b6(0x274)][_0x3087b6(0x267)]||'id',_0x4724a1=_0x2ad2e1[_0x3087b6(0x274)][_0x3087b6(0x26d)]||'desc',_0x1fde94=_0x2ad2e1[_0x3087b6(0x274)][_0x3087b6(0x1b2)],_0x1fbe50=getPrivateIndexDb(_0xf2e106[_0x3087b6(0x1f0)]),_0x3c15ff='';_0x1fde94&&_0x1fde94!=_0x3087b6(0x253)&&(_0x3c15ff+='\x20WHERE\x20file_type=\x27'+_0x1fde94+'\x27');_0x3c15ff+=_0x3087b6(0x232)+_0x565d18+'\x20'+_0x4724a1+_0x3087b6(0x212)+_0xa731d8+_0x3087b6(0x242)+_0x264ffc;let _0x6b76b=dbPrivateSpaceTable[_0x3087b6(0x24e)](_0x1fbe50,_0x3c15ff);return _0x290103[_0x3087b6(0x20b)]({'code':0x0,'data':_0x6b76b});});});function getPwdFromToken(_0x4bd738,_0x49ff4f,_0x122015){const _0x1e0db1=_0x141839;let _0x4de023=_0x4bd738[_0x1e0db1(0x1f6)][_0x1e0db1(0x26e)]||_0x4bd738[_0x1e0db1(0x274)][_0x1e0db1(0x26e)]||_0x4bd738['headers'][_0x1e0db1(0x20a)],_0x1644a8=dbPrivateSpaceTable['getTokenObjByToken'](_0x4bd738[_0x1e0db1(0x1db)][_0x1e0db1(0x21e)],_0x4de023);if(!_0x1644a8)return _0x49ff4f[_0x1e0db1(0x20b)]({'code':0x68});let _0x29e45f=_0x1644a8['pwd'];cryptoUtils['decryptString'](config[_0x1e0db1(0x1bc)],_0x29e45f)['then'](_0x613553=>{_0x122015(_0x613553);})[_0x1e0db1(0x270)](_0x3df609=>{const _0x46d8b9=_0x1e0db1;console[_0x46d8b9(0x206)](_0x3df609);});}function _0x14b5(){const _0x2c1cbf=['../../utils/transCodeUtil','concat','send','encryptFile','private.passwordIncorrect','DateTimeOriginal','stat','express','post','/exportSpace','transSpcielFormatFromBuffer','deleteSpaceToken','3923600ZpQKFx','base64','private.hasSameNameSpace','nascabconfig','check_time','\x20order\x20by\x20','setHeader','deleteIndex','replace','create_uid','size','pragma','space\x20id\x20is\x20null','toLowerCase','count','over','ffprobe','sendFile','.DS_Store','utf-8','private.uploadErrTryAgain','\x20offset\x20','spaceName','9jTaLUO','getBySpaceName','\x20id=','message','UPDATE\x20private_space_index\x20SET\x20original_time=?,duration=?,size=?,stream_info=?\x20where\x20id=?','decryptFile','nascabisthebest','getIndexByWhere','spacePwd','encryptFileFromInputPipe','getAllIndexByWhere','space_id','../../utils/videoStreamUtil','createIndex','updateIndexField','all','exifr','checkStr','580CjcoSM','stringify','space\x20id\x20is\x20invalid','EXPORT_PRIVATE_SPACE','extname','destroy','sharpDealImg','/deleteSpaceFiles','../utils/privateSpaceUtils','/exitSpaceId','offsetCount','START_WORKER_BG_TASK','run','targetFolderPath','returnErrMsg','private.onlyAdminCanDelete','getTime','orderField','12817pVkmpP','delete','UPDATE\x20private_space_index\x20SET\x20tiny_path=\x27','../../db/dbPrivateSpaceTable','1778410hTUVLf','orderType','spaceToken','ids','catch','startsWith','tiny_path','from','body','/getDecodeFile*','filename_enc','video','fileType','noWritePermission','savePath','encodeFilename','is_admin','PassThrough','constants','12qakADO','tiny','mkdir','tokenPwdEncryptKey','writeFile','getIndexById','ifExtIsSpecialFormat','exports','CreateDate','updateSpaceName','journal_mode\x20=\x20WAL','3NMgPME','filename','err','nascabconfigenc','getById','needEmptyFolderPrivateSpace','/deleteSpace','private.spaceNameCantNull','temp','uploadFile','close','/regularUpload','better-sqlite3','3804TiezSe','length','Router','getDurationFromStream','currentUser','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','end','../../libs/nasTrans','includes','parse','app','changes','dealFFmpegPath','indexOf','unlink','2673808zCTwPq','create','createToken','dbPath','spaceId','createIndexDb','private.spacePwdGtFour','streamToBuffer','tiny-','\x27\x20where\x20id=','join','../../myConfig/config','then','../utils/sharpUtils','folderPath','other','folder_path','private.configFileReadFail','ext','prepare','2142RHObET','private.fileNameTooLong','query','get','../utils/uploadUtils','26716393XgzScy','58179RjuxiX','Content-Disposition','streams','/updateSpaceName','genImageTinyFile','undefined','toString','createReadStream','encryptString','lastInsertRowid','operationFail','/checkPwd','log','private.noExist','getPrivateDbPath','destination','space_token','json','path','error','download','decryptFileGetStream','getIndexByFileName','status','\x20limit\x20','sha256','../utils/fileUtils','stream','private.spaceNameTooLong','W_OK','image','access','R_OK','getAllByUid','.mp4','genVideoTinyFile','dbOther','headers','folderNotExist'];_0x14b5=function(){return _0x2c1cbf;};return _0x14b5();}router[_0x141839(0x1f7)](_0x141839(0x275),(_0x5f43af,_0x36e4d4,_0x3887dd)=>{const _0x328452=_0x141839;try{let _0x4c59a6=_0x5f43af[_0x328452(0x1f6)]['spaceId'],_0x1e1064=_0x5f43af[_0x328452(0x1f6)]['indexId'],_0x43e12c=_0x5f43af[_0x328452(0x1f6)][_0x328452(0x20e)],_0x9e724c=_0x5f43af['query']['type'];if(!_0x4c59a6||!_0x1e1064)return _0x5f43af[_0x328452(0x1db)][_0x328452(0x264)](_0x36e4d4,'space/index\x20id\x20is\x20null');let _0x1ae6d1=dbPrivateSpaceTable['getById'](_0x5f43af['app'][_0x328452(0x21e)],_0x4c59a6);if(!_0x1ae6d1)return _0x5f43af['app'][_0x328452(0x264)](_0x36e4d4,_0x328452(0x258));getPwdFromToken(_0x5f43af,_0x36e4d4,_0x39674a=>{const _0x41c59b=_0x328452;let _0x32ff41=getPrivateIndexDb(_0x1ae6d1[_0x41c59b(0x1f0)]),_0xcd168=dbPrivateSpaceTable[_0x41c59b(0x1be)](_0x32ff41,_0x1e1064);if(!_0xcd168)return _0x36e4d4[_0x41c59b(0x211)](0x194)[_0x41c59b(0x1d7)]();let _0x57f021='';_0x9e724c==_0x41c59b(0x1ba)?_0x57f021=path[_0x41c59b(0x1ea)](_0x1ae6d1[_0x41c59b(0x1f0)],_0xcd168[_0x41c59b(0x272)]):_0x57f021=path[_0x41c59b(0x1ea)](_0x1ae6d1[_0x41c59b(0x1f0)],_0xcd168[_0x41c59b(0x1b0)]);if(_0x43e12c==0x1)try{let _0x3a91bc=Buffer[_0x41c59b(0x273)](_0xcd168[_0x41c59b(0x1c5)],_0x41c59b(0x22e))[_0x41c59b(0x200)]();const _0x492b0b=encodeURIComponent(_0x3a91bc)[_0x41c59b(0x235)](/%([0-9A-F]{2})/g,(_0x1b475b,_0x33aa8e)=>'%'+_0x33aa8e['toUpperCase']());_0x36e4d4[_0x41c59b(0x233)](_0x41c59b(0x1fb),'attachment;\x20filename*=UTF-8\x27\x27'+_0x492b0b);}catch(_0x4c1948){console[_0x41c59b(0x206)](_0x4c1948);}fs[_0x41c59b(0x227)](_0x57f021,(_0x1cfe26,_0x5e41e9)=>{const _0x418653=_0x41c59b;if(_0x1cfe26)return _0x36e4d4[_0x418653(0x211)](0x194)['end']();if(_0x57f021[_0x418653(0x1de)](_0x418653(0x1ba))==-0x1){let _0x54098c=dbPrivateSpaceTable[_0x418653(0x252)](_0x32ff41,_0x418653(0x231),new Date()['getTime'](),_0x1e1064);}if(sharpUtil[_0x418653(0x1bf)](_0xcd168[_0x418653(0x1f2)])&&_0x9e724c!='tiny'){let _0x3af44e=cryptoUtils['decryptFileGetStream'](_0x39674a,_0x57f021);fileUtil[_0x418653(0x1e7)](_0x3af44e)[_0x418653(0x1ec)](_0x25eefe=>{const _0x6b6bb=_0x418653;sharpUtil[_0x6b6bb(0x22b)](_0xcd168[_0x6b6bb(0x1f2)],_0x25eefe,(_0x41fc57,_0x254fdc,_0x80468b)=>{const _0x4ea6de=_0x6b6bb;sharpUtil[_0x4ea6de(0x1bf)](_0xcd168[_0x4ea6de(0x1f2)]['toLowerCase']())?sharpUtil[_0x4ea6de(0x25c)](_0x41fc57,null,![],null,'buffer',null,_0xa486cd=>{const _0x1ccbf8=_0x4ea6de;_0x36e4d4[_0x1ccbf8(0x223)](Buffer[_0x1ccbf8(0x273)](_0xa486cd));},_0x2b2deb=>{const _0x44b6de=_0x4ea6de;return console['log'](_0x2b2deb),_0x36e4d4[_0x44b6de(0x211)](0x194)['end']();},_0x254fdc,_0x80468b):typeof _0x41fc57=='string'?(_0x36e4d4[_0x4ea6de(0x23e)](_0x41fc57),_0x36e4d4['on'](_0x4ea6de(0x1ce),()=>{_0x254fdc&&fs['rm'](_0x41fc57,_0x190d6f=>{});})):_0x36e4d4[_0x4ea6de(0x223)](_0x41fc57);});});}else cryptoUtils[_0x418653(0x249)](_0x39674a,_0x57f021,_0x36e4d4,_0x36e4d4);return;});});}catch(_0x21b6bd){return console[_0x328452(0x206)](_0x21b6bd),_0x36e4d4['status'](0x194)['end']();}}),router['post'](_0x141839(0x25f),(_0x18f646,_0x49e660,_0x14b3bd)=>{const _0x5dee7b=_0x141839;try{return dbPrivateSpaceTable[_0x5dee7b(0x22c)](_0x18f646['app']['dbOther'],_0x18f646[_0x5dee7b(0x274)]['spaceId']),_0x49e660['status'](0xc8)[_0x5dee7b(0x1d7)]();}catch(_0x422be8){return console[_0x5dee7b(0x206)](_0x422be8),_0x49e660[_0x5dee7b(0x211)](0x194)[_0x5dee7b(0x1d7)]();}}),module[_0x141839(0x1c0)]=router;