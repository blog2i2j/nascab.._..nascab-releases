const _0x198779=_0x3cf9;function _0x591f(){const _0x549a9d=['noPermission','exports','1541127oaxFxR','headers','error\x20book\x20index\x20id','4164025mgGTrz','app','filename','5360411bSSOtP','over','existsSync','uploadSubtitle','10nvwkcB','书籍封面保存目录','decodePath','2kSEhHB','overMode','path','returnErrMsg','../utils/fileUtils','body','join','over_mode','power_add','.jpg','7284cytpax','basename','W_OK','uploadBookCover','SAMENAME','query','operationFail','encodeFilename','post','../../myConfig/config','14066heVyXV','6TWislo','targetFolderNotExist','folder','substring','67664eLgXVm','/folderExist','access','639XnaKIv','uploadFile','relativePath','constants','json','dirname','log','/regularUpload','bookIndexId','../utils/uploadUtils','express','4LQbHVv','returnFileError','savePath','594959cCkgXM','save_path','507430PsOnyq','../../db/dbFileIndexTable'];_0x591f=function(){return _0x549a9d;};return _0x591f();}(function(_0x196495,_0x1d5806){const _0x108111=_0x3cf9,_0x2597e7=_0x196495();while(!![]){try{const _0x4b17a8=parseInt(_0x108111(0xae))/0x1*(parseInt(_0x108111(0x84))/0x2)+parseInt(_0x108111(0xb4))/0x3*(parseInt(_0x108111(0xab))/0x4)+-parseInt(_0x108111(0xb7))/0x5+-parseInt(_0x108111(0x99))/0x6*(parseInt(_0x108111(0xba))/0x7)+-parseInt(_0x108111(0x9d))/0x8*(-parseInt(_0x108111(0xa0))/0x9)+-parseInt(_0x108111(0xbe))/0xa*(parseInt(_0x108111(0xb0))/0xb)+parseInt(_0x108111(0x8e))/0xc*(parseInt(_0x108111(0x98))/0xd);if(_0x4b17a8===_0x1d5806)break;else _0x2597e7['push'](_0x2597e7['shift']());}catch(_0x25f2ce){_0x2597e7['push'](_0x2597e7['shift']());}}}(_0x591f,0xb0164));let express=require(_0x198779(0xaa)),router=express['Router'](),uploadUtil=require(_0x198779(0xa9));const dbUserTable=require('../../db/dbUserTable');let fs=require('fs'),fileUtil=require(_0x198779(0x88)),path=require('path'),config=require(_0x198779(0x97));const dbFileIndexTable=require(_0x198779(0xb1));function _0x3cf9(_0x321f1e,_0x356a6c){const _0x591f6f=_0x591f();return _0x3cf9=function(_0x3cf99f,_0x47e231){_0x3cf99f=_0x3cf99f-0x83;let _0x510920=_0x591f6f[_0x3cf99f];return _0x510920;},_0x3cf9(_0x321f1e,_0x356a6c);}router[_0x198779(0x96)](_0x198779(0x9e),function(_0x40c386,_0x1a267f){const _0x30f181=_0x198779;let _0x14ac01=_0x40c386[_0x30f181(0x89)]['savePath'];fs['stat'](_0x14ac01,(_0xdc754d,_0x6127fc)=>{const _0x287a72=_0x30f181;return _0xdc754d?_0x40c386[_0x287a72(0xb8)]['returnErrMsg'](_0x1a267f,_0x1a267f['__'](_0x287a72(0x9a))):_0x1a267f[_0x287a72(0xa4)]({'code':0x0});});}),router['post'](_0x198779(0xa7),function(_0x416c6b,_0x404186){const _0x2f3e64=_0x198779;if(_0x416c6b[_0x2f3e64(0xb5)][_0x2f3e64(0xaf)]){let _0x271127=decodeURIComponent(_0x416c6b[_0x2f3e64(0xb5)][_0x2f3e64(0xaf)]);_0x416c6b[_0x2f3e64(0x89)]['savePath']=_0x271127,_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xad)]=_0x271127;}_0x416c6b[_0x2f3e64(0xb5)][_0x2f3e64(0x8b)]&&(_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0x85)]=_0x416c6b[_0x2f3e64(0xb5)][_0x2f3e64(0x8b)]);let _0x4fd889,_0x321865,_0xa6b6a1=!![];try{_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xad)]&&(_0x4fd889=fileUtil['decodePath'](_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xad)]));if(_0x416c6b['query'][_0x2f3e64(0x91)]==0x1){let _0x50587b=_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xa8)];if(!_0x50587b)return _0x416c6b[_0x2f3e64(0xb8)][_0x2f3e64(0x87)](_0x404186,'need\x20book\x20index\x20id');let _0x1d6f88=dbFileIndexTable['getById'](_0x416c6b[_0x2f3e64(0xb8)]['dbFileIndex'],_0x50587b,dbFileIndexTable['INDEX_TABLE_NAME_BOOK']);if(!_0x1d6f88)return _0x416c6b[_0x2f3e64(0xb8)][_0x2f3e64(0x87)](_0x404186,_0x2f3e64(0xb6));_0x4fd889=_0x1d6f88[_0x2f3e64(0x86)],_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xad)]=_0x1d6f88['path'],_0x416c6b[_0x2f3e64(0x93)]['overMode']=_0x2f3e64(0xbb),_0xa6b6a1=![];let _0x313422=path[_0x2f3e64(0x8a)](_0x1d6f88[_0x2f3e64(0x86)],_0x1d6f88[_0x2f3e64(0xb9)]),_0x451411=_0x313422[_0x2f3e64(0x9c)](0x0,_0x313422['lastIndexOf']('.'))+_0x2f3e64(0x8d),_0x11230f=path[_0x2f3e64(0x8f)](_0x451411);_0x416c6b[_0x2f3e64(0x93)]['filename']=encodeURIComponent(_0x11230f),console[_0x2f3e64(0xa6)](_0x2f3e64(0xbf),_0x4fd889,_0x416c6b['query'][_0x2f3e64(0xb9)]);}if(_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xa2)]){_0x321865=fileUtil[_0x2f3e64(0x83)](_0x416c6b['query'][_0x2f3e64(0xa2)]);let _0x28e577=path[_0x2f3e64(0xa5)](path[_0x2f3e64(0x8a)](_0x4fd889,_0x321865));!fs[_0x2f3e64(0xbc)](_0x28e577)&&fs['mkdirSync'](_0x28e577,{'recursive':!![]}),_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xad)]=_0x28e577,_0xa6b6a1=![];}if(_0x416c6b[_0x2f3e64(0x93)]['encodeFilename']){_0x416c6b['query']['filename']=fileUtil['decodePath'](_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0x95)]);let _0x246835=path[_0x2f3e64(0x8a)](_0x4fd889,_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xb9)]);if(_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0x85)]&&_0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0x85)]=='skip'&&fs[_0x2f3e64(0xbc)](_0x246835))return _0x404186['json']({'code':0x1,'remark':_0x2f3e64(0x92),'message':_0x404186['__']('sameNameFileAlreadExist')});}}catch(_0x157155){return console[_0x2f3e64(0xa6)](_0x157155),_0x416c6b[_0x2f3e64(0xb8)][_0x2f3e64(0x87)](_0x404186,_0x404186['__'](_0x2f3e64(0x94)));}if(_0x4fd889&&_0x4fd889!='nascab_torrentSavePath')fs[_0x2f3e64(0x9f)](_0x4fd889,fs[_0x2f3e64(0xa3)][_0x2f3e64(0x90)]|fs['constants']['R_OK'],_0x5dd680=>{const _0x347040=_0x2f3e64;if(_0x5dd680)return fileUtil[_0x347040(0xac)](_0x404186,_0x5dd680);if(dbUserTable['doUserCanGet'](_0x416c6b,_0x404186,_0x347040(0x9b),_0x347040(0x8c),_0x4fd889,!![])==!![])uploadUtil['uploadFile'](_0x416c6b,_0x404186,_0xa6b6a1);else return _0x416c6b[_0x347040(0xb8)][_0x347040(0x87)](_0x404186,_0x404186['__'](_0x347040(0xb2)));});else _0x416c6b[_0x2f3e64(0x93)][_0x2f3e64(0xbd)]==0x1?uploadUtil['uploadFile'](_0x416c6b,_0x404186,_0xa6b6a1):uploadUtil[_0x2f3e64(0xa1)](_0x416c6b,_0x404186,_0xa6b6a1);}),module[_0x198779(0xb3)]=router;