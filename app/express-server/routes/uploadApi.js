const _0x42e4fd=_0xcf24;(function(_0x388c86,_0x1e8579){const _0x2817bf=_0xcf24,_0x3d4d3a=_0x388c86();while(!![]){try{const _0x54eaa3=parseInt(_0x2817bf(0x8a))/0x1*(parseInt(_0x2817bf(0x8f))/0x2)+parseInt(_0x2817bf(0x97))/0x3+parseInt(_0x2817bf(0x82))/0x4*(parseInt(_0x2817bf(0x70))/0x5)+-parseInt(_0x2817bf(0x6e))/0x6*(-parseInt(_0x2817bf(0xa5))/0x7)+-parseInt(_0x2817bf(0x8c))/0x8+-parseInt(_0x2817bf(0x75))/0x9+-parseInt(_0x2817bf(0x77))/0xa*(parseInt(_0x2817bf(0x72))/0xb);if(_0x54eaa3===_0x1e8579)break;else _0x3d4d3a['push'](_0x3d4d3a['shift']());}catch(_0x3cb4d8){_0x3d4d3a['push'](_0x3d4d3a['shift']());}}}(_0x4a2d,0x85a80));let express=require(_0x42e4fd(0x95)),router=express[_0x42e4fd(0x7d)](),uploadUtil=require(_0x42e4fd(0x9a));const dbUserTable=require(_0x42e4fd(0x78));let fs=require('fs'),fileUtil=require(_0x42e4fd(0x7e)),path=require(_0x42e4fd(0x96)),config=require(_0x42e4fd(0x92));function _0x4a2d(){const _0x226057=['../utils/fileUtils','existsSync','savePath','targetFolderNotExist','1060964RYKqXl','body','over','access','returnErrMsg','INDEX_TABLE_NAME_BOOK','getById','skip','301979zksDOw','app','771544HmqmgI','basename','over_mode','2QLNbvu','bookIndexId','error\x20book\x20index\x20id','../../myConfig/config','decodePath','filename','express','path','1587099lvfOIq','doUserCanGet','uploadFile','../utils/uploadUtils','json','noPermission','SAMENAME','returnFileError','constants','power_add','log','stat','nascab_torrentSavePath','dbFileIndex','7rHvlxK','.jpg','headers','uploadBookCover','5346798oyJKFQ','overMode','15AxrIkH','query','12001oXQEnW','save_path','/folderExist','4267944jfOwEZ','/regularUpload','12830gGEijH','../../db/dbUserTable','exports','relativePath','dirname','post','Router'];_0x4a2d=function(){return _0x226057;};return _0x4a2d();}const dbFileIndexTable=require('../../db/dbFileIndexTable');function _0xcf24(_0x55a4c6,_0x3078c5){const _0x4a2d34=_0x4a2d();return _0xcf24=function(_0xcf2404,_0x5f04f7){_0xcf2404=_0xcf2404-0x6d;let _0x38e515=_0x4a2d34[_0xcf2404];return _0x38e515;},_0xcf24(_0x55a4c6,_0x3078c5);}router[_0x42e4fd(0x7c)](_0x42e4fd(0x74),function(_0x28acc5,_0x39ec13){const _0x57cf4c=_0x42e4fd;let _0x1b6df2=_0x28acc5[_0x57cf4c(0x83)][_0x57cf4c(0x80)];fs[_0x57cf4c(0xa2)](_0x1b6df2,(_0xd04461,_0x4a7618)=>{const _0x1d5444=_0x57cf4c;return _0xd04461?_0x28acc5[_0x1d5444(0x8b)]['returnErrMsg'](_0x39ec13,_0x39ec13['__'](_0x1d5444(0x81))):_0x39ec13[_0x1d5444(0x9b)]({'code':0x0});});}),router[_0x42e4fd(0x7c)](_0x42e4fd(0x76),function(_0x9fe0d5,_0x3ea988){const _0x152d6e=_0x42e4fd;if(_0x9fe0d5['headers'][_0x152d6e(0x73)]){let _0x8cf00=decodeURIComponent(_0x9fe0d5[_0x152d6e(0xa7)][_0x152d6e(0x73)]);_0x9fe0d5['body'][_0x152d6e(0x80)]=_0x8cf00,_0x9fe0d5[_0x152d6e(0x71)]['savePath']=_0x8cf00;}_0x9fe0d5[_0x152d6e(0xa7)][_0x152d6e(0x8e)]&&(_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x6f)]=_0x9fe0d5[_0x152d6e(0xa7)]['over_mode']);let _0x1aa1ad,_0xb339d1,_0x1fd7e0=!![];try{_0x9fe0d5['query'][_0x152d6e(0x80)]&&(_0x1aa1ad=fileUtil[_0x152d6e(0x93)](_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x80)]));if(_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x6d)]==0x1){let _0x336643=_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x90)];if(!_0x336643)return _0x9fe0d5[_0x152d6e(0x8b)][_0x152d6e(0x86)](_0x3ea988,'need\x20book\x20index\x20id');let _0x3ca4c2=dbFileIndexTable[_0x152d6e(0x88)](_0x9fe0d5[_0x152d6e(0x8b)][_0x152d6e(0xa4)],_0x336643,dbFileIndexTable[_0x152d6e(0x87)]);if(!_0x3ca4c2)return _0x9fe0d5['app'][_0x152d6e(0x86)](_0x3ea988,_0x152d6e(0x91));_0x1aa1ad=_0x3ca4c2['path'],_0x9fe0d5['query'][_0x152d6e(0x80)]=_0x3ca4c2[_0x152d6e(0x96)],_0x9fe0d5['query']['overMode']=_0x152d6e(0x84),_0x1fd7e0=![];let _0x1b4f2e=path['join'](_0x3ca4c2[_0x152d6e(0x96)],_0x3ca4c2[_0x152d6e(0x94)]),_0x5f0879=_0x1b4f2e['substring'](0x0,_0x1b4f2e['lastIndexOf']('.'))+_0x152d6e(0xa6),_0x36ed9a=path[_0x152d6e(0x8d)](_0x5f0879);_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x94)]=encodeURIComponent(_0x36ed9a),console[_0x152d6e(0xa1)]('书籍封面保存目录',_0x1aa1ad,_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x94)]);}if(_0x9fe0d5[_0x152d6e(0x71)]['relativePath']){_0xb339d1=fileUtil[_0x152d6e(0x93)](_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x7a)]);let _0x57252b=path[_0x152d6e(0x7b)](path['join'](_0x1aa1ad,_0xb339d1));!fs[_0x152d6e(0x7f)](_0x57252b)&&fs['mkdirSync'](_0x57252b,{'recursive':!![]}),_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x80)]=_0x57252b,_0x1fd7e0=![];}if(_0x9fe0d5['query']['encodeFilename']){_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x94)]=fileUtil['decodePath'](_0x9fe0d5['query']['encodeFilename']);let _0x127274=path['join'](_0x1aa1ad,_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x94)]);if(_0x9fe0d5['query'][_0x152d6e(0x6f)]&&_0x9fe0d5[_0x152d6e(0x71)][_0x152d6e(0x6f)]==_0x152d6e(0x89)&&fs['existsSync'](_0x127274))return _0x3ea988[_0x152d6e(0x9b)]({'code':0x1,'remark':_0x152d6e(0x9d),'message':_0x3ea988['__']('sameNameFileAlreadExist')});}}catch(_0x2bc422){return console[_0x152d6e(0xa1)](_0x2bc422),_0x9fe0d5[_0x152d6e(0x8b)][_0x152d6e(0x86)](_0x3ea988,_0x3ea988['__']('operationFail'));}if(_0x1aa1ad&&_0x1aa1ad!=_0x152d6e(0xa3))fs[_0x152d6e(0x85)](_0x1aa1ad,fs[_0x152d6e(0x9f)]['W_OK']|fs['constants']['R_OK'],_0x15e588=>{const _0x5d408c=_0x152d6e;if(_0x15e588)return fileUtil[_0x5d408c(0x9e)](_0x3ea988,_0x15e588);if(dbUserTable[_0x5d408c(0x98)](_0x9fe0d5,_0x3ea988,'folder',_0x5d408c(0xa0),_0x1aa1ad,!![])==!![])uploadUtil[_0x5d408c(0x99)](_0x9fe0d5,_0x3ea988,_0x1fd7e0);else return _0x9fe0d5[_0x5d408c(0x8b)][_0x5d408c(0x86)](_0x3ea988,_0x3ea988['__'](_0x5d408c(0x9c)));});else _0x9fe0d5[_0x152d6e(0x71)]['uploadSubtitle']==0x1?uploadUtil[_0x152d6e(0x99)](_0x9fe0d5,_0x3ea988,_0x1fd7e0):uploadUtil[_0x152d6e(0x99)](_0x9fe0d5,_0x3ea988,_0x1fd7e0);}),module[_0x42e4fd(0x79)]=router;