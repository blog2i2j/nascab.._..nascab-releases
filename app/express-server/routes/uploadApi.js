const _0x2d8551=_0x5003;function _0x31f7(){const _0x4cb7f9=['nascab_torrentSavePath','128WjQrtD','uploadBookCover','encodeFilename','76MpmxFd','headers','lastIndexOf','path','.jpg','../../db/dbUserTable','179430MDYwPI','W_OK','noPermission','sameNameFileAlreadExist','../../myConfig/config','uploadFile','save_path','/regularUpload','power_add','overMode','dirname','over_mode','R_OK','mkdirSync','书籍封面保存目录','app','targetFolderNotExist','exports','query','stat','1367cCmQqz','getById','SAMENAME','162vPHvoN','returnErrMsg','access','filename','constants','decodePath','doUserCanGet','45871QkTEKA','post','error\x20book\x20index\x20id','operationFail','express','Router','join','1261107tISuwi','savePath','basename','3099EAoICu','979040MVFsLi','over','log','skip','relativePath','json','../../db/dbFileIndexTable','existsSync','../utils/fileUtils','729984XAGaar'];_0x31f7=function(){return _0x4cb7f9;};return _0x31f7();}(function(_0xd9cdc9,_0x3e60b1){const _0x23a0b9=_0x5003,_0x33ab6e=_0xd9cdc9();while(!![]){try{const _0x4467b0=parseInt(_0x23a0b9(0x213))/0x1*(-parseInt(_0x23a0b9(0x216))/0x2)+parseInt(_0x23a0b9(0x227))/0x3*(-parseInt(_0x23a0b9(0x1f9))/0x4)+parseInt(_0x23a0b9(0x228))/0x5+parseInt(_0x23a0b9(0x1f4))/0x6+parseInt(_0x23a0b9(0x21d))/0x7*(parseInt(_0x23a0b9(0x1f6))/0x8)+-parseInt(_0x23a0b9(0x224))/0x9+-parseInt(_0x23a0b9(0x1ff))/0xa;if(_0x4467b0===_0x3e60b1)break;else _0x33ab6e['push'](_0x33ab6e['shift']());}catch(_0x59d667){_0x33ab6e['push'](_0x33ab6e['shift']());}}}(_0x31f7,0x20b0c));function _0x5003(_0x16e2bd,_0x5a1d15){const _0x31f709=_0x31f7();return _0x5003=function(_0x500318,_0x73baf3){_0x500318=_0x500318-0x1ee;let _0x59d080=_0x31f709[_0x500318];return _0x59d080;},_0x5003(_0x16e2bd,_0x5a1d15);}let express=require(_0x2d8551(0x221)),router=express[_0x2d8551(0x222)](),uploadUtil=require('../utils/uploadUtils');const dbUserTable=require(_0x2d8551(0x1fe));let fs=require('fs'),fileUtil=require(_0x2d8551(0x1f3)),path=require('path'),config=require(_0x2d8551(0x203));const dbFileIndexTable=require(_0x2d8551(0x1f1));router[_0x2d8551(0x21e)]('/folderExist',function(_0x96f0c3,_0x2a9b20){const _0x52fd38=_0x2d8551;let _0x57942c=_0x96f0c3['body'][_0x52fd38(0x225)];fs[_0x52fd38(0x212)](_0x57942c,(_0x222413,_0x3be079)=>{const _0x421839=_0x52fd38;return _0x222413?_0x96f0c3[_0x421839(0x20e)][_0x421839(0x217)](_0x2a9b20,_0x2a9b20['__'](_0x421839(0x20f))):_0x2a9b20[_0x421839(0x1f0)]({'code':0x0});});}),router['post'](_0x2d8551(0x206),function(_0x447349,_0xad677a){const _0x2675ca=_0x2d8551;if(_0x447349[_0x2675ca(0x1fa)]['save_path']){let _0x3129e2=decodeURIComponent(_0x447349[_0x2675ca(0x1fa)][_0x2675ca(0x205)]);_0x447349['body'][_0x2675ca(0x225)]=_0x3129e2,_0x447349[_0x2675ca(0x211)]['savePath']=_0x3129e2;}_0x447349[_0x2675ca(0x1fa)][_0x2675ca(0x20a)]&&(_0x447349['query'][_0x2675ca(0x208)]=_0x447349[_0x2675ca(0x1fa)]['over_mode']);let _0x48863d,_0x55db90,_0x2a3e26=!![];try{_0x447349[_0x2675ca(0x211)]['savePath']&&(_0x48863d=fileUtil['decodePath'](_0x447349[_0x2675ca(0x211)][_0x2675ca(0x225)]));if(_0x447349[_0x2675ca(0x211)][_0x2675ca(0x1f7)]==0x1){let _0x265c00=_0x447349[_0x2675ca(0x211)]['bookIndexId'];if(!_0x265c00)return _0x447349[_0x2675ca(0x20e)]['returnErrMsg'](_0xad677a,'need\x20book\x20index\x20id');let _0x68942a=dbFileIndexTable[_0x2675ca(0x214)](_0x447349[_0x2675ca(0x20e)]['dbFileIndex'],_0x265c00,dbFileIndexTable['INDEX_TABLE_NAME_BOOK']);if(!_0x68942a)return _0x447349[_0x2675ca(0x20e)][_0x2675ca(0x217)](_0xad677a,_0x2675ca(0x21f));_0x48863d=_0x68942a[_0x2675ca(0x1fc)],_0x447349[_0x2675ca(0x211)][_0x2675ca(0x225)]=_0x68942a[_0x2675ca(0x1fc)],_0x447349[_0x2675ca(0x211)][_0x2675ca(0x208)]=_0x2675ca(0x229),_0x2a3e26=![];let _0x2e5a7e=path[_0x2675ca(0x223)](_0x68942a[_0x2675ca(0x1fc)],_0x68942a[_0x2675ca(0x219)]),_0x19d4ad=_0x2e5a7e['substring'](0x0,_0x2e5a7e[_0x2675ca(0x1fb)]('.'))+_0x2675ca(0x1fd),_0x56c054=path[_0x2675ca(0x226)](_0x19d4ad);_0x447349[_0x2675ca(0x211)][_0x2675ca(0x219)]=encodeURIComponent(_0x56c054),console[_0x2675ca(0x22a)](_0x2675ca(0x20d),_0x48863d,_0x447349['query'][_0x2675ca(0x219)]);}if(_0x447349[_0x2675ca(0x211)][_0x2675ca(0x1ef)]){_0x55db90=fileUtil[_0x2675ca(0x21b)](_0x447349[_0x2675ca(0x211)][_0x2675ca(0x1ef)]);let _0x15f235=path[_0x2675ca(0x209)](path['join'](_0x48863d,_0x55db90));!fs[_0x2675ca(0x1f2)](_0x15f235)&&fs[_0x2675ca(0x20c)](_0x15f235,{'recursive':!![]}),_0x447349[_0x2675ca(0x211)]['savePath']=_0x15f235,_0x2a3e26=![];}if(_0x447349[_0x2675ca(0x211)][_0x2675ca(0x1f8)]){_0x447349[_0x2675ca(0x211)][_0x2675ca(0x219)]=fileUtil[_0x2675ca(0x21b)](_0x447349['query'][_0x2675ca(0x1f8)]);let _0x27c40c=path[_0x2675ca(0x223)](_0x48863d,_0x447349[_0x2675ca(0x211)]['filename']);if(_0x447349[_0x2675ca(0x211)][_0x2675ca(0x208)]&&_0x447349[_0x2675ca(0x211)][_0x2675ca(0x208)]==_0x2675ca(0x1ee)&&fs['existsSync'](_0x27c40c))return _0xad677a[_0x2675ca(0x1f0)]({'code':0x1,'remark':_0x2675ca(0x215),'message':_0xad677a['__'](_0x2675ca(0x202))});}}catch(_0x22737a){return console[_0x2675ca(0x22a)](_0x22737a),_0x447349[_0x2675ca(0x20e)][_0x2675ca(0x217)](_0xad677a,_0xad677a['__'](_0x2675ca(0x220)));}if(_0x48863d&&_0x48863d!=_0x2675ca(0x1f5))fs[_0x2675ca(0x218)](_0x48863d,fs['constants'][_0x2675ca(0x200)]|fs[_0x2675ca(0x21a)][_0x2675ca(0x20b)],_0x1eb291=>{const _0x275298=_0x2675ca;if(_0x1eb291)return fileUtil['returnFileError'](_0xad677a,_0x1eb291);if(dbUserTable[_0x275298(0x21c)](_0x447349,_0xad677a,'folder',_0x275298(0x207),_0x48863d,!![])==!![])uploadUtil[_0x275298(0x204)](_0x447349,_0xad677a,_0x2a3e26);else return _0x447349[_0x275298(0x20e)][_0x275298(0x217)](_0xad677a,_0xad677a['__'](_0x275298(0x201)));});else _0x447349['query']['uploadSubtitle']==0x1?uploadUtil[_0x2675ca(0x204)](_0x447349,_0xad677a,_0x2a3e26):uploadUtil[_0x2675ca(0x204)](_0x447349,_0xad677a,_0x2a3e26);}),module[_0x2d8551(0x210)]=router;