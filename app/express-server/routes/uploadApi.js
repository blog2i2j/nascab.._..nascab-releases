const _0x5a1d43=_0x1596;(function(_0x52edec,_0x11d57c){const _0x5352b6=_0x1596,_0x1483f4=_0x52edec();while(!![]){try{const _0x1e29d1=-parseInt(_0x5352b6(0xc0))/0x1*(-parseInt(_0x5352b6(0x9c))/0x2)+parseInt(_0x5352b6(0x9e))/0x3*(-parseInt(_0x5352b6(0x89))/0x4)+-parseInt(_0x5352b6(0xc1))/0x5+parseInt(_0x5352b6(0x93))/0x6*(-parseInt(_0x5352b6(0xbc))/0x7)+parseInt(_0x5352b6(0xa9))/0x8+-parseInt(_0x5352b6(0xb0))/0x9+parseInt(_0x5352b6(0x9d))/0xa*(parseInt(_0x5352b6(0xac))/0xb);if(_0x1e29d1===_0x11d57c)break;else _0x1483f4['push'](_0x1483f4['shift']());}catch(_0x4eea4a){_0x1483f4['push'](_0x1483f4['shift']());}}}(_0x52cf,0x352f4));function _0x52cf(){const _0x4619dd=['folder','app','targetFolderNotExist','INDEX_TABLE_NAME_BOOK','876722FBdCQS','error\x20book\x20index\x20id','getById','constants','4iGQAQK','225240CrbgKj','Router','.jpg','uploadSubtitle','R_OK','post','1562244YoAcke','../../myConfig/config','join','query','/folderExist','uploadFile','../utils/fileUtils','overMode','decodePath','dirname','18Slkkci','书籍封面保存目录','over_mode','headers','bookIndexId','stat','save_path','mkdirSync','returnErrMsg','181094MXuKsO','220DGxEZx','3mUDScV','operationFail','encodeFilename','substring','skip','body','basename','filename','../utils/uploadUtils','uploadBookCover','noPermission','361072HLJRhw','../../db/dbUserTable','json','397628lkDgLj','dbFileIndex','path','SAMENAME','1560483DrBPkn','../../db/dbFileIndexTable','power_add','/regularUpload','relativePath','access','savePath','log'];_0x52cf=function(){return _0x4619dd;};return _0x52cf();}let express=require('express'),router=express[_0x5a1d43(0xc2)](),uploadUtil=require(_0x5a1d43(0xa6));const dbUserTable=require(_0x5a1d43(0xaa));function _0x1596(_0x838bec,_0x4dacc6){const _0x52cf43=_0x52cf();return _0x1596=function(_0x1596a4,_0x2c7ed6){_0x1596a4=_0x1596a4-0x85;let _0x39aef3=_0x52cf43[_0x1596a4];return _0x39aef3;},_0x1596(_0x838bec,_0x4dacc6);}let fs=require('fs'),fileUtil=require(_0x5a1d43(0x8f)),path=require(_0x5a1d43(0xae)),config=require(_0x5a1d43(0x8a));const dbFileIndexTable=require(_0x5a1d43(0xb1));router['post'](_0x5a1d43(0x8d),function(_0x1790db,_0x17244b){const _0x1840e7=_0x5a1d43;let _0x172664=_0x1790db[_0x1840e7(0xa3)][_0x1840e7(0xb6)];fs[_0x1840e7(0x98)](_0x172664,(_0xf2866c,_0x11bddb)=>{const _0x14cb3f=_0x1840e7;return _0xf2866c?_0x1790db[_0x14cb3f(0xb9)][_0x14cb3f(0x9b)](_0x17244b,_0x17244b['__'](_0x14cb3f(0xba))):_0x17244b[_0x14cb3f(0xab)]({'code':0x0});});}),router[_0x5a1d43(0x88)](_0x5a1d43(0xb3),function(_0x475d09,_0x7b7a3a){const _0x6a2002=_0x5a1d43;if(_0x475d09[_0x6a2002(0x96)]['save_path']){let _0x485ce7=decodeURIComponent(_0x475d09[_0x6a2002(0x96)][_0x6a2002(0x99)]);_0x475d09[_0x6a2002(0xa3)][_0x6a2002(0xb6)]=_0x485ce7,_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xb6)]=_0x485ce7;}_0x475d09[_0x6a2002(0x96)][_0x6a2002(0x95)]&&(_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0x90)]=_0x475d09[_0x6a2002(0x96)][_0x6a2002(0x95)]);let _0x1dc3ca,_0x3f229a,_0x4b56ae=!![];try{_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xb6)]&&(_0x1dc3ca=fileUtil[_0x6a2002(0x91)](_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xb6)]));if(_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xa7)]==0x1){let _0x299e15=_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0x97)];if(!_0x299e15)return _0x475d09['app'][_0x6a2002(0x9b)](_0x7b7a3a,'need\x20book\x20index\x20id');let _0x52fca5=dbFileIndexTable[_0x6a2002(0xbe)](_0x475d09[_0x6a2002(0xb9)][_0x6a2002(0xad)],_0x299e15,dbFileIndexTable[_0x6a2002(0xbb)]);if(!_0x52fca5)return _0x475d09[_0x6a2002(0xb9)]['returnErrMsg'](_0x7b7a3a,_0x6a2002(0xbd));_0x1dc3ca=_0x52fca5[_0x6a2002(0xae)],_0x475d09['query'][_0x6a2002(0xb6)]=_0x52fca5['path'],_0x475d09[_0x6a2002(0x8c)]['overMode']='over',_0x4b56ae=![];let _0x242430=path[_0x6a2002(0x8b)](_0x52fca5[_0x6a2002(0xae)],_0x52fca5[_0x6a2002(0xa5)]),_0x553443=_0x242430[_0x6a2002(0xa1)](0x0,_0x242430['lastIndexOf']('.'))+_0x6a2002(0x85),_0x17ded5=path[_0x6a2002(0xa4)](_0x553443);_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xa5)]=encodeURIComponent(_0x17ded5),console[_0x6a2002(0xb7)](_0x6a2002(0x94),_0x1dc3ca,_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xa5)]);}if(_0x475d09['query'][_0x6a2002(0xb4)]){_0x3f229a=fileUtil[_0x6a2002(0x91)](_0x475d09['query'][_0x6a2002(0xb4)]);let _0x3e798c=path[_0x6a2002(0x92)](path[_0x6a2002(0x8b)](_0x1dc3ca,_0x3f229a));!fs['existsSync'](_0x3e798c)&&fs[_0x6a2002(0x9a)](_0x3e798c,{'recursive':!![]}),_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xb6)]=_0x3e798c,_0x4b56ae=![];}if(_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xa0)]){_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xa5)]=fileUtil[_0x6a2002(0x91)](_0x475d09[_0x6a2002(0x8c)][_0x6a2002(0xa0)]);let _0x5c42c5=path['join'](_0x1dc3ca,_0x475d09['query'][_0x6a2002(0xa5)]);if(_0x475d09[_0x6a2002(0x8c)]['overMode']&&_0x475d09[_0x6a2002(0x8c)]['overMode']==_0x6a2002(0xa2)&&fs['existsSync'](_0x5c42c5))return _0x7b7a3a[_0x6a2002(0xab)]({'code':0x1,'remark':_0x6a2002(0xaf),'message':_0x7b7a3a['__']('sameNameFileAlreadExist')});}}catch(_0x7d732b){return console[_0x6a2002(0xb7)](_0x7d732b),_0x475d09[_0x6a2002(0xb9)][_0x6a2002(0x9b)](_0x7b7a3a,_0x7b7a3a['__'](_0x6a2002(0x9f)));}if(_0x1dc3ca&&_0x1dc3ca!='nascab_torrentSavePath')fs[_0x6a2002(0xb5)](_0x1dc3ca,fs[_0x6a2002(0xbf)]['W_OK']|fs[_0x6a2002(0xbf)][_0x6a2002(0x87)],_0x4c87dd=>{const _0x44bd72=_0x6a2002;if(_0x4c87dd)return fileUtil['returnFileError'](_0x7b7a3a,_0x4c87dd);if(dbUserTable['doUserCanGet'](_0x475d09,_0x7b7a3a,_0x44bd72(0xb8),_0x44bd72(0xb2),_0x1dc3ca,!![])==!![])uploadUtil[_0x44bd72(0x8e)](_0x475d09,_0x7b7a3a,_0x4b56ae);else return _0x475d09[_0x44bd72(0xb9)][_0x44bd72(0x9b)](_0x7b7a3a,_0x7b7a3a['__'](_0x44bd72(0xa8)));});else _0x475d09[_0x6a2002(0x8c)][_0x6a2002(0x86)]==0x1?uploadUtil[_0x6a2002(0x8e)](_0x475d09,_0x7b7a3a,_0x4b56ae):uploadUtil['uploadFile'](_0x475d09,_0x7b7a3a,_0x4b56ae);}),module['exports']=router;