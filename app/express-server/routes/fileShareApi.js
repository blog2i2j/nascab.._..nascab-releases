const _0x38b1a2=_0x5651;(function(_0x460b5f,_0x5be51d){const _0xc2d0a6=_0x5651,_0x145838=_0x460b5f();while(!![]){try{const _0xa7e3f8=-parseInt(_0xc2d0a6(0xdb))/0x1+parseInt(_0xc2d0a6(0xd6))/0x2+parseInt(_0xc2d0a6(0xcc))/0x3+parseInt(_0xc2d0a6(0xcd))/0x4*(parseInt(_0xc2d0a6(0x104))/0x5)+parseInt(_0xc2d0a6(0x100))/0x6+parseInt(_0xc2d0a6(0xec))/0x7*(parseInt(_0xc2d0a6(0xe6))/0x8)+-parseInt(_0xc2d0a6(0xfa))/0x9;if(_0xa7e3f8===_0x5be51d)break;else _0x145838['push'](_0x145838['shift']());}catch(_0x2f43ab){_0x145838['push'](_0x145838['shift']());}}}(_0x4ba5,0x7c914));function _0x4ba5(){const _0x5d8fca=['/getAll','ftp://','webDavServer','/create','users','getById','88wKsYCf','currentUser','value','\x20id\x20in\x20','ftpHttp','http://','432649EyZtMt','webDavHttpsServer','is_admin','webdavHttps','dbOther','server_type','isDirectory','serverType','/delete','app','pathSign','globalIpList','findByTitle','FTP','18937746pPdSbP','\x20username,id','json','noWritePermission','parse','../../db/dbConfigTable','1087896ZJiynb','body','\x20path\x20is\x20not\x20directory','webdavHttp','1217355yZnmrp','fileShareRestart','R_OK','Router','length','../../db/dbFileShare','getAllByWhere','username','FTPServer','lastInsertRowid','returnErrMsg','getByWhere','createShareUser','post','port','server_type=?\x20order\x20by\x20id\x20desc','pathSignNoNull','user_id','update','\x20path=?\x20and\x20server_type=?','stat','1918380bdrpWc','12srKHhw','access','create','log','exports','\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27','path','delete','send','1159942qflVdY','WebDav','share.samePathExist','/getById','userHasFtp','196615aMFrqI','ipv4','type','getSharesUserByShareId','Invalid\x20path'];_0x4ba5=function(){return _0x5d8fca;};return _0x4ba5();}function _0x5651(_0x4a7062,_0x467c8c){const _0x4ba5f8=_0x4ba5();return _0x5651=function(_0x5651f7,_0xbfbf75){_0x5651f7=_0x5651f7-0xcc;let _0x236c29=_0x4ba5f8[_0x5651f7];return _0x236c29;},_0x5651(_0x4a7062,_0x467c8c);}var express=require('express'),router=express[_0x38b1a2(0x107)]();let path=require('path'),fs=require('fs');const dbFileShare=require(_0x38b1a2(0x109)),dbUserTable=require('../../db/dbUserTable');let dbConfigTable=require(_0x38b1a2(0xff));router[_0x38b1a2(0x111)](_0x38b1a2(0xe3),(_0x1e2991,_0x1785a5,_0x5955a3)=>{const _0x5cd7e4=_0x38b1a2;if(_0x1e2991[_0x5cd7e4(0xe7)][_0x5cd7e4(0xee)]!=0x1)return _0x1785a5['json']({'code':0x66});let _0x1bae20=_0x1e2991[_0x5cd7e4(0x101)]['type'],_0x5e485c=_0x1e2991['body']['users'],_0x55974c=_0x1e2991['body'][_0x5cd7e4(0xd3)],_0x58f841=_0x1e2991[_0x5cd7e4(0x101)][_0x5cd7e4(0xf3)];fs[_0x5cd7e4(0xce)](_0x55974c,fs['constants']['W_OK']|fs['constants'][_0x5cd7e4(0x106)],_0x1f63da=>{const _0x44d693=_0x5cd7e4;if(_0x1f63da)return _0x1e2991[_0x44d693(0xf5)][_0x44d693(0x10e)](_0x1785a5,_0x1785a5['__'](_0x44d693(0xfd))+':'+_0x55974c);let _0x227b6e=_0x1e2991[_0x44d693(0x101)][_0x44d693(0xf6)];if(_0x58f841==_0x44d693(0xd7)){if(!_0x227b6e)return _0x1e2991[_0x44d693(0xf5)][_0x44d693(0x10e)](_0x1785a5,_0x1785a5['__'](_0x44d693(0x114)));else{let _0x58bb1f=[_0x227b6e],_0x24b754=_0x44d693(0xd2),_0x2d2af5=dbFileShare['getByWhere'](_0x1e2991[_0x44d693(0xf5)][_0x44d693(0xf0)],_0x24b754,_0x58bb1f);if(_0x2d2af5){if(_0x1bae20=='create'||_0x1bae20==_0x44d693(0x116)&&_0x2d2af5['id']!=_0x1e2991[_0x44d693(0x101)]['id'])return _0x1e2991[_0x44d693(0xf5)][_0x44d693(0x10e)](_0x1785a5,_0x1785a5['__']('share.samePathSign')+':'+_0x227b6e);}}}fs[_0x44d693(0x118)](_0x55974c,(_0x2bb4cb,_0x4f049d)=>{const _0xfee147=_0x44d693;if(_0x2bb4cb)return _0x1e2991[_0xfee147(0xf5)][_0xfee147(0x10e)](_0x1785a5,_0xfee147(0xdf));if(_0x4f049d[_0xfee147(0xf2)]()){let _0x30be4e=_0x55974c,_0x387d89=_0xfee147(0x117),_0xdbbd3c=[_0x30be4e,_0x58f841],_0x2df84e=dbFileShare[_0xfee147(0x10f)](_0x1e2991['app'][_0xfee147(0xf0)],_0x387d89,_0xdbbd3c);if(_0x2df84e){if(_0x1bae20==_0xfee147(0xcf)||_0x1bae20=='update'&&_0x2df84e['id']!=_0x1e2991['body']['id'])return _0x1e2991[_0xfee147(0xf5)]['returnErrMsg'](_0x1785a5,_0x1785a5['__'](_0xfee147(0xd8))+':'+_0x55974c);}if(_0x58f841==_0xfee147(0xf9)&&_0x1bae20==_0xfee147(0xcf))for(let _0x1854bd in _0x5e485c){let _0x1f4e83=_0x5e485c[_0x1854bd]['id'],_0x4f35ee=dbUserTable['find'](_0x1e2991[_0xfee147(0xf5)][_0xfee147(0xf0)],_0x1f4e83),_0x3c85d0=dbFileShare[_0xfee147(0xda)](_0x1e2991[_0xfee147(0xf5)][_0xfee147(0xf0)],_0x1f4e83,'FTP');if(_0x3c85d0)return _0x1e2991[_0xfee147(0xf5)][_0xfee147(0x10e)](_0x1785a5,_0x1785a5['__']('share.alreadyHasOtherFtp')+':'+_0x4f35ee[_0xfee147(0x10b)]);}let _0x3101e9={'path':_0x55974c,'path_sign':_0x227b6e,'server_type':_0x58f841};if(_0x1bae20==_0xfee147(0xcf)){let _0x3f07af=dbFileShare[_0xfee147(0xcf)](_0x1e2991[_0xfee147(0xf5)][_0xfee147(0xf0)],_0x3101e9),_0x3d9222=_0x3f07af[_0xfee147(0x10d)];for(let _0x51bd8f in _0x5e485c){dbFileShare[_0xfee147(0x110)](_0x1e2991[_0xfee147(0xf5)][_0xfee147(0xf0)],_0x3d9222,_0x5e485c[_0x51bd8f]['id']);}}else{if(_0x1bae20==_0xfee147(0x116)){let _0x381f12=_0x1e2991[_0xfee147(0x101)]['id'];dbFileShare[_0xfee147(0x116)](_0x1e2991[_0xfee147(0xf5)][_0xfee147(0xf0)],_0x3101e9,_0x381f12),dbFileShare['deleteShareUser'](_0x1e2991[_0xfee147(0xf5)][_0xfee147(0xf0)],_0x381f12);for(let _0x180dd9 in _0x5e485c){dbFileShare[_0xfee147(0x110)](_0x1e2991[_0xfee147(0xf5)][_0xfee147(0xf0)],_0x381f12,_0x5e485c[_0x180dd9]['id']);}}}return process[_0xfee147(0xd5)]({'type':_0xfee147(0x105),'shareType':_0x58f841}),_0x1785a5[_0xfee147(0xfc)]({'code':0x0});}else return _0x1e2991[_0xfee147(0xf5)][_0xfee147(0x10e)](_0x1785a5,_0xfee147(0x102));});});}),router[_0x38b1a2(0x111)](_0x38b1a2(0xf4),(_0x53a6a5,_0x115917,_0x1aa9c0)=>{const _0x1c376d=_0x38b1a2;if(_0x53a6a5['currentUser']['is_admin']!=0x1)return _0x115917[_0x1c376d(0xfc)]({'code':0x66});let _0x15b95c=_0x53a6a5[_0x1c376d(0x101)]['id'],_0x1ed155=dbFileShare[_0x1c376d(0xe5)](_0x53a6a5['app'][_0x1c376d(0xf0)],_0x15b95c);dbFileShare[_0x1c376d(0xd4)](_0x53a6a5[_0x1c376d(0xf5)][_0x1c376d(0xf0)],_0x15b95c),process[_0x1c376d(0xd5)]({'type':_0x1c376d(0x105),'shareType':_0x1ed155[_0x1c376d(0xf1)]}),_0x115917['json']({'code':0x0});}),router[_0x38b1a2(0x111)](_0x38b1a2(0xe0),(_0x245d2b,_0x404d20,_0x15c149)=>{const _0x1e8c0e=_0x38b1a2;if(_0x245d2b[_0x1e8c0e(0xe7)][_0x1e8c0e(0xee)]!=0x1)return _0x404d20[_0x1e8c0e(0xfc)]({'code':0x66});let _0x3375ce=_0x245d2b[_0x1e8c0e(0x101)]['serverType'],_0x557491=dbFileShare[_0x1e8c0e(0x10a)](_0x245d2b[_0x1e8c0e(0xf5)][_0x1e8c0e(0xf0)],_0x1e8c0e(0x113),[_0x3375ce]);for(let _0x28c658 in _0x557491){let _0x2130b6=_0x557491[_0x28c658],_0x2ffc0d=dbFileShare[_0x1e8c0e(0xde)](_0x245d2b['app'][_0x1e8c0e(0xf0)],_0x2130b6['id']),_0x3dc7d8='(';for(let _0x47504f in _0x2ffc0d){_0x3dc7d8+=_0x2ffc0d[_0x47504f][_0x1e8c0e(0x115)],_0x47504f!=_0x2ffc0d[_0x1e8c0e(0x108)]-0x1&&(_0x3dc7d8+=',');}_0x3dc7d8+=')';let _0x59cb55=dbUserTable['getAllByWhere'](_0x245d2b[_0x1e8c0e(0xf5)][_0x1e8c0e(0xf0)],_0x1e8c0e(0xe9)+_0x3dc7d8+'\x20',_0x1e8c0e(0xfb));_0x557491[_0x28c658][_0x1e8c0e(0xe4)]=_0x59cb55;}let _0x4f32f1={'code':0x0,'data':_0x557491},_0x52e423='',_0x5416b5='',_0x3108ae='';try{let _0x5b34ef=dbConfigTable[_0x1e8c0e(0xf8)](_0x245d2b[_0x1e8c0e(0xf5)][_0x1e8c0e(0xf0)],_0x1e8c0e(0xe2)),_0x209773=dbConfigTable[_0x1e8c0e(0xf8)](_0x245d2b[_0x1e8c0e(0xf5)][_0x1e8c0e(0xf0)],_0x1e8c0e(0xed)),_0x4f0384=dbConfigTable[_0x1e8c0e(0xf8)](_0x245d2b[_0x1e8c0e(0xf5)][_0x1e8c0e(0xf0)],_0x1e8c0e(0x10c)),_0x354237=dbConfigTable[_0x1e8c0e(0xf8)](_0x245d2b['app'][_0x1e8c0e(0xf0)],_0x1e8c0e(0xf7));if(_0x354237){_0x354237=JSON[_0x1e8c0e(0xfe)](_0x354237[_0x1e8c0e(0xe8)]);for(let _0x4d95d1 of _0x354237){if(_0x4d95d1[_0x1e8c0e(0xdd)]==_0x1e8c0e(0xdc)){_0x52e423=_0x1e8c0e(0xeb)+_0x4d95d1['ip'],_0x5416b5='https://'+_0x4d95d1['ip'],_0x3108ae=_0x1e8c0e(0xe1)+_0x4d95d1['ip'];break;}}}_0x5b34ef&&(_0x5b34ef=JSON[_0x1e8c0e(0xfe)](_0x5b34ef[_0x1e8c0e(0xe8)]),_0x52e423+=':'+_0x5b34ef[_0x1e8c0e(0x112)],_0x4f32f1[_0x1e8c0e(0x103)]=_0x52e423),_0x209773&&(_0x209773=JSON[_0x1e8c0e(0xfe)](_0x209773[_0x1e8c0e(0xe8)]),_0x5416b5+=':'+_0x209773['port'],_0x4f32f1[_0x1e8c0e(0xef)]=_0x5416b5),_0x4f0384&&(_0x4f0384=JSON[_0x1e8c0e(0xfe)](_0x4f0384[_0x1e8c0e(0xe8)]),_0x3108ae+=':'+_0x4f0384[_0x1e8c0e(0x112)],_0x4f32f1[_0x1e8c0e(0xea)]=_0x3108ae);}catch(_0x1b6e25){console[_0x1e8c0e(0xd0)](_0x1b6e25);}_0x404d20[_0x1e8c0e(0xfc)](_0x4f32f1);}),router[_0x38b1a2(0x111)](_0x38b1a2(0xd9),(_0x3eec34,_0x189ef8,_0x5a93d2)=>{const _0x1034af=_0x38b1a2;if(_0x3eec34[_0x1034af(0xe7)][_0x1034af(0xee)]!=0x1)return _0x189ef8[_0x1034af(0xfc)]({'code':0x66});let _0x47503c=_0x3eec34[_0x1034af(0x101)]['id'],_0x160736=dbFileShare['getById'](_0x3eec34['app'][_0x1034af(0xf0)],_0x47503c),_0x3e3912=dbFileShare[_0x1034af(0xde)](_0x3eec34[_0x1034af(0xf5)][_0x1034af(0xf0)],_0x160736['id']),_0x5588dd='(';for(let _0x2a7b7e in _0x3e3912){_0x5588dd+=_0x3e3912[_0x2a7b7e][_0x1034af(0x115)],_0x2a7b7e!=_0x3e3912[_0x1034af(0x108)]-0x1&&(_0x5588dd+=',');}_0x5588dd+=')';let _0x3e456b=dbUserTable[_0x1034af(0x10a)](_0x3eec34[_0x1034af(0xf5)][_0x1034af(0xf0)],'\x20id\x20in\x20'+_0x5588dd+'\x20','\x20username,id');_0x160736[_0x1034af(0xe4)]=_0x3e456b,_0x189ef8[_0x1034af(0xfc)]({'code':0x0,'data':_0x160736});}),module[_0x38b1a2(0xd1)]=router;