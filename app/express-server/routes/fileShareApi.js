const _0x5bfd8d=_0x5c59;function _0x5c59(_0x3912aa,_0x2fd7ed){const _0x1d5afd=_0x1d5a();return _0x5c59=function(_0x5c5920,_0x2fd38e){_0x5c5920=_0x5c5920-0x7c;let _0x2079a6=_0x1d5afd[_0x5c5920];return _0x2079a6;},_0x5c59(_0x3912aa,_0x2fd7ed);}(function(_0x38f2ca,_0x35eddc){const _0x18bbf2=_0x5c59,_0x39a460=_0x38f2ca();while(!![]){try{const _0x505c42=-parseInt(_0x18bbf2(0x92))/0x1*(parseInt(_0x18bbf2(0xb5))/0x2)+parseInt(_0x18bbf2(0xaf))/0x3*(-parseInt(_0x18bbf2(0xb2))/0x4)+parseInt(_0x18bbf2(0x8e))/0x5+parseInt(_0x18bbf2(0x7e))/0x6+-parseInt(_0x18bbf2(0xb7))/0x7+parseInt(_0x18bbf2(0xa7))/0x8*(-parseInt(_0x18bbf2(0x96))/0x9)+parseInt(_0x18bbf2(0x9a))/0xa;if(_0x505c42===_0x35eddc)break;else _0x39a460['push'](_0x39a460['shift']());}catch(_0x423521){_0x39a460['push'](_0x39a460['shift']());}}}(_0x1d5a,0x8fef9));var express=require(_0x5bfd8d(0xc2)),router=express[_0x5bfd8d(0xa2)]();let path=require(_0x5bfd8d(0xb9)),fs=require('fs');const dbFileShare=require(_0x5bfd8d(0xa8)),dbUserTable=require(_0x5bfd8d(0x84));let dbConfigTable=require('../../db/dbConfigTable');router['post'](_0x5bfd8d(0xc1),(_0x7cbfb3,_0x1ce1f8,_0x2458e3)=>{const _0x2c9a39=_0x5bfd8d;if(_0x7cbfb3['currentUser'][_0x2c9a39(0xb3)]!=0x1)return _0x1ce1f8[_0x2c9a39(0x7f)]({'code':0x66});let _0x41417d=_0x7cbfb3[_0x2c9a39(0x95)]['type'],_0x1d5558=_0x7cbfb3['body'][_0x2c9a39(0xa3)],_0x21e82a=_0x7cbfb3[_0x2c9a39(0x95)][_0x2c9a39(0xb9)],_0x45d3e4=_0x7cbfb3[_0x2c9a39(0x95)][_0x2c9a39(0xa6)];fs[_0x2c9a39(0x99)](_0x21e82a,fs['constants'][_0x2c9a39(0xad)]|fs[_0x2c9a39(0x87)]['R_OK'],_0x4201be=>{const _0x2ddb1d=_0x2c9a39;if(_0x4201be)return _0x7cbfb3['app'][_0x2ddb1d(0xab)](_0x1ce1f8,_0x1ce1f8['__'](_0x2ddb1d(0x98))+':'+_0x21e82a);let _0x38e2a5=_0x7cbfb3['body'][_0x2ddb1d(0xbf)];if(_0x45d3e4=='WebDav'){if(!_0x38e2a5)return _0x7cbfb3[_0x2ddb1d(0xc0)]['returnErrMsg'](_0x1ce1f8,_0x1ce1f8['__'](_0x2ddb1d(0x93)));else{let _0x15fd4d=[_0x38e2a5],_0x25175f='\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27',_0x3aeb6e=dbFileShare['getByWhere'](_0x7cbfb3[_0x2ddb1d(0xc0)][_0x2ddb1d(0xae)],_0x25175f,_0x15fd4d);if(_0x3aeb6e){if(_0x41417d==_0x2ddb1d(0xb8)||_0x41417d==_0x2ddb1d(0xbb)&&_0x3aeb6e['id']!=_0x7cbfb3['body']['id'])return _0x7cbfb3[_0x2ddb1d(0xc0)][_0x2ddb1d(0xab)](_0x1ce1f8,_0x1ce1f8['__'](_0x2ddb1d(0x8c))+':'+_0x38e2a5);}}}fs[_0x2ddb1d(0x97)](_0x21e82a,(_0x28be0f,_0x5d969c)=>{const _0x3e9eae=_0x2ddb1d;if(_0x28be0f)return _0x7cbfb3[_0x3e9eae(0xc0)][_0x3e9eae(0xab)](_0x1ce1f8,'Invalid\x20path');if(_0x5d969c[_0x3e9eae(0xa1)]()){let _0x326f8c=_0x21e82a,_0x3e9190=_0x3e9eae(0xb6),_0x1d333b=[_0x326f8c,_0x45d3e4],_0x55819d=dbFileShare[_0x3e9eae(0x9e)](_0x7cbfb3[_0x3e9eae(0xc0)]['dbOther'],_0x3e9190,_0x1d333b);if(_0x55819d){if(_0x41417d=='create'||_0x41417d==_0x3e9eae(0xbb)&&_0x55819d['id']!=_0x7cbfb3[_0x3e9eae(0x95)]['id'])return _0x7cbfb3[_0x3e9eae(0xc0)][_0x3e9eae(0xab)](_0x1ce1f8,_0x1ce1f8['__'](_0x3e9eae(0xbd))+':'+_0x21e82a);}if(_0x45d3e4=='FTP'&&_0x41417d==_0x3e9eae(0xb8))for(let _0x41f1fe in _0x1d5558){let _0x3a53cc=_0x1d5558[_0x41f1fe]['id'],_0x26a713=dbUserTable[_0x3e9eae(0x9f)](_0x7cbfb3['app'][_0x3e9eae(0xae)],_0x3a53cc),_0x406d23=dbFileShare[_0x3e9eae(0x86)](_0x7cbfb3['app'][_0x3e9eae(0xae)],_0x3a53cc,_0x3e9eae(0x90));if(_0x406d23)return _0x7cbfb3['app'][_0x3e9eae(0xab)](_0x1ce1f8,_0x1ce1f8['__']('share.alreadyHasOtherFtp')+':'+_0x26a713[_0x3e9eae(0x83)]);}let _0x5313ff={'path':_0x21e82a,'path_sign':_0x38e2a5,'server_type':_0x45d3e4};if(_0x41417d==_0x3e9eae(0xb8)){let _0xe629ff=dbFileShare[_0x3e9eae(0xb8)](_0x7cbfb3[_0x3e9eae(0xc0)][_0x3e9eae(0xae)],_0x5313ff),_0x5659d5=_0xe629ff['lastInsertRowid'];for(let _0x40dc33 in _0x1d5558){dbFileShare[_0x3e9eae(0x7d)](_0x7cbfb3[_0x3e9eae(0xc0)][_0x3e9eae(0xae)],_0x5659d5,_0x1d5558[_0x40dc33]['id']);}}else{if(_0x41417d=='update'){let _0x481e92=_0x7cbfb3[_0x3e9eae(0x95)]['id'];dbFileShare[_0x3e9eae(0xbb)](_0x7cbfb3[_0x3e9eae(0xc0)][_0x3e9eae(0xae)],_0x5313ff,_0x481e92),dbFileShare[_0x3e9eae(0x9c)](_0x7cbfb3[_0x3e9eae(0xc0)][_0x3e9eae(0xae)],_0x481e92);for(let _0x339426 in _0x1d5558){dbFileShare[_0x3e9eae(0x7d)](_0x7cbfb3[_0x3e9eae(0xc0)]['dbOther'],_0x481e92,_0x1d5558[_0x339426]['id']);}}}return process['send']({'type':_0x3e9eae(0xb4),'shareType':_0x45d3e4}),_0x1ce1f8[_0x3e9eae(0x7f)]({'code':0x0});}else return _0x7cbfb3[_0x3e9eae(0xc0)][_0x3e9eae(0xab)](_0x1ce1f8,_0x3e9eae(0x7c));});});}),router[_0x5bfd8d(0xa5)](_0x5bfd8d(0x88),(_0x970f05,_0x3a8a86,_0x394130)=>{const _0x390816=_0x5bfd8d;if(_0x970f05['currentUser'][_0x390816(0xb3)]!=0x1)return _0x3a8a86['json']({'code':0x66});let _0x3a7060=_0x970f05[_0x390816(0x95)]['id'],_0x52d7a2=dbFileShare[_0x390816(0xc3)](_0x970f05[_0x390816(0xc0)][_0x390816(0xae)],_0x3a7060);dbFileShare[_0x390816(0xba)](_0x970f05[_0x390816(0xc0)][_0x390816(0xae)],_0x3a7060),process[_0x390816(0x8b)]({'type':_0x390816(0xb4),'shareType':_0x52d7a2['server_type']}),_0x3a8a86[_0x390816(0x7f)]({'code':0x0});}),router[_0x5bfd8d(0xa5)](_0x5bfd8d(0x8a),(_0x5a9c33,_0x46ad13,_0xfe9a9d)=>{const _0x398c44=_0x5bfd8d;if(_0x5a9c33[_0x398c44(0xa9)]['is_admin']!=0x1)return _0x46ad13['json']({'code':0x66});let _0x27b132=_0x5a9c33['body'][_0x398c44(0xa6)],_0x57b271=dbFileShare[_0x398c44(0x85)](_0x5a9c33[_0x398c44(0xc0)][_0x398c44(0xae)],_0x398c44(0xb1),[_0x27b132]);for(let _0x3b2032 in _0x57b271){let _0x4b2bee=_0x57b271[_0x3b2032],_0xef6ae2=dbFileShare[_0x398c44(0x80)](_0x5a9c33[_0x398c44(0xc0)][_0x398c44(0xae)],_0x4b2bee['id']),_0x34d166='(';for(let _0x1d9eff in _0xef6ae2){_0x34d166+=_0xef6ae2[_0x1d9eff][_0x398c44(0xb0)],_0x1d9eff!=_0xef6ae2[_0x398c44(0xbe)]-0x1&&(_0x34d166+=',');}_0x34d166+=')';let _0x111e3b=dbUserTable[_0x398c44(0x85)](_0x5a9c33[_0x398c44(0xc0)]['dbOther'],_0x398c44(0x81)+_0x34d166+'\x20','\x20username,id');_0x57b271[_0x3b2032][_0x398c44(0xa3)]=_0x111e3b;}let _0x6bfaf0={'code':0x0,'data':_0x57b271},_0x32b2a4='',_0x6ff84d='',_0xf0abc2='';try{let _0x1b40f5=dbConfigTable[_0x398c44(0x82)](_0x5a9c33[_0x398c44(0xc0)][_0x398c44(0xae)],'webDavServer'),_0x149845=dbConfigTable[_0x398c44(0x82)](_0x5a9c33['app'][_0x398c44(0xae)],'webDavHttpsServer'),_0x106d4b=dbConfigTable[_0x398c44(0x82)](_0x5a9c33['app'][_0x398c44(0xae)],_0x398c44(0x94)),_0xb97372=dbConfigTable['findByTitle'](_0x5a9c33[_0x398c44(0xc0)][_0x398c44(0xae)],'globalIpList');if(_0xb97372){_0xb97372=JSON[_0x398c44(0xbc)](_0xb97372[_0x398c44(0xa4)]);for(let _0x24c72a of _0xb97372){if(_0x24c72a['type']==_0x398c44(0xac)){_0x32b2a4=_0x398c44(0x9d)+_0x24c72a['ip'],_0x6ff84d='https://'+_0x24c72a['ip'],_0xf0abc2=_0x398c44(0x8d)+_0x24c72a['ip'];break;}}}_0x1b40f5&&(_0x1b40f5=JSON['parse'](_0x1b40f5['value']),_0x32b2a4+=':'+_0x1b40f5[_0x398c44(0x89)],_0x6bfaf0[_0x398c44(0xc4)]=_0x32b2a4),_0x149845&&(_0x149845=JSON[_0x398c44(0xbc)](_0x149845[_0x398c44(0xa4)]),_0x6ff84d+=':'+_0x149845[_0x398c44(0x89)],_0x6bfaf0[_0x398c44(0xaa)]=_0x6ff84d),_0x106d4b&&(_0x106d4b=JSON['parse'](_0x106d4b['value']),_0xf0abc2+=':'+_0x106d4b[_0x398c44(0x89)],_0x6bfaf0['ftpHttp']=_0xf0abc2);}catch(_0x806122){console[_0x398c44(0x91)](_0x806122);}_0x46ad13[_0x398c44(0x7f)](_0x6bfaf0);}),router['post'](_0x5bfd8d(0x9b),(_0x2dd456,_0x43c3be,_0x43cd3c)=>{const _0x4bbfd8=_0x5bfd8d;if(_0x2dd456[_0x4bbfd8(0xa9)][_0x4bbfd8(0xb3)]!=0x1)return _0x43c3be[_0x4bbfd8(0x7f)]({'code':0x66});let _0x190240=_0x2dd456[_0x4bbfd8(0x95)]['id'],_0x597c0e=dbFileShare[_0x4bbfd8(0xc3)](_0x2dd456[_0x4bbfd8(0xc0)][_0x4bbfd8(0xae)],_0x190240),_0x5504c5=dbFileShare[_0x4bbfd8(0x80)](_0x2dd456[_0x4bbfd8(0xc0)][_0x4bbfd8(0xae)],_0x597c0e['id']),_0x5bbb6e='(';for(let _0xd7c613 in _0x5504c5){_0x5bbb6e+=_0x5504c5[_0xd7c613]['user_id'],_0xd7c613!=_0x5504c5[_0x4bbfd8(0xbe)]-0x1&&(_0x5bbb6e+=',');}_0x5bbb6e+=')';let _0x6c4e5=dbUserTable[_0x4bbfd8(0x85)](_0x2dd456[_0x4bbfd8(0xc0)][_0x4bbfd8(0xae)],'\x20id\x20in\x20'+_0x5bbb6e+'\x20',_0x4bbfd8(0x8f));_0x597c0e[_0x4bbfd8(0xa3)]=_0x6c4e5,_0x43c3be[_0x4bbfd8(0x7f)]({'code':0x0,'data':_0x597c0e});}),module[_0x5bfd8d(0xa0)]=router;function _0x1d5a(){const _0x1769b4=['3864455xeVjee','\x20username,id','FTP','log','1wiBWsA','pathSignNoNull','FTPServer','body','9ranygl','stat','noWritePermission','access','12147330rrRxem','/getById','deleteShareUser','http://','getByWhere','find','exports','isDirectory','Router','users','value','post','serverType','1407920vSwhXU','../../db/dbFileShare','currentUser','webdavHttps','returnErrMsg','ipv4','W_OK','dbOther','2718XzoguM','user_id','server_type=?\x20order\x20by\x20id\x20desc','2624kcIShT','is_admin','fileShareRestart','2077462vQDjZq','\x20path=?\x20and\x20server_type=?','311703CzRXWI','create','path','delete','update','parse','share.samePathExist','length','pathSign','app','/create','express','getById','webdavHttp','\x20path\x20is\x20not\x20directory','createShareUser','2733138qSLoXW','json','getSharesUserByShareId','\x20id\x20in\x20','findByTitle','username','../../db/dbUserTable','getAllByWhere','userHasFtp','constants','/delete','port','/getAll','send','share.samePathSign','ftp://'];_0x1d5a=function(){return _0x1769b4;};return _0x1d5a();}