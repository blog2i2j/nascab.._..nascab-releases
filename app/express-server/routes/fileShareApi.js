const _0x3f9edf=_0x5bd0;(function(_0x57b51c,_0x5af0ec){const _0x3b88cf=_0x5bd0,_0x3ce2da=_0x57b51c();while(!![]){try{const _0x3413d0=-parseInt(_0x3b88cf(0xdd))/0x1+-parseInt(_0x3b88cf(0xd6))/0x2+parseInt(_0x3b88cf(0x9e))/0x3+parseInt(_0x3b88cf(0xcd))/0x4*(parseInt(_0x3b88cf(0xb2))/0x5)+parseInt(_0x3b88cf(0xe3))/0x6*(parseInt(_0x3b88cf(0xc9))/0x7)+parseInt(_0x3b88cf(0xe4))/0x8*(-parseInt(_0x3b88cf(0xb5))/0x9)+-parseInt(_0x3b88cf(0xd0))/0xa*(-parseInt(_0x3b88cf(0x9a))/0xb);if(_0x3413d0===_0x5af0ec)break;else _0x3ce2da['push'](_0x3ce2da['shift']());}catch(_0x32a249){_0x3ce2da['push'](_0x3ce2da['shift']());}}}(_0x2925,0xc19c5));var express=require(_0x3f9edf(0xaa)),router=express['Router']();let path=require(_0x3f9edf(0xb0)),fs=require('fs');function _0x5bd0(_0x5a06f2,_0x5a5bd2){const _0x2925ae=_0x2925();return _0x5bd0=function(_0x5bd099,_0x1538d2){_0x5bd099=_0x5bd099-0x93;let _0x52a7c4=_0x2925ae[_0x5bd099];return _0x52a7c4;},_0x5bd0(_0x5a06f2,_0x5a5bd2);}const dbFileShare=require(_0x3f9edf(0xa9)),dbUserTable=require(_0x3f9edf(0xdf));let dbConfigTable=require(_0x3f9edf(0x9f));router['post'](_0x3f9edf(0xc2),(_0x22baf2,_0x2904dd,_0x557efc)=>{const _0x53ab85=_0x3f9edf;if(_0x22baf2[_0x53ab85(0xbc)][_0x53ab85(0xbb)]!=0x1)return _0x2904dd[_0x53ab85(0xa0)]({'code':0x66});let _0x2a684d=_0x22baf2['body'][_0x53ab85(0xae)],_0x175253=_0x22baf2['body'][_0x53ab85(0x94)],_0x320cac=_0x22baf2[_0x53ab85(0xa5)][_0x53ab85(0xb0)],_0x16f490=_0x22baf2[_0x53ab85(0xa5)][_0x53ab85(0xd8)];fs['access'](_0x320cac,fs[_0x53ab85(0xd5)][_0x53ab85(0xa4)]|fs['constants'][_0x53ab85(0xb3)],_0xea6d37=>{const _0x3a3205=_0x53ab85;if(_0xea6d37)return _0x22baf2[_0x3a3205(0xba)][_0x3a3205(0xd4)](_0x2904dd,_0x2904dd['__'](_0x3a3205(0xe0))+':'+_0x320cac);let _0x3d0305=_0x22baf2[_0x3a3205(0xa5)][_0x3a3205(0xcc)];if(_0x16f490==_0x3a3205(0xc4)){if(!_0x3d0305)return _0x22baf2[_0x3a3205(0xba)][_0x3a3205(0xd4)](_0x2904dd,_0x2904dd['__'](_0x3a3205(0xb9)));else{let _0x26452e=[_0x3d0305],_0x19c23c=_0x3a3205(0xac),_0x17716e=dbFileShare[_0x3a3205(0xd7)](_0x22baf2[_0x3a3205(0xba)][_0x3a3205(0xa7)],_0x19c23c,_0x26452e);if(_0x17716e){if(_0x2a684d==_0x3a3205(0xb6)||_0x2a684d==_0x3a3205(0xa8)&&_0x17716e['id']!=_0x22baf2[_0x3a3205(0xa5)]['id'])return _0x22baf2[_0x3a3205(0xba)]['returnErrMsg'](_0x2904dd,_0x2904dd['__'](_0x3a3205(0xdc))+':'+_0x3d0305);}}}fs[_0x3a3205(0xc3)](_0x320cac,(_0x2184f9,_0x417269)=>{const _0x1c2bb7=_0x3a3205;if(_0x2184f9)return _0x22baf2['app'][_0x1c2bb7(0xd4)](_0x2904dd,_0x1c2bb7(0xd1));if(_0x417269[_0x1c2bb7(0xc0)]()){let _0x30fe84=_0x320cac,_0x4b4c11=_0x1c2bb7(0x98),_0xc85d79=[_0x30fe84,_0x16f490],_0x5914c5=dbFileShare[_0x1c2bb7(0xd7)](_0x22baf2['app'][_0x1c2bb7(0xa7)],_0x4b4c11,_0xc85d79);if(_0x5914c5){if(_0x2a684d==_0x1c2bb7(0xb6)||_0x2a684d=='update'&&_0x5914c5['id']!=_0x22baf2['body']['id'])return _0x22baf2[_0x1c2bb7(0xba)][_0x1c2bb7(0xd4)](_0x2904dd,_0x2904dd['__'](_0x1c2bb7(0xbd))+':'+_0x320cac);}if(_0x16f490==_0x1c2bb7(0xad)&&_0x2a684d==_0x1c2bb7(0xb6))for(let _0x313824 in _0x175253){let _0x1c0c81=_0x175253[_0x313824]['id'],_0x58ec78=dbUserTable[_0x1c2bb7(0xa3)](_0x22baf2[_0x1c2bb7(0xba)][_0x1c2bb7(0xa7)],_0x1c0c81),_0x69f6a8=dbFileShare[_0x1c2bb7(0xd2)](_0x22baf2[_0x1c2bb7(0xba)]['dbOther'],_0x1c0c81,'FTP');if(_0x69f6a8)return _0x22baf2['app'][_0x1c2bb7(0xd4)](_0x2904dd,_0x2904dd['__'](_0x1c2bb7(0xb4))+':'+_0x58ec78[_0x1c2bb7(0xc8)]);}let _0x5984e9={'path':_0x320cac,'path_sign':_0x3d0305,'server_type':_0x16f490};if(_0x2a684d==_0x1c2bb7(0xb6)){let _0x279bfc=dbFileShare[_0x1c2bb7(0xb6)](_0x22baf2[_0x1c2bb7(0xba)][_0x1c2bb7(0xa7)],_0x5984e9),_0x5796bf=_0x279bfc['lastInsertRowid'];for(let _0x5beef6 in _0x175253){dbFileShare[_0x1c2bb7(0x95)](_0x22baf2[_0x1c2bb7(0xba)][_0x1c2bb7(0xa7)],_0x5796bf,_0x175253[_0x5beef6]['id']);}}else{if(_0x2a684d==_0x1c2bb7(0xa8)){let _0x312b82=_0x22baf2['body']['id'];dbFileShare[_0x1c2bb7(0xa8)](_0x22baf2[_0x1c2bb7(0xba)][_0x1c2bb7(0xa7)],_0x5984e9,_0x312b82),dbFileShare[_0x1c2bb7(0xe2)](_0x22baf2[_0x1c2bb7(0xba)]['dbOther'],_0x312b82);for(let _0x245fee in _0x175253){dbFileShare[_0x1c2bb7(0x95)](_0x22baf2[_0x1c2bb7(0xba)][_0x1c2bb7(0xa7)],_0x312b82,_0x175253[_0x245fee]['id']);}}}return process[_0x1c2bb7(0xaf)]({'type':'fileShareRestart','shareType':_0x16f490}),_0x2904dd[_0x1c2bb7(0xa0)]({'code':0x0});}else return _0x22baf2['app'][_0x1c2bb7(0xd4)](_0x2904dd,_0x1c2bb7(0xd3));});});}),router[_0x3f9edf(0xb8)](_0x3f9edf(0xdb),(_0x15a0de,_0x224b7f,_0x70b5d4)=>{const _0x3f03f9=_0x3f9edf;if(_0x15a0de['currentUser'][_0x3f03f9(0xbb)]!=0x1)return _0x224b7f[_0x3f03f9(0xa0)]({'code':0x66});let _0x5273d4=_0x15a0de[_0x3f03f9(0xa5)]['id'],_0x8333fe=dbFileShare[_0x3f03f9(0xa1)](_0x15a0de[_0x3f03f9(0xba)][_0x3f03f9(0xa7)],_0x5273d4);dbFileShare[_0x3f03f9(0xcb)](_0x15a0de['app'][_0x3f03f9(0xa7)],_0x5273d4),process['send']({'type':'fileShareRestart','shareType':_0x8333fe[_0x3f03f9(0x9c)]}),_0x224b7f[_0x3f03f9(0xa0)]({'code':0x0});}),router[_0x3f9edf(0xb8)](_0x3f9edf(0xce),(_0x3d1a22,_0x3cea70,_0x318fae)=>{const _0x3d919e=_0x3f9edf;if(_0x3d1a22[_0x3d919e(0xbc)][_0x3d919e(0xbb)]!=0x1)return _0x3cea70[_0x3d919e(0xa0)]({'code':0x66});let _0xdf4a60=_0x3d1a22['body'][_0x3d919e(0xd8)],_0x445edc=dbFileShare[_0x3d919e(0xda)](_0x3d1a22[_0x3d919e(0xba)][_0x3d919e(0xa7)],'server_type=?\x20order\x20by\x20id\x20desc',[_0xdf4a60]);for(let _0x124ca0 in _0x445edc){let _0x2637ea=_0x445edc[_0x124ca0],_0x36585a=dbFileShare[_0x3d919e(0xb1)](_0x3d1a22[_0x3d919e(0xba)]['dbOther'],_0x2637ea['id']),_0x562572='(';for(let _0x587736 in _0x36585a){_0x562572+=_0x36585a[_0x587736][_0x3d919e(0xc6)],_0x587736!=_0x36585a[_0x3d919e(0xcf)]-0x1&&(_0x562572+=',');}_0x562572+=')';let _0x212963=dbUserTable['getAllByWhere'](_0x3d1a22[_0x3d919e(0xba)]['dbOther'],_0x3d919e(0xa6)+_0x562572+'\x20',_0x3d919e(0xe1));_0x445edc[_0x124ca0][_0x3d919e(0x94)]=_0x212963;}let _0x32f81d={'code':0x0,'data':_0x445edc},_0x3ae3a6='',_0x24abdf='',_0x3d4454='';try{let _0x1505e6=dbConfigTable[_0x3d919e(0xbe)](_0x3d1a22[_0x3d919e(0xba)]['dbOther'],_0x3d919e(0x9d)),_0x3439c5=dbConfigTable['findByTitle'](_0x3d1a22[_0x3d919e(0xba)][_0x3d919e(0xa7)],_0x3d919e(0x96)),_0x5be878=dbConfigTable[_0x3d919e(0xbe)](_0x3d1a22[_0x3d919e(0xba)][_0x3d919e(0xa7)],_0x3d919e(0xca)),_0x5826c8=dbConfigTable[_0x3d919e(0xbe)](_0x3d1a22[_0x3d919e(0xba)]['dbOther'],_0x3d919e(0x9b));if(_0x5826c8){_0x5826c8=JSON[_0x3d919e(0xab)](_0x5826c8[_0x3d919e(0x99)]);for(let _0x3d74e5 of _0x5826c8){if(_0x3d74e5[_0x3d919e(0xae)]==_0x3d919e(0xd9)){_0x3ae3a6=_0x3d919e(0xde)+_0x3d74e5['ip'],_0x24abdf=_0x3d919e(0x97)+_0x3d74e5['ip'],_0x3d4454=_0x3d919e(0xc1)+_0x3d74e5['ip'];break;}}}_0x1505e6&&(_0x1505e6=JSON[_0x3d919e(0xab)](_0x1505e6[_0x3d919e(0x99)]),_0x3ae3a6+=':'+_0x1505e6[_0x3d919e(0xc5)],_0x32f81d['webdavHttp']=_0x3ae3a6),_0x3439c5&&(_0x3439c5=JSON[_0x3d919e(0xab)](_0x3439c5[_0x3d919e(0x99)]),_0x24abdf+=':'+_0x3439c5[_0x3d919e(0xc5)],_0x32f81d[_0x3d919e(0x93)]=_0x24abdf),_0x5be878&&(_0x5be878=JSON[_0x3d919e(0xab)](_0x5be878[_0x3d919e(0x99)]),_0x3d4454+=':'+_0x5be878['port'],_0x32f81d[_0x3d919e(0xc7)]=_0x3d4454);}catch(_0x5325b1){console[_0x3d919e(0xbf)](_0x5325b1);}_0x3cea70['json'](_0x32f81d);}),router[_0x3f9edf(0xb8)](_0x3f9edf(0xb7),(_0x3f1655,_0x3d9da2,_0x379922)=>{const _0x170e81=_0x3f9edf;if(_0x3f1655[_0x170e81(0xbc)][_0x170e81(0xbb)]!=0x1)return _0x3d9da2[_0x170e81(0xa0)]({'code':0x66});let _0x5d84f1=_0x3f1655[_0x170e81(0xa5)]['id'],_0x3466bd=dbFileShare[_0x170e81(0xa1)](_0x3f1655[_0x170e81(0xba)][_0x170e81(0xa7)],_0x5d84f1),_0x67bacd=dbFileShare[_0x170e81(0xb1)](_0x3f1655['app'][_0x170e81(0xa7)],_0x3466bd['id']),_0x457371='(';for(let _0x2df0d6 in _0x67bacd){_0x457371+=_0x67bacd[_0x2df0d6][_0x170e81(0xc6)],_0x2df0d6!=_0x67bacd[_0x170e81(0xcf)]-0x1&&(_0x457371+=',');}_0x457371+=')';let _0x3b4327=dbUserTable[_0x170e81(0xda)](_0x3f1655[_0x170e81(0xba)]['dbOther'],_0x170e81(0xa6)+_0x457371+'\x20',_0x170e81(0xe1));_0x3466bd[_0x170e81(0x94)]=_0x3b4327,_0x3d9da2['json']({'code':0x0,'data':_0x3466bd});}),module[_0x3f9edf(0xa2)]=router;function _0x2925(){const _0x158094=['webdavHttps','users','createShareUser','webDavHttpsServer','https://','\x20path=?\x20and\x20server_type=?','value','595463YbnzuN','globalIpList','server_type','webDavServer','102054xvLMDr','../../db/dbConfigTable','json','getById','exports','find','W_OK','body','\x20id\x20in\x20','dbOther','update','../../db/dbFileShare','express','parse','\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27','FTP','type','send','path','getSharesUserByShareId','2945yEAOxF','R_OK','share.alreadyHasOtherFtp','9Kptjlr','create','/getById','post','pathSignNoNull','app','is_admin','currentUser','share.samePathExist','findByTitle','log','isDirectory','ftp://','/create','stat','WebDav','port','user_id','ftpHttp','username','1050XTftmH','FTPServer','delete','pathSign','652dJwdpx','/getAll','length','410PClGSr','Invalid\x20path','userHasFtp','\x20path\x20is\x20not\x20directory','returnErrMsg','constants','213528dKJgMn','getByWhere','serverType','ipv4','getAllByWhere','/delete','share.samePathSign','791648hUqItG','http://','../../db/dbUserTable','noWritePermission','\x20username,id','deleteShareUser','11430YUPJaA','7550296TiLXZa'];_0x2925=function(){return _0x158094;};return _0x2925();}