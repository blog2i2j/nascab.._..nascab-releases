function _0x2e55(_0x5c6a53,_0x26dd00){const _0x386db4=_0x386d();return _0x2e55=function(_0x2e554a,_0x3d8cf6){_0x2e554a=_0x2e554a-0x96;let _0x453287=_0x386db4[_0x2e554a];return _0x453287;},_0x2e55(_0x5c6a53,_0x26dd00);}const _0x4c6a08=_0x2e55;(function(_0x1e40d5,_0x474093){const _0x2d5dba=_0x2e55,_0x4cdce9=_0x1e40d5();while(!![]){try{const _0x1ac3b7=-parseInt(_0x2d5dba(0xb6))/0x1+parseInt(_0x2d5dba(0xd3))/0x2*(-parseInt(_0x2d5dba(0x96))/0x3)+parseInt(_0x2d5dba(0xc1))/0x4*(-parseInt(_0x2d5dba(0xbe))/0x5)+-parseInt(_0x2d5dba(0xaf))/0x6+-parseInt(_0x2d5dba(0xc4))/0x7+parseInt(_0x2d5dba(0xa0))/0x8*(-parseInt(_0x2d5dba(0xcd))/0x9)+parseInt(_0x2d5dba(0xc3))/0xa;if(_0x1ac3b7===_0x474093)break;else _0x4cdce9['push'](_0x4cdce9['shift']());}catch(_0x4f5b74){_0x4cdce9['push'](_0x4cdce9['shift']());}}}(_0x386d,0x21dbf));var express=require('express'),router=express[_0x4c6a08(0xb1)]();let path=require('path'),fs=require('fs');const dbFileShare=require(_0x4c6a08(0xcc)),dbUserTable=require(_0x4c6a08(0xa4));function _0x386d(){const _0x243c36=['webdavHttps','lastInsertRowid','pathSignNoNull','post','ipv4','http://','findByTitle','../../db/dbFileShare','1935iOZanU','create','app','length','serverType','update','40406REMUow','port','currentUser','user_id','\x20path_sign=?\x20and\x20server_type=\x27WebDav\x27','pathSign','/delete','webdavHttp','parse','getByWhere','deleteShareUser','30JqNJPD','createShareUser','is_admin','getAllByWhere','/create','users','type','ftpHttp','log','\x20id\x20in\x20','600qUiOMa','dbOther','/getById','server_type','../../db/dbUserTable','fileShareRestart','stat','share.samePathSign','exports','getById','json','returnErrMsg','constants','ftp://','\x20path\x20is\x20not\x20directory','1305228XcKQHS','access','Router','webDavServer','FTP','share.alreadyHasOtherFtp','send','47030eUoWKW','globalIpList','userHasFtp','username','\x20username,id','getSharesUserByShareId','R_OK','https://','5Evdgdh','value','body','431276ttesez','noWritePermission','8441670NqmhZZ','804566XSyPxw'];_0x386d=function(){return _0x243c36;};return _0x386d();}let dbConfigTable=require('../../db/dbConfigTable');router['post'](_0x4c6a08(0x9a),(_0x45f0af,_0x5a1863,_0x221814)=>{const _0x59cf28=_0x4c6a08;if(_0x45f0af['currentUser'][_0x59cf28(0x98)]!=0x1)return _0x5a1863['json']({'code':0x66});let _0x27a127=_0x45f0af[_0x59cf28(0xc0)]['type'],_0x321b4c=_0x45f0af[_0x59cf28(0xc0)]['users'],_0x13cb7a=_0x45f0af[_0x59cf28(0xc0)]['path'],_0x943902=_0x45f0af['body']['serverType'];fs[_0x59cf28(0xb0)](_0x13cb7a,fs[_0x59cf28(0xac)]['W_OK']|fs['constants'][_0x59cf28(0xbc)],_0x57ce0b=>{const _0x3714b4=_0x59cf28;if(_0x57ce0b)return _0x45f0af[_0x3714b4(0xcf)][_0x3714b4(0xab)](_0x5a1863,_0x5a1863['__'](_0x3714b4(0xc2))+':'+_0x13cb7a);let _0x4d76ba=_0x45f0af[_0x3714b4(0xc0)][_0x3714b4(0xd8)];if(_0x943902=='WebDav'){if(!_0x4d76ba)return _0x45f0af[_0x3714b4(0xcf)]['returnErrMsg'](_0x5a1863,_0x5a1863['__'](_0x3714b4(0xc7)));else{let _0x332c21=[_0x4d76ba],_0x2f351d=_0x3714b4(0xd7),_0x47619e=dbFileShare[_0x3714b4(0xdc)](_0x45f0af['app'][_0x3714b4(0xa1)],_0x2f351d,_0x332c21);if(_0x47619e){if(_0x27a127==_0x3714b4(0xce)||_0x27a127==_0x3714b4(0xd2)&&_0x47619e['id']!=_0x45f0af[_0x3714b4(0xc0)]['id'])return _0x45f0af[_0x3714b4(0xcf)][_0x3714b4(0xab)](_0x5a1863,_0x5a1863['__'](_0x3714b4(0xa7))+':'+_0x4d76ba);}}}fs[_0x3714b4(0xa6)](_0x13cb7a,(_0x2acf5f,_0x35a0c4)=>{const _0x5350bb=_0x3714b4;if(_0x2acf5f)return _0x45f0af[_0x5350bb(0xcf)]['returnErrMsg'](_0x5a1863,'Invalid\x20path');if(_0x35a0c4['isDirectory']()){let _0xdd15fb=_0x13cb7a,_0x222a83='\x20path=?\x20and\x20server_type=?',_0x46df52=[_0xdd15fb,_0x943902],_0x1c7f5d=dbFileShare[_0x5350bb(0xdc)](_0x45f0af[_0x5350bb(0xcf)]['dbOther'],_0x222a83,_0x46df52);if(_0x1c7f5d){if(_0x27a127=='create'||_0x27a127==_0x5350bb(0xd2)&&_0x1c7f5d['id']!=_0x45f0af[_0x5350bb(0xc0)]['id'])return _0x45f0af[_0x5350bb(0xcf)][_0x5350bb(0xab)](_0x5a1863,_0x5a1863['__']('share.samePathExist')+':'+_0x13cb7a);}if(_0x943902=='FTP'&&_0x27a127=='create')for(let _0x1ab4b0 in _0x321b4c){let _0x418cb3=_0x321b4c[_0x1ab4b0]['id'],_0x8b3368=dbUserTable['find'](_0x45f0af[_0x5350bb(0xcf)]['dbOther'],_0x418cb3),_0x35fa59=dbFileShare[_0x5350bb(0xb8)](_0x45f0af[_0x5350bb(0xcf)][_0x5350bb(0xa1)],_0x418cb3,_0x5350bb(0xb3));if(_0x35fa59)return _0x45f0af[_0x5350bb(0xcf)]['returnErrMsg'](_0x5a1863,_0x5a1863['__'](_0x5350bb(0xb4))+':'+_0x8b3368[_0x5350bb(0xb9)]);}let _0x64a1e4={'path':_0x13cb7a,'path_sign':_0x4d76ba,'server_type':_0x943902};if(_0x27a127==_0x5350bb(0xce)){let _0x4cdb3e=dbFileShare[_0x5350bb(0xce)](_0x45f0af[_0x5350bb(0xcf)][_0x5350bb(0xa1)],_0x64a1e4),_0x1d6cdd=_0x4cdb3e[_0x5350bb(0xc6)];for(let _0x530003 in _0x321b4c){dbFileShare[_0x5350bb(0x97)](_0x45f0af['app'][_0x5350bb(0xa1)],_0x1d6cdd,_0x321b4c[_0x530003]['id']);}}else{if(_0x27a127==_0x5350bb(0xd2)){let _0xf8fbdb=_0x45f0af[_0x5350bb(0xc0)]['id'];dbFileShare[_0x5350bb(0xd2)](_0x45f0af[_0x5350bb(0xcf)][_0x5350bb(0xa1)],_0x64a1e4,_0xf8fbdb),dbFileShare[_0x5350bb(0xdd)](_0x45f0af[_0x5350bb(0xcf)][_0x5350bb(0xa1)],_0xf8fbdb);for(let _0x32ece6 in _0x321b4c){dbFileShare['createShareUser'](_0x45f0af['app'][_0x5350bb(0xa1)],_0xf8fbdb,_0x321b4c[_0x32ece6]['id']);}}}return process['send']({'type':_0x5350bb(0xa5),'shareType':_0x943902}),_0x5a1863[_0x5350bb(0xaa)]({'code':0x0});}else return _0x45f0af[_0x5350bb(0xcf)][_0x5350bb(0xab)](_0x5a1863,_0x5350bb(0xae));});});}),router[_0x4c6a08(0xc8)](_0x4c6a08(0xd9),(_0x523bac,_0xcd421a,_0x389aa3)=>{const _0x4609dd=_0x4c6a08;if(_0x523bac[_0x4609dd(0xd5)][_0x4609dd(0x98)]!=0x1)return _0xcd421a[_0x4609dd(0xaa)]({'code':0x66});let _0x2acc16=_0x523bac['body']['id'],_0x2f1b4f=dbFileShare[_0x4609dd(0xa9)](_0x523bac[_0x4609dd(0xcf)][_0x4609dd(0xa1)],_0x2acc16);dbFileShare['delete'](_0x523bac[_0x4609dd(0xcf)][_0x4609dd(0xa1)],_0x2acc16),process[_0x4609dd(0xb5)]({'type':'fileShareRestart','shareType':_0x2f1b4f[_0x4609dd(0xa3)]}),_0xcd421a[_0x4609dd(0xaa)]({'code':0x0});}),router[_0x4c6a08(0xc8)]('/getAll',(_0x33fa2b,_0xb3a155,_0xee0c1)=>{const _0x1b1203=_0x4c6a08;if(_0x33fa2b[_0x1b1203(0xd5)][_0x1b1203(0x98)]!=0x1)return _0xb3a155[_0x1b1203(0xaa)]({'code':0x66});let _0x2d7268=_0x33fa2b[_0x1b1203(0xc0)][_0x1b1203(0xd1)],_0x1f3b1b=dbFileShare[_0x1b1203(0x99)](_0x33fa2b['app'][_0x1b1203(0xa1)],'server_type=?\x20order\x20by\x20id\x20desc',[_0x2d7268]);for(let _0x397980 in _0x1f3b1b){let _0x512c87=_0x1f3b1b[_0x397980],_0x547c1f=dbFileShare[_0x1b1203(0xbb)](_0x33fa2b[_0x1b1203(0xcf)][_0x1b1203(0xa1)],_0x512c87['id']),_0x5a6652='(';for(let _0x5c0a89 in _0x547c1f){_0x5a6652+=_0x547c1f[_0x5c0a89][_0x1b1203(0xd6)],_0x5c0a89!=_0x547c1f[_0x1b1203(0xd0)]-0x1&&(_0x5a6652+=',');}_0x5a6652+=')';let _0x5c0ad3=dbUserTable[_0x1b1203(0x99)](_0x33fa2b[_0x1b1203(0xcf)][_0x1b1203(0xa1)],_0x1b1203(0x9f)+_0x5a6652+'\x20',_0x1b1203(0xba));_0x1f3b1b[_0x397980][_0x1b1203(0x9b)]=_0x5c0ad3;}let _0xa2d9fd={'code':0x0,'data':_0x1f3b1b},_0x442f98='',_0x55edf8='',_0x3d374a='';try{let _0x18b225=dbConfigTable[_0x1b1203(0xcb)](_0x33fa2b[_0x1b1203(0xcf)]['dbOther'],_0x1b1203(0xb2)),_0x3caaf3=dbConfigTable[_0x1b1203(0xcb)](_0x33fa2b[_0x1b1203(0xcf)][_0x1b1203(0xa1)],'webDavHttpsServer'),_0x467731=dbConfigTable['findByTitle'](_0x33fa2b['app']['dbOther'],'FTPServer'),_0x1238a5=dbConfigTable[_0x1b1203(0xcb)](_0x33fa2b[_0x1b1203(0xcf)][_0x1b1203(0xa1)],_0x1b1203(0xb7));if(_0x1238a5){_0x1238a5=JSON[_0x1b1203(0xdb)](_0x1238a5['value']);for(let _0x35d1a3 of _0x1238a5){if(_0x35d1a3[_0x1b1203(0x9c)]==_0x1b1203(0xc9)){_0x442f98=_0x1b1203(0xca)+_0x35d1a3['ip'],_0x55edf8=_0x1b1203(0xbd)+_0x35d1a3['ip'],_0x3d374a=_0x1b1203(0xad)+_0x35d1a3['ip'];break;}}}_0x18b225&&(_0x18b225=JSON['parse'](_0x18b225['value']),_0x442f98+=':'+_0x18b225[_0x1b1203(0xd4)],_0xa2d9fd[_0x1b1203(0xda)]=_0x442f98),_0x3caaf3&&(_0x3caaf3=JSON['parse'](_0x3caaf3[_0x1b1203(0xbf)]),_0x55edf8+=':'+_0x3caaf3[_0x1b1203(0xd4)],_0xa2d9fd[_0x1b1203(0xc5)]=_0x55edf8),_0x467731&&(_0x467731=JSON[_0x1b1203(0xdb)](_0x467731['value']),_0x3d374a+=':'+_0x467731[_0x1b1203(0xd4)],_0xa2d9fd[_0x1b1203(0x9d)]=_0x3d374a);}catch(_0x2f2125){console[_0x1b1203(0x9e)](_0x2f2125);}_0xb3a155[_0x1b1203(0xaa)](_0xa2d9fd);}),router['post'](_0x4c6a08(0xa2),(_0x1f2f60,_0xe39f76,_0x46770e)=>{const _0x5b3f99=_0x4c6a08;if(_0x1f2f60[_0x5b3f99(0xd5)][_0x5b3f99(0x98)]!=0x1)return _0xe39f76[_0x5b3f99(0xaa)]({'code':0x66});let _0x4fc936=_0x1f2f60[_0x5b3f99(0xc0)]['id'],_0x62abbc=dbFileShare[_0x5b3f99(0xa9)](_0x1f2f60[_0x5b3f99(0xcf)][_0x5b3f99(0xa1)],_0x4fc936),_0x468488=dbFileShare[_0x5b3f99(0xbb)](_0x1f2f60[_0x5b3f99(0xcf)]['dbOther'],_0x62abbc['id']),_0x11a3a2='(';for(let _0x30ff04 in _0x468488){_0x11a3a2+=_0x468488[_0x30ff04]['user_id'],_0x30ff04!=_0x468488['length']-0x1&&(_0x11a3a2+=',');}_0x11a3a2+=')';let _0x2b3018=dbUserTable[_0x5b3f99(0x99)](_0x1f2f60[_0x5b3f99(0xcf)]['dbOther'],_0x5b3f99(0x9f)+_0x11a3a2+'\x20',_0x5b3f99(0xba));_0x62abbc[_0x5b3f99(0x9b)]=_0x2b3018,_0xe39f76[_0x5b3f99(0xaa)]({'code':0x0,'data':_0x62abbc});}),module[_0x4c6a08(0xa8)]=router;