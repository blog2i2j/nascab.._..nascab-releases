const _0x418b8a=_0x42b2;(function(_0x3be2c0,_0x88094a){const _0x17bc98=_0x42b2,_0x14029d=_0x3be2c0();while(!![]){try{const _0x5bc826=parseInt(_0x17bc98(0x23e))/0x1+parseInt(_0x17bc98(0x248))/0x2*(-parseInt(_0x17bc98(0x21e))/0x3)+parseInt(_0x17bc98(0x22e))/0x4*(-parseInt(_0x17bc98(0x24e))/0x5)+-parseInt(_0x17bc98(0x233))/0x6*(-parseInt(_0x17bc98(0x221))/0x7)+-parseInt(_0x17bc98(0x240))/0x8*(parseInt(_0x17bc98(0x22f))/0x9)+parseInt(_0x17bc98(0x21f))/0xa+parseInt(_0x17bc98(0x23f))/0xb*(-parseInt(_0x17bc98(0x251))/0xc);if(_0x5bc826===_0x88094a)break;else _0x14029d['push'](_0x14029d['shift']());}catch(_0x5c4a93){_0x14029d['push'](_0x14029d['shift']());}}}(_0x18d7,0x82cb7));var express=require('express'),router=express[_0x418b8a(0x255)]();const url=require(_0x418b8a(0x227));let path=require(_0x418b8a(0x1f8));const dbDownloadTasksTable=require(_0x418b8a(0x1fe)),dbUserTable=require('../../db/dbUserTable');function _0x18d7(){const _0x454eee=['task_file_list','../../db/dbDownloadTasksTable','ADD','app','protocol','download','existsSync','https:','httpUrl','selected','parse','log','/getTaskList','deleteTask','/addDownloadTask','send','needValidUrl','downloadTaskChange','R_OK','TYPE_MAGNET','needValidMagnetUrl','power_get','/getTaskDetail','operation','json','lastIndexOf','DELETE_ALL','torrent','http:','taskId','http_url','ERROR\x20OPERATION','getTaskList','7194PMDzNy','5879780sMKbJC','stringify','49oDEOqT','includes','count','RESTART','TYPE_TORRENT','lastInsertRowid','url','TASK\x20TYPE\x20ERROR','PAUSE','startsWith','orderType','power_delete','STATE_PARSING','87976jFidlu','2441250BUKyzS','currentUser','START','doUserCanGet','809706XctqkX','taskType','length','orderField','fileList','TYPE_HTTP','torrentName','returnErrMsg','STATE_WAITING','exports','name','700828pCIxVt','33VtOpkF','8iezMaz','torrentPath','/pauseTask','DELETE','body','split','dbOther','getDownloadingTaskByWhere','178yIwfsW','access','W_OK','join','magnet','total_size','240XZeniJ','NEED\x20SAVE\x20PATH','/operationAllTask','629376yxGcSx','constants','getTaskById','noWritePermission','Router','savePath','updateTaskField','push','torrent_path','post','path','power_change','addTask','/selectTaskFile','deleteAllTaskByState'];_0x18d7=function(){return _0x454eee;};return _0x18d7();}var fs=require('fs');let config=require('../../myConfig/config');function _0x42b2(_0x47a29b,_0x452787){const _0x18d7f=_0x18d7();return _0x42b2=function(_0x42b256,_0x20d343){_0x42b256=_0x42b256-0x1f3;let _0x1a3929=_0x18d7f[_0x42b256];return _0x1a3929;},_0x42b2(_0x47a29b,_0x452787);}function isValidUrl(_0x300e93){const _0x11e5be=_0x418b8a;try{const _0x57a972=url['parse'](_0x300e93,!![],!![]);return _0x57a972['protocol']===_0x11e5be(0x219)||_0x57a972[_0x11e5be(0x201)]===_0x11e5be(0x204);}catch(_0x3cc6a5){return![];}}function isValidMagnetLink(_0x4f8be8){const _0x97fb03=_0x418b8a;return _0x4f8be8[_0x97fb03(0x22a)]('magnet:?');}router['post'](_0x418b8a(0x20b),(_0xeb6f1e,_0x48188c,_0x2fa072)=>{const _0x2c8b6b=_0x418b8a;let _0x4d7750=_0xeb6f1e[_0x2c8b6b(0x244)][_0x2c8b6b(0x234)],_0x12bcc1=_0xeb6f1e['body'][_0x2c8b6b(0x205)],_0x14b2dd=_0xeb6f1e[_0x2c8b6b(0x244)][_0x2c8b6b(0x24c)],_0x5ae95a=_0xeb6f1e[_0x2c8b6b(0x244)][_0x2c8b6b(0x239)],_0x1e2457=_0xeb6f1e[_0x2c8b6b(0x244)][_0x2c8b6b(0x1f3)],_0x3dec44=dbDownloadTasksTable[_0x2c8b6b(0x23b)];if(!_0x4d7750||![dbDownloadTasksTable[_0x2c8b6b(0x238)],dbDownloadTasksTable[_0x2c8b6b(0x210)],dbDownloadTasksTable[_0x2c8b6b(0x225)]]['includes'](_0x4d7750))return _0xeb6f1e[_0x2c8b6b(0x200)][_0x2c8b6b(0x23a)](_0x48188c,_0x2c8b6b(0x228));if(dbUserTable[_0x2c8b6b(0x232)](_0xeb6f1e,_0x48188c,_0x2c8b6b(0x202),'power_add','')==!![]){if(_0x4d7750==dbDownloadTasksTable['TYPE_HTTP']){if(!_0x12bcc1)return _0xeb6f1e[_0x2c8b6b(0x200)][_0x2c8b6b(0x23a)](_0x48188c,_0x48188c['__'](_0x2c8b6b(0x20d)));_0x12bcc1=_0x12bcc1['split']('\x0a');}else{if(_0x4d7750==dbDownloadTasksTable[_0x2c8b6b(0x210)]){if(!_0x14b2dd||!isValidMagnetLink(_0x14b2dd))return _0xeb6f1e[_0x2c8b6b(0x200)][_0x2c8b6b(0x23a)](_0x48188c,_0x48188c['__'](_0x2c8b6b(0x211)));_0x3dec44=dbDownloadTasksTable[_0x2c8b6b(0x22d)],_0x14b2dd=_0x14b2dd[_0x2c8b6b(0x245)]('\x0a');}else _0x4d7750==dbDownloadTasksTable['TYPE_TORRENT']&&(_0x3dec44=dbDownloadTasksTable[_0x2c8b6b(0x22d)]);}if(!_0x1e2457&&_0x4d7750==dbDownloadTasksTable['TYPE_HTTP'])return _0xeb6f1e['app']['returnErrMsg'](_0x48188c,_0x2c8b6b(0x24f));let _0x3bd48e=[];_0x1e2457?fs['access'](_0x1e2457,fs['constants'][_0x2c8b6b(0x24a)]|fs[_0x2c8b6b(0x252)][_0x2c8b6b(0x20f)],_0x36fe1a=>{const _0x450e95=_0x2c8b6b;if(_0x36fe1a)return console[_0x450e95(0x208)](_0x36fe1a),_0xeb6f1e['app']['returnErrMsg'](_0x48188c,_0x48188c['__'](_0x450e95(0x254))+':'+_0x1e2457);_0x22f946();}):_0x22f946();function _0x22f946(){const _0x3861b9=_0x2c8b6b;let _0x486a56=[];if(_0x4d7750==dbDownloadTasksTable[_0x3861b9(0x238)]){for(let _0x1ec3e5 of _0x12bcc1){let _0x37572f=dbDownloadTasksTable[_0x3861b9(0x247)](_0xeb6f1e[_0x3861b9(0x200)][_0x3861b9(0x246)],[_0x3861b9(0x21b)],[_0x1ec3e5]);if(_0x37572f)return _0x48188c[_0x3861b9(0x215)]({'code':0x2,'data':_0x37572f});}for(let _0x1435b5 of _0x12bcc1){if(!_0x486a56['includes'](_0x1435b5)){if(isValidUrl(_0x1435b5)){let _0x434684=_0x1435b5['substring'](_0x1435b5[_0x3861b9(0x216)]('/')+0x1),_0x4db0a3=dbDownloadTasksTable['addTask'](_0xeb6f1e[_0x3861b9(0x200)]['dbOther'],_0xeb6f1e[_0x3861b9(0x230)]['id'],_0x434684,_0x4d7750,_0x3dec44,_0x1e2457,'',_0x1435b5);_0x486a56[_0x3861b9(0x1f5)](_0x1435b5),_0x4db0a3[_0x3861b9(0x226)]&&_0x3bd48e[_0x3861b9(0x1f5)](_0x4db0a3[_0x3861b9(0x226)]);}}}}else{if(_0x4d7750==dbDownloadTasksTable[_0x3861b9(0x210)]){for(let _0x876db4 of _0x14b2dd){let _0x2629af=dbDownloadTasksTable['getDownloadingTaskByWhere'](_0xeb6f1e[_0x3861b9(0x200)][_0x3861b9(0x246)],[_0x3861b9(0x24c)],[_0x876db4]);if(_0x2629af)return _0x48188c[_0x3861b9(0x215)]({'code':0x2,'data':_0x2629af});}for(let _0x43f162 of _0x14b2dd){if(!_0x486a56[_0x3861b9(0x222)](_0x43f162)){if(isValidMagnetLink(_0x43f162)){let _0x307bb0=dbDownloadTasksTable[_0x3861b9(0x1fa)](_0xeb6f1e[_0x3861b9(0x200)]['dbOther'],_0xeb6f1e[_0x3861b9(0x230)]['id'],_0x43f162,_0x4d7750,_0x3dec44,_0x1e2457,_0x43f162);_0x486a56[_0x3861b9(0x1f5)](_0x43f162),_0x307bb0[_0x3861b9(0x226)]&&_0x3bd48e[_0x3861b9(0x1f5)](_0x307bb0[_0x3861b9(0x226)]);}}}}else{if(_0x5ae95a&&_0x4d7750==dbDownloadTasksTable[_0x3861b9(0x225)]){for(let _0x4ff05d of _0x5ae95a){let _0x25648c=dbDownloadTasksTable[_0x3861b9(0x247)](_0xeb6f1e[_0x3861b9(0x200)][_0x3861b9(0x246)],[_0x3861b9(0x1f6)],[_0x4ff05d]);if(_0x25648c)return _0x48188c['json']({'code':0x2,'data':_0x25648c});}for(let _0x55bec1 of _0x5ae95a){console[_0x3861b9(0x208)](_0x3861b9(0x218),_0x55bec1);if(!_0x486a56[_0x3861b9(0x222)](_0x55bec1)){if(_0x55bec1&&fs[_0x3861b9(0x203)](path[_0x3861b9(0x24b)](config[_0x3861b9(0x241)],_0x55bec1))){let _0x2700d2=dbDownloadTasksTable[_0x3861b9(0x1fa)](_0xeb6f1e[_0x3861b9(0x200)][_0x3861b9(0x246)],_0xeb6f1e['currentUser']['id'],_0x55bec1,_0x4d7750,_0x3dec44,_0x1e2457,'','',_0x55bec1);_0x486a56[_0x3861b9(0x1f5)](_0x55bec1),_0x2700d2['lastInsertRowid']&&_0x3bd48e[_0x3861b9(0x1f5)](_0x2700d2[_0x3861b9(0x226)]);}}}}}}let _0x43f247=[];for(let _0x5e8160 of _0x3bd48e){let _0x28a142=dbDownloadTasksTable['getTaskById'](_0xeb6f1e[_0x3861b9(0x200)][_0x3861b9(0x246)],_0x5e8160);_0x28a142&&_0x43f247[_0x3861b9(0x1f5)](_0x28a142);}return process[_0x3861b9(0x20c)]({'type':'downloadTaskChange','operation':_0x3861b9(0x1ff),'taskObjList':_0x43f247}),_0x48188c[_0x3861b9(0x215)]({'code':0x0});}}}),router['post'](_0x418b8a(0x242),(_0x7de44d,_0x47d83d,_0xee7f42)=>{const _0x336650=_0x418b8a;let _0x1ea757=_0x7de44d[_0x336650(0x244)][_0x336650(0x21a)];if(dbUserTable[_0x336650(0x232)](_0x7de44d,_0x47d83d,_0x336650(0x202),_0x336650(0x1f9),'')==!![]){let _0x313201=dbDownloadTasksTable['getTaskById'](_0x7de44d[_0x336650(0x200)][_0x336650(0x246)],_0x1ea757);return process[_0x336650(0x20c)]({'type':_0x336650(0x20e),'operation':'PAUSE','taskObj':_0x313201}),_0x47d83d[_0x336650(0x215)]({'code':0x0});}}),router[_0x418b8a(0x1f7)]('/startTask',(_0x532c1c,_0x4c7660,_0x3d929c)=>{const _0x2f1471=_0x418b8a;let _0x4e4995=_0x532c1c[_0x2f1471(0x244)][_0x2f1471(0x21a)];if(dbUserTable[_0x2f1471(0x232)](_0x532c1c,_0x4c7660,'download',_0x2f1471(0x1f9),'')==!![]){let _0xd9f531=dbDownloadTasksTable[_0x2f1471(0x253)](_0x532c1c[_0x2f1471(0x200)][_0x2f1471(0x246)],_0x4e4995);return process[_0x2f1471(0x20c)]({'type':_0x2f1471(0x20e),'operation':_0x2f1471(0x231),'taskObj':_0xd9f531}),_0x4c7660[_0x2f1471(0x215)]({'code':0x0});}}),router[_0x418b8a(0x1f7)](_0x418b8a(0x213),(_0x3d3a32,_0x2b0753,_0xaa487b)=>{const _0x172e11=_0x418b8a;let _0x2d26a5=_0x3d3a32[_0x172e11(0x244)][_0x172e11(0x21a)];if(dbUserTable['doUserCanGet'](_0x3d3a32,_0x2b0753,_0x172e11(0x202),_0x172e11(0x212),'')==!![]){let _0x34cdba=dbDownloadTasksTable['getTaskById'](_0x3d3a32[_0x172e11(0x200)][_0x172e11(0x246)],_0x2d26a5);return _0x2b0753[_0x172e11(0x215)]({'code':0x0,'data':_0x34cdba});}}),router['post']('/deleteTask',(_0x418960,_0x2e13f8,_0xfbf13c)=>{const _0x561605=_0x418b8a;let _0x10afd3=_0x418960[_0x561605(0x244)][_0x561605(0x21a)];if(dbUserTable[_0x561605(0x232)](_0x418960,_0x2e13f8,'download',_0x561605(0x22c),'')==!![]){let _0x30e174=dbDownloadTasksTable[_0x561605(0x253)](_0x418960[_0x561605(0x200)][_0x561605(0x246)],_0x10afd3);return dbDownloadTasksTable[_0x561605(0x20a)](_0x418960[_0x561605(0x200)][_0x561605(0x246)],_0x10afd3),process[_0x561605(0x20c)]({'type':'downloadTaskChange','operation':_0x561605(0x243),'taskObj':_0x30e174}),_0x2e13f8['json']({'code':0x0});}}),router[_0x418b8a(0x1f7)](_0x418b8a(0x1fb),(_0x4149d3,_0x2c5385,_0x309abd)=>{const _0x2800aa=_0x418b8a;let _0x31d823=_0x4149d3[_0x2800aa(0x244)][_0x2800aa(0x21a)],_0x38cd32=_0x4149d3[_0x2800aa(0x244)][_0x2800aa(0x237)],_0x3d9bb7=_0x4149d3['body'][_0x2800aa(0x1f3)];console[_0x2800aa(0x208)]('selectTaskFile',_0x38cd32);if(dbUserTable[_0x2800aa(0x232)](_0x4149d3,_0x2c5385,_0x2800aa(0x202),'power_delete','')==!![]){if(!_0x3d9bb7)return _0x4149d3[_0x2800aa(0x200)]['returnErrMsg'](_0x2c5385,_0x2800aa(0x24f));fs[_0x2800aa(0x249)](_0x3d9bb7,fs[_0x2800aa(0x252)][_0x2800aa(0x24a)]|fs[_0x2800aa(0x252)][_0x2800aa(0x20f)],_0x4296dc=>{const _0x23f802=_0x2800aa;if(_0x4296dc)return console[_0x23f802(0x208)](_0x4296dc),_0x4149d3[_0x23f802(0x200)][_0x23f802(0x23a)](_0x2c5385,_0x2c5385['__'](_0x23f802(0x254))+':'+_0x3d9bb7);let _0x5a4927=dbDownloadTasksTable[_0x23f802(0x253)](_0x4149d3['app'][_0x23f802(0x246)],_0x31d823);if(!_0x5a4927)return _0x4149d3[_0x23f802(0x200)][_0x23f802(0x23a)](_0x2c5385,'Task\x20not\x20found');let _0x38068a=[];if(_0x5a4927['task_file_list'])try{_0x38068a=JSON[_0x23f802(0x207)](_0x5a4927[_0x23f802(0x1fd)]);}catch(_0x3b5b65){console[_0x23f802(0x208)](_0x3b5b65);}let _0x16bba3=0x0;for(let _0x2089b4 of _0x38068a){for(let _0x4c5095 of _0x38cd32){_0x4c5095[_0x23f802(0x23d)]==_0x2089b4[_0x23f802(0x23d)]&&_0x4c5095[_0x23f802(0x1f8)]==_0x2089b4[_0x23f802(0x1f8)]&&(_0x2089b4[_0x23f802(0x206)]=0x1,_0x16bba3+=_0x2089b4[_0x23f802(0x235)]);}}return dbDownloadTasksTable['updateTaskField'](_0x4149d3[_0x23f802(0x200)][_0x23f802(0x246)],_0x31d823,'save_path',path[_0x23f802(0x24b)](_0x3d9bb7)),dbDownloadTasksTable[_0x23f802(0x1f4)](_0x4149d3[_0x23f802(0x200)]['dbOther'],_0x31d823,_0x23f802(0x1fd),JSON[_0x23f802(0x220)](_0x38068a)),dbDownloadTasksTable[_0x23f802(0x1f4)](_0x4149d3[_0x23f802(0x200)][_0x23f802(0x246)],_0x31d823,'task_state',dbDownloadTasksTable[_0x23f802(0x23b)]),dbDownloadTasksTable[_0x23f802(0x1f4)](_0x4149d3['app'][_0x23f802(0x246)],_0x31d823,_0x23f802(0x24d),_0x16bba3),_0x5a4927=dbDownloadTasksTable[_0x23f802(0x253)](_0x4149d3[_0x23f802(0x200)][_0x23f802(0x246)],_0x31d823),process[_0x23f802(0x20c)]({'type':_0x23f802(0x20e),'operation':_0x23f802(0x231),'taskObj':_0x5a4927}),_0x2c5385[_0x23f802(0x215)]({'code':0x0,'fileList':_0x38cd32});});}}),router[_0x418b8a(0x1f7)](_0x418b8a(0x250),(_0x3fed33,_0x4a719e,_0x1624eb)=>{const _0x54ec7f=_0x418b8a;let _0x457ea3=['PAUSE_ALL','START_ALL',_0x54ec7f(0x217)],_0x5a4cd2=_0x3fed33['body']['operation'];if(!_0x457ea3[_0x54ec7f(0x222)](_0x5a4cd2))return _0x3fed33[_0x54ec7f(0x200)][_0x54ec7f(0x23a)](_0x4a719e,_0x54ec7f(0x21c));if(dbUserTable['doUserCanGet'](_0x3fed33,_0x4a719e,_0x54ec7f(0x202),'power_change','')==!![]){if(_0x5a4cd2==_0x54ec7f(0x217)){let _0x560e46=_0x3fed33[_0x54ec7f(0x244)]['taskState'];if(!_0x560e46)return _0x3fed33['app'][_0x54ec7f(0x23a)](_0x4a719e,'ERROR\x20DELETE\x20TASK\x20STATE');dbDownloadTasksTable[_0x54ec7f(0x1fc)](_0x3fed33[_0x54ec7f(0x200)][_0x54ec7f(0x246)],_0x560e46);}return process[_0x54ec7f(0x20c)]({'type':_0x54ec7f(0x20e),'operation':_0x5a4cd2}),_0x4a719e['json']({'code':0x0});}}),router[_0x418b8a(0x1f7)]('/operationTask',(_0xfae73e,_0x2c92a2,_0x56e568)=>{const _0x4857f8=_0x418b8a;let _0x48169c=_0xfae73e[_0x4857f8(0x244)]['taskId'],_0x1808fa=[_0x4857f8(0x229),_0x4857f8(0x231),_0x4857f8(0x224)],_0x279693=_0xfae73e[_0x4857f8(0x244)][_0x4857f8(0x214)];if(!_0x1808fa['includes'](_0x279693))return _0xfae73e[_0x4857f8(0x200)][_0x4857f8(0x23a)](_0x2c92a2,_0x4857f8(0x21c));if(dbUserTable[_0x4857f8(0x232)](_0xfae73e,_0x2c92a2,_0x4857f8(0x202),_0x4857f8(0x1f9),'')==!![]){let _0x2e43be=dbDownloadTasksTable[_0x4857f8(0x253)](_0xfae73e[_0x4857f8(0x200)][_0x4857f8(0x246)],_0x48169c);return process[_0x4857f8(0x20c)]({'type':_0x4857f8(0x20e),'operation':_0x279693,'taskObj':_0x2e43be}),_0x2c92a2[_0x4857f8(0x215)]({'code':0x0});}}),router[_0x418b8a(0x1f7)](_0x418b8a(0x209),(_0x4a7ec4,_0x5b72ec,_0x537343)=>{const _0x1dd9c5=_0x418b8a;let _0x5c3bc1=_0x4a7ec4[_0x1dd9c5(0x244)]['offset'],_0x184c11=_0x4a7ec4[_0x1dd9c5(0x244)][_0x1dd9c5(0x223)],_0x262249=_0x4a7ec4[_0x1dd9c5(0x244)][_0x1dd9c5(0x236)],_0x45c3e7=_0x4a7ec4[_0x1dd9c5(0x244)][_0x1dd9c5(0x22b)],_0x4436a0=_0x4a7ec4[_0x1dd9c5(0x244)]['taskState'];if(dbUserTable['doUserCanGet'](_0x4a7ec4,_0x5b72ec,_0x1dd9c5(0x202),'power_get','')==!![]){let _0x48782c=dbDownloadTasksTable[_0x1dd9c5(0x21d)](_0x4a7ec4['app'][_0x1dd9c5(0x246)],null,_0x184c11,_0x5c3bc1,_0x262249,_0x45c3e7,_0x4436a0);return _0x5b72ec['json']({'code':0x0,'data':_0x48782c});}}),module[_0x418b8a(0x23c)]=router;