const _0x2d68a3=_0xd051;(function(_0x1aa065,_0x18166d){const _0xe8e427=_0xd051,_0x11f6d5=_0x1aa065();while(!![]){try{const _0x206a3f=parseInt(_0xe8e427(0x10f))/0x1+-parseInt(_0xe8e427(0xf8))/0x2*(-parseInt(_0xe8e427(0x12c))/0x3)+-parseInt(_0xe8e427(0x13d))/0x4*(-parseInt(_0xe8e427(0x139))/0x5)+-parseInt(_0xe8e427(0xe6))/0x6+parseInt(_0xe8e427(0x11a))/0x7+-parseInt(_0xe8e427(0x131))/0x8*(-parseInt(_0xe8e427(0x133))/0x9)+-parseInt(_0xe8e427(0xeb))/0xa;if(_0x206a3f===_0x18166d)break;else _0x11f6d5['push'](_0x11f6d5['shift']());}catch(_0x2dbad8){_0x11f6d5['push'](_0x11f6d5['shift']());}}}(_0x2cd4,0x90510));var express=require(_0x2d68a3(0x110)),router=express['Router']();const url=require('url');let path=require('path');const dbDownloadTasksTable=require(_0x2d68a3(0x109)),dbUserTable=require(_0x2d68a3(0x130));function _0x2cd4(){const _0x188b19=['magnet:?','START','/deleteTask','972898DygIYB','access','parse','TYPE_MAGNET','power_get','taskType','noWritePermission','needValidUrl','/selectTaskFile','torrentPath','selected','downloadTaskChange','substring','log','START_ALL','magnet','/getTaskList','../../db/dbDownloadTasksTable','protocol','fileList','existsSync','/operationTask','httpUrl','493618SSdReu','express','app','power_delete','/pauseTask','operation','Task\x20not\x20found','doUserCanGet','download','includes','W_OK','1388849SEKqbT','length','push','ERROR\x20DELETE\x20TASK\x20STATE','TYPE_TORRENT','body','total_size','updateTaskField','post','savePath','DELETE_ALL','R_OK','ERROR\x20OPERATION','STATE_WAITING','join','orderField','NEED\x20SAVE\x20PATH','PAUSE_ALL','6hkZASi','/startTask','path','power_change','../../db/dbUserTable','2336168owwvZA','exports','27QwEyTl','currentUser','torrent_path','ADD','dbOther','http_url','1791575rRFrDG','constants','lastInsertRowid','PAUSE','8wDWgES','deleteTask','RESTART','name','task_file_list','selectTaskFile','TYPE_HTTP','TASK\x20TYPE\x20ERROR','orderType','/addDownloadTask','taskId','STATE_PARSING','returnErrMsg','2673588ekwXbI','split','addTask','getDownloadingTaskByWhere','send','22208980nGJjwa','getTaskById','taskState','http:','power_add','/operationAllTask','deleteAllTaskByState','startsWith','torrentName','json'];_0x2cd4=function(){return _0x188b19;};return _0x2cd4();}var fs=require('fs');let config=require('../../myConfig/config');function isValidUrl(_0x4dc088){const _0x10a146=_0x2d68a3;try{const _0x26ea61=url[_0x10a146(0xfa)](_0x4dc088,!![],!![]);return _0x26ea61[_0x10a146(0x10a)]===_0x10a146(0xee)||_0x26ea61[_0x10a146(0x10a)]==='https:';}catch(_0x52bae5){return![];}}function isValidMagnetLink(_0x195ef2){const _0x478003=_0x2d68a3;return _0x195ef2[_0x478003(0xf2)](_0x478003(0xf5));}function _0xd051(_0x944291,_0x510268){const _0x2cd403=_0x2cd4();return _0xd051=function(_0xd0514e,_0xfc2142){_0xd0514e=_0xd0514e-0xdc;let _0x576d3d=_0x2cd403[_0xd0514e];return _0x576d3d;},_0xd051(_0x944291,_0x510268);}router['post'](_0x2d68a3(0xe2),(_0x3310ce,_0x19fc25,_0x492835)=>{const _0xef5de8=_0x2d68a3;let _0x2c4dc0=_0x3310ce['body'][_0xef5de8(0xfd)],_0x37361a=_0x3310ce[_0xef5de8(0x11f)][_0xef5de8(0x10e)],_0x1fe075=_0x3310ce['body'][_0xef5de8(0x107)],_0x5617e3=_0x3310ce[_0xef5de8(0x11f)][_0xef5de8(0xf3)],_0x653ac7=_0x3310ce[_0xef5de8(0x11f)][_0xef5de8(0x123)],_0x455eef=dbDownloadTasksTable[_0xef5de8(0x127)];if(!_0x2c4dc0||![dbDownloadTasksTable[_0xef5de8(0xdf)],dbDownloadTasksTable[_0xef5de8(0xfb)],dbDownloadTasksTable[_0xef5de8(0x11e)]]['includes'](_0x2c4dc0))return _0x3310ce['app']['returnErrMsg'](_0x19fc25,_0xef5de8(0xe0));if(dbUserTable['doUserCanGet'](_0x3310ce,_0x19fc25,_0xef5de8(0x117),_0xef5de8(0xef),'')==!![]){if(_0x2c4dc0==dbDownloadTasksTable[_0xef5de8(0xdf)]){if(!_0x37361a)return _0x3310ce[_0xef5de8(0x111)][_0xef5de8(0xe5)](_0x19fc25,_0x19fc25['__'](_0xef5de8(0xff)));_0x37361a=_0x37361a['split']('\x0a');}else{if(_0x2c4dc0==dbDownloadTasksTable[_0xef5de8(0xfb)]){if(!_0x1fe075||!isValidMagnetLink(_0x1fe075))return _0x3310ce[_0xef5de8(0x111)]['returnErrMsg'](_0x19fc25,_0x19fc25['__']('needValidMagnetUrl'));_0x455eef=dbDownloadTasksTable[_0xef5de8(0xe4)],_0x1fe075=_0x1fe075[_0xef5de8(0xe7)]('\x0a');}else _0x2c4dc0==dbDownloadTasksTable['TYPE_TORRENT']&&(_0x455eef=dbDownloadTasksTable[_0xef5de8(0xe4)]);}if(!_0x653ac7&&_0x2c4dc0==dbDownloadTasksTable['TYPE_HTTP'])return _0x3310ce[_0xef5de8(0x111)][_0xef5de8(0xe5)](_0x19fc25,_0xef5de8(0x12a));let _0x3aa525=[];_0x653ac7?fs[_0xef5de8(0xf9)](_0x653ac7,fs[_0xef5de8(0x13a)][_0xef5de8(0x119)]|fs[_0xef5de8(0x13a)][_0xef5de8(0x125)],_0x2dbaa3=>{const _0x23465c=_0xef5de8;if(_0x2dbaa3)return console[_0x23465c(0x105)](_0x2dbaa3),_0x3310ce[_0x23465c(0x111)][_0x23465c(0xe5)](_0x19fc25,_0x19fc25['__'](_0x23465c(0xfe))+':'+_0x653ac7);_0x312ee1();}):_0x312ee1();function _0x312ee1(){const _0x59b2d0=_0xef5de8;let _0x1237a0=[];if(_0x2c4dc0==dbDownloadTasksTable['TYPE_HTTP']){for(let _0x1e0920 of _0x37361a){let _0x47f7ae=dbDownloadTasksTable[_0x59b2d0(0xe9)](_0x3310ce['app'][_0x59b2d0(0x137)],[_0x59b2d0(0x138)],[_0x1e0920]);if(_0x47f7ae)return _0x19fc25[_0x59b2d0(0xf4)]({'code':0x2,'data':_0x47f7ae});}for(let _0x27660f of _0x37361a){if(!_0x1237a0[_0x59b2d0(0x118)](_0x27660f)){if(isValidUrl(_0x27660f)){let _0x1e1398=_0x27660f[_0x59b2d0(0x104)](_0x27660f['lastIndexOf']('/')+0x1),_0x3e587d=dbDownloadTasksTable['addTask'](_0x3310ce[_0x59b2d0(0x111)][_0x59b2d0(0x137)],_0x3310ce[_0x59b2d0(0x134)]['id'],_0x1e1398,_0x2c4dc0,_0x455eef,_0x653ac7,'',_0x27660f);_0x1237a0[_0x59b2d0(0x11c)](_0x27660f),_0x3e587d[_0x59b2d0(0x13b)]&&_0x3aa525[_0x59b2d0(0x11c)](_0x3e587d[_0x59b2d0(0x13b)]);}}}}else{if(_0x2c4dc0==dbDownloadTasksTable[_0x59b2d0(0xfb)]){for(let _0x1f898b of _0x1fe075){let _0x5f083c=dbDownloadTasksTable[_0x59b2d0(0xe9)](_0x3310ce[_0x59b2d0(0x111)][_0x59b2d0(0x137)],[_0x59b2d0(0x107)],[_0x1f898b]);if(_0x5f083c)return _0x19fc25['json']({'code':0x2,'data':_0x5f083c});}for(let _0xec2832 of _0x1fe075){if(!_0x1237a0['includes'](_0xec2832)){if(isValidMagnetLink(_0xec2832)){let _0x11b57e=dbDownloadTasksTable[_0x59b2d0(0xe8)](_0x3310ce[_0x59b2d0(0x111)][_0x59b2d0(0x137)],_0x3310ce['currentUser']['id'],_0xec2832,_0x2c4dc0,_0x455eef,_0x653ac7,_0xec2832);_0x1237a0['push'](_0xec2832),_0x11b57e[_0x59b2d0(0x13b)]&&_0x3aa525['push'](_0x11b57e[_0x59b2d0(0x13b)]);}}}}else{if(_0x5617e3&&_0x2c4dc0==dbDownloadTasksTable[_0x59b2d0(0x11e)]){for(let _0x35ef80 of _0x5617e3){let _0x4ca058=dbDownloadTasksTable['getDownloadingTaskByWhere'](_0x3310ce[_0x59b2d0(0x111)][_0x59b2d0(0x137)],[_0x59b2d0(0x135)],[_0x35ef80]);if(_0x4ca058)return _0x19fc25['json']({'code':0x2,'data':_0x4ca058});}for(let _0x1e7640 of _0x5617e3){console[_0x59b2d0(0x105)]('torrent',_0x1e7640);if(!_0x1237a0[_0x59b2d0(0x118)](_0x1e7640)){if(_0x1e7640&&fs[_0x59b2d0(0x10c)](path[_0x59b2d0(0x128)](config[_0x59b2d0(0x101)],_0x1e7640))){let _0x576904=dbDownloadTasksTable[_0x59b2d0(0xe8)](_0x3310ce[_0x59b2d0(0x111)][_0x59b2d0(0x137)],_0x3310ce[_0x59b2d0(0x134)]['id'],_0x1e7640,_0x2c4dc0,_0x455eef,_0x653ac7,'','',_0x1e7640);_0x1237a0[_0x59b2d0(0x11c)](_0x1e7640),_0x576904['lastInsertRowid']&&_0x3aa525[_0x59b2d0(0x11c)](_0x576904[_0x59b2d0(0x13b)]);}}}}}}let _0x29e025=[];for(let _0x4fa1e4 of _0x3aa525){let _0x4da3cf=dbDownloadTasksTable[_0x59b2d0(0xec)](_0x3310ce['app']['dbOther'],_0x4fa1e4);_0x4da3cf&&_0x29e025[_0x59b2d0(0x11c)](_0x4da3cf);}return process[_0x59b2d0(0xea)]({'type':'downloadTaskChange','operation':_0x59b2d0(0x136),'taskObjList':_0x29e025}),_0x19fc25[_0x59b2d0(0xf4)]({'code':0x0});}}}),router['post'](_0x2d68a3(0x113),(_0x2fcd27,_0x26ffa1,_0x1c17cf)=>{const _0xb9ce9b=_0x2d68a3;let _0x24c378=_0x2fcd27['body'][_0xb9ce9b(0xe3)];if(dbUserTable[_0xb9ce9b(0x116)](_0x2fcd27,_0x26ffa1,_0xb9ce9b(0x117),_0xb9ce9b(0x12f),'')==!![]){let _0x26b8f9=dbDownloadTasksTable[_0xb9ce9b(0xec)](_0x2fcd27[_0xb9ce9b(0x111)][_0xb9ce9b(0x137)],_0x24c378);return process['send']({'type':_0xb9ce9b(0x103),'operation':_0xb9ce9b(0x13c),'taskObj':_0x26b8f9}),_0x26ffa1[_0xb9ce9b(0xf4)]({'code':0x0});}}),router[_0x2d68a3(0x122)](_0x2d68a3(0x12d),(_0x1a344a,_0x74add8,_0x1b249b)=>{const _0x198727=_0x2d68a3;let _0x375092=_0x1a344a[_0x198727(0x11f)][_0x198727(0xe3)];if(dbUserTable[_0x198727(0x116)](_0x1a344a,_0x74add8,_0x198727(0x117),_0x198727(0x12f),'')==!![]){let _0x4eec48=dbDownloadTasksTable['getTaskById'](_0x1a344a[_0x198727(0x111)][_0x198727(0x137)],_0x375092);return process[_0x198727(0xea)]({'type':_0x198727(0x103),'operation':'START','taskObj':_0x4eec48}),_0x74add8[_0x198727(0xf4)]({'code':0x0});}}),router[_0x2d68a3(0x122)]('/getTaskDetail',(_0x4e9012,_0x1c080f,_0x21bb17)=>{const _0x1c40bb=_0x2d68a3;let _0x200410=_0x4e9012[_0x1c40bb(0x11f)][_0x1c40bb(0xe3)];if(dbUserTable[_0x1c40bb(0x116)](_0x4e9012,_0x1c080f,_0x1c40bb(0x117),_0x1c40bb(0xfc),'')==!![]){let _0x259364=dbDownloadTasksTable[_0x1c40bb(0xec)](_0x4e9012['app'][_0x1c40bb(0x137)],_0x200410);return _0x1c080f[_0x1c40bb(0xf4)]({'code':0x0,'data':_0x259364});}}),router[_0x2d68a3(0x122)](_0x2d68a3(0xf7),(_0x2be8bf,_0x1eb6c2,_0x459bbd)=>{const _0xed96f5=_0x2d68a3;let _0xe6b9ec=_0x2be8bf[_0xed96f5(0x11f)]['taskId'];if(dbUserTable[_0xed96f5(0x116)](_0x2be8bf,_0x1eb6c2,_0xed96f5(0x117),_0xed96f5(0x112),'')==!![]){let _0x833ca=dbDownloadTasksTable[_0xed96f5(0xec)](_0x2be8bf[_0xed96f5(0x111)]['dbOther'],_0xe6b9ec);return dbDownloadTasksTable[_0xed96f5(0x13e)](_0x2be8bf['app'][_0xed96f5(0x137)],_0xe6b9ec),process['send']({'type':_0xed96f5(0x103),'operation':'DELETE','taskObj':_0x833ca}),_0x1eb6c2[_0xed96f5(0xf4)]({'code':0x0});}}),router[_0x2d68a3(0x122)](_0x2d68a3(0x100),(_0x30f6fd,_0x4df4da,_0x3751ed)=>{const _0x1e29bb=_0x2d68a3;let _0x1e9ba2=_0x30f6fd[_0x1e29bb(0x11f)][_0x1e29bb(0xe3)],_0x2e6453=_0x30f6fd[_0x1e29bb(0x11f)][_0x1e29bb(0x10b)],_0x7af9d=_0x30f6fd[_0x1e29bb(0x11f)][_0x1e29bb(0x123)];console[_0x1e29bb(0x105)](_0x1e29bb(0xde),_0x2e6453);if(dbUserTable['doUserCanGet'](_0x30f6fd,_0x4df4da,_0x1e29bb(0x117),_0x1e29bb(0x112),'')==!![]){if(!_0x7af9d)return _0x30f6fd['app']['returnErrMsg'](_0x4df4da,_0x1e29bb(0x12a));fs['access'](_0x7af9d,fs[_0x1e29bb(0x13a)][_0x1e29bb(0x119)]|fs[_0x1e29bb(0x13a)][_0x1e29bb(0x125)],_0x47e47e=>{const _0x4622e4=_0x1e29bb;if(_0x47e47e)return console[_0x4622e4(0x105)](_0x47e47e),_0x30f6fd[_0x4622e4(0x111)][_0x4622e4(0xe5)](_0x4df4da,_0x4df4da['__'](_0x4622e4(0xfe))+':'+_0x7af9d);let _0x91d892=dbDownloadTasksTable[_0x4622e4(0xec)](_0x30f6fd[_0x4622e4(0x111)][_0x4622e4(0x137)],_0x1e9ba2);if(!_0x91d892)return _0x30f6fd[_0x4622e4(0x111)][_0x4622e4(0xe5)](_0x4df4da,_0x4622e4(0x115));let _0x5d76d8=[];if(_0x91d892[_0x4622e4(0xdd)])try{_0x5d76d8=JSON[_0x4622e4(0xfa)](_0x91d892[_0x4622e4(0xdd)]);}catch(_0x5aa14e){console[_0x4622e4(0x105)](_0x5aa14e);}let _0x358e25=0x0;for(let _0x5cad2d of _0x5d76d8){for(let _0x53a7cc of _0x2e6453){_0x53a7cc['name']==_0x5cad2d[_0x4622e4(0xdc)]&&_0x53a7cc[_0x4622e4(0x12e)]==_0x5cad2d[_0x4622e4(0x12e)]&&(_0x5cad2d[_0x4622e4(0x102)]=0x1,_0x358e25+=_0x5cad2d[_0x4622e4(0x11b)]);}}return dbDownloadTasksTable[_0x4622e4(0x121)](_0x30f6fd['app'][_0x4622e4(0x137)],_0x1e9ba2,'save_path',path[_0x4622e4(0x128)](_0x7af9d)),dbDownloadTasksTable[_0x4622e4(0x121)](_0x30f6fd[_0x4622e4(0x111)]['dbOther'],_0x1e9ba2,'task_file_list',JSON['stringify'](_0x5d76d8)),dbDownloadTasksTable[_0x4622e4(0x121)](_0x30f6fd[_0x4622e4(0x111)][_0x4622e4(0x137)],_0x1e9ba2,'task_state',dbDownloadTasksTable['STATE_WAITING']),dbDownloadTasksTable[_0x4622e4(0x121)](_0x30f6fd[_0x4622e4(0x111)]['dbOther'],_0x1e9ba2,_0x4622e4(0x120),_0x358e25),_0x91d892=dbDownloadTasksTable[_0x4622e4(0xec)](_0x30f6fd[_0x4622e4(0x111)]['dbOther'],_0x1e9ba2),process[_0x4622e4(0xea)]({'type':_0x4622e4(0x103),'operation':_0x4622e4(0xf6),'taskObj':_0x91d892}),_0x4df4da[_0x4622e4(0xf4)]({'code':0x0,'fileList':_0x2e6453});});}}),router[_0x2d68a3(0x122)](_0x2d68a3(0xf0),(_0x15b880,_0x7f5c24,_0x7b3eb0)=>{const _0x28a529=_0x2d68a3;let _0x5e4f6c=[_0x28a529(0x12b),_0x28a529(0x106),'DELETE_ALL'],_0x38ac20=_0x15b880[_0x28a529(0x11f)][_0x28a529(0x114)];if(!_0x5e4f6c[_0x28a529(0x118)](_0x38ac20))return _0x15b880['app'][_0x28a529(0xe5)](_0x7f5c24,_0x28a529(0x126));if(dbUserTable[_0x28a529(0x116)](_0x15b880,_0x7f5c24,'download',_0x28a529(0x12f),'')==!![]){if(_0x38ac20==_0x28a529(0x124)){let _0x2248ce=_0x15b880[_0x28a529(0x11f)][_0x28a529(0xed)];if(!_0x2248ce)return _0x15b880['app']['returnErrMsg'](_0x7f5c24,_0x28a529(0x11d));dbDownloadTasksTable[_0x28a529(0xf1)](_0x15b880['app']['dbOther'],_0x2248ce);}return process[_0x28a529(0xea)]({'type':'downloadTaskChange','operation':_0x38ac20}),_0x7f5c24['json']({'code':0x0});}}),router['post'](_0x2d68a3(0x10d),(_0x16639e,_0x591107,_0x22d54e)=>{const _0x2fd526=_0x2d68a3;let _0x4970b6=_0x16639e[_0x2fd526(0x11f)][_0x2fd526(0xe3)],_0x4fb000=[_0x2fd526(0x13c),_0x2fd526(0xf6),_0x2fd526(0x13f)],_0x3b1122=_0x16639e[_0x2fd526(0x11f)][_0x2fd526(0x114)];if(!_0x4fb000[_0x2fd526(0x118)](_0x3b1122))return _0x16639e[_0x2fd526(0x111)]['returnErrMsg'](_0x591107,_0x2fd526(0x126));if(dbUserTable[_0x2fd526(0x116)](_0x16639e,_0x591107,_0x2fd526(0x117),_0x2fd526(0x12f),'')==!![]){let _0x318b35=dbDownloadTasksTable[_0x2fd526(0xec)](_0x16639e[_0x2fd526(0x111)][_0x2fd526(0x137)],_0x4970b6);return process[_0x2fd526(0xea)]({'type':_0x2fd526(0x103),'operation':_0x3b1122,'taskObj':_0x318b35}),_0x591107[_0x2fd526(0xf4)]({'code':0x0});}}),router[_0x2d68a3(0x122)](_0x2d68a3(0x108),(_0x582315,_0x1508f7,_0x32a70e)=>{const _0x248695=_0x2d68a3;let _0xf89e8d=_0x582315[_0x248695(0x11f)]['offset'],_0x1a60c2=_0x582315[_0x248695(0x11f)]['count'],_0x9e6201=_0x582315[_0x248695(0x11f)][_0x248695(0x129)],_0x4900ab=_0x582315[_0x248695(0x11f)][_0x248695(0xe1)],_0x567021=_0x582315[_0x248695(0x11f)][_0x248695(0xed)];if(dbUserTable[_0x248695(0x116)](_0x582315,_0x1508f7,_0x248695(0x117),'power_get','')==!![]){let _0x5168be=dbDownloadTasksTable['getTaskList'](_0x582315[_0x248695(0x111)][_0x248695(0x137)],null,_0x1a60c2,_0xf89e8d,_0x9e6201,_0x4900ab,_0x567021);return _0x1508f7[_0x248695(0xf4)]({'code':0x0,'data':_0x5168be});}}),module[_0x2d68a3(0x132)]=router;