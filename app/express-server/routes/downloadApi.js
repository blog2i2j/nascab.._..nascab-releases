const _0x58f63d=_0xc2d7;(function(_0x50161b,_0x5bd2f6){const _0x52d86f=_0xc2d7,_0x583e53=_0x50161b();while(!![]){try{const _0xc9418e=-parseInt(_0x52d86f(0x1a8))/0x1+-parseInt(_0x52d86f(0x155))/0x2+-parseInt(_0x52d86f(0x17f))/0x3*(parseInt(_0x52d86f(0x169))/0x4)+parseInt(_0x52d86f(0x174))/0x5*(parseInt(_0x52d86f(0x197))/0x6)+parseInt(_0x52d86f(0x152))/0x7*(parseInt(_0x52d86f(0x19a))/0x8)+parseInt(_0x52d86f(0x1b2))/0x9+parseInt(_0x52d86f(0x164))/0xa;if(_0xc9418e===_0x5bd2f6)break;else _0x583e53['push'](_0x583e53['shift']());}catch(_0x3b4777){_0x583e53['push'](_0x583e53['shift']());}}}(_0x2cd3,0x3190a));var express=require(_0x58f63d(0x14a)),router=express[_0x58f63d(0x15f)]();const url=require(_0x58f63d(0x150));let path=require(_0x58f63d(0x175));const dbDownloadTasksTable=require(_0x58f63d(0x1ab)),dbUserTable=require(_0x58f63d(0x17a));var fs=require('fs');function _0xc2d7(_0x2fc9b9,_0x2d9a00){const _0x2cd33a=_0x2cd3();return _0xc2d7=function(_0xc2d70,_0x3642fd){_0xc2d70=_0xc2d70-0x14a;let _0x11c9ba=_0x2cd33a[_0xc2d70];return _0x11c9ba;},_0xc2d7(_0x2fc9b9,_0x2d9a00);}let config=require(_0x58f63d(0x194));function isValidUrl(_0x2c1a0e){const _0xa9c73b=_0x58f63d;try{const _0x344487=url[_0xa9c73b(0x19c)](_0x2c1a0e,!![],!![]);return _0x344487[_0xa9c73b(0x19f)]==='http:'||_0x344487[_0xa9c73b(0x19f)]===_0xa9c73b(0x1a0);}catch(_0x306f60){return![];}}function isValidMagnetLink(_0x62705d){const _0x188c97=_0x58f63d;return _0x62705d[_0x188c97(0x182)](_0x188c97(0x1a6));}router['post'](_0x58f63d(0x19e),(_0x1df75b,_0x280ef9,_0x59a970)=>{const _0x10a4b1=_0x58f63d;let _0x490ee4=_0x1df75b[_0x10a4b1(0x14c)][_0x10a4b1(0x159)],_0x2029bf=_0x1df75b['body'][_0x10a4b1(0x1af)],_0x4846d9=_0x1df75b['body'][_0x10a4b1(0x14f)],_0x42592c=_0x1df75b['body'][_0x10a4b1(0x1a9)],_0x3dafb8=_0x1df75b[_0x10a4b1(0x14c)]['savePath'],_0xe0efe4=dbDownloadTasksTable[_0x10a4b1(0x16e)];if(!_0x490ee4||![dbDownloadTasksTable[_0x10a4b1(0x186)],dbDownloadTasksTable[_0x10a4b1(0x1b3)],dbDownloadTasksTable['TYPE_TORRENT']]['includes'](_0x490ee4))return _0x1df75b['app']['returnErrMsg'](_0x280ef9,_0x10a4b1(0x198));if(dbUserTable[_0x10a4b1(0x1a4)](_0x1df75b,_0x280ef9,_0x10a4b1(0x181),_0x10a4b1(0x18f),'')==!![]){if(_0x490ee4==dbDownloadTasksTable['TYPE_HTTP']){if(!_0x2029bf)return _0x1df75b[_0x10a4b1(0x184)][_0x10a4b1(0x1a5)](_0x280ef9,_0x280ef9['__'](_0x10a4b1(0x16c)));_0x2029bf=_0x2029bf[_0x10a4b1(0x1ac)]('\x0a');}else{if(_0x490ee4==dbDownloadTasksTable[_0x10a4b1(0x1b3)]){if(!_0x4846d9||!isValidMagnetLink(_0x4846d9))return _0x1df75b[_0x10a4b1(0x184)][_0x10a4b1(0x1a5)](_0x280ef9,_0x280ef9['__'](_0x10a4b1(0x154)));_0xe0efe4=dbDownloadTasksTable['STATE_PARSING'],_0x4846d9=_0x4846d9['split']('\x0a');}else _0x490ee4==dbDownloadTasksTable[_0x10a4b1(0x1a7)]&&(_0xe0efe4=dbDownloadTasksTable[_0x10a4b1(0x170)]);}if(!_0x3dafb8&&_0x490ee4==dbDownloadTasksTable['TYPE_HTTP'])return _0x1df75b[_0x10a4b1(0x184)]['returnErrMsg'](_0x280ef9,_0x10a4b1(0x1aa));let _0x2e6e65=[];_0x3dafb8?fs['access'](_0x3dafb8,fs[_0x10a4b1(0x176)]['W_OK']|fs[_0x10a4b1(0x176)][_0x10a4b1(0x15c)],_0x2adb9d=>{const _0x564b5f=_0x10a4b1;if(_0x2adb9d)return console[_0x564b5f(0x15e)](_0x2adb9d),_0x1df75b[_0x564b5f(0x184)][_0x564b5f(0x1a5)](_0x280ef9,_0x280ef9['__'](_0x564b5f(0x162))+':'+_0x3dafb8);_0x5c96f7();}):_0x5c96f7();function _0x5c96f7(){const _0x175ea1=_0x10a4b1;let _0x1cda0e=[];if(_0x490ee4==dbDownloadTasksTable[_0x175ea1(0x186)]){for(let _0x2830cd of _0x2029bf){let _0x23dfc8=dbDownloadTasksTable[_0x175ea1(0x18a)](_0x1df75b['app'][_0x175ea1(0x187)],[_0x175ea1(0x166)],[_0x2830cd]);if(_0x23dfc8)return _0x280ef9[_0x175ea1(0x18c)]({'code':0x2,'data':_0x23dfc8});}for(let _0x1df61b of _0x2029bf){if(!_0x1cda0e['includes'](_0x1df61b)){if(isValidUrl(_0x1df61b)){let _0x11e027=_0x1df61b[_0x175ea1(0x160)](_0x1df61b[_0x175ea1(0x158)]('/')+0x1),_0x1d638f=dbDownloadTasksTable[_0x175ea1(0x17d)](_0x1df75b[_0x175ea1(0x184)]['dbOther'],_0x1df75b[_0x175ea1(0x14b)]['id'],_0x11e027,_0x490ee4,_0xe0efe4,_0x3dafb8,'',_0x1df61b);_0x1cda0e[_0x175ea1(0x157)](_0x1df61b),_0x1d638f['lastInsertRowid']&&_0x2e6e65[_0x175ea1(0x157)](_0x1d638f[_0x175ea1(0x178)]);}}}}else{if(_0x490ee4==dbDownloadTasksTable['TYPE_MAGNET']){for(let _0x572a2b of _0x4846d9){let _0x17a76a=dbDownloadTasksTable[_0x175ea1(0x18a)](_0x1df75b[_0x175ea1(0x184)][_0x175ea1(0x187)],['magnet'],[_0x572a2b]);if(_0x17a76a)return _0x280ef9[_0x175ea1(0x18c)]({'code':0x2,'data':_0x17a76a});}for(let _0x3f76cb of _0x4846d9){if(!_0x1cda0e['includes'](_0x3f76cb)){if(isValidMagnetLink(_0x3f76cb)){let _0x27d70d=dbDownloadTasksTable[_0x175ea1(0x17d)](_0x1df75b['app']['dbOther'],_0x1df75b[_0x175ea1(0x14b)]['id'],_0x3f76cb,_0x490ee4,_0xe0efe4,_0x3dafb8,_0x3f76cb);_0x1cda0e[_0x175ea1(0x157)](_0x3f76cb),_0x27d70d[_0x175ea1(0x178)]&&_0x2e6e65['push'](_0x27d70d['lastInsertRowid']);}}}}else{if(_0x42592c&&_0x490ee4==dbDownloadTasksTable[_0x175ea1(0x1a7)]){for(let _0x32edbe of _0x42592c){let _0x4e2ba5=dbDownloadTasksTable[_0x175ea1(0x18a)](_0x1df75b[_0x175ea1(0x184)][_0x175ea1(0x187)],['torrent_path'],[_0x32edbe]);if(_0x4e2ba5)return _0x280ef9[_0x175ea1(0x18c)]({'code':0x2,'data':_0x4e2ba5});}for(let _0x34198c of _0x42592c){console[_0x175ea1(0x15e)]('torrent',_0x34198c);if(!_0x1cda0e[_0x175ea1(0x156)](_0x34198c)){if(_0x34198c&&fs[_0x175ea1(0x18b)](path[_0x175ea1(0x1a1)](config[_0x175ea1(0x153)],_0x34198c))){let _0x96fb4b=dbDownloadTasksTable[_0x175ea1(0x17d)](_0x1df75b[_0x175ea1(0x184)][_0x175ea1(0x187)],_0x1df75b['currentUser']['id'],_0x34198c,_0x490ee4,_0xe0efe4,_0x3dafb8,'','',_0x34198c);_0x1cda0e[_0x175ea1(0x157)](_0x34198c),_0x96fb4b[_0x175ea1(0x178)]&&_0x2e6e65[_0x175ea1(0x157)](_0x96fb4b[_0x175ea1(0x178)]);}}}}}}let _0x560d7e=[];for(let _0x2cebdb of _0x2e6e65){let _0xe2ccba=dbDownloadTasksTable['getTaskById'](_0x1df75b[_0x175ea1(0x184)][_0x175ea1(0x187)],_0x2cebdb);_0xe2ccba&&_0x560d7e[_0x175ea1(0x157)](_0xe2ccba);}return process['send']({'type':_0x175ea1(0x183),'operation':_0x175ea1(0x1a2),'taskObjList':_0x560d7e}),_0x280ef9['json']({'code':0x0});}}}),router[_0x58f63d(0x151)](_0x58f63d(0x179),(_0x39278e,_0x4ff982,_0x45df6b)=>{const _0x43dff5=_0x58f63d;let _0x4a173e=_0x39278e['body'][_0x43dff5(0x190)];if(dbUserTable[_0x43dff5(0x1a4)](_0x39278e,_0x4ff982,'download',_0x43dff5(0x191),'')==!![]){let _0x4c08de=dbDownloadTasksTable[_0x43dff5(0x1b0)](_0x39278e[_0x43dff5(0x184)][_0x43dff5(0x187)],_0x4a173e);return process[_0x43dff5(0x165)]({'type':_0x43dff5(0x183),'operation':'PAUSE','taskObj':_0x4c08de}),_0x4ff982[_0x43dff5(0x18c)]({'code':0x0});}}),router['post'](_0x58f63d(0x17c),(_0x5d1b7e,_0x3931ee,_0x552aaa)=>{const _0x2dd8a2=_0x58f63d;let _0x162906=_0x5d1b7e[_0x2dd8a2(0x14c)]['taskId'];if(dbUserTable[_0x2dd8a2(0x1a4)](_0x5d1b7e,_0x3931ee,'download',_0x2dd8a2(0x191),'')==!![]){let _0x26c587=dbDownloadTasksTable[_0x2dd8a2(0x1b0)](_0x5d1b7e[_0x2dd8a2(0x184)][_0x2dd8a2(0x187)],_0x162906);return process[_0x2dd8a2(0x165)]({'type':_0x2dd8a2(0x183),'operation':_0x2dd8a2(0x161),'taskObj':_0x26c587}),_0x3931ee[_0x2dd8a2(0x18c)]({'code':0x0});}}),router[_0x58f63d(0x151)](_0x58f63d(0x17b),(_0xf0569a,_0x4ba64f,_0x1994a4)=>{const _0x534839=_0x58f63d;let _0x9b849e=_0xf0569a[_0x534839(0x14c)][_0x534839(0x190)];if(dbUserTable[_0x534839(0x1a4)](_0xf0569a,_0x4ba64f,'download',_0x534839(0x15d),'')==!![]){let _0x8c9438=dbDownloadTasksTable[_0x534839(0x1b0)](_0xf0569a['app']['dbOther'],_0x9b849e);return _0x4ba64f[_0x534839(0x18c)]({'code':0x0,'data':_0x8c9438});}}),router['post'](_0x58f63d(0x16f),(_0x1afede,_0x4bf4ad,_0x84a1d9)=>{const _0x571e28=_0x58f63d;let _0x19401c=_0x1afede[_0x571e28(0x14c)][_0x571e28(0x190)];if(dbUserTable[_0x571e28(0x1a4)](_0x1afede,_0x4bf4ad,_0x571e28(0x181),'power_delete','')==!![]){let _0x42f71d=dbDownloadTasksTable[_0x571e28(0x1b0)](_0x1afede[_0x571e28(0x184)][_0x571e28(0x187)],_0x19401c);return dbDownloadTasksTable[_0x571e28(0x1ae)](_0x1afede[_0x571e28(0x184)][_0x571e28(0x187)],_0x19401c),process['send']({'type':'downloadTaskChange','operation':_0x571e28(0x163),'taskObj':_0x42f71d}),_0x4bf4ad['json']({'code':0x0});}}),router['post'](_0x58f63d(0x14e),(_0x54c61e,_0x4ead54,_0x384918)=>{const _0x4dff9b=_0x58f63d;let _0x57d0be=_0x54c61e[_0x4dff9b(0x14c)][_0x4dff9b(0x190)],_0x146c48=_0x54c61e[_0x4dff9b(0x14c)][_0x4dff9b(0x17e)],_0x202b80=_0x54c61e[_0x4dff9b(0x14c)][_0x4dff9b(0x192)];console[_0x4dff9b(0x15e)](_0x4dff9b(0x16d),_0x146c48);if(dbUserTable[_0x4dff9b(0x1a4)](_0x54c61e,_0x4ead54,'download',_0x4dff9b(0x18d),'')==!![]){if(!_0x202b80)return _0x54c61e[_0x4dff9b(0x184)][_0x4dff9b(0x1a5)](_0x4ead54,_0x4dff9b(0x1aa));fs[_0x4dff9b(0x1a3)](_0x202b80,fs[_0x4dff9b(0x176)]['W_OK']|fs[_0x4dff9b(0x176)]['R_OK'],_0x3ee6bb=>{const _0x1f382b=_0x4dff9b;if(_0x3ee6bb)return console[_0x1f382b(0x15e)](_0x3ee6bb),_0x54c61e['app']['returnErrMsg'](_0x4ead54,_0x4ead54['__'](_0x1f382b(0x162))+':'+_0x202b80);let _0x2d2ca8=dbDownloadTasksTable['getTaskById'](_0x54c61e[_0x1f382b(0x184)][_0x1f382b(0x187)],_0x57d0be);if(!_0x2d2ca8)return _0x54c61e['app'][_0x1f382b(0x1a5)](_0x4ead54,_0x1f382b(0x16a));let _0x4b5bc2=[];if(_0x2d2ca8[_0x1f382b(0x188)])try{_0x4b5bc2=JSON[_0x1f382b(0x19c)](_0x2d2ca8['task_file_list']);}catch(_0x4c2e29){console[_0x1f382b(0x15e)](_0x4c2e29);}let _0x4d6603=0x0;for(let _0x1ef985 of _0x4b5bc2){for(let _0x48b242 of _0x146c48){_0x48b242['name']==_0x1ef985[_0x1f382b(0x15b)]&&_0x48b242['path']==_0x1ef985[_0x1f382b(0x175)]&&(_0x1ef985[_0x1f382b(0x15a)]=0x1,_0x4d6603+=_0x1ef985[_0x1f382b(0x1b4)]);}}return dbDownloadTasksTable[_0x1f382b(0x196)](_0x54c61e[_0x1f382b(0x184)][_0x1f382b(0x187)],_0x57d0be,_0x1f382b(0x1ad),path[_0x1f382b(0x1a1)](_0x202b80)),dbDownloadTasksTable[_0x1f382b(0x196)](_0x54c61e[_0x1f382b(0x184)][_0x1f382b(0x187)],_0x57d0be,'task_file_list',JSON['stringify'](_0x4b5bc2)),dbDownloadTasksTable[_0x1f382b(0x196)](_0x54c61e[_0x1f382b(0x184)][_0x1f382b(0x187)],_0x57d0be,'task_state',dbDownloadTasksTable[_0x1f382b(0x16e)]),dbDownloadTasksTable['updateTaskField'](_0x54c61e['app'][_0x1f382b(0x187)],_0x57d0be,_0x1f382b(0x185),_0x4d6603),_0x2d2ca8=dbDownloadTasksTable['getTaskById'](_0x54c61e[_0x1f382b(0x184)][_0x1f382b(0x187)],_0x57d0be),process[_0x1f382b(0x165)]({'type':'downloadTaskChange','operation':_0x1f382b(0x161),'taskObj':_0x2d2ca8}),_0x4ead54[_0x1f382b(0x18c)]({'code':0x0,'fileList':_0x146c48});});}}),router[_0x58f63d(0x151)](_0x58f63d(0x199),(_0x5623d1,_0x304efb,_0x290447)=>{const _0x36ed86=_0x58f63d;let _0x412460=[_0x36ed86(0x173),_0x36ed86(0x171),_0x36ed86(0x177)],_0x2838fd=_0x5623d1[_0x36ed86(0x14c)][_0x36ed86(0x189)];if(!_0x412460[_0x36ed86(0x156)](_0x2838fd))return _0x5623d1['app'][_0x36ed86(0x1a5)](_0x304efb,_0x36ed86(0x19b));if(dbUserTable[_0x36ed86(0x1a4)](_0x5623d1,_0x304efb,_0x36ed86(0x181),_0x36ed86(0x191),'')==!![]){if(_0x2838fd==_0x36ed86(0x177)){let _0x1801f1=_0x5623d1['body'][_0x36ed86(0x168)];if(!_0x1801f1)return _0x5623d1[_0x36ed86(0x184)]['returnErrMsg'](_0x304efb,_0x36ed86(0x18e));dbDownloadTasksTable[_0x36ed86(0x180)](_0x5623d1[_0x36ed86(0x184)]['dbOther'],_0x1801f1);}return process[_0x36ed86(0x165)]({'type':_0x36ed86(0x183),'operation':_0x2838fd}),_0x304efb['json']({'code':0x0});}}),router['post']('/operationTask',(_0x132083,_0x3db76f,_0x6a1d7c)=>{const _0x59d1d0=_0x58f63d;let _0x18dd40=_0x132083[_0x59d1d0(0x14c)][_0x59d1d0(0x190)],_0x342ae8=[_0x59d1d0(0x1b1),_0x59d1d0(0x161),_0x59d1d0(0x16b)],_0x14e568=_0x132083[_0x59d1d0(0x14c)]['operation'];if(!_0x342ae8[_0x59d1d0(0x156)](_0x14e568))return _0x132083['app'][_0x59d1d0(0x1a5)](_0x3db76f,_0x59d1d0(0x19b));if(dbUserTable[_0x59d1d0(0x1a4)](_0x132083,_0x3db76f,_0x59d1d0(0x181),_0x59d1d0(0x191),'')==!![]){let _0x4af5e2=dbDownloadTasksTable['getTaskById'](_0x132083[_0x59d1d0(0x184)][_0x59d1d0(0x187)],_0x18dd40);return process['send']({'type':_0x59d1d0(0x183),'operation':_0x14e568,'taskObj':_0x4af5e2}),_0x3db76f[_0x59d1d0(0x18c)]({'code':0x0});}}),router[_0x58f63d(0x151)](_0x58f63d(0x195),(_0x3688ed,_0x3ce4e8,_0x330dc0)=>{const _0x33939a=_0x58f63d;let _0x300833=_0x3688ed[_0x33939a(0x14c)][_0x33939a(0x167)],_0x5defd5=_0x3688ed[_0x33939a(0x14c)]['count'],_0x418700=_0x3688ed['body'][_0x33939a(0x14d)],_0x48bc01=_0x3688ed[_0x33939a(0x14c)][_0x33939a(0x172)],_0x27b270=_0x3688ed['body'][_0x33939a(0x168)];if(dbUserTable[_0x33939a(0x1a4)](_0x3688ed,_0x3ce4e8,'download',_0x33939a(0x15d),'')==!![]){let _0x2e1129=dbDownloadTasksTable[_0x33939a(0x193)](_0x3688ed[_0x33939a(0x184)][_0x33939a(0x187)],null,_0x5defd5,_0x300833,_0x418700,_0x48bc01,_0x27b270);return _0x3ce4e8['json']({'code':0x0,'data':_0x2e1129});}}),module[_0x58f63d(0x19d)]=router;function _0x2cd3(){const _0x2cf0fc=['url','post','4725TKUNVA','torrentPath','needValidMagnetUrl','38502oYWAEn','includes','push','lastIndexOf','taskType','selected','name','R_OK','power_get','log','Router','substring','START','noWritePermission','DELETE','635500TDhxjs','send','http_url','offset','taskState','1756UDTJSU','Task\x20not\x20found','RESTART','needValidUrl','selectTaskFile','STATE_WAITING','/deleteTask','STATE_PARSING','START_ALL','orderType','PAUSE_ALL','274305duYEYc','path','constants','DELETE_ALL','lastInsertRowid','/pauseTask','../../db/dbUserTable','/getTaskDetail','/startTask','addTask','fileList','600CvkXrb','deleteAllTaskByState','download','startsWith','downloadTaskChange','app','total_size','TYPE_HTTP','dbOther','task_file_list','operation','getDownloadingTaskByWhere','existsSync','json','power_delete','ERROR\x20DELETE\x20TASK\x20STATE','power_add','taskId','power_change','savePath','getTaskList','../../myConfig/config','/getTaskList','updateTaskField','6ScQauy','TASK\x20TYPE\x20ERROR','/operationAllTask','4016mjilQC','ERROR\x20OPERATION','parse','exports','/addDownloadTask','protocol','https:','join','ADD','access','doUserCanGet','returnErrMsg','magnet:?','TYPE_TORRENT','295902CgSrtR','torrentName','NEED\x20SAVE\x20PATH','../../db/dbDownloadTasksTable','split','save_path','deleteTask','httpUrl','getTaskById','PAUSE','1338390DTYfXK','TYPE_MAGNET','length','express','currentUser','body','orderField','/selectTaskFile','magnet'];_0x2cd3=function(){return _0x2cf0fc;};return _0x2cd3();}