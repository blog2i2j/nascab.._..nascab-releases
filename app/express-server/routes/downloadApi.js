const _0x28dba3=_0x350e;(function(_0x438e10,_0x2855d0){const _0x3a2f0d=_0x350e,_0x425e4d=_0x438e10();while(!![]){try{const _0xc83f09=-parseInt(_0x3a2f0d(0x167))/0x1+-parseInt(_0x3a2f0d(0x16e))/0x2+-parseInt(_0x3a2f0d(0x15e))/0x3+-parseInt(_0x3a2f0d(0x157))/0x4+parseInt(_0x3a2f0d(0x1ac))/0x5*(-parseInt(_0x3a2f0d(0x176))/0x6)+-parseInt(_0x3a2f0d(0x150))/0x7+parseInt(_0x3a2f0d(0x19e))/0x8;if(_0xc83f09===_0x2855d0)break;else _0x425e4d['push'](_0x425e4d['shift']());}catch(_0x172568){_0x425e4d['push'](_0x425e4d['shift']());}}}(_0x18aa,0xf2974));var express=require(_0x28dba3(0x149)),router=express[_0x28dba3(0x159)]();const url=require(_0x28dba3(0x19c));let path=require(_0x28dba3(0x19a));const dbDownloadTasksTable=require(_0x28dba3(0x153)),dbUserTable=require(_0x28dba3(0x196));var fs=require('fs');let config=require('../../myConfig/config');function isValidUrl(_0xe1b639){const _0x2cd845=_0x28dba3;try{const _0x56ae65=url['parse'](_0xe1b639,!![],!![]);return _0x56ae65[_0x2cd845(0x1a1)]===_0x2cd845(0x18a)||_0x56ae65[_0x2cd845(0x1a1)]===_0x2cd845(0x169);}catch(_0x3474d1){return![];}}function _0x350e(_0x57bb08,_0x3a1624){const _0x18aab6=_0x18aa();return _0x350e=function(_0x350eaf,_0x436f40){_0x350eaf=_0x350eaf-0x149;let _0x458006=_0x18aab6[_0x350eaf];return _0x458006;},_0x350e(_0x57bb08,_0x3a1624);}function _0x18aa(){const _0x556766=['getDownloadingTaskByWhere','savePath','json','../../db/dbUserTable','returnErrMsg','getTaskList','total_size','path','torrent','url','dbOther','70286168mrIAgg','doUserCanGet','PAUSE','protocol','/selectTaskFile','constants','/getTaskList','START','DELETE','exports','magnet','deleteAllTaskByState','send','DELETE_ALL','5wLQgPv','express','downloadTaskChange','STATE_WAITING','needValidUrl','length','power_change','taskId','11044922ejBGnH','ERROR\x20DELETE\x20TASK\x20STATE','TYPE_HTTP','../../db/dbDownloadTasksTable','includes','taskState','updateTaskField','6073132MBRuaf','existsSync','Router','save_path','count','task_file_list','lastInsertRowid','2573613riHCAp','taskType','TYPE_TORRENT','startsWith','selected','/startTask','Task\x20not\x20found','power_add','push','825165IfOPyC','download','https:','stringify','post','join','deleteTask','2266982FuQPLD','/getTaskDetail','body','/operationAllTask','torrentName','ADD','orderField','orderType','11276778muHdrv','getTaskById','PAUSE_ALL','TYPE_MAGNET','W_OK','name','NEED\x20SAVE\x20PATH','split','currentUser','ERROR\x20OPERATION','power_get','app','STATE_PARSING','START_ALL','operation','log','access','power_delete','torrent_path','/deleteTask','http:','httpUrl','http_url','fileList','substring','addTask','R_OK','lastIndexOf','selectTaskFile'];_0x18aa=function(){return _0x556766;};return _0x18aa();}function isValidMagnetLink(_0x3eee68){const _0x27c0f5=_0x28dba3;return _0x3eee68[_0x27c0f5(0x161)]('magnet:?');}router[_0x28dba3(0x16b)]('/addDownloadTask',(_0x1bc494,_0x5e895a,_0x2ab942)=>{const _0x6b40f5=_0x28dba3;let _0x48f8aa=_0x1bc494[_0x6b40f5(0x170)][_0x6b40f5(0x15f)],_0x3d8513=_0x1bc494['body'][_0x6b40f5(0x18b)],_0x59a700=_0x1bc494['body'][_0x6b40f5(0x1a8)],_0x4107f9=_0x1bc494[_0x6b40f5(0x170)][_0x6b40f5(0x172)],_0x3eabfe=_0x1bc494[_0x6b40f5(0x170)][_0x6b40f5(0x194)],_0x3909ac=dbDownloadTasksTable[_0x6b40f5(0x14b)];if(!_0x48f8aa||![dbDownloadTasksTable[_0x6b40f5(0x152)],dbDownloadTasksTable[_0x6b40f5(0x179)],dbDownloadTasksTable[_0x6b40f5(0x160)]][_0x6b40f5(0x154)](_0x48f8aa))return _0x1bc494['app'][_0x6b40f5(0x197)](_0x5e895a,'TASK\x20TYPE\x20ERROR');if(dbUserTable[_0x6b40f5(0x19f)](_0x1bc494,_0x5e895a,_0x6b40f5(0x168),_0x6b40f5(0x165),'')==!![]){if(_0x48f8aa==dbDownloadTasksTable[_0x6b40f5(0x152)]){if(!_0x3d8513)return _0x1bc494[_0x6b40f5(0x181)][_0x6b40f5(0x197)](_0x5e895a,_0x5e895a['__'](_0x6b40f5(0x14c)));_0x3d8513=_0x3d8513[_0x6b40f5(0x17d)]('\x0a');}else{if(_0x48f8aa==dbDownloadTasksTable['TYPE_MAGNET']){if(!_0x59a700||!isValidMagnetLink(_0x59a700))return _0x1bc494[_0x6b40f5(0x181)][_0x6b40f5(0x197)](_0x5e895a,_0x5e895a['__']('needValidMagnetUrl'));_0x3909ac=dbDownloadTasksTable[_0x6b40f5(0x182)],_0x59a700=_0x59a700[_0x6b40f5(0x17d)]('\x0a');}else _0x48f8aa==dbDownloadTasksTable[_0x6b40f5(0x160)]&&(_0x3909ac=dbDownloadTasksTable[_0x6b40f5(0x182)]);}if(!_0x3eabfe&&_0x48f8aa==dbDownloadTasksTable['TYPE_HTTP'])return _0x1bc494['app']['returnErrMsg'](_0x5e895a,_0x6b40f5(0x17c));let _0x429e78=[];_0x3eabfe?fs[_0x6b40f5(0x186)](_0x3eabfe,fs['constants'][_0x6b40f5(0x17a)]|fs['constants'][_0x6b40f5(0x190)],_0x2e2362=>{const _0x3585c3=_0x6b40f5;if(_0x2e2362)return console[_0x3585c3(0x185)](_0x2e2362),_0x1bc494[_0x3585c3(0x181)]['returnErrMsg'](_0x5e895a,_0x5e895a['__']('noWritePermission')+':'+_0x3eabfe);_0x34ac00();}):_0x34ac00();function _0x34ac00(){const _0x1180e3=_0x6b40f5;let _0x3ab766=[];if(_0x48f8aa==dbDownloadTasksTable[_0x1180e3(0x152)]){for(let _0x4c1fa4 of _0x3d8513){let _0x4ce6c1=dbDownloadTasksTable[_0x1180e3(0x193)](_0x1bc494['app'][_0x1180e3(0x19d)],[_0x1180e3(0x18c)],[_0x4c1fa4]);if(_0x4ce6c1)return _0x5e895a[_0x1180e3(0x195)]({'code':0x2,'data':_0x4ce6c1});}for(let _0x4f8bf3 of _0x3d8513){if(!_0x3ab766[_0x1180e3(0x154)](_0x4f8bf3)){if(isValidUrl(_0x4f8bf3)){let _0x2015dd=_0x4f8bf3[_0x1180e3(0x18e)](_0x4f8bf3[_0x1180e3(0x191)]('/')+0x1),_0x3883bb=dbDownloadTasksTable[_0x1180e3(0x18f)](_0x1bc494[_0x1180e3(0x181)][_0x1180e3(0x19d)],_0x1bc494[_0x1180e3(0x17e)]['id'],_0x2015dd,_0x48f8aa,_0x3909ac,_0x3eabfe,'',_0x4f8bf3);_0x3ab766[_0x1180e3(0x166)](_0x4f8bf3),_0x3883bb[_0x1180e3(0x15d)]&&_0x429e78[_0x1180e3(0x166)](_0x3883bb['lastInsertRowid']);}}}}else{if(_0x48f8aa==dbDownloadTasksTable[_0x1180e3(0x179)]){for(let _0x58ca62 of _0x59a700){let _0x11f8ce=dbDownloadTasksTable[_0x1180e3(0x193)](_0x1bc494['app'][_0x1180e3(0x19d)],['magnet'],[_0x58ca62]);if(_0x11f8ce)return _0x5e895a[_0x1180e3(0x195)]({'code':0x2,'data':_0x11f8ce});}for(let _0xd14b94 of _0x59a700){if(!_0x3ab766[_0x1180e3(0x154)](_0xd14b94)){if(isValidMagnetLink(_0xd14b94)){let _0x52e2c8=dbDownloadTasksTable['addTask'](_0x1bc494['app'][_0x1180e3(0x19d)],_0x1bc494[_0x1180e3(0x17e)]['id'],_0xd14b94,_0x48f8aa,_0x3909ac,_0x3eabfe,_0xd14b94);_0x3ab766['push'](_0xd14b94),_0x52e2c8[_0x1180e3(0x15d)]&&_0x429e78[_0x1180e3(0x166)](_0x52e2c8[_0x1180e3(0x15d)]);}}}}else{if(_0x4107f9&&_0x48f8aa==dbDownloadTasksTable[_0x1180e3(0x160)]){for(let _0x552013 of _0x4107f9){let _0x46513f=dbDownloadTasksTable[_0x1180e3(0x193)](_0x1bc494['app']['dbOther'],[_0x1180e3(0x188)],[_0x552013]);if(_0x46513f)return _0x5e895a[_0x1180e3(0x195)]({'code':0x2,'data':_0x46513f});}for(let _0x3c41ef of _0x4107f9){console['log'](_0x1180e3(0x19b),_0x3c41ef);if(!_0x3ab766[_0x1180e3(0x154)](_0x3c41ef)){if(_0x3c41ef&&fs[_0x1180e3(0x158)](path[_0x1180e3(0x16c)](config['torrentPath'],_0x3c41ef))){let _0x50f7e7=dbDownloadTasksTable[_0x1180e3(0x18f)](_0x1bc494[_0x1180e3(0x181)][_0x1180e3(0x19d)],_0x1bc494[_0x1180e3(0x17e)]['id'],_0x3c41ef,_0x48f8aa,_0x3909ac,_0x3eabfe,'','',_0x3c41ef);_0x3ab766[_0x1180e3(0x166)](_0x3c41ef),_0x50f7e7['lastInsertRowid']&&_0x429e78[_0x1180e3(0x166)](_0x50f7e7[_0x1180e3(0x15d)]);}}}}}}let _0x578fbb=[];for(let _0x5041e1 of _0x429e78){let _0x57a305=dbDownloadTasksTable[_0x1180e3(0x177)](_0x1bc494['app'][_0x1180e3(0x19d)],_0x5041e1);_0x57a305&&_0x578fbb[_0x1180e3(0x166)](_0x57a305);}return process[_0x1180e3(0x1aa)]({'type':_0x1180e3(0x14a),'operation':_0x1180e3(0x173),'taskObjList':_0x578fbb}),_0x5e895a[_0x1180e3(0x195)]({'code':0x0});}}}),router['post']('/pauseTask',(_0x4bfc56,_0x4014fd,_0x515e66)=>{const _0x1396be=_0x28dba3;let _0x1136cf=_0x4bfc56[_0x1396be(0x170)]['taskId'];if(dbUserTable['doUserCanGet'](_0x4bfc56,_0x4014fd,_0x1396be(0x168),'power_change','')==!![]){let _0x476191=dbDownloadTasksTable[_0x1396be(0x177)](_0x4bfc56[_0x1396be(0x181)][_0x1396be(0x19d)],_0x1136cf);return process[_0x1396be(0x1aa)]({'type':_0x1396be(0x14a),'operation':_0x1396be(0x1a0),'taskObj':_0x476191}),_0x4014fd[_0x1396be(0x195)]({'code':0x0});}}),router['post'](_0x28dba3(0x163),(_0xd39d8c,_0x5e6d52,_0x11312b)=>{const _0x1519f9=_0x28dba3;let _0x5dde28=_0xd39d8c[_0x1519f9(0x170)][_0x1519f9(0x14f)];if(dbUserTable['doUserCanGet'](_0xd39d8c,_0x5e6d52,_0x1519f9(0x168),_0x1519f9(0x14e),'')==!![]){let _0x4a772b=dbDownloadTasksTable[_0x1519f9(0x177)](_0xd39d8c[_0x1519f9(0x181)][_0x1519f9(0x19d)],_0x5dde28);return process[_0x1519f9(0x1aa)]({'type':_0x1519f9(0x14a),'operation':_0x1519f9(0x1a5),'taskObj':_0x4a772b}),_0x5e6d52['json']({'code':0x0});}}),router[_0x28dba3(0x16b)](_0x28dba3(0x16f),(_0x1a3c91,_0x372ee2,_0x4aaaa9)=>{const _0x26a546=_0x28dba3;let _0x4ce2d7=_0x1a3c91[_0x26a546(0x170)][_0x26a546(0x14f)];if(dbUserTable['doUserCanGet'](_0x1a3c91,_0x372ee2,_0x26a546(0x168),_0x26a546(0x180),'')==!![]){let _0x7061f=dbDownloadTasksTable[_0x26a546(0x177)](_0x1a3c91['app'][_0x26a546(0x19d)],_0x4ce2d7);return _0x372ee2[_0x26a546(0x195)]({'code':0x0,'data':_0x7061f});}}),router[_0x28dba3(0x16b)](_0x28dba3(0x189),(_0x51f5c6,_0x269041,_0x53b7ca)=>{const _0x27f6c6=_0x28dba3;let _0x1cd486=_0x51f5c6[_0x27f6c6(0x170)]['taskId'];if(dbUserTable[_0x27f6c6(0x19f)](_0x51f5c6,_0x269041,_0x27f6c6(0x168),_0x27f6c6(0x187),'')==!![]){let _0x1eed27=dbDownloadTasksTable[_0x27f6c6(0x177)](_0x51f5c6[_0x27f6c6(0x181)]['dbOther'],_0x1cd486);return dbDownloadTasksTable[_0x27f6c6(0x16d)](_0x51f5c6['app'][_0x27f6c6(0x19d)],_0x1cd486),process[_0x27f6c6(0x1aa)]({'type':_0x27f6c6(0x14a),'operation':_0x27f6c6(0x1a6),'taskObj':_0x1eed27}),_0x269041['json']({'code':0x0});}}),router[_0x28dba3(0x16b)](_0x28dba3(0x1a2),(_0x16755e,_0x540b03,_0x320bba)=>{const _0x3dae52=_0x28dba3;let _0x39d57e=_0x16755e['body'][_0x3dae52(0x14f)],_0xf0ef87=_0x16755e['body'][_0x3dae52(0x18d)],_0x113963=_0x16755e[_0x3dae52(0x170)]['savePath'];console[_0x3dae52(0x185)](_0x3dae52(0x192),_0xf0ef87);if(dbUserTable[_0x3dae52(0x19f)](_0x16755e,_0x540b03,'download','power_delete','')==!![]){if(!_0x113963)return _0x16755e[_0x3dae52(0x181)][_0x3dae52(0x197)](_0x540b03,'NEED\x20SAVE\x20PATH');fs['access'](_0x113963,fs[_0x3dae52(0x1a3)]['W_OK']|fs[_0x3dae52(0x1a3)][_0x3dae52(0x190)],_0x58bfc6=>{const _0x75b6e7=_0x3dae52;if(_0x58bfc6)return console[_0x75b6e7(0x185)](_0x58bfc6),_0x16755e[_0x75b6e7(0x181)][_0x75b6e7(0x197)](_0x540b03,_0x540b03['__']('noWritePermission')+':'+_0x113963);let _0x554108=dbDownloadTasksTable[_0x75b6e7(0x177)](_0x16755e[_0x75b6e7(0x181)][_0x75b6e7(0x19d)],_0x39d57e);if(!_0x554108)return _0x16755e['app'][_0x75b6e7(0x197)](_0x540b03,_0x75b6e7(0x164));let _0x54410d=[];if(_0x554108[_0x75b6e7(0x15c)])try{_0x54410d=JSON['parse'](_0x554108[_0x75b6e7(0x15c)]);}catch(_0x522427){console[_0x75b6e7(0x185)](_0x522427);}let _0x4edf67=0x0;for(let _0xeee76f of _0x54410d){for(let _0x43ef99 of _0xf0ef87){_0x43ef99[_0x75b6e7(0x17b)]==_0xeee76f['name']&&_0x43ef99[_0x75b6e7(0x19a)]==_0xeee76f[_0x75b6e7(0x19a)]&&(_0xeee76f[_0x75b6e7(0x162)]=0x1,_0x4edf67+=_0xeee76f[_0x75b6e7(0x14d)]);}}return dbDownloadTasksTable[_0x75b6e7(0x156)](_0x16755e[_0x75b6e7(0x181)][_0x75b6e7(0x19d)],_0x39d57e,_0x75b6e7(0x15a),path[_0x75b6e7(0x16c)](_0x113963)),dbDownloadTasksTable[_0x75b6e7(0x156)](_0x16755e[_0x75b6e7(0x181)][_0x75b6e7(0x19d)],_0x39d57e,_0x75b6e7(0x15c),JSON[_0x75b6e7(0x16a)](_0x54410d)),dbDownloadTasksTable[_0x75b6e7(0x156)](_0x16755e['app'][_0x75b6e7(0x19d)],_0x39d57e,'task_state',dbDownloadTasksTable[_0x75b6e7(0x14b)]),dbDownloadTasksTable[_0x75b6e7(0x156)](_0x16755e[_0x75b6e7(0x181)]['dbOther'],_0x39d57e,_0x75b6e7(0x199),_0x4edf67),_0x554108=dbDownloadTasksTable[_0x75b6e7(0x177)](_0x16755e[_0x75b6e7(0x181)][_0x75b6e7(0x19d)],_0x39d57e),process[_0x75b6e7(0x1aa)]({'type':'downloadTaskChange','operation':_0x75b6e7(0x1a5),'taskObj':_0x554108}),_0x540b03['json']({'code':0x0,'fileList':_0xf0ef87});});}}),router[_0x28dba3(0x16b)](_0x28dba3(0x171),(_0x32838c,_0x271605,_0x193926)=>{const _0x292a7f=_0x28dba3;let _0x1ab5e6=[_0x292a7f(0x178),_0x292a7f(0x183),_0x292a7f(0x1ab)],_0x2be0ea=_0x32838c[_0x292a7f(0x170)][_0x292a7f(0x184)];if(!_0x1ab5e6[_0x292a7f(0x154)](_0x2be0ea))return _0x32838c[_0x292a7f(0x181)][_0x292a7f(0x197)](_0x271605,_0x292a7f(0x17f));if(dbUserTable[_0x292a7f(0x19f)](_0x32838c,_0x271605,_0x292a7f(0x168),_0x292a7f(0x14e),'')==!![]){if(_0x2be0ea==_0x292a7f(0x1ab)){let _0x33defd=_0x32838c[_0x292a7f(0x170)]['taskState'];if(!_0x33defd)return _0x32838c[_0x292a7f(0x181)][_0x292a7f(0x197)](_0x271605,_0x292a7f(0x151));dbDownloadTasksTable[_0x292a7f(0x1a9)](_0x32838c['app']['dbOther'],_0x33defd);}return process[_0x292a7f(0x1aa)]({'type':_0x292a7f(0x14a),'operation':_0x2be0ea}),_0x271605[_0x292a7f(0x195)]({'code':0x0});}}),router[_0x28dba3(0x16b)]('/operationTask',(_0x498e73,_0x1bbbd2,_0x11ff4f)=>{const _0xf62d71=_0x28dba3;let _0x458383=_0x498e73['body'][_0xf62d71(0x14f)],_0x4dde36=[_0xf62d71(0x1a0),_0xf62d71(0x1a5),'RESTART'],_0x558498=_0x498e73[_0xf62d71(0x170)]['operation'];if(!_0x4dde36['includes'](_0x558498))return _0x498e73[_0xf62d71(0x181)][_0xf62d71(0x197)](_0x1bbbd2,_0xf62d71(0x17f));if(dbUserTable[_0xf62d71(0x19f)](_0x498e73,_0x1bbbd2,_0xf62d71(0x168),_0xf62d71(0x14e),'')==!![]){let _0x3ba2c5=dbDownloadTasksTable['getTaskById'](_0x498e73[_0xf62d71(0x181)]['dbOther'],_0x458383);return process[_0xf62d71(0x1aa)]({'type':_0xf62d71(0x14a),'operation':_0x558498,'taskObj':_0x3ba2c5}),_0x1bbbd2[_0xf62d71(0x195)]({'code':0x0});}}),router[_0x28dba3(0x16b)](_0x28dba3(0x1a4),(_0x58d01b,_0x4ff805,_0x42e6bd)=>{const _0x3ef6ca=_0x28dba3;let _0x14b3ae=_0x58d01b[_0x3ef6ca(0x170)]['offset'],_0x11c11d=_0x58d01b[_0x3ef6ca(0x170)][_0x3ef6ca(0x15b)],_0x557e27=_0x58d01b[_0x3ef6ca(0x170)][_0x3ef6ca(0x174)],_0x599924=_0x58d01b[_0x3ef6ca(0x170)][_0x3ef6ca(0x175)],_0x578a01=_0x58d01b['body'][_0x3ef6ca(0x155)];if(dbUserTable[_0x3ef6ca(0x19f)](_0x58d01b,_0x4ff805,_0x3ef6ca(0x168),'power_get','')==!![]){let _0x2f593d=dbDownloadTasksTable[_0x3ef6ca(0x198)](_0x58d01b['app']['dbOther'],null,_0x11c11d,_0x14b3ae,_0x557e27,_0x599924,_0x578a01);return _0x4ff805[_0x3ef6ca(0x195)]({'code':0x0,'data':_0x2f593d});}}),module[_0x28dba3(0x1a7)]=router;