const _0x38e45e=_0x5a55;(function(_0x1f235e,_0x1570d6){const _0x3a7095=_0x5a55,_0x287605=_0x1f235e();while(!![]){try{const _0x1bd858=-parseInt(_0x3a7095(0xa2))/0x1*(parseInt(_0x3a7095(0xa7))/0x2)+-parseInt(_0x3a7095(0xde))/0x3*(-parseInt(_0x3a7095(0xe9))/0x4)+-parseInt(_0x3a7095(0xee))/0x5*(-parseInt(_0x3a7095(0xab))/0x6)+parseInt(_0x3a7095(0xb6))/0x7+-parseInt(_0x3a7095(0xd8))/0x8+parseInt(_0x3a7095(0xd3))/0x9+parseInt(_0x3a7095(0xf0))/0xa*(-parseInt(_0x3a7095(0xcb))/0xb);if(_0x1bd858===_0x1570d6)break;else _0x287605['push'](_0x287605['shift']());}catch(_0xec6563){_0x287605['push'](_0x287605['shift']());}}}(_0x5dc9,0x35e47));var express=require('express'),router=express['Router']();function _0x5a55(_0x1c6cf0,_0x3c1b3a){const _0x5dc99a=_0x5dc9();return _0x5a55=function(_0x5a5523,_0x5b4fab){_0x5a5523=_0x5a5523-0x99;let _0x19c911=_0x5dc99a[_0x5a5523];return _0x19c911;},_0x5a55(_0x1c6cf0,_0x3c1b3a);}const url=require(_0x38e45e(0xa4));let path=require(_0x38e45e(0xeb));const dbDownloadTasksTable=require(_0x38e45e(0x9a)),dbUserTable=require(_0x38e45e(0x9f));var fs=require('fs');let config=require(_0x38e45e(0xb8));function isValidUrl(_0x48a1a1){const _0x47a881=_0x38e45e;try{const _0x4b41c8=url[_0x47a881(0xd4)](_0x48a1a1,!![],!![]);return _0x4b41c8[_0x47a881(0xcd)]===_0x47a881(0xe5)||_0x4b41c8[_0x47a881(0xcd)]==='https:';}catch(_0x46a226){return![];}}function _0x5dc9(){const _0x542d28=['download','838Vwabcq','split','power_get','needValidMagnetUrl','1343328mtRocT','length','savePath','NEED\x20SAVE\x20PATH','send','body','addTask','PAUSE','/operationAllTask','/getTaskList','ERROR\x20OPERATION','1933365XYkWBy','TYPE_HTTP','../../myConfig/config','stringify','taskType','TASK\x20TYPE\x20ERROR','Task\x20not\x20found','noWritePermission','TYPE_MAGNET','startsWith','taskId','downloadTaskChange','STATE_WAITING','orderField','task_state','getTaskList','operation','selected','W_OK','DELETE_ALL','magnet:?','32747KhLBGi','join','protocol','lastInsertRowid','getTaskById','offset','magnet','app','1443789SUDztA','parse','DELETE','dbOther','ADD','2478416OkDuuP','deleteTask','torrentPath','push','torrent','exports','15207ONAleJ','/addDownloadTask','RESTART','ERROR\x20DELETE\x20TASK\x20STATE','/pauseTask','name','post','http:','updateTaskField','httpUrl','selectTaskFile','212xirmQi','/selectTaskFile','path','currentUser','doUserCanGet','5DxzGjU','deleteAllTaskByState','700icYLcN','taskState','power_delete','STATE_PARSING','getDownloadingTaskByWhere','constants','includes','http_url','R_OK','START','../../db/dbDownloadTasksTable','returnErrMsg','log','torrentName','/getTaskDetail','../../db/dbUserTable','json','START_ALL','454ItDHDX','task_file_list','url','power_change'];_0x5dc9=function(){return _0x542d28;};return _0x5dc9();}function isValidMagnetLink(_0x4a6b44){const _0x5004c6=_0x38e45e;return _0x4a6b44[_0x5004c6(0xbf)](_0x5004c6(0xca));}router['post'](_0x38e45e(0xdf),(_0x21fac7,_0x508707,_0x5c61fe)=>{const _0x1c7728=_0x38e45e;let _0x181fd7=_0x21fac7[_0x1c7728(0xb0)][_0x1c7728(0xba)],_0x5868ad=_0x21fac7['body'][_0x1c7728(0xe7)],_0x2eb980=_0x21fac7[_0x1c7728(0xb0)]['magnet'],_0xf1a772=_0x21fac7[_0x1c7728(0xb0)][_0x1c7728(0x9d)],_0x51e494=_0x21fac7[_0x1c7728(0xb0)][_0x1c7728(0xad)],_0x149361=dbDownloadTasksTable[_0x1c7728(0xc2)];if(!_0x181fd7||![dbDownloadTasksTable[_0x1c7728(0xb7)],dbDownloadTasksTable[_0x1c7728(0xbe)],dbDownloadTasksTable['TYPE_TORRENT']][_0x1c7728(0xf6)](_0x181fd7))return _0x21fac7[_0x1c7728(0xd2)][_0x1c7728(0x9b)](_0x508707,_0x1c7728(0xbb));if(dbUserTable[_0x1c7728(0xed)](_0x21fac7,_0x508707,_0x1c7728(0xa6),'power_add','')==!![]){if(_0x181fd7==dbDownloadTasksTable[_0x1c7728(0xb7)]){if(!_0x5868ad)return _0x21fac7['app']['returnErrMsg'](_0x508707,_0x508707['__']('needValidUrl'));_0x5868ad=_0x5868ad[_0x1c7728(0xa8)]('\x0a');}else{if(_0x181fd7==dbDownloadTasksTable['TYPE_MAGNET']){if(!_0x2eb980||!isValidMagnetLink(_0x2eb980))return _0x21fac7[_0x1c7728(0xd2)]['returnErrMsg'](_0x508707,_0x508707['__'](_0x1c7728(0xaa)));_0x149361=dbDownloadTasksTable[_0x1c7728(0xf3)],_0x2eb980=_0x2eb980['split']('\x0a');}else _0x181fd7==dbDownloadTasksTable['TYPE_TORRENT']&&(_0x149361=dbDownloadTasksTable[_0x1c7728(0xf3)]);}if(!_0x51e494&&_0x181fd7==dbDownloadTasksTable[_0x1c7728(0xb7)])return _0x21fac7[_0x1c7728(0xd2)][_0x1c7728(0x9b)](_0x508707,_0x1c7728(0xae));let _0x5e1711=[];_0x51e494?fs['access'](_0x51e494,fs[_0x1c7728(0xf5)]['W_OK']|fs[_0x1c7728(0xf5)][_0x1c7728(0xf8)],_0x324730=>{const _0x3e26ae=_0x1c7728;if(_0x324730)return console[_0x3e26ae(0x9c)](_0x324730),_0x21fac7['app'][_0x3e26ae(0x9b)](_0x508707,_0x508707['__'](_0x3e26ae(0xbd))+':'+_0x51e494);_0x42e197();}):_0x42e197();function _0x42e197(){const _0x34fb49=_0x1c7728;let _0x13c149=[];if(_0x181fd7==dbDownloadTasksTable['TYPE_HTTP']){for(let _0x8490b7 of _0x5868ad){let _0x36310f=dbDownloadTasksTable['getDownloadingTaskByWhere'](_0x21fac7[_0x34fb49(0xd2)]['dbOther'],[_0x34fb49(0xf7)],[_0x8490b7]);if(_0x36310f)return _0x508707[_0x34fb49(0xa0)]({'code':0x2,'data':_0x36310f});}for(let _0x22f489 of _0x5868ad){if(!_0x13c149[_0x34fb49(0xf6)](_0x22f489)){if(isValidUrl(_0x22f489)){let _0x1b7c48=_0x22f489['substring'](_0x22f489['lastIndexOf']('/')+0x1),_0x2fb79d=dbDownloadTasksTable['addTask'](_0x21fac7[_0x34fb49(0xd2)]['dbOther'],_0x21fac7[_0x34fb49(0xec)]['id'],_0x1b7c48,_0x181fd7,_0x149361,_0x51e494,'',_0x22f489);_0x13c149[_0x34fb49(0xdb)](_0x22f489),_0x2fb79d['lastInsertRowid']&&_0x5e1711[_0x34fb49(0xdb)](_0x2fb79d['lastInsertRowid']);}}}}else{if(_0x181fd7==dbDownloadTasksTable[_0x34fb49(0xbe)]){for(let _0xbed94e of _0x2eb980){let _0x622f3e=dbDownloadTasksTable[_0x34fb49(0xf4)](_0x21fac7[_0x34fb49(0xd2)]['dbOther'],[_0x34fb49(0xd1)],[_0xbed94e]);if(_0x622f3e)return _0x508707[_0x34fb49(0xa0)]({'code':0x2,'data':_0x622f3e});}for(let _0x5df643 of _0x2eb980){if(!_0x13c149[_0x34fb49(0xf6)](_0x5df643)){if(isValidMagnetLink(_0x5df643)){let _0x68c7a3=dbDownloadTasksTable[_0x34fb49(0xb1)](_0x21fac7[_0x34fb49(0xd2)][_0x34fb49(0xd6)],_0x21fac7[_0x34fb49(0xec)]['id'],_0x5df643,_0x181fd7,_0x149361,_0x51e494,_0x5df643);_0x13c149[_0x34fb49(0xdb)](_0x5df643),_0x68c7a3[_0x34fb49(0xce)]&&_0x5e1711['push'](_0x68c7a3['lastInsertRowid']);}}}}else{if(_0xf1a772&&_0x181fd7==dbDownloadTasksTable['TYPE_TORRENT']){for(let _0x5eb165 of _0xf1a772){let _0x6c9718=dbDownloadTasksTable[_0x34fb49(0xf4)](_0x21fac7['app']['dbOther'],['torrent_path'],[_0x5eb165]);if(_0x6c9718)return _0x508707[_0x34fb49(0xa0)]({'code':0x2,'data':_0x6c9718});}for(let _0x1acf92 of _0xf1a772){console[_0x34fb49(0x9c)](_0x34fb49(0xdc),_0x1acf92);if(!_0x13c149[_0x34fb49(0xf6)](_0x1acf92)){if(_0x1acf92&&fs['existsSync'](path[_0x34fb49(0xcc)](config[_0x34fb49(0xda)],_0x1acf92))){let _0x2afbe6=dbDownloadTasksTable['addTask'](_0x21fac7[_0x34fb49(0xd2)][_0x34fb49(0xd6)],_0x21fac7[_0x34fb49(0xec)]['id'],_0x1acf92,_0x181fd7,_0x149361,_0x51e494,'','',_0x1acf92);_0x13c149[_0x34fb49(0xdb)](_0x1acf92),_0x2afbe6['lastInsertRowid']&&_0x5e1711[_0x34fb49(0xdb)](_0x2afbe6[_0x34fb49(0xce)]);}}}}}}let _0x519252=[];for(let _0xcd5e6d of _0x5e1711){let _0x22a2eb=dbDownloadTasksTable[_0x34fb49(0xcf)](_0x21fac7['app']['dbOther'],_0xcd5e6d);_0x22a2eb&&_0x519252[_0x34fb49(0xdb)](_0x22a2eb);}return process[_0x34fb49(0xaf)]({'type':_0x34fb49(0xc1),'operation':_0x34fb49(0xd7),'taskObjList':_0x519252}),_0x508707['json']({'code':0x0});}}}),router[_0x38e45e(0xe4)](_0x38e45e(0xe2),(_0x24b31d,_0x153679,_0x55b5d0)=>{const _0x59a2a5=_0x38e45e;let _0x187762=_0x24b31d[_0x59a2a5(0xb0)]['taskId'];if(dbUserTable['doUserCanGet'](_0x24b31d,_0x153679,_0x59a2a5(0xa6),_0x59a2a5(0xa5),'')==!![]){let _0x593157=dbDownloadTasksTable[_0x59a2a5(0xcf)](_0x24b31d[_0x59a2a5(0xd2)]['dbOther'],_0x187762);return process['send']({'type':'downloadTaskChange','operation':_0x59a2a5(0xb2),'taskObj':_0x593157}),_0x153679[_0x59a2a5(0xa0)]({'code':0x0});}}),router['post']('/startTask',(_0x1fa4ba,_0x4788f3,_0x5e71e5)=>{const _0x335e41=_0x38e45e;let _0x4fbf86=_0x1fa4ba['body'][_0x335e41(0xc0)];if(dbUserTable['doUserCanGet'](_0x1fa4ba,_0x4788f3,_0x335e41(0xa6),'power_change','')==!![]){let _0x34a08=dbDownloadTasksTable['getTaskById'](_0x1fa4ba['app'][_0x335e41(0xd6)],_0x4fbf86);return process[_0x335e41(0xaf)]({'type':_0x335e41(0xc1),'operation':'START','taskObj':_0x34a08}),_0x4788f3[_0x335e41(0xa0)]({'code':0x0});}}),router[_0x38e45e(0xe4)](_0x38e45e(0x9e),(_0x4d1be5,_0x4cdc18,_0x1121a7)=>{const _0x463e0b=_0x38e45e;let _0x19b170=_0x4d1be5[_0x463e0b(0xb0)][_0x463e0b(0xc0)];if(dbUserTable[_0x463e0b(0xed)](_0x4d1be5,_0x4cdc18,_0x463e0b(0xa6),_0x463e0b(0xa9),'')==!![]){let _0x389e49=dbDownloadTasksTable['getTaskById'](_0x4d1be5['app'][_0x463e0b(0xd6)],_0x19b170);return _0x4cdc18['json']({'code':0x0,'data':_0x389e49});}}),router['post']('/deleteTask',(_0x20ce7a,_0x295c8c,_0x3e073e)=>{const _0x33f81b=_0x38e45e;let _0x4fe971=_0x20ce7a['body'][_0x33f81b(0xc0)];if(dbUserTable[_0x33f81b(0xed)](_0x20ce7a,_0x295c8c,_0x33f81b(0xa6),_0x33f81b(0xf2),'')==!![]){let _0x4865a5=dbDownloadTasksTable[_0x33f81b(0xcf)](_0x20ce7a[_0x33f81b(0xd2)][_0x33f81b(0xd6)],_0x4fe971);return dbDownloadTasksTable[_0x33f81b(0xd9)](_0x20ce7a[_0x33f81b(0xd2)]['dbOther'],_0x4fe971),process['send']({'type':'downloadTaskChange','operation':_0x33f81b(0xd5),'taskObj':_0x4865a5}),_0x295c8c[_0x33f81b(0xa0)]({'code':0x0});}}),router[_0x38e45e(0xe4)](_0x38e45e(0xea),(_0x5841f2,_0x57180b,_0x122d2c)=>{const _0x5ce3a6=_0x38e45e;let _0x22d3a0=_0x5841f2[_0x5ce3a6(0xb0)][_0x5ce3a6(0xc0)],_0x29288b=_0x5841f2[_0x5ce3a6(0xb0)]['fileList'],_0x342e84=_0x5841f2[_0x5ce3a6(0xb0)]['savePath'];console['log'](_0x5ce3a6(0xe8),_0x29288b);if(dbUserTable[_0x5ce3a6(0xed)](_0x5841f2,_0x57180b,_0x5ce3a6(0xa6),'power_delete','')==!![]){if(!_0x342e84)return _0x5841f2[_0x5ce3a6(0xd2)][_0x5ce3a6(0x9b)](_0x57180b,_0x5ce3a6(0xae));fs['access'](_0x342e84,fs['constants'][_0x5ce3a6(0xc8)]|fs[_0x5ce3a6(0xf5)]['R_OK'],_0x378740=>{const _0x4871ec=_0x5ce3a6;if(_0x378740)return console[_0x4871ec(0x9c)](_0x378740),_0x5841f2[_0x4871ec(0xd2)][_0x4871ec(0x9b)](_0x57180b,_0x57180b['__']('noWritePermission')+':'+_0x342e84);let _0x1c9740=dbDownloadTasksTable[_0x4871ec(0xcf)](_0x5841f2[_0x4871ec(0xd2)][_0x4871ec(0xd6)],_0x22d3a0);if(!_0x1c9740)return _0x5841f2[_0x4871ec(0xd2)]['returnErrMsg'](_0x57180b,_0x4871ec(0xbc));let _0x4844fc=[];if(_0x1c9740[_0x4871ec(0xa3)])try{_0x4844fc=JSON[_0x4871ec(0xd4)](_0x1c9740[_0x4871ec(0xa3)]);}catch(_0x154ff7){console[_0x4871ec(0x9c)](_0x154ff7);}let _0x56df39=0x0;for(let _0x1e8171 of _0x4844fc){for(let _0x5d1311 of _0x29288b){_0x5d1311[_0x4871ec(0xe3)]==_0x1e8171[_0x4871ec(0xe3)]&&_0x5d1311[_0x4871ec(0xeb)]==_0x1e8171[_0x4871ec(0xeb)]&&(_0x1e8171[_0x4871ec(0xc7)]=0x1,_0x56df39+=_0x1e8171[_0x4871ec(0xac)]);}}return dbDownloadTasksTable['updateTaskField'](_0x5841f2[_0x4871ec(0xd2)][_0x4871ec(0xd6)],_0x22d3a0,'save_path',path[_0x4871ec(0xcc)](_0x342e84)),dbDownloadTasksTable[_0x4871ec(0xe6)](_0x5841f2[_0x4871ec(0xd2)]['dbOther'],_0x22d3a0,_0x4871ec(0xa3),JSON[_0x4871ec(0xb9)](_0x4844fc)),dbDownloadTasksTable['updateTaskField'](_0x5841f2[_0x4871ec(0xd2)]['dbOther'],_0x22d3a0,_0x4871ec(0xc4),dbDownloadTasksTable[_0x4871ec(0xc2)]),dbDownloadTasksTable[_0x4871ec(0xe6)](_0x5841f2[_0x4871ec(0xd2)][_0x4871ec(0xd6)],_0x22d3a0,'total_size',_0x56df39),_0x1c9740=dbDownloadTasksTable[_0x4871ec(0xcf)](_0x5841f2[_0x4871ec(0xd2)]['dbOther'],_0x22d3a0),process[_0x4871ec(0xaf)]({'type':_0x4871ec(0xc1),'operation':_0x4871ec(0x99),'taskObj':_0x1c9740}),_0x57180b[_0x4871ec(0xa0)]({'code':0x0,'fileList':_0x29288b});});}}),router[_0x38e45e(0xe4)](_0x38e45e(0xb3),(_0x496057,_0x47bbf9,_0x34452e)=>{const _0x5d82da=_0x38e45e;let _0x4bbd13=['PAUSE_ALL',_0x5d82da(0xa1),_0x5d82da(0xc9)],_0x420e08=_0x496057[_0x5d82da(0xb0)]['operation'];if(!_0x4bbd13[_0x5d82da(0xf6)](_0x420e08))return _0x496057['app'][_0x5d82da(0x9b)](_0x47bbf9,_0x5d82da(0xb5));if(dbUserTable[_0x5d82da(0xed)](_0x496057,_0x47bbf9,_0x5d82da(0xa6),_0x5d82da(0xa5),'')==!![]){if(_0x420e08==_0x5d82da(0xc9)){let _0x51644d=_0x496057[_0x5d82da(0xb0)][_0x5d82da(0xf1)];if(!_0x51644d)return _0x496057[_0x5d82da(0xd2)][_0x5d82da(0x9b)](_0x47bbf9,_0x5d82da(0xe1));dbDownloadTasksTable[_0x5d82da(0xef)](_0x496057['app']['dbOther'],_0x51644d);}return process[_0x5d82da(0xaf)]({'type':'downloadTaskChange','operation':_0x420e08}),_0x47bbf9[_0x5d82da(0xa0)]({'code':0x0});}}),router['post']('/operationTask',(_0x679822,_0x3e119c,_0x4883fe)=>{const _0xd798dc=_0x38e45e;let _0x213c90=_0x679822[_0xd798dc(0xb0)][_0xd798dc(0xc0)],_0x38345d=[_0xd798dc(0xb2),'START',_0xd798dc(0xe0)],_0x5a02d4=_0x679822[_0xd798dc(0xb0)][_0xd798dc(0xc6)];if(!_0x38345d['includes'](_0x5a02d4))return _0x679822[_0xd798dc(0xd2)][_0xd798dc(0x9b)](_0x3e119c,_0xd798dc(0xb5));if(dbUserTable[_0xd798dc(0xed)](_0x679822,_0x3e119c,_0xd798dc(0xa6),_0xd798dc(0xa5),'')==!![]){let _0x38dee2=dbDownloadTasksTable[_0xd798dc(0xcf)](_0x679822[_0xd798dc(0xd2)][_0xd798dc(0xd6)],_0x213c90);return process[_0xd798dc(0xaf)]({'type':_0xd798dc(0xc1),'operation':_0x5a02d4,'taskObj':_0x38dee2}),_0x3e119c['json']({'code':0x0});}}),router[_0x38e45e(0xe4)](_0x38e45e(0xb4),(_0x50ab7f,_0x13330b,_0x5d4451)=>{const _0x559f44=_0x38e45e;let _0x479bb8=_0x50ab7f[_0x559f44(0xb0)][_0x559f44(0xd0)],_0x4a38d8=_0x50ab7f[_0x559f44(0xb0)]['count'],_0x4cf98e=_0x50ab7f[_0x559f44(0xb0)][_0x559f44(0xc3)],_0x503099=_0x50ab7f[_0x559f44(0xb0)]['orderType'],_0x2a3ebe=_0x50ab7f['body'][_0x559f44(0xf1)];if(dbUserTable[_0x559f44(0xed)](_0x50ab7f,_0x13330b,_0x559f44(0xa6),_0x559f44(0xa9),'')==!![]){let _0x49c02e=dbDownloadTasksTable[_0x559f44(0xc5)](_0x50ab7f[_0x559f44(0xd2)][_0x559f44(0xd6)],null,_0x4a38d8,_0x479bb8,_0x4cf98e,_0x503099,_0x2a3ebe);return _0x13330b[_0x559f44(0xa0)]({'code':0x0,'data':_0x49c02e});}}),module[_0x38e45e(0xdd)]=router;