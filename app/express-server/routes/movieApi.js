const _0x46a08d=_0xda69;(function(_0x23f1d8,_0x36e081){const _0x4954b8=_0xda69,_0x3158ec=_0x23f1d8();while(!![]){try{const _0x1557b5=-parseInt(_0x4954b8(0x1e6))/0x1+-parseInt(_0x4954b8(0x198))/0x2+parseInt(_0x4954b8(0x21e))/0x3+parseInt(_0x4954b8(0x160))/0x4*(-parseInt(_0x4954b8(0x1cd))/0x5)+parseInt(_0x4954b8(0x1b5))/0x6+parseInt(_0x4954b8(0x1c2))/0x7*(-parseInt(_0x4954b8(0x1b0))/0x8)+parseInt(_0x4954b8(0x206))/0x9*(parseInt(_0x4954b8(0x1e0))/0xa);if(_0x1557b5===_0x36e081)break;else _0x3158ec['push'](_0x3158ec['shift']());}catch(_0x5cf5b0){_0x3158ec['push'](_0x3158ec['shift']());}}}(_0x332e,0x73a68));var express=require(_0x46a08d(0x14d)),router=express[_0x46a08d(0x20a)]();let path=require(_0x46a08d(0x139));const dbFileIndexTable=require('../../db/dbFileIndexTable'),dbUserTable=require('../../db/dbUserTable');var fs=require('fs');function _0xda69(_0x3d09f0,_0x29609f){const _0x332e46=_0x332e();return _0xda69=function(_0xda690f,_0xd2dedd){_0xda690f=_0xda690f-0x124;let _0xfd7528=_0x332e46[_0xda690f];return _0xfd7528;},_0xda69(_0x3d09f0,_0x29609f);}let config=require('../../myConfig/config'),axios=require(_0x46a08d(0x17b)),sha256=require(_0x46a08d(0x1e4)),nasAccountUtil=require('../utils/nasAccountUtils');const dbConfigTable=require('../../db/dbConfigTable'),videoStreamUtil=require(_0x46a08d(0x1fc)),dbSourceFolderTable=require('../../db/dbSourceFolderTable'),nfoUtil=require('../../utils/nfoUtil'),dbMovieFavorite=require('../../db/dbMovieFavorite'),movieUtil=require(_0x46a08d(0x26d));let fileUtil=require(_0x46a08d(0x21b));const sqliteUtil=require(_0x46a08d(0x138)),photoApiUtils=require(_0x46a08d(0x141));let movieSeasonUtil=require(_0x46a08d(0x265)),movieInfoUtil=require('../../utils/movieInfoUtil');const dbScanTaskTable=require(_0x46a08d(0x1b3));let movieFieldStr=_0x46a08d(0x18b);function getTvSeriesPoster(_0x40edb2){const _0x54773e=_0x46a08d;let _0x31121b='',_0x22fdfb=path['join'](path[_0x54773e(0x24a)](_0x40edb2[_0x54773e(0x139)]),_0x54773e(0x1d9));return fs['existsSync'](_0x22fdfb)&&(_0x31121b=_0x22fdfb),!_0x31121b&&(_0x22fdfb=path['join'](path[_0x54773e(0x24a)](_0x40edb2[_0x54773e(0x139)]),'poster.jpeg'),fs[_0x54773e(0x229)](_0x22fdfb)&&(_0x31121b=_0x22fdfb)),!_0x31121b&&(_0x22fdfb=path['join'](path['dirname'](_0x40edb2[_0x54773e(0x139)]),_0x54773e(0x163)),fs[_0x54773e(0x229)](_0x22fdfb)&&(_0x31121b=_0x22fdfb)),!_0x31121b&&(_0x22fdfb=path[_0x54773e(0x182)](path[_0x54773e(0x24a)](_0x40edb2['path']),_0x54773e(0x197)),fs[_0x54773e(0x229)](_0x22fdfb)&&(_0x31121b=_0x22fdfb)),_0x31121b;}router[_0x46a08d(0x271)](_0x46a08d(0x188),(_0x331821,_0xe3bd37,_0x5ea2f8)=>{const _0x4809db=_0x46a08d;let _0x47978f=_0x331821['body']['id'],_0xee7a43=dbFileIndexTable['getById'](_0x331821['app'][_0x4809db(0x266)],_0x47978f,dbFileIndexTable[_0x4809db(0x270)]);if(!_0xee7a43)return _0x331821[_0x4809db(0x258)][_0x4809db(0x214)](_0xe3bd37,_0xe3bd37['__'](_0x4809db(0x1b7)));if(dbUserTable[_0x4809db(0x248)](_0x331821,_0xe3bd37,_0x4809db(0x13a),_0x4809db(0x158),_0xee7a43['path'])==!![]){let _0x164b8a=dbUserTable['getUserPathWhere'](_0x331821,_0x4809db(0x13a),_0x4809db(0x158),!![]),_0xd5f82d=_0x4809db(0x22d);_0xd5f82d+=_0x164b8a,_0xd5f82d+=_0x4809db(0x250),nfoUtil[_0x4809db(0x140)](_0xee7a43)[_0x4809db(0x22f)](_0x55719d=>{const _0x1598f1=_0x4809db;_0xee7a43=_0x55719d,_0x331821[_0x1598f1(0x191)]['needLogoPathAndFanart']=!![],_0x331821[_0x1598f1(0x191)]['useTvSeriesInfo']=0x1,_0xee7a43=addFolderCoverPath(_0xe3bd37,_0x331821,_0xee7a43),_0x22b051();})[_0x4809db(0x1af)](_0x573b64=>{const _0x1ac28e=_0x4809db;console[_0x1ac28e(0x1ea)](_0x1ac28e(0x235),_0x573b64),_0xee7a43=addFolderCoverPath(_0xe3bd37,_0x331821,_0xee7a43),_0xee7a43[_0x1ac28e(0x185)]=_0xee7a43['tvFolderName'],_0x22b051();});function _0x22b051(){const _0x2733b8=_0x4809db;addTvFolderPathAndName(_0xee7a43),setLogoAndFanart(_0x331821,_0xee7a43,_0xee7a43[_0x2733b8(0x145)]);let _0x5646d1=dbMovieFavorite[_0x2733b8(0x1c1)](_0x331821[_0x2733b8(0x258)][_0x2733b8(0x266)],_0x331821[_0x2733b8(0x149)]['id'],_0xee7a43['id']);_0x5646d1?_0xee7a43['favorite']=0x1:_0xee7a43[_0x2733b8(0x166)]=0x0;let _0x50c601={'code':0x0,'movieIndex':_0xee7a43};fs['stat'](_0xee7a43['tvFolderPath'],(_0x2bbc8d,_0x5a15d2)=>{const _0x3d7d13=_0x2733b8;_0x50c601[_0x3d7d13(0x15e)]=_0x2bbc8d?0x0:0x1,_0xe3bd37[_0x3d7d13(0x12f)](_0x50c601),_0xee7a43[_0x3d7d13(0x25b)]==0x1&&_0xee7a43[_0x3d7d13(0x145)]&&(dbScanTaskTable[_0x3d7d13(0x180)](_0x331821[_0x3d7d13(0x258)][_0x3d7d13(0x26b)],'movie',_0xee7a43['tvFolderPath']),process[_0x3d7d13(0x273)]({'type':_0x3d7d13(0x233),'source_type':'movie','restartWatcher':![]}));});}}}),router['post'](_0x46a08d(0x151),(_0x1571c3,_0x2293a0,_0x51d202)=>{const _0x770b8f=_0x46a08d;let _0x3be933=_0x1571c3[_0x770b8f(0x191)]['id'],_0x488faa=dbFileIndexTable['getById'](_0x1571c3[_0x770b8f(0x258)][_0x770b8f(0x266)],_0x3be933,dbFileIndexTable[_0x770b8f(0x270)]);if(!_0x488faa)return _0x1571c3[_0x770b8f(0x258)][_0x770b8f(0x214)](_0x2293a0,_0x2293a0['__']('index.videoInfoReadFail'));if(dbUserTable[_0x770b8f(0x248)](_0x1571c3,_0x2293a0,_0x770b8f(0x13a),_0x770b8f(0x158),_0x488faa[_0x770b8f(0x139)])==!![]){let _0x52d76d=dbUserTable[_0x770b8f(0x184)](_0x1571c3,_0x770b8f(0x13a),_0x770b8f(0x158),!![]),_0x22af07=_0x770b8f(0x22d);_0x22af07+=_0x52d76d,_0x22af07+=_0x770b8f(0x250),nfoUtil[_0x770b8f(0x1fe)](_0x488faa,!![],![])[_0x770b8f(0x22f)](_0x181604=>{const _0x24f29e=_0x770b8f;_0x488faa=_0x181604,_0x1571c3[_0x24f29e(0x191)][_0x24f29e(0x226)]=!![],_0x488faa=addFolderCoverPath(_0x2293a0,_0x1571c3,_0x488faa),movieInfoUtil['saveMovieInfoToDb'](_0x1571c3['app']['dbFileIndex'],_0x488faa['id'],_0x181604),_0x380f55();})['catch'](()=>{_0x488faa=addFolderCoverPath(_0x2293a0,_0x1571c3,_0x488faa),_0x380f55();});function _0x380f55(){const _0x8f583f=_0x770b8f;let _0x5e7983=dbMovieFavorite[_0x8f583f(0x1c1)](_0x1571c3[_0x8f583f(0x258)][_0x8f583f(0x266)],_0x1571c3[_0x8f583f(0x149)]['id'],_0x488faa['id']);_0x5e7983?_0x488faa[_0x8f583f(0x166)]=0x1:_0x488faa[_0x8f583f(0x166)]=0x0;let _0x386907=null;if(_0x488faa[_0x8f583f(0x25b)]==0x1){let _0x333744=_0x1571c3['app']['dbFileIndex'][_0x8f583f(0x22b)](_0x8f583f(0x27d)+dbFileIndexTable[_0x8f583f(0x270)]+_0x8f583f(0x1ef))[_0x8f583f(0x1fa)](_0x488faa['path']),_0x390657='(';for(let _0x506635 in _0x333744){_0x390657+=_0x333744[_0x506635]['id'],_0x506635!=_0x333744[_0x8f583f(0x15a)]-0x1&&(_0x390657+=',');}_0x390657+=')';let _0x4a961a=_0x1571c3[_0x8f583f(0x258)]['dbFileIndex'][_0x8f583f(0x22b)](_0x8f583f(0x1b1)+_0x390657+_0x8f583f(0x1a4))['get']();_0x4a961a&&(_0x386907=dbFileIndexTable[_0x8f583f(0x134)](_0x1571c3['app'][_0x8f583f(0x266)],_0x4a961a[_0x8f583f(0x147)],dbFileIndexTable[_0x8f583f(0x270)]));}let _0x4d942e={'code':0x0,'movieIndex':_0x488faa,'lastTvEpisodeIndex':_0x386907},_0x51f713=[];try{let _0x20c589=_0x1571c3[_0x8f583f(0x258)]['dbFileIndex']['prepare'](_0x8f583f(0x1f6)+_0x488faa[_0x8f583f(0x139)]+_0x8f583f(0x194))[_0x8f583f(0x1fa)]();for(let _0x55cc5a in _0x20c589){let _0x4bcdfa=path[_0x8f583f(0x182)](_0x20c589[_0x55cc5a][_0x8f583f(0x139)],_0x20c589[_0x55cc5a]['filename']);(_0x1571c3[_0x8f583f(0x149)][_0x8f583f(0x1ce)]==0x1||dbUserTable[_0x8f583f(0x248)](_0x1571c3,_0x2293a0,_0x8f583f(0x1a3),'power_get',_0x4bcdfa,!![])==!![])&&_0x51f713[_0x8f583f(0x127)](_0x4bcdfa);}_0x4d942e['sameFolderImgList']=_0x51f713;}catch(_0x2f2568){}let _0x3f0cd3=path[_0x8f583f(0x182)](_0x488faa[_0x8f583f(0x139)],_0x488faa['filename']);fs[_0x8f583f(0x136)](_0x3f0cd3,(_0x5085df,_0x3b5afe)=>{const _0x1687e7=_0x8f583f;_0x4d942e[_0x1687e7(0x15e)]=_0x5085df?0x0:0x1,_0x4d942e['fileFullPath']=_0x3f0cd3,_0x2293a0[_0x1687e7(0x12f)](_0x4d942e),_0x488faa[_0x1687e7(0x25b)]==0x1&&_0x488faa['tvFolderPath']&&_0x488faa['isTvSeries']!=0x1&&(dbScanTaskTable[_0x1687e7(0x180)](_0x1571c3[_0x1687e7(0x258)][_0x1687e7(0x26b)],_0x1687e7(0x13a),_0x488faa['tvFolderPath']),process[_0x1687e7(0x273)]({'type':_0x1687e7(0x233),'source_type':_0x1687e7(0x13a),'restartWatcher':![]}));});}}}),router[_0x46a08d(0x271)](_0x46a08d(0x1d2),(_0x2bce56,_0x576c4e,_0x1994fd)=>{const _0xd89979=_0x46a08d;let _0x4a46ac=_0x2bce56[_0xd89979(0x191)]['id'],_0x1d7e74=_0x2bce56[_0xd89979(0x191)][_0xd89979(0x178)]||0x0,_0x1f9bab=_0x2bce56[_0xd89979(0x191)][_0xd89979(0x223)]||0xa,_0x285a67=_0x2bce56['body'][_0xd89979(0x168)],_0x52f364=_0x2bce56[_0xd89979(0x191)][_0xd89979(0x192)],_0x5daf13=_0x2bce56[_0xd89979(0x191)]['ignoreTvList'],_0xc064f1=_0x2bce56[_0xd89979(0x191)][_0xd89979(0x1f7)],_0x469631=dbFileIndexTable[_0xd89979(0x134)](_0x2bce56['app'][_0xd89979(0x266)],_0x4a46ac,dbFileIndexTable[_0xd89979(0x270)]);if(!_0x469631)return _0x2bce56[_0xd89979(0x258)][_0xd89979(0x214)](_0x576c4e,_0x576c4e['__'](_0xd89979(0x1b7)));let _0xa2500a=movieFieldStr,_0x296172=[],_0x4d522f=0x0;if(dbUserTable[_0xd89979(0x248)](_0x2bce56,_0x576c4e,_0xd89979(0x13a),_0xd89979(0x158),_0x469631['path'])==!![]){if(_0x5daf13==0x1)return _0x1a689b();let _0x5061e9=_0x2bce56[_0xd89979(0x258)][_0xd89979(0x266)][_0xd89979(0x22b)](_0xd89979(0x1c3)+dbFileIndexTable[_0xd89979(0x270)]+_0xd89979(0x150))[_0xd89979(0x1fa)](_0x469631[_0xd89979(0x139)]);for(let _0x162288 in _0x5061e9){let _0x3c4a12=_0x5061e9[_0x162288];if(_0x3c4a12[_0xd89979(0x153)]){let _0x88d197=movieUtil[_0xd89979(0x1b9)](_0x3c4a12[_0xd89979(0x153)]);_0x2bce56['app'][_0xd89979(0x266)][_0xd89979(0x22b)]('UPDATE\x20'+dbFileIndexTable[_0xd89979(0x270)]+_0xd89979(0x1c8))[_0xd89979(0x25c)](_0x88d197,_0x3c4a12['id']);}}let _0x286c5c=dbUserTable[_0xd89979(0x184)](_0x2bce56,_0xd89979(0x13a),_0xd89979(0x158),!![]),_0xf20e73=_0xd89979(0x1aa);_0xf20e73+=_0x286c5c,_0xf20e73+='\x20and\x20path=?\x20and\x20is_tvplay=1\x20';_0x285a67&&(_0xf20e73+=_0xd89979(0x19c));if(_0x52f364){let _0x394661=movieUtil[_0xd89979(0x1b9)](_0x52f364);_0x394661?_0xf20e73+=_0xd89979(0x262):_0xf20e73+=_0xd89979(0x207);}let _0x523117=_0xf20e73;_0xf20e73+=_0xd89979(0x193);let _0x57096e=_0xd89979(0x1e2)+_0xa2500a+'\x20FROM\x20'+dbFileIndexTable[_0xd89979(0x270)]+'\x20as\x20f\x20WHERE\x20'+_0xf20e73+_0xd89979(0x172)+_0x1f9bab+_0xd89979(0x16e)+_0x1d7e74*_0x1f9bab;_0x296172=_0x2bce56[_0xd89979(0x258)][_0xd89979(0x266)]['prepare'](_0x57096e);if(_0x285a67&&_0x52f364)_0x296172=_0x296172[_0xd89979(0x1fa)](_0x469631['path'],'%'+_0x285a67+'%','%'+_0x285a67+'%');else{if(_0x285a67)_0x296172=_0x296172['all'](_0x469631['path'],'%'+_0x285a67+'%','%'+_0x285a67+'%');else{if(_0x52f364){let _0x5336ee=movieUtil[_0xd89979(0x1b9)](_0x52f364);_0x296172=_0x296172[_0xd89979(0x1fa)](_0x469631[_0xd89979(0x139)],_0x5336ee?_0x5336ee:_0x52f364);}else _0x296172=_0x296172[_0xd89979(0x1fa)](_0x469631[_0xd89979(0x139)]);}}let _0x4600f7=_0xd89979(0x1fd)+dbFileIndexTable[_0xd89979(0x270)]+'\x20\x20WHERE\x20'+_0x523117+'\x20',_0x689fb2=_0x2bce56['app'][_0xd89979(0x266)]['prepare'](_0x4600f7);if(_0x285a67&&_0x52f364)_0x689fb2=_0x689fb2['get'](_0x469631[_0xd89979(0x139)],'%'+_0x285a67+'%','%'+_0x285a67+'%');else{if(_0x285a67)_0x689fb2=_0x689fb2['get'](_0x469631[_0xd89979(0x139)],'%'+_0x285a67+'%','%'+_0x285a67+'%');else _0x52f364?_0x689fb2=_0x689fb2[_0xd89979(0x18a)](_0x469631['path'],_0x52f364):_0x689fb2=_0x689fb2[_0xd89979(0x18a)](_0x469631[_0xd89979(0x139)]);}_0x4d522f=_0x689fb2['count'];if(_0x296172['length']>0x0){let _0x5d0782=0x0;for(let _0x4af279 in _0x296172){let _0x439faa=_0x296172[_0x4af279];nfoUtil[_0xd89979(0x1fe)](_0x439faa,!![],!![])[_0xd89979(0x22f)](_0x52a27c=>{const _0x55187b=_0xd89979;_0x5d0782+=0x1,_0x296172[_0x4af279]=_0x52a27c,_0x296172[_0x4af279]=addFolderCoverPath(_0x576c4e,_0x2bce56,_0x296172[_0x4af279],!![]),_0x5d0782>=_0x296172[_0x55187b(0x15a)]&&_0x1a689b();})[_0xd89979(0x1af)](()=>{const _0x155c37=_0xd89979;_0x5d0782+=0x1,_0x296172[_0x4af279]=addFolderCoverPath(_0x576c4e,_0x2bce56,_0x296172[_0x4af279],!![]),_0x5d0782>=_0x296172[_0x155c37(0x15a)]&&_0x1a689b();});}}else _0x1a689b();function _0x1a689b(){const _0x5091bb=_0xd89979;let _0x2e1b56={'code':0x0,'tvplayList':_0x296172,'count':_0x4d522f,'pageSize':_0x1f9bab};if(!_0xc064f1){let _0x5b71c0=path[_0x5091bb(0x212)](_0x469631['path']),_0x36b948=movieSeasonUtil[_0x5091bb(0x1ba)](_0x5b71c0);if(_0x36b948>-0x1){let _0x3b5e72=_0x5091bb(0x1e2)+_0xa2500a+_0x5091bb(0x217)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x5091bb(0x24b),_0x3af81e=_0x2bce56[_0x5091bb(0x258)][_0x5091bb(0x266)][_0x5091bb(0x22b)](_0x3b5e72)[_0x5091bb(0x1fa)](path[_0x5091bb(0x24a)](_0x469631[_0x5091bb(0x139)])+path[_0x5091bb(0x186)]+'%'),_0x4c581c=[];for(let _0xc9f017 of _0x3af81e){let _0x15c644=path[_0x5091bb(0x212)](_0xc9f017[_0x5091bb(0x139)]),_0xc62edd=movieSeasonUtil[_0x5091bb(0x1ba)](_0x15c644);_0xc62edd>-0x1&&(_0xc9f017[_0x5091bb(0x1f3)]=_0xc62edd,_0x4c581c['push'](_0xc9f017));}for(let _0x318769 of _0x4c581c){_0x318769=addFolderCoverPath(_0x576c4e,_0x2bce56,_0x318769);let _0x31d2f7=dbFileIndexTable[_0x5091bb(0x1a5)](_0x2bce56['app'][_0x5091bb(0x266)],_0x318769);_0x318769['tvCount']=_0x31d2f7[_0x5091bb(0x1e5)];}_0x4c581c[_0x5091bb(0x15a)]>0x0&&(_0x4c581c['sort'](function(_0x6ad9cd,_0x5d1254){const _0x13c0dd=_0x5091bb;return _0x6ad9cd[_0x13c0dd(0x1f3)]-_0x5d1254[_0x13c0dd(0x1f3)];}),_0x2e1b56[_0x5091bb(0x24e)]=_0x4c581c);}}return _0x576c4e[_0x5091bb(0x12f)](_0x2e1b56);}}}),router[_0x46a08d(0x271)]('/removeIndexFromCollection',(_0x385606,_0x4e2a03,_0x4e254d)=>{const _0x5c94de=_0x46a08d;let _0x76430c=_0x385606[_0x5c94de(0x191)][_0x5c94de(0x1cf)],_0x51546c=[];for(let _0x28df77 of _0x76430c){let _0x866ff5=dbFileIndexTable[_0x5c94de(0x134)](_0x385606[_0x5c94de(0x258)]['dbFileIndex'],_0x28df77,dbFileIndexTable[_0x5c94de(0x270)]);if(!_0x866ff5)continue;if(dbUserTable[_0x5c94de(0x248)](_0x385606,_0x4e2a03,'','power_change',_0x866ff5['path'])!==!![])continue;let _0x4efe62=path['basename'](_0x866ff5[_0x5c94de(0x139)]),_0x5a6b05=movieSeasonUtil[_0x5c94de(0x1ba)](_0x4efe62);if(_0x5a6b05>-0x1){let _0x3c4e91=path[_0x5c94de(0x182)](path[_0x5c94de(0x24a)](_0x866ff5[_0x5c94de(0x139)])),_0x329e60=_0x385606['app'][_0x5c94de(0x266)][_0x5c94de(0x22b)]('select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2')[_0x5c94de(0x1fa)](_0x3c4e91+path[_0x5c94de(0x186)]+'%',_0x3c4e91);for(let _0x5b87d4 of _0x329e60){_0x51546c[_0x5c94de(0x127)](_0x5b87d4['id']);}}}_0x51546c[_0x5c94de(0x15a)]>0x0&&(_0x76430c=[..._0x76430c,..._0x51546c]);if(_0x76430c[_0x5c94de(0x15a)]<0x1)return _0x4e2a03[_0x5c94de(0x12f)]({'code':0x0});let _0x251d13='(';for(let _0x43db9f in _0x76430c){_0x251d13+=_0x76430c[_0x43db9f],_0x43db9f!=_0x76430c[_0x5c94de(0x15a)]-0x1&&(_0x251d13+=',');}return _0x251d13+=')',_0x385606[_0x5c94de(0x258)][_0x5c94de(0x266)]['prepare'](_0x5c94de(0x19d)+_0x251d13)['run'](),_0x4e2a03['json']({'code':0x0});}),router['post'](_0x46a08d(0x1f0),(_0x237e87,_0x304359,_0xd38a82)=>{const _0x5e3912=_0x46a08d;let _0x3118e7=_0x237e87[_0x5e3912(0x191)][_0x5e3912(0x12e)],_0x22ada2=_0x237e87[_0x5e3912(0x191)][_0x5e3912(0x1a7)],_0x5cfe56=_0x237e87[_0x5e3912(0x191)][_0x5e3912(0x1c0)];function _0x53ad70(_0x27fc90){const _0x465e52=_0x5e3912;let _0x356567=[];for(let _0x3d5486 in _0x27fc90){_0x356567[_0x465e52(0x127)](_0x27fc90[_0x3d5486]['id']);}inSql='(';for(let _0x3ab41b in _0x356567){inSql+=_0x356567[_0x3ab41b],_0x3ab41b!=_0x356567[_0x465e52(0x15a)]-0x1&&(inSql+=',');}return inSql+=')',inSql;}if(_0x3118e7&&_0x22ada2){let _0x3862f8=dbFileIndexTable[_0x5e3912(0x134)](_0x237e87[_0x5e3912(0x258)][_0x5e3912(0x266)],_0x22ada2,dbFileIndexTable[_0x5e3912(0x270)]),_0x2f2d5c='('+_0x22ada2+')';if(!_0x3862f8)return _0x237e87[_0x5e3912(0x258)][_0x5e3912(0x214)](_0x304359,_0x304359['__'](_0x5e3912(0x179)),_0x5e3912(0x16d));if(dbUserTable[_0x5e3912(0x248)](_0x237e87,_0x304359,'','power_change',_0x3862f8['path'])!==!![])return;let _0x1c44a5=path[_0x5e3912(0x212)](_0x3862f8['path']),_0xcb651c=movieSeasonUtil[_0x5e3912(0x1ba)](_0x1c44a5);_0xcb651c>-0x1&&(_0x3862f8[_0x5e3912(0x25d)]=0x0,_0x3862f8[_0x5e3912(0x139)]=path[_0x5e3912(0x24a)](_0x3862f8[_0x5e3912(0x139)]),_0x3862f8[_0x5e3912(0x153)]='');if(_0x3862f8[_0x5e3912(0x25d)]!=0x1){let _0x23e4c5=path[_0x5e3912(0x182)](_0x3862f8[_0x5e3912(0x139)],_0x3862f8[_0x5e3912(0x153)]);console['log'](_0x5e3912(0x213),_0x23e4c5);let _0x8a8713=_0x237e87['app']['dbFileIndex']['prepare'](_0x5e3912(0x231))['all'](_0x23e4c5+path[_0x5e3912(0x186)]+'%',_0x23e4c5);if(_0x8a8713[_0x5e3912(0x15a)]<0x1)return _0x304359['json']({'code':0x0});_0x2f2d5c=_0x53ad70(_0x8a8713);}return _0x237e87[_0x5e3912(0x258)][_0x5e3912(0x266)][_0x5e3912(0x22b)](_0x5e3912(0x255)+_0x2f2d5c+_0x5e3912(0x23a))[_0x5e3912(0x25c)](_0x3118e7),_0x304359['json']({'code':0x0});}else{if(_0x3118e7&&_0x5cfe56){let _0x13fe83=_0x237e87[_0x5e3912(0x258)][_0x5e3912(0x266)]['prepare']('select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2')[_0x5e3912(0x1fa)](_0x5cfe56+path[_0x5e3912(0x186)]+'%',_0x5cfe56),_0x2f606d=_0x53ad70(_0x13fe83);return _0x237e87[_0x5e3912(0x258)]['dbFileIndex']['prepare'](_0x5e3912(0x255)+_0x2f606d+'\x20and\x20show_in_list=1')[_0x5e3912(0x25c)](_0x3118e7),_0x304359[_0x5e3912(0x12f)]({'code':0x0});}else return _0x237e87['app'][_0x5e3912(0x214)](_0x304359,_0x304359['__'](_0x5e3912(0x179)),_0x5e3912(0x16d));}});function getCollectionList(_0x9a4fb0,_0x2dc660,_0x4ae0d3){const _0x5a0a4f=_0x46a08d;let _0x47f1e8=[],_0x39487d=_0x9a4fb0[_0x5a0a4f(0x191)]['count']||0x32,_0x411b25=_0x9a4fb0[_0x5a0a4f(0x191)]['offset']||0x0,_0x5c2a7d=_0x9a4fb0[_0x5a0a4f(0x191)][_0x5a0a4f(0x1cb)]||'id',_0x5c6f89=_0x9a4fb0[_0x5a0a4f(0x191)][_0x5a0a4f(0x1ee)]||_0x5a0a4f(0x15d),_0x14c60d=_0x9a4fb0[_0x5a0a4f(0x191)][_0x5a0a4f(0x175)],_0x53350c=_0x5a0a4f(0x240),_0x3ac9fc=_0x5a0a4f(0x1ae)+_0x53350c+_0x5a0a4f(0x22c),_0x3801b3=[_0x4ae0d3];_0x14c60d&&(_0x3ac9fc+='\x20AND\x20title\x20like\x20?\x20',_0x3801b3['push']('%'+_0x14c60d+'%'));_0x9a4fb0[_0x5a0a4f(0x149)]['is_admin']!=0x1&&(_0x3ac9fc+=_0x5a0a4f(0x199),_0x3801b3[_0x5a0a4f(0x127)](0x1));_0x3ac9fc+=_0x5a0a4f(0x16b)+_0x5c2a7d+'\x20'+_0x5c6f89+'\x20LIMIT\x20?\x20OFFSET\x20?',_0x3801b3[_0x5a0a4f(0x127)](_0x39487d),_0x3801b3['push'](_0x411b25),_0x47f1e8=_0x9a4fb0[_0x5a0a4f(0x258)][_0x5a0a4f(0x266)]['prepare'](_0x3ac9fc)[_0x5a0a4f(0x1fa)](_0x3801b3);for(let _0x327139 of _0x47f1e8){if(_0x327139['enable_pwd']==0x1)continue;let _0x5de0cf=getMoviesByParams(_0x2dc660,_0x9a4fb0,null,'id',0x1,0x0,_0x5a0a4f(0x15d),null,null,null,null,null,null,_0x327139['id']);_0x5de0cf[_0x5a0a4f(0x15a)]>0x0&&(_0x327139[_0x5a0a4f(0x234)]=_0x5de0cf[0x0]);}return _0x47f1e8;}router[_0x46a08d(0x271)]('/getCollection',(_0xa9b19b,_0x167852,_0x416bdb)=>{const _0xc7090c=_0x46a08d;let _0x52b2d6=_0xa9b19b[_0xc7090c(0x191)]['type']||_0xc7090c(0x267),_0x4cc10a=getCollectionList(_0xa9b19b,_0x167852,_0x52b2d6);return _0x167852[_0xc7090c(0x12f)]({'code':0x0,'data':_0x4cc10a});}),router[_0x46a08d(0x271)](_0x46a08d(0x154),(_0x3455a6,_0x5b07d7,_0x416d4b)=>{const _0x158310=_0x46a08d;let _0x15d284=_0x3455a6['body'][_0x158310(0x1d3)],_0x11c98c=_0x3455a6['body']['collectionId'];if(!_0x15d284)return _0x3455a6[_0x158310(0x258)]['returnErrMsg'](_0x5b07d7,_0x5b07d7['__'](_0x158310(0x143)),_0x158310(0x16d));_0x15d284=sha256(_0x15d284);let _0x339c04=_0x3455a6[_0x158310(0x258)][_0x158310(0x266)][_0x158310(0x22b)]('SELECT\x20id,title,enable_pwd,create_time\x20FROM\x20movie_collection\x20where\x20id=?\x20and\x20pwd=?')[_0x158310(0x18a)](_0x11c98c,_0x15d284);if(!_0x339c04)return _0x3455a6[_0x158310(0x258)][_0x158310(0x214)](_0x5b07d7,_0x5b07d7['__'](_0x158310(0x239)),'dialog');return _0x5b07d7[_0x158310(0x12f)]({'code':0x0,'data':_0x339c04});}),router['post'](_0x46a08d(0x17e),(_0x2aec33,_0x212689,_0x4ea2d6)=>{const _0x105dfe=_0x46a08d;let _0x25ecc6=_0x2aec33[_0x105dfe(0x191)]['title'],_0x192bb0=_0x2aec33[_0x105dfe(0x191)][_0x105dfe(0x276)],_0x5c1b4d=_0x2aec33['body'][_0x105dfe(0x1d3)],_0x57d684=_0x2aec33[_0x105dfe(0x191)]['collectionId'],_0x2031f3=_0x2aec33[_0x105dfe(0x191)][_0x105dfe(0x210)]?_0x2aec33[_0x105dfe(0x191)][_0x105dfe(0x210)]:_0x105dfe(0x267),_0x4c5aec=_0x2aec33[_0x105dfe(0x191)]['data']?_0x2aec33[_0x105dfe(0x191)][_0x105dfe(0x205)]:'',_0x4aadd8=_0x2aec33['body'][_0x105dfe(0x1f9)]?_0x2aec33[_0x105dfe(0x191)]['coverPath']:'',_0x456f59=_0x2aec33[_0x105dfe(0x191)][_0x105dfe(0x20c)];_0x456f59==null&&(_0x456f59=0x1);if(_0x2031f3==_0x105dfe(0x13f)){if(!_0x4c5aec||!_0x4c5aec[_0x105dfe(0x189)]||sqliteUtil[_0x105dfe(0x249)](_0x4c5aec[_0x105dfe(0x189)])==!![])return _0x2aec33[_0x105dfe(0x258)][_0x105dfe(0x214)](_0x212689,'error\x20data');}let _0x3b9a91=_0x2aec33['body'][_0x105dfe(0x12a)]?_0x2aec33[_0x105dfe(0x191)][_0x105dfe(0x12a)]:'';if(_0x2aec33[_0x105dfe(0x149)][_0x105dfe(0x1ce)]!=0x1)return _0x2aec33[_0x105dfe(0x258)]['returnErrMsg'](_0x212689,_0x212689['__'](_0x105dfe(0x208)));if(_0x192bb0=='1'){if(!_0x5c1b4d)return _0x2aec33[_0x105dfe(0x258)][_0x105dfe(0x214)](_0x212689,_0x212689['__']('pwdCanNotBeNull'),_0x105dfe(0x16d));_0x5c1b4d=sha256(_0x5c1b4d);}return _0x57d684?_0x2aec33[_0x105dfe(0x258)][_0x105dfe(0x266)]['prepare'](_0x105dfe(0x23f))[_0x105dfe(0x25c)](_0x25ecc6,JSON[_0x105dfe(0x129)](_0x4c5aec),_0x192bb0+'',_0x5c1b4d,_0x4aadd8,_0x3b9a91,_0x456f59,_0x57d684):_0x2aec33[_0x105dfe(0x258)][_0x105dfe(0x266)][_0x105dfe(0x22b)](_0x105dfe(0x135))[_0x105dfe(0x25c)](_0x25ecc6,_0x192bb0+'',_0x5c1b4d,_0x2aec33['currentUser']['id']+'',_0x2031f3,JSON[_0x105dfe(0x129)](_0x4c5aec),_0x4aadd8,_0x3b9a91,_0x456f59),_0x212689[_0x105dfe(0x12f)]({'code':0x0});}),router[_0x46a08d(0x271)](_0x46a08d(0x156),(_0x44e774,_0xf547d3,_0xbcb34b)=>{const _0x399a87=_0x46a08d;let _0x3e61d7=_0x44e774[_0x399a87(0x191)][_0x399a87(0x12e)];if(_0x44e774[_0x399a87(0x149)][_0x399a87(0x1ce)]!=0x1)return _0x44e774[_0x399a87(0x258)][_0x399a87(0x214)](_0xf547d3,_0xf547d3['__'](_0x399a87(0x208)));return _0x44e774[_0x399a87(0x258)][_0x399a87(0x266)][_0x399a87(0x22b)](_0x399a87(0x1c6))[_0x399a87(0x25c)](_0x3e61d7),_0x44e774[_0x399a87(0x258)]['dbFileIndex'][_0x399a87(0x22b)](_0x399a87(0x181))[_0x399a87(0x25c)](_0x3e61d7),_0xf547d3[_0x399a87(0x12f)]({'code':0x0});}),router[_0x46a08d(0x271)](_0x46a08d(0x227),(_0x5a73b2,_0x2c4ea3,_0x159d60)=>{const _0x1a18ed=_0x46a08d;return _0x5a73b2['app'][_0x1a18ed(0x266)][_0x1a18ed(0x22b)](_0x1a18ed(0x221)+_0x5a73b2['currentUser']['id'])[_0x1a18ed(0x25c)](),_0x2c4ea3[_0x1a18ed(0x12f)]({'code':0x0});}),router[_0x46a08d(0x271)](_0x46a08d(0x200),(_0x9cae10,_0x3bfc45,_0x1096b0)=>{const _0x426f75=_0x46a08d;let _0x4db012=_0x9cae10[_0x426f75(0x191)][_0x426f75(0x1a7)],_0x205ccb=_0x9cae10[_0x426f75(0x191)][_0x426f75(0x12d)],_0x3ca185=dbFileIndexTable['getById'](_0x9cae10[_0x426f75(0x258)]['dbFileIndex'],_0x4db012,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x3ca185)return _0x3bfc45[_0x426f75(0x12f)]({'code':0x0});if(_0x3ca185[_0x426f75(0x277)]){let _0x5502cf=_0x9cae10[_0x426f75(0x258)][_0x426f75(0x266)]['prepare'](_0x426f75(0x18c))['get'](_0x3ca185[_0x426f75(0x277)]);if(_0x5502cf&&_0x5502cf[_0x426f75(0x18e)]==0x1)return _0x3bfc45[_0x426f75(0x12f)]({'code':0x0});}let _0x112192=_0x9cae10[_0x426f75(0x258)][_0x426f75(0x266)]['prepare'](_0x426f75(0x1f1))[_0x426f75(0x18a)](_0x4db012+'',_0x9cae10['currentUser']['id']+'');return _0x112192?_0x9cae10[_0x426f75(0x258)][_0x426f75(0x266)]['prepare'](_0x426f75(0x202))[_0x426f75(0x25c)](_0x205ccb,new Date()[_0x426f75(0x244)](),_0x4db012+'',_0x9cae10[_0x426f75(0x149)]['id']+''):_0x9cae10[_0x426f75(0x258)]['dbFileIndex'][_0x426f75(0x22b)](_0x426f75(0x18f))[_0x426f75(0x25c)](_0x4db012+'',_0x9cae10[_0x426f75(0x149)]['id']+'',_0x205ccb,new Date()[_0x426f75(0x244)]()),_0x3bfc45[_0x426f75(0x12f)]({'code':0x0});}),router[_0x46a08d(0x271)](_0x46a08d(0x27c),(_0x1b7b41,_0xa9b119,_0x4a9654)=>{const _0x17eeb9=_0x46a08d;let _0x534a2c=_0x1b7b41[_0x17eeb9(0x191)]['indexId'],_0x4804d4='m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id';if(_0x534a2c){let _0x637741=_0x1b7b41[_0x17eeb9(0x258)][_0x17eeb9(0x266)][_0x17eeb9(0x22b)]('SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?')[_0x17eeb9(0x18a)](_0x1b7b41['currentUser']['id']+'',_0x534a2c+'');return _0xa9b119['json']({'code':0x0,'data':_0x637741});}else{let _0x4a3fae=_0x17eeb9(0x1e2)+_0x4804d4+'\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id='+_0x1b7b41[_0x17eeb9(0x149)]['id']+_0x17eeb9(0x18d),_0x20a6e1=_0x1b7b41[_0x17eeb9(0x258)][_0x17eeb9(0x266)][_0x17eeb9(0x22b)](_0x4a3fae)[_0x17eeb9(0x1fa)]();return _0xa9b119[_0x17eeb9(0x12f)]({'code':0x0,'data':_0x20a6e1});}}),router[_0x46a08d(0x271)]('/getIndexDetail',(_0x36182d,_0x17ee0f,_0x26c99b)=>{const _0x3b08e7=_0x46a08d;let _0x199200=_0x36182d[_0x3b08e7(0x191)]['id'],_0x1ddc99=dbFileIndexTable[_0x3b08e7(0x134)](_0x36182d[_0x3b08e7(0x258)]['dbFileIndex'],_0x199200,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(dbUserTable[_0x3b08e7(0x248)](_0x36182d,_0x17ee0f,_0x3b08e7(0x13a),_0x3b08e7(0x158),_0x1ddc99[_0x3b08e7(0x139)])==!![]){let _0x4b86ca={'code':0x0,'data':_0x1ddc99};return _0x17ee0f['json'](_0x4b86ca);}}),router['post'](_0x46a08d(0x215),(_0x562f6f,_0x8e3263,_0x46674f)=>{const _0x4413f9=_0x46a08d;let _0x843119=_0x562f6f[_0x4413f9(0x191)]['sourceFolderId'],_0x45c092=_0x562f6f[_0x4413f9(0x191)]['ignoreMatchInfo'];if(dbUserTable[_0x4413f9(0x1ed)](_0x562f6f,_0x8e3263)===!![]){let _0xfad3d=dbSourceFolderTable[_0x4413f9(0x134)](_0x562f6f[_0x4413f9(0x258)][_0x4413f9(0x26b)],_0x843119);if(!_0xfad3d)return _0x8e3263[_0x4413f9(0x228)](0x194)['end']();return _0x45c092==0x1?(_0x562f6f[_0x4413f9(0x258)][_0x4413f9(0x266)]['prepare'](_0x4413f9(0x13b))[_0x4413f9(0x25c)](_0xfad3d[_0x4413f9(0x139)]+path['sep']+'%',_0xfad3d[_0x4413f9(0x139)]),dbSourceFolderTable[_0x4413f9(0x1ff)](_0x562f6f[_0x4413f9(0x258)][_0x4413f9(0x26b)],_0x4413f9(0x23b),_0x45c092,_0x843119),process[_0x4413f9(0x273)]({'type':_0x4413f9(0x133)}),_0x8e3263[_0x4413f9(0x12f)]({'code':0x0})):(dbSourceFolderTable[_0x4413f9(0x1ff)](_0x562f6f[_0x4413f9(0x258)]['dbOther'],_0x4413f9(0x23b),_0x45c092,_0x843119),_0x562f6f['app'][_0x4413f9(0x266)][_0x4413f9(0x22b)](_0x4413f9(0x1bd))[_0x4413f9(0x25c)](_0xfad3d[_0x4413f9(0x139)]+path[_0x4413f9(0x186)]+'%',_0xfad3d[_0x4413f9(0x139)]),process['send']({'type':_0x4413f9(0x133)}),_0x8e3263['json']({'code':0x0}));}}),router[_0x46a08d(0x271)]('/setTvplay',(_0x5e1517,_0x2a775b,_0xea7582)=>{const _0x43063c=_0x46a08d;let _0x52f363=_0x5e1517[_0x43063c(0x191)]['isTvPlay'],_0x4e12bd=_0x5e1517[_0x43063c(0x191)][_0x43063c(0x1a7)],_0x4592b8=_0x5e1517[_0x43063c(0x191)][_0x43063c(0x148)];function _0x127bc0(_0x381cd9){const _0x25bf88=_0x43063c;let _0x275ae6=_0x5e1517['app'][_0x25bf88(0x266)][_0x25bf88(0x22b)](_0x25bf88(0x146)+dbFileIndexTable[_0x25bf88(0x270)]+_0x25bf88(0x260))[_0x25bf88(0x18a)](_0x381cd9);if(!_0x275ae6)return;_0x5e1517[_0x25bf88(0x258)][_0x25bf88(0x266)][_0x25bf88(0x22b)](_0x25bf88(0x167)+dbFileIndexTable[_0x25bf88(0x270)]+_0x25bf88(0x241))[_0x25bf88(0x25c)](_0x381cd9),_0x5e1517[_0x25bf88(0x258)][_0x25bf88(0x266)][_0x25bf88(0x22b)](_0x25bf88(0x167)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20SET\x20show_in_list=1\x20WHERE\x20id=?')[_0x25bf88(0x25c)](_0x275ae6['id']),movieUtil[_0x25bf88(0x220)](_0x5e1517[_0x25bf88(0x258)]['dbFileIndex'],_0x275ae6);}if(_0x4e12bd){let _0x5a7355=dbFileIndexTable[_0x43063c(0x134)](_0x5e1517[_0x43063c(0x258)]['dbFileIndex'],_0x4e12bd,dbFileIndexTable[_0x43063c(0x270)]);if(dbUserTable[_0x43063c(0x248)](_0x5e1517,_0x2a775b,'movie',_0x43063c(0x1dd),_0x5a7355[_0x43063c(0x139)])==!![])return _0x52f363==0x1?_0x127bc0(_0x5a7355[_0x43063c(0x139)]):_0x5e1517[_0x43063c(0x258)]['dbFileIndex'][_0x43063c(0x22b)](_0x43063c(0x167)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20SET\x20show_in_list\x20=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=\x27'+_0x5a7355['path']+'\x27')['run'](),_0x2a775b[_0x43063c(0x12f)]({'code':0x0});}else{if(_0x4592b8){let _0x3b2fc5=dbSourceFolderTable['getById'](_0x5e1517['app'][_0x43063c(0x26b)],_0x4592b8);if(!_0x3b2fc5||_0x3b2fc5[_0x43063c(0x210)]!=_0x43063c(0x13a))return _0x5e1517['app'][_0x43063c(0x214)](_0x2a775b,_0x2a775b['__']('operationFail'),_0x43063c(0x16d));if(_0x52f363==0x1){dbSourceFolderTable[_0x43063c(0x1ff)](_0x5e1517[_0x43063c(0x258)][_0x43063c(0x26b)],_0x43063c(0x13d),_0x43063c(0x21a),_0x4592b8),_0x127bc0(_0x3b2fc5[_0x43063c(0x139)]);let _0x570737=_0x5e1517[_0x43063c(0x258)]['dbFileIndex'][_0x43063c(0x22b)](_0x43063c(0x155)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x43063c(0x1f4))['all'](_0x3b2fc5[_0x43063c(0x139)],''+_0x3b2fc5[_0x43063c(0x139)]+path[_0x43063c(0x186)]+'%');for(let _0x49f42f in _0x570737){let _0x2f1616=path[_0x43063c(0x182)](_0x570737[_0x49f42f]['path'],_0x570737[_0x49f42f][_0x43063c(0x153)]);_0x127bc0(_0x2f1616);}}else{dbSourceFolderTable[_0x43063c(0x1ff)](_0x5e1517[_0x43063c(0x258)][_0x43063c(0x26b)],'media_type',_0x43063c(0x13a),_0x4592b8);let _0xfd628a=_0x5e1517[_0x43063c(0x258)][_0x43063c(0x266)][_0x43063c(0x22b)]('UPDATE\x20'+dbFileIndexTable[_0x43063c(0x270)]+'\x20SET\x20show_in_list=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=?\x20or\x20path\x20like\x20?')[_0x43063c(0x25c)](_0x3b2fc5[_0x43063c(0x139)],''+_0x3b2fc5[_0x43063c(0x139)]+path[_0x43063c(0x186)]+'%');}return _0x2a775b[_0x43063c(0x12f)]({'code':0x0});}else return _0x5e1517[_0x43063c(0x258)][_0x43063c(0x214)](_0x2a775b,_0x2a775b['__'](_0x43063c(0x179)),_0x43063c(0x16d));}});function setLogoAndFanart(_0x390182,_0x97cd8b,_0x9e9be7,_0x5e4d92){const _0x385d0e=_0x46a08d;if(_0x390182['body'][_0x385d0e(0x226)]){let _0x5b7ac5=_0x385d0e(0x162),_0x2d32b3=[_0x9e9be7];_0x5e4d92?(_0x5b7ac5+=_0x385d0e(0x253),_0x2d32b3[_0x385d0e(0x127)](_0x385d0e(0x174)),_0x2d32b3[_0x385d0e(0x127)](_0x5e4d92+_0x385d0e(0x176)),_0x2d32b3[_0x385d0e(0x127)](_0x5e4d92+_0x385d0e(0x1b6))):(_0x5b7ac5+=_0x385d0e(0x1b8),_0x2d32b3['push'](_0x385d0e(0x174)));let _0x388015=_0x390182['app'][_0x385d0e(0x266)][_0x385d0e(0x22b)](_0x5b7ac5)['get'](_0x2d32b3);if(_0x388015){let _0x37d511=path[_0x385d0e(0x182)](_0x388015['path'],_0x388015['filename']);_0x97cd8b['logo_path']=_0x37d511;}let _0xbedba5='SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20',_0x1defaa=[_0x9e9be7];_0x5e4d92?(_0xbedba5+=_0x385d0e(0x274),_0x1defaa[_0x385d0e(0x127)](_0x385d0e(0x1bb)),_0x1defaa[_0x385d0e(0x127)](_0x5e4d92+_0x385d0e(0x254)),_0x1defaa[_0x385d0e(0x127)](_0x5e4d92+_0x385d0e(0x1be))):(_0xbedba5+=_0x385d0e(0x1b8),_0x1defaa['push'](_0x385d0e(0x1bb)));let _0x4277ea=_0x390182[_0x385d0e(0x258)][_0x385d0e(0x266)][_0x385d0e(0x22b)](_0xbedba5)[_0x385d0e(0x18a)](_0x1defaa);if(_0x4277ea){let _0x1bc7a8=path['join'](_0x4277ea[_0x385d0e(0x139)],_0x4277ea[_0x385d0e(0x153)]);_0x97cd8b[_0x385d0e(0x12c)]=_0x1bc7a8;}}}function _0x332e(){const _0x461a0e=['/addIndexToCollection','SELECT\x20*\x20from\x20movie_history\x20WHERE\x20index_id=?\x20and\x20user_id=?','collectionPwd','seasonNumber','\x20WHERE\x20is_file=0\x20and\x20(path=?\x20or\x20path\x20like\x20?)\x20','videoPath','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27','ignoreSeasonList','/getMovies','coverPath','all','getAllByWhereAndField','../../utils/videoStreamUtil','SELECT\x20count(*)\x20as\x20count\x20FROM\x20','parseNfo','updateByWhere','/addHistory','/getMovieHomeData','UPDATE\x20movie_history\x20SET\x20time=?,create_time=?\x20where\x20index_id=?\x20AND\x20user_id=?','autoSkip','tvFolderName','data','2853pBUEAj','\x20and\x20filename\x20>=\x20?\x20','noPermission','getFavoriteList','Router','FAVORITE','shareForSubUser','getPhotoByParams','excludeIds','.vtt','type','/getSameNameSubtitles','basename','checkPath','returnErrMsg','/switchMatchInfo','\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id=','\x20FROM\x20','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','%season','tvplay','../utils/fileUtils','/deleteIndex','duration','2118813kOxCTg','movie_director','dealFirstLetterSingle','DELETE\x20FROM\x20movie_history\x20where\x20user_id=','genresType','pageSize','concat','check_time','needLogoPathAndFanart','/clearHistory','status','existsSync','movieGenres','prepare','\x20FROM\x20\x20movie_collection\x20WHERE\x20type=?','\x20type=2\x20and\x20is_file=1\x20and\x20id!=?\x20and\x20collection_id=0\x20','name','then','\x20WHERE\x20title\x20like\x20?','select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2','replaceAll','startScanPath','coverMovie','未找到NFO信息','movie_actor','value','timeType','login.pwdErr','\x20and\x20show_in_list=1','ignore_match_info','share_uid','heic','endsWith','UPDATE\x20movie_collection\x20SET\x20title=?,data=?,enable_pwd=?,pwd=?,collection_cover_path=?,data_value=?,share_for_subuser=?\x20WHERE\x20id=?','\x20id,title,data,enable_pwd,collection_cover_path,data_value,create_time,share_for_subuser\x20','\x20SET\x20show_in_list\x20=0,is_tvplay=1\x20WHERE\x20path=?','\x20AND\x20(filename_fl=?\x20AND\x20show_name_fl=?\x20AND\x20movie_info_name_fl=?)','\x20type=2','getTime','offset','folder_cover_path','decodePath','doUserCanGet','checkSqlInjection','dirname','\x20as\x20f\x20WHERE\x20path\x20like\x20?\x20and\x20is_tvplay=1\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20limit\x20200','getExcludePathWhereStr','now','seasonList','key_value','\x20order\x20by\x20check_time\x20desc\x20limit\x2010\x20','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20?\x20or\x20filename\x20like\x20?)\x20and\x20filename\x20not\x20like\x20?','trash','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20\x20or\x20filename\x20like\x20?)','-fanart.%','UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20','set','power_delete','app','-HD','%poster%','is_tvplay','run','is_file','\x20AND\x20is_tvplay==1','\x20ORDER\x20BY\x20','\x20WHERE\x20path=?\x20and\x20is_file=1\x20and\x20type=2\x20order\x20by\x20filename','replace','\x20and\x20filename_number\x20>=\x20?\x20','defaultTranscodeResolution','EDIT','../../utils/movieSeasonUtil','dbFileIndex','ordinary','\x20AND\x20is_tvplay==0','\x20LIMIT\x20?\x20OFFSET\x20?','getAllFavoriteByWhere','dbOther','1080p\x203mbps','../utils/movieUtil','\x20AND\x20(path\x20like\x20?\x20OR\x20filename\x20like\x20?\x20OR\x20movie_info_name\x20like\x20?\x20)','\x20LIKE\x20\x27%','INDEX_TABLE_NAME_MOVIE','post','show_name','send','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20or\x20filename\x20like\x20?)','.ass','enablePwd','collection_id','dataPreview','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20filename\x20like\x20?','/getMovieKeys','/getHistory','SELECT\x20id\x20FROM\x20','ALL','DELETE\x20FROM\x20movie_library\x20\x20WHERE\x20id=?','ADD','trim','push','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_language\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','stringify','dataValue','useTvSeriesInfo','fanart_path','time','collectionId','json','movieLanguage','exports','GET','SWITCH_MOVIE_INFO','getById','REPLACE\x20INTO\x20movie_collection(title,enable_pwd,pwd,user_id,type,data,collection_cover_path,data_value,share_for_subuser)\x20VALUES(\x20?,?,?,?,?,?,?,?,?)','stat','user_list','../utils/sqliteUtil','path','movie','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=3\x20WHERE\x20path\x20like\x20?\x20OR\x20path=?','has','media_type','-FHD','smart','parseNfoTvSeries','./photoApiUtils','SELECT\x20*\x20FROM\x20source_folder\x20WHERE\x20type=?\x20LIMIT\x2010','pwdCanNotBeNull','.srt','tvFolderPath','SELECT\x20*\x20from\x20','index_id','sourceFolderId','currentUser','needTvCount','endDuration','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20id=?','express','operation','\x20AND\x20(','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20and\x20filename_number\x20is\x20null','/getMovieDetail','-QHD','filename','/checkCollectionPwd','SELECT\x20path,filename\x20from\x20','/deleteCollection','UPDATE\x20movie_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','power_get','sourceType','length','index_count','sortField','desc','fileExist','pageCount','36CbcXcH','/getTvHomeData','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20','folder.jpg','firstLetter','movieShowMatchName','favorite','UPDATE\x20','searchStr','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20share_for_subuser=1','isTvSeries','\x20order\x20by\x20','create_time','dialog','\x20OFFSET\x20','movie_index_id','sortType','extname','\x20LIMIT\x20','SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?','clearlogo.%','search','-clearlogo.%','shareUidList','page','operationFail','movieHomeShowMyMedia','axios','libraryId','\x20AND\x20(filename_fl=?\x20OR\x20show_name_fl=?\x20OR\x20movie_info_name_fl=?)','/addCollection','\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20check_time\x20DESC\x20LIMIT\x20','addScanTask','DELETE\x20FROM\x20movie_collection\x20WHERE\x20id=?','join','movieTvCache','getUserPathWhere','movie_info_name','sep','openDuration','/getTvSeriesDetail','searchValue','get','\x20id,collection_id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list','SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2050','enable_pwd','REPLACE\x20INTO\x20movie_history(index_id,user_id,time,create_time)\x20VALUES(\x20?,?,?,?)','movieHomeShowHistory','body','fromName','\x20order\x20by\x20filename_number,filename','\x27\x20and\x20type=1\x20and\x20is_file=1\x20limit\x2020','movie_genres','getCountByWhere','thumb.jpg','1355102HufDfh','\x20AND\x20share_for_subuser\x20=\x20?\x20','\x20and\x20title\x20like\x20?','startsWith','\x20and\x20(filename\x20like\x20?\x20or\x20movie_info_name\x20like\x20?)\x20','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20WHERE\x20id\x20in\x20','\x27\x20or\x20filename\x20like\x20\x27','pathList','movieActors','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_movie\x20WHERE\x20path\x20like\x20?\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1','excludePathMovie','folder','\x20order\x20by\x20create_time\x20desc','getTvCount','\x27\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27','indexId','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay==1','timestamp','\x20type=2\x20and\x20is_file=1','seasonCount','.jpg','/operationLibrary','\x20SELECT\x20','catch','4936HYpjOm','SELECT\x20index_id\x20FROM\x20movie_history\x20where\x20index_id\x20in\x20','sourceFolderList','../../db/dbScanTaskTable','\x20AND\x20','1156998eMpkxj','.clearlogo.%','index.videoInfoReadFail','(filename\x20like\x20?)','getFilenameNumber','getSeasonNumber','fanart.%','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_regions\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0\x20WHERE\x20(path\x20like\x20?\x20OR\x20path=?)','.fanart.%','includes','filepath','getFavorite','7833kBhtst','SELECT\x20id,filename\x20FROM\x20','HEIC','/movieFavorite','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20where\x20collection_id=?','\x20AND\x20collection_id=0','\x20SET\x20filename_number=?\x20\x20WHERE\x20\x20id=?','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20','UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?','orderField','substr','282565WVwinD','is_admin','indexIdList','needSeasonCount','%fanart%','/getTvList','pwd','\x20AND\x20collection_id\x20=\x20','title','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)','findByTitle','\x20AND\x20id\x20NOT\x20IN\x20(','poster.jpg','parse','\x20order\x20by\x20m.create_time\x20desc\x20limit\x201','movie_language','power_change','history','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay!=1','70610fOuAtp','movieDirectors','SELECT\x20','addFavorite','sha256','count','787146gFLjBk','\x20or\x20','movieCollectionNotExist','REPLACE\x20INTO\x20movie_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','log','deleteFavorite','error\x20pathList','isAdmin','orderType','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20'];_0x332e=function(){return _0x461a0e;};return _0x332e();}function addTvFolderPathAndName(_0x229ec6){const _0x28e087=_0x46a08d;_0x229ec6[_0x28e087(0x204)]=path[_0x28e087(0x212)](_0x229ec6[_0x28e087(0x139)]),_0x229ec6[_0x28e087(0x145)]=_0x229ec6[_0x28e087(0x139)];if(_0x229ec6[_0x28e087(0x25b)]==0x1){let _0x419da4=path[_0x28e087(0x212)](_0x229ec6[_0x28e087(0x139)]),_0x28e32b=path[_0x28e087(0x24a)](_0x229ec6[_0x28e087(0x139)]),_0x583136=movieSeasonUtil[_0x28e087(0x1ba)](_0x419da4);_0x583136>-0x1&&(_0x229ec6[_0x28e087(0x204)]=path[_0x28e087(0x212)](_0x28e32b),_0x229ec6[_0x28e087(0x145)]=_0x28e32b);if(!_0x229ec6[_0x28e087(0x272)])_0x229ec6['show_name']=_0x229ec6[_0x28e087(0x204)];}}function addFolderCoverPath(_0x4dfe98,_0x541e81,_0x5ebec4,_0x5427f5=![]){const _0x4e2424=_0x46a08d;let _0x5ebb94;addTvFolderPathAndName(_0x5ebec4);let _0x4bd43a=_0x5ebec4['id']+'-coverCache-'+_0x5427f5;!_0x541e81['movieTvCache']&&(_0x541e81[_0x4e2424(0x183)]=new Map());try{if(_0x5ebec4[_0x4e2424(0x25b)]==0x1&&!_0x5427f5)try{let _0x5125c8=path[_0x4e2424(0x212)](_0x5ebec4[_0x4e2424(0x139)]),_0x705c50=path[_0x4e2424(0x24a)](_0x5ebec4[_0x4e2424(0x139)]),_0x4e7b78=movieSeasonUtil[_0x4e2424(0x1ba)](_0x5125c8);if(_0x4e7b78>-0x1){_0x5ebec4[_0x4e2424(0x16a)]=0x1,_0x5ebec4[_0x4e2424(0x1f3)]=_0x4e7b78;if(_0x541e81[_0x4e2424(0x191)][_0x4e2424(0x1d0)]){let _0x30881b=_0x705c50+'-seasonCount-'+_0x5427f5;_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x13c)](_0x30881b)?_0x5ebec4['seasonCount']=_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x18a)](_0x30881b):(_0x5ebec4[_0x4e2424(0x1ab)]=_0x541e81['app'][_0x4e2424(0x266)]['prepare'](_0x4e2424(0x1a1))['get'](''+_0x705c50+path[_0x4e2424(0x186)]+'%')[_0x4e2424(0x1e5)],_0x541e81[_0x4e2424(0x183)]['set'](_0x30881b,_0x5ebec4[_0x4e2424(0x1ab)]));}}setLogoAndFanart(_0x541e81,_0x5ebec4,_0x5ebec4[_0x4e2424(0x145)]);if(_0x541e81[_0x4e2424(0x191)]['useTvSeriesInfo']==0x1&&_0x4e7b78>-0x1){let _0x31ea5c=_0x5ebec4[_0x4e2424(0x145)]+'-seriesPoster';if(_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x13c)](_0x31ea5c))return _0x5ebec4[_0x4e2424(0x246)]=_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x18a)](_0x31ea5c),_0x5ebec4;let _0x4d4be2=getTvSeriesPoster(_0x5ebec4);if(_0x4d4be2)return _0x541e81[_0x4e2424(0x183)][_0x4e2424(0x256)](_0x31ea5c,_0x4d4be2),_0x5ebec4[_0x4e2424(0x246)]=_0x4d4be2,_0x5ebec4;}if(!_0x5ebb94&&_0x541e81['movieTvCache']['has'](_0x4bd43a))return _0x5ebec4[_0x4e2424(0x246)]=_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x18a)](_0x4bd43a),_0x5ebec4;if(!_0x5ebb94&&_0x4e7b78>-0x1){parseInt(_0x4e7b78)<0xa&&(_0x4e7b78='0'+_0x4e7b78);let _0x5d3475=_0x4e2424(0x219)+_0x4e7b78+'%poster%',_0x15c680='%s'+_0x4e7b78+_0x4e2424(0x25a),_0x3c1e93=_0x4e2424(0x1f6)+_0x705c50+_0x4e2424(0x1a6)+_0x5d3475+_0x4e2424(0x19e)+_0x15c680+'\x27)';_0x5ebb94=_0x541e81[_0x4e2424(0x258)][_0x4e2424(0x266)][_0x4e2424(0x22b)](_0x3c1e93)[_0x4e2424(0x18a)]();}!_0x5ebb94&&(_0x5ebb94=_0x541e81[_0x4e2424(0x258)][_0x4e2424(0x266)]['prepare']('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)')[_0x4e2424(0x18a)](_0x5ebec4[_0x4e2424(0x139)]));}catch(_0x495a30){console[_0x4e2424(0x1ea)](_0x495a30);}else{if(_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x13c)](_0x4bd43a))return _0x5ebec4[_0x4e2424(0x246)]=_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x18a)](_0x4bd43a),_0x5ebec4;let _0x4b889a=path[_0x4e2424(0x1da)](_0x5ebec4[_0x4e2424(0x153)]),_0x73bd8a=_0x4b889a[_0x4e2424(0x22e)],_0x212ca8=path[_0x4e2424(0x182)](_0x5ebec4[_0x4e2424(0x139)],_0x73bd8a+_0x4e2424(0x1ac));if(fs[_0x4e2424(0x229)](_0x212ca8))return _0x5ebec4[_0x4e2424(0x246)]=_0x212ca8,_0x5ebec4;!_0x5ebb94&&(_0x5ebb94=_0x541e81['app'][_0x4e2424(0x266)]['prepare'](_0x4e2424(0x27a))[_0x4e2424(0x18a)](_0x5ebec4[_0x4e2424(0x139)],'%'+_0x73bd8a+'%poster%'));if(!_0x5ebb94){let _0x6b9d78=_0x73bd8a;(_0x73bd8a[_0x4e2424(0x23e)](_0x4e2424(0x259))||_0x73bd8a['endsWith'](_0x4e2424(0x13e))||_0x73bd8a[_0x4e2424(0x23e)](_0x4e2424(0x152))||_0x73bd8a[_0x4e2424(0x23e)]('-UHD'))&&(_0x73bd8a[_0x4e2424(0x23e)](_0x4e2424(0x259))?_0x6b9d78=_0x6b9d78[_0x4e2424(0x1cc)](0x0,_0x6b9d78[_0x4e2424(0x15a)]-0x3):_0x6b9d78=_0x6b9d78[_0x4e2424(0x1cc)](0x0,_0x6b9d78['length']-0x4)),_0x5ebb94=_0x541e81[_0x4e2424(0x258)][_0x4e2424(0x266)]['prepare'](_0x4e2424(0x251))['get'](_0x5ebec4[_0x4e2424(0x139)],_0x73bd8a+'%',_0x6b9d78+'%',_0x4e2424(0x1d1));}!_0x5ebb94&&(_0x5ebb94=_0x541e81['app'][_0x4e2424(0x266)][_0x4e2424(0x22b)](_0x4e2424(0x1d6))['get'](_0x5ebec4[_0x4e2424(0x139)]));let {name:_0x13772f}=path['parse'](_0x5ebec4['filename']);setLogoAndFanart(_0x541e81,_0x5ebec4,_0x5ebec4[_0x4e2424(0x139)],_0x13772f);}if(_0x5ebb94){let _0x1f5878=path['join'](_0x5ebb94[_0x4e2424(0x139)],_0x5ebb94[_0x4e2424(0x153)]);!_0x1f5878[_0x4e2424(0x23e)](_0x4e2424(0x1c4))&&!_0x1f5878[_0x4e2424(0x23e)](_0x4e2424(0x23d))&&fs[_0x4e2424(0x229)](_0x1f5878)?(_0x5ebec4[_0x4e2424(0x246)]=_0x1f5878,_0x541e81[_0x4e2424(0x183)][_0x4e2424(0x256)](_0x4bd43a,_0x5ebec4[_0x4e2424(0x246)])):_0x541e81['movieTvCache']['set'](_0x4bd43a,'');}return _0x5ebec4;}catch(_0x3a12c6){return console['log'](_0x3a12c6),_0x5ebec4;}}function getMoviesByParams(_0x255ee2,_0x22ed9f,_0x16592e,_0x28043f,_0x37deb,_0x2b2383,_0x3db0ff,_0x7e8260,_0x5f3110,_0x264a4b,_0x2f2f92,_0x27dd1b,_0x1bfdda,_0x1c0513,_0x422cc5,_0x321e2e,_0x19d44e,_0xc423cb){const _0x284a71=_0x46a08d;let _0x160bd5=movieFieldStr;_0xc423cb&&(_0x160bd5=_0xc423cb);!_0x422cc5&&(_0x422cc5='ALL');let _0x552429='',_0x1386d1=[],_0x32f8b0=dbUserTable['getUserPathWhere'](_0x22ed9f,_0x284a71(0x13a),_0x284a71(0x158),!![],_0x264a4b);if(_0x22ed9f[_0x284a71(0x149)]['is_admin']!=0x1&&!_0x32f8b0)return[];_0x552429+=_0x284a71(0x243);_0x5f3110&&(_0x5f3110=_0x5f3110[_0x284a71(0x261)]('\x27','')[_0x284a71(0x261)]('’',''),_0x552429+=_0x284a71(0x26e),_0x1386d1[_0x284a71(0x127)]('%'+_0x5f3110+'%'),_0x1386d1[_0x284a71(0x127)]('%'+_0x5f3110+'%'),_0x1386d1[_0x284a71(0x127)]('%'+_0x5f3110+'%'));let _0x8c542b=dbSourceFolderTable[_0x284a71(0x24c)](_0x22ed9f[_0x284a71(0x258)][_0x284a71(0x26b)],'path',_0x284a71(0x1a2));_0x8c542b&&(_0x552429+='\x20AND\x20'+_0x8c542b);let _0x110b5c=dbSourceFolderTable[_0x284a71(0x24c)](_0x22ed9f[_0x284a71(0x258)][_0x284a71(0x26b)],_0x284a71(0x153),'excludeFilenameMovie');_0x110b5c&&(_0x552429+='\x20AND\x20'+_0x110b5c);function _0x20cfcb(_0x32341a,_0x56a0d9){const _0x221848=_0x284a71;let _0x102340=_0x221848(0x14f);try{let _0x46801b=JSON[_0x221848(0x1da)](_0x56a0d9),_0x432c69=![];for(let _0xdc0001=0x0;_0xdc0001<_0x46801b['length'];_0xdc0001++){if(!_0x46801b[_0xdc0001])continue;_0x432c69=!![],_0x102340+='\x20'+_0x32341a+'\x20like\x20?\x20',_0x1386d1['push']('%'+_0x46801b[_0xdc0001][_0x221848(0x126)]()+'%'),_0xdc0001!=_0x46801b[_0x221848(0x15a)]-0x1&&(_0x102340+=_0x221848(0x1e7));}_0x102340+=')',_0x432c69&&(_0x552429+=_0x102340);}catch(_0x44f481){console[_0x221848(0x1ea)](_0x44f481);}}_0x2f2f92&&_0x20cfcb('movie_regions',_0x2f2f92);_0x27dd1b&&_0x20cfcb(_0x284a71(0x1dc),_0x27dd1b);_0x1bfdda&&_0x20cfcb(_0x284a71(0x195),_0x1bfdda);_0x22ed9f[_0x284a71(0x191)]['movieActors']&&_0x22ed9f[_0x284a71(0x191)][_0x284a71(0x1a0)]['length']>0x0&&_0x22ed9f[_0x284a71(0x191)][_0x284a71(0x1a0)][0x0]!=''&&_0x20cfcb(_0x284a71(0x236),_0x22ed9f['body']['movieActors']);_0x22ed9f[_0x284a71(0x191)][_0x284a71(0x1e1)]&&_0x22ed9f[_0x284a71(0x191)]['movieDirectors']['length']>0x0&&_0x22ed9f['body'][_0x284a71(0x1e1)][0x0]!=''&&_0x20cfcb(_0x284a71(0x21f),_0x22ed9f[_0x284a71(0x191)]['movieDirectors']);if(_0x19d44e){let _0x3480cd=_0x22ed9f[_0x284a71(0x258)][_0x284a71(0x266)][_0x284a71(0x22b)](_0x284a71(0x14c))['get'](_0x19d44e);if(_0x3480cd)try{let _0x3b1e45=JSON['parse'](_0x3480cd['path_list']),_0xf496b=dbUserTable['getPathWhere'](!![],_0x3b1e45);_0x552429+=_0xf496b;}catch(_0x34c4e2){console[_0x284a71(0x1ea)](_0x34c4e2);}}else{!_0x1c0513&&(_0x1c0513=0x0);let _0x427028;if(_0x1c0513!=0x0){_0x427028=_0x22ed9f[_0x284a71(0x258)][_0x284a71(0x266)][_0x284a71(0x22b)](_0x284a71(0x18c))[_0x284a71(0x18a)](_0x1c0513);if(!_0x427028)return _0x22ed9f[_0x284a71(0x258)][_0x284a71(0x214)](_0x255ee2,_0x255ee2['__'](_0x284a71(0x1e8)));if(_0x427028[_0x284a71(0x18e)]==0x1){let _0x43f104=_0x22ed9f['body'][_0x284a71(0x1f2)];if(!_0x43f104||_0x427028[_0x284a71(0x1d3)]!=sha256(_0x43f104))return _0x22ed9f[_0x284a71(0x258)]['returnErrMsg'](_0x255ee2,_0x255ee2['__'](_0x284a71(0x239)));}}if(_0x427028&&_0x427028[_0x284a71(0x210)]==_0x284a71(0x13f))try{_0x427028[_0x284a71(0x205)]=JSON['parse'](_0x427028[_0x284a71(0x205)]),_0x552429+=_0x284a71(0x1b4)+_0x427028[_0x284a71(0x205)][_0x284a71(0x189)];}catch(_0x133be7){console[_0x284a71(0x1ea)](_0x133be7);}else _0x552429+=_0x284a71(0x1d4)+_0x1c0513;}if(_0x16592e){if(_0x16592e==0x1)_0x552429+=_0x284a71(0x268);else _0x16592e==0x2&&(_0x552429+=_0x284a71(0x25e));}_0x321e2e&&(_0x321e2e=='#'?(_0x552429+=_0x284a71(0x242),_0x1386d1['push'](_0x321e2e),_0x1386d1['push'](_0x321e2e),_0x1386d1[_0x284a71(0x127)](_0x321e2e)):(_0x552429+=_0x284a71(0x17d),_0x1386d1['push'](_0x321e2e),_0x1386d1[_0x284a71(0x127)](_0x321e2e),_0x1386d1[_0x284a71(0x127)](_0x321e2e)));if(_0x7e8260&&_0x7e8260['length']>0x0){_0x552429+=_0x284a71(0x1d8);for(let _0x334092=0x0;_0x334092<_0x7e8260['length'];_0x334092++){_0x552429+=_0x7e8260[_0x334092],_0x334092!=_0x7e8260['length']-0x1&&(_0x552429+=',');}_0x552429+=')';}_0x552429+=_0x32f8b0;_0x28043f&&_0x3db0ff?_0x552429+=_0x284a71(0x1c9)+_0x28043f+'\x20'+_0x3db0ff:_0x552429+=_0x284a71(0x279);!_0x37deb&&(_0x37deb=0x32);_0x552429+='\x20LIMIT\x20?\x20OFFSET\x20?',_0x1386d1[_0x284a71(0x127)](_0x37deb),_0x1386d1[_0x284a71(0x127)](_0x2b2383);let _0x3d8627=[];if(_0x422cc5==_0x284a71(0x20b))_0x3d8627=dbMovieFavorite[_0x284a71(0x26a)](_0x22ed9f[_0x284a71(0x258)]['dbFileIndex'],_0x22ed9f[_0x284a71(0x149)]['id'],_0x552429,_0x160bd5,_0x1386d1);else _0x422cc5==_0x284a71(0x27e)&&(_0x3d8627=dbFileIndexTable['getAllByWhereAndField'](_0x22ed9f[_0x284a71(0x258)][_0x284a71(0x266)],_0x552429,_0x160bd5,dbFileIndexTable[_0x284a71(0x270)],_0x1386d1));if(_0x3d8627['length']<0x1)return _0x3d8627;let _0x86e806=[];for(let _0x1f8b2a in _0x3d8627){_0x86e806[_0x284a71(0x127)](_0x3d8627[_0x1f8b2a]['id']);}let _0x243161=dbMovieFavorite['getFavoriteList'](_0x22ed9f[_0x284a71(0x258)]['dbFileIndex'],_0x22ed9f['currentUser']['id'],_0x86e806);for(let _0x1faacb=0x0;_0x1faacb<_0x3d8627['length'];_0x1faacb++){_0x3d8627[_0x1faacb][_0x284a71(0x166)]=0x0;for(let _0x2b6f58 in _0x243161){if(_0x243161[_0x2b6f58]['movie_index_id']==_0x3d8627[_0x1faacb]['id']){_0x3d8627[_0x1faacb][_0x284a71(0x166)]=0x1;break;}}let _0xfc6daa=_0x22ed9f[_0x284a71(0x258)][_0x284a71(0x266)][_0x284a71(0x22b)](_0x284a71(0x173))[_0x284a71(0x18a)](_0x22ed9f[_0x284a71(0x149)]['id']+'',_0x3d8627[_0x1faacb]['id']+'');_0xfc6daa&&(_0x3d8627[_0x1faacb][_0x284a71(0x1de)]=_0xfc6daa);_0x3d8627[_0x1faacb]=addFolderCoverPath(_0x255ee2,_0x22ed9f,_0x3d8627[_0x1faacb]);if(_0x3d8627[_0x1faacb][_0x284a71(0x25b)]==0x1&&_0x22ed9f[_0x284a71(0x191)]['needTvCount']){let _0x1142a1=dbFileIndexTable['getTvCount'](_0x22ed9f[_0x284a71(0x258)][_0x284a71(0x266)],_0x3d8627[_0x1faacb]);_0x3d8627[_0x1faacb]['tvCount']=_0x1142a1['count'];}}return _0x3d8627;}function getShowMatchName(_0x267efa){let _0x34de77=dbConfigTable['findByTitle'](_0x267efa,'movieShowMatchName');return!_0x34de77||_0x34de77&&_0x34de77['value']!=0x0?0x1:0x0;}router[_0x46a08d(0x271)](_0x46a08d(0x1f8),(_0x3335cb,_0x4c8ae1,_0x2be0a3)=>{const _0x74420d=_0x46a08d;if(dbUserTable[_0x74420d(0x248)](_0x3335cb,_0x4c8ae1,_0x74420d(0x13a),_0x74420d(0x158))==!![]){let _0x5e4c24=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x1e5)],_0x1cf676=_0x3335cb['body']['offset'],_0x1fc3c7=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x15c)],_0x71d446=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x170)],_0x21445c=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x20e)],_0xbc173b=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x168)],_0x5a67b2=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x1b2)],_0x5af80c=_0x3335cb['body']['movieRegion'],_0xe1d842=_0x3335cb['body'][_0x74420d(0x130)],_0x1050e9=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x22a)],_0x58417a=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x159)],_0x1bd95b=_0x3335cb[_0x74420d(0x191)]['collectionId'],_0x1ad7e4=_0x3335cb['body']['listType'],_0x4c3a65=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x164)],_0x4a03cc=_0x3335cb[_0x74420d(0x191)][_0x74420d(0x17c)];_0x3335cb['body'][_0x74420d(0x14a)]=!![],_0x3335cb['body'][_0x74420d(0x1d0)]=!![];let _0x2bdd03=getMoviesByParams(_0x4c8ae1,_0x3335cb,_0x58417a,_0x1fc3c7,_0x5e4c24,_0x1cf676,_0x71d446,_0x21445c,_0xbc173b,_0x5a67b2,_0x5af80c,_0xe1d842,_0x1050e9,_0x1bd95b,_0x1ad7e4,_0x4c3a65,_0x4a03cc);return _0x4c8ae1['json']({'movieShowMatchName':getShowMatchName(_0x3335cb[_0x74420d(0x258)]['dbOther']),'code':0x0,'data':_0x2bdd03});}}),router['post']('/getMoviesByGenres',(_0x476df8,_0x229a91,_0xea5d6d)=>{const _0x2fefc6=_0x46a08d;if(dbUserTable[_0x2fefc6(0x248)](_0x476df8,_0x229a91,_0x2fefc6(0x13a),_0x2fefc6(0x158))==!![]){let _0x15f06b=_0x476df8[_0x2fefc6(0x191)][_0x2fefc6(0x1b2)],_0x1b5c0c=_0x476df8[_0x2fefc6(0x191)][_0x2fefc6(0x15f)],_0x2e5cc2=_0x476df8[_0x2fefc6(0x191)][_0x2fefc6(0x159)];!_0x1b5c0c&&(_0x1b5c0c=0x9);let _0xdd653f='\x20id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list',_0x67a4bc='';_0x15f06b?_0x67a4bc=dbUserTable['getUserPathWhere'](_0x476df8,_0x2fefc6(0x13a),_0x2fefc6(0x158),!![],_0x15f06b):_0x67a4bc=dbUserTable[_0x2fefc6(0x184)](_0x476df8,'movie',_0x2fefc6(0x158),!![]);let _0x50e742=_0x476df8[_0x2fefc6(0x191)][_0x2fefc6(0x222)];!_0x50e742&&(_0x50e742=_0x2fefc6(0x195));let _0xfc6ac6=_0x476df8[_0x2fefc6(0x258)][_0x2fefc6(0x266)][_0x2fefc6(0x22b)]('SELECT\x20*\x20FROM\x20movie_keys\x20WHERE\x20key_type=?\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20200')[_0x2fefc6(0x1fa)](_0x50e742),_0x543f5d=[];for(let _0x6d175c of _0xfc6ac6){let _0x33952d=_0x6d175c[_0x2fefc6(0x24f)],_0x424d46=_0x2fefc6(0x243);_0x424d46+=_0x67a4bc,_0x424d46+=_0x2fefc6(0x1c7);if(_0x2e5cc2){if(_0x2e5cc2==0x1)_0x424d46+=_0x2fefc6(0x268);else _0x2e5cc2==0x2&&(_0x424d46+=_0x2fefc6(0x25e));}_0x424d46+=_0x2fefc6(0x1b4)+_0x50e742+_0x2fefc6(0x26f)+_0x33952d+'%\x27',_0x424d46+=_0x2fefc6(0x17f)+_0x1b5c0c;let _0x2111e6=dbFileIndexTable[_0x2fefc6(0x1fb)](_0x476df8[_0x2fefc6(0x258)][_0x2fefc6(0x266)],_0x424d46,_0xdd653f,dbFileIndexTable[_0x2fefc6(0x270)]),_0xda3b6=[];for(let _0x1546d5 in _0x2111e6){_0xda3b6[_0x2fefc6(0x127)](_0x2111e6[_0x1546d5]['id']);}let _0x29a05b=dbMovieFavorite[_0x2fefc6(0x209)](_0x476df8[_0x2fefc6(0x258)][_0x2fefc6(0x266)],_0x476df8['currentUser']['id'],_0xda3b6);for(let _0x22f7e9=0x0;_0x22f7e9<_0x2111e6['length'];_0x22f7e9++){_0x2111e6[_0x22f7e9][_0x2fefc6(0x166)]=0x0;for(let _0x246d9c in _0x29a05b){if(_0x29a05b[_0x246d9c]['movie_index_id']==_0x2111e6[_0x22f7e9]['id']){_0x2111e6[_0x22f7e9][_0x2fefc6(0x166)]=0x1;break;}}_0x2111e6[_0x22f7e9]=addFolderCoverPath(_0x229a91,_0x476df8,_0x2111e6[_0x22f7e9]);}_0x2111e6[_0x2fefc6(0x15a)]>0x0&&_0x543f5d[_0x2fefc6(0x127)]({'genresType':_0x50e742,'genresValue':_0x33952d,'movieList':_0x2111e6,'indexCount':_0x6d175c[_0x2fefc6(0x15b)]});}_0x229a91['json']({'code':0x0,'data':_0x543f5d,'movieShowMatchName':getShowMatchName(_0x476df8[_0x2fefc6(0x258)][_0x2fefc6(0x26b)])});}}),router['post'](_0x46a08d(0x201),(_0x35004a,_0x48b8bc,_0x52ca40)=>{const _0x3ab607=_0x46a08d;if(dbUserTable[_0x3ab607(0x248)](_0x35004a,_0x48b8bc,_0x3ab607(0x13a),'power_get')==!![]){let _0x338982=getMoviesByParams(_0x48b8bc,_0x35004a,0x1,_0x3ab607(0x16c),0xf,0x0,_0x3ab607(0x15d));_0x35004a['body']['needTvCount']=!![],_0x35004a[_0x3ab607(0x191)][_0x3ab607(0x1d0)]=!![],_0x35004a[_0x3ab607(0x191)]['useTvSeriesInfo']=0x1;let _0x398c62=getMoviesByParams(_0x48b8bc,_0x35004a,0x2,_0x3ab607(0x16c),0x32,0x0,_0x3ab607(0x15d));_0x35004a[_0x3ab607(0x191)]['needTvCount']=![],_0x35004a[_0x3ab607(0x191)]['needSeasonCount']=![],_0x35004a[_0x3ab607(0x191)][_0x3ab607(0x12b)]=0x0;let _0x1d47bc=dbConfigTable[_0x3ab607(0x1d7)](_0x35004a['app'][_0x3ab607(0x26b)],_0x3ab607(0x17a));_0x1d47bc=!_0x1d47bc||_0x1d47bc&&_0x1d47bc[_0x3ab607(0x237)]==0x1;let _0x12a326=dbConfigTable[_0x3ab607(0x1d7)](_0x35004a[_0x3ab607(0x258)][_0x3ab607(0x26b)],'movieHomeShowLibrary');_0x12a326=!_0x12a326||_0x12a326&&_0x12a326[_0x3ab607(0x237)]==0x1;let _0x462320=dbConfigTable['findByTitle'](_0x35004a[_0x3ab607(0x258)][_0x3ab607(0x26b)],_0x3ab607(0x190));_0x462320=!_0x462320||_0x462320&&_0x462320[_0x3ab607(0x237)]==0x1;let _0x42600=[];if(_0x462320){let _0x25ab37='m.time,\x20f.id,f.is_tvplay,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name',_0x1bd41c=_0x3ab607(0x1e2)+_0x25ab37+_0x3ab607(0x216)+_0x35004a[_0x3ab607(0x149)]['id']+'\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010';_0x42600=_0x35004a[_0x3ab607(0x258)]['dbFileIndex']['prepare'](_0x1bd41c)[_0x3ab607(0x1fa)]();let _0x4b48c7=[];for(let _0xace5a1 in _0x42600){_0x4b48c7[_0x3ab607(0x127)](_0x42600[_0xace5a1]['id']);}let _0x348a5e=dbMovieFavorite[_0x3ab607(0x209)](_0x35004a[_0x3ab607(0x258)][_0x3ab607(0x266)],_0x35004a['currentUser']['id'],_0x4b48c7);for(let _0x4cfedd=0x0;_0x4cfedd<_0x42600[_0x3ab607(0x15a)];_0x4cfedd++){_0x42600[_0x4cfedd]['favorite']=0x0;for(let _0x1cfcb9 in _0x348a5e){if(_0x348a5e[_0x1cfcb9][_0x3ab607(0x16f)]==_0x42600[_0x4cfedd]['id']){_0x42600[_0x4cfedd][_0x3ab607(0x166)]=0x1;break;}}}}let _0x4df868=[];_0x12a326&&(_0x4df868=getMovieLibrary(_0x35004a,_0x48b8bc,0x6));let _0x353c44={'code':0x0,'movies':_0x338982,'tv':_0x398c62,'history':_0x42600,'libraryList':_0x4df868,'sourceList':[]};_0x353c44[_0x3ab607(0x165)]=getShowMatchName(_0x35004a[_0x3ab607(0x258)]['dbOther']);if(_0x1d47bc){let _0x47b0ea=_0x35004a[_0x3ab607(0x258)][_0x3ab607(0x26b)]['prepare'](_0x3ab607(0x142))[_0x3ab607(0x1fa)](_0x3ab607(0x13a));for(let _0x2fc367 of _0x47b0ea){let _0x1be3c4=getMoviesByParams(_0x48b8bc,_0x35004a,null,_0x3ab607(0x225),0x4,0x0,_0x3ab607(0x15d),null,null,JSON[_0x3ab607(0x129)]([path[_0x3ab607(0x182)](_0x2fc367[_0x3ab607(0x139)])]));if(_0x1be3c4[_0x3ab607(0x15a)]<0x1)continue;_0x353c44['sourceList'][_0x3ab607(0x127)]({'mediaType':_0x2fc367['media_type'],'path':_0x2fc367['path'],'name':path[_0x3ab607(0x212)](_0x2fc367[_0x3ab607(0x139)]),'sourceMovies':_0x1be3c4});}}return _0x48b8bc[_0x3ab607(0x12f)](_0x353c44);}}),router[_0x46a08d(0x271)](_0x46a08d(0x161),(_0x31cc3c,_0x1eb604,_0x3efc09)=>{const _0x51be56=_0x46a08d;if(dbUserTable[_0x51be56(0x248)](_0x31cc3c,_0x1eb604,_0x51be56(0x13a),'power_get')==!![]){let _0x4dbfc1=getMoviesByParams(_0x1eb604,_0x31cc3c,0x1,_0x51be56(0x225),0xa,0x0,'desc'),_0x551943=getMoviesByParams(_0x1eb604,_0x31cc3c,0x2,_0x51be56(0x225),0xa,0x0,_0x51be56(0x15d)),_0x4764cf='m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name',_0x4c6110=_0x51be56(0x1e2)+_0x4764cf+_0x51be56(0x216)+_0x31cc3c['currentUser']['id']+'\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010',_0x5bd424=_0x31cc3c[_0x51be56(0x258)][_0x51be56(0x266)]['prepare'](_0x4c6110)[_0x51be56(0x1fa)](),_0x47091a=getCollectionList(_0x31cc3c,_0x1eb604,_0x51be56(0x267)),_0x1df89d=getCollectionList(_0x31cc3c,_0x1eb604,_0x51be56(0x13f)),_0x26e296=getMoviesByParams(_0x1eb604,_0x31cc3c,null,_0x51be56(0x225),0xa,0x0,'desc',null,null,null,null,null,null,null,'FAVORITE'),_0x562454=getMovieLibrary(_0x31cc3c,_0x1eb604),_0x48cc39={'code':0x0,'movies':_0x4dbfc1,'tv':_0x551943,'history':_0x5bd424,'favorites':_0x26e296,'collectionList':_0x47091a,'aiCollectionList':_0x1df89d,'libraryList':_0x562454};return _0x1eb604[_0x51be56(0x12f)](_0x48cc39);}}),router[_0x46a08d(0x271)]('/getTvHomeData2',(_0x5b718a,_0x3b42cc,_0x29a7b6)=>{const _0x29282e=_0x46a08d;if(dbUserTable[_0x29282e(0x248)](_0x5b718a,_0x3b42cc,_0x29282e(0x13a),'power_get')==!![]){let _0x3e709a=getMoviesByParams(_0x3b42cc,_0x5b718a,0x1,_0x29282e(0x225),0x1,0x0,_0x29282e(0x15d)),_0x3317c1=getMoviesByParams(_0x3b42cc,_0x5b718a,0x2,'check_time',0x1,0x0,_0x29282e(0x15d)),_0x572758=_0x29282e(0x218),_0x5c5a27=_0x29282e(0x1e2)+_0x572758+_0x29282e(0x216)+_0x5b718a[_0x29282e(0x149)]['id']+_0x29282e(0x1db),_0x183a64=_0x5b718a['app']['dbFileIndex'][_0x29282e(0x22b)](_0x5c5a27)['all'](),_0x37fc5b=getMoviesByParams(_0x3b42cc,_0x5b718a,null,_0x29282e(0x225),0x1,0x0,'desc',null,null,null,null,null,null,null,_0x29282e(0x20b)),_0x16f6d2=dbFileIndexTable[_0x29282e(0x196)](_0x5b718a[_0x29282e(0x258)]['dbFileIndex'],_0x29282e(0x1df),dbFileIndexTable[_0x29282e(0x270)]),_0x56cc11=dbFileIndexTable[_0x29282e(0x196)](_0x5b718a['app'][_0x29282e(0x266)],_0x29282e(0x1a8),dbFileIndexTable[_0x29282e(0x270)]);_0x5b718a[_0x29282e(0x191)][_0x29282e(0x1a9)]=0x5af3107a3fff,_0x5b718a[_0x29282e(0x191)][_0x29282e(0x238)]=0x1,_0x5b718a['body']['sortField']=_0x29282e(0x225),_0x5b718a[_0x29282e(0x191)][_0x29282e(0x170)]=_0x29282e(0x15d),_0x5b718a[_0x29282e(0x191)][_0x29282e(0x252)]=0x0,_0x5b718a[_0x29282e(0x191)][_0x29282e(0x1e5)]=0x1;let _0x586d62=photoApiUtils[_0x29282e(0x20d)](_0x5b718a,_0x3b42cc),_0x252d6b=getMovieLibrary(_0x5b718a,_0x3b42cc),_0x27a03d={'movieCount':_0x16f6d2[_0x29282e(0x1e5)],'tvCount':_0x56cc11[_0x29282e(0x1e5)],'code':0x0,'movies':_0x3e709a,'tv':_0x3317c1,'history':_0x183a64,'favorites':_0x37fc5b,'photos':_0x586d62,'libraryList':_0x252d6b};return _0x3b42cc['json'](_0x27a03d);}});let subtitleExtList=[_0x46a08d(0x144),_0x46a08d(0x275),_0x46a08d(0x20f)];router['post'](_0x46a08d(0x211),(_0x2c96f3,_0xa14b02,_0x4e724f)=>{const _0x472dcf=_0x46a08d;let _0x191bd2=[],_0x310cbf=null;if(_0x2c96f3[_0x472dcf(0x191)][_0x472dcf(0x1f5)])_0x310cbf=_0x2c96f3[_0x472dcf(0x191)][_0x472dcf(0x1f5)],_0x310cbf=fileUtil[_0x472dcf(0x247)](_0x310cbf);else{if(_0x2c96f3[_0x472dcf(0x191)]['id']){let _0x2275e6=_0x2c96f3[_0x472dcf(0x191)]['id'],_0x4bfa10=dbFileIndexTable[_0x472dcf(0x134)](_0x2c96f3[_0x472dcf(0x258)][_0x472dcf(0x266)],_0x2275e6,dbFileIndexTable[_0x472dcf(0x270)]);_0x4bfa10&&(_0x310cbf=path[_0x472dcf(0x182)](_0x4bfa10[_0x472dcf(0x139)],_0x4bfa10[_0x472dcf(0x153)]),_0x2c96f3[_0x472dcf(0x258)][_0x472dcf(0x266)][_0x472dcf(0x22b)](_0x472dcf(0x1ca))['run'](Date[_0x472dcf(0x24d)](),_0x4bfa10['id']));}}function _0x54e08f(){const _0x6276b3=_0x472dcf;let _0x2fba7a=dbConfigTable['findByTitle'](_0x2c96f3[_0x6276b3(0x258)][_0x6276b3(0x26b)],'subtitleSize'),_0x3a0134=dbConfigTable[_0x6276b3(0x1d7)](_0x2c96f3[_0x6276b3(0x258)][_0x6276b3(0x26b)],_0x6276b3(0x263));return _0xa14b02['json']({'code':0x0,'data':_0x191bd2,'defaultTranscodeResolution':_0x3a0134?_0x3a0134[_0x6276b3(0x237)]:_0x6276b3(0x26c),'userFontSize':_0x2fba7a?_0x2fba7a[_0x6276b3(0x237)]:1.5});}_0x310cbf?fs[_0x472dcf(0x136)](_0x310cbf,(_0x94386c,_0x3fc18a)=>{const _0x1b81da=_0x472dcf;if(_0x94386c)return _0x54e08f();let _0x169f79=path[_0x1b81da(0x24a)](_0x310cbf);fs['readdir'](_0x169f79,(_0x21379f,_0x44ecc8)=>{const _0xf8c5da=_0x1b81da;if(_0x21379f)return _0x54e08f();let _0x397594=path[_0xf8c5da(0x212)](_0x310cbf)['replace'](path[_0xf8c5da(0x171)](_0x310cbf),''),_0x223f57=_0x397594[_0xf8c5da(0x232)]('\x20','_');for(let _0xd20837 in _0x44ecc8){let _0x5971ed=_0x44ecc8[_0xd20837],_0x5054c6=path['extname'](_0x5971ed);(_0x5971ed['startsWith'](_0x397594)||_0x5971ed[_0xf8c5da(0x19b)](_0x223f57))&&subtitleExtList[_0xf8c5da(0x1bf)](_0x5054c6)&&_0x191bd2['push']({'fileName':path[_0xf8c5da(0x212)](_0x5971ed),'filePath':path['join'](_0x169f79,_0x5971ed)});}return _0x54e08f();});}):_0x54e08f();}),router[_0x46a08d(0x271)](_0x46a08d(0x27b),(_0x3252bb,_0x5a5feb,_0x4374ee)=>{const _0x3d2b34=_0x46a08d;let _0x5f5b23=_0x3252bb['app'][_0x3d2b34(0x266)]['prepare']('SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_genres\x27\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100')[_0x3d2b34(0x1fa)](),_0x5d94b9=_0x3252bb[_0x3d2b34(0x258)][_0x3d2b34(0x266)][_0x3d2b34(0x22b)](_0x3d2b34(0x128))['all'](),_0xca7846=_0x3252bb[_0x3d2b34(0x258)][_0x3d2b34(0x266)]['prepare'](_0x3d2b34(0x1bc))[_0x3d2b34(0x1fa)]();_0x5a5feb[_0x3d2b34(0x12f)]({'code':0x0,'data':_0x5f5b23[_0x3d2b34(0x224)](_0x5d94b9,_0xca7846)});}),router['post'](_0x46a08d(0x21c),(_0x402c3d,_0x147fd0,_0x36fd9c)=>{const _0x35cf23=_0x46a08d;let _0x5a03cb=_0x402c3d[_0x35cf23(0x191)][_0x35cf23(0x1a7)],_0x32c34e=dbFileIndexTable[_0x35cf23(0x134)](_0x402c3d[_0x35cf23(0x258)]['dbFileIndex'],_0x5a03cb,dbFileIndexTable[_0x35cf23(0x270)]);if(!_0x32c34e)return _0x147fd0[_0x35cf23(0x12f)]({'code':0x0});if(dbUserTable[_0x35cf23(0x248)](_0x402c3d,_0x147fd0,'movie',_0x35cf23(0x257),_0x32c34e[_0x35cf23(0x139)])==!![])return dbFileIndexTable['delete'](_0x402c3d[_0x35cf23(0x258)][_0x35cf23(0x266)],_0x5a03cb,dbFileIndexTable[_0x35cf23(0x270)]),_0x147fd0[_0x35cf23(0x12f)]({'code':0x0});}),router['post'](_0x46a08d(0x1c5),(_0x116c78,_0x58431e,_0xbaf852)=>{const _0x4d5a05=_0x46a08d;let _0x51f92b=_0x116c78['currentUser']['id'],_0x4d94da=parseInt(_0x116c78[_0x4d5a05(0x191)]['movieIndexId']),_0xa13cc2=dbMovieFavorite[_0x4d5a05(0x1c1)](_0x116c78[_0x4d5a05(0x258)]['dbFileIndex'],_0x51f92b,_0x4d94da),_0x1354f1=0x0;if(_0xa13cc2)dbMovieFavorite[_0x4d5a05(0x1eb)](_0x116c78[_0x4d5a05(0x258)]['dbFileIndex'],_0x51f92b,_0x4d94da);else{_0x1354f1=0x1;let _0x54c854=new Date()[_0x4d5a05(0x244)]();_0x116c78[_0x4d5a05(0x258)]['dbFileIndex'][_0x4d5a05(0x22b)](_0x4d5a05(0x1ca))[_0x4d5a05(0x25c)](_0x54c854,_0x4d94da),dbMovieFavorite[_0x4d5a05(0x1e3)](_0x116c78['app'][_0x4d5a05(0x266)],_0x51f92b,_0x4d94da);}return _0x58431e[_0x4d5a05(0x12f)]({'code':0x0,'favorite':_0x1354f1});}),router[_0x46a08d(0x271)]('/setTitleAndEnding',(_0x58dcf2,_0xc922e6,_0x5484b5)=>{const _0x10fbb7=_0x46a08d;try{let _0x250be4=parseInt(_0x58dcf2[_0x10fbb7(0x191)][_0x10fbb7(0x1a7)]),_0x243f5c=dbFileIndexTable[_0x10fbb7(0x134)](_0x58dcf2[_0x10fbb7(0x258)]['dbFileIndex'],_0x250be4,dbFileIndexTable[_0x10fbb7(0x270)]);if(!_0x243f5c)return _0xc922e6[_0x10fbb7(0x12f)]({'code':0x0});let _0x55e495=parseInt(_0x58dcf2[_0x10fbb7(0x191)][_0x10fbb7(0x187)]),_0x35ca70=parseInt(_0x58dcf2[_0x10fbb7(0x191)][_0x10fbb7(0x14b)]);!_0x35ca70&&(_0x35ca70=0x0);!_0x55e495&&(_0x55e495=0x0);let _0x3cde01=parseInt(_0x58dcf2['body'][_0x10fbb7(0x203)]);if(_0x55e495<0x0||_0x35ca70<0x0||_0x55e495>_0x243f5c[_0x10fbb7(0x21d)]||_0x35ca70>_0x243f5c[_0x10fbb7(0x21d)]||_0x3cde01!=0x0&&_0x3cde01!=0x1)return _0x58dcf2[_0x10fbb7(0x258)][_0x10fbb7(0x214)](_0xc922e6,'Value\x20out\x20of\x20limit');let _0x486ba9=[_0x243f5c];_0x243f5c['is_tvplay']==0x1&&(_0x486ba9=_0x58dcf2[_0x10fbb7(0x258)][_0x10fbb7(0x266)]['prepare'](_0x10fbb7(0x27d)+dbFileIndexTable[_0x10fbb7(0x270)]+'\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20')[_0x10fbb7(0x1fa)](_0x243f5c[_0x10fbb7(0x139)]));let _0x758f55='(';for(let _0x57a31c in _0x486ba9){_0x758f55+=_0x486ba9[_0x57a31c]['id'],_0x57a31c!=_0x486ba9['length']-0x1&&(_0x758f55+=',');}return _0x758f55+=')',_0x58dcf2[_0x10fbb7(0x258)][_0x10fbb7(0x266)][_0x10fbb7(0x22b)]('UPDATE\x20file_index_movie\x20set\x20open_duration=?,end_duration=?,skip_open_end=?\x20WHERE\x20id\x20in\x20'+_0x758f55)[_0x10fbb7(0x25c)](_0x55e495,_0x35ca70,_0x3cde01),_0xc922e6['json']({'code':0x0});}catch(_0x33146a){return console[_0x10fbb7(0x1ea)](_0x33146a),_0x58dcf2[_0x10fbb7(0x258)][_0x10fbb7(0x214)](_0xc922e6,_0xc922e6['__'](_0x10fbb7(0x179)));}});function getMovieLibrary(_0x2003e3,_0x37dc00,_0x57b3df){const _0x394bd1=_0x46a08d;let _0x1a67de=_0x2003e3['body'][_0x394bd1(0x245)]||0x0,_0x39f052=_0x57b3df||_0x2003e3[_0x394bd1(0x191)][_0x394bd1(0x1e5)]||0x32,_0x48ca81=_0x2003e3[_0x394bd1(0x191)][_0x394bd1(0x175)]||'',_0x1ac536=_0x2003e3['body']['orderField']||_0x394bd1(0x16c),_0x3dbb63=_0x2003e3['body'][_0x394bd1(0x1ee)]||_0x394bd1(0x15d);if(![_0x394bd1(0x16c),_0x394bd1(0x1d5)][_0x394bd1(0x1bf)](_0x1ac536))return console['log']('order\x20field\x20error',_0x1ac536),[];let _0x397c9b=[],_0x51c49e=[],_0x2a76ea='SELECT\x20*\x20FROM\x20movie_library\x20';_0x2003e3['currentUser'][_0x394bd1(0x1ce)]==0x1?_0x48ca81&&(_0x2a76ea+=_0x394bd1(0x230),_0x51c49e[_0x394bd1(0x127)]('%'+_0x48ca81+'%')):(_0x2a76ea=_0x394bd1(0x169),_0x48ca81&&(_0x2a76ea+=_0x394bd1(0x19a),_0x51c49e[_0x394bd1(0x127)]('%'+_0x48ca81+'%')));_0x2a76ea+=_0x394bd1(0x25f)+_0x1ac536+'\x20'+_0x3dbb63+_0x394bd1(0x269),_0x51c49e[_0x394bd1(0x127)](_0x39f052),_0x51c49e['push'](_0x1a67de),_0x397c9b=_0x2003e3['app'][_0x394bd1(0x266)][_0x394bd1(0x22b)](_0x2a76ea)['all'](_0x51c49e);if(_0x397c9b['length']<0x1)return[];for(let _0x311c28 in _0x397c9b){let _0x5e884b=_0x397c9b[_0x311c28];try{let _0x152e1e=JSON['parse'](_0x5e884b[_0x394bd1(0x23c)]),_0x18c326=[];for(let _0x2325b0 of _0x152e1e){let _0x13e083=dbUserTable['findWithField'](_0x2003e3[_0x394bd1(0x258)][_0x394bd1(0x26b)],_0x2325b0,'id,username');_0x18c326['push'](_0x13e083);}_0x397c9b[_0x311c28][_0x394bd1(0x137)]=_0x18c326;}catch(_0x33e1b6){console[_0x394bd1(0x1ea)](_0x33e1b6);}let _0x1d1a82=getMoviesByParams(_0x37dc00,_0x2003e3,null,_0x394bd1(0x225),0x4,0x0,_0x394bd1(0x15d),null,null,null,null,null,null,null,null,null,_0x397c9b[_0x311c28]['id']);_0x397c9b[_0x311c28][_0x394bd1(0x278)]=_0x1d1a82;}return _0x397c9b;}router[_0x46a08d(0x271)](_0x46a08d(0x1ad),(_0x4bd078,_0x54f6d6,_0x454836)=>{const _0x57a109=_0x46a08d;let _0x1cfa6c=_0x4bd078[_0x57a109(0x191)][_0x57a109(0x1d5)],_0x3d7347=_0x4bd078[_0x57a109(0x191)][_0x57a109(0x17c)],_0x1143a3=_0x4bd078[_0x57a109(0x191)][_0x57a109(0x19f)],_0xccdea4=_0x4bd078['body'][_0x57a109(0x177)],_0x40cba0=_0x4bd078['body'][_0x57a109(0x20c)],_0x44542c=_0x4bd078[_0x57a109(0x191)][_0x57a109(0x14e)];if(_0x44542c==_0x57a109(0x132)){let _0x4a685b=getMovieLibrary(_0x4bd078,_0x54f6d6);return _0x54f6d6[_0x57a109(0x12f)]({'code':0x0,'data':_0x4a685b});}else{if(_0x4bd078[_0x57a109(0x149)][_0x57a109(0x1ce)]!=0x1)return _0x4bd078[_0x57a109(0x258)][_0x57a109(0x214)](_0x54f6d6,_0x54f6d6['__']('noPermission'));if(_0x44542c==_0x57a109(0x125)||_0x44542c==_0x57a109(0x264)){if(!_0x1143a3||!_0x1143a3 instanceof Array||_0x1143a3['length']<0x1)return _0x4bd078[_0x57a109(0x258)][_0x57a109(0x214)](_0x54f6d6,_0x54f6d6['__'](_0x57a109(0x179)));if(_0x40cba0){if(_0xccdea4!=null&&!_0xccdea4 instanceof Array)return _0x4bd078['app']['returnErrMsg'](_0x54f6d6,_0x54f6d6['__']('operationFail'));}if(sqliteUtil[_0x57a109(0x249)](JSON['stringify'](_0x1143a3))==!![])return _0x4bd078[_0x57a109(0x258)][_0x57a109(0x214)](_0x54f6d6,_0x57a109(0x1ec));}if(_0x44542c==_0x57a109(0x264)&&_0x3d7347)_0x4bd078['app']['dbFileIndex'][_0x57a109(0x22b)](_0x57a109(0x157))[_0x57a109(0x25c)](_0x1cfa6c,JSON[_0x57a109(0x129)](_0x1143a3),_0x40cba0,JSON[_0x57a109(0x129)](_0xccdea4),_0x3d7347);else{if(_0x44542c=='DELETE'&&_0x3d7347)_0x4bd078[_0x57a109(0x258)]['dbFileIndex'][_0x57a109(0x22b)](_0x57a109(0x124))[_0x57a109(0x25c)](_0x3d7347);else{if(_0x44542c=='ADD')_0x4bd078['app'][_0x57a109(0x266)]['prepare'](_0x57a109(0x1e9))[_0x57a109(0x25c)](_0x1cfa6c,JSON[_0x57a109(0x129)](_0x1143a3),_0x40cba0,JSON[_0x57a109(0x129)](_0xccdea4),_0x4bd078[_0x57a109(0x149)]['id']);else return _0x4bd078[_0x57a109(0x258)]['returnErrMsg'](_0x54f6d6,_0x54f6d6['__'](_0x57a109(0x208)));}}return _0x54f6d6[_0x57a109(0x12f)]({'code':0x0});}}),module[_0x46a08d(0x131)]=router;