const _0x36e771=_0x3ec4;(function(_0x528a30,_0x5564f4){const _0x20885e=_0x3ec4,_0x2be919=_0x528a30();while(!![]){try{const _0x2cac5a=parseInt(_0x20885e(0x2a9))/0x1*(parseInt(_0x20885e(0x209))/0x2)+-parseInt(_0x20885e(0x263))/0x3+-parseInt(_0x20885e(0x1ea))/0x4*(-parseInt(_0x20885e(0x255))/0x5)+-parseInt(_0x20885e(0x33e))/0x6+-parseInt(_0x20885e(0x1f7))/0x7*(-parseInt(_0x20885e(0x251))/0x8)+parseInt(_0x20885e(0x2f4))/0x9+-parseInt(_0x20885e(0x2e0))/0xa*(parseInt(_0x20885e(0x33f))/0xb);if(_0x2cac5a===_0x5564f4)break;else _0x2be919['push'](_0x2be919['shift']());}catch(_0xed8d8){_0x2be919['push'](_0x2be919['shift']());}}}(_0xec8e,0x66f83));var express=require(_0x36e771(0x29f)),router=express[_0x36e771(0x318)]();let path=require(_0x36e771(0x2e8));function _0x3ec4(_0x53f0f5,_0x332898){const _0xec8e89=_0xec8e();return _0x3ec4=function(_0x3ec4ab,_0x208bf8){_0x3ec4ab=_0x3ec4ab-0x1e4;let _0x19cf3f=_0xec8e89[_0x3ec4ab];return _0x19cf3f;},_0x3ec4(_0x53f0f5,_0x332898);}const dbFileIndexTable=require('../../db/dbFileIndexTable'),dbUserTable=require(_0x36e771(0x256));var fs=require('fs');let config=require(_0x36e771(0x280)),axios=require(_0x36e771(0x1e6)),sha256=require(_0x36e771(0x326)),nasAccountUtil=require(_0x36e771(0x2e6));const dbConfigTable=require('../../db/dbConfigTable'),videoStreamUtil=require(_0x36e771(0x33c)),dbSourceFolderTable=require(_0x36e771(0x257)),nfoUtil=require('../../utils/nfoUtil'),dbMovieFavorite=require(_0x36e771(0x270)),movieUtil=require(_0x36e771(0x21e));let fileUtil=require(_0x36e771(0x25a));const sqliteUtil=require('../utils/sqliteUtil'),photoApiUtils=require(_0x36e771(0x29e));let movieSeasonUtil=require(_0x36e771(0x332)),movieInfoUtil=require(_0x36e771(0x340));const dbScanTaskTable=require(_0x36e771(0x301));let movieFieldStr=_0x36e771(0x319);function _0xec8e(){const _0x374e7b=['%season','data','/removeIndexFromCollection','noPermission','fanart.%','logo_path','/getMovieKeys','/addCollection','post','check_time','extname','/getTvSeriesDetail','count','isTvSeries','1080p\x203mbps','pwd','error\x20pathList','\x20and\x20title\x20like\x20?','\x20FROM\x20','\x20AND\x20(filename_fl=?\x20OR\x20show_name_fl=?\x20OR\x20movie_info_name_fl=?)','defaultTranscodeResolution','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20','未找到NFO信息','\x20AND\x20(filename_fl=?\x20AND\x20show_name_fl=?\x20AND\x20movie_info_name_fl=?)','/setTvplay','EDIT','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id','.ass','prepare','UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_language\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','existsSync','run','listType','id,username','has','\x20SET\x20show_in_list\x20=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=\x27','key_value','libraryId','includes','\x20AND\x20(','excludeFilenameMovie','/getTvList','\x20order\x20by\x20check_time\x20desc\x20limit\x2010\x20','send','SELECT\x20id\x20FROM\x20','1383610caUUpA','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20where\x20collection_id=?','/checkCollectionPwd','indexIdList','dialog','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_movie\x20WHERE\x20path\x20like\x20?\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1','../utils/nasAccountUtils','smart','path','REPLACE\x20INTO\x20movie_collection(title,enable_pwd,pwd,user_id,type,data,collection_cover_path,data_value,share_for_subuser)\x20VALUES(\x20?,?,?,?,?,?,?,?,?)','movieIndexId','\x20AND\x20is_tvplay==1','%poster%','movieHomeShowLibrary','sourceFolderList','ignore_match_info','dataValue','json','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1','getTime','5412267KvxHvx','\x20SET\x20show_in_list\x20=0,is_tvplay=1\x20WHERE\x20path=?','operationFail','dbOther','parse','subtitleSize','DELETE\x20FROM\x20movie_collection\x20WHERE\x20id=?','trash','SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?','index_id','sortField','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay!=1','SWITCH_MOVIE_INFO','../../db/dbScanTaskTable','findByTitle','coverMovie','orderType','decodePath','movie_regions','dbFileIndex','.clearlogo.%','.srt','\x20AND\x20collection_id\x20=\x20','\x20and\x20(filename\x20like\x20?\x20or\x20movie_info_name\x20like\x20?)\x20','INDEX_TABLE_NAME_MOVIE','getExcludePathWhereStr','\x20\x20WHERE\x20','login.pwdErr','Value\x20out\x20of\x20limit','select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2','\x20as\x20f\x20WHERE\x20','SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?','pathList','replaceAll','now','movieRegion','Router','\x20id,collection_id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list','UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20','app','HEIC','seasonNumber','collectionId','getById','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','sep','folder','getCountByWhere','\x20or\x20','movieLanguage','sha256','/addIndexToCollection','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=3\x20WHERE\x20path\x20like\x20?\x20OR\x20path=?','power_change','all','\x20AND\x20share_for_subuser\x20=\x20?\x20','doUserCanGet','desc','stringify','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20','tvFolderPath','\x20and\x20filename_number\x20>=\x20?\x20','../../utils/movieSeasonUtil','/movieFavorite','\x20WHERE\x20title\x20like\x20?','poster.jpeg','order\x20field\x20error','findWithField','\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20check_time\x20DESC\x20LIMIT\x20','index.videoInfoReadFail','dirname','coverPath','../../utils/videoStreamUtil','startScanPath','3365268MOmzCR','11bbMYJH','../../utils/movieInfoUtil','SELECT\x20index_id\x20FROM\x20movie_history\x20where\x20index_id\x20in\x20','show_name','getTvCount','GET','/deleteCollection','axios','pageSize','\x27\x20and\x20type=1\x20and\x20is_file=1\x20limit\x2020','ordinary','958556ZYemNo','sourceFolderId','movie','isAdmin','\x20LIMIT\x20','\x20LIMIT\x20?\x20OFFSET\x20?','shareForSubUser','pwdCanNotBeNull','searchStr','ignoreMatchInfo','path_list','enable_pwd','-clearlogo.%','668843ThUiAr','/getIndexDetail','needTvCount','fanart_path','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20id=?','value','tvplay','share_uid','dataPreview','deleteFavorite','firstLetter','.jpg','/getMoviesByGenres','basename','movie_language','dealFirstLetterSingle','end','UPDATE\x20movie_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','61700srdEaA','searchValue','clearlogo.%','/getSameNameSubtitles','-fanart.%','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20?\x20or\x20filename\x20like\x20?)\x20and\x20filename\x20not\x20like\x20?','getSeasonNumber','SELECT\x20count(*)\x20as\x20count\x20FROM\x20','timeType','returnErrMsg','-coverCache-','is_tvplay','catch','UPDATE\x20file_index_movie\x20set\x20open_duration=?,end_duration=?,skip_open_end=?\x20WHERE\x20id\x20in\x20','saveMovieInfoToDb','SELECT\x20id,title,enable_pwd,create_time\x20FROM\x20movie_collection\x20where\x20id=?\x20and\x20pwd=?','\x20WHERE\x20is_file=0\x20and\x20(path=?\x20or\x20path\x20like\x20?)\x20','push','\x20like\x20?\x20','\x27\x20or\x20filename\x20like\x20\x27','fileExist','../utils/movieUtil','/getHistory','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2050','autoSkip','\x20type=2\x20and\x20is_file=1\x20and\x20id!=?\x20and\x20collection_id=0\x20','movie_index_id','movie_director','set','\x20and\x20path=?\x20and\x20is_tvplay=1\x20','trim','sort','parseNfo','ADD','genresType','movieTvCache','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20share_for_subuser=1','useTvSeriesInfo','search','body','\x20SET\x20show_in_list=1\x20WHERE\x20id=?','UPDATE\x20','movieCollectionNotExist','\x20type=2','\x20AND\x20','movie_genres','movieDirectors','fileFullPath','endsWith','collection_id','readdir','indexId','folder_cover_path','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20and\x20filename_number\x20is\x20null','/getMovieHomeData','UPDATE\x20movie_history\x20SET\x20time=?,create_time=?\x20where\x20index_id=?\x20AND\x20user_id=?','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','movieHomeShowMyMedia','DELETE\x20FROM\x20movie_library\x20\x20WHERE\x20id=?','stat','shareUidList','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27','enablePwd','FAVORITE','log','SELECT\x20*\x20FROM\x20source_folder\x20WHERE\x20type=?\x20LIMIT\x2010','\x20order\x20by\x20m.create_time\x20desc\x20limit\x201','needSeasonCount','movieShowMatchName','isTvPlay','m.time,\x20f.id,f.is_tvplay,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','8ZESIUu','substr','SELECT\x20id,filename\x20FROM\x20','then','5iUbeow','../../db/dbUserTable','../../db/dbSourceFolderTable','sourceType','SELECT\x20*\x20FROM\x20movie_keys\x20WHERE\x20key_type=?\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20200','../utils/fileUtils','\x20ORDER\x20BY\x20','\x20id,title,data,enable_pwd,collection_cover_path,data_value,create_time,share_for_subuser\x20','SELECT\x20','getUserPathWhere','ignoreTvList','excludePathMovie','UPDATE\x20movie_collection\x20SET\x20title=?,data=?,enable_pwd=?,pwd=?,collection_cover_path=?,data_value=?,share_for_subuser=?\x20WHERE\x20id=?','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20\x20or\x20filename\x20like\x20?)','1575297jegBxY','tvCount','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_regions\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','filename','/getCollection','seasonCount','title','movieActors','getFavoriteList','(filename\x20like\x20?)','is_admin','\x20SELECT\x20','REPLACE\x20INTO\x20movie_history(index_id,user_id,time,create_time)\x20VALUES(\x20?,?,?,?)','../../db/dbMovieFavorite','addScanTask','poster.jpg','/getMovieDetail','\x20AND\x20collection_id=0','sortType','offset','openDuration','\x20order\x20by\x20create_time\x20desc','\x20AND\x20id\x20NOT\x20IN\x20(','getAllByWhereAndField','/operationLibrary','currentUser','filepath','\x20LIKE\x20\x27%','/deleteIndex','../../myConfig/config','exports','-HD','favorite','duration','history','\x20FROM\x20\x20movie_collection\x20WHERE\x20type=?','ignoreSeasonList','get','-QHD','media_type','getAllFavoriteByWhere','/switchMatchInfo','length','getPathWhere','\x20OFFSET\x20','concat','excludeIds','type','SELECT\x20*\x20from\x20','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010','-seriesPoster','replace','movie_info_name','tvFolderName','join','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay==1','\x20and\x20show_in_list=1','getFavorite','collectionPwd','./photoApiUtils','express','checkPath','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_genres\x27\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','ALL','power_get','updateByWhere','\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id=','getFilenameNumber','-FHD','status','23lNjbga','DELETE\x20FROM\x20movie_history\x20where\x20user_id=','timestamp','\x20order\x20by\x20','\x20AND\x20(path\x20like\x20?\x20OR\x20filename\x20like\x20?\x20OR\x20movie_info_name\x20like\x20?\x20)','create_time','SELECT\x20*\x20FROM\x20movie_library\x20','time','-UHD'];_0xec8e=function(){return _0x374e7b;};return _0xec8e();}function getTvSeriesPoster(_0x110ae5){const _0x482c2e=_0x36e771;let _0x4a11f0='',_0x3e8238=path[_0x482c2e(0x299)](path[_0x482c2e(0x33a)](_0x110ae5[_0x482c2e(0x2e8)]),_0x482c2e(0x272));return fs['existsSync'](_0x3e8238)&&(_0x4a11f0=_0x3e8238),!_0x4a11f0&&(_0x3e8238=path[_0x482c2e(0x299)](path[_0x482c2e(0x33a)](_0x110ae5[_0x482c2e(0x2e8)]),_0x482c2e(0x335)),fs[_0x482c2e(0x2d1)](_0x3e8238)&&(_0x4a11f0=_0x3e8238)),!_0x4a11f0&&(_0x3e8238=path['join'](path[_0x482c2e(0x33a)](_0x110ae5[_0x482c2e(0x2e8)]),'folder.jpg'),fs[_0x482c2e(0x2d1)](_0x3e8238)&&(_0x4a11f0=_0x3e8238)),!_0x4a11f0&&(_0x3e8238=path[_0x482c2e(0x299)](path[_0x482c2e(0x33a)](_0x110ae5[_0x482c2e(0x2e8)]),'thumb.jpg'),fs['existsSync'](_0x3e8238)&&(_0x4a11f0=_0x3e8238)),_0x4a11f0;}router[_0x36e771(0x2ba)](_0x36e771(0x2bd),(_0x508845,_0x2b134e,_0x5c7aa0)=>{const _0x3923c8=_0x36e771;let _0x3ce648=_0x508845[_0x3923c8(0x230)]['id'],_0x42d1e8=dbFileIndexTable[_0x3923c8(0x31f)](_0x508845[_0x3923c8(0x31b)][_0x3923c8(0x307)],_0x3ce648,dbFileIndexTable[_0x3923c8(0x30c)]);if(!_0x42d1e8)return _0x508845[_0x3923c8(0x31b)][_0x3923c8(0x212)](_0x2b134e,_0x2b134e['__'](_0x3923c8(0x339)));if(dbUserTable['doUserCanGet'](_0x508845,_0x2b134e,_0x3923c8(0x1ec),'power_get',_0x42d1e8[_0x3923c8(0x2e8)])==!![]){let _0x1b2fa5=dbUserTable[_0x3923c8(0x25e)](_0x508845,_0x3923c8(0x1ec),'power_get',!![]),_0x125317=_0x3923c8(0x222);_0x125317+=_0x1b2fa5,_0x125317+=_0x3923c8(0x2dd),nfoUtil['parseNfoTvSeries'](_0x42d1e8)[_0x3923c8(0x254)](_0x17186d=>{const _0x592e44=_0x3923c8;_0x42d1e8=_0x17186d,_0x508845[_0x592e44(0x230)]['needLogoPathAndFanart']=!![],_0x508845[_0x592e44(0x230)]['useTvSeriesInfo']=0x1,_0x42d1e8=addFolderCoverPath(_0x2b134e,_0x508845,_0x42d1e8),_0x3bedaf();})[_0x3923c8(0x215)](_0x36cc95=>{const _0x3837f5=_0x3923c8;console['log'](_0x3837f5(0x2c8),_0x36cc95),_0x42d1e8=addFolderCoverPath(_0x2b134e,_0x508845,_0x42d1e8),_0x42d1e8[_0x3837f5(0x297)]=_0x42d1e8[_0x3837f5(0x298)],_0x3bedaf();});function _0x3bedaf(){const _0xedb32d=_0x3923c8;addTvFolderPathAndName(_0x42d1e8),setLogoAndFanart(_0x508845,_0x42d1e8,_0x42d1e8[_0xedb32d(0x330)]);let _0x26e6dc=dbMovieFavorite[_0xedb32d(0x29c)](_0x508845[_0xedb32d(0x31b)][_0xedb32d(0x307)],_0x508845[_0xedb32d(0x27c)]['id'],_0x42d1e8['id']);_0x26e6dc?_0x42d1e8[_0xedb32d(0x283)]=0x1:_0x42d1e8[_0xedb32d(0x283)]=0x0;let _0x4f1d01={'code':0x0,'movieIndex':_0x42d1e8};fs[_0xedb32d(0x245)](_0x42d1e8[_0xedb32d(0x330)],(_0x5d1efe,_0x4c2950)=>{const _0x6f3f7=_0xedb32d;_0x4f1d01[_0x6f3f7(0x21d)]=_0x5d1efe?0x0:0x1,_0x2b134e['json'](_0x4f1d01),_0x42d1e8[_0x6f3f7(0x214)]==0x1&&_0x42d1e8[_0x6f3f7(0x330)]&&(dbScanTaskTable[_0x6f3f7(0x271)](_0x508845[_0x6f3f7(0x31b)][_0x6f3f7(0x2f7)],_0x6f3f7(0x1ec),_0x42d1e8[_0x6f3f7(0x330)]),process['send']({'type':'startScanPath','source_type':_0x6f3f7(0x1ec),'restartWatcher':![]}));});}}}),router[_0x36e771(0x2ba)](_0x36e771(0x273),(_0x4de5bc,_0x5f491f,_0x298c4e)=>{const _0x3c4830=_0x36e771;let _0x19502e=_0x4de5bc[_0x3c4830(0x230)]['id'],_0x51de6c=dbFileIndexTable[_0x3c4830(0x31f)](_0x4de5bc[_0x3c4830(0x31b)][_0x3c4830(0x307)],_0x19502e,dbFileIndexTable[_0x3c4830(0x30c)]);if(!_0x51de6c)return _0x4de5bc['app'][_0x3c4830(0x212)](_0x5f491f,_0x5f491f['__']('index.videoInfoReadFail'));if(dbUserTable[_0x3c4830(0x32c)](_0x4de5bc,_0x5f491f,_0x3c4830(0x1ec),_0x3c4830(0x2a3),_0x51de6c[_0x3c4830(0x2e8)])==!![]){let _0x59f016=dbUserTable[_0x3c4830(0x25e)](_0x4de5bc,_0x3c4830(0x1ec),_0x3c4830(0x2a3),!![]),_0x437bc8=_0x3c4830(0x222);_0x437bc8+=_0x59f016,_0x437bc8+='\x20order\x20by\x20check_time\x20desc\x20limit\x2010\x20',nfoUtil[_0x3c4830(0x229)](_0x51de6c,!![],![])[_0x3c4830(0x254)](_0x1304df=>{const _0x5c2874=_0x3c4830;_0x51de6c=_0x1304df,_0x4de5bc['body']['needLogoPathAndFanart']=!![],_0x51de6c=addFolderCoverPath(_0x5f491f,_0x4de5bc,_0x51de6c),movieInfoUtil[_0x5c2874(0x217)](_0x4de5bc[_0x5c2874(0x31b)]['dbFileIndex'],_0x51de6c['id'],_0x1304df),_0x328762();})[_0x3c4830(0x215)](()=>{_0x51de6c=addFolderCoverPath(_0x5f491f,_0x4de5bc,_0x51de6c),_0x328762();});function _0x328762(){const _0x19d04d=_0x3c4830;let _0x5e2eec=dbMovieFavorite[_0x19d04d(0x29c)](_0x4de5bc[_0x19d04d(0x31b)][_0x19d04d(0x307)],_0x4de5bc[_0x19d04d(0x27c)]['id'],_0x51de6c['id']);_0x5e2eec?_0x51de6c[_0x19d04d(0x283)]=0x1:_0x51de6c[_0x19d04d(0x283)]=0x0;let _0x48d1cb=null;if(_0x51de6c[_0x19d04d(0x214)]==0x1){let _0x29076f=_0x4de5bc[_0x19d04d(0x31b)]['dbFileIndex'][_0x19d04d(0x2ce)](_0x19d04d(0x2df)+dbFileIndexTable[_0x19d04d(0x30c)]+_0x19d04d(0x242))[_0x19d04d(0x32a)](_0x51de6c[_0x19d04d(0x2e8)]),_0x3df109='(';for(let _0x148ae7 in _0x29076f){_0x3df109+=_0x29076f[_0x148ae7]['id'],_0x148ae7!=_0x29076f[_0x19d04d(0x28d)]-0x1&&(_0x3df109+=',');}_0x3df109+=')';let _0x3509df=_0x4de5bc[_0x19d04d(0x31b)]['dbFileIndex'][_0x19d04d(0x2ce)](_0x19d04d(0x341)+_0x3df109+_0x19d04d(0x278))['get']();_0x3509df&&(_0x48d1cb=dbFileIndexTable['getById'](_0x4de5bc['app'][_0x19d04d(0x307)],_0x3509df[_0x19d04d(0x2fd)],dbFileIndexTable[_0x19d04d(0x30c)]));}let _0x251dca={'code':0x0,'movieIndex':_0x51de6c,'lastTvEpisodeIndex':_0x48d1cb},_0x97d5f1=[];try{let _0x22fb3d=_0x4de5bc[_0x19d04d(0x31b)][_0x19d04d(0x307)]['prepare'](_0x19d04d(0x247)+_0x51de6c[_0x19d04d(0x2e8)]+_0x19d04d(0x1e8))[_0x19d04d(0x32a)]();for(let _0x361720 in _0x22fb3d){let _0x179add=path['join'](_0x22fb3d[_0x361720][_0x19d04d(0x2e8)],_0x22fb3d[_0x361720][_0x19d04d(0x266)]);(_0x4de5bc[_0x19d04d(0x27c)]['is_admin']==0x1||dbUserTable[_0x19d04d(0x32c)](_0x4de5bc,_0x5f491f,_0x19d04d(0x322),_0x19d04d(0x2a3),_0x179add,!![])==!![])&&_0x97d5f1['push'](_0x179add);}_0x251dca['sameFolderImgList']=_0x97d5f1;}catch(_0x1eead7){}let _0x1e1404=path[_0x19d04d(0x299)](_0x51de6c[_0x19d04d(0x2e8)],_0x51de6c[_0x19d04d(0x266)]);fs[_0x19d04d(0x245)](_0x1e1404,(_0x4d440a,_0x4bd36c)=>{const _0x6b4e93=_0x19d04d;_0x251dca['fileExist']=_0x4d440a?0x0:0x1,_0x251dca[_0x6b4e93(0x238)]=_0x1e1404,_0x5f491f['json'](_0x251dca),_0x51de6c[_0x6b4e93(0x214)]==0x1&&_0x51de6c[_0x6b4e93(0x330)]&&_0x51de6c[_0x6b4e93(0x2bf)]!=0x1&&(dbScanTaskTable[_0x6b4e93(0x271)](_0x4de5bc[_0x6b4e93(0x31b)]['dbOther'],_0x6b4e93(0x1ec),_0x51de6c[_0x6b4e93(0x330)]),process['send']({'type':_0x6b4e93(0x33d),'source_type':_0x6b4e93(0x1ec),'restartWatcher':![]}));});}}}),router[_0x36e771(0x2ba)](_0x36e771(0x2dc),(_0x3e6be6,_0x5830bd,_0x870f2b)=>{const _0x24bb21=_0x36e771;let _0x55170c=_0x3e6be6['body']['id'],_0x151dd9=_0x3e6be6[_0x24bb21(0x230)]['page']||0x0,_0x5161b7=_0x3e6be6[_0x24bb21(0x230)][_0x24bb21(0x1e7)]||0xa,_0x1bb892=_0x3e6be6['body']['searchStr'],_0x1ff048=_0x3e6be6[_0x24bb21(0x230)]['fromName'],_0x214d94=_0x3e6be6['body'][_0x24bb21(0x25f)],_0x569039=_0x3e6be6[_0x24bb21(0x230)][_0x24bb21(0x287)],_0x2044c7=dbFileIndexTable[_0x24bb21(0x31f)](_0x3e6be6[_0x24bb21(0x31b)][_0x24bb21(0x307)],_0x55170c,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x2044c7)return _0x3e6be6['app']['returnErrMsg'](_0x5830bd,_0x5830bd['__'](_0x24bb21(0x339)));let _0x2b0322=movieFieldStr,_0x1f0766=[],_0x2e8667=0x0;if(dbUserTable[_0x24bb21(0x32c)](_0x3e6be6,_0x5830bd,_0x24bb21(0x1ec),'power_get',_0x2044c7[_0x24bb21(0x2e8)])==!![]){if(_0x214d94==0x1)return _0x3e8725();let _0xcd4cf6=_0x3e6be6[_0x24bb21(0x31b)]['dbFileIndex']['prepare'](_0x24bb21(0x253)+dbFileIndexTable[_0x24bb21(0x30c)]+_0x24bb21(0x23f))[_0x24bb21(0x32a)](_0x2044c7['path']);for(let _0x5288b5 in _0xcd4cf6){let _0x5cf2a3=_0xcd4cf6[_0x5288b5];if(_0x5cf2a3['filename']){let _0xa06166=movieUtil[_0x24bb21(0x2a6)](_0x5cf2a3[_0x24bb21(0x266)]);_0x3e6be6[_0x24bb21(0x31b)][_0x24bb21(0x307)]['prepare'](_0x24bb21(0x232)+dbFileIndexTable[_0x24bb21(0x30c)]+'\x20SET\x20filename_number=?\x20\x20WHERE\x20\x20id=?')[_0x24bb21(0x2d2)](_0xa06166,_0x5cf2a3['id']);}}let _0x664fbf=dbUserTable['getUserPathWhere'](_0x3e6be6,_0x24bb21(0x1ec),_0x24bb21(0x2a3),!![]),_0x1d4d37='\x20type=2\x20and\x20is_file=1';_0x1d4d37+=_0x664fbf,_0x1d4d37+=_0x24bb21(0x226);_0x1bb892&&(_0x1d4d37+=_0x24bb21(0x30b));if(_0x1ff048){let _0x64aaa4=movieUtil[_0x24bb21(0x2a6)](_0x1ff048);_0x64aaa4?_0x1d4d37+=_0x24bb21(0x331):_0x1d4d37+='\x20and\x20filename\x20>=\x20?\x20';}let _0x49e065=_0x1d4d37;_0x1d4d37+='\x20order\x20by\x20filename_number,filename';let _0x71f584='SELECT\x20'+_0x2b0322+_0x24bb21(0x2c4)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x24bb21(0x312)+_0x1d4d37+_0x24bb21(0x1ee)+_0x5161b7+_0x24bb21(0x28f)+_0x151dd9*_0x5161b7;_0x1f0766=_0x3e6be6[_0x24bb21(0x31b)]['dbFileIndex']['prepare'](_0x71f584);if(_0x1bb892&&_0x1ff048)_0x1f0766=_0x1f0766[_0x24bb21(0x32a)](_0x2044c7[_0x24bb21(0x2e8)],'%'+_0x1bb892+'%','%'+_0x1bb892+'%');else{if(_0x1bb892)_0x1f0766=_0x1f0766['all'](_0x2044c7['path'],'%'+_0x1bb892+'%','%'+_0x1bb892+'%');else{if(_0x1ff048){let _0x4a95f0=movieUtil[_0x24bb21(0x2a6)](_0x1ff048);_0x1f0766=_0x1f0766[_0x24bb21(0x32a)](_0x2044c7[_0x24bb21(0x2e8)],_0x4a95f0?_0x4a95f0:_0x1ff048);}else _0x1f0766=_0x1f0766['all'](_0x2044c7['path']);}}let _0x5185aa=_0x24bb21(0x210)+dbFileIndexTable[_0x24bb21(0x30c)]+_0x24bb21(0x30e)+_0x49e065+'\x20',_0x432c93=_0x3e6be6[_0x24bb21(0x31b)][_0x24bb21(0x307)]['prepare'](_0x5185aa);if(_0x1bb892&&_0x1ff048)_0x432c93=_0x432c93['get'](_0x2044c7[_0x24bb21(0x2e8)],'%'+_0x1bb892+'%','%'+_0x1bb892+'%');else{if(_0x1bb892)_0x432c93=_0x432c93[_0x24bb21(0x288)](_0x2044c7['path'],'%'+_0x1bb892+'%','%'+_0x1bb892+'%');else _0x1ff048?_0x432c93=_0x432c93[_0x24bb21(0x288)](_0x2044c7[_0x24bb21(0x2e8)],_0x1ff048):_0x432c93=_0x432c93[_0x24bb21(0x288)](_0x2044c7[_0x24bb21(0x2e8)]);}_0x2e8667=_0x432c93[_0x24bb21(0x2be)];if(_0x1f0766[_0x24bb21(0x28d)]>0x0){let _0x2ef8a4=0x0;for(let _0x219817 in _0x1f0766){let _0x20d45c=_0x1f0766[_0x219817];nfoUtil[_0x24bb21(0x229)](_0x20d45c,!![],!![])[_0x24bb21(0x254)](_0x3fea34=>{const _0x565b14=_0x24bb21;_0x2ef8a4+=0x1,_0x1f0766[_0x219817]=_0x3fea34,_0x1f0766[_0x219817]=addFolderCoverPath(_0x5830bd,_0x3e6be6,_0x1f0766[_0x219817],!![]),_0x2ef8a4>=_0x1f0766[_0x565b14(0x28d)]&&_0x3e8725();})['catch'](()=>{_0x2ef8a4+=0x1,_0x1f0766[_0x219817]=addFolderCoverPath(_0x5830bd,_0x3e6be6,_0x1f0766[_0x219817],!![]),_0x2ef8a4>=_0x1f0766['length']&&_0x3e8725();});}}else _0x3e8725();function _0x3e8725(){const _0x56fa68=_0x24bb21;let _0x19c545={'code':0x0,'tvplayList':_0x1f0766,'count':_0x2e8667,'pageSize':_0x5161b7};if(!_0x569039){let _0x30c38e=path[_0x56fa68(0x204)](_0x2044c7[_0x56fa68(0x2e8)]),_0x3bf92b=movieSeasonUtil[_0x56fa68(0x20f)](_0x30c38e);if(_0x3bf92b>-0x1){let _0x53078f=_0x56fa68(0x25d)+_0x2b0322+_0x56fa68(0x2c4)+dbFileIndexTable[_0x56fa68(0x30c)]+'\x20as\x20f\x20WHERE\x20path\x20like\x20?\x20and\x20is_tvplay=1\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20limit\x20200',_0x1525d0=_0x3e6be6['app'][_0x56fa68(0x307)][_0x56fa68(0x2ce)](_0x53078f)[_0x56fa68(0x32a)](path[_0x56fa68(0x33a)](_0x2044c7[_0x56fa68(0x2e8)])+path[_0x56fa68(0x321)]+'%'),_0x45009c=[];for(let _0x3c0ccd of _0x1525d0){let _0x4beee5=path[_0x56fa68(0x204)](_0x3c0ccd[_0x56fa68(0x2e8)]),_0x70f2a2=movieSeasonUtil[_0x56fa68(0x20f)](_0x4beee5);_0x70f2a2>-0x1&&(_0x3c0ccd['seasonNumber']=_0x70f2a2,_0x45009c[_0x56fa68(0x21a)](_0x3c0ccd));}for(let _0xb47090 of _0x45009c){_0xb47090=addFolderCoverPath(_0x5830bd,_0x3e6be6,_0xb47090);let _0x50950f=dbFileIndexTable[_0x56fa68(0x343)](_0x3e6be6[_0x56fa68(0x31b)][_0x56fa68(0x307)],_0xb47090);_0xb47090[_0x56fa68(0x264)]=_0x50950f[_0x56fa68(0x2be)];}_0x45009c[_0x56fa68(0x28d)]>0x0&&(_0x45009c[_0x56fa68(0x228)](function(_0x532189,_0x5f0c40){const _0x2cf85c=_0x56fa68;return _0x532189[_0x2cf85c(0x31d)]-_0x5f0c40['seasonNumber'];}),_0x19c545['seasonList']=_0x45009c);}}return _0x5830bd[_0x56fa68(0x2f1)](_0x19c545);}}}),router[_0x36e771(0x2ba)](_0x36e771(0x2b4),(_0x93818,_0x207b72,_0x5c81a1)=>{const _0x45316e=_0x36e771;let _0x470b7a=_0x93818[_0x45316e(0x230)][_0x45316e(0x2e3)],_0x1514d3=[];for(let _0x1ea241 of _0x470b7a){let _0x58b373=dbFileIndexTable[_0x45316e(0x31f)](_0x93818[_0x45316e(0x31b)][_0x45316e(0x307)],_0x1ea241,dbFileIndexTable[_0x45316e(0x30c)]);if(!_0x58b373)continue;if(dbUserTable[_0x45316e(0x32c)](_0x93818,_0x207b72,'','power_change',_0x58b373['path'])!==!![])continue;let _0x378015=path['basename'](_0x58b373['path']),_0x234195=movieSeasonUtil[_0x45316e(0x20f)](_0x378015);if(_0x234195>-0x1){let _0xd88d75=path[_0x45316e(0x299)](path[_0x45316e(0x33a)](_0x58b373[_0x45316e(0x2e8)])),_0x20b441=_0x93818[_0x45316e(0x31b)][_0x45316e(0x307)]['prepare']('select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2')[_0x45316e(0x32a)](_0xd88d75+path['sep']+'%',_0xd88d75);for(let _0x52c715 of _0x20b441){_0x1514d3[_0x45316e(0x21a)](_0x52c715['id']);}}}_0x1514d3[_0x45316e(0x28d)]>0x0&&(_0x470b7a=[..._0x470b7a,..._0x1514d3]);if(_0x470b7a[_0x45316e(0x28d)]<0x1)return _0x207b72['json']({'code':0x0});let _0x36bfa9='(';for(let _0x38187a in _0x470b7a){_0x36bfa9+=_0x470b7a[_0x38187a],_0x38187a!=_0x470b7a[_0x45316e(0x28d)]-0x1&&(_0x36bfa9+=',');}return _0x36bfa9+=')',_0x93818[_0x45316e(0x31b)][_0x45316e(0x307)][_0x45316e(0x2ce)]('UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20WHERE\x20id\x20in\x20'+_0x36bfa9)[_0x45316e(0x2d2)](),_0x207b72[_0x45316e(0x2f1)]({'code':0x0});}),router['post'](_0x36e771(0x327),(_0x146170,_0x592824,_0x3ce701)=>{const _0x171df7=_0x36e771;let _0x634c95=_0x146170[_0x171df7(0x230)][_0x171df7(0x31e)],_0x4191dc=_0x146170[_0x171df7(0x230)][_0x171df7(0x23c)],_0x88baf5=_0x146170[_0x171df7(0x230)][_0x171df7(0x27d)];function _0x1f13d1(_0x22f5aa){let _0x26dcab=[];for(let _0x190028 in _0x22f5aa){_0x26dcab['push'](_0x22f5aa[_0x190028]['id']);}inSql='(';for(let _0x5f0ed9 in _0x26dcab){inSql+=_0x26dcab[_0x5f0ed9],_0x5f0ed9!=_0x26dcab['length']-0x1&&(inSql+=',');}return inSql+=')',inSql;}if(_0x634c95&&_0x4191dc){let _0x3fc445=dbFileIndexTable[_0x171df7(0x31f)](_0x146170[_0x171df7(0x31b)][_0x171df7(0x307)],_0x4191dc,dbFileIndexTable[_0x171df7(0x30c)]),_0x4145f6='('+_0x4191dc+')';if(!_0x3fc445)return _0x146170[_0x171df7(0x31b)][_0x171df7(0x212)](_0x592824,_0x592824['__'](_0x171df7(0x2f6)),'dialog');if(dbUserTable['doUserCanGet'](_0x146170,_0x592824,'',_0x171df7(0x329),_0x3fc445[_0x171df7(0x2e8)])!==!![])return;let _0x19db89=path[_0x171df7(0x204)](_0x3fc445[_0x171df7(0x2e8)]),_0x1cac76=movieSeasonUtil[_0x171df7(0x20f)](_0x19db89);_0x1cac76>-0x1&&(_0x3fc445['is_file']=0x0,_0x3fc445[_0x171df7(0x2e8)]=path[_0x171df7(0x33a)](_0x3fc445[_0x171df7(0x2e8)]),_0x3fc445[_0x171df7(0x266)]='');if(_0x3fc445['is_file']!=0x1){let _0x17f6cd=path[_0x171df7(0x299)](_0x3fc445[_0x171df7(0x2e8)],_0x3fc445[_0x171df7(0x266)]);console[_0x171df7(0x24a)](_0x171df7(0x2a0),_0x17f6cd);let _0x539c8c=_0x146170['app']['dbFileIndex'][_0x171df7(0x2ce)](_0x171df7(0x311))['all'](_0x17f6cd+path[_0x171df7(0x321)]+'%',_0x17f6cd);if(_0x539c8c[_0x171df7(0x28d)]<0x1)return _0x592824['json']({'code':0x0});_0x4145f6=_0x1f13d1(_0x539c8c);}return _0x146170[_0x171df7(0x31b)][_0x171df7(0x307)][_0x171df7(0x2ce)](_0x171df7(0x31a)+_0x4145f6+_0x171df7(0x29b))[_0x171df7(0x2d2)](_0x634c95),_0x592824[_0x171df7(0x2f1)]({'code':0x0});}else{if(_0x634c95&&_0x88baf5){let _0xa28f05=_0x146170[_0x171df7(0x31b)][_0x171df7(0x307)]['prepare'](_0x171df7(0x311))[_0x171df7(0x32a)](_0x88baf5+path['sep']+'%',_0x88baf5),_0x4b536e=_0x1f13d1(_0xa28f05);return _0x146170[_0x171df7(0x31b)][_0x171df7(0x307)][_0x171df7(0x2ce)]('UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20'+_0x4b536e+_0x171df7(0x29b))[_0x171df7(0x2d2)](_0x634c95),_0x592824['json']({'code':0x0});}else return _0x146170['app']['returnErrMsg'](_0x592824,_0x592824['__']('operationFail'),_0x171df7(0x2e4));}});function getCollectionList(_0x27d1e8,_0x50ab90,_0x3e2fce){const _0x3410ef=_0x36e771;let _0x2de604=[],_0x491076=_0x27d1e8[_0x3410ef(0x230)][_0x3410ef(0x2be)]||0x32,_0x3031fc=_0x27d1e8['body'][_0x3410ef(0x276)]||0x0,_0x2a37d2=_0x27d1e8['body']['orderField']||'id',_0x9c4531=_0x27d1e8[_0x3410ef(0x230)][_0x3410ef(0x304)]||_0x3410ef(0x32d),_0x59e25f=_0x27d1e8[_0x3410ef(0x230)][_0x3410ef(0x22f)],_0x346071=_0x3410ef(0x25c),_0x540045=_0x3410ef(0x26e)+_0x346071+_0x3410ef(0x286),_0x2933b4=[_0x3e2fce];_0x59e25f&&(_0x540045+='\x20AND\x20title\x20like\x20?\x20',_0x2933b4[_0x3410ef(0x21a)]('%'+_0x59e25f+'%'));_0x27d1e8['currentUser'][_0x3410ef(0x26d)]!=0x1&&(_0x540045+=_0x3410ef(0x32b),_0x2933b4[_0x3410ef(0x21a)](0x1));_0x540045+=_0x3410ef(0x2ac)+_0x2a37d2+'\x20'+_0x9c4531+'\x20LIMIT\x20?\x20OFFSET\x20?',_0x2933b4[_0x3410ef(0x21a)](_0x491076),_0x2933b4['push'](_0x3031fc),_0x2de604=_0x27d1e8['app'][_0x3410ef(0x307)][_0x3410ef(0x2ce)](_0x540045)[_0x3410ef(0x32a)](_0x2933b4);for(let _0x4d4c81 of _0x2de604){if(_0x4d4c81['enable_pwd']==0x1)continue;let _0x4fce61=getMoviesByParams(_0x50ab90,_0x27d1e8,null,'id',0x1,0x0,_0x3410ef(0x32d),null,null,null,null,null,null,_0x4d4c81['id']);_0x4fce61[_0x3410ef(0x28d)]>0x0&&(_0x4d4c81[_0x3410ef(0x303)]=_0x4fce61[0x0]);}return _0x2de604;}router[_0x36e771(0x2ba)](_0x36e771(0x267),(_0xd39afb,_0x38d895,_0x146a2c)=>{const _0x253100=_0x36e771;let _0x1fdd54=_0xd39afb[_0x253100(0x230)][_0x253100(0x292)]||_0x253100(0x1e9),_0x47abae=getCollectionList(_0xd39afb,_0x38d895,_0x1fdd54);return _0x38d895['json']({'code':0x0,'data':_0x47abae});}),router[_0x36e771(0x2ba)](_0x36e771(0x2e2),(_0x1fec20,_0x5688fc,_0x62f988)=>{const _0x3e7aec=_0x36e771;let _0x2b6cbc=_0x1fec20[_0x3e7aec(0x230)][_0x3e7aec(0x2c1)],_0x193b6d=_0x1fec20['body']['collectionId'];if(!_0x2b6cbc)return _0x1fec20[_0x3e7aec(0x31b)]['returnErrMsg'](_0x5688fc,_0x5688fc['__'](_0x3e7aec(0x1f1)),_0x3e7aec(0x2e4));_0x2b6cbc=sha256(_0x2b6cbc);let _0x1508b8=_0x1fec20[_0x3e7aec(0x31b)][_0x3e7aec(0x307)]['prepare'](_0x3e7aec(0x218))['get'](_0x193b6d,_0x2b6cbc);if(!_0x1508b8)return _0x1fec20[_0x3e7aec(0x31b)][_0x3e7aec(0x212)](_0x5688fc,_0x5688fc['__']('login.pwdErr'),_0x3e7aec(0x2e4));return _0x5688fc[_0x3e7aec(0x2f1)]({'code':0x0,'data':_0x1508b8});}),router[_0x36e771(0x2ba)](_0x36e771(0x2b9),(_0x5d3256,_0x1cea4d,_0x5bb6c5)=>{const _0x15a9ae=_0x36e771;let _0x23af6=_0x5d3256[_0x15a9ae(0x230)]['title'],_0x349e12=_0x5d3256[_0x15a9ae(0x230)][_0x15a9ae(0x248)],_0x4198b7=_0x5d3256[_0x15a9ae(0x230)]['pwd'],_0x46de60=_0x5d3256[_0x15a9ae(0x230)][_0x15a9ae(0x31e)],_0x5d5e12=_0x5d3256[_0x15a9ae(0x230)][_0x15a9ae(0x292)]?_0x5d3256['body']['type']:_0x15a9ae(0x1e9),_0x5c1928=_0x5d3256[_0x15a9ae(0x230)][_0x15a9ae(0x2b3)]?_0x5d3256['body']['data']:'',_0x327f7b=_0x5d3256[_0x15a9ae(0x230)][_0x15a9ae(0x33b)]?_0x5d3256[_0x15a9ae(0x230)]['coverPath']:'',_0x2f1a7a=_0x5d3256[_0x15a9ae(0x230)][_0x15a9ae(0x1f0)];_0x2f1a7a==null&&(_0x2f1a7a=0x1);if(_0x5d5e12==_0x15a9ae(0x2e7)){if(!_0x5c1928||!_0x5c1928[_0x15a9ae(0x20a)]||sqliteUtil['checkSqlInjection'](_0x5c1928[_0x15a9ae(0x20a)])==!![])return _0x5d3256[_0x15a9ae(0x31b)]['returnErrMsg'](_0x1cea4d,'error\x20data');}let _0x4017ae=_0x5d3256['body']['dataValue']?_0x5d3256[_0x15a9ae(0x230)][_0x15a9ae(0x2f0)]:'';if(_0x5d3256[_0x15a9ae(0x27c)][_0x15a9ae(0x26d)]!=0x1)return _0x5d3256[_0x15a9ae(0x31b)]['returnErrMsg'](_0x1cea4d,_0x1cea4d['__'](_0x15a9ae(0x2b5)));if(_0x349e12=='1'){if(!_0x4198b7)return _0x5d3256[_0x15a9ae(0x31b)]['returnErrMsg'](_0x1cea4d,_0x1cea4d['__']('pwdCanNotBeNull'),_0x15a9ae(0x2e4));_0x4198b7=sha256(_0x4198b7);}return _0x46de60?_0x5d3256[_0x15a9ae(0x31b)][_0x15a9ae(0x307)]['prepare'](_0x15a9ae(0x261))[_0x15a9ae(0x2d2)](_0x23af6,JSON[_0x15a9ae(0x32e)](_0x5c1928),_0x349e12+'',_0x4198b7,_0x327f7b,_0x4017ae,_0x2f1a7a,_0x46de60):_0x5d3256[_0x15a9ae(0x31b)]['dbFileIndex'][_0x15a9ae(0x2ce)](_0x15a9ae(0x2e9))[_0x15a9ae(0x2d2)](_0x23af6,_0x349e12+'',_0x4198b7,_0x5d3256[_0x15a9ae(0x27c)]['id']+'',_0x5d5e12,JSON['stringify'](_0x5c1928),_0x327f7b,_0x4017ae,_0x2f1a7a),_0x1cea4d[_0x15a9ae(0x2f1)]({'code':0x0});}),router[_0x36e771(0x2ba)](_0x36e771(0x1e5),(_0x41614f,_0x2188f1,_0x2ab6bd)=>{const _0x4941ff=_0x36e771;let _0x35215e=_0x41614f[_0x4941ff(0x230)][_0x4941ff(0x31e)];if(_0x41614f[_0x4941ff(0x27c)][_0x4941ff(0x26d)]!=0x1)return _0x41614f[_0x4941ff(0x31b)][_0x4941ff(0x212)](_0x2188f1,_0x2188f1['__']('noPermission'));return _0x41614f[_0x4941ff(0x31b)][_0x4941ff(0x307)][_0x4941ff(0x2ce)](_0x4941ff(0x2e1))['run'](_0x35215e),_0x41614f[_0x4941ff(0x31b)][_0x4941ff(0x307)][_0x4941ff(0x2ce)](_0x4941ff(0x2fa))[_0x4941ff(0x2d2)](_0x35215e),_0x2188f1[_0x4941ff(0x2f1)]({'code':0x0});}),router[_0x36e771(0x2ba)]('/clearHistory',(_0x572185,_0x149f4a,_0x1fed39)=>{const _0x402544=_0x36e771;return _0x572185[_0x402544(0x31b)][_0x402544(0x307)][_0x402544(0x2ce)](_0x402544(0x2aa)+_0x572185[_0x402544(0x27c)]['id'])[_0x402544(0x2d2)](),_0x149f4a[_0x402544(0x2f1)]({'code':0x0});}),router[_0x36e771(0x2ba)]('/addHistory',(_0x911a8a,_0x4ac337,_0x4bed43)=>{const _0x343dd4=_0x36e771;let _0x5251dc=_0x911a8a[_0x343dd4(0x230)]['indexId'],_0x58c48e=_0x911a8a['body'][_0x343dd4(0x2b0)],_0x354b32=dbFileIndexTable[_0x343dd4(0x31f)](_0x911a8a[_0x343dd4(0x31b)]['dbFileIndex'],_0x5251dc,dbFileIndexTable[_0x343dd4(0x30c)]);if(!_0x354b32)return _0x4ac337[_0x343dd4(0x2f1)]({'code':0x0});if(_0x354b32[_0x343dd4(0x23a)]){let _0x455d2d=_0x911a8a['app'][_0x343dd4(0x307)]['prepare']('SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?')['get'](_0x354b32[_0x343dd4(0x23a)]);if(_0x455d2d&&_0x455d2d[_0x343dd4(0x1f5)]==0x1)return _0x4ac337[_0x343dd4(0x2f1)]({'code':0x0});}let _0x2fdc62=_0x911a8a[_0x343dd4(0x31b)]['dbFileIndex'][_0x343dd4(0x2ce)]('SELECT\x20*\x20from\x20movie_history\x20WHERE\x20index_id=?\x20and\x20user_id=?')[_0x343dd4(0x288)](_0x5251dc+'',_0x911a8a['currentUser']['id']+'');return _0x2fdc62?_0x911a8a[_0x343dd4(0x31b)]['dbFileIndex'][_0x343dd4(0x2ce)](_0x343dd4(0x241))[_0x343dd4(0x2d2)](_0x58c48e,new Date()['getTime'](),_0x5251dc+'',_0x911a8a[_0x343dd4(0x27c)]['id']+''):_0x911a8a[_0x343dd4(0x31b)]['dbFileIndex'][_0x343dd4(0x2ce)](_0x343dd4(0x26f))['run'](_0x5251dc+'',_0x911a8a[_0x343dd4(0x27c)]['id']+'',_0x58c48e,new Date()[_0x343dd4(0x2f3)]()),_0x4ac337['json']({'code':0x0});}),router[_0x36e771(0x2ba)](_0x36e771(0x21f),(_0x25b383,_0x1b6e87,_0x4bdc1c)=>{const _0x915595=_0x36e771;let _0x5eb97c=_0x25b383[_0x915595(0x230)][_0x915595(0x23c)],_0x3af7db=_0x915595(0x2cc);if(_0x5eb97c){let _0x3e3591=_0x25b383[_0x915595(0x31b)][_0x915595(0x307)]['prepare'](_0x915595(0x313))[_0x915595(0x288)](_0x25b383[_0x915595(0x27c)]['id']+'',_0x5eb97c+'');return _0x1b6e87[_0x915595(0x2f1)]({'code':0x0,'data':_0x3e3591});}else{let _0x4bf4d7='SELECT\x20'+_0x3af7db+_0x915595(0x2a5)+_0x25b383[_0x915595(0x27c)]['id']+_0x915595(0x220),_0x5a2e0d=_0x25b383[_0x915595(0x31b)][_0x915595(0x307)][_0x915595(0x2ce)](_0x4bf4d7)['all']();return _0x1b6e87[_0x915595(0x2f1)]({'code':0x0,'data':_0x5a2e0d});}}),router[_0x36e771(0x2ba)](_0x36e771(0x1f8),(_0x46113e,_0x407fb9,_0x42274b)=>{const _0x31f33f=_0x36e771;let _0x444922=_0x46113e[_0x31f33f(0x230)]['id'],_0x5a1711=dbFileIndexTable['getById'](_0x46113e['app'][_0x31f33f(0x307)],_0x444922,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(dbUserTable[_0x31f33f(0x32c)](_0x46113e,_0x407fb9,_0x31f33f(0x1ec),_0x31f33f(0x2a3),_0x5a1711[_0x31f33f(0x2e8)])==!![]){let _0x218db2={'code':0x0,'data':_0x5a1711};return _0x407fb9['json'](_0x218db2);}}),router[_0x36e771(0x2ba)](_0x36e771(0x28c),(_0x476553,_0x1d4a48,_0x508943)=>{const _0x12bdc7=_0x36e771;let _0x5b33e3=_0x476553[_0x12bdc7(0x230)][_0x12bdc7(0x1eb)],_0x1612a4=_0x476553[_0x12bdc7(0x230)][_0x12bdc7(0x1f3)];if(dbUserTable[_0x12bdc7(0x1ed)](_0x476553,_0x1d4a48)===!![]){let _0x28f8e1=dbSourceFolderTable[_0x12bdc7(0x31f)](_0x476553[_0x12bdc7(0x31b)][_0x12bdc7(0x2f7)],_0x5b33e3);if(!_0x28f8e1)return _0x1d4a48[_0x12bdc7(0x2a8)](0x194)[_0x12bdc7(0x207)]();return _0x1612a4==0x1?(_0x476553['app'][_0x12bdc7(0x307)]['prepare'](_0x12bdc7(0x328))['run'](_0x28f8e1[_0x12bdc7(0x2e8)]+path[_0x12bdc7(0x321)]+'%',_0x28f8e1[_0x12bdc7(0x2e8)]),dbSourceFolderTable[_0x12bdc7(0x2a4)](_0x476553[_0x12bdc7(0x31b)]['dbOther'],_0x12bdc7(0x2ef),_0x1612a4,_0x5b33e3),process[_0x12bdc7(0x2de)]({'type':_0x12bdc7(0x300)}),_0x1d4a48['json']({'code':0x0})):(dbSourceFolderTable['updateByWhere'](_0x476553[_0x12bdc7(0x31b)]['dbOther'],'ignore_match_info',_0x1612a4,_0x5b33e3),_0x476553[_0x12bdc7(0x31b)][_0x12bdc7(0x307)][_0x12bdc7(0x2ce)]('UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0\x20WHERE\x20(path\x20like\x20?\x20OR\x20path=?)')[_0x12bdc7(0x2d2)](_0x28f8e1[_0x12bdc7(0x2e8)]+path[_0x12bdc7(0x321)]+'%',_0x28f8e1[_0x12bdc7(0x2e8)]),process[_0x12bdc7(0x2de)]({'type':_0x12bdc7(0x300)}),_0x1d4a48[_0x12bdc7(0x2f1)]({'code':0x0}));}}),router[_0x36e771(0x2ba)](_0x36e771(0x2ca),(_0xa99e8a,_0x2427de,_0x3d5951)=>{const _0x4dea99=_0x36e771;let _0x4760b9=_0xa99e8a['body'][_0x4dea99(0x24f)],_0x2a52e8=_0xa99e8a[_0x4dea99(0x230)]['indexId'],_0x3b91aa=_0xa99e8a[_0x4dea99(0x230)]['sourceFolderId'];function _0x200c1b(_0x6f23){const _0x32e838=_0x4dea99;let _0x26d19c=_0xa99e8a[_0x32e838(0x31b)][_0x32e838(0x307)][_0x32e838(0x2ce)](_0x32e838(0x293)+dbFileIndexTable[_0x32e838(0x30c)]+'\x20WHERE\x20path=?\x20and\x20is_file=1\x20and\x20type=2\x20order\x20by\x20filename')[_0x32e838(0x288)](_0x6f23);if(!_0x26d19c)return;_0xa99e8a[_0x32e838(0x31b)][_0x32e838(0x307)]['prepare']('UPDATE\x20'+dbFileIndexTable[_0x32e838(0x30c)]+_0x32e838(0x2f5))[_0x32e838(0x2d2)](_0x6f23),_0xa99e8a[_0x32e838(0x31b)][_0x32e838(0x307)][_0x32e838(0x2ce)]('UPDATE\x20'+dbFileIndexTable[_0x32e838(0x30c)]+_0x32e838(0x231))[_0x32e838(0x2d2)](_0x26d19c['id']),movieUtil[_0x32e838(0x206)](_0xa99e8a[_0x32e838(0x31b)]['dbFileIndex'],_0x26d19c);}if(_0x2a52e8){let _0x570d9f=dbFileIndexTable[_0x4dea99(0x31f)](_0xa99e8a[_0x4dea99(0x31b)]['dbFileIndex'],_0x2a52e8,dbFileIndexTable[_0x4dea99(0x30c)]);if(dbUserTable[_0x4dea99(0x32c)](_0xa99e8a,_0x2427de,'movie',_0x4dea99(0x329),_0x570d9f['path'])==!![])return _0x4760b9==0x1?_0x200c1b(_0x570d9f['path']):_0xa99e8a[_0x4dea99(0x31b)]['dbFileIndex'][_0x4dea99(0x2ce)](_0x4dea99(0x232)+dbFileIndexTable[_0x4dea99(0x30c)]+_0x4dea99(0x2d6)+_0x570d9f[_0x4dea99(0x2e8)]+'\x27')[_0x4dea99(0x2d2)](),_0x2427de[_0x4dea99(0x2f1)]({'code':0x0});}else{if(_0x3b91aa){let _0x3e5928=dbSourceFolderTable[_0x4dea99(0x31f)](_0xa99e8a[_0x4dea99(0x31b)]['dbOther'],_0x3b91aa);if(!_0x3e5928||_0x3e5928[_0x4dea99(0x292)]!='movie')return _0xa99e8a[_0x4dea99(0x31b)][_0x4dea99(0x212)](_0x2427de,_0x2427de['__'](_0x4dea99(0x2f6)),'dialog');if(_0x4760b9==0x1){dbSourceFolderTable[_0x4dea99(0x2a4)](_0xa99e8a[_0x4dea99(0x31b)][_0x4dea99(0x2f7)],_0x4dea99(0x28a),_0x4dea99(0x1fd),_0x3b91aa),_0x200c1b(_0x3e5928['path']);let _0xe60bb3=_0xa99e8a[_0x4dea99(0x31b)][_0x4dea99(0x307)][_0x4dea99(0x2ce)]('SELECT\x20path,filename\x20from\x20'+dbFileIndexTable[_0x4dea99(0x30c)]+_0x4dea99(0x219))['all'](_0x3e5928['path'],''+_0x3e5928['path']+path[_0x4dea99(0x321)]+'%');for(let _0x41aad5 in _0xe60bb3){let _0x50a70d=path[_0x4dea99(0x299)](_0xe60bb3[_0x41aad5][_0x4dea99(0x2e8)],_0xe60bb3[_0x41aad5]['filename']);_0x200c1b(_0x50a70d);}}else{dbSourceFolderTable[_0x4dea99(0x2a4)](_0xa99e8a[_0x4dea99(0x31b)][_0x4dea99(0x2f7)],_0x4dea99(0x28a),_0x4dea99(0x1ec),_0x3b91aa);let _0x5704f0=_0xa99e8a[_0x4dea99(0x31b)]['dbFileIndex'][_0x4dea99(0x2ce)](_0x4dea99(0x232)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+'\x20SET\x20show_in_list=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=?\x20or\x20path\x20like\x20?')[_0x4dea99(0x2d2)](_0x3e5928[_0x4dea99(0x2e8)],''+_0x3e5928[_0x4dea99(0x2e8)]+path[_0x4dea99(0x321)]+'%');}return _0x2427de['json']({'code':0x0});}else return _0xa99e8a[_0x4dea99(0x31b)][_0x4dea99(0x212)](_0x2427de,_0x2427de['__'](_0x4dea99(0x2f6)),_0x4dea99(0x2e4));}});function setLogoAndFanart(_0x66238f,_0x57a0b9,_0x313736,_0x12ec9f){const _0x10ae1d=_0x36e771;if(_0x66238f[_0x10ae1d(0x230)]['needLogoPathAndFanart']){let _0x590442=_0x10ae1d(0x2c7),_0x3b422b=[_0x313736];_0x12ec9f?(_0x590442+=_0x10ae1d(0x262),_0x3b422b[_0x10ae1d(0x21a)](_0x10ae1d(0x20b)),_0x3b422b[_0x10ae1d(0x21a)](_0x12ec9f+_0x10ae1d(0x1f6)),_0x3b422b[_0x10ae1d(0x21a)](_0x12ec9f+_0x10ae1d(0x308))):(_0x590442+='(filename\x20like\x20?)',_0x3b422b[_0x10ae1d(0x21a)](_0x10ae1d(0x20b)));let _0x3ffb51=_0x66238f[_0x10ae1d(0x31b)][_0x10ae1d(0x307)][_0x10ae1d(0x2ce)](_0x590442)[_0x10ae1d(0x288)](_0x3b422b);if(_0x3ffb51){let _0x2a0a66=path[_0x10ae1d(0x299)](_0x3ffb51[_0x10ae1d(0x2e8)],_0x3ffb51[_0x10ae1d(0x266)]);_0x57a0b9[_0x10ae1d(0x2b7)]=_0x2a0a66;}let _0xf95cae=_0x10ae1d(0x2c7),_0x3730de=[_0x313736];_0x12ec9f?(_0xf95cae+='(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20or\x20filename\x20like\x20?)',_0x3730de[_0x10ae1d(0x21a)](_0x10ae1d(0x2b6)),_0x3730de[_0x10ae1d(0x21a)](_0x12ec9f+_0x10ae1d(0x20d)),_0x3730de[_0x10ae1d(0x21a)](_0x12ec9f+'.fanart.%')):(_0xf95cae+=_0x10ae1d(0x26c),_0x3730de[_0x10ae1d(0x21a)](_0x10ae1d(0x2b6)));let _0x278e3c=_0x66238f['app'][_0x10ae1d(0x307)][_0x10ae1d(0x2ce)](_0xf95cae)['get'](_0x3730de);if(_0x278e3c){let _0x149184=path[_0x10ae1d(0x299)](_0x278e3c[_0x10ae1d(0x2e8)],_0x278e3c['filename']);_0x57a0b9[_0x10ae1d(0x1fa)]=_0x149184;}}}function addTvFolderPathAndName(_0x18c6a9){const _0x457664=_0x36e771;_0x18c6a9[_0x457664(0x298)]=path[_0x457664(0x204)](_0x18c6a9[_0x457664(0x2e8)]),_0x18c6a9[_0x457664(0x330)]=_0x18c6a9[_0x457664(0x2e8)];if(_0x18c6a9[_0x457664(0x214)]==0x1){let _0x29047c=path[_0x457664(0x204)](_0x18c6a9['path']),_0x447b25=path[_0x457664(0x33a)](_0x18c6a9[_0x457664(0x2e8)]),_0x2ec149=movieSeasonUtil[_0x457664(0x20f)](_0x29047c);_0x2ec149>-0x1&&(_0x18c6a9[_0x457664(0x298)]=path['basename'](_0x447b25),_0x18c6a9[_0x457664(0x330)]=_0x447b25);if(!_0x18c6a9[_0x457664(0x342)])_0x18c6a9[_0x457664(0x342)]=_0x18c6a9[_0x457664(0x298)];}}function addFolderCoverPath(_0x4c3d0f,_0x35aacc,_0x567d68,_0xcca53b=![]){const _0x15730a=_0x36e771;let _0x56f2d4;addTvFolderPathAndName(_0x567d68);let _0x298e2c=_0x567d68['id']+_0x15730a(0x213)+_0xcca53b;!_0x35aacc['movieTvCache']&&(_0x35aacc[_0x15730a(0x22c)]=new Map());try{if(_0x567d68['is_tvplay']==0x1&&!_0xcca53b)try{let _0x2acbc8=path[_0x15730a(0x204)](_0x567d68[_0x15730a(0x2e8)]),_0x2acdd0=path[_0x15730a(0x33a)](_0x567d68['path']),_0x59cf5d=movieSeasonUtil[_0x15730a(0x20f)](_0x2acbc8);if(_0x59cf5d>-0x1){_0x567d68[_0x15730a(0x2bf)]=0x1,_0x567d68['seasonNumber']=_0x59cf5d;if(_0x35aacc[_0x15730a(0x230)][_0x15730a(0x24d)]){let _0x3c63f6=_0x2acdd0+'-seasonCount-'+_0xcca53b;_0x35aacc[_0x15730a(0x22c)][_0x15730a(0x2d5)](_0x3c63f6)?_0x567d68[_0x15730a(0x268)]=_0x35aacc[_0x15730a(0x22c)][_0x15730a(0x288)](_0x3c63f6):(_0x567d68[_0x15730a(0x268)]=_0x35aacc['app'][_0x15730a(0x307)]['prepare'](_0x15730a(0x2e5))[_0x15730a(0x288)](''+_0x2acdd0+path[_0x15730a(0x321)]+'%')[_0x15730a(0x2be)],_0x35aacc[_0x15730a(0x22c)][_0x15730a(0x225)](_0x3c63f6,_0x567d68[_0x15730a(0x268)]));}}setLogoAndFanart(_0x35aacc,_0x567d68,_0x567d68[_0x15730a(0x330)]);if(_0x35aacc[_0x15730a(0x230)]['useTvSeriesInfo']==0x1&&_0x59cf5d>-0x1){let _0x599799=_0x567d68[_0x15730a(0x330)]+_0x15730a(0x295);if(_0x35aacc['movieTvCache'][_0x15730a(0x2d5)](_0x599799))return _0x567d68['folder_cover_path']=_0x35aacc[_0x15730a(0x22c)]['get'](_0x599799),_0x567d68;let _0x599743=getTvSeriesPoster(_0x567d68);if(_0x599743)return _0x35aacc[_0x15730a(0x22c)][_0x15730a(0x225)](_0x599799,_0x599743),_0x567d68[_0x15730a(0x23d)]=_0x599743,_0x567d68;}if(!_0x56f2d4&&_0x35aacc[_0x15730a(0x22c)]['has'](_0x298e2c))return _0x567d68['folder_cover_path']=_0x35aacc[_0x15730a(0x22c)][_0x15730a(0x288)](_0x298e2c),_0x567d68;if(!_0x56f2d4&&_0x59cf5d>-0x1){parseInt(_0x59cf5d)<0xa&&(_0x59cf5d='0'+_0x59cf5d);let _0x5755f7=_0x15730a(0x2b2)+_0x59cf5d+'%poster%',_0x2e4b18='%s'+_0x59cf5d+'%poster%',_0x3932a4='SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27'+_0x2acdd0+'\x27\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27'+_0x5755f7+_0x15730a(0x21c)+_0x2e4b18+'\x27)';_0x56f2d4=_0x35aacc[_0x15730a(0x31b)][_0x15730a(0x307)][_0x15730a(0x2ce)](_0x3932a4)[_0x15730a(0x288)]();}!_0x56f2d4&&(_0x56f2d4=_0x35aacc[_0x15730a(0x31b)][_0x15730a(0x307)][_0x15730a(0x2ce)](_0x15730a(0x23e))[_0x15730a(0x288)](_0x567d68[_0x15730a(0x2e8)]));}catch(_0x1efa1c){console[_0x15730a(0x24a)](_0x1efa1c);}else{if(_0x35aacc[_0x15730a(0x22c)]['has'](_0x298e2c))return _0x567d68[_0x15730a(0x23d)]=_0x35aacc[_0x15730a(0x22c)][_0x15730a(0x288)](_0x298e2c),_0x567d68;let _0x3229b5=path[_0x15730a(0x2f8)](_0x567d68[_0x15730a(0x266)]),_0x5a8784=_0x3229b5['name'],_0x4afe09=path[_0x15730a(0x299)](_0x567d68[_0x15730a(0x2e8)],_0x5a8784+_0x15730a(0x202));if(fs[_0x15730a(0x2d1)](_0x4afe09))return _0x567d68[_0x15730a(0x23d)]=_0x4afe09,_0x567d68;!_0x56f2d4&&(_0x56f2d4=_0x35aacc['app']['dbFileIndex'][_0x15730a(0x2ce)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20filename\x20like\x20?')[_0x15730a(0x288)](_0x567d68[_0x15730a(0x2e8)],'%'+_0x5a8784+_0x15730a(0x2ec)));if(!_0x56f2d4){let _0xfa35c0=_0x5a8784;(_0x5a8784[_0x15730a(0x239)](_0x15730a(0x282))||_0x5a8784[_0x15730a(0x239)](_0x15730a(0x2a7))||_0x5a8784[_0x15730a(0x239)](_0x15730a(0x289))||_0x5a8784[_0x15730a(0x239)](_0x15730a(0x2b1)))&&(_0x5a8784[_0x15730a(0x239)](_0x15730a(0x282))?_0xfa35c0=_0xfa35c0[_0x15730a(0x252)](0x0,_0xfa35c0[_0x15730a(0x28d)]-0x3):_0xfa35c0=_0xfa35c0['substr'](0x0,_0xfa35c0['length']-0x4)),_0x56f2d4=_0x35aacc['app'][_0x15730a(0x307)][_0x15730a(0x2ce)](_0x15730a(0x20e))[_0x15730a(0x288)](_0x567d68[_0x15730a(0x2e8)],_0x5a8784+'%',_0xfa35c0+'%','%fanart%');}!_0x56f2d4&&(_0x56f2d4=_0x35aacc[_0x15730a(0x31b)][_0x15730a(0x307)][_0x15730a(0x2ce)]('SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)')[_0x15730a(0x288)](_0x567d68[_0x15730a(0x2e8)]));let {name:_0x30f5c8}=path[_0x15730a(0x2f8)](_0x567d68['filename']);setLogoAndFanart(_0x35aacc,_0x567d68,_0x567d68[_0x15730a(0x2e8)],_0x30f5c8);}if(_0x56f2d4){let _0x577fc6=path[_0x15730a(0x299)](_0x56f2d4['path'],_0x56f2d4['filename']);!_0x577fc6[_0x15730a(0x239)](_0x15730a(0x31c))&&!_0x577fc6[_0x15730a(0x239)]('heic')&&fs['existsSync'](_0x577fc6)?(_0x567d68['folder_cover_path']=_0x577fc6,_0x35aacc[_0x15730a(0x22c)][_0x15730a(0x225)](_0x298e2c,_0x567d68[_0x15730a(0x23d)])):_0x35aacc['movieTvCache'][_0x15730a(0x225)](_0x298e2c,'');}return _0x567d68;}catch(_0x1d417b){return console[_0x15730a(0x24a)](_0x1d417b),_0x567d68;}}function getMoviesByParams(_0x4ab15f,_0x4dd0d5,_0x4582f0,_0x475c30,_0x3924eb,_0x30999c,_0x58e310,_0x1d1104,_0x4758c5,_0x2f8728,_0x2762b5,_0x4ec9a6,_0x5de0f3,_0xe3e387,_0x28a24f,_0x22a2e8,_0x20001f,_0x1cf48){const _0x5815ea=_0x36e771;let _0x4966c6=movieFieldStr;_0x1cf48&&(_0x4966c6=_0x1cf48);!_0x28a24f&&(_0x28a24f=_0x5815ea(0x2a2));let _0x53e371='',_0x22145f=[],_0x38ebbd=dbUserTable[_0x5815ea(0x25e)](_0x4dd0d5,_0x5815ea(0x1ec),_0x5815ea(0x2a3),!![],_0x2f8728);if(_0x4dd0d5[_0x5815ea(0x27c)][_0x5815ea(0x26d)]!=0x1&&!_0x38ebbd)return[];_0x53e371+=_0x5815ea(0x234);_0x4758c5&&(_0x4758c5=_0x4758c5[_0x5815ea(0x296)]('\x27','')[_0x5815ea(0x296)]('’',''),_0x53e371+=_0x5815ea(0x2ad),_0x22145f[_0x5815ea(0x21a)]('%'+_0x4758c5+'%'),_0x22145f[_0x5815ea(0x21a)]('%'+_0x4758c5+'%'),_0x22145f[_0x5815ea(0x21a)]('%'+_0x4758c5+'%'));let _0x3d11b8=dbSourceFolderTable[_0x5815ea(0x30d)](_0x4dd0d5['app'][_0x5815ea(0x2f7)],_0x5815ea(0x2e8),_0x5815ea(0x260));_0x3d11b8&&(_0x53e371+=_0x5815ea(0x235)+_0x3d11b8);let _0x4ab878=dbSourceFolderTable[_0x5815ea(0x30d)](_0x4dd0d5['app'][_0x5815ea(0x2f7)],_0x5815ea(0x266),_0x5815ea(0x2db));_0x4ab878&&(_0x53e371+=_0x5815ea(0x235)+_0x4ab878);function _0x5067ec(_0x24f3f9,_0x5f0794){const _0x2d4eae=_0x5815ea;let _0x4583dd=_0x2d4eae(0x2da);try{let _0x1646ba=JSON[_0x2d4eae(0x2f8)](_0x5f0794),_0x311cf9=![];for(let _0x1a4dbf=0x0;_0x1a4dbf<_0x1646ba[_0x2d4eae(0x28d)];_0x1a4dbf++){if(!_0x1646ba[_0x1a4dbf])continue;_0x311cf9=!![],_0x4583dd+='\x20'+_0x24f3f9+_0x2d4eae(0x21b),_0x22145f['push']('%'+_0x1646ba[_0x1a4dbf][_0x2d4eae(0x227)]()+'%'),_0x1a4dbf!=_0x1646ba['length']-0x1&&(_0x4583dd+=_0x2d4eae(0x324));}_0x4583dd+=')',_0x311cf9&&(_0x53e371+=_0x4583dd);}catch(_0x277234){console['log'](_0x277234);}}_0x2762b5&&_0x5067ec(_0x5815ea(0x306),_0x2762b5);_0x4ec9a6&&_0x5067ec(_0x5815ea(0x205),_0x4ec9a6);_0x5de0f3&&_0x5067ec(_0x5815ea(0x236),_0x5de0f3);_0x4dd0d5['body']['movieActors']&&_0x4dd0d5[_0x5815ea(0x230)]['movieActors'][_0x5815ea(0x28d)]>0x0&&_0x4dd0d5[_0x5815ea(0x230)][_0x5815ea(0x26a)][0x0]!=''&&_0x5067ec('movie_actor',_0x4dd0d5[_0x5815ea(0x230)][_0x5815ea(0x26a)]);_0x4dd0d5[_0x5815ea(0x230)]['movieDirectors']&&_0x4dd0d5[_0x5815ea(0x230)]['movieDirectors'][_0x5815ea(0x28d)]>0x0&&_0x4dd0d5[_0x5815ea(0x230)][_0x5815ea(0x237)][0x0]!=''&&_0x5067ec(_0x5815ea(0x224),_0x4dd0d5[_0x5815ea(0x230)][_0x5815ea(0x237)]);if(_0x20001f){let _0x5ee18f=_0x4dd0d5['app'][_0x5815ea(0x307)][_0x5815ea(0x2ce)](_0x5815ea(0x1fb))[_0x5815ea(0x288)](_0x20001f);if(_0x5ee18f)try{let _0x594917=JSON[_0x5815ea(0x2f8)](_0x5ee18f[_0x5815ea(0x1f4)]),_0x5420bb=dbUserTable[_0x5815ea(0x28e)](!![],_0x594917);_0x53e371+=_0x5420bb;}catch(_0x3c1daa){console[_0x5815ea(0x24a)](_0x3c1daa);}}else{!_0xe3e387&&(_0xe3e387=0x0);let _0x5d4936;if(_0xe3e387!=0x0){_0x5d4936=_0x4dd0d5[_0x5815ea(0x31b)][_0x5815ea(0x307)][_0x5815ea(0x2ce)](_0x5815ea(0x2fc))[_0x5815ea(0x288)](_0xe3e387);if(!_0x5d4936)return _0x4dd0d5[_0x5815ea(0x31b)][_0x5815ea(0x212)](_0x4ab15f,_0x4ab15f['__'](_0x5815ea(0x233)));if(_0x5d4936[_0x5815ea(0x1f5)]==0x1){let _0x52876f=_0x4dd0d5[_0x5815ea(0x230)][_0x5815ea(0x29d)];if(!_0x52876f||_0x5d4936[_0x5815ea(0x2c1)]!=sha256(_0x52876f))return _0x4dd0d5['app'][_0x5815ea(0x212)](_0x4ab15f,_0x4ab15f['__'](_0x5815ea(0x30f)));}}if(_0x5d4936&&_0x5d4936[_0x5815ea(0x292)]=='smart')try{_0x5d4936[_0x5815ea(0x2b3)]=JSON[_0x5815ea(0x2f8)](_0x5d4936[_0x5815ea(0x2b3)]),_0x53e371+=_0x5815ea(0x235)+_0x5d4936[_0x5815ea(0x2b3)][_0x5815ea(0x20a)];}catch(_0x3add74){console[_0x5815ea(0x24a)](_0x3add74);}else _0x53e371+=_0x5815ea(0x30a)+_0xe3e387;}if(_0x4582f0){if(_0x4582f0==0x1)_0x53e371+='\x20AND\x20is_tvplay==0';else _0x4582f0==0x2&&(_0x53e371+='\x20AND\x20is_tvplay==1');}_0x22a2e8&&(_0x22a2e8=='#'?(_0x53e371+=_0x5815ea(0x2c9),_0x22145f[_0x5815ea(0x21a)](_0x22a2e8),_0x22145f[_0x5815ea(0x21a)](_0x22a2e8),_0x22145f['push'](_0x22a2e8)):(_0x53e371+=_0x5815ea(0x2c5),_0x22145f['push'](_0x22a2e8),_0x22145f[_0x5815ea(0x21a)](_0x22a2e8),_0x22145f[_0x5815ea(0x21a)](_0x22a2e8)));if(_0x1d1104&&_0x1d1104[_0x5815ea(0x28d)]>0x0){_0x53e371+=_0x5815ea(0x279);for(let _0x55651a=0x0;_0x55651a<_0x1d1104[_0x5815ea(0x28d)];_0x55651a++){_0x53e371+=_0x1d1104[_0x55651a],_0x55651a!=_0x1d1104['length']-0x1&&(_0x53e371+=',');}_0x53e371+=')';}_0x53e371+=_0x38ebbd;_0x475c30&&_0x58e310?_0x53e371+=_0x5815ea(0x32f)+_0x475c30+'\x20'+_0x58e310:_0x53e371+=_0x5815ea(0x2f2);!_0x3924eb&&(_0x3924eb=0x32);_0x53e371+=_0x5815ea(0x1ef),_0x22145f[_0x5815ea(0x21a)](_0x3924eb),_0x22145f['push'](_0x30999c);let _0x1c3ddb=[];if(_0x28a24f==_0x5815ea(0x249))_0x1c3ddb=dbMovieFavorite[_0x5815ea(0x28b)](_0x4dd0d5['app']['dbFileIndex'],_0x4dd0d5[_0x5815ea(0x27c)]['id'],_0x53e371,_0x4966c6,_0x22145f);else _0x28a24f==_0x5815ea(0x2a2)&&(_0x1c3ddb=dbFileIndexTable['getAllByWhereAndField'](_0x4dd0d5[_0x5815ea(0x31b)]['dbFileIndex'],_0x53e371,_0x4966c6,dbFileIndexTable[_0x5815ea(0x30c)],_0x22145f));if(_0x1c3ddb[_0x5815ea(0x28d)]<0x1)return _0x1c3ddb;let _0x3508eb=[];for(let _0xd17600 in _0x1c3ddb){_0x3508eb[_0x5815ea(0x21a)](_0x1c3ddb[_0xd17600]['id']);}let _0x134dcf=dbMovieFavorite[_0x5815ea(0x26b)](_0x4dd0d5[_0x5815ea(0x31b)][_0x5815ea(0x307)],_0x4dd0d5['currentUser']['id'],_0x3508eb);for(let _0xe10cf9=0x0;_0xe10cf9<_0x1c3ddb['length'];_0xe10cf9++){_0x1c3ddb[_0xe10cf9]['favorite']=0x0;for(let _0x5c36b3 in _0x134dcf){if(_0x134dcf[_0x5c36b3][_0x5815ea(0x223)]==_0x1c3ddb[_0xe10cf9]['id']){_0x1c3ddb[_0xe10cf9]['favorite']=0x1;break;}}let _0x1816aa=_0x4dd0d5[_0x5815ea(0x31b)]['dbFileIndex'][_0x5815ea(0x2ce)](_0x5815ea(0x313))[_0x5815ea(0x288)](_0x4dd0d5[_0x5815ea(0x27c)]['id']+'',_0x1c3ddb[_0xe10cf9]['id']+'');_0x1816aa&&(_0x1c3ddb[_0xe10cf9][_0x5815ea(0x285)]=_0x1816aa);_0x1c3ddb[_0xe10cf9]=addFolderCoverPath(_0x4ab15f,_0x4dd0d5,_0x1c3ddb[_0xe10cf9]);if(_0x1c3ddb[_0xe10cf9][_0x5815ea(0x214)]==0x1&&_0x4dd0d5[_0x5815ea(0x230)]['needTvCount']){let _0x769ac4=dbFileIndexTable[_0x5815ea(0x343)](_0x4dd0d5['app'][_0x5815ea(0x307)],_0x1c3ddb[_0xe10cf9]);_0x1c3ddb[_0xe10cf9][_0x5815ea(0x264)]=_0x769ac4[_0x5815ea(0x2be)];}}return _0x1c3ddb;}function getShowMatchName(_0x25aa22){const _0x5768be=_0x36e771;let _0x3ccd15=dbConfigTable['findByTitle'](_0x25aa22,_0x5768be(0x24e));return!_0x3ccd15||_0x3ccd15&&_0x3ccd15[_0x5768be(0x1fc)]!=0x0?0x1:0x0;}router[_0x36e771(0x2ba)]('/getMovies',(_0x48dcd4,_0xee2b5c,_0x506d6f)=>{const _0x41b26f=_0x36e771;if(dbUserTable[_0x41b26f(0x32c)](_0x48dcd4,_0xee2b5c,_0x41b26f(0x1ec),'power_get')==!![]){let _0x4e1593=_0x48dcd4['body'][_0x41b26f(0x2be)],_0x188921=_0x48dcd4['body']['offset'],_0x9d7a0a=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x2fe)],_0x3aa599=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x275)],_0x54116f=_0x48dcd4['body'][_0x41b26f(0x291)],_0x479de8=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x1f2)],_0x1f0cd8=_0x48dcd4[_0x41b26f(0x230)]['sourceFolderList'],_0x1159ab=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x317)],_0x4ef3b4=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x325)],_0x35a1dc=_0x48dcd4['body']['movieGenres'],_0x36a97b=_0x48dcd4['body'][_0x41b26f(0x258)],_0x21d322=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x31e)],_0x31d633=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x2d3)],_0x5978e9=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x201)],_0x41d3e9=_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x2d8)];_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x1f9)]=!![],_0x48dcd4[_0x41b26f(0x230)][_0x41b26f(0x24d)]=!![];let _0x55d8b5=getMoviesByParams(_0xee2b5c,_0x48dcd4,_0x36a97b,_0x9d7a0a,_0x4e1593,_0x188921,_0x3aa599,_0x54116f,_0x479de8,_0x1f0cd8,_0x1159ab,_0x4ef3b4,_0x35a1dc,_0x21d322,_0x31d633,_0x5978e9,_0x41d3e9);return _0xee2b5c['json']({'movieShowMatchName':getShowMatchName(_0x48dcd4[_0x41b26f(0x31b)][_0x41b26f(0x2f7)]),'code':0x0,'data':_0x55d8b5});}}),router[_0x36e771(0x2ba)](_0x36e771(0x203),(_0x24fff8,_0x535407,_0x1f077c)=>{const _0x289f56=_0x36e771;if(dbUserTable[_0x289f56(0x32c)](_0x24fff8,_0x535407,_0x289f56(0x1ec),'power_get')==!![]){let _0x57cd37=_0x24fff8[_0x289f56(0x230)][_0x289f56(0x2ee)],_0x319cb3=_0x24fff8[_0x289f56(0x230)]['pageCount'],_0x3509ad=_0x24fff8[_0x289f56(0x230)][_0x289f56(0x258)];!_0x319cb3&&(_0x319cb3=0x9);let _0x1c9b3a='\x20id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list',_0x2e9393='';_0x57cd37?_0x2e9393=dbUserTable['getUserPathWhere'](_0x24fff8,'movie',_0x289f56(0x2a3),!![],_0x57cd37):_0x2e9393=dbUserTable[_0x289f56(0x25e)](_0x24fff8,_0x289f56(0x1ec),_0x289f56(0x2a3),!![]);let _0x5c0fe4=_0x24fff8['body'][_0x289f56(0x22b)];!_0x5c0fe4&&(_0x5c0fe4=_0x289f56(0x236));let _0x1eaed6=_0x24fff8[_0x289f56(0x31b)]['dbFileIndex']['prepare'](_0x289f56(0x259))[_0x289f56(0x32a)](_0x5c0fe4),_0x2556f6=[];for(let _0xa17e7d of _0x1eaed6){let _0x165c08=_0xa17e7d[_0x289f56(0x2d7)],_0x1ced96=_0x289f56(0x234);_0x1ced96+=_0x2e9393,_0x1ced96+=_0x289f56(0x274);if(_0x3509ad){if(_0x3509ad==0x1)_0x1ced96+='\x20AND\x20is_tvplay==0';else _0x3509ad==0x2&&(_0x1ced96+=_0x289f56(0x2eb));}_0x1ced96+=_0x289f56(0x235)+_0x5c0fe4+_0x289f56(0x27e)+_0x165c08+'%\x27',_0x1ced96+=_0x289f56(0x338)+_0x319cb3;let _0x516ef5=dbFileIndexTable[_0x289f56(0x27a)](_0x24fff8[_0x289f56(0x31b)][_0x289f56(0x307)],_0x1ced96,_0x1c9b3a,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x52efc0=[];for(let _0x4990b8 in _0x516ef5){_0x52efc0[_0x289f56(0x21a)](_0x516ef5[_0x4990b8]['id']);}let _0x522fb6=dbMovieFavorite[_0x289f56(0x26b)](_0x24fff8['app'][_0x289f56(0x307)],_0x24fff8['currentUser']['id'],_0x52efc0);for(let _0x22cf49=0x0;_0x22cf49<_0x516ef5['length'];_0x22cf49++){_0x516ef5[_0x22cf49]['favorite']=0x0;for(let _0x1c244f in _0x522fb6){if(_0x522fb6[_0x1c244f]['movie_index_id']==_0x516ef5[_0x22cf49]['id']){_0x516ef5[_0x22cf49][_0x289f56(0x283)]=0x1;break;}}_0x516ef5[_0x22cf49]=addFolderCoverPath(_0x535407,_0x24fff8,_0x516ef5[_0x22cf49]);}_0x516ef5['length']>0x0&&_0x2556f6[_0x289f56(0x21a)]({'genresType':_0x5c0fe4,'genresValue':_0x165c08,'movieList':_0x516ef5,'indexCount':_0xa17e7d['index_count']});}_0x535407[_0x289f56(0x2f1)]({'code':0x0,'data':_0x2556f6,'movieShowMatchName':getShowMatchName(_0x24fff8[_0x289f56(0x31b)][_0x289f56(0x2f7)])});}}),router[_0x36e771(0x2ba)](_0x36e771(0x240),(_0x2e7583,_0x144b75,_0x30e1d9)=>{const _0x76299f=_0x36e771;if(dbUserTable['doUserCanGet'](_0x2e7583,_0x144b75,_0x76299f(0x1ec),_0x76299f(0x2a3))==!![]){let _0x560b15=getMoviesByParams(_0x144b75,_0x2e7583,0x1,'create_time',0xf,0x0,_0x76299f(0x32d));_0x2e7583[_0x76299f(0x230)][_0x76299f(0x1f9)]=!![],_0x2e7583[_0x76299f(0x230)][_0x76299f(0x24d)]=!![],_0x2e7583[_0x76299f(0x230)]['useTvSeriesInfo']=0x1;let _0x4bdee5=getMoviesByParams(_0x144b75,_0x2e7583,0x2,_0x76299f(0x2ae),0x32,0x0,'desc');_0x2e7583[_0x76299f(0x230)][_0x76299f(0x1f9)]=![],_0x2e7583['body'][_0x76299f(0x24d)]=![],_0x2e7583[_0x76299f(0x230)][_0x76299f(0x22e)]=0x0;let _0x1b7caf=dbConfigTable[_0x76299f(0x302)](_0x2e7583[_0x76299f(0x31b)][_0x76299f(0x2f7)],_0x76299f(0x243));_0x1b7caf=!_0x1b7caf||_0x1b7caf&&_0x1b7caf[_0x76299f(0x1fc)]==0x1;let _0x3aa812=dbConfigTable['findByTitle'](_0x2e7583['app'][_0x76299f(0x2f7)],_0x76299f(0x2ed));_0x3aa812=!_0x3aa812||_0x3aa812&&_0x3aa812[_0x76299f(0x1fc)]==0x1;let _0x15d6d3=dbConfigTable['findByTitle'](_0x2e7583['app']['dbOther'],'movieHomeShowHistory');_0x15d6d3=!_0x15d6d3||_0x15d6d3&&_0x15d6d3[_0x76299f(0x1fc)]==0x1;let _0x21e601=[];if(_0x15d6d3){let _0x2a7ff=_0x76299f(0x250),_0x5a47a4=_0x76299f(0x25d)+_0x2a7ff+_0x76299f(0x2a5)+_0x2e7583[_0x76299f(0x27c)]['id']+_0x76299f(0x294);_0x21e601=_0x2e7583[_0x76299f(0x31b)][_0x76299f(0x307)][_0x76299f(0x2ce)](_0x5a47a4)[_0x76299f(0x32a)]();let _0x4d707c=[];for(let _0x36b76a in _0x21e601){_0x4d707c[_0x76299f(0x21a)](_0x21e601[_0x36b76a]['id']);}let _0x1b6450=dbMovieFavorite['getFavoriteList'](_0x2e7583[_0x76299f(0x31b)][_0x76299f(0x307)],_0x2e7583[_0x76299f(0x27c)]['id'],_0x4d707c);for(let _0x43cb02=0x0;_0x43cb02<_0x21e601[_0x76299f(0x28d)];_0x43cb02++){_0x21e601[_0x43cb02]['favorite']=0x0;for(let _0x5ebb8d in _0x1b6450){if(_0x1b6450[_0x5ebb8d][_0x76299f(0x223)]==_0x21e601[_0x43cb02]['id']){_0x21e601[_0x43cb02]['favorite']=0x1;break;}}}}let _0xd44aef=[];_0x3aa812&&(_0xd44aef=getMovieLibrary(_0x2e7583,_0x144b75,0x6));let _0x490c0a={'code':0x0,'movies':_0x560b15,'tv':_0x4bdee5,'history':_0x21e601,'libraryList':_0xd44aef,'sourceList':[]};_0x490c0a[_0x76299f(0x24e)]=getShowMatchName(_0x2e7583[_0x76299f(0x31b)][_0x76299f(0x2f7)]);if(_0x1b7caf){let _0xc019b7=_0x2e7583[_0x76299f(0x31b)]['dbOther'][_0x76299f(0x2ce)](_0x76299f(0x24b))[_0x76299f(0x32a)](_0x76299f(0x1ec));for(let _0x317d42 of _0xc019b7){let _0x3cf812=getMoviesByParams(_0x144b75,_0x2e7583,null,_0x76299f(0x2bb),0x4,0x0,_0x76299f(0x32d),null,null,JSON[_0x76299f(0x32e)]([path[_0x76299f(0x299)](_0x317d42[_0x76299f(0x2e8)])]));if(_0x3cf812[_0x76299f(0x28d)]<0x1)continue;_0x490c0a['sourceList'][_0x76299f(0x21a)]({'mediaType':_0x317d42[_0x76299f(0x28a)],'path':_0x317d42['path'],'name':path['basename'](_0x317d42[_0x76299f(0x2e8)]),'sourceMovies':_0x3cf812});}}return _0x144b75[_0x76299f(0x2f1)](_0x490c0a);}}),router[_0x36e771(0x2ba)]('/getTvHomeData',(_0x1f4440,_0x5a4393,_0x27adce)=>{const _0x4c5288=_0x36e771;if(dbUserTable['doUserCanGet'](_0x1f4440,_0x5a4393,'movie',_0x4c5288(0x2a3))==!![]){let _0x2b1dda=getMoviesByParams(_0x5a4393,_0x1f4440,0x1,_0x4c5288(0x2bb),0xa,0x0,_0x4c5288(0x32d)),_0x393418=getMoviesByParams(_0x5a4393,_0x1f4440,0x2,_0x4c5288(0x2bb),0xa,0x0,_0x4c5288(0x32d)),_0x5c30bd=_0x4c5288(0x320),_0x3144b4=_0x4c5288(0x25d)+_0x5c30bd+_0x4c5288(0x2a5)+_0x1f4440['currentUser']['id']+_0x4c5288(0x294),_0x21e0f1=_0x1f4440['app'][_0x4c5288(0x307)][_0x4c5288(0x2ce)](_0x3144b4)[_0x4c5288(0x32a)](),_0x243b0b=getCollectionList(_0x1f4440,_0x5a4393,_0x4c5288(0x1e9)),_0xc2296c=getCollectionList(_0x1f4440,_0x5a4393,_0x4c5288(0x2e7)),_0x44ba75=getMoviesByParams(_0x5a4393,_0x1f4440,null,_0x4c5288(0x2bb),0xa,0x0,_0x4c5288(0x32d),null,null,null,null,null,null,null,_0x4c5288(0x249)),_0x5a98e1=getMovieLibrary(_0x1f4440,_0x5a4393),_0x1f095f={'code':0x0,'movies':_0x2b1dda,'tv':_0x393418,'history':_0x21e0f1,'favorites':_0x44ba75,'collectionList':_0x243b0b,'aiCollectionList':_0xc2296c,'libraryList':_0x5a98e1};return _0x5a4393[_0x4c5288(0x2f1)](_0x1f095f);}}),router['post']('/getTvHomeData2',(_0x5b04a4,_0x470c85,_0x1f45cb)=>{const _0x5c3262=_0x36e771;if(dbUserTable[_0x5c3262(0x32c)](_0x5b04a4,_0x470c85,'movie',_0x5c3262(0x2a3))==!![]){let _0x24c8b5=getMoviesByParams(_0x470c85,_0x5b04a4,0x1,_0x5c3262(0x2bb),0x1,0x0,_0x5c3262(0x32d)),_0x44ebee=getMoviesByParams(_0x470c85,_0x5b04a4,0x2,_0x5c3262(0x2bb),0x1,0x0,'desc'),_0x5395af=_0x5c3262(0x320),_0x2e8617=_0x5c3262(0x25d)+_0x5395af+_0x5c3262(0x2a5)+_0x5b04a4[_0x5c3262(0x27c)]['id']+_0x5c3262(0x24c),_0x1f5e0e=_0x5b04a4['app'][_0x5c3262(0x307)]['prepare'](_0x2e8617)['all'](),_0x49e929=getMoviesByParams(_0x470c85,_0x5b04a4,null,'check_time',0x1,0x0,_0x5c3262(0x32d),null,null,null,null,null,null,null,'FAVORITE'),_0x43e5ee=dbFileIndexTable[_0x5c3262(0x323)](_0x5b04a4['app'][_0x5c3262(0x307)],_0x5c3262(0x2ff),dbFileIndexTable[_0x5c3262(0x30c)]),_0x27db0e=dbFileIndexTable[_0x5c3262(0x323)](_0x5b04a4['app']['dbFileIndex'],_0x5c3262(0x29a),dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);_0x5b04a4[_0x5c3262(0x230)][_0x5c3262(0x2ab)]=0x5af3107a3fff,_0x5b04a4[_0x5c3262(0x230)][_0x5c3262(0x211)]=0x1,_0x5b04a4[_0x5c3262(0x230)][_0x5c3262(0x2fe)]=_0x5c3262(0x2bb),_0x5b04a4[_0x5c3262(0x230)][_0x5c3262(0x275)]=_0x5c3262(0x32d),_0x5b04a4[_0x5c3262(0x230)][_0x5c3262(0x2fb)]=0x0,_0x5b04a4['body'][_0x5c3262(0x2be)]=0x1;let _0x3ee408=photoApiUtils['getPhotoByParams'](_0x5b04a4,_0x470c85),_0x30beaa=getMovieLibrary(_0x5b04a4,_0x470c85),_0x573e0a={'movieCount':_0x43e5ee[_0x5c3262(0x2be)],'tvCount':_0x27db0e[_0x5c3262(0x2be)],'code':0x0,'movies':_0x24c8b5,'tv':_0x44ebee,'history':_0x1f5e0e,'favorites':_0x49e929,'photos':_0x3ee408,'libraryList':_0x30beaa};return _0x470c85[_0x5c3262(0x2f1)](_0x573e0a);}});let subtitleExtList=[_0x36e771(0x309),_0x36e771(0x2cd),'.vtt'];router[_0x36e771(0x2ba)](_0x36e771(0x20c),(_0x5d54fc,_0x22fdea,_0x4d3fce)=>{const _0x2f9570=_0x36e771;let _0x5f09fc=[],_0x2e5092=null;if(_0x5d54fc[_0x2f9570(0x230)]['videoPath'])_0x2e5092=_0x5d54fc[_0x2f9570(0x230)]['videoPath'],_0x2e5092=fileUtil[_0x2f9570(0x305)](_0x2e5092);else{if(_0x5d54fc['body']['id']){let _0x299661=_0x5d54fc[_0x2f9570(0x230)]['id'],_0x48245c=dbFileIndexTable[_0x2f9570(0x31f)](_0x5d54fc[_0x2f9570(0x31b)][_0x2f9570(0x307)],_0x299661,dbFileIndexTable[_0x2f9570(0x30c)]);_0x48245c&&(_0x2e5092=path['join'](_0x48245c['path'],_0x48245c[_0x2f9570(0x266)]),_0x5d54fc[_0x2f9570(0x31b)][_0x2f9570(0x307)][_0x2f9570(0x2ce)](_0x2f9570(0x2cf))['run'](Date[_0x2f9570(0x316)](),_0x48245c['id']));}}function _0x1b8520(){const _0x215a75=_0x2f9570;let _0x457273=dbConfigTable['findByTitle'](_0x5d54fc['app'][_0x215a75(0x2f7)],_0x215a75(0x2f9)),_0x19bf25=dbConfigTable[_0x215a75(0x302)](_0x5d54fc[_0x215a75(0x31b)][_0x215a75(0x2f7)],_0x215a75(0x2c6));return _0x22fdea['json']({'code':0x0,'data':_0x5f09fc,'defaultTranscodeResolution':_0x19bf25?_0x19bf25['value']:_0x215a75(0x2c0),'userFontSize':_0x457273?_0x457273[_0x215a75(0x1fc)]:1.5});}_0x2e5092?fs[_0x2f9570(0x245)](_0x2e5092,(_0xdf9cb2,_0x4040e2)=>{const _0x411e9d=_0x2f9570;if(_0xdf9cb2)return _0x1b8520();let _0x53256a=path[_0x411e9d(0x33a)](_0x2e5092);fs[_0x411e9d(0x23b)](_0x53256a,(_0x506268,_0x3fead2)=>{const _0x4165e3=_0x411e9d;if(_0x506268)return _0x1b8520();let _0x2a2363=path[_0x4165e3(0x204)](_0x2e5092)['replace'](path['extname'](_0x2e5092),''),_0x15fc74=_0x2a2363[_0x4165e3(0x315)]('\x20','_');for(let _0x4a351e in _0x3fead2){let _0x3e80ee=_0x3fead2[_0x4a351e],_0x3d6d76=path[_0x4165e3(0x2bc)](_0x3e80ee);(_0x3e80ee['startsWith'](_0x2a2363)||_0x3e80ee['startsWith'](_0x15fc74))&&subtitleExtList[_0x4165e3(0x2d9)](_0x3d6d76)&&_0x5f09fc[_0x4165e3(0x21a)]({'fileName':path[_0x4165e3(0x204)](_0x3e80ee),'filePath':path[_0x4165e3(0x299)](_0x53256a,_0x3e80ee)});}return _0x1b8520();});}):_0x1b8520();}),router[_0x36e771(0x2ba)](_0x36e771(0x2b8),(_0x57ee8a,_0x28af50,_0xc4f3c2)=>{const _0x39f855=_0x36e771;let _0x4f50c5=_0x57ee8a[_0x39f855(0x31b)][_0x39f855(0x307)]['prepare'](_0x39f855(0x2a1))[_0x39f855(0x32a)](),_0x295eb8=_0x57ee8a[_0x39f855(0x31b)][_0x39f855(0x307)][_0x39f855(0x2ce)](_0x39f855(0x2d0))[_0x39f855(0x32a)](),_0x5218da=_0x57ee8a[_0x39f855(0x31b)][_0x39f855(0x307)][_0x39f855(0x2ce)](_0x39f855(0x265))[_0x39f855(0x32a)]();_0x28af50['json']({'code':0x0,'data':_0x4f50c5[_0x39f855(0x290)](_0x295eb8,_0x5218da)});}),router['post'](_0x36e771(0x27f),(_0x5b2853,_0x6ceed6,_0x5cc927)=>{const _0x1d3ad7=_0x36e771;let _0x5923bd=_0x5b2853[_0x1d3ad7(0x230)][_0x1d3ad7(0x23c)],_0x50aaba=dbFileIndexTable[_0x1d3ad7(0x31f)](_0x5b2853[_0x1d3ad7(0x31b)][_0x1d3ad7(0x307)],_0x5923bd,dbFileIndexTable[_0x1d3ad7(0x30c)]);if(!_0x50aaba)return _0x6ceed6[_0x1d3ad7(0x2f1)]({'code':0x0});if(dbUserTable[_0x1d3ad7(0x32c)](_0x5b2853,_0x6ceed6,_0x1d3ad7(0x1ec),'power_delete',_0x50aaba[_0x1d3ad7(0x2e8)])==!![])return dbFileIndexTable['delete'](_0x5b2853[_0x1d3ad7(0x31b)][_0x1d3ad7(0x307)],_0x5923bd,dbFileIndexTable[_0x1d3ad7(0x30c)]),_0x6ceed6[_0x1d3ad7(0x2f1)]({'code':0x0});}),router[_0x36e771(0x2ba)](_0x36e771(0x333),(_0x5b981a,_0x9b153a,_0x429fce)=>{const _0x5a1011=_0x36e771;let _0x79bf8c=_0x5b981a['currentUser']['id'],_0x350048=parseInt(_0x5b981a[_0x5a1011(0x230)][_0x5a1011(0x2ea)]),_0x405be0=dbMovieFavorite[_0x5a1011(0x29c)](_0x5b981a['app'][_0x5a1011(0x307)],_0x79bf8c,_0x350048),_0x157574=0x0;if(_0x405be0)dbMovieFavorite[_0x5a1011(0x200)](_0x5b981a[_0x5a1011(0x31b)][_0x5a1011(0x307)],_0x79bf8c,_0x350048);else{_0x157574=0x1;let _0x4ce426=new Date()['getTime']();_0x5b981a[_0x5a1011(0x31b)]['dbFileIndex']['prepare'](_0x5a1011(0x2cf))[_0x5a1011(0x2d2)](_0x4ce426,_0x350048),dbMovieFavorite['addFavorite'](_0x5b981a[_0x5a1011(0x31b)][_0x5a1011(0x307)],_0x79bf8c,_0x350048);}return _0x9b153a[_0x5a1011(0x2f1)]({'code':0x0,'favorite':_0x157574});}),router[_0x36e771(0x2ba)]('/setTitleAndEnding',(_0xdf96a3,_0x5ddb94,_0x4c12d2)=>{const _0x1cb6f7=_0x36e771;try{let _0x56bd68=parseInt(_0xdf96a3[_0x1cb6f7(0x230)]['indexId']),_0x552721=dbFileIndexTable['getById'](_0xdf96a3[_0x1cb6f7(0x31b)][_0x1cb6f7(0x307)],_0x56bd68,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x552721)return _0x5ddb94[_0x1cb6f7(0x2f1)]({'code':0x0});let _0x391bc7=parseInt(_0xdf96a3[_0x1cb6f7(0x230)][_0x1cb6f7(0x277)]),_0x44fbd4=parseInt(_0xdf96a3[_0x1cb6f7(0x230)]['endDuration']);!_0x44fbd4&&(_0x44fbd4=0x0);!_0x391bc7&&(_0x391bc7=0x0);let _0x52f14d=parseInt(_0xdf96a3[_0x1cb6f7(0x230)][_0x1cb6f7(0x221)]);if(_0x391bc7<0x0||_0x44fbd4<0x0||_0x391bc7>_0x552721[_0x1cb6f7(0x284)]||_0x44fbd4>_0x552721['duration']||_0x52f14d!=0x0&&_0x52f14d!=0x1)return _0xdf96a3[_0x1cb6f7(0x31b)][_0x1cb6f7(0x212)](_0x5ddb94,_0x1cb6f7(0x310));let _0x16eb8c=[_0x552721];_0x552721['is_tvplay']==0x1&&(_0x16eb8c=_0xdf96a3[_0x1cb6f7(0x31b)][_0x1cb6f7(0x307)][_0x1cb6f7(0x2ce)](_0x1cb6f7(0x2df)+dbFileIndexTable[_0x1cb6f7(0x30c)]+_0x1cb6f7(0x242))[_0x1cb6f7(0x32a)](_0x552721['path']));let _0x5229ce='(';for(let _0x3e5d49 in _0x16eb8c){_0x5229ce+=_0x16eb8c[_0x3e5d49]['id'],_0x3e5d49!=_0x16eb8c[_0x1cb6f7(0x28d)]-0x1&&(_0x5229ce+=',');}return _0x5229ce+=')',_0xdf96a3['app'][_0x1cb6f7(0x307)][_0x1cb6f7(0x2ce)](_0x1cb6f7(0x216)+_0x5229ce)[_0x1cb6f7(0x2d2)](_0x391bc7,_0x44fbd4,_0x52f14d),_0x5ddb94['json']({'code':0x0});}catch(_0x2cf070){return console[_0x1cb6f7(0x24a)](_0x2cf070),_0xdf96a3['app'][_0x1cb6f7(0x212)](_0x5ddb94,_0x5ddb94['__'](_0x1cb6f7(0x2f6)));}});function getMovieLibrary(_0x184da3,_0x45337f,_0x335ec6){const _0x15f40d=_0x36e771;let _0x512ee0=_0x184da3[_0x15f40d(0x230)][_0x15f40d(0x276)]||0x0,_0x54ba2f=_0x335ec6||_0x184da3['body'][_0x15f40d(0x2be)]||0x32,_0x363418=_0x184da3[_0x15f40d(0x230)][_0x15f40d(0x22f)]||'',_0xace2ec=_0x184da3[_0x15f40d(0x230)]['orderField']||_0x15f40d(0x2ae),_0x4be424=_0x184da3[_0x15f40d(0x230)]['orderType']||_0x15f40d(0x32d);if(![_0x15f40d(0x2ae),_0x15f40d(0x269)]['includes'](_0xace2ec))return console[_0x15f40d(0x24a)](_0x15f40d(0x336),_0xace2ec),[];let _0x204c3f=[],_0x468b91=[],_0x47d039=_0x15f40d(0x2af);_0x184da3[_0x15f40d(0x27c)]['is_admin']==0x1?_0x363418&&(_0x47d039+=_0x15f40d(0x334),_0x468b91[_0x15f40d(0x21a)]('%'+_0x363418+'%')):(_0x47d039=_0x15f40d(0x22d),_0x363418&&(_0x47d039+=_0x15f40d(0x2c3),_0x468b91['push']('%'+_0x363418+'%')));_0x47d039+=_0x15f40d(0x25b)+_0xace2ec+'\x20'+_0x4be424+'\x20LIMIT\x20?\x20OFFSET\x20?',_0x468b91['push'](_0x54ba2f),_0x468b91[_0x15f40d(0x21a)](_0x512ee0),_0x204c3f=_0x184da3[_0x15f40d(0x31b)][_0x15f40d(0x307)][_0x15f40d(0x2ce)](_0x47d039)[_0x15f40d(0x32a)](_0x468b91);if(_0x204c3f[_0x15f40d(0x28d)]<0x1)return[];for(let _0x8a381d in _0x204c3f){let _0x2d045d=_0x204c3f[_0x8a381d];try{let _0x512291=JSON[_0x15f40d(0x2f8)](_0x2d045d[_0x15f40d(0x1fe)]),_0x118bfe=[];for(let _0x1c2967 of _0x512291){let _0x46474f=dbUserTable[_0x15f40d(0x337)](_0x184da3[_0x15f40d(0x31b)][_0x15f40d(0x2f7)],_0x1c2967,_0x15f40d(0x2d4));_0x118bfe['push'](_0x46474f);}_0x204c3f[_0x8a381d]['user_list']=_0x118bfe;}catch(_0x1475de){console[_0x15f40d(0x24a)](_0x1475de);}let _0x2d97f5=getMoviesByParams(_0x45337f,_0x184da3,null,_0x15f40d(0x2bb),0x4,0x0,_0x15f40d(0x32d),null,null,null,null,null,null,null,null,null,_0x204c3f[_0x8a381d]['id']);_0x204c3f[_0x8a381d][_0x15f40d(0x1ff)]=_0x2d97f5;}return _0x204c3f;}router['post'](_0x36e771(0x27b),(_0x27701a,_0x4eee41,_0x6a293f)=>{const _0x1a9f00=_0x36e771;let _0x3daba0=_0x27701a[_0x1a9f00(0x230)][_0x1a9f00(0x269)],_0xf52dc7=_0x27701a[_0x1a9f00(0x230)][_0x1a9f00(0x2d8)],_0x2df279=_0x27701a[_0x1a9f00(0x230)][_0x1a9f00(0x314)],_0x57c20a=_0x27701a[_0x1a9f00(0x230)][_0x1a9f00(0x246)],_0x4ba468=_0x27701a[_0x1a9f00(0x230)][_0x1a9f00(0x1f0)],_0x51f1c9=_0x27701a[_0x1a9f00(0x230)]['operation'];if(_0x51f1c9==_0x1a9f00(0x1e4)){let _0x38d2a4=getMovieLibrary(_0x27701a,_0x4eee41);return _0x4eee41[_0x1a9f00(0x2f1)]({'code':0x0,'data':_0x38d2a4});}else{if(_0x27701a['currentUser'][_0x1a9f00(0x26d)]!=0x1)return _0x27701a['app'][_0x1a9f00(0x212)](_0x4eee41,_0x4eee41['__'](_0x1a9f00(0x2b5)));if(_0x51f1c9==_0x1a9f00(0x22a)||_0x51f1c9==_0x1a9f00(0x2cb)){if(!_0x2df279||!_0x2df279 instanceof Array||_0x2df279[_0x1a9f00(0x28d)]<0x1)return _0x27701a[_0x1a9f00(0x31b)]['returnErrMsg'](_0x4eee41,_0x4eee41['__']('operationFail'));if(_0x4ba468){if(_0x57c20a!=null&&!_0x57c20a instanceof Array)return _0x27701a[_0x1a9f00(0x31b)][_0x1a9f00(0x212)](_0x4eee41,_0x4eee41['__']('operationFail'));}if(sqliteUtil['checkSqlInjection'](JSON[_0x1a9f00(0x32e)](_0x2df279))==!![])return _0x27701a[_0x1a9f00(0x31b)][_0x1a9f00(0x212)](_0x4eee41,_0x1a9f00(0x2c2));}if(_0x51f1c9==_0x1a9f00(0x2cb)&&_0xf52dc7)_0x27701a['app'][_0x1a9f00(0x307)]['prepare'](_0x1a9f00(0x208))['run'](_0x3daba0,JSON['stringify'](_0x2df279),_0x4ba468,JSON[_0x1a9f00(0x32e)](_0x57c20a),_0xf52dc7);else{if(_0x51f1c9=='DELETE'&&_0xf52dc7)_0x27701a[_0x1a9f00(0x31b)][_0x1a9f00(0x307)][_0x1a9f00(0x2ce)](_0x1a9f00(0x244))[_0x1a9f00(0x2d2)](_0xf52dc7);else{if(_0x51f1c9==_0x1a9f00(0x22a))_0x27701a[_0x1a9f00(0x31b)][_0x1a9f00(0x307)][_0x1a9f00(0x2ce)]('REPLACE\x20INTO\x20movie_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)')[_0x1a9f00(0x2d2)](_0x3daba0,JSON[_0x1a9f00(0x32e)](_0x2df279),_0x4ba468,JSON['stringify'](_0x57c20a),_0x27701a[_0x1a9f00(0x27c)]['id']);else return _0x27701a['app']['returnErrMsg'](_0x4eee41,_0x4eee41['__'](_0x1a9f00(0x2b5)));}}return _0x4eee41[_0x1a9f00(0x2f1)]({'code':0x0});}}),module[_0x36e771(0x281)]=router;