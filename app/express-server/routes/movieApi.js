const _0x15d84d=_0x15c8;(function(_0x119199,_0xe3bab1){const _0x2e4ac0=_0x15c8,_0xf725e3=_0x119199();while(!![]){try{const _0x59111c=parseInt(_0x2e4ac0(0x175))/0x1+parseInt(_0x2e4ac0(0x1a3))/0x2+parseInt(_0x2e4ac0(0x11f))/0x3*(parseInt(_0x2e4ac0(0x1a0))/0x4)+-parseInt(_0x2e4ac0(0x115))/0x5+parseInt(_0x2e4ac0(0x13f))/0x6*(-parseInt(_0x2e4ac0(0x18f))/0x7)+-parseInt(_0x2e4ac0(0x178))/0x8*(parseInt(_0x2e4ac0(0x1d1))/0x9)+parseInt(_0x2e4ac0(0xbd))/0xa;if(_0x59111c===_0xe3bab1)break;else _0xf725e3['push'](_0xf725e3['shift']());}catch(_0x26688d){_0xf725e3['push'](_0xf725e3['shift']());}}}(_0x1953,0x3346d));var express=require(_0x15d84d(0x1bb)),router=express[_0x15d84d(0xe6)]();let path=require(_0x15d84d(0x17d));const dbFileIndexTable=require(_0x15d84d(0x1c5)),dbUserTable=require(_0x15d84d(0xd0));var fs=require('fs');let config=require(_0x15d84d(0x1c4)),axios=require(_0x15d84d(0xdb)),sha256=require('sha256'),nasAccountUtil=require(_0x15d84d(0x1ca));const dbConfigTable=require(_0x15d84d(0x19b)),videoStreamUtil=require(_0x15d84d(0x12f)),dbSourceFolderTable=require('../../db/dbSourceFolderTable'),nfoUtil=require(_0x15d84d(0x1fc)),dbMovieFavorite=require(_0x15d84d(0x1b9)),movieUtil=require(_0x15d84d(0x16c));let fileUtil=require('../utils/fileUtils');const sqliteUtil=require(_0x15d84d(0x150)),photoApiUtils=require(_0x15d84d(0x11e));let movieSeasonUtil=require(_0x15d84d(0x171)),movieInfoUtil=require('../../utils/movieInfoUtil');const dbScanTaskTable=require(_0x15d84d(0x1c0));let movieFieldStr=_0x15d84d(0xff);function getTvSeriesPoster(_0x506168){const _0x5e360a=_0x15d84d;let _0x4b19d8='',_0x4a8f99=path[_0x5e360a(0x166)](path[_0x5e360a(0xc5)](_0x506168[_0x5e360a(0x17d)]),_0x5e360a(0x124));return fs[_0x5e360a(0x156)](_0x4a8f99)&&(_0x4b19d8=_0x4a8f99),!_0x4b19d8&&(_0x4a8f99=path['join'](path[_0x5e360a(0xc5)](_0x506168[_0x5e360a(0x17d)]),_0x5e360a(0x1c6)),fs['existsSync'](_0x4a8f99)&&(_0x4b19d8=_0x4a8f99)),!_0x4b19d8&&(_0x4a8f99=path[_0x5e360a(0x166)](path[_0x5e360a(0xc5)](_0x506168[_0x5e360a(0x17d)]),_0x5e360a(0x20c)),fs['existsSync'](_0x4a8f99)&&(_0x4b19d8=_0x4a8f99)),!_0x4b19d8&&(_0x4a8f99=path[_0x5e360a(0x166)](path[_0x5e360a(0xc5)](_0x506168[_0x5e360a(0x17d)]),_0x5e360a(0xdf)),fs['existsSync'](_0x4a8f99)&&(_0x4b19d8=_0x4a8f99)),_0x4b19d8;}function _0x1953(){const _0x4095af=['is_file','movieHomeShowHistory','favorite','seasonCount','prepare','6gSFgOK','getTvCount','extname','movie','shareUidList','\x20ORDER\x20BY\x20','sourceList','dbOther','\x20order\x20by\x20m.create_time\x20desc\x20limit\x201','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2050','\x20AND\x20(filename_fl=?\x20AND\x20show_name_fl=?\x20AND\x20movie_info_name_fl=?)','-fanart.%','logo_path','indexId','getTime','/getMovieKeys','smart','../utils/sqliteUtil','search','noPermission','stat','dataValue','coverMovie','existsSync','count','(filename\x20like\x20?)','stringify','duration','push','indexIdList','SELECT\x20count(*)\x20as\x20count\x20FROM\x20','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_genres\x27\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','\x20\x20WHERE\x20','/getTvList','length','searchValue','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20id=?','select\x20id\x20from\x20file_index_movie\x20where\x20(\x20path\x20like\x20?\x20OR\x20path=?)\x20and\x20is_file=1\x20and\x20type=2','folder_cover_path','join','\x20as\x20f\x20WHERE\x20path\x20like\x20?\x20and\x20is_tvplay=1\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20limit\x20200','INDEX_TABLE_NAME_MOVIE','sourceFolderId','movieShowMatchName','未找到NFO信息','../utils/movieUtil','SELECT\x20*\x20from\x20','checkPath','check_time','dealFirstLetterSingle','../../utils/movieSeasonUtil','SELECT\x20path,filename\x20from\x20','\x20and\x20show_in_list=1','\x20AND\x20(','135052WqGPNX','getById','DELETE\x20FROM\x20movie_library\x20\x20WHERE\x20id=?','120QxtvNn','.clearlogo.%','delete','SELECT\x20*\x20FROM\x20movie_library\x20WHERE\x20share_for_subuser=1','REPLACE\x20INTO\x20movie_library(title,path_list,share_for_subuser,share_uid,user_id)\x20VALUES(\x20?,?,?,?,?)','path','isTvPlay','ignore_match_info','\x20LIKE\x20\x27%','ignoreTvList','power_change','\x20order\x20by\x20check_time\x20desc\x20limit\x2010\x20','\x20and\x20(filename\x20like\x20?\x20or\x20movie_info_name\x20like\x20?)\x20','collectionPwd','getFavoriteList','-seriesPoster','\x20AND\x20is_tvplay==0','REPLACE\x20INTO\x20movie_collection(title,enable_pwd,pwd,user_id,type,data,collection_cover_path,data_value,share_for_subuser)\x20VALUES(\x20?,?,?,?,?,?,?,?,?)','tvCount','sortType','searchStr','ALL','show_name','1879941GsnWXf','doUserCanGet','ignoreSeasonList','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1','SELECT\x20count(*)\x20as\x20count\x20FROM\x20file_index_movie\x20WHERE\x20path\x20like\x20?\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1','SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20or\x20filename\x20like\x20?)','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20where\x20collection_id=?','all','\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20','heic','seasonList','../../db/dbConfigTable','/getTvSeriesDetail','json','\x20like\x20?\x20','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=\x27','73592biiIbY','power_get','movieLanguage','623378ZaYRzt','UPDATE\x20file_index_movie\x20SET\x20collection_id=0\x20WHERE\x20id\x20in\x20','EDIT','value','SELECT\x20id\x20FROM\x20','\x20LIMIT\x20?\x20OFFSET\x20?','/getMovies','is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay!=1','coverPath','ignoreMatchInfo','UPDATE\x20file_index_movie\x20SET\x20collection_id=?\x20WHERE\x20id\x20in\x20','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=3\x20WHERE\x20path\x20like\x20?\x20OR\x20path=?','movieGenres','basename','movieIndexId','replace','needLogoPathAndFanart','orderField','orderType','DELETE\x20FROM\x20movie_collection\x20WHERE\x20id=?','\x20and\x20filename_number\x20>=\x20?\x20','run','../../db/dbMovieFavorite','seasonNumber','express','trim','movieCollectionNotExist','pwd','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_language\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','../../db/dbScanTaskTable','/movieFavorite','\x20id,title,data,enable_pwd,collection_cover_path,data_value,create_time,share_for_subuser\x20','SELECT\x20*\x20FROM\x20source_folder\x20WHERE\x20type=?\x20LIMIT\x2010','../../myConfig/config','../../db/dbFileIndexTable','poster.jpeg','type','returnErrMsg','\x27\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27','../utils/nasAccountUtils','ordinary','updateByWhere','get','\x20\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20filename\x20like\x20?','sourceType','146169uLznaK','status','data','DELETE\x20FROM\x20movie_history\x20where\x20user_id=','UPDATE\x20movie_collection\x20SET\x20title=?,data=?,enable_pwd=?,pwd=?,collection_cover_path=?,data_value=?,share_for_subuser=?\x20WHERE\x20id=?','catch','getFilenameNumber','m.time,\x20f.id,f.is_tvplay,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','key_value','SELECT\x20id,filename\x20FROM\x20','%fanart%','listType','is_tvplay','\x20SET\x20show_in_list=1\x20WHERE\x20id=?','movieTvCache','saveMovieInfoToDb','/deleteCollection','-coverCache-','\x20SET\x20show_in_list\x20=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=\x27','\x20type=2','tvFolderName','includes','dataPreview','pathList','filepath','/switchMatchInfo','sourceFolderList','movie_index_id','getExcludePathWhereStr','offset','\x20WHERE\x20title\x20like\x20?','send','fileFullPath','page','collection_id','firstLetter','login.pwdErr','.vtt','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id','set','%season','movie_language','\x20OFFSET\x20','../../utils/nfoUtil','operationFail','share_uid','app','videoPath','/getCollection','\x20type=2\x20and\x20is_file=1','getPathWhere','index.videoInfoReadFail','/addIndexToCollection','desc','/getTvHomeData','UPDATE\x20file_index_movie\x20SET\x20movie_info_state=0\x20WHERE\x20(path\x20like\x20?\x20OR\x20path=?)','clearlogo.%','/getTvHomeData2','/getIndexDetail','folder.jpg','\x20id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list','\x20AND\x20(path\x20like\x20?\x20OR\x20filename\x20like\x20?\x20OR\x20movie_info_name\x20like\x20?\x20)','(filename\x20like\x20?\x20or\x20filename\x20like\x20?\x20\x20or\x20filename\x20like\x20?)','substr','movieActors','SELECT\x20*\x20FROM\x20movie_keys\x20where\x20key_type=\x27movie_regions\x27\x20and\x20\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20100','\x20order\x20by\x20create_time\x20desc','\x20SET\x20show_in_list\x20=0,is_tvplay=1\x20WHERE\x20path=?','user_list','\x20WHERE\x20is_file=0\x20and\x20(path=?\x20or\x20path\x20like\x20?)\x20','SELECT\x20*\x20FROM\x20movie_keys\x20WHERE\x20key_type=?\x20and\x20index_count>0\x20ORDER\x20BY\x20index_count\x20DESC\x20LIMIT\x20200','/deleteIndex','media_type','openDuration','findByTitle','startScanPath','\x20or\x20','isAdmin','\x20SET\x20show_in_list=1,is_tvplay=0,show_name\x20=\x27\x27,show_name_fl=null\x20WHERE\x20path=?\x20or\x20path\x20like\x20?','findWithField','getFavorite','getUserPathWhere','currentUser','\x27\x20or\x20filename\x20like\x20\x27','4117710kebfrx','%poster%','/addCollection','now','getPhotoByParams','checkSqlInjection','.jpg','1080p\x203mbps','dirname','addScanTask','-clearlogo.%','body','tvFolderPath','SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?','timeType','tvplay','.srt','REPLACE\x20INTO\x20movie_history(index_id,user_id,time,create_time)\x20VALUES(\x20?,?,?,?)','\x20order\x20by\x20m.create_time\x20desc\x20limit\x2010','../../db/dbUserTable','/operationLibrary','\x20AND\x20','movieDirectors','UPDATE\x20file_index_movie\x20set\x20check_time=?\x20WHERE\x20id=?','deleteFavorite','\x20AND\x20id\x20NOT\x20IN\x20(','GET','post','m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name','ADD','axios','endsWith','time','useTvSeriesInfo','thumb.jpg','exports','Value\x20out\x20of\x20limit','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20?\x20or\x20filename\x20like\x20?)\x20and\x20filename\x20not\x20like\x20?','movie_genres','excludePathMovie','movie_regions','Router','getAllFavoriteByWhere','\x20FROM\x20\x20movie_collection\x20WHERE\x20type=?','\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id=','needTvCount','\x20WHERE\x20path=?\x20and\x20is_file=1\x20and\x20type=2\x20order\x20by\x20filename','startsWith','pageSize','getCountByWhere','then','FAVORITE','/removeIndexFromCollection','log','filename','/getMovieHomeData','decodePath','UPDATE\x20movie_library\x20SET\x20title=?,path_list=?,share_for_subuser=?,share_uid=?\x20WHERE\x20id=?','dbFileIndex','\x20order\x20by\x20filename_number,filename','UPDATE\x20file_index_movie\x20set\x20open_duration=?,end_duration=?,skip_open_end=?\x20WHERE\x20id\x20in\x20','fanart.%','pwdCanNotBeNull','SELECT\x20','\x20and\x20filename\x20>=\x20?\x20','-QHD','\x20id,collection_id,movie_douban_score,movie_info_name,movie_year,movie_info_state,path,is_tvplay,filename,ext,type,width,height,duration,size,movie_douban_id,movie_imdb_id,show_name,show_in_list','title','fileExist','history','error\x20data','getSeasonNumber','concat','create_time','\x20FROM\x20','has','addFavorite','\x20AND\x20is_tvplay==1','\x20and\x20title\x20like\x20?','fanart_path','/setTitleAndEnding','UPDATE\x20movie_history\x20SET\x20time=?,create_time=?\x20where\x20index_id=?\x20AND\x20user_id=?','movie_info_name','sep','movieHomeShowLibrary','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20(filename\x20like\x20\x27poster.%\x27\x20or\x20filename\x20like\x20\x27POSTER.%\x27\x20or\x20filename\x20like\x20\x27movie.%\x27\x20or\x20filename\x20like\x20\x27folder.%\x27\x20or\x20filename\x20like\x20\x27cover.%\x27\x20or\x20filename\x20like\x20\x27thumb.%\x27)','\x20LIMIT\x20','shareForSubUser','1601425xLDaUu','isTvSeries','\x20and\x20path=?\x20and\x20is_tvplay=1\x20','is_admin','dialog','pageCount','\x20AND\x20collection_id=0','\x27\x20and\x20type=1\x20and\x20is_file=1\x20limit\x2020','\x20AND\x20title\x20like\x20?\x20','./photoApiUtils','30ZsCJPI','UPDATE\x20','needSeasonCount','excludeIds','\x20order\x20by\x20','poster.jpg','path_list','/getHistory','\x20SELECT\x20','operation','/getMoviesByGenres','enable_pwd','sameFolderImgList','collectionId','SWITCH_MOVIE_INFO','/addHistory','../../utils/videoStreamUtil','-FHD','getAllByWhereAndField','\x20AND\x20share_for_subuser\x20=\x20?\x20','movie_director','sortField','parse','libraryId','\x20AND\x20collection_id\x20=\x20','SELECT\x20path,filename\x20FROM\x20file_index_movie\x20WHERE\x20path=?\x20and\x20type=1\x20and\x20is_file=1\x20and\x20','timestamp'];_0x1953=function(){return _0x4095af;};return _0x1953();}router[_0x15d84d(0xd8)](_0x15d84d(0x19c),(_0x147e8b,_0x490de6,_0x35b22b)=>{const _0xe831c3=_0x15d84d;let _0x3f7c91=_0x147e8b[_0xe831c3(0xc8)]['id'],_0x100e1b=dbFileIndexTable['getById'](_0x147e8b[_0xe831c3(0x1ff)][_0xe831c3(0xf7)],_0x3f7c91,dbFileIndexTable[_0xe831c3(0x168)]);if(!_0x100e1b)return _0x147e8b['app'][_0xe831c3(0x1c8)](_0x490de6,_0x490de6['__']('index.videoInfoReadFail'));if(dbUserTable[_0xe831c3(0x190)](_0x147e8b,_0x490de6,_0xe831c3(0x142),_0xe831c3(0x1a1),_0x100e1b[_0xe831c3(0x17d)])==!![]){let _0x4c336d=dbUserTable[_0xe831c3(0xba)](_0x147e8b,_0xe831c3(0x142),_0xe831c3(0x1a1),!![]),_0xdf1e69='\x20type=2\x20and\x20is_file=1\x20and\x20id!=?\x20and\x20collection_id=0\x20';_0xdf1e69+=_0x4c336d,_0xdf1e69+='\x20order\x20by\x20check_time\x20desc\x20limit\x2010\x20',nfoUtil['parseNfoTvSeries'](_0x100e1b)[_0xe831c3(0xef)](_0x4332ab=>{const _0xde029e=_0xe831c3;_0x100e1b=_0x4332ab,_0x147e8b['body']['needLogoPathAndFanart']=!![],_0x147e8b[_0xde029e(0xc8)][_0xde029e(0xde)]=0x1,_0x100e1b=addFolderCoverPath(_0x490de6,_0x147e8b,_0x100e1b),_0x5445fb();})['catch'](_0x338ffc=>{const _0x471d9a=_0xe831c3;console[_0x471d9a(0xf2)](_0x471d9a(0x16b),_0x338ffc),_0x100e1b=addFolderCoverPath(_0x490de6,_0x147e8b,_0x100e1b),_0x100e1b[_0x471d9a(0x10f)]=_0x100e1b[_0x471d9a(0x1e5)],_0x5445fb();});function _0x5445fb(){const _0x4720ec=_0xe831c3;addTvFolderPathAndName(_0x100e1b),setLogoAndFanart(_0x147e8b,_0x100e1b,_0x100e1b['tvFolderPath']);let _0x5268ab=dbMovieFavorite[_0x4720ec(0xb9)](_0x147e8b['app']['dbFileIndex'],_0x147e8b[_0x4720ec(0xbb)]['id'],_0x100e1b['id']);_0x5268ab?_0x100e1b['favorite']=0x1:_0x100e1b[_0x4720ec(0x13c)]=0x0;let _0x18044c={'code':0x0,'movieIndex':_0x100e1b};fs[_0x4720ec(0x153)](_0x100e1b[_0x4720ec(0xc9)],(_0x3f2448,_0x35a757)=>{const _0x1906ce=_0x4720ec;_0x18044c[_0x1906ce(0x101)]=_0x3f2448?0x0:0x1,_0x490de6[_0x1906ce(0x19d)](_0x18044c),_0x100e1b[_0x1906ce(0x1dd)]==0x1&&_0x100e1b[_0x1906ce(0xc9)]&&(dbScanTaskTable[_0x1906ce(0xc6)](_0x147e8b['app'][_0x1906ce(0x146)],'movie',_0x100e1b['tvFolderPath']),process[_0x1906ce(0x1f0)]({'type':_0x1906ce(0xb4),'source_type':_0x1906ce(0x142),'restartWatcher':![]}));});}}}),router[_0x15d84d(0xd8)]('/getMovieDetail',(_0x3796db,_0x1e2609,_0x34dfdb)=>{const _0x46bbd3=_0x15d84d;let _0xd0a168=_0x3796db[_0x46bbd3(0xc8)]['id'],_0x359c63=dbFileIndexTable[_0x46bbd3(0x176)](_0x3796db[_0x46bbd3(0x1ff)][_0x46bbd3(0xf7)],_0xd0a168,dbFileIndexTable[_0x46bbd3(0x168)]);if(!_0x359c63)return _0x3796db[_0x46bbd3(0x1ff)][_0x46bbd3(0x1c8)](_0x1e2609,_0x1e2609['__'](_0x46bbd3(0x204)));if(dbUserTable['doUserCanGet'](_0x3796db,_0x1e2609,_0x46bbd3(0x142),'power_get',_0x359c63['path'])==!![]){let _0x5b1185=dbUserTable['getUserPathWhere'](_0x3796db,'movie','power_get',!![]),_0x44a69a='\x20type=2\x20and\x20is_file=1\x20and\x20id!=?\x20and\x20collection_id=0\x20';_0x44a69a+=_0x5b1185,_0x44a69a+=_0x46bbd3(0x183),nfoUtil['parseNfo'](_0x359c63,!![],![])[_0x46bbd3(0xef)](_0x160c90=>{const _0xa95a63=_0x46bbd3;_0x359c63=_0x160c90,_0x3796db['body'][_0xa95a63(0x1b3)]=!![],_0x359c63=addFolderCoverPath(_0x1e2609,_0x3796db,_0x359c63),movieInfoUtil[_0xa95a63(0x1e0)](_0x3796db[_0xa95a63(0x1ff)][_0xa95a63(0xf7)],_0x359c63['id'],_0x160c90),_0x2e6029();})['catch'](()=>{_0x359c63=addFolderCoverPath(_0x1e2609,_0x3796db,_0x359c63),_0x2e6029();});function _0x2e6029(){const _0x2961ab=_0x46bbd3;let _0x169f44=dbMovieFavorite[_0x2961ab(0xb9)](_0x3796db['app'][_0x2961ab(0xf7)],_0x3796db[_0x2961ab(0xbb)]['id'],_0x359c63['id']);_0x169f44?_0x359c63['favorite']=0x1:_0x359c63[_0x2961ab(0x13c)]=0x0;let _0x3c64a9=null;if(_0x359c63[_0x2961ab(0x1dd)]==0x1){let _0x31e98f=_0x3796db[_0x2961ab(0x1ff)][_0x2961ab(0xf7)][_0x2961ab(0x13e)](_0x2961ab(0x1a7)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x2961ab(0x198))[_0x2961ab(0x197)](_0x359c63['path']),_0x5e05b0='(';for(let _0x1ec86d in _0x31e98f){_0x5e05b0+=_0x31e98f[_0x1ec86d]['id'],_0x1ec86d!=_0x31e98f['length']-0x1&&(_0x5e05b0+=',');}_0x5e05b0+=')';let _0x5581c0=_0x3796db[_0x2961ab(0x1ff)][_0x2961ab(0xf7)][_0x2961ab(0x13e)]('SELECT\x20index_id\x20FROM\x20movie_history\x20where\x20index_id\x20in\x20'+_0x5e05b0+_0x2961ab(0x213))[_0x2961ab(0x1cd)]();_0x5581c0&&(_0x3c64a9=dbFileIndexTable[_0x2961ab(0x176)](_0x3796db[_0x2961ab(0x1ff)][_0x2961ab(0xf7)],_0x5581c0['index_id'],dbFileIndexTable[_0x2961ab(0x168)]));}let _0x559dbd={'code':0x0,'movieIndex':_0x359c63,'lastTvEpisodeIndex':_0x3c64a9},_0x5464c3=[];try{let _0x54509c=_0x3796db[_0x2961ab(0x1ff)][_0x2961ab(0xf7)][_0x2961ab(0x13e)](_0x2961ab(0x19f)+_0x359c63['path']+_0x2961ab(0x11c))[_0x2961ab(0x197)]();for(let _0x22672a in _0x54509c){let _0x2271e7=path[_0x2961ab(0x166)](_0x54509c[_0x22672a][_0x2961ab(0x17d)],_0x54509c[_0x22672a][_0x2961ab(0xf3)]);(_0x3796db[_0x2961ab(0xbb)]['is_admin']==0x1||dbUserTable[_0x2961ab(0x190)](_0x3796db,_0x1e2609,'folder',_0x2961ab(0x1a1),_0x2271e7,!![])==!![])&&_0x5464c3[_0x2961ab(0x15b)](_0x2271e7);}_0x559dbd[_0x2961ab(0x12b)]=_0x5464c3;}catch(_0x50bc5d){}let _0x4650fe=path['join'](_0x359c63[_0x2961ab(0x17d)],_0x359c63['filename']);fs[_0x2961ab(0x153)](_0x4650fe,(_0xc39dbd,_0x3c88f7)=>{const _0x3f92b0=_0x2961ab;_0x559dbd[_0x3f92b0(0x101)]=_0xc39dbd?0x0:0x1,_0x559dbd[_0x3f92b0(0x1f1)]=_0x4650fe,_0x1e2609[_0x3f92b0(0x19d)](_0x559dbd),_0x359c63[_0x3f92b0(0x1dd)]==0x1&&_0x359c63[_0x3f92b0(0xc9)]&&_0x359c63[_0x3f92b0(0x116)]!=0x1&&(dbScanTaskTable[_0x3f92b0(0xc6)](_0x3796db['app'][_0x3f92b0(0x146)],'movie',_0x359c63['tvFolderPath']),process[_0x3f92b0(0x1f0)]({'type':_0x3f92b0(0xb4),'source_type':_0x3f92b0(0x142),'restartWatcher':![]}));});}}}),router[_0x15d84d(0xd8)](_0x15d84d(0x160),(_0x29f104,_0x3c20fa,_0x3e1cb3)=>{const _0x44e5d6=_0x15d84d;let _0x496b7d=_0x29f104['body']['id'],_0x4620e9=_0x29f104['body'][_0x44e5d6(0x1f2)]||0x0,_0x2b25c9=_0x29f104[_0x44e5d6(0xc8)][_0x44e5d6(0xed)]||0xa,_0x2027d8=_0x29f104['body'][_0x44e5d6(0x18c)],_0x355981=_0x29f104[_0x44e5d6(0xc8)]['fromName'],_0x3617b0=_0x29f104[_0x44e5d6(0xc8)][_0x44e5d6(0x181)],_0x34792c=_0x29f104[_0x44e5d6(0xc8)][_0x44e5d6(0x191)],_0xd75f2d=dbFileIndexTable[_0x44e5d6(0x176)](_0x29f104[_0x44e5d6(0x1ff)][_0x44e5d6(0xf7)],_0x496b7d,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0xd75f2d)return _0x29f104[_0x44e5d6(0x1ff)]['returnErrMsg'](_0x3c20fa,_0x3c20fa['__'](_0x44e5d6(0x204)));let _0xff4f13=movieFieldStr,_0x24b8ca=[],_0x15d893=0x0;if(dbUserTable[_0x44e5d6(0x190)](_0x29f104,_0x3c20fa,_0x44e5d6(0x142),_0x44e5d6(0x1a1),_0xd75f2d[_0x44e5d6(0x17d)])==!![]){if(_0x3617b0==0x1)return _0x54b5f2();let _0xa2d643=_0x29f104[_0x44e5d6(0x1ff)]['dbFileIndex'][_0x44e5d6(0x13e)](_0x44e5d6(0x1da)+dbFileIndexTable[_0x44e5d6(0x168)]+'\x20\x20WHERE\x20\x20type=2\x20and\x20is_file=1\x20and\x20path=?\x20and\x20is_tvplay=1\x20and\x20filename_number\x20is\x20null')[_0x44e5d6(0x197)](_0xd75f2d['path']);for(let _0x128fe2 in _0xa2d643){let _0xd071a4=_0xa2d643[_0x128fe2];if(_0xd071a4[_0x44e5d6(0xf3)]){let _0x55d9aa=movieUtil[_0x44e5d6(0x1d7)](_0xd071a4[_0x44e5d6(0xf3)]);_0x29f104[_0x44e5d6(0x1ff)]['dbFileIndex']['prepare'](_0x44e5d6(0x120)+dbFileIndexTable[_0x44e5d6(0x168)]+'\x20SET\x20filename_number=?\x20\x20WHERE\x20\x20id=?')['run'](_0x55d9aa,_0xd071a4['id']);}}let _0x1d320a=dbUserTable[_0x44e5d6(0xba)](_0x29f104,_0x44e5d6(0x142),'power_get',!![]),_0x2ee58a=_0x44e5d6(0x202);_0x2ee58a+=_0x1d320a,_0x2ee58a+=_0x44e5d6(0x117);_0x2027d8&&(_0x2ee58a+=_0x44e5d6(0x184));if(_0x355981){let _0x3c95c5=movieUtil[_0x44e5d6(0x1d7)](_0x355981);_0x3c95c5?_0x2ee58a+=_0x44e5d6(0x1b7):_0x2ee58a+=_0x44e5d6(0xfd);}let _0xb8728=_0x2ee58a;_0x2ee58a+=_0x44e5d6(0xf8);let _0x36a272=_0x44e5d6(0xfc)+_0xff4f13+_0x44e5d6(0x107)+dbFileIndexTable[_0x44e5d6(0x168)]+'\x20as\x20f\x20WHERE\x20'+_0x2ee58a+_0x44e5d6(0x113)+_0x2b25c9+_0x44e5d6(0x1fb)+_0x4620e9*_0x2b25c9;_0x24b8ca=_0x29f104[_0x44e5d6(0x1ff)][_0x44e5d6(0xf7)][_0x44e5d6(0x13e)](_0x36a272);if(_0x2027d8&&_0x355981)_0x24b8ca=_0x24b8ca[_0x44e5d6(0x197)](_0xd75f2d[_0x44e5d6(0x17d)],'%'+_0x2027d8+'%','%'+_0x2027d8+'%');else{if(_0x2027d8)_0x24b8ca=_0x24b8ca['all'](_0xd75f2d[_0x44e5d6(0x17d)],'%'+_0x2027d8+'%','%'+_0x2027d8+'%');else{if(_0x355981){let _0xdc8431=movieUtil[_0x44e5d6(0x1d7)](_0x355981);_0x24b8ca=_0x24b8ca[_0x44e5d6(0x197)](_0xd75f2d[_0x44e5d6(0x17d)],_0xdc8431?_0xdc8431:_0x355981);}else _0x24b8ca=_0x24b8ca[_0x44e5d6(0x197)](_0xd75f2d[_0x44e5d6(0x17d)]);}}let _0x527b3a=_0x44e5d6(0x15d)+dbFileIndexTable[_0x44e5d6(0x168)]+_0x44e5d6(0x15f)+_0xb8728+'\x20',_0xd570f3=_0x29f104['app'][_0x44e5d6(0xf7)]['prepare'](_0x527b3a);if(_0x2027d8&&_0x355981)_0xd570f3=_0xd570f3[_0x44e5d6(0x1cd)](_0xd75f2d[_0x44e5d6(0x17d)],'%'+_0x2027d8+'%','%'+_0x2027d8+'%');else{if(_0x2027d8)_0xd570f3=_0xd570f3[_0x44e5d6(0x1cd)](_0xd75f2d[_0x44e5d6(0x17d)],'%'+_0x2027d8+'%','%'+_0x2027d8+'%');else _0x355981?_0xd570f3=_0xd570f3[_0x44e5d6(0x1cd)](_0xd75f2d['path'],_0x355981):_0xd570f3=_0xd570f3[_0x44e5d6(0x1cd)](_0xd75f2d['path']);}_0x15d893=_0xd570f3[_0x44e5d6(0x157)];if(_0x24b8ca[_0x44e5d6(0x161)]>0x0){let _0x122a75=0x0;for(let _0x29e86d in _0x24b8ca){let _0x33cc0b=_0x24b8ca[_0x29e86d];nfoUtil['parseNfo'](_0x33cc0b,!![],!![])[_0x44e5d6(0xef)](_0x4538c8=>{const _0x4c7ae7=_0x44e5d6;_0x122a75+=0x1,_0x24b8ca[_0x29e86d]=_0x4538c8,_0x24b8ca[_0x29e86d]=addFolderCoverPath(_0x3c20fa,_0x29f104,_0x24b8ca[_0x29e86d],!![]),_0x122a75>=_0x24b8ca[_0x4c7ae7(0x161)]&&_0x54b5f2();})[_0x44e5d6(0x1d6)](()=>{const _0x1a8660=_0x44e5d6;_0x122a75+=0x1,_0x24b8ca[_0x29e86d]=addFolderCoverPath(_0x3c20fa,_0x29f104,_0x24b8ca[_0x29e86d],!![]),_0x122a75>=_0x24b8ca[_0x1a8660(0x161)]&&_0x54b5f2();});}}else _0x54b5f2();function _0x54b5f2(){const _0x4d5daa=_0x44e5d6;let _0x3a04eb={'code':0x0,'tvplayList':_0x24b8ca,'count':_0x15d893,'pageSize':_0x2b25c9};if(!_0x34792c){let _0x3691a0=path[_0x4d5daa(0x1b0)](_0xd75f2d[_0x4d5daa(0x17d)]),_0x568941=movieSeasonUtil['getSeasonNumber'](_0x3691a0);if(_0x568941>-0x1){let _0x1d7d52=_0x4d5daa(0xfc)+_0xff4f13+'\x20FROM\x20'+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0x4d5daa(0x167),_0x4bd073=_0x29f104[_0x4d5daa(0x1ff)][_0x4d5daa(0xf7)][_0x4d5daa(0x13e)](_0x1d7d52)[_0x4d5daa(0x197)](path['dirname'](_0xd75f2d[_0x4d5daa(0x17d)])+path[_0x4d5daa(0x110)]+'%'),_0x459d75=[];for(let _0x3ef22e of _0x4bd073){let _0x384a3a=path[_0x4d5daa(0x1b0)](_0x3ef22e[_0x4d5daa(0x17d)]),_0x25b216=movieSeasonUtil[_0x4d5daa(0x104)](_0x384a3a);_0x25b216>-0x1&&(_0x3ef22e['seasonNumber']=_0x25b216,_0x459d75[_0x4d5daa(0x15b)](_0x3ef22e));}for(let _0x3108c5 of _0x459d75){_0x3108c5=addFolderCoverPath(_0x3c20fa,_0x29f104,_0x3108c5);let _0x42aede=dbFileIndexTable[_0x4d5daa(0x140)](_0x29f104[_0x4d5daa(0x1ff)][_0x4d5daa(0xf7)],_0x3108c5);_0x3108c5[_0x4d5daa(0x18a)]=_0x42aede[_0x4d5daa(0x157)];}_0x459d75[_0x4d5daa(0x161)]>0x0&&(_0x459d75['sort'](function(_0x176bc0,_0x3c4ba7){const _0x575cd8=_0x4d5daa;return _0x176bc0[_0x575cd8(0x1ba)]-_0x3c4ba7[_0x575cd8(0x1ba)];}),_0x3a04eb[_0x4d5daa(0x19a)]=_0x459d75);}}return _0x3c20fa[_0x4d5daa(0x19d)](_0x3a04eb);}}}),router['post'](_0x15d84d(0xf1),(_0x314a44,_0x4b3fc0,_0x41548c)=>{const _0x4cb1d6=_0x15d84d;let _0x261cc7=_0x314a44['body'][_0x4cb1d6(0x15c)],_0x3690e8=[];for(let _0x1d1d71 of _0x261cc7){let _0x56223d=dbFileIndexTable[_0x4cb1d6(0x176)](_0x314a44['app'][_0x4cb1d6(0xf7)],_0x1d1d71,dbFileIndexTable[_0x4cb1d6(0x168)]);if(!_0x56223d)continue;if(dbUserTable[_0x4cb1d6(0x190)](_0x314a44,_0x4b3fc0,'',_0x4cb1d6(0x182),_0x56223d[_0x4cb1d6(0x17d)])!==!![])continue;let _0xd0e216=path[_0x4cb1d6(0x1b0)](_0x56223d['path']),_0x1b89b1=movieSeasonUtil[_0x4cb1d6(0x104)](_0xd0e216);if(_0x1b89b1>-0x1){let _0xca0751=path['join'](path[_0x4cb1d6(0xc5)](_0x56223d[_0x4cb1d6(0x17d)])),_0x967df2=_0x314a44[_0x4cb1d6(0x1ff)][_0x4cb1d6(0xf7)][_0x4cb1d6(0x13e)](_0x4cb1d6(0x164))[_0x4cb1d6(0x197)](_0xca0751+path['sep']+'%',_0xca0751);for(let _0x364796 of _0x967df2){_0x3690e8[_0x4cb1d6(0x15b)](_0x364796['id']);}}}_0x3690e8[_0x4cb1d6(0x161)]>0x0&&(_0x261cc7=[..._0x261cc7,..._0x3690e8]);if(_0x261cc7[_0x4cb1d6(0x161)]<0x1)return _0x4b3fc0[_0x4cb1d6(0x19d)]({'code':0x0});let _0x657211='(';for(let _0x174af4 in _0x261cc7){_0x657211+=_0x261cc7[_0x174af4],_0x174af4!=_0x261cc7[_0x4cb1d6(0x161)]-0x1&&(_0x657211+=',');}return _0x657211+=')',_0x314a44['app']['dbFileIndex']['prepare'](_0x4cb1d6(0x1a4)+_0x657211)[_0x4cb1d6(0x1b8)](),_0x4b3fc0[_0x4cb1d6(0x19d)]({'code':0x0});}),router[_0x15d84d(0xd8)](_0x15d84d(0x205),(_0x1c822c,_0xc74fe5,_0x3bd906)=>{const _0x2a0dc9=_0x15d84d;let _0x544563=_0x1c822c[_0x2a0dc9(0xc8)][_0x2a0dc9(0x12c)],_0x4c8174=_0x1c822c[_0x2a0dc9(0xc8)]['indexId'],_0x4cd759=_0x1c822c[_0x2a0dc9(0xc8)][_0x2a0dc9(0x1e9)];function _0x235aec(_0x19e782){const _0x5e8e98=_0x2a0dc9;let _0x23988d=[];for(let _0x1d7849 in _0x19e782){_0x23988d[_0x5e8e98(0x15b)](_0x19e782[_0x1d7849]['id']);}inSql='(';for(let _0x1fc207 in _0x23988d){inSql+=_0x23988d[_0x1fc207],_0x1fc207!=_0x23988d['length']-0x1&&(inSql+=',');}return inSql+=')',inSql;}if(_0x544563&&_0x4c8174){let _0x4f586c=dbFileIndexTable[_0x2a0dc9(0x176)](_0x1c822c['app'][_0x2a0dc9(0xf7)],_0x4c8174,dbFileIndexTable[_0x2a0dc9(0x168)]),_0x480511='('+_0x4c8174+')';if(!_0x4f586c)return _0x1c822c['app'][_0x2a0dc9(0x1c8)](_0xc74fe5,_0xc74fe5['__'](_0x2a0dc9(0x1fd)),'dialog');if(dbUserTable[_0x2a0dc9(0x190)](_0x1c822c,_0xc74fe5,'','power_change',_0x4f586c['path'])!==!![])return;let _0x2c331b=path[_0x2a0dc9(0x1b0)](_0x4f586c[_0x2a0dc9(0x17d)]),_0x560eaa=movieSeasonUtil[_0x2a0dc9(0x104)](_0x2c331b);_0x560eaa>-0x1&&(_0x4f586c['is_file']=0x0,_0x4f586c[_0x2a0dc9(0x17d)]=path[_0x2a0dc9(0xc5)](_0x4f586c[_0x2a0dc9(0x17d)]),_0x4f586c['filename']='');if(_0x4f586c[_0x2a0dc9(0x13a)]!=0x1){let _0x15e9fc=path['join'](_0x4f586c[_0x2a0dc9(0x17d)],_0x4f586c[_0x2a0dc9(0xf3)]);console[_0x2a0dc9(0xf2)](_0x2a0dc9(0x16e),_0x15e9fc);let _0x443787=_0x1c822c['app'][_0x2a0dc9(0xf7)][_0x2a0dc9(0x13e)](_0x2a0dc9(0x164))[_0x2a0dc9(0x197)](_0x15e9fc+path[_0x2a0dc9(0x110)]+'%',_0x15e9fc);if(_0x443787[_0x2a0dc9(0x161)]<0x1)return _0xc74fe5[_0x2a0dc9(0x19d)]({'code':0x0});_0x480511=_0x235aec(_0x443787);}return _0x1c822c['app'][_0x2a0dc9(0xf7)][_0x2a0dc9(0x13e)](_0x2a0dc9(0x1ad)+_0x480511+'\x20and\x20show_in_list=1')['run'](_0x544563),_0xc74fe5['json']({'code':0x0});}else{if(_0x544563&&_0x4cd759){let _0x2a5564=_0x1c822c[_0x2a0dc9(0x1ff)][_0x2a0dc9(0xf7)][_0x2a0dc9(0x13e)](_0x2a0dc9(0x164))[_0x2a0dc9(0x197)](_0x4cd759+path['sep']+'%',_0x4cd759),_0x1d0a99=_0x235aec(_0x2a5564);return _0x1c822c[_0x2a0dc9(0x1ff)][_0x2a0dc9(0xf7)][_0x2a0dc9(0x13e)](_0x2a0dc9(0x1ad)+_0x1d0a99+_0x2a0dc9(0x173))['run'](_0x544563),_0xc74fe5[_0x2a0dc9(0x19d)]({'code':0x0});}else return _0x1c822c['app'][_0x2a0dc9(0x1c8)](_0xc74fe5,_0xc74fe5['__'](_0x2a0dc9(0x1fd)),'dialog');}});function _0x15c8(_0x73ebc4,_0x1b6c6c){const _0x195301=_0x1953();return _0x15c8=function(_0x15c820,_0xd4f4e){_0x15c820=_0x15c820-0xad;let _0x5f2ae9=_0x195301[_0x15c820];return _0x5f2ae9;},_0x15c8(_0x73ebc4,_0x1b6c6c);}function getCollectionList(_0x163707,_0x56e5af,_0x10f603){const _0xe562e=_0x15d84d;let _0x503218=[],_0x31ba7e=_0x163707[_0xe562e(0xc8)][_0xe562e(0x157)]||0x32,_0x5ac1cf=_0x163707[_0xe562e(0xc8)][_0xe562e(0x1ee)]||0x0,_0x3b6276=_0x163707[_0xe562e(0xc8)][_0xe562e(0x1b4)]||'id',_0x1c9854=_0x163707[_0xe562e(0xc8)][_0xe562e(0x1b5)]||_0xe562e(0x206),_0x27458a=_0x163707[_0xe562e(0xc8)][_0xe562e(0x151)],_0x51bc3a=_0xe562e(0x1c2),_0x1eb28f=_0xe562e(0x127)+_0x51bc3a+_0xe562e(0xe8),_0x309b49=[_0x10f603];_0x27458a&&(_0x1eb28f+=_0xe562e(0x11d),_0x309b49[_0xe562e(0x15b)]('%'+_0x27458a+'%'));_0x163707[_0xe562e(0xbb)][_0xe562e(0x118)]!=0x1&&(_0x1eb28f+=_0xe562e(0x132),_0x309b49[_0xe562e(0x15b)](0x1));_0x1eb28f+=_0xe562e(0x123)+_0x3b6276+'\x20'+_0x1c9854+_0xe562e(0x1a8),_0x309b49[_0xe562e(0x15b)](_0x31ba7e),_0x309b49[_0xe562e(0x15b)](_0x5ac1cf),_0x503218=_0x163707[_0xe562e(0x1ff)][_0xe562e(0xf7)][_0xe562e(0x13e)](_0x1eb28f)[_0xe562e(0x197)](_0x309b49);for(let _0x2911fe of _0x503218){if(_0x2911fe['enable_pwd']==0x1)continue;let _0x1ad8f1=getMoviesByParams(_0x56e5af,_0x163707,null,'id',0x1,0x0,'desc',null,null,null,null,null,null,_0x2911fe['id']);_0x1ad8f1[_0xe562e(0x161)]>0x0&&(_0x2911fe[_0xe562e(0x155)]=_0x1ad8f1[0x0]);}return _0x503218;}router['post'](_0x15d84d(0x201),(_0x360b09,_0x1d27eb,_0x5ccf1f)=>{const _0x2e7838=_0x15d84d;let _0x1375dc=_0x360b09[_0x2e7838(0xc8)]['type']||_0x2e7838(0x1cb),_0x2f51b3=getCollectionList(_0x360b09,_0x1d27eb,_0x1375dc);return _0x1d27eb[_0x2e7838(0x19d)]({'code':0x0,'data':_0x2f51b3});}),router[_0x15d84d(0xd8)]('/checkCollectionPwd',(_0x7fc750,_0x2e7844,_0x40196f)=>{const _0x25a1b2=_0x15d84d;let _0x9d5607=_0x7fc750['body'][_0x25a1b2(0x1be)],_0xb85228=_0x7fc750[_0x25a1b2(0xc8)][_0x25a1b2(0x12c)];if(!_0x9d5607)return _0x7fc750[_0x25a1b2(0x1ff)][_0x25a1b2(0x1c8)](_0x2e7844,_0x2e7844['__'](_0x25a1b2(0xfb)),'dialog');_0x9d5607=sha256(_0x9d5607);let _0x348ac5=_0x7fc750[_0x25a1b2(0x1ff)]['dbFileIndex']['prepare']('SELECT\x20id,title,enable_pwd,create_time\x20FROM\x20movie_collection\x20where\x20id=?\x20and\x20pwd=?')[_0x25a1b2(0x1cd)](_0xb85228,_0x9d5607);if(!_0x348ac5)return _0x7fc750['app'][_0x25a1b2(0x1c8)](_0x2e7844,_0x2e7844['__'](_0x25a1b2(0x1f5)),_0x25a1b2(0x119));return _0x2e7844[_0x25a1b2(0x19d)]({'code':0x0,'data':_0x348ac5});}),router['post'](_0x15d84d(0xbf),(_0xbbe1f7,_0x4e0c8c,_0x5b1ef0)=>{const _0x5e2c4c=_0x15d84d;let _0x58faee=_0xbbe1f7['body'][_0x5e2c4c(0x100)],_0x364bb0=_0xbbe1f7[_0x5e2c4c(0xc8)]['enablePwd'],_0x4f119e=_0xbbe1f7[_0x5e2c4c(0xc8)][_0x5e2c4c(0x1be)],_0x72506c=_0xbbe1f7['body'][_0x5e2c4c(0x12c)],_0x2af1f4=_0xbbe1f7[_0x5e2c4c(0xc8)]['type']?_0xbbe1f7[_0x5e2c4c(0xc8)]['type']:'ordinary',_0x4d757b=_0xbbe1f7['body']['data']?_0xbbe1f7[_0x5e2c4c(0xc8)]['data']:'',_0x566f44=_0xbbe1f7[_0x5e2c4c(0xc8)][_0x5e2c4c(0x1ab)]?_0xbbe1f7[_0x5e2c4c(0xc8)][_0x5e2c4c(0x1ab)]:'',_0x26ab8e=_0xbbe1f7[_0x5e2c4c(0xc8)][_0x5e2c4c(0x114)];_0x26ab8e==null&&(_0x26ab8e=0x1);if(_0x2af1f4==_0x5e2c4c(0x14f)){if(!_0x4d757b||!_0x4d757b['searchValue']||sqliteUtil['checkSqlInjection'](_0x4d757b[_0x5e2c4c(0x162)])==!![])return _0xbbe1f7[_0x5e2c4c(0x1ff)][_0x5e2c4c(0x1c8)](_0x4e0c8c,_0x5e2c4c(0x103));}let _0xb7c1ab=_0xbbe1f7[_0x5e2c4c(0xc8)][_0x5e2c4c(0x154)]?_0xbbe1f7[_0x5e2c4c(0xc8)][_0x5e2c4c(0x154)]:'';if(_0xbbe1f7[_0x5e2c4c(0xbb)][_0x5e2c4c(0x118)]!=0x1)return _0xbbe1f7[_0x5e2c4c(0x1ff)][_0x5e2c4c(0x1c8)](_0x4e0c8c,_0x4e0c8c['__'](_0x5e2c4c(0x152)));if(_0x364bb0=='1'){if(!_0x4f119e)return _0xbbe1f7[_0x5e2c4c(0x1ff)][_0x5e2c4c(0x1c8)](_0x4e0c8c,_0x4e0c8c['__']('pwdCanNotBeNull'),'dialog');_0x4f119e=sha256(_0x4f119e);}return _0x72506c?_0xbbe1f7[_0x5e2c4c(0x1ff)][_0x5e2c4c(0xf7)]['prepare'](_0x5e2c4c(0x1d5))['run'](_0x58faee,JSON[_0x5e2c4c(0x159)](_0x4d757b),_0x364bb0+'',_0x4f119e,_0x566f44,_0xb7c1ab,_0x26ab8e,_0x72506c):_0xbbe1f7[_0x5e2c4c(0x1ff)][_0x5e2c4c(0xf7)][_0x5e2c4c(0x13e)](_0x5e2c4c(0x189))[_0x5e2c4c(0x1b8)](_0x58faee,_0x364bb0+'',_0x4f119e,_0xbbe1f7['currentUser']['id']+'',_0x2af1f4,JSON[_0x5e2c4c(0x159)](_0x4d757b),_0x566f44,_0xb7c1ab,_0x26ab8e),_0x4e0c8c[_0x5e2c4c(0x19d)]({'code':0x0});}),router[_0x15d84d(0xd8)](_0x15d84d(0x1e1),(_0x6c0af8,_0x3b1223,_0x2f9f44)=>{const _0x914907=_0x15d84d;let _0x3e318d=_0x6c0af8[_0x914907(0xc8)][_0x914907(0x12c)];if(_0x6c0af8['currentUser']['is_admin']!=0x1)return _0x6c0af8[_0x914907(0x1ff)][_0x914907(0x1c8)](_0x3b1223,_0x3b1223['__']('noPermission'));return _0x6c0af8[_0x914907(0x1ff)][_0x914907(0xf7)][_0x914907(0x13e)](_0x914907(0x196))[_0x914907(0x1b8)](_0x3e318d),_0x6c0af8[_0x914907(0x1ff)][_0x914907(0xf7)][_0x914907(0x13e)](_0x914907(0x1b6))[_0x914907(0x1b8)](_0x3e318d),_0x3b1223[_0x914907(0x19d)]({'code':0x0});}),router['post']('/clearHistory',(_0x429a5a,_0x296e2b,_0x4a9df1)=>{const _0x12e85c=_0x15d84d;return _0x429a5a['app'][_0x12e85c(0xf7)][_0x12e85c(0x13e)](_0x12e85c(0x1d4)+_0x429a5a[_0x12e85c(0xbb)]['id'])['run'](),_0x296e2b[_0x12e85c(0x19d)]({'code':0x0});}),router[_0x15d84d(0xd8)](_0x15d84d(0x12e),(_0x432836,_0x15902b,_0x63ce76)=>{const _0x4a56e1=_0x15d84d;let _0x1abd92=_0x432836[_0x4a56e1(0xc8)][_0x4a56e1(0x14c)],_0x5a66ee=_0x432836[_0x4a56e1(0xc8)][_0x4a56e1(0xdd)],_0x2b1e2d=dbFileIndexTable[_0x4a56e1(0x176)](_0x432836['app'][_0x4a56e1(0xf7)],_0x1abd92,dbFileIndexTable[_0x4a56e1(0x168)]);if(!_0x2b1e2d)return _0x15902b[_0x4a56e1(0x19d)]({'code':0x0});if(_0x2b1e2d[_0x4a56e1(0x1f3)]){let _0x336145=_0x432836[_0x4a56e1(0x1ff)]['dbFileIndex'][_0x4a56e1(0x13e)](_0x4a56e1(0x194))[_0x4a56e1(0x1cd)](_0x2b1e2d[_0x4a56e1(0x1f3)]);if(_0x336145&&_0x336145[_0x4a56e1(0x12a)]==0x1)return _0x15902b[_0x4a56e1(0x19d)]({'code':0x0});}let _0x3ef82c=_0x432836[_0x4a56e1(0x1ff)]['dbFileIndex']['prepare']('SELECT\x20*\x20from\x20movie_history\x20WHERE\x20index_id=?\x20and\x20user_id=?')[_0x4a56e1(0x1cd)](_0x1abd92+'',_0x432836[_0x4a56e1(0xbb)]['id']+'');return _0x3ef82c?_0x432836[_0x4a56e1(0x1ff)][_0x4a56e1(0xf7)][_0x4a56e1(0x13e)](_0x4a56e1(0x10e))['run'](_0x5a66ee,new Date()[_0x4a56e1(0x14d)](),_0x1abd92+'',_0x432836[_0x4a56e1(0xbb)]['id']+''):_0x432836[_0x4a56e1(0x1ff)][_0x4a56e1(0xf7)][_0x4a56e1(0x13e)](_0x4a56e1(0xce))['run'](_0x1abd92+'',_0x432836[_0x4a56e1(0xbb)]['id']+'',_0x5a66ee,new Date()[_0x4a56e1(0x14d)]()),_0x15902b[_0x4a56e1(0x19d)]({'code':0x0});}),router[_0x15d84d(0xd8)](_0x15d84d(0x126),(_0x397f67,_0x550816,_0x1f369f)=>{const _0x27b75a=_0x15d84d;let _0x2ff5c2=_0x397f67[_0x27b75a(0xc8)][_0x27b75a(0x14c)],_0x54b9ac=_0x27b75a(0x1f7);if(_0x2ff5c2){let _0x10ac85=_0x397f67[_0x27b75a(0x1ff)][_0x27b75a(0xf7)][_0x27b75a(0x13e)](_0x27b75a(0xca))[_0x27b75a(0x1cd)](_0x397f67['currentUser']['id']+'',_0x2ff5c2+'');return _0x550816['json']({'code':0x0,'data':_0x10ac85});}else{let _0xe14b32=_0x27b75a(0xfc)+_0x54b9ac+_0x27b75a(0xe9)+_0x397f67[_0x27b75a(0xbb)]['id']+_0x27b75a(0x148),_0x48e7d0=_0x397f67[_0x27b75a(0x1ff)]['dbFileIndex'][_0x27b75a(0x13e)](_0xe14b32)['all']();return _0x550816[_0x27b75a(0x19d)]({'code':0x0,'data':_0x48e7d0});}}),router[_0x15d84d(0xd8)](_0x15d84d(0x20b),(_0xcef2a9,_0x287eb7,_0x986cdd)=>{const _0x4ac388=_0x15d84d;let _0x18fc1b=_0xcef2a9['body']['id'],_0x40df14=dbFileIndexTable['getById'](_0xcef2a9[_0x4ac388(0x1ff)][_0x4ac388(0xf7)],_0x18fc1b,dbFileIndexTable[_0x4ac388(0x168)]);if(dbUserTable[_0x4ac388(0x190)](_0xcef2a9,_0x287eb7,_0x4ac388(0x142),'power_get',_0x40df14[_0x4ac388(0x17d)])==!![]){let _0x2c5287={'code':0x0,'data':_0x40df14};return _0x287eb7[_0x4ac388(0x19d)](_0x2c5287);}}),router[_0x15d84d(0xd8)](_0x15d84d(0x1ea),(_0x296435,_0x10566f,_0xd0410f)=>{const _0x42bf61=_0x15d84d;let _0x3fe04e=_0x296435[_0x42bf61(0xc8)]['sourceFolderId'],_0x480aca=_0x296435[_0x42bf61(0xc8)][_0x42bf61(0x1ac)];if(dbUserTable[_0x42bf61(0xb6)](_0x296435,_0x10566f)===!![]){let _0x1a5e4c=dbSourceFolderTable[_0x42bf61(0x176)](_0x296435[_0x42bf61(0x1ff)][_0x42bf61(0x146)],_0x3fe04e);if(!_0x1a5e4c)return _0x10566f[_0x42bf61(0x1d2)](0x194)['end']();return _0x480aca==0x1?(_0x296435[_0x42bf61(0x1ff)][_0x42bf61(0xf7)][_0x42bf61(0x13e)](_0x42bf61(0x1ae))[_0x42bf61(0x1b8)](_0x1a5e4c[_0x42bf61(0x17d)]+path[_0x42bf61(0x110)]+'%',_0x1a5e4c[_0x42bf61(0x17d)]),dbSourceFolderTable['updateByWhere'](_0x296435[_0x42bf61(0x1ff)][_0x42bf61(0x146)],_0x42bf61(0x17f),_0x480aca,_0x3fe04e),process[_0x42bf61(0x1f0)]({'type':'SWITCH_MOVIE_INFO'}),_0x10566f[_0x42bf61(0x19d)]({'code':0x0})):(dbSourceFolderTable[_0x42bf61(0x1cc)](_0x296435['app'][_0x42bf61(0x146)],_0x42bf61(0x17f),_0x480aca,_0x3fe04e),_0x296435[_0x42bf61(0x1ff)][_0x42bf61(0xf7)][_0x42bf61(0x13e)](_0x42bf61(0x208))[_0x42bf61(0x1b8)](_0x1a5e4c['path']+path['sep']+'%',_0x1a5e4c[_0x42bf61(0x17d)]),process[_0x42bf61(0x1f0)]({'type':_0x42bf61(0x12d)}),_0x10566f[_0x42bf61(0x19d)]({'code':0x0}));}}),router[_0x15d84d(0xd8)]('/setTvplay',(_0x4eeeb5,_0x40bc38,_0x3b1213)=>{const _0x56eaca=_0x15d84d;let _0x14955a=_0x4eeeb5[_0x56eaca(0xc8)][_0x56eaca(0x17e)],_0x2fe51c=_0x4eeeb5[_0x56eaca(0xc8)][_0x56eaca(0x14c)],_0x2048c1=_0x4eeeb5['body'][_0x56eaca(0x169)];function _0x403088(_0x101f3a){const _0xd3c9e2=_0x56eaca;let _0x17b1e3=_0x4eeeb5[_0xd3c9e2(0x1ff)][_0xd3c9e2(0xf7)][_0xd3c9e2(0x13e)](_0xd3c9e2(0x16d)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0xd3c9e2(0xeb))[_0xd3c9e2(0x1cd)](_0x101f3a);if(!_0x17b1e3)return;_0x4eeeb5[_0xd3c9e2(0x1ff)]['dbFileIndex'][_0xd3c9e2(0x13e)](_0xd3c9e2(0x120)+dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']+_0xd3c9e2(0x214))[_0xd3c9e2(0x1b8)](_0x101f3a),_0x4eeeb5[_0xd3c9e2(0x1ff)]['dbFileIndex']['prepare']('UPDATE\x20'+dbFileIndexTable[_0xd3c9e2(0x168)]+_0xd3c9e2(0x1de))[_0xd3c9e2(0x1b8)](_0x17b1e3['id']),movieUtil[_0xd3c9e2(0x170)](_0x4eeeb5[_0xd3c9e2(0x1ff)]['dbFileIndex'],_0x17b1e3);}if(_0x2fe51c){let _0x1d9cb5=dbFileIndexTable[_0x56eaca(0x176)](_0x4eeeb5[_0x56eaca(0x1ff)]['dbFileIndex'],_0x2fe51c,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(dbUserTable[_0x56eaca(0x190)](_0x4eeeb5,_0x40bc38,_0x56eaca(0x142),_0x56eaca(0x182),_0x1d9cb5[_0x56eaca(0x17d)])==!![])return _0x14955a==0x1?_0x403088(_0x1d9cb5['path']):_0x4eeeb5[_0x56eaca(0x1ff)][_0x56eaca(0xf7)]['prepare'](_0x56eaca(0x120)+dbFileIndexTable[_0x56eaca(0x168)]+_0x56eaca(0x1e3)+_0x1d9cb5[_0x56eaca(0x17d)]+'\x27')[_0x56eaca(0x1b8)](),_0x40bc38[_0x56eaca(0x19d)]({'code':0x0});}else{if(_0x2048c1){let _0x473423=dbSourceFolderTable[_0x56eaca(0x176)](_0x4eeeb5[_0x56eaca(0x1ff)]['dbOther'],_0x2048c1);if(!_0x473423||_0x473423[_0x56eaca(0x1c7)]!='movie')return _0x4eeeb5[_0x56eaca(0x1ff)]['returnErrMsg'](_0x40bc38,_0x40bc38['__'](_0x56eaca(0x1fd)),_0x56eaca(0x119));if(_0x14955a==0x1){dbSourceFolderTable[_0x56eaca(0x1cc)](_0x4eeeb5['app'][_0x56eaca(0x146)],'media_type',_0x56eaca(0xcc),_0x2048c1),_0x403088(_0x473423[_0x56eaca(0x17d)]);let _0x422423=_0x4eeeb5[_0x56eaca(0x1ff)][_0x56eaca(0xf7)][_0x56eaca(0x13e)](_0x56eaca(0x172)+dbFileIndexTable[_0x56eaca(0x168)]+_0x56eaca(0xae))[_0x56eaca(0x197)](_0x473423[_0x56eaca(0x17d)],''+_0x473423[_0x56eaca(0x17d)]+path['sep']+'%');for(let _0x58999f in _0x422423){let _0x348bc8=path[_0x56eaca(0x166)](_0x422423[_0x58999f][_0x56eaca(0x17d)],_0x422423[_0x58999f][_0x56eaca(0xf3)]);_0x403088(_0x348bc8);}}else{dbSourceFolderTable[_0x56eaca(0x1cc)](_0x4eeeb5[_0x56eaca(0x1ff)]['dbOther'],_0x56eaca(0xb1),_0x56eaca(0x142),_0x2048c1);let _0x1cf8c0=_0x4eeeb5[_0x56eaca(0x1ff)][_0x56eaca(0xf7)][_0x56eaca(0x13e)](_0x56eaca(0x120)+dbFileIndexTable[_0x56eaca(0x168)]+_0x56eaca(0xb7))[_0x56eaca(0x1b8)](_0x473423[_0x56eaca(0x17d)],''+_0x473423[_0x56eaca(0x17d)]+path[_0x56eaca(0x110)]+'%');}return _0x40bc38['json']({'code':0x0});}else return _0x4eeeb5[_0x56eaca(0x1ff)]['returnErrMsg'](_0x40bc38,_0x40bc38['__'](_0x56eaca(0x1fd)),_0x56eaca(0x119));}});function setLogoAndFanart(_0x4ea28a,_0x454312,_0x2730bc,_0x573464){const _0x57951b=_0x15d84d;if(_0x4ea28a[_0x57951b(0xc8)][_0x57951b(0x1b3)]){let _0x5b7c19=_0x57951b(0x138),_0x22f471=[_0x2730bc];_0x573464?(_0x5b7c19+=_0x57951b(0x20f),_0x22f471[_0x57951b(0x15b)](_0x57951b(0x209)),_0x22f471[_0x57951b(0x15b)](_0x573464+_0x57951b(0xc7)),_0x22f471[_0x57951b(0x15b)](_0x573464+_0x57951b(0x179))):(_0x5b7c19+=_0x57951b(0x158),_0x22f471['push'](_0x57951b(0x209)));let _0x2ed7e1=_0x4ea28a['app'][_0x57951b(0xf7)][_0x57951b(0x13e)](_0x5b7c19)['get'](_0x22f471);if(_0x2ed7e1){let _0x308e01=path[_0x57951b(0x166)](_0x2ed7e1[_0x57951b(0x17d)],_0x2ed7e1['filename']);_0x454312[_0x57951b(0x14b)]=_0x308e01;}let _0x30fa51=_0x57951b(0x138),_0xad138d=[_0x2730bc];_0x573464?(_0x30fa51+=_0x57951b(0x195),_0xad138d[_0x57951b(0x15b)](_0x57951b(0xfa)),_0xad138d[_0x57951b(0x15b)](_0x573464+_0x57951b(0x14a)),_0xad138d[_0x57951b(0x15b)](_0x573464+'.fanart.%')):(_0x30fa51+=_0x57951b(0x158),_0xad138d['push']('fanart.%'));let _0x1a0c15=_0x4ea28a[_0x57951b(0x1ff)][_0x57951b(0xf7)][_0x57951b(0x13e)](_0x30fa51)[_0x57951b(0x1cd)](_0xad138d);if(_0x1a0c15){let _0x1e6afc=path[_0x57951b(0x166)](_0x1a0c15['path'],_0x1a0c15['filename']);_0x454312[_0x57951b(0x10c)]=_0x1e6afc;}}}function addTvFolderPathAndName(_0x4a5c47){const _0xc332a3=_0x15d84d;_0x4a5c47[_0xc332a3(0x1e5)]=path[_0xc332a3(0x1b0)](_0x4a5c47[_0xc332a3(0x17d)]),_0x4a5c47[_0xc332a3(0xc9)]=_0x4a5c47['path'];if(_0x4a5c47['is_tvplay']==0x1){let _0x47e159=path[_0xc332a3(0x1b0)](_0x4a5c47[_0xc332a3(0x17d)]),_0x4b99ce=path[_0xc332a3(0xc5)](_0x4a5c47[_0xc332a3(0x17d)]),_0x4747d5=movieSeasonUtil[_0xc332a3(0x104)](_0x47e159);_0x4747d5>-0x1&&(_0x4a5c47[_0xc332a3(0x1e5)]=path[_0xc332a3(0x1b0)](_0x4b99ce),_0x4a5c47['tvFolderPath']=_0x4b99ce);if(!_0x4a5c47[_0xc332a3(0x18e)])_0x4a5c47[_0xc332a3(0x18e)]=_0x4a5c47[_0xc332a3(0x1e5)];}}function addFolderCoverPath(_0x288261,_0x31a4ac,_0x452a25,_0x1e3ee8=![]){const _0x3d0f4a=_0x15d84d;let _0x48244b;addTvFolderPathAndName(_0x452a25);let _0x3b0d52=_0x452a25['id']+_0x3d0f4a(0x1e2)+_0x1e3ee8;!_0x31a4ac[_0x3d0f4a(0x1df)]&&(_0x31a4ac[_0x3d0f4a(0x1df)]=new Map());try{if(_0x452a25['is_tvplay']==0x1&&!_0x1e3ee8)try{let _0x3a2420=path['basename'](_0x452a25[_0x3d0f4a(0x17d)]),_0x402274=path[_0x3d0f4a(0xc5)](_0x452a25['path']),_0x181089=movieSeasonUtil[_0x3d0f4a(0x104)](_0x3a2420);if(_0x181089>-0x1){_0x452a25[_0x3d0f4a(0x116)]=0x1,_0x452a25[_0x3d0f4a(0x1ba)]=_0x181089;if(_0x31a4ac[_0x3d0f4a(0xc8)][_0x3d0f4a(0x121)]){let _0x3a072a=_0x402274+'-seasonCount-'+_0x1e3ee8;_0x31a4ac[_0x3d0f4a(0x1df)][_0x3d0f4a(0x108)](_0x3a072a)?_0x452a25[_0x3d0f4a(0x13d)]=_0x31a4ac['movieTvCache']['get'](_0x3a072a):(_0x452a25[_0x3d0f4a(0x13d)]=_0x31a4ac[_0x3d0f4a(0x1ff)][_0x3d0f4a(0xf7)][_0x3d0f4a(0x13e)](_0x3d0f4a(0x193))['get'](''+_0x402274+path['sep']+'%')[_0x3d0f4a(0x157)],_0x31a4ac[_0x3d0f4a(0x1df)][_0x3d0f4a(0x1f8)](_0x3a072a,_0x452a25['seasonCount']));}}setLogoAndFanart(_0x31a4ac,_0x452a25,_0x452a25[_0x3d0f4a(0xc9)]);if(_0x31a4ac['body'][_0x3d0f4a(0xde)]==0x1&&_0x181089>-0x1){let _0x28cf8b=_0x452a25[_0x3d0f4a(0xc9)]+_0x3d0f4a(0x187);if(_0x31a4ac[_0x3d0f4a(0x1df)][_0x3d0f4a(0x108)](_0x28cf8b))return _0x452a25[_0x3d0f4a(0x165)]=_0x31a4ac['movieTvCache'][_0x3d0f4a(0x1cd)](_0x28cf8b),_0x452a25;let _0x5bf25f=getTvSeriesPoster(_0x452a25);if(_0x5bf25f)return _0x31a4ac[_0x3d0f4a(0x1df)]['set'](_0x28cf8b,_0x5bf25f),_0x452a25[_0x3d0f4a(0x165)]=_0x5bf25f,_0x452a25;}if(!_0x48244b&&_0x31a4ac[_0x3d0f4a(0x1df)][_0x3d0f4a(0x108)](_0x3b0d52))return _0x452a25[_0x3d0f4a(0x165)]=_0x31a4ac[_0x3d0f4a(0x1df)]['get'](_0x3b0d52),_0x452a25;if(!_0x48244b&&_0x181089>-0x1){parseInt(_0x181089)<0xa&&(_0x181089='0'+_0x181089);let _0x52526c=_0x3d0f4a(0x1f9)+_0x181089+_0x3d0f4a(0xbe),_0x1a9c4e='%s'+_0x181089+_0x3d0f4a(0xbe),_0x47d418=_0x3d0f4a(0x19f)+_0x402274+_0x3d0f4a(0x1c9)+_0x52526c+_0x3d0f4a(0xbc)+_0x1a9c4e+'\x27)';_0x48244b=_0x31a4ac['app'][_0x3d0f4a(0xf7)][_0x3d0f4a(0x13e)](_0x47d418)[_0x3d0f4a(0x1cd)]();}!_0x48244b&&(_0x48244b=_0x31a4ac[_0x3d0f4a(0x1ff)]['dbFileIndex'][_0x3d0f4a(0x13e)](_0x3d0f4a(0x112))['get'](_0x452a25[_0x3d0f4a(0x17d)]));}catch(_0xad89c3){console[_0x3d0f4a(0xf2)](_0xad89c3);}else{if(_0x31a4ac[_0x3d0f4a(0x1df)][_0x3d0f4a(0x108)](_0x3b0d52))return _0x452a25[_0x3d0f4a(0x165)]=_0x31a4ac[_0x3d0f4a(0x1df)]['get'](_0x3b0d52),_0x452a25;let _0x5e3a49=path[_0x3d0f4a(0x135)](_0x452a25['filename']),_0x1ee508=_0x5e3a49['name'],_0x5acc03=path[_0x3d0f4a(0x166)](_0x452a25[_0x3d0f4a(0x17d)],_0x1ee508+_0x3d0f4a(0xc3));if(fs[_0x3d0f4a(0x156)](_0x5acc03))return _0x452a25[_0x3d0f4a(0x165)]=_0x5acc03,_0x452a25;!_0x48244b&&(_0x48244b=_0x31a4ac[_0x3d0f4a(0x1ff)]['dbFileIndex']['prepare'](_0x3d0f4a(0x1cf))[_0x3d0f4a(0x1cd)](_0x452a25['path'],'%'+_0x1ee508+_0x3d0f4a(0xbe)));if(!_0x48244b){let _0x46e461=_0x1ee508;(_0x1ee508['endsWith']('-HD')||_0x1ee508[_0x3d0f4a(0xdc)](_0x3d0f4a(0x130))||_0x1ee508[_0x3d0f4a(0xdc)](_0x3d0f4a(0xfe))||_0x1ee508[_0x3d0f4a(0xdc)]('-UHD'))&&(_0x1ee508[_0x3d0f4a(0xdc)]('-HD')?_0x46e461=_0x46e461[_0x3d0f4a(0x210)](0x0,_0x46e461[_0x3d0f4a(0x161)]-0x3):_0x46e461=_0x46e461['substr'](0x0,_0x46e461[_0x3d0f4a(0x161)]-0x4)),_0x48244b=_0x31a4ac[_0x3d0f4a(0x1ff)][_0x3d0f4a(0xf7)][_0x3d0f4a(0x13e)](_0x3d0f4a(0xe2))[_0x3d0f4a(0x1cd)](_0x452a25[_0x3d0f4a(0x17d)],_0x1ee508+'%',_0x46e461+'%',_0x3d0f4a(0x1db));}!_0x48244b&&(_0x48244b=_0x31a4ac[_0x3d0f4a(0x1ff)][_0x3d0f4a(0xf7)][_0x3d0f4a(0x13e)](_0x3d0f4a(0x112))['get'](_0x452a25[_0x3d0f4a(0x17d)]));let {name:_0x3e3ae8}=path['parse'](_0x452a25[_0x3d0f4a(0xf3)]);setLogoAndFanart(_0x31a4ac,_0x452a25,_0x452a25[_0x3d0f4a(0x17d)],_0x3e3ae8);}if(_0x48244b){let _0x2cdab1=path[_0x3d0f4a(0x166)](_0x48244b['path'],_0x48244b[_0x3d0f4a(0xf3)]);!_0x2cdab1['endsWith']('HEIC')&&!_0x2cdab1['endsWith'](_0x3d0f4a(0x199))&&fs[_0x3d0f4a(0x156)](_0x2cdab1)?(_0x452a25['folder_cover_path']=_0x2cdab1,_0x31a4ac['movieTvCache'][_0x3d0f4a(0x1f8)](_0x3b0d52,_0x452a25['folder_cover_path'])):_0x31a4ac[_0x3d0f4a(0x1df)][_0x3d0f4a(0x1f8)](_0x3b0d52,'');}return _0x452a25;}catch(_0x26f380){return console[_0x3d0f4a(0xf2)](_0x26f380),_0x452a25;}}function getMoviesByParams(_0x117525,_0x328c05,_0x21a612,_0x621aeb,_0x369000,_0x271b13,_0x270475,_0x4cf8cc,_0x9017c2,_0xe701c6,_0x56dee6,_0x178961,_0x443785,_0x264258,_0x1e4566,_0x25818b,_0x4a847c,_0x40b26f){const _0x12368c=_0x15d84d;let _0xeedac3=movieFieldStr;_0x40b26f&&(_0xeedac3=_0x40b26f);!_0x1e4566&&(_0x1e4566=_0x12368c(0x18d));let _0x270195='',_0x9e18d1=[],_0x103ad8=dbUserTable[_0x12368c(0xba)](_0x328c05,'movie',_0x12368c(0x1a1),!![],_0xe701c6);if(_0x328c05[_0x12368c(0xbb)]['is_admin']!=0x1&&!_0x103ad8)return[];_0x270195+='\x20type=2';_0x9017c2&&(_0x9017c2=_0x9017c2[_0x12368c(0x1b2)]('\x27','')[_0x12368c(0x1b2)]('’',''),_0x270195+=_0x12368c(0x20e),_0x9e18d1[_0x12368c(0x15b)]('%'+_0x9017c2+'%'),_0x9e18d1[_0x12368c(0x15b)]('%'+_0x9017c2+'%'),_0x9e18d1[_0x12368c(0x15b)]('%'+_0x9017c2+'%'));let _0x23f396=dbSourceFolderTable[_0x12368c(0x1ed)](_0x328c05[_0x12368c(0x1ff)][_0x12368c(0x146)],_0x12368c(0x17d),_0x12368c(0xe4));_0x23f396&&(_0x270195+=_0x12368c(0xd2)+_0x23f396);let _0x29c6b7=dbSourceFolderTable[_0x12368c(0x1ed)](_0x328c05[_0x12368c(0x1ff)][_0x12368c(0x146)],_0x12368c(0xf3),'excludeFilenameMovie');_0x29c6b7&&(_0x270195+=_0x12368c(0xd2)+_0x29c6b7);function _0x213508(_0x55e06e,_0x43125){const _0x1fde56=_0x12368c;let _0x4967e3=_0x1fde56(0x174);try{let _0x5d09ae=JSON[_0x1fde56(0x135)](_0x43125),_0x364dd4=![];for(let _0x5682a3=0x0;_0x5682a3<_0x5d09ae[_0x1fde56(0x161)];_0x5682a3++){if(!_0x5d09ae[_0x5682a3])continue;_0x364dd4=!![],_0x4967e3+='\x20'+_0x55e06e+_0x1fde56(0x19e),_0x9e18d1['push']('%'+_0x5d09ae[_0x5682a3][_0x1fde56(0x1bc)]()+'%'),_0x5682a3!=_0x5d09ae['length']-0x1&&(_0x4967e3+=_0x1fde56(0xb5));}_0x4967e3+=')',_0x364dd4&&(_0x270195+=_0x4967e3);}catch(_0x8c52f4){console[_0x1fde56(0xf2)](_0x8c52f4);}}_0x56dee6&&_0x213508(_0x12368c(0xe5),_0x56dee6);_0x178961&&_0x213508(_0x12368c(0x1fa),_0x178961);_0x443785&&_0x213508(_0x12368c(0xe3),_0x443785);_0x328c05['body']['movieActors']&&_0x328c05['body'][_0x12368c(0x211)][_0x12368c(0x161)]>0x0&&_0x328c05[_0x12368c(0xc8)][_0x12368c(0x211)][0x0]!=''&&_0x213508('movie_actor',_0x328c05['body'][_0x12368c(0x211)]);_0x328c05[_0x12368c(0xc8)][_0x12368c(0xd3)]&&_0x328c05[_0x12368c(0xc8)][_0x12368c(0xd3)][_0x12368c(0x161)]>0x0&&_0x328c05[_0x12368c(0xc8)][_0x12368c(0xd3)][0x0]!=''&&_0x213508(_0x12368c(0x133),_0x328c05[_0x12368c(0xc8)]['movieDirectors']);if(_0x4a847c){let _0xadffce=_0x328c05[_0x12368c(0x1ff)][_0x12368c(0xf7)][_0x12368c(0x13e)](_0x12368c(0x163))['get'](_0x4a847c);if(_0xadffce)try{let _0x4983f6=JSON['parse'](_0xadffce[_0x12368c(0x125)]),_0x207aab=dbUserTable[_0x12368c(0x203)](!![],_0x4983f6);_0x270195+=_0x207aab;}catch(_0x37e07c){console[_0x12368c(0xf2)](_0x37e07c);}}else{!_0x264258&&(_0x264258=0x0);let _0x1dc5b4;if(_0x264258!=0x0){_0x1dc5b4=_0x328c05[_0x12368c(0x1ff)][_0x12368c(0xf7)][_0x12368c(0x13e)]('SELECT\x20*\x20from\x20movie_collection\x20where\x20id=?')[_0x12368c(0x1cd)](_0x264258);if(!_0x1dc5b4)return _0x328c05['app'][_0x12368c(0x1c8)](_0x117525,_0x117525['__'](_0x12368c(0x1bd)));if(_0x1dc5b4[_0x12368c(0x12a)]==0x1){let _0x30c20c=_0x328c05[_0x12368c(0xc8)][_0x12368c(0x185)];if(!_0x30c20c||_0x1dc5b4[_0x12368c(0x1be)]!=sha256(_0x30c20c))return _0x328c05[_0x12368c(0x1ff)]['returnErrMsg'](_0x117525,_0x117525['__'](_0x12368c(0x1f5)));}}if(_0x1dc5b4&&_0x1dc5b4[_0x12368c(0x1c7)]==_0x12368c(0x14f))try{_0x1dc5b4[_0x12368c(0x1d3)]=JSON[_0x12368c(0x135)](_0x1dc5b4[_0x12368c(0x1d3)]),_0x270195+='\x20AND\x20'+_0x1dc5b4[_0x12368c(0x1d3)][_0x12368c(0x162)];}catch(_0x106ea6){console[_0x12368c(0xf2)](_0x106ea6);}else _0x270195+=_0x12368c(0x137)+_0x264258;}if(_0x21a612){if(_0x21a612==0x1)_0x270195+=_0x12368c(0x188);else _0x21a612==0x2&&(_0x270195+=_0x12368c(0x10a));}_0x25818b&&(_0x25818b=='#'?(_0x270195+=_0x12368c(0x149),_0x9e18d1[_0x12368c(0x15b)](_0x25818b),_0x9e18d1['push'](_0x25818b),_0x9e18d1[_0x12368c(0x15b)](_0x25818b)):(_0x270195+='\x20AND\x20(filename_fl=?\x20OR\x20show_name_fl=?\x20OR\x20movie_info_name_fl=?)',_0x9e18d1['push'](_0x25818b),_0x9e18d1['push'](_0x25818b),_0x9e18d1[_0x12368c(0x15b)](_0x25818b)));if(_0x4cf8cc&&_0x4cf8cc[_0x12368c(0x161)]>0x0){_0x270195+=_0x12368c(0xd6);for(let _0xbc9a63=0x0;_0xbc9a63<_0x4cf8cc[_0x12368c(0x161)];_0xbc9a63++){_0x270195+=_0x4cf8cc[_0xbc9a63],_0xbc9a63!=_0x4cf8cc[_0x12368c(0x161)]-0x1&&(_0x270195+=',');}_0x270195+=')';}_0x270195+=_0x103ad8;_0x621aeb&&_0x270475?_0x270195+=_0x12368c(0x1ce)+_0x621aeb+'\x20'+_0x270475:_0x270195+=_0x12368c(0x192);!_0x369000&&(_0x369000=0x32);_0x270195+=_0x12368c(0x1a8),_0x9e18d1[_0x12368c(0x15b)](_0x369000),_0x9e18d1['push'](_0x271b13);let _0x46221f=[];if(_0x1e4566=='FAVORITE')_0x46221f=dbMovieFavorite[_0x12368c(0xe7)](_0x328c05[_0x12368c(0x1ff)][_0x12368c(0xf7)],_0x328c05['currentUser']['id'],_0x270195,_0xeedac3,_0x9e18d1);else _0x1e4566==_0x12368c(0x18d)&&(_0x46221f=dbFileIndexTable[_0x12368c(0x131)](_0x328c05[_0x12368c(0x1ff)][_0x12368c(0xf7)],_0x270195,_0xeedac3,dbFileIndexTable[_0x12368c(0x168)],_0x9e18d1));if(_0x46221f[_0x12368c(0x161)]<0x1)return _0x46221f;let _0x4d3124=[];for(let _0x641bd2 in _0x46221f){_0x4d3124['push'](_0x46221f[_0x641bd2]['id']);}let _0x58e5c0=dbMovieFavorite[_0x12368c(0x186)](_0x328c05[_0x12368c(0x1ff)][_0x12368c(0xf7)],_0x328c05[_0x12368c(0xbb)]['id'],_0x4d3124);for(let _0x82afa2=0x0;_0x82afa2<_0x46221f['length'];_0x82afa2++){_0x46221f[_0x82afa2][_0x12368c(0x13c)]=0x0;for(let _0x18947 in _0x58e5c0){if(_0x58e5c0[_0x18947][_0x12368c(0x1ec)]==_0x46221f[_0x82afa2]['id']){_0x46221f[_0x82afa2][_0x12368c(0x13c)]=0x1;break;}}let _0x4b5215=_0x328c05[_0x12368c(0x1ff)][_0x12368c(0xf7)][_0x12368c(0x13e)]('SELECT\x20*\x20from\x20movie_history\x20where\x20user_id=?\x20and\x20index_id=?')[_0x12368c(0x1cd)](_0x328c05[_0x12368c(0xbb)]['id']+'',_0x46221f[_0x82afa2]['id']+'');_0x4b5215&&(_0x46221f[_0x82afa2][_0x12368c(0x102)]=_0x4b5215);_0x46221f[_0x82afa2]=addFolderCoverPath(_0x117525,_0x328c05,_0x46221f[_0x82afa2]);if(_0x46221f[_0x82afa2][_0x12368c(0x1dd)]==0x1&&_0x328c05[_0x12368c(0xc8)][_0x12368c(0xea)]){let _0x160d62=dbFileIndexTable[_0x12368c(0x140)](_0x328c05[_0x12368c(0x1ff)][_0x12368c(0xf7)],_0x46221f[_0x82afa2]);_0x46221f[_0x82afa2][_0x12368c(0x18a)]=_0x160d62['count'];}}return _0x46221f;}function getShowMatchName(_0x1b9448){const _0x99268b=_0x15d84d;let _0x25687e=dbConfigTable['findByTitle'](_0x1b9448,'movieShowMatchName');return!_0x25687e||_0x25687e&&_0x25687e[_0x99268b(0x1a6)]!=0x0?0x1:0x0;}router['post'](_0x15d84d(0x1a9),(_0x2dbff6,_0x324e24,_0x4a07de)=>{const _0x3688da=_0x15d84d;if(dbUserTable[_0x3688da(0x190)](_0x2dbff6,_0x324e24,_0x3688da(0x142),_0x3688da(0x1a1))==!![]){let _0x2f9373=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x157)],_0x5c7010=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x1ee)],_0x195288=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x134)],_0x2d0bf9=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x18b)],_0x5775a1=_0x2dbff6['body'][_0x3688da(0x122)],_0x536968=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x18c)],_0x33b28b=_0x2dbff6['body'][_0x3688da(0x1eb)],_0x3dac3d=_0x2dbff6['body']['movieRegion'],_0x1d9055=_0x2dbff6['body'][_0x3688da(0x1a2)],_0x1edb31=_0x2dbff6['body'][_0x3688da(0x1af)],_0x1fee2d=_0x2dbff6[_0x3688da(0xc8)]['sourceType'],_0x5ccaad=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x12c)],_0x54514a=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x1dc)],_0x1eb7c4=_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x1f4)],_0x47fc6e=_0x2dbff6['body'][_0x3688da(0x136)];_0x2dbff6['body'][_0x3688da(0xea)]=!![],_0x2dbff6[_0x3688da(0xc8)][_0x3688da(0x121)]=!![];let _0x57348e=getMoviesByParams(_0x324e24,_0x2dbff6,_0x1fee2d,_0x195288,_0x2f9373,_0x5c7010,_0x2d0bf9,_0x5775a1,_0x536968,_0x33b28b,_0x3dac3d,_0x1d9055,_0x1edb31,_0x5ccaad,_0x54514a,_0x1eb7c4,_0x47fc6e);return _0x324e24[_0x3688da(0x19d)]({'movieShowMatchName':getShowMatchName(_0x2dbff6[_0x3688da(0x1ff)]['dbOther']),'code':0x0,'data':_0x57348e});}}),router[_0x15d84d(0xd8)](_0x15d84d(0x129),(_0x248a87,_0x3899d0,_0x1105cd)=>{const _0xe96727=_0x15d84d;if(dbUserTable['doUserCanGet'](_0x248a87,_0x3899d0,'movie',_0xe96727(0x1a1))==!![]){let _0x5e8e14=_0x248a87[_0xe96727(0xc8)][_0xe96727(0x1eb)],_0x1ebc1e=_0x248a87[_0xe96727(0xc8)][_0xe96727(0x11a)],_0x50103d=_0x248a87[_0xe96727(0xc8)][_0xe96727(0x1d0)];!_0x1ebc1e&&(_0x1ebc1e=0x9);let _0x253636=_0xe96727(0x20d),_0x56075e='';_0x5e8e14?_0x56075e=dbUserTable['getUserPathWhere'](_0x248a87,'movie',_0xe96727(0x1a1),!![],_0x5e8e14):_0x56075e=dbUserTable['getUserPathWhere'](_0x248a87,_0xe96727(0x142),_0xe96727(0x1a1),!![]);let _0x44e65a=_0x248a87[_0xe96727(0xc8)]['genresType'];!_0x44e65a&&(_0x44e65a=_0xe96727(0xe3));let _0x1c5b06=_0x248a87[_0xe96727(0x1ff)][_0xe96727(0xf7)]['prepare'](_0xe96727(0xaf))[_0xe96727(0x197)](_0x44e65a),_0x317eff=[];for(let _0x179c5d of _0x1c5b06){let _0x58f4e0=_0x179c5d[_0xe96727(0x1d9)],_0x391fb6=_0xe96727(0x1e4);_0x391fb6+=_0x56075e,_0x391fb6+=_0xe96727(0x11b);if(_0x50103d){if(_0x50103d==0x1)_0x391fb6+='\x20AND\x20is_tvplay==0';else _0x50103d==0x2&&(_0x391fb6+=_0xe96727(0x10a));}_0x391fb6+=_0xe96727(0xd2)+_0x44e65a+_0xe96727(0x180)+_0x58f4e0+'%\x27',_0x391fb6+='\x20AND\x20is_file=1\x20AND\x20show_in_list=1\x20ORDER\x20BY\x20check_time\x20DESC\x20LIMIT\x20'+_0x1ebc1e;let _0x1d544b=dbFileIndexTable[_0xe96727(0x131)](_0x248a87[_0xe96727(0x1ff)][_0xe96727(0xf7)],_0x391fb6,_0x253636,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x539235=[];for(let _0x37a1d0 in _0x1d544b){_0x539235['push'](_0x1d544b[_0x37a1d0]['id']);}let _0xbfb4e2=dbMovieFavorite['getFavoriteList'](_0x248a87[_0xe96727(0x1ff)][_0xe96727(0xf7)],_0x248a87[_0xe96727(0xbb)]['id'],_0x539235);for(let _0x555e90=0x0;_0x555e90<_0x1d544b[_0xe96727(0x161)];_0x555e90++){_0x1d544b[_0x555e90][_0xe96727(0x13c)]=0x0;for(let _0xbb1300 in _0xbfb4e2){if(_0xbfb4e2[_0xbb1300][_0xe96727(0x1ec)]==_0x1d544b[_0x555e90]['id']){_0x1d544b[_0x555e90][_0xe96727(0x13c)]=0x1;break;}}_0x1d544b[_0x555e90]=addFolderCoverPath(_0x3899d0,_0x248a87,_0x1d544b[_0x555e90]);}_0x1d544b['length']>0x0&&_0x317eff[_0xe96727(0x15b)]({'genresType':_0x44e65a,'genresValue':_0x58f4e0,'movieList':_0x1d544b,'indexCount':_0x179c5d['index_count']});}_0x3899d0['json']({'code':0x0,'data':_0x317eff,'movieShowMatchName':getShowMatchName(_0x248a87['app'][_0xe96727(0x146)])});}}),router[_0x15d84d(0xd8)](_0x15d84d(0xf4),(_0x5f1670,_0x10a381,_0x349d6a)=>{const _0x4f5841=_0x15d84d;if(dbUserTable[_0x4f5841(0x190)](_0x5f1670,_0x10a381,_0x4f5841(0x142),_0x4f5841(0x1a1))==!![]){let _0x410cd7=getMoviesByParams(_0x10a381,_0x5f1670,0x1,_0x4f5841(0x106),0xf,0x0,_0x4f5841(0x206));_0x5f1670[_0x4f5841(0xc8)][_0x4f5841(0xea)]=!![],_0x5f1670[_0x4f5841(0xc8)][_0x4f5841(0x121)]=!![],_0x5f1670[_0x4f5841(0xc8)]['useTvSeriesInfo']=0x1;let _0x2aaf64=getMoviesByParams(_0x10a381,_0x5f1670,0x2,_0x4f5841(0x106),0x32,0x0,_0x4f5841(0x206));_0x5f1670[_0x4f5841(0xc8)][_0x4f5841(0xea)]=![],_0x5f1670[_0x4f5841(0xc8)][_0x4f5841(0x121)]=![],_0x5f1670['body']['useTvSeriesInfo']=0x0;let _0xf82357=dbConfigTable[_0x4f5841(0xb3)](_0x5f1670[_0x4f5841(0x1ff)][_0x4f5841(0x146)],'movieHomeShowMyMedia');_0xf82357=!_0xf82357||_0xf82357&&_0xf82357[_0x4f5841(0x1a6)]==0x1;let _0x5cad38=dbConfigTable[_0x4f5841(0xb3)](_0x5f1670[_0x4f5841(0x1ff)]['dbOther'],_0x4f5841(0x111));_0x5cad38=!_0x5cad38||_0x5cad38&&_0x5cad38[_0x4f5841(0x1a6)]==0x1;let _0x998ed1=dbConfigTable[_0x4f5841(0xb3)](_0x5f1670[_0x4f5841(0x1ff)][_0x4f5841(0x146)],_0x4f5841(0x13b));_0x998ed1=!_0x998ed1||_0x998ed1&&_0x998ed1['value']==0x1;let _0x49ba96=[];if(_0x998ed1){let _0x2bce34=_0x4f5841(0x1d8),_0x19ab10='SELECT\x20'+_0x2bce34+_0x4f5841(0xe9)+_0x5f1670[_0x4f5841(0xbb)]['id']+_0x4f5841(0xcf);_0x49ba96=_0x5f1670[_0x4f5841(0x1ff)][_0x4f5841(0xf7)][_0x4f5841(0x13e)](_0x19ab10)[_0x4f5841(0x197)]();let _0x3ae526=[];for(let _0xe08db2 in _0x49ba96){_0x3ae526[_0x4f5841(0x15b)](_0x49ba96[_0xe08db2]['id']);}let _0x270f26=dbMovieFavorite[_0x4f5841(0x186)](_0x5f1670[_0x4f5841(0x1ff)]['dbFileIndex'],_0x5f1670['currentUser']['id'],_0x3ae526);for(let _0x1ea6fa=0x0;_0x1ea6fa<_0x49ba96['length'];_0x1ea6fa++){_0x49ba96[_0x1ea6fa]['favorite']=0x0;for(let _0x5967f1 in _0x270f26){if(_0x270f26[_0x5967f1][_0x4f5841(0x1ec)]==_0x49ba96[_0x1ea6fa]['id']){_0x49ba96[_0x1ea6fa]['favorite']=0x1;break;}}}}let _0xb4636c=[];_0x5cad38&&(_0xb4636c=getMovieLibrary(_0x5f1670,_0x10a381,0x6));let _0x37babc={'code':0x0,'movies':_0x410cd7,'tv':_0x2aaf64,'history':_0x49ba96,'libraryList':_0xb4636c,'sourceList':[]};_0x37babc[_0x4f5841(0x16a)]=getShowMatchName(_0x5f1670[_0x4f5841(0x1ff)]['dbOther']);if(_0xf82357){let _0x40de8f=_0x5f1670['app'][_0x4f5841(0x146)][_0x4f5841(0x13e)](_0x4f5841(0x1c3))['all']('movie');for(let _0x587cc1 of _0x40de8f){let _0x1dd283=getMoviesByParams(_0x10a381,_0x5f1670,null,'check_time',0x4,0x0,'desc',null,null,JSON[_0x4f5841(0x159)]([path[_0x4f5841(0x166)](_0x587cc1[_0x4f5841(0x17d)])]));if(_0x1dd283[_0x4f5841(0x161)]<0x1)continue;_0x37babc[_0x4f5841(0x145)]['push']({'mediaType':_0x587cc1[_0x4f5841(0xb1)],'path':_0x587cc1[_0x4f5841(0x17d)],'name':path[_0x4f5841(0x1b0)](_0x587cc1[_0x4f5841(0x17d)]),'sourceMovies':_0x1dd283});}}return _0x10a381['json'](_0x37babc);}}),router[_0x15d84d(0xd8)](_0x15d84d(0x207),(_0x5d89e0,_0x376357,_0x5eba24)=>{const _0x42e8d9=_0x15d84d;if(dbUserTable[_0x42e8d9(0x190)](_0x5d89e0,_0x376357,_0x42e8d9(0x142),_0x42e8d9(0x1a1))==!![]){let _0x7078a0=getMoviesByParams(_0x376357,_0x5d89e0,0x1,_0x42e8d9(0x16f),0xa,0x0,_0x42e8d9(0x206)),_0x5974fe=getMoviesByParams(_0x376357,_0x5d89e0,0x2,_0x42e8d9(0x16f),0xa,0x0,'desc'),_0x449a0e=_0x42e8d9(0xd9),_0x386d7c=_0x42e8d9(0xfc)+_0x449a0e+_0x42e8d9(0xe9)+_0x5d89e0[_0x42e8d9(0xbb)]['id']+_0x42e8d9(0xcf),_0x1f39fa=_0x5d89e0['app'][_0x42e8d9(0xf7)]['prepare'](_0x386d7c)[_0x42e8d9(0x197)](),_0x25f354=getCollectionList(_0x5d89e0,_0x376357,_0x42e8d9(0x1cb)),_0x17957f=getCollectionList(_0x5d89e0,_0x376357,_0x42e8d9(0x14f)),_0x5e6c6e=getMoviesByParams(_0x376357,_0x5d89e0,null,_0x42e8d9(0x16f),0xa,0x0,'desc',null,null,null,null,null,null,null,_0x42e8d9(0xf0)),_0x5250e9=getMovieLibrary(_0x5d89e0,_0x376357),_0x49035f={'code':0x0,'movies':_0x7078a0,'tv':_0x5974fe,'history':_0x1f39fa,'favorites':_0x5e6c6e,'collectionList':_0x25f354,'aiCollectionList':_0x17957f,'libraryList':_0x5250e9};return _0x376357[_0x42e8d9(0x19d)](_0x49035f);}}),router['post'](_0x15d84d(0x20a),(_0x54a046,_0x1d87e9,_0x5c598c)=>{const _0x243e7d=_0x15d84d;if(dbUserTable[_0x243e7d(0x190)](_0x54a046,_0x1d87e9,_0x243e7d(0x142),_0x243e7d(0x1a1))==!![]){let _0xc6c009=getMoviesByParams(_0x1d87e9,_0x54a046,0x1,'check_time',0x1,0x0,_0x243e7d(0x206)),_0x35b863=getMoviesByParams(_0x1d87e9,_0x54a046,0x2,_0x243e7d(0x16f),0x1,0x0,'desc'),_0x1fe97a='m.time,\x20f.id,f.path,f.filename,f.ext,f.type,f.width,f.height,f.duration,f.size,f.movie_info_state,f.movie_douban_id,f.movie_imdb_id,f.movie_douban_score,f.movie_info_name,f.show_name',_0x2a0ca0=_0x243e7d(0xfc)+_0x1fe97a+'\x20from\x20movie_history\x20as\x20m\x20inner\x20join\x20file_index_movie\x20as\x20f\x20on\x20m.index_id=f.id\x20where\x20m.user_id='+_0x54a046[_0x243e7d(0xbb)]['id']+_0x243e7d(0x147),_0x1d2c7e=_0x54a046[_0x243e7d(0x1ff)]['dbFileIndex'][_0x243e7d(0x13e)](_0x2a0ca0)[_0x243e7d(0x197)](),_0x15836e=getMoviesByParams(_0x1d87e9,_0x54a046,null,_0x243e7d(0x16f),0x1,0x0,_0x243e7d(0x206),null,null,null,null,null,null,null,'FAVORITE'),_0x3ce80b=dbFileIndexTable[_0x243e7d(0xee)](_0x54a046['app'][_0x243e7d(0xf7)],_0x243e7d(0x1aa),dbFileIndexTable[_0x243e7d(0x168)]),_0x5556ef=dbFileIndexTable[_0x243e7d(0xee)](_0x54a046[_0x243e7d(0x1ff)][_0x243e7d(0xf7)],'is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20is_tvplay==1',dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);_0x54a046[_0x243e7d(0xc8)][_0x243e7d(0x139)]=0x5af3107a3fff,_0x54a046[_0x243e7d(0xc8)][_0x243e7d(0xcb)]=0x1,_0x54a046['body']['sortField']=_0x243e7d(0x16f),_0x54a046[_0x243e7d(0xc8)][_0x243e7d(0x18b)]='desc',_0x54a046[_0x243e7d(0xc8)]['trash']=0x0,_0x54a046[_0x243e7d(0xc8)][_0x243e7d(0x157)]=0x1;let _0x3ba38a=photoApiUtils[_0x243e7d(0xc1)](_0x54a046,_0x1d87e9),_0x5941ae=getMovieLibrary(_0x54a046,_0x1d87e9),_0x44a9a1={'movieCount':_0x3ce80b[_0x243e7d(0x157)],'tvCount':_0x5556ef[_0x243e7d(0x157)],'code':0x0,'movies':_0xc6c009,'tv':_0x35b863,'history':_0x1d2c7e,'favorites':_0x15836e,'photos':_0x3ba38a,'libraryList':_0x5941ae};return _0x1d87e9[_0x243e7d(0x19d)](_0x44a9a1);}});let subtitleExtList=[_0x15d84d(0xcd),'.ass',_0x15d84d(0x1f6)];router[_0x15d84d(0xd8)]('/getSameNameSubtitles',(_0x2325ce,_0x5e0c2d,_0x1103f)=>{const _0x321ff7=_0x15d84d;let _0x54194b=[],_0x55b3eb=null;if(_0x2325ce[_0x321ff7(0xc8)]['videoPath'])_0x55b3eb=_0x2325ce[_0x321ff7(0xc8)][_0x321ff7(0x200)],_0x55b3eb=fileUtil[_0x321ff7(0xf5)](_0x55b3eb);else{if(_0x2325ce[_0x321ff7(0xc8)]['id']){let _0x1b4998=_0x2325ce[_0x321ff7(0xc8)]['id'],_0x4af996=dbFileIndexTable[_0x321ff7(0x176)](_0x2325ce['app']['dbFileIndex'],_0x1b4998,dbFileIndexTable[_0x321ff7(0x168)]);_0x4af996&&(_0x55b3eb=path[_0x321ff7(0x166)](_0x4af996[_0x321ff7(0x17d)],_0x4af996[_0x321ff7(0xf3)]),_0x2325ce[_0x321ff7(0x1ff)][_0x321ff7(0xf7)][_0x321ff7(0x13e)](_0x321ff7(0xd4))[_0x321ff7(0x1b8)](Date[_0x321ff7(0xc0)](),_0x4af996['id']));}}function _0x4c78d1(){const _0xa45db6=_0x321ff7;let _0x36c19a=dbConfigTable[_0xa45db6(0xb3)](_0x2325ce[_0xa45db6(0x1ff)]['dbOther'],'subtitleSize'),_0x5e530e=dbConfigTable[_0xa45db6(0xb3)](_0x2325ce[_0xa45db6(0x1ff)][_0xa45db6(0x146)],'defaultTranscodeResolution');return _0x5e0c2d[_0xa45db6(0x19d)]({'code':0x0,'data':_0x54194b,'defaultTranscodeResolution':_0x5e530e?_0x5e530e['value']:_0xa45db6(0xc4),'userFontSize':_0x36c19a?_0x36c19a[_0xa45db6(0x1a6)]:1.5});}_0x55b3eb?fs[_0x321ff7(0x153)](_0x55b3eb,(_0x56f4b4,_0x54c57c)=>{const _0x16eec3=_0x321ff7;if(_0x56f4b4)return _0x4c78d1();let _0x35d045=path[_0x16eec3(0xc5)](_0x55b3eb);fs['readdir'](_0x35d045,(_0x265de3,_0x4ceb37)=>{const _0x291cac=_0x16eec3;if(_0x265de3)return _0x4c78d1();let _0x1cdd03=path[_0x291cac(0x1b0)](_0x55b3eb)[_0x291cac(0x1b2)](path[_0x291cac(0x141)](_0x55b3eb),''),_0x1ea931=_0x1cdd03['replaceAll']('\x20','_');for(let _0x46cee2 in _0x4ceb37){let _0x492b0b=_0x4ceb37[_0x46cee2],_0x29eee4=path[_0x291cac(0x141)](_0x492b0b);(_0x492b0b[_0x291cac(0xec)](_0x1cdd03)||_0x492b0b[_0x291cac(0xec)](_0x1ea931))&&subtitleExtList['includes'](_0x29eee4)&&_0x54194b[_0x291cac(0x15b)]({'fileName':path[_0x291cac(0x1b0)](_0x492b0b),'filePath':path[_0x291cac(0x166)](_0x35d045,_0x492b0b)});}return _0x4c78d1();});}):_0x4c78d1();}),router[_0x15d84d(0xd8)](_0x15d84d(0x14e),(_0x5f558a,_0x196d03,_0x58564c)=>{const _0x54cd14=_0x15d84d;let _0x59e5fc=_0x5f558a[_0x54cd14(0x1ff)]['dbFileIndex'][_0x54cd14(0x13e)](_0x54cd14(0x15e))[_0x54cd14(0x197)](),_0x1311f3=_0x5f558a[_0x54cd14(0x1ff)][_0x54cd14(0xf7)]['prepare'](_0x54cd14(0x1bf))[_0x54cd14(0x197)](),_0x579d76=_0x5f558a[_0x54cd14(0x1ff)][_0x54cd14(0xf7)][_0x54cd14(0x13e)](_0x54cd14(0x212))['all']();_0x196d03[_0x54cd14(0x19d)]({'code':0x0,'data':_0x59e5fc[_0x54cd14(0x105)](_0x1311f3,_0x579d76)});}),router['post'](_0x15d84d(0xb0),(_0x303e24,_0x1d046e,_0x3392bf)=>{const _0x539ca5=_0x15d84d;let _0xd56012=_0x303e24[_0x539ca5(0xc8)][_0x539ca5(0x14c)],_0x20e03f=dbFileIndexTable['getById'](_0x303e24[_0x539ca5(0x1ff)][_0x539ca5(0xf7)],_0xd56012,dbFileIndexTable[_0x539ca5(0x168)]);if(!_0x20e03f)return _0x1d046e['json']({'code':0x0});if(dbUserTable[_0x539ca5(0x190)](_0x303e24,_0x1d046e,_0x539ca5(0x142),'power_delete',_0x20e03f[_0x539ca5(0x17d)])==!![])return dbFileIndexTable[_0x539ca5(0x17a)](_0x303e24[_0x539ca5(0x1ff)][_0x539ca5(0xf7)],_0xd56012,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']),_0x1d046e[_0x539ca5(0x19d)]({'code':0x0});}),router[_0x15d84d(0xd8)](_0x15d84d(0x1c1),(_0x13ff48,_0x31422e,_0x3d9ca2)=>{const _0x4719af=_0x15d84d;let _0x3df6db=_0x13ff48[_0x4719af(0xbb)]['id'],_0x4b35b2=parseInt(_0x13ff48[_0x4719af(0xc8)][_0x4719af(0x1b1)]),_0x398f40=dbMovieFavorite[_0x4719af(0xb9)](_0x13ff48[_0x4719af(0x1ff)]['dbFileIndex'],_0x3df6db,_0x4b35b2),_0x3a2462=0x0;if(_0x398f40)dbMovieFavorite[_0x4719af(0xd5)](_0x13ff48[_0x4719af(0x1ff)][_0x4719af(0xf7)],_0x3df6db,_0x4b35b2);else{_0x3a2462=0x1;let _0x3011be=new Date()[_0x4719af(0x14d)]();_0x13ff48[_0x4719af(0x1ff)][_0x4719af(0xf7)][_0x4719af(0x13e)](_0x4719af(0xd4))[_0x4719af(0x1b8)](_0x3011be,_0x4b35b2),dbMovieFavorite[_0x4719af(0x109)](_0x13ff48[_0x4719af(0x1ff)][_0x4719af(0xf7)],_0x3df6db,_0x4b35b2);}return _0x31422e[_0x4719af(0x19d)]({'code':0x0,'favorite':_0x3a2462});}),router[_0x15d84d(0xd8)](_0x15d84d(0x10d),(_0x38c32a,_0x15cc16,_0x40081a)=>{const _0x5cd521=_0x15d84d;try{let _0x26ae18=parseInt(_0x38c32a[_0x5cd521(0xc8)][_0x5cd521(0x14c)]),_0x593ecd=dbFileIndexTable[_0x5cd521(0x176)](_0x38c32a[_0x5cd521(0x1ff)][_0x5cd521(0xf7)],_0x26ae18,dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(!_0x593ecd)return _0x15cc16[_0x5cd521(0x19d)]({'code':0x0});let _0x1d7acb=parseInt(_0x38c32a[_0x5cd521(0xc8)][_0x5cd521(0xb2)]),_0x261c81=parseInt(_0x38c32a[_0x5cd521(0xc8)]['endDuration']);!_0x261c81&&(_0x261c81=0x0);!_0x1d7acb&&(_0x1d7acb=0x0);let _0x10d076=parseInt(_0x38c32a[_0x5cd521(0xc8)]['autoSkip']);if(_0x1d7acb<0x0||_0x261c81<0x0||_0x1d7acb>_0x593ecd[_0x5cd521(0x15a)]||_0x261c81>_0x593ecd[_0x5cd521(0x15a)]||_0x10d076!=0x0&&_0x10d076!=0x1)return _0x38c32a['app'][_0x5cd521(0x1c8)](_0x15cc16,_0x5cd521(0xe1));let _0x3ee55e=[_0x593ecd];_0x593ecd[_0x5cd521(0x1dd)]==0x1&&(_0x3ee55e=_0x38c32a[_0x5cd521(0x1ff)][_0x5cd521(0xf7)][_0x5cd521(0x13e)](_0x5cd521(0x1a7)+dbFileIndexTable[_0x5cd521(0x168)]+_0x5cd521(0x198))[_0x5cd521(0x197)](_0x593ecd['path']));let _0x1e1a84='(';for(let _0x5714ac in _0x3ee55e){_0x1e1a84+=_0x3ee55e[_0x5714ac]['id'],_0x5714ac!=_0x3ee55e[_0x5cd521(0x161)]-0x1&&(_0x1e1a84+=',');}return _0x1e1a84+=')',_0x38c32a[_0x5cd521(0x1ff)][_0x5cd521(0xf7)][_0x5cd521(0x13e)](_0x5cd521(0xf9)+_0x1e1a84)[_0x5cd521(0x1b8)](_0x1d7acb,_0x261c81,_0x10d076),_0x15cc16[_0x5cd521(0x19d)]({'code':0x0});}catch(_0x8b7c65){return console[_0x5cd521(0xf2)](_0x8b7c65),_0x38c32a['app']['returnErrMsg'](_0x15cc16,_0x15cc16['__'](_0x5cd521(0x1fd)));}});function getMovieLibrary(_0x46e67a,_0x300921,_0x246041){const _0x1efdbb=_0x15d84d;let _0x5aae6d=_0x46e67a[_0x1efdbb(0xc8)][_0x1efdbb(0x1ee)]||0x0,_0x389a98=_0x246041||_0x46e67a['body'][_0x1efdbb(0x157)]||0x32,_0x2160de=_0x46e67a[_0x1efdbb(0xc8)]['search']||'',_0x112cb8=_0x46e67a[_0x1efdbb(0xc8)][_0x1efdbb(0x1b4)]||_0x1efdbb(0x106),_0x31553f=_0x46e67a[_0x1efdbb(0xc8)][_0x1efdbb(0x1b5)]||'desc';if(!['create_time',_0x1efdbb(0x100)][_0x1efdbb(0x1e6)](_0x112cb8))return console[_0x1efdbb(0xf2)]('order\x20field\x20error',_0x112cb8),[];let _0x38bdbe=[],_0x5f5184=[],_0x1ebe31='SELECT\x20*\x20FROM\x20movie_library\x20';_0x46e67a[_0x1efdbb(0xbb)][_0x1efdbb(0x118)]==0x1?_0x2160de&&(_0x1ebe31+=_0x1efdbb(0x1ef),_0x5f5184['push']('%'+_0x2160de+'%')):(_0x1ebe31=_0x1efdbb(0x17b),_0x2160de&&(_0x1ebe31+=_0x1efdbb(0x10b),_0x5f5184[_0x1efdbb(0x15b)]('%'+_0x2160de+'%')));_0x1ebe31+=_0x1efdbb(0x144)+_0x112cb8+'\x20'+_0x31553f+'\x20LIMIT\x20?\x20OFFSET\x20?',_0x5f5184['push'](_0x389a98),_0x5f5184[_0x1efdbb(0x15b)](_0x5aae6d),_0x38bdbe=_0x46e67a[_0x1efdbb(0x1ff)][_0x1efdbb(0xf7)][_0x1efdbb(0x13e)](_0x1ebe31)['all'](_0x5f5184);if(_0x38bdbe[_0x1efdbb(0x161)]<0x1)return[];for(let _0x5805d2 in _0x38bdbe){let _0x14fca9=_0x38bdbe[_0x5805d2];try{let _0x51e0ca=JSON[_0x1efdbb(0x135)](_0x14fca9[_0x1efdbb(0x1fe)]),_0x3279e8=[];for(let _0x22f85f of _0x51e0ca){let _0x371a42=dbUserTable[_0x1efdbb(0xb8)](_0x46e67a['app'][_0x1efdbb(0x146)],_0x22f85f,'id,username');_0x3279e8[_0x1efdbb(0x15b)](_0x371a42);}_0x38bdbe[_0x5805d2][_0x1efdbb(0xad)]=_0x3279e8;}catch(_0x37774e){console[_0x1efdbb(0xf2)](_0x37774e);}let _0x493293=getMoviesByParams(_0x300921,_0x46e67a,null,_0x1efdbb(0x16f),0x4,0x0,_0x1efdbb(0x206),null,null,null,null,null,null,null,null,null,_0x38bdbe[_0x5805d2]['id']);_0x38bdbe[_0x5805d2][_0x1efdbb(0x1e7)]=_0x493293;}return _0x38bdbe;}router[_0x15d84d(0xd8)](_0x15d84d(0xd1),(_0x3d688d,_0x584549,_0x32ea8a)=>{const _0x1b3808=_0x15d84d;let _0x131a55=_0x3d688d[_0x1b3808(0xc8)][_0x1b3808(0x100)],_0x52a4a0=_0x3d688d['body'][_0x1b3808(0x136)],_0x43ae62=_0x3d688d[_0x1b3808(0xc8)][_0x1b3808(0x1e8)],_0x96ba0e=_0x3d688d[_0x1b3808(0xc8)][_0x1b3808(0x143)],_0xbc0863=_0x3d688d[_0x1b3808(0xc8)][_0x1b3808(0x114)],_0x475c31=_0x3d688d[_0x1b3808(0xc8)][_0x1b3808(0x128)];if(_0x475c31==_0x1b3808(0xd7)){let _0x34fb29=getMovieLibrary(_0x3d688d,_0x584549);return _0x584549['json']({'code':0x0,'data':_0x34fb29});}else{if(_0x3d688d[_0x1b3808(0xbb)][_0x1b3808(0x118)]!=0x1)return _0x3d688d['app'][_0x1b3808(0x1c8)](_0x584549,_0x584549['__'](_0x1b3808(0x152)));if(_0x475c31==_0x1b3808(0xda)||_0x475c31==_0x1b3808(0x1a5)){if(!_0x43ae62||!_0x43ae62 instanceof Array||_0x43ae62['length']<0x1)return _0x3d688d['app'][_0x1b3808(0x1c8)](_0x584549,_0x584549['__'](_0x1b3808(0x1fd)));if(_0xbc0863){if(_0x96ba0e!=null&&!_0x96ba0e instanceof Array)return _0x3d688d[_0x1b3808(0x1ff)][_0x1b3808(0x1c8)](_0x584549,_0x584549['__'](_0x1b3808(0x1fd)));}if(sqliteUtil[_0x1b3808(0xc2)](JSON[_0x1b3808(0x159)](_0x43ae62))==!![])return _0x3d688d['app'][_0x1b3808(0x1c8)](_0x584549,'error\x20pathList');}if(_0x475c31==_0x1b3808(0x1a5)&&_0x52a4a0)_0x3d688d[_0x1b3808(0x1ff)]['dbFileIndex'][_0x1b3808(0x13e)](_0x1b3808(0xf6))[_0x1b3808(0x1b8)](_0x131a55,JSON[_0x1b3808(0x159)](_0x43ae62),_0xbc0863,JSON[_0x1b3808(0x159)](_0x96ba0e),_0x52a4a0);else{if(_0x475c31=='DELETE'&&_0x52a4a0)_0x3d688d[_0x1b3808(0x1ff)][_0x1b3808(0xf7)]['prepare'](_0x1b3808(0x177))['run'](_0x52a4a0);else{if(_0x475c31==_0x1b3808(0xda))_0x3d688d[_0x1b3808(0x1ff)]['dbFileIndex'][_0x1b3808(0x13e)](_0x1b3808(0x17c))['run'](_0x131a55,JSON[_0x1b3808(0x159)](_0x43ae62),_0xbc0863,JSON['stringify'](_0x96ba0e),_0x3d688d[_0x1b3808(0xbb)]['id']);else return _0x3d688d[_0x1b3808(0x1ff)][_0x1b3808(0x1c8)](_0x584549,_0x584549['__'](_0x1b3808(0x152)));}}return _0x584549[_0x1b3808(0x19d)]({'code':0x0});}}),module[_0x15d84d(0xe0)]=router;