const _0x2a9ca7=_0x31c5;function _0x2ee6(){const _0x3cc1dc=['../utils/cryptoUtils','/downloadFrpc','3427794hfVZOY','log','value','2856480UkPQWD','arch','data','/getVipInfo','returnErrMsg','createWriteStream','/nasCabLoginByToken','NasCab\x20account\x20not\x20found','axios','182112mUIqIh','ddns','/setDdnsEnable','post','1WXhpaA','proxyServerList','findByTitle','1532216NLQxCS','nasProxyRestart','/setUseNasCabCert','frpcPath','/setDdnsType','then','parse','type','3507870eVgXdp','body','app','getVipInfo','2587746ODKAlN','userInfo','FRPC\x20download\x20exception','finish','Router','ipv6','token','isAdmin','httpsKey','express','info','httpsCert','/getProxyState','error','msg','ipv4','/getDDNSState','nasDdnsEnable','renameSync','dbOther','GET','../../db/dbUserTable','pipe','frpcFolder','nasCabLogout','nasDdnsState','send','loginFailedTryLater','vipType','platform','../utils/nasAccountUtils','ddnsType','frpcTempPath','../../myConfig/config','loginByToken','frpc','code','mkdirSync','win32','create','/getNasAccountInfo','nasDdnsRestart','json','Params\x20invalid','Downloading','downloadUrl','globalIpList','nasRemoteEnable','deleteByTitle','nasAccountInfoPwd','length','ipv6addressNotFound','70ADODCu','decryptString','frpc.exe','existsSync','useNasCabCerts','/nasCabLogout','catch','../../db/dbNoticeCenterTable','958995lWGLoy','nasAccountInfoConfigKey','apiBaseUrl','nasRemoteState'];_0x2ee6=function(){return _0x3cc1dc;};return _0x2ee6();}(function(_0x3d3807,_0x226607){const _0x5685b3=_0x31c5,_0x55d177=_0x3d3807();while(!![]){try{const _0x1d5d83=parseInt(_0x5685b3(0x224))/0x1*(parseInt(_0x5685b3(0x233))/0x2)+-parseInt(_0x5685b3(0x22f))/0x3+parseInt(_0x5685b3(0x220))/0x4*(-parseInt(_0x5685b3(0x206))/0x5)+parseInt(_0x5685b3(0x214))/0x6+parseInt(_0x5685b3(0x227))/0x7+parseInt(_0x5685b3(0x217))/0x8+parseInt(_0x5685b3(0x20e))/0x9;if(_0x1d5d83===_0x226607)break;else _0x55d177['push'](_0x55d177['shift']());}catch(_0xa1141e){_0x55d177['push'](_0x55d177['shift']());}}}(_0x2ee6,0xb4e81));var express=require(_0x2a9ca7(0x23c)),router=express[_0x2a9ca7(0x237)]();let config=require(_0x2a9ca7(0x1f3)),dbConfigTable=require('../../db/dbConfigTable'),dbNoticeCenterTable=require(_0x2a9ca7(0x20d)),path=require('path'),cryptoUtils=require(_0x2a9ca7(0x212)),nasAccountUtil=require(_0x2a9ca7(0x1f0));function _0x31c5(_0xec477d,_0x11504a){const _0x2ee6dc=_0x2ee6();return _0x31c5=function(_0x31c5a7,_0x16715a){_0x31c5a7=_0x31c5a7-0x1dc;let _0x3cb562=_0x2ee6dc[_0x31c5a7];return _0x3cb562;},_0x31c5(_0xec477d,_0x11504a);}const dbUserTable=require(_0x2a9ca7(0x1e7)),fs=require('fs');let axios=require(_0x2a9ca7(0x21f));const os=require('os');router[_0x2a9ca7(0x223)](_0x2a9ca7(0x1e2),(_0x548372,_0x18a3f4,_0x23a78c)=>{const _0x4eb03f=_0x2a9ca7;if(dbUserTable[_0x4eb03f(0x23a)](_0x548372,_0x18a3f4)!==!![])return;let _0x1fffff=dbConfigTable[_0x4eb03f(0x226)](_0x548372[_0x4eb03f(0x231)][_0x4eb03f(0x1e5)],_0x4eb03f(0x1eb));return _0x18a3f4[_0x4eb03f(0x1fc)]({'code':0x0,'ddnsState':_0x1fffff?JSON[_0x4eb03f(0x22d)](_0x1fffff[_0x4eb03f(0x216)]):''});}),router[_0x2a9ca7(0x223)](_0x2a9ca7(0x222),(_0x37a3a1,_0x1b1b0f,_0x4e4458)=>{const _0x59e800=_0x2a9ca7;if(dbUserTable[_0x59e800(0x23a)](_0x37a3a1,_0x1b1b0f)!==!![])return;let _0x3984a7=_0x37a3a1['body']['nasDdnsEnable'];if(_0x3984a7==0x0||_0x3984a7==0x1)return dbConfigTable[_0x59e800(0x1f9)](_0x37a3a1[_0x59e800(0x231)][_0x59e800(0x1e5)],{'title':'nasDdnsEnable','value':_0x3984a7+''}),process[_0x59e800(0x1ec)]({'type':_0x59e800(0x1fb)}),_0x1b1b0f[_0x59e800(0x1fc)]({'code':0x0});});function saveConfig(_0x27fe7b,_0x1ffa65,_0x428a9d){const _0x5dc9a2=_0x2a9ca7;dbConfigTable[_0x5dc9a2(0x1f9)](_0x27fe7b,{'title':_0x1ffa65,'value':_0x428a9d+''});}function saveNasCabHttpsCerts(_0xaec93b,_0xdd8e15){const _0x14e492=_0x2a9ca7;let _0x38ede7=dbConfigTable[_0x14e492(0x226)](_0xaec93b,config[_0x14e492(0x20f)]);if(!_0x38ede7){if(_0xdd8e15)return _0xdd8e15[_0x14e492(0x1fc)]({'code':0x1,'message':_0x14e492(0x21e)});}cryptoUtils[_0x14e492(0x207)](config['nasAccountInfoPwd'],_0x38ede7[_0x14e492(0x216)])[_0x14e492(0x22c)](_0x550d39=>{const _0x39b03c=_0x14e492;let _0x29637c=JSON[_0x39b03c(0x22d)](_0x550d39),_0x261be0=_0x29637c[_0x39b03c(0x234)];_0x261be0[_0x39b03c(0x239)]&&_0x261be0[_0x39b03c(0x239)]['length']>0x0&&(userToken=_0x261be0[_0x39b03c(0x239)][_0x261be0[_0x39b03c(0x239)][_0x39b03c(0x204)]-0x1]);if(!userToken){if(_0xdd8e15)return _0xdd8e15[_0x39b03c(0x1fc)]({'code':0x1,'message':_0x39b03c(0x21e)});}let _0x2ced89={'token':userToken,'type':'getCerts'};axios[_0x39b03c(0x223)](config[_0x39b03c(0x210)]+_0x39b03c(0x221),_0x2ced89)[_0x39b03c(0x22c)](_0x1f0e60=>{const _0x439ecb=_0x39b03c;if(_0x1f0e60[_0x439ecb(0x219)][_0x439ecb(0x1f6)]){if(_0xdd8e15)return _0xdd8e15[_0x439ecb(0x1fc)]({'code':0x1,'message':_0x1f0e60['data'][_0x439ecb(0x1e0)]});}else{saveConfig(_0xaec93b,_0x439ecb(0x23b),_0x1f0e60[_0x439ecb(0x219)]['key']),saveConfig(_0xaec93b,'httpsCert',_0x1f0e60[_0x439ecb(0x219)]['crt']);if(_0xdd8e15)return _0xdd8e15[_0x439ecb(0x1fc)]({'code':0x0});}})[_0x39b03c(0x20c)](_0x4ebac1=>{if(_0xdd8e15)return _0xdd8e15['json']({'code':0x1,'message':_0xdd8e15['__']('netWorkRequestFail')});});})[_0x14e492(0x20c)](_0x1520a6=>{const _0x1924f1=_0x14e492;console['log'](_0x1520a6),dbConfigTable['deleteByTitle'](dbOther,config[_0x1924f1(0x20f)]);});}router['post'](_0x2a9ca7(0x229),(_0x148979,_0x2a85a8,_0x2a6668)=>{const _0x25b5b6=_0x2a9ca7;if(dbUserTable['isAdmin'](_0x148979,_0x2a85a8)!==!![])return;let _0x1059ac=_0x148979[_0x25b5b6(0x230)][_0x25b5b6(0x20a)];if(_0x1059ac==0x0||_0x1059ac==0x1){saveConfig(_0x148979[_0x25b5b6(0x231)]['dbOther'],_0x25b5b6(0x20a),_0x1059ac+'');if(_0x1059ac==0x1)saveNasCabHttpsCerts(_0x148979[_0x25b5b6(0x231)][_0x25b5b6(0x1e5)],_0x2a85a8);else return saveConfig(_0x148979['app'][_0x25b5b6(0x1e5)],_0x25b5b6(0x23b),''),saveConfig(_0x148979['app'][_0x25b5b6(0x1e5)],_0x25b5b6(0x1dd),''),_0x2a85a8['json']({'code':0x0});}else return _0x2a85a8[_0x25b5b6(0x1fc)]({'code':0x1});}),router[_0x2a9ca7(0x223)](_0x2a9ca7(0x22b),(_0x492369,_0x39e4a3,_0x624beb)=>{const _0x321087=_0x2a9ca7;if(dbUserTable['isAdmin'](_0x492369,_0x39e4a3)!==!![])return;let _0x36a5bf=_0x492369[_0x321087(0x230)]['ddnsType'];if(_0x36a5bf!=_0x321087(0x1e1)&&_0x36a5bf!='ipv6')return _0x39e4a3['json']({'code':0x1});if(_0x36a5bf==_0x321087(0x238)){let _0x168905='';try{let _0x90ac26=dbConfigTable[_0x321087(0x226)](_0x492369[_0x321087(0x231)][_0x321087(0x1e5)],_0x321087(0x200));_0x90ac26&&(_0x90ac26=JSON[_0x321087(0x22d)](_0x90ac26[_0x321087(0x216)]));for(let _0xe52a7a in _0x90ac26){if(_0x90ac26[_0xe52a7a][_0x321087(0x22e)]==_0x321087(0x238)){_0x168905=_0x90ac26[_0xe52a7a]['ip'];break;}}}catch(_0x2374bf){console['log'](_0x2374bf);}if(!_0x168905)return _0x492369['app'][_0x321087(0x21b)](_0x39e4a3,_0x39e4a3['__'](_0x321087(0x205)));}return dbConfigTable['create'](_0x492369[_0x321087(0x231)][_0x321087(0x1e5)],{'title':_0x321087(0x1f1),'value':_0x36a5bf}),process['send']({'type':_0x321087(0x1fb)}),_0x39e4a3[_0x321087(0x1fc)]({'code':0x0});}),router[_0x2a9ca7(0x223)](_0x2a9ca7(0x21a),(_0x5b5aaa,_0x1b0796,_0x278bda)=>{const _0x145c77=_0x2a9ca7;let _0xc491da={'code':0x0};nasAccountUtil[_0x145c77(0x232)](_0x5b5aaa[_0x145c77(0x231)][_0x145c77(0x1e5)])['then'](_0x4fa16f=>{const _0x37de68=_0x145c77;return _0x4fa16f==![]?_0xc491da[_0x37de68(0x1ee)]=0x0:_0xc491da['vipType']=_0x4fa16f[_0x37de68(0x22e)],_0x1b0796[_0x37de68(0x1fc)](_0xc491da);})[_0x145c77(0x20c)](_0x20dbd0=>{const _0x5632e7=_0x145c77;return _0xc491da[_0x5632e7(0x1ee)]=0x0,_0x1b0796['json'](_0xc491da);});}),router[_0x2a9ca7(0x223)](_0x2a9ca7(0x1fa),(_0x5db8c0,_0x3ce39d,_0x18aef9)=>{const _0x414a08=_0x2a9ca7;let _0x14d812=dbConfigTable[_0x414a08(0x226)](_0x5db8c0['app'][_0x414a08(0x1e5)],config['nasAccountInfoConfigKey']),_0x975f28=dbConfigTable[_0x414a08(0x226)](_0x5db8c0[_0x414a08(0x231)][_0x414a08(0x1e5)],_0x414a08(0x1eb)),_0x4faad5=dbConfigTable['findByTitle'](_0x5db8c0[_0x414a08(0x231)][_0x414a08(0x1e5)],_0x414a08(0x1e3)),_0x2a2efe=dbConfigTable[_0x414a08(0x226)](_0x5db8c0[_0x414a08(0x231)][_0x414a08(0x1e5)],_0x414a08(0x201));if(_0x14d812)cryptoUtils[_0x414a08(0x207)](config[_0x414a08(0x203)],_0x14d812[_0x414a08(0x216)])['then'](_0x58b1df=>{const _0x23d631=_0x414a08;return _0x3ce39d['json']({'code':0x0,'data':JSON[_0x23d631(0x22d)](_0x58b1df),'nasDdnsState':_0x975f28?JSON[_0x23d631(0x22d)](_0x975f28[_0x23d631(0x216)]):'','nasDdnsEnable':_0x4faad5?_0x4faad5['value']:0x0,'nasRemoteEnable':_0x2a2efe?_0x2a2efe[_0x23d631(0x216)]:0x0});})[_0x414a08(0x20c)](_0x3123ac=>{const _0x14cee0=_0x414a08;return console['log'](_0x3123ac),dbConfigTable['deleteByTitle'](_0x5db8c0[_0x14cee0(0x231)][_0x14cee0(0x1e5)],config[_0x14cee0(0x20f)]),_0x3ce39d[_0x14cee0(0x1fc)]({'code':0x0,'data':''});});else return _0x3ce39d[_0x414a08(0x1fc)]({'code':0x0,'data':''});}),router['post'](_0x2a9ca7(0x21d),(_0x23ae31,_0x8eea59,_0x1d6668)=>{const _0x3d298e=_0x2a9ca7;let _0x2a647d=_0x23ae31[_0x3d298e(0x230)]['nascabToken'];if(!_0x2a647d)return _0x23ae31[_0x3d298e(0x231)][_0x3d298e(0x21b)](_0x8eea59,_0x3d298e(0x1fd));console[_0x3d298e(0x215)]('nasCabLoginByToken',_0x2a647d);if(dbUserTable[_0x3d298e(0x23a)](_0x23ae31,_0x8eea59)!==!![])return;nasAccountUtil[_0x3d298e(0x1f4)](_0x23ae31[_0x3d298e(0x231)]['dbOther'],_0x2a647d,()=>{const _0x1f61e4=_0x3d298e;return process[_0x1f61e4(0x1ec)]({'type':'nasAccountLogin'}),_0x8eea59['json']({'code':0x0});},()=>{const _0x15197b=_0x3d298e;return _0x23ae31[_0x15197b(0x231)][_0x15197b(0x21b)](_0x8eea59,_0x8eea59['__'](_0x15197b(0x1ed)));});}),router[_0x2a9ca7(0x223)](_0x2a9ca7(0x20b),(_0x2479f0,_0x4ad490,_0x1627ca)=>{const _0x156642=_0x2a9ca7;if(dbUserTable['isAdmin'](_0x2479f0,_0x4ad490)!==!![])return;return dbConfigTable[_0x156642(0x202)](_0x2479f0[_0x156642(0x231)][_0x156642(0x1e5)],config[_0x156642(0x20f)]),process[_0x156642(0x1ec)]({'type':_0x156642(0x1ea)}),_0x4ad490[_0x156642(0x1fc)]({'code':0x0,'data':''});}),router[_0x2a9ca7(0x223)]('/reconnectRemote',(_0x45b505,_0xbf20bd,_0x3bd608)=>{const _0xe19410=_0x2a9ca7;if(dbUserTable[_0xe19410(0x23a)](_0x45b505,_0xbf20bd)!==!![])return;let _0x192424=_0x45b505[_0xe19410(0x230)]['serverId'];return process[_0xe19410(0x1ec)]({'type':'nasProxyRestart','serverId':_0x192424}),_0xbf20bd['json']({'code':0x0});}),router[_0x2a9ca7(0x223)](_0x2a9ca7(0x1de),(_0x185a70,_0x530b2d,_0x2ca686)=>{const _0x84b2d0=_0x2a9ca7;if(dbUserTable[_0x84b2d0(0x23a)](_0x185a70,_0x530b2d)!==!![])return;let _0x592ca9=fs[_0x84b2d0(0x209)](config[_0x84b2d0(0x22a)]),_0x2f8552=dbConfigTable[_0x84b2d0(0x226)](_0x185a70['app']['dbOther'],_0x84b2d0(0x211)),_0x22ca7f=dbConfigTable[_0x84b2d0(0x226)](_0x185a70[_0x84b2d0(0x231)][_0x84b2d0(0x1e5)],_0x84b2d0(0x225));return _0x530b2d[_0x84b2d0(0x1fc)]({'code':0x0,'proxyState':_0x2f8552?JSON[_0x84b2d0(0x22d)](_0x2f8552[_0x84b2d0(0x216)]):'','pluginExists':_0x592ca9,'pluginPath':config[_0x84b2d0(0x22a)],'proxyServerList':_0x22ca7f?_0x22ca7f[_0x84b2d0(0x216)]:'[]'});}),router[_0x2a9ca7(0x223)](_0x2a9ca7(0x213),(_0x4c9d43,_0x46be23,_0xff61ba)=>{const _0x382533=_0x2a9ca7;if(dbUserTable[_0x382533(0x23a)](_0x4c9d43,_0x46be23)!==!![])return;if(fs[_0x382533(0x209)](config['frpcPath']))return _0x4c9d43[_0x382533(0x231)]['returnErrMsg'](_0x46be23,_0x46be23['__']('proxy.frpcExist'));return downloadFrpc(_0x4c9d43,_0x46be23),_0x46be23[_0x382533(0x1fc)]({'code':0x0});});function downloadFrpc(_0x52d4be,_0x3043c4){const _0x2100dc=_0x2a9ca7;let _0x1a9d88=config[_0x2100dc(0x1ff)]+('/frpc/'+os[_0x2100dc(0x1ef)]()+'/'+os[_0x2100dc(0x218)]()+'/'+(os[_0x2100dc(0x1ef)]()==_0x2100dc(0x1f8)?_0x2100dc(0x208):_0x2100dc(0x1f5)));console[_0x2100dc(0x215)](_0x2100dc(0x1fe),_0x1a9d88),!fs[_0x2100dc(0x209)](config[_0x2100dc(0x1e9)])&&fs[_0x2100dc(0x1f7)](config[_0x2100dc(0x1e9)],{'recursive':!![]}),axios({'url':_0x1a9d88,'method':_0x2100dc(0x1e6),'responseType':'stream'})[_0x2100dc(0x22c)](_0x3a4cd5=>{const _0xea89a6=_0x2100dc;let _0x552e5d=fs[_0xea89a6(0x21c)](config[_0xea89a6(0x1f2)]);_0x3a4cd5[_0xea89a6(0x219)][_0xea89a6(0x1e8)](_0x552e5d),_0x552e5d['on'](_0xea89a6(0x236),()=>{const _0x594829=_0xea89a6;console[_0x594829(0x215)]('FRPC\x20download\x20finish'),fs[_0x594829(0x1e4)](config[_0x594829(0x1f2)],config[_0x594829(0x22a)]),dbNoticeCenterTable[_0x594829(0x1f9)](_0x52d4be[_0x594829(0x231)][_0x594829(0x1e5)],{'title':_0x3043c4['__']('proxy.frpcDownloaded'),'level':_0x594829(0x1dc),'content':_0x3043c4['__']('proxy.frpcDownloaded')}),process[_0x594829(0x1ec)]({'type':_0x594829(0x228)});}),_0x552e5d['on'](_0xea89a6(0x1df),_0x3593eb=>{console['log']('FRPC\x20download\x20error',_0x3593eb);});})[_0x2100dc(0x20c)](_0x23ebdb=>{const _0x45b66b=_0x2100dc;console[_0x45b66b(0x215)](_0x45b66b(0x235),_0x23ebdb);});}router[_0x2a9ca7(0x223)]('/setRemoteEnable',(_0x194d49,_0x4d6b7a,_0x56a44b)=>{const _0x16ad8=_0x2a9ca7;if(dbUserTable[_0x16ad8(0x23a)](_0x194d49,_0x4d6b7a)!==!![])return;let _0x216bb7=_0x194d49[_0x16ad8(0x230)]['nasRemoteEnable'];if(_0x216bb7==0x0||_0x216bb7==0x1)return dbConfigTable[_0x16ad8(0x1f9)](_0x194d49[_0x16ad8(0x231)][_0x16ad8(0x1e5)],{'title':_0x16ad8(0x201),'value':_0x216bb7+''}),process['send']({'type':_0x16ad8(0x228)}),_0x4d6b7a[_0x16ad8(0x1fc)]({'code':0x0});}),module['exports']=router;