const _0x5a161b=_0x57ea;(function(_0xd9ee1b,_0x867fa7){const _0x2a8f2f=_0x57ea,_0x28eb97=_0xd9ee1b();while(!![]){try{const _0x441243=-parseInt(_0x2a8f2f(0xfd))/0x1+-parseInt(_0x2a8f2f(0x115))/0x2*(parseInt(_0x2a8f2f(0x132))/0x3)+parseInt(_0x2a8f2f(0x11e))/0x4+-parseInt(_0x2a8f2f(0x10b))/0x5+-parseInt(_0x2a8f2f(0x106))/0x6*(parseInt(_0x2a8f2f(0x11a))/0x7)+-parseInt(_0x2a8f2f(0x138))/0x8+-parseInt(_0x2a8f2f(0x122))/0x9*(-parseInt(_0x2a8f2f(0x144))/0xa);if(_0x441243===_0x867fa7)break;else _0x28eb97['push'](_0x28eb97['shift']());}catch(_0x1df79a){_0x28eb97['push'](_0x28eb97['shift']());}}}(_0x2197,0x890d5));var express=require(_0x5a161b(0x142)),router=express[_0x5a161b(0x14b)]();function _0x2197(){const _0x1ec3c5=['token','6213520tNThaW','loginFailedTryLater','length','httpsCert','ddnsType','nasDdnsEnable','/setDdnsType','mkdirSync','ipv4','Downloading','express','/getProxyState','20KWNdqG','globalIpList','exports','../../db/dbUserTable','parse','frpcFolder','send','Router','crt','ddns','proxy.frpcExist','nasProxyRestart','netWorkRequestFail','renameSync','ipv6','/getDDNSState','arch','nasRemoteEnable','serverId','isAdmin','../../db/dbConfigTable','/nasCabLogout','createWriteStream','../../db/dbNoticeCenterTable','vipType','Params\x20invalid','frpcTempPath','dbOther','../utils/nasAccountUtils','stream','deleteByTitle','22750YXQuhJ','json','nasCabLoginByToken','proxyServerList','/setRemoteEnable','data','../../myConfig/config','win32','getVipInfo','285834DYQgPq','then','value','catch','/setDdnsEnable','396060OPfZxv','frpc','findByTitle','useNasCabCerts','nasCabLogout','nasAccountLogin','create','loginByToken','proxy.frpcDownloaded','body','14DTrgAR','nasAccountInfoConfigKey','decryptString','app','log','140OuLOIz','/reconnectRemote','/getVipInfo','../utils/cryptoUtils','3067448QfDkBb','apiBaseUrl','returnErrMsg','nasAccountInfoPwd','9499122BHKCdD','nasDdnsState','httpsKey','frpcPath','key','frpc.exe','type','existsSync','nasDdnsRestart','FRPC\x20download\x20error','platform','post','userInfo','msg','downloadUrl','FRPC\x20download\x20finish','207849ToESgy','finish','info','NasCab\x20account\x20not\x20found','path'];_0x2197=function(){return _0x1ec3c5;};return _0x2197();}let config=require(_0x5a161b(0x103)),dbConfigTable=require(_0x5a161b(0x158)),dbNoticeCenterTable=require(_0x5a161b(0x15b)),path=require(_0x5a161b(0x136)),cryptoUtils=require(_0x5a161b(0x11d)),nasAccountUtil=require(_0x5a161b(0xfa));const dbUserTable=require(_0x5a161b(0x147)),fs=require('fs');let axios=require('axios');const os=require('os');function _0x57ea(_0x18b1db,_0x4b5d7f){const _0x21978f=_0x2197();return _0x57ea=function(_0x57ea66,_0x439a7c){_0x57ea66=_0x57ea66-0xfa;let _0x14fbf0=_0x21978f[_0x57ea66];return _0x14fbf0;},_0x57ea(_0x18b1db,_0x4b5d7f);}router['post'](_0x5a161b(0x153),(_0x3c87ae,_0x2816cb,_0x3538dd)=>{const _0x381dc8=_0x5a161b;if(dbUserTable[_0x381dc8(0x157)](_0x3c87ae,_0x2816cb)!==!![])return;let _0x10d334=dbConfigTable['findByTitle'](_0x3c87ae[_0x381dc8(0x118)][_0x381dc8(0x15f)],_0x381dc8(0x123));return _0x2816cb['json']({'code':0x0,'ddnsState':_0x10d334?JSON[_0x381dc8(0x148)](_0x10d334[_0x381dc8(0x108)]):''});}),router[_0x5a161b(0x12d)](_0x5a161b(0x10a),(_0x4650ad,_0x20305c,_0x556eaa)=>{const _0x5dddb5=_0x5a161b;if(dbUserTable[_0x5dddb5(0x157)](_0x4650ad,_0x20305c)!==!![])return;let _0xfc8eb3=_0x4650ad[_0x5dddb5(0x114)][_0x5dddb5(0x13d)];if(_0xfc8eb3==0x0||_0xfc8eb3==0x1)return dbConfigTable[_0x5dddb5(0x111)](_0x4650ad['app']['dbOther'],{'title':_0x5dddb5(0x13d),'value':_0xfc8eb3+''}),process[_0x5dddb5(0x14a)]({'type':_0x5dddb5(0x12a)}),_0x20305c[_0x5dddb5(0xfe)]({'code':0x0});});function saveConfig(_0x4af0ce,_0x1d30ac,_0x5c7c23){const _0x34ebf8=_0x5a161b;dbConfigTable[_0x34ebf8(0x111)](_0x4af0ce,{'title':_0x1d30ac,'value':_0x5c7c23+''});}function saveNasCabHttpsCerts(_0x59914f,_0x359cfe){const _0x1cd912=_0x5a161b;let _0x4138db=dbConfigTable['findByTitle'](_0x59914f,config[_0x1cd912(0x116)]);if(!_0x4138db){if(_0x359cfe)return _0x359cfe[_0x1cd912(0xfe)]({'code':0x1,'message':_0x1cd912(0x135)});}cryptoUtils['decryptString'](config['nasAccountInfoPwd'],_0x4138db[_0x1cd912(0x108)])[_0x1cd912(0x107)](_0xc1e28e=>{const _0x518c05=_0x1cd912;let _0x35d6d0=JSON[_0x518c05(0x148)](_0xc1e28e),_0x274339=_0x35d6d0[_0x518c05(0x12e)];_0x274339[_0x518c05(0x137)]&&_0x274339[_0x518c05(0x137)][_0x518c05(0x13a)]>0x0&&(userToken=_0x274339[_0x518c05(0x137)][_0x274339['token']['length']-0x1]);if(!userToken){if(_0x359cfe)return _0x359cfe[_0x518c05(0xfe)]({'code':0x1,'message':_0x518c05(0x135)});}let _0x29cec1={'token':userToken,'type':'getCerts'};axios[_0x518c05(0x12d)](config[_0x518c05(0x11f)]+_0x518c05(0x14d),_0x29cec1)['then'](_0x1509b6=>{const _0x46e700=_0x518c05;if(_0x1509b6[_0x46e700(0x102)]['code']){if(_0x359cfe)return _0x359cfe['json']({'code':0x1,'message':_0x1509b6[_0x46e700(0x102)][_0x46e700(0x12f)]});}else{saveConfig(_0x59914f,_0x46e700(0x124),_0x1509b6['data'][_0x46e700(0x126)]),saveConfig(_0x59914f,_0x46e700(0x13b),_0x1509b6['data'][_0x46e700(0x14c)]);if(_0x359cfe)return _0x359cfe['json']({'code':0x0});}})[_0x518c05(0x109)](_0x467758=>{const _0x3fc9a4=_0x518c05;if(_0x359cfe)return _0x359cfe[_0x3fc9a4(0xfe)]({'code':0x1,'message':_0x359cfe['__'](_0x3fc9a4(0x150))});});})['catch'](_0x1bb7f7=>{const _0x266c0e=_0x1cd912;console[_0x266c0e(0x119)](_0x1bb7f7),dbConfigTable[_0x266c0e(0xfc)](dbOther,config[_0x266c0e(0x116)]);});}router[_0x5a161b(0x12d)]('/setUseNasCabCert',(_0x5dc9ef,_0x1e7c05,_0x34db6a)=>{const _0xaa6d8f=_0x5a161b;if(dbUserTable[_0xaa6d8f(0x157)](_0x5dc9ef,_0x1e7c05)!==!![])return;let _0x7f5020=_0x5dc9ef[_0xaa6d8f(0x114)][_0xaa6d8f(0x10e)];if(_0x7f5020==0x0||_0x7f5020==0x1){saveConfig(_0x5dc9ef[_0xaa6d8f(0x118)]['dbOther'],'useNasCabCerts',_0x7f5020+'');if(_0x7f5020==0x1)saveNasCabHttpsCerts(_0x5dc9ef[_0xaa6d8f(0x118)][_0xaa6d8f(0x15f)],_0x1e7c05);else return saveConfig(_0x5dc9ef[_0xaa6d8f(0x118)][_0xaa6d8f(0x15f)],_0xaa6d8f(0x124),''),saveConfig(_0x5dc9ef[_0xaa6d8f(0x118)][_0xaa6d8f(0x15f)],_0xaa6d8f(0x13b),''),_0x1e7c05[_0xaa6d8f(0xfe)]({'code':0x0});}else return _0x1e7c05[_0xaa6d8f(0xfe)]({'code':0x1});}),router['post'](_0x5a161b(0x13e),(_0x4d34e8,_0x59904a,_0x1890ff)=>{const _0x69f0e3=_0x5a161b;if(dbUserTable[_0x69f0e3(0x157)](_0x4d34e8,_0x59904a)!==!![])return;let _0x3fcadb=_0x4d34e8['body'][_0x69f0e3(0x13c)];if(_0x3fcadb!=_0x69f0e3(0x140)&&_0x3fcadb!=_0x69f0e3(0x152))return _0x59904a[_0x69f0e3(0xfe)]({'code':0x1});if(_0x3fcadb==_0x69f0e3(0x152)){let _0x1222f4='';try{let _0x53c8f5=dbConfigTable[_0x69f0e3(0x10d)](_0x4d34e8['app'][_0x69f0e3(0x15f)],_0x69f0e3(0x145));_0x53c8f5&&(_0x53c8f5=JSON['parse'](_0x53c8f5[_0x69f0e3(0x108)]));for(let _0x4f151d in _0x53c8f5){if(_0x53c8f5[_0x4f151d]['type']==_0x69f0e3(0x152)){_0x1222f4=_0x53c8f5[_0x4f151d]['ip'];break;}}}catch(_0x42c7ca){console[_0x69f0e3(0x119)](_0x42c7ca);}if(!_0x1222f4)return _0x4d34e8[_0x69f0e3(0x118)][_0x69f0e3(0x120)](_0x59904a,_0x59904a['__']('ipv6addressNotFound'));}return dbConfigTable[_0x69f0e3(0x111)](_0x4d34e8[_0x69f0e3(0x118)][_0x69f0e3(0x15f)],{'title':_0x69f0e3(0x13c),'value':_0x3fcadb}),process[_0x69f0e3(0x14a)]({'type':'nasDdnsRestart'}),_0x59904a[_0x69f0e3(0xfe)]({'code':0x0});}),router[_0x5a161b(0x12d)](_0x5a161b(0x11c),(_0x85e534,_0x19ab6d,_0x36cdb7)=>{const _0x58ac7f=_0x5a161b;let _0x26c2f5={'code':0x0};nasAccountUtil[_0x58ac7f(0x105)](_0x85e534['app'][_0x58ac7f(0x15f)])[_0x58ac7f(0x107)](_0x4a7fe7=>{const _0x34f44f=_0x58ac7f;return _0x4a7fe7==![]?_0x26c2f5['vipType']=0x0:_0x26c2f5['vipType']=_0x4a7fe7[_0x34f44f(0x128)],_0x19ab6d[_0x34f44f(0xfe)](_0x26c2f5);})[_0x58ac7f(0x109)](_0x481bff=>{const _0x2c610c=_0x58ac7f;return _0x26c2f5[_0x2c610c(0x15c)]=0x0,_0x19ab6d[_0x2c610c(0xfe)](_0x26c2f5);});}),router[_0x5a161b(0x12d)]('/getNasAccountInfo',(_0x5ca5ef,_0x211b84,_0x235bc2)=>{const _0x4fcbde=_0x5a161b;let _0x630236=dbConfigTable[_0x4fcbde(0x10d)](_0x5ca5ef['app'][_0x4fcbde(0x15f)],config['nasAccountInfoConfigKey']),_0x215528=dbConfigTable[_0x4fcbde(0x10d)](_0x5ca5ef['app'][_0x4fcbde(0x15f)],_0x4fcbde(0x123)),_0x4aa7f2=dbConfigTable[_0x4fcbde(0x10d)](_0x5ca5ef['app'][_0x4fcbde(0x15f)],_0x4fcbde(0x13d)),_0xf6d3e6=dbConfigTable[_0x4fcbde(0x10d)](_0x5ca5ef['app']['dbOther'],_0x4fcbde(0x155));if(_0x630236)cryptoUtils[_0x4fcbde(0x117)](config[_0x4fcbde(0x121)],_0x630236[_0x4fcbde(0x108)])['then'](_0x51db9e=>{const _0x3c7a99=_0x4fcbde;return _0x211b84['json']({'code':0x0,'data':JSON[_0x3c7a99(0x148)](_0x51db9e),'nasDdnsState':_0x215528?JSON[_0x3c7a99(0x148)](_0x215528[_0x3c7a99(0x108)]):'','nasDdnsEnable':_0x4aa7f2?_0x4aa7f2['value']:0x0,'nasRemoteEnable':_0xf6d3e6?_0xf6d3e6[_0x3c7a99(0x108)]:0x0});})[_0x4fcbde(0x109)](_0x899768=>{const _0x368f0c=_0x4fcbde;return console['log'](_0x899768),dbConfigTable[_0x368f0c(0xfc)](_0x5ca5ef[_0x368f0c(0x118)]['dbOther'],config['nasAccountInfoConfigKey']),_0x211b84['json']({'code':0x0,'data':''});});else return _0x211b84[_0x4fcbde(0xfe)]({'code':0x0,'data':''});}),router[_0x5a161b(0x12d)]('/nasCabLoginByToken',(_0x120024,_0xc0bf2e,_0x56cfb5)=>{const _0x4cc8e1=_0x5a161b;let _0x923fc0=_0x120024[_0x4cc8e1(0x114)]['nascabToken'];if(!_0x923fc0)return _0x120024['app'][_0x4cc8e1(0x120)](_0xc0bf2e,_0x4cc8e1(0x15d));console[_0x4cc8e1(0x119)](_0x4cc8e1(0xff),_0x923fc0);if(dbUserTable[_0x4cc8e1(0x157)](_0x120024,_0xc0bf2e)!==!![])return;nasAccountUtil[_0x4cc8e1(0x112)](_0x120024[_0x4cc8e1(0x118)][_0x4cc8e1(0x15f)],_0x923fc0,()=>{const _0x35d27f=_0x4cc8e1;return process['send']({'type':_0x35d27f(0x110)}),_0xc0bf2e[_0x35d27f(0xfe)]({'code':0x0});},()=>{const _0x45b313=_0x4cc8e1;return _0x120024[_0x45b313(0x118)][_0x45b313(0x120)](_0xc0bf2e,_0xc0bf2e['__'](_0x45b313(0x139)));});}),router[_0x5a161b(0x12d)](_0x5a161b(0x159),(_0x251c19,_0xfdd1b0,_0x2579cd)=>{const _0x3e5850=_0x5a161b;if(dbUserTable[_0x3e5850(0x157)](_0x251c19,_0xfdd1b0)!==!![])return;return dbConfigTable[_0x3e5850(0xfc)](_0x251c19['app']['dbOther'],config[_0x3e5850(0x116)]),process[_0x3e5850(0x14a)]({'type':_0x3e5850(0x10f)}),_0xfdd1b0['json']({'code':0x0,'data':''});}),router[_0x5a161b(0x12d)](_0x5a161b(0x11b),(_0x312d78,_0x26d6f2,_0x492082)=>{const _0x5add87=_0x5a161b;if(dbUserTable[_0x5add87(0x157)](_0x312d78,_0x26d6f2)!==!![])return;let _0x59e52f=_0x312d78['body'][_0x5add87(0x156)];return process[_0x5add87(0x14a)]({'type':_0x5add87(0x14f),'serverId':_0x59e52f}),_0x26d6f2[_0x5add87(0xfe)]({'code':0x0});}),router['post'](_0x5a161b(0x143),(_0x3f5e03,_0x572128,_0x105d82)=>{const _0x523538=_0x5a161b;if(dbUserTable[_0x523538(0x157)](_0x3f5e03,_0x572128)!==!![])return;let _0x41d4a6=fs[_0x523538(0x129)](config[_0x523538(0x125)]),_0x948f76=dbConfigTable[_0x523538(0x10d)](_0x3f5e03[_0x523538(0x118)]['dbOther'],'nasRemoteState'),_0x3fc835=dbConfigTable[_0x523538(0x10d)](_0x3f5e03['app'][_0x523538(0x15f)],_0x523538(0x100));return _0x572128['json']({'code':0x0,'proxyState':_0x948f76?JSON['parse'](_0x948f76[_0x523538(0x108)]):'','pluginExists':_0x41d4a6,'pluginPath':config[_0x523538(0x125)],'proxyServerList':_0x3fc835?_0x3fc835['value']:'[]'});}),router[_0x5a161b(0x12d)]('/downloadFrpc',(_0x91a1d3,_0x360450,_0xfeac2d)=>{const _0x2b4cce=_0x5a161b;if(dbUserTable['isAdmin'](_0x91a1d3,_0x360450)!==!![])return;if(fs[_0x2b4cce(0x129)](config[_0x2b4cce(0x125)]))return _0x91a1d3[_0x2b4cce(0x118)][_0x2b4cce(0x120)](_0x360450,_0x360450['__'](_0x2b4cce(0x14e)));return downloadFrpc(_0x91a1d3,_0x360450),_0x360450['json']({'code':0x0});});function downloadFrpc(_0x119e28,_0x2bc1ca){const _0x314e15=_0x5a161b;let _0x1a0f76=config[_0x314e15(0x130)]+('/frpc/'+os['platform']()+'/'+os[_0x314e15(0x154)]()+'/'+(os[_0x314e15(0x12c)]()==_0x314e15(0x104)?_0x314e15(0x127):_0x314e15(0x10c)));console[_0x314e15(0x119)](_0x314e15(0x141),_0x1a0f76),!fs['existsSync'](config[_0x314e15(0x149)])&&fs[_0x314e15(0x13f)](config[_0x314e15(0x149)],{'recursive':!![]}),axios({'url':_0x1a0f76,'method':'GET','responseType':_0x314e15(0xfb)})[_0x314e15(0x107)](_0x399cef=>{const _0x463ad2=_0x314e15;let _0x1a25ed=fs[_0x463ad2(0x15a)](config['frpcTempPath']);_0x399cef['data']['pipe'](_0x1a25ed),_0x1a25ed['on'](_0x463ad2(0x133),()=>{const _0x5e75f0=_0x463ad2;console['log'](_0x5e75f0(0x131)),fs[_0x5e75f0(0x151)](config[_0x5e75f0(0x15e)],config[_0x5e75f0(0x125)]),dbNoticeCenterTable[_0x5e75f0(0x111)](_0x119e28[_0x5e75f0(0x118)][_0x5e75f0(0x15f)],{'title':_0x2bc1ca['__'](_0x5e75f0(0x113)),'level':_0x5e75f0(0x134),'content':_0x2bc1ca['__'](_0x5e75f0(0x113))}),process['send']({'type':'nasProxyRestart'});}),_0x1a25ed['on']('error',_0x53204e=>{const _0xf7f628=_0x463ad2;console[_0xf7f628(0x119)](_0xf7f628(0x12b),_0x53204e);});})[_0x314e15(0x109)](_0x27da5b=>{const _0x1237ec=_0x314e15;console[_0x1237ec(0x119)]('FRPC\x20download\x20exception',_0x27da5b);});}router['post'](_0x5a161b(0x101),(_0xc54a15,_0x5ca52b,_0x28f450)=>{const _0x75587b=_0x5a161b;if(dbUserTable[_0x75587b(0x157)](_0xc54a15,_0x5ca52b)!==!![])return;let _0x51b0e3=_0xc54a15['body'][_0x75587b(0x155)];if(_0x51b0e3==0x0||_0x51b0e3==0x1)return dbConfigTable[_0x75587b(0x111)](_0xc54a15[_0x75587b(0x118)][_0x75587b(0x15f)],{'title':_0x75587b(0x155),'value':_0x51b0e3+''}),process[_0x75587b(0x14a)]({'type':'nasProxyRestart'}),_0x5ca52b[_0x75587b(0xfe)]({'code':0x0});}),module[_0x5a161b(0x146)]=router;