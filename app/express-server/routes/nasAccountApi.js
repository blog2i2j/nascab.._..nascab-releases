const _0x1cfe6a=_0xc4fd;(function(_0xa82505,_0x2e1676){const _0x3b0fea=_0xc4fd,_0x39f4a1=_0xa82505();while(!![]){try{const _0x46e037=parseInt(_0x3b0fea(0x1a7))/0x1+parseInt(_0x3b0fea(0x1b1))/0x2+parseInt(_0x3b0fea(0x1c3))/0x3+parseInt(_0x3b0fea(0x19b))/0x4*(parseInt(_0x3b0fea(0x1a4))/0x5)+-parseInt(_0x3b0fea(0x1ad))/0x6+parseInt(_0x3b0fea(0x1a0))/0x7+parseInt(_0x3b0fea(0x1e2))/0x8*(-parseInt(_0x3b0fea(0x1c1))/0x9);if(_0x46e037===_0x2e1676)break;else _0x39f4a1['push'](_0x39f4a1['shift']());}catch(_0x5bb4d9){_0x39f4a1['push'](_0x39f4a1['shift']());}}}(_0x50db,0x2ee8b));var express=require(_0x1cfe6a(0x1cd)),router=express['Router']();let config=require(_0x1cfe6a(0x1a8)),dbConfigTable=require(_0x1cfe6a(0x1e8)),dbNoticeCenterTable=require(_0x1cfe6a(0x194)),path=require(_0x1cfe6a(0x1b2)),cryptoUtils=require(_0x1cfe6a(0x1d0)),nasAccountUtil=require(_0x1cfe6a(0x1bb));const dbUserTable=require(_0x1cfe6a(0x1ed)),fs=require('fs');let axios=require(_0x1cfe6a(0x1b3));const os=require('os');router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1dc),(_0x3ad023,_0x4a1a58,_0x1a9b2e)=>{const _0x170281=_0x1cfe6a;if(dbUserTable[_0x170281(0x1d4)](_0x3ad023,_0x4a1a58)!==!![])return;let _0x35a30b=dbConfigTable['findByTitle'](_0x3ad023[_0x170281(0x1a1)][_0x170281(0x1d6)],'nasDdnsState');return _0x4a1a58[_0x170281(0x192)]({'code':0x0,'ddnsState':_0x35a30b?JSON['parse'](_0x35a30b[_0x170281(0x1eb)]):''});}),router['post'](_0x1cfe6a(0x1c7),(_0x3f8e5e,_0x91e66c,_0x24872e)=>{const _0x548fdf=_0x1cfe6a;if(dbUserTable[_0x548fdf(0x1d4)](_0x3f8e5e,_0x91e66c)!==!![])return;let _0x49fc2c=_0x3f8e5e[_0x548fdf(0x1e9)][_0x548fdf(0x1d2)];if(_0x49fc2c==0x0||_0x49fc2c==0x1)return dbConfigTable[_0x548fdf(0x1b0)](_0x3f8e5e[_0x548fdf(0x1a1)]['dbOther'],{'title':_0x548fdf(0x1d2),'value':_0x49fc2c+''}),process[_0x548fdf(0x19f)]({'type':'nasDdnsRestart'}),_0x91e66c[_0x548fdf(0x192)]({'code':0x0});});function saveConfig(_0x3b5a8d,_0x1971c3,_0x1b3b07){const _0x20aced=_0x1cfe6a;dbConfigTable[_0x20aced(0x1b0)](_0x3b5a8d,{'title':_0x1971c3,'value':_0x1b3b07+''});}function saveNasCabHttpsCerts(_0x288dac,_0x886ff2){const _0x1124c6=_0x1cfe6a;let _0x1b7ad0=dbConfigTable[_0x1124c6(0x1b6)](_0x288dac,config[_0x1124c6(0x1e1)]);if(!_0x1b7ad0){if(_0x886ff2)return _0x886ff2['json']({'code':0x1,'message':_0x1124c6(0x1d3)});}cryptoUtils[_0x1124c6(0x1b5)](config[_0x1124c6(0x1dd)],_0x1b7ad0[_0x1124c6(0x1eb)])[_0x1124c6(0x198)](_0x3d82b0=>{const _0x513149=_0x1124c6;let _0x57e065=JSON['parse'](_0x3d82b0),_0x3c4db1=_0x57e065[_0x513149(0x1aa)];_0x3c4db1[_0x513149(0x1b7)]&&_0x3c4db1[_0x513149(0x1b7)][_0x513149(0x19a)]>0x0&&(userToken=_0x3c4db1['token'][_0x3c4db1[_0x513149(0x1b7)][_0x513149(0x19a)]-0x1]);if(!userToken){if(_0x886ff2)return _0x886ff2['json']({'code':0x1,'message':_0x513149(0x1d3)});}let _0x56c64c={'token':userToken,'type':_0x513149(0x1ee)};axios['post'](config[_0x513149(0x19c)]+'ddns',_0x56c64c)['then'](_0x5da44d=>{const _0x46f896=_0x513149;if(_0x5da44d['data']['code']){if(_0x886ff2)return _0x886ff2[_0x46f896(0x192)]({'code':0x1,'message':_0x5da44d[_0x46f896(0x1da)][_0x46f896(0x196)]});}else{saveConfig(_0x288dac,_0x46f896(0x1cb),_0x5da44d[_0x46f896(0x1da)][_0x46f896(0x1b4)]),saveConfig(_0x288dac,_0x46f896(0x191),_0x5da44d['data'][_0x46f896(0x1f0)]);if(_0x886ff2)return _0x886ff2[_0x46f896(0x192)]({'code':0x0});}})['catch'](_0x59e9ac=>{const _0x2fc234=_0x513149;if(_0x886ff2)return _0x886ff2[_0x2fc234(0x192)]({'code':0x1,'message':_0x886ff2['__'](_0x2fc234(0x1bf))});});})['catch'](_0x19e2b4=>{const _0x761791=_0x1124c6;console[_0x761791(0x1a2)](_0x19e2b4),dbConfigTable[_0x761791(0x19d)](dbOther,config['nasAccountInfoConfigKey']);});}router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1de),(_0x240acb,_0x1f2785,_0x1b04d7)=>{const _0x43e932=_0x1cfe6a;if(dbUserTable[_0x43e932(0x1d4)](_0x240acb,_0x1f2785)!==!![])return;let _0x372cac=_0x240acb['body']['useNasCabCerts'];if(_0x372cac==0x0||_0x372cac==0x1){saveConfig(_0x240acb[_0x43e932(0x1a1)][_0x43e932(0x1d6)],_0x43e932(0x1be),_0x372cac+'');if(_0x372cac==0x1)saveNasCabHttpsCerts(_0x240acb['app']['dbOther'],_0x1f2785);else return saveConfig(_0x240acb[_0x43e932(0x1a1)]['dbOther'],'httpsKey',''),saveConfig(_0x240acb[_0x43e932(0x1a1)][_0x43e932(0x1d6)],'httpsCert',''),_0x1f2785[_0x43e932(0x192)]({'code':0x0});}else return _0x1f2785['json']({'code':0x1});}),router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1e6),(_0x16017e,_0x298cde,_0x4d35bf)=>{const _0x353a87=_0x1cfe6a;if(dbUserTable['isAdmin'](_0x16017e,_0x298cde)!==!![])return;let _0xd26413=_0x16017e[_0x353a87(0x1e9)][_0x353a87(0x19e)];if(_0xd26413!='ipv4'&&_0xd26413!=_0x353a87(0x18d))return _0x298cde[_0x353a87(0x192)]({'code':0x1});if(_0xd26413==_0x353a87(0x18d)){let _0xb60957='';try{let _0xae1ad=dbConfigTable['findByTitle'](_0x16017e['app'][_0x353a87(0x1d6)],_0x353a87(0x1d1));_0xae1ad&&(_0xae1ad=JSON[_0x353a87(0x1ac)](_0xae1ad[_0x353a87(0x1eb)]));for(let _0x2c479a in _0xae1ad){if(_0xae1ad[_0x2c479a][_0x353a87(0x1c6)]==_0x353a87(0x18d)){_0xb60957=_0xae1ad[_0x2c479a]['ip'];break;}}}catch(_0x38fe08){console[_0x353a87(0x1a2)](_0x38fe08);}if(!_0xb60957)return _0x16017e[_0x353a87(0x1a1)][_0x353a87(0x1a3)](_0x298cde,_0x298cde['__'](_0x353a87(0x1d7)));}return dbConfigTable[_0x353a87(0x1b0)](_0x16017e[_0x353a87(0x1a1)]['dbOther'],{'title':'ddnsType','value':_0xd26413}),process[_0x353a87(0x19f)]({'type':_0x353a87(0x1e4)}),_0x298cde['json']({'code':0x0});}),router['post']('/getVipInfo',(_0xed015e,_0x42aa4f,_0x2bb535)=>{const _0x299c36=_0x1cfe6a;let _0x2ef821={'code':0x0};nasAccountUtil[_0x299c36(0x1bc)](_0xed015e[_0x299c36(0x1a1)][_0x299c36(0x1d6)])['then'](_0x494779=>{const _0x3722ad=_0x299c36;return _0x494779==![]?_0x2ef821[_0x3722ad(0x1ba)]=0x0:_0x2ef821[_0x3722ad(0x1ba)]=_0x494779['type'],_0x42aa4f[_0x3722ad(0x192)](_0x2ef821);})[_0x299c36(0x197)](_0x9b06fc=>{const _0x183ee0=_0x299c36;return _0x2ef821['vipType']=0x0,_0x42aa4f[_0x183ee0(0x192)](_0x2ef821);});}),router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1ec),(_0x27cc87,_0x366dd3,_0x54a171)=>{const _0x31e376=_0x1cfe6a;let _0x4d78de=dbConfigTable['findByTitle'](_0x27cc87[_0x31e376(0x1a1)][_0x31e376(0x1d6)],config[_0x31e376(0x1e1)]),_0x375b3f=dbConfigTable[_0x31e376(0x1b6)](_0x27cc87['app']['dbOther'],'nasDdnsState'),_0x893597=dbConfigTable[_0x31e376(0x1b6)](_0x27cc87[_0x31e376(0x1a1)][_0x31e376(0x1d6)],_0x31e376(0x1d2)),_0x44875c=dbConfigTable['findByTitle'](_0x27cc87[_0x31e376(0x1a1)][_0x31e376(0x1d6)],'nasRemoteEnable');if(_0x4d78de)cryptoUtils['decryptString'](config['nasAccountInfoPwd'],_0x4d78de['value'])['then'](_0x2577e6=>{const _0x22c641=_0x31e376;return _0x366dd3[_0x22c641(0x192)]({'code':0x0,'data':JSON[_0x22c641(0x1ac)](_0x2577e6),'nasDdnsState':_0x375b3f?JSON[_0x22c641(0x1ac)](_0x375b3f['value']):'','nasDdnsEnable':_0x893597?_0x893597[_0x22c641(0x1eb)]:0x0,'nasRemoteEnable':_0x44875c?_0x44875c[_0x22c641(0x1eb)]:0x0});})[_0x31e376(0x197)](_0x1f39d3=>{const _0x16898e=_0x31e376;return console[_0x16898e(0x1a2)](_0x1f39d3),dbConfigTable[_0x16898e(0x19d)](_0x27cc87[_0x16898e(0x1a1)][_0x16898e(0x1d6)],config[_0x16898e(0x1e1)]),_0x366dd3[_0x16898e(0x192)]({'code':0x0,'data':''});});else return _0x366dd3[_0x31e376(0x192)]({'code':0x0,'data':''});}),router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1ca),(_0x32b2f9,_0x2f7fe3,_0x564f37)=>{const _0x533624=_0x1cfe6a;let _0xb7746d=_0x32b2f9[_0x533624(0x1e9)][_0x533624(0x18e)];if(!_0xb7746d)return _0x32b2f9[_0x533624(0x1a1)][_0x533624(0x1a3)](_0x2f7fe3,'Params\x20invalid');console['log'](_0x533624(0x1ef),_0xb7746d);if(dbUserTable[_0x533624(0x1d4)](_0x32b2f9,_0x2f7fe3)!==!![])return;nasAccountUtil[_0x533624(0x1d5)](_0x32b2f9[_0x533624(0x1a1)][_0x533624(0x1d6)],_0xb7746d,()=>{const _0x3363ff=_0x533624;return process['send']({'type':_0x3363ff(0x1f1)}),_0x2f7fe3[_0x3363ff(0x192)]({'code':0x0});},()=>{const _0x5ff9e8=_0x533624;return _0x32b2f9[_0x5ff9e8(0x1a1)][_0x5ff9e8(0x1a3)](_0x2f7fe3,_0x2f7fe3['__']('loginFailedTryLater'));});}),router['post']('/nasCabLogout',(_0x4c4ecb,_0xcad46a,_0x4f0f1f)=>{const _0x17e9c7=_0x1cfe6a;if(dbUserTable[_0x17e9c7(0x1d4)](_0x4c4ecb,_0xcad46a)!==!![])return;return dbConfigTable[_0x17e9c7(0x19d)](_0x4c4ecb[_0x17e9c7(0x1a1)][_0x17e9c7(0x1d6)],config[_0x17e9c7(0x1e1)]),process['send']({'type':_0x17e9c7(0x1e0)}),_0xcad46a[_0x17e9c7(0x192)]({'code':0x0,'data':''});}),router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1c9),(_0x339949,_0xdf3264,_0x2f966b)=>{const _0x5e130e=_0x1cfe6a;if(dbUserTable[_0x5e130e(0x1d4)](_0x339949,_0xdf3264)!==!![])return;let _0x23155a=_0x339949['body']['serverId'];return process['send']({'type':_0x5e130e(0x1e3),'serverId':_0x23155a}),_0xdf3264['json']({'code':0x0});}),router[_0x1cfe6a(0x1ea)]('/getProxyState',(_0x1c0be1,_0x531d8,_0x59a90c)=>{const _0x4d3fc4=_0x1cfe6a;if(dbUserTable[_0x4d3fc4(0x1d4)](_0x1c0be1,_0x531d8)!==!![])return;let _0x77aaef=fs[_0x4d3fc4(0x1a6)](config[_0x4d3fc4(0x1c4)]),_0x5923a6=dbConfigTable['findByTitle'](_0x1c0be1[_0x4d3fc4(0x1a1)][_0x4d3fc4(0x1d6)],_0x4d3fc4(0x1db)),_0x5030e2=dbConfigTable[_0x4d3fc4(0x1b6)](_0x1c0be1[_0x4d3fc4(0x1a1)]['dbOther'],_0x4d3fc4(0x1ab));return _0x531d8[_0x4d3fc4(0x192)]({'code':0x0,'proxyState':_0x5923a6?JSON[_0x4d3fc4(0x1ac)](_0x5923a6['value']):'','pluginExists':_0x77aaef,'pluginPath':config[_0x4d3fc4(0x1c4)],'proxyServerList':_0x5030e2?_0x5030e2[_0x4d3fc4(0x1eb)]:'[]'});}),router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1df),(_0x57cb84,_0x3e35ab,_0x5e42e9)=>{const _0x56bc97=_0x1cfe6a;if(dbUserTable[_0x56bc97(0x1d4)](_0x57cb84,_0x3e35ab)!==!![])return;if(fs[_0x56bc97(0x1a6)](config[_0x56bc97(0x1c4)]))return _0x57cb84[_0x56bc97(0x1a1)][_0x56bc97(0x1a3)](_0x3e35ab,_0x3e35ab['__'](_0x56bc97(0x1cc)));return downloadFrpc(_0x57cb84,_0x3e35ab),_0x3e35ab[_0x56bc97(0x192)]({'code':0x0});});function downloadFrpc(_0x9f14a,_0x3ca3c1){const _0x122152=_0x1cfe6a;let _0x357f29=config[_0x122152(0x1b8)]+('/frpc/'+os[_0x122152(0x1ae)]()+'/'+os[_0x122152(0x195)]()+'/'+(os[_0x122152(0x1ae)]()==_0x122152(0x1e7)?_0x122152(0x1af):_0x122152(0x1cf)));console[_0x122152(0x1a2)](_0x122152(0x1c2),_0x357f29),!fs[_0x122152(0x1a6)](config[_0x122152(0x1e5)])&&fs['mkdirSync'](config['frpcFolder'],{'recursive':!![]}),axios({'url':_0x357f29,'method':_0x122152(0x1d8),'responseType':_0x122152(0x190)})[_0x122152(0x198)](_0x2ec98c=>{const _0x3dbbfb=_0x122152;let _0x120027=fs[_0x3dbbfb(0x1bd)](config[_0x3dbbfb(0x1d9)]);_0x2ec98c[_0x3dbbfb(0x1da)]['pipe'](_0x120027),_0x120027['on'](_0x3dbbfb(0x1c0),()=>{const _0xe40ebe=_0x3dbbfb;console[_0xe40ebe(0x1a2)](_0xe40ebe(0x193)),fs[_0xe40ebe(0x18f)](config[_0xe40ebe(0x1d9)],config[_0xe40ebe(0x1c4)]),dbNoticeCenterTable[_0xe40ebe(0x1b0)](_0x9f14a['app'][_0xe40ebe(0x1d6)],{'title':_0x3ca3c1['__']('proxy.frpcDownloaded'),'level':_0xe40ebe(0x1ce),'content':_0x3ca3c1['__'](_0xe40ebe(0x1b9))}),process[_0xe40ebe(0x19f)]({'type':_0xe40ebe(0x1e3)});}),_0x120027['on']('error',_0x2f929f=>{const _0x40e17a=_0x3dbbfb;console[_0x40e17a(0x1a2)](_0x40e17a(0x1c5),_0x2f929f);});})[_0x122152(0x197)](_0x25e98c=>{const _0xdf65f3=_0x122152;console[_0xdf65f3(0x1a2)](_0xdf65f3(0x1a9),_0x25e98c);});}function _0xc4fd(_0x127963,_0x106625){const _0x50dbc6=_0x50db();return _0xc4fd=function(_0xc4fdd6,_0x3b1b8a){_0xc4fdd6=_0xc4fdd6-0x18d;let _0x141ab6=_0x50dbc6[_0xc4fdd6];return _0x141ab6;},_0xc4fd(_0x127963,_0x106625);}function _0x50db(){const _0x2eab0d=['post','value','/getNasAccountInfo','../../db/dbUserTable','getCerts','nasCabLoginByToken','crt','nasAccountLogin','ipv6','nascabToken','renameSync','stream','httpsCert','json','FRPC\x20download\x20finish','../../db/dbNoticeCenterTable','arch','msg','catch','then','nasRemoteEnable','length','388660aIJUVO','apiBaseUrl','deleteByTitle','ddnsType','send','2424002mhqKKL','app','log','returnErrMsg','15SDqfti','exports','existsSync','151180wLtrMk','../../myConfig/config','FRPC\x20download\x20exception','userInfo','proxyServerList','parse','1352844RlpLki','platform','frpc.exe','create','426680kkcxxY','path','axios','key','decryptString','findByTitle','token','downloadUrl','proxy.frpcDownloaded','vipType','../utils/nasAccountUtils','getVipInfo','createWriteStream','useNasCabCerts','netWorkRequestFail','finish','3068199EvZBJK','Downloading','291402oTgcnE','frpcPath','FRPC\x20download\x20error','type','/setDdnsEnable','/setRemoteEnable','/reconnectRemote','/nasCabLoginByToken','httpsKey','proxy.frpcExist','express','info','frpc','../utils/cryptoUtils','globalIpList','nasDdnsEnable','NasCab\x20account\x20not\x20found','isAdmin','loginByToken','dbOther','ipv6addressNotFound','GET','frpcTempPath','data','nasRemoteState','/getDDNSState','nasAccountInfoPwd','/setUseNasCabCert','/downloadFrpc','nasCabLogout','nasAccountInfoConfigKey','16jwfhKA','nasProxyRestart','nasDdnsRestart','frpcFolder','/setDdnsType','win32','../../db/dbConfigTable','body'];_0x50db=function(){return _0x2eab0d;};return _0x50db();}router[_0x1cfe6a(0x1ea)](_0x1cfe6a(0x1c8),(_0x1ea2e9,_0xb11832,_0x16d556)=>{const _0x10ed46=_0x1cfe6a;if(dbUserTable['isAdmin'](_0x1ea2e9,_0xb11832)!==!![])return;let _0x1d159d=_0x1ea2e9['body'][_0x10ed46(0x199)];if(_0x1d159d==0x0||_0x1d159d==0x1)return dbConfigTable[_0x10ed46(0x1b0)](_0x1ea2e9[_0x10ed46(0x1a1)][_0x10ed46(0x1d6)],{'title':_0x10ed46(0x199),'value':_0x1d159d+''}),process[_0x10ed46(0x19f)]({'type':'nasProxyRestart'}),_0xb11832[_0x10ed46(0x192)]({'code':0x0});}),module[_0x1cfe6a(0x1a5)]=router;