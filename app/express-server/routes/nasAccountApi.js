const _0xe8855c=_0x1951;(function(_0xc20915,_0x4e1791){const _0x14bc29=_0x1951,_0x415970=_0xc20915();while(!![]){try{const _0x598501=-parseInt(_0x14bc29(0x14d))/0x1+parseInt(_0x14bc29(0x1a1))/0x2+-parseInt(_0x14bc29(0x171))/0x3*(parseInt(_0x14bc29(0x14a))/0x4)+parseInt(_0x14bc29(0x15b))/0x5*(-parseInt(_0x14bc29(0x1a4))/0x6)+parseInt(_0x14bc29(0x152))/0x7+-parseInt(_0x14bc29(0x1ab))/0x8+parseInt(_0x14bc29(0x1a7))/0x9*(parseInt(_0x14bc29(0x1a2))/0xa);if(_0x598501===_0x4e1791)break;else _0x415970['push'](_0x415970['shift']());}catch(_0x283ec3){_0x415970['push'](_0x415970['shift']());}}}(_0x5571,0x67627));var express=require(_0xe8855c(0x1a8)),router=express['Router']();let config=require('../../myConfig/config'),dbConfigTable=require(_0xe8855c(0x16c)),dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),path=require(_0xe8855c(0x18c)),cryptoUtils=require(_0xe8855c(0x196)),nasAccountUtil=require(_0xe8855c(0x154));const dbUserTable=require(_0xe8855c(0x150)),fs=require('fs');function _0x1951(_0x3193c7,_0x44f6ce){const _0x55719c=_0x5571();return _0x1951=function(_0x195155,_0xc9986a){_0x195155=_0x195155-0x14a;let _0x379dcf=_0x55719c[_0x195155];return _0x379dcf;},_0x1951(_0x3193c7,_0x44f6ce);}let axios=require(_0xe8855c(0x191));const os=require('os');router[_0xe8855c(0x159)](_0xe8855c(0x164),(_0x4559f9,_0x5ce66a,_0x5305c6)=>{const _0x2d53d4=_0xe8855c;if(dbUserTable[_0x2d53d4(0x1a0)](_0x4559f9,_0x5ce66a)!==!![])return;let _0x5bd58a=dbConfigTable[_0x2d53d4(0x168)](_0x4559f9[_0x2d53d4(0x16f)][_0x2d53d4(0x180)],_0x2d53d4(0x199));return _0x5ce66a[_0x2d53d4(0x182)]({'code':0x0,'ddnsState':_0x5bd58a?JSON[_0x2d53d4(0x192)](_0x5bd58a[_0x2d53d4(0x14f)]):''});}),router[_0xe8855c(0x159)]('/setDdnsEnable',(_0x327fa7,_0x3fbcbf,_0x3b8a38)=>{const _0x469460=_0xe8855c;if(dbUserTable[_0x469460(0x1a0)](_0x327fa7,_0x3fbcbf)!==!![])return;let _0x501da6=_0x327fa7[_0x469460(0x19c)][_0x469460(0x17e)];if(_0x501da6==0x0||_0x501da6==0x1)return dbConfigTable[_0x469460(0x19f)](_0x327fa7[_0x469460(0x16f)]['dbOther'],{'title':_0x469460(0x17e),'value':_0x501da6+''}),process[_0x469460(0x177)]({'type':'nasDdnsRestart'}),_0x3fbcbf['json']({'code':0x0});});function saveConfig(_0x536d69,_0x1c2946,_0x80fa59){dbConfigTable['create'](_0x536d69,{'title':_0x1c2946,'value':_0x80fa59+''});}function saveNasCabHttpsCerts(_0x1aeec4,_0x30bfa2){const _0x2b6e28=_0xe8855c;let _0x59fae0=dbConfigTable[_0x2b6e28(0x168)](_0x1aeec4,config[_0x2b6e28(0x18d)]);if(!_0x59fae0){if(_0x30bfa2)return _0x30bfa2[_0x2b6e28(0x182)]({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}cryptoUtils[_0x2b6e28(0x17a)](config['nasAccountInfoPwd'],_0x59fae0[_0x2b6e28(0x14f)])['then'](_0x21c9d5=>{const _0x57044b=_0x2b6e28;let _0x1a14db=JSON[_0x57044b(0x192)](_0x21c9d5),_0x2255bf=_0x1a14db[_0x57044b(0x195)];_0x2255bf[_0x57044b(0x155)]&&_0x2255bf['token']['length']>0x0&&(userToken=_0x2255bf['token'][_0x2255bf[_0x57044b(0x155)]['length']-0x1]);if(!userToken){if(_0x30bfa2)return _0x30bfa2['json']({'code':0x1,'message':'NasCab\x20account\x20not\x20found'});}let _0xa695dc={'token':userToken,'type':'getCerts'};axios[_0x57044b(0x159)](config[_0x57044b(0x16e)]+'ddns',_0xa695dc)[_0x57044b(0x173)](_0xf4e17c=>{const _0x41921a=_0x57044b;if(_0xf4e17c[_0x41921a(0x14e)][_0x41921a(0x15d)]){if(_0x30bfa2)return _0x30bfa2['json']({'code':0x1,'message':_0xf4e17c['data']['msg']});}else{saveConfig(_0x1aeec4,_0x41921a(0x198),_0xf4e17c[_0x41921a(0x14e)][_0x41921a(0x197)]),saveConfig(_0x1aeec4,_0x41921a(0x158),_0xf4e17c['data'][_0x41921a(0x183)]);if(_0x30bfa2)return _0x30bfa2[_0x41921a(0x182)]({'code':0x0});}})[_0x57044b(0x179)](_0x2f1b2c=>{const _0x1072ab=_0x57044b;if(_0x30bfa2)return _0x30bfa2[_0x1072ab(0x182)]({'code':0x1,'message':_0x30bfa2['__'](_0x1072ab(0x151))});});})[_0x2b6e28(0x179)](_0x15c790=>{const _0x5b7d3f=_0x2b6e28;console['log'](_0x15c790),dbConfigTable[_0x5b7d3f(0x17b)](dbOther,config[_0x5b7d3f(0x18d)]);});}function _0x5571(){const _0x4fc587=['deleteByTitle','FRPC\x20download\x20exception','/getNasAccountInfo','nasDdnsEnable','vipType','dbOther','Params\x20invalid','json','crt','frpcPath','pipe','stream','serverId','nasAccountInfoPwd','platform','ipv6','frpcFolder','path','nasAccountInfoConfigKey','arch','proxy.frpcExist','loginByToken','axios','parse','globalIpList','loginFailedTryLater','userInfo','../utils/cryptoUtils','key','httpsKey','nasDdnsState','nasCabLoginByToken','returnErrMsg','body','/nasCabLoginByToken','FRPC\x20download\x20error','create','isAdmin','1260866AAqkFZ','10juPVsH','/setUseNasCabCert','33192ZknHnh','frpcTempPath','nasAccountLogin','7058313PWsInY','express','/frpc/','ipv6addressNotFound','5031016EJryZI','188hUAIHR','getVipInfo','FRPC\x20download\x20finish','14380yeJBIW','data','value','../../db/dbUserTable','netWorkRequestFail','5292791QSyGXN','/setRemoteEnable','../utils/nasAccountUtils','token','nasRemoteState','finish','httpsCert','post','nascabToken','535yWeqPS','ddnsType','code','renameSync','/nasCabLogout','proxyServerList','info','proxy.frpcDownloaded','nasDdnsRestart','/getDDNSState','useNasCabCerts','error','log','findByTitle','exports','/getVipInfo','GET','../../db/dbConfigTable','/getProxyState','apiBaseUrl','app','nasCabLogout','32691BgDZLn','nasRemoteEnable','then','/downloadFrpc','nasProxyRestart','frpc.exe','send','existsSync','catch','decryptString'];_0x5571=function(){return _0x4fc587;};return _0x5571();}router[_0xe8855c(0x159)](_0xe8855c(0x1a3),(_0x311b4d,_0x3ab5ac,_0x5000ae)=>{const _0x46db2d=_0xe8855c;if(dbUserTable[_0x46db2d(0x1a0)](_0x311b4d,_0x3ab5ac)!==!![])return;let _0x325872=_0x311b4d['body']['useNasCabCerts'];if(_0x325872==0x0||_0x325872==0x1){saveConfig(_0x311b4d[_0x46db2d(0x16f)][_0x46db2d(0x180)],_0x46db2d(0x165),_0x325872+'');if(_0x325872==0x1)saveNasCabHttpsCerts(_0x311b4d['app'][_0x46db2d(0x180)],_0x3ab5ac);else return saveConfig(_0x311b4d[_0x46db2d(0x16f)][_0x46db2d(0x180)],_0x46db2d(0x198),''),saveConfig(_0x311b4d['app'][_0x46db2d(0x180)],_0x46db2d(0x158),''),_0x3ab5ac[_0x46db2d(0x182)]({'code':0x0});}else return _0x3ab5ac['json']({'code':0x1});}),router['post']('/setDdnsType',(_0x554e22,_0x171475,_0x47cfa5)=>{const _0x3eb6e9=_0xe8855c;if(dbUserTable['isAdmin'](_0x554e22,_0x171475)!==!![])return;let _0x40e5ba=_0x554e22['body'][_0x3eb6e9(0x15c)];if(_0x40e5ba!='ipv4'&&_0x40e5ba!=_0x3eb6e9(0x18a))return _0x171475[_0x3eb6e9(0x182)]({'code':0x1});if(_0x40e5ba=='ipv6'){let _0x1ed9b7='';try{let _0x5a5b43=dbConfigTable['findByTitle'](_0x554e22[_0x3eb6e9(0x16f)][_0x3eb6e9(0x180)],_0x3eb6e9(0x193));_0x5a5b43&&(_0x5a5b43=JSON[_0x3eb6e9(0x192)](_0x5a5b43[_0x3eb6e9(0x14f)]));for(let _0x100907 in _0x5a5b43){if(_0x5a5b43[_0x100907]['type']==_0x3eb6e9(0x18a)){_0x1ed9b7=_0x5a5b43[_0x100907]['ip'];break;}}}catch(_0x45e471){console[_0x3eb6e9(0x167)](_0x45e471);}if(!_0x1ed9b7)return _0x554e22[_0x3eb6e9(0x16f)][_0x3eb6e9(0x19b)](_0x171475,_0x171475['__'](_0x3eb6e9(0x1aa)));}return dbConfigTable[_0x3eb6e9(0x19f)](_0x554e22['app'][_0x3eb6e9(0x180)],{'title':_0x3eb6e9(0x15c),'value':_0x40e5ba}),process[_0x3eb6e9(0x177)]({'type':_0x3eb6e9(0x163)}),_0x171475['json']({'code':0x0});}),router[_0xe8855c(0x159)](_0xe8855c(0x16a),(_0x1321ac,_0xc5de2a,_0x5ef12d)=>{const _0xb5fa2c=_0xe8855c;let _0x8b596b={'code':0x0};nasAccountUtil[_0xb5fa2c(0x14b)](_0x1321ac[_0xb5fa2c(0x16f)][_0xb5fa2c(0x180)])[_0xb5fa2c(0x173)](_0x27e298=>{const _0x155ae0=_0xb5fa2c;return _0x27e298==![]?_0x8b596b['vipType']=0x0:_0x8b596b['vipType']=_0x27e298['type'],_0xc5de2a[_0x155ae0(0x182)](_0x8b596b);})[_0xb5fa2c(0x179)](_0x581276=>{const _0x387e7d=_0xb5fa2c;return _0x8b596b[_0x387e7d(0x17f)]=0x0,_0xc5de2a[_0x387e7d(0x182)](_0x8b596b);});}),router['post'](_0xe8855c(0x17d),(_0x35c587,_0x3e6280,_0x143690)=>{const _0x5267ba=_0xe8855c;let _0x11c4c9=dbConfigTable[_0x5267ba(0x168)](_0x35c587[_0x5267ba(0x16f)]['dbOther'],config[_0x5267ba(0x18d)]),_0x381e9d=dbConfigTable[_0x5267ba(0x168)](_0x35c587['app'][_0x5267ba(0x180)],_0x5267ba(0x199)),_0x3ac411=dbConfigTable['findByTitle'](_0x35c587[_0x5267ba(0x16f)][_0x5267ba(0x180)],'nasDdnsEnable'),_0x4e7c5b=dbConfigTable[_0x5267ba(0x168)](_0x35c587[_0x5267ba(0x16f)][_0x5267ba(0x180)],_0x5267ba(0x172));if(_0x11c4c9)cryptoUtils[_0x5267ba(0x17a)](config[_0x5267ba(0x188)],_0x11c4c9[_0x5267ba(0x14f)])['then'](_0x486bf5=>{const _0x438e84=_0x5267ba;return _0x3e6280[_0x438e84(0x182)]({'code':0x0,'data':JSON['parse'](_0x486bf5),'nasDdnsState':_0x381e9d?JSON[_0x438e84(0x192)](_0x381e9d[_0x438e84(0x14f)]):'','nasDdnsEnable':_0x3ac411?_0x3ac411[_0x438e84(0x14f)]:0x0,'nasRemoteEnable':_0x4e7c5b?_0x4e7c5b[_0x438e84(0x14f)]:0x0});})['catch'](_0x5d6872=>{const _0x3acf7d=_0x5267ba;return console['log'](_0x5d6872),dbConfigTable[_0x3acf7d(0x17b)](_0x35c587[_0x3acf7d(0x16f)]['dbOther'],config['nasAccountInfoConfigKey']),_0x3e6280[_0x3acf7d(0x182)]({'code':0x0,'data':''});});else return _0x3e6280[_0x5267ba(0x182)]({'code':0x0,'data':''});}),router[_0xe8855c(0x159)](_0xe8855c(0x19d),(_0x273038,_0xb20d5d,_0x327c88)=>{const _0x10cff9=_0xe8855c;let _0x43e7a6=_0x273038['body'][_0x10cff9(0x15a)];if(!_0x43e7a6)return _0x273038[_0x10cff9(0x16f)][_0x10cff9(0x19b)](_0xb20d5d,_0x10cff9(0x181));console[_0x10cff9(0x167)](_0x10cff9(0x19a),_0x43e7a6);if(dbUserTable['isAdmin'](_0x273038,_0xb20d5d)!==!![])return;nasAccountUtil[_0x10cff9(0x190)](_0x273038[_0x10cff9(0x16f)][_0x10cff9(0x180)],_0x43e7a6,()=>{const _0x50623a=_0x10cff9;return process[_0x50623a(0x177)]({'type':_0x50623a(0x1a6)}),_0xb20d5d[_0x50623a(0x182)]({'code':0x0});},()=>{const _0x16a44d=_0x10cff9;return _0x273038['app'][_0x16a44d(0x19b)](_0xb20d5d,_0xb20d5d['__'](_0x16a44d(0x194)));});}),router['post'](_0xe8855c(0x15f),(_0x4bff94,_0x4472f8,_0x20339d)=>{const _0x353c1b=_0xe8855c;if(dbUserTable[_0x353c1b(0x1a0)](_0x4bff94,_0x4472f8)!==!![])return;return dbConfigTable[_0x353c1b(0x17b)](_0x4bff94['app'][_0x353c1b(0x180)],config[_0x353c1b(0x18d)]),process[_0x353c1b(0x177)]({'type':_0x353c1b(0x170)}),_0x4472f8[_0x353c1b(0x182)]({'code':0x0,'data':''});}),router[_0xe8855c(0x159)]('/reconnectRemote',(_0x1b997d,_0x52c324,_0x2e21c6)=>{const _0x450037=_0xe8855c;if(dbUserTable[_0x450037(0x1a0)](_0x1b997d,_0x52c324)!==!![])return;let _0x28422d=_0x1b997d[_0x450037(0x19c)][_0x450037(0x187)];return process[_0x450037(0x177)]({'type':'nasProxyRestart','serverId':_0x28422d}),_0x52c324[_0x450037(0x182)]({'code':0x0});}),router[_0xe8855c(0x159)](_0xe8855c(0x16d),(_0x53e3eb,_0x3e70c8,_0x1278dc)=>{const _0x30fbe1=_0xe8855c;if(dbUserTable[_0x30fbe1(0x1a0)](_0x53e3eb,_0x3e70c8)!==!![])return;let _0x1240af=fs[_0x30fbe1(0x178)](config[_0x30fbe1(0x184)]),_0x2ebf01=dbConfigTable[_0x30fbe1(0x168)](_0x53e3eb['app'][_0x30fbe1(0x180)],_0x30fbe1(0x156)),_0x3f8331=dbConfigTable[_0x30fbe1(0x168)](_0x53e3eb[_0x30fbe1(0x16f)][_0x30fbe1(0x180)],_0x30fbe1(0x160));return _0x3e70c8[_0x30fbe1(0x182)]({'code':0x0,'proxyState':_0x2ebf01?JSON[_0x30fbe1(0x192)](_0x2ebf01['value']):'','pluginExists':_0x1240af,'pluginPath':config[_0x30fbe1(0x184)],'proxyServerList':_0x3f8331?_0x3f8331[_0x30fbe1(0x14f)]:'[]'});}),router['post'](_0xe8855c(0x174),(_0x22c5a0,_0x20d16f,_0x237463)=>{const _0x353bd3=_0xe8855c;if(dbUserTable[_0x353bd3(0x1a0)](_0x22c5a0,_0x20d16f)!==!![])return;if(fs[_0x353bd3(0x178)](config[_0x353bd3(0x184)]))return _0x22c5a0['app'][_0x353bd3(0x19b)](_0x20d16f,_0x20d16f['__'](_0x353bd3(0x18f)));return downloadFrpc(_0x22c5a0,_0x20d16f),_0x20d16f[_0x353bd3(0x182)]({'code':0x0});});function downloadFrpc(_0x4cbfe2,_0x210fd6){const _0xc38e45=_0xe8855c;let _0x4b437c=config['downloadUrl']+(_0xc38e45(0x1a9)+os[_0xc38e45(0x189)]()+'/'+os[_0xc38e45(0x18e)]()+'/'+(os[_0xc38e45(0x189)]()=='win32'?_0xc38e45(0x176):'frpc'));console[_0xc38e45(0x167)]('Downloading',_0x4b437c),!fs[_0xc38e45(0x178)](config['frpcFolder'])&&fs['mkdirSync'](config[_0xc38e45(0x18b)],{'recursive':!![]}),axios({'url':_0x4b437c,'method':_0xc38e45(0x16b),'responseType':_0xc38e45(0x186)})['then'](_0x443efe=>{const _0x2a8d90=_0xc38e45;let _0x561db6=fs['createWriteStream'](config['frpcTempPath']);_0x443efe['data'][_0x2a8d90(0x185)](_0x561db6),_0x561db6['on'](_0x2a8d90(0x157),()=>{const _0x3accb4=_0x2a8d90;console[_0x3accb4(0x167)](_0x3accb4(0x14c)),fs[_0x3accb4(0x15e)](config[_0x3accb4(0x1a5)],config[_0x3accb4(0x184)]),dbNoticeCenterTable[_0x3accb4(0x19f)](_0x4cbfe2[_0x3accb4(0x16f)][_0x3accb4(0x180)],{'title':_0x210fd6['__'](_0x3accb4(0x162)),'level':_0x3accb4(0x161),'content':_0x210fd6['__'](_0x3accb4(0x162))}),process['send']({'type':'nasProxyRestart'});}),_0x561db6['on'](_0x2a8d90(0x166),_0x24da7a=>{const _0x3a0a81=_0x2a8d90;console[_0x3a0a81(0x167)](_0x3a0a81(0x19e),_0x24da7a);});})['catch'](_0x3720d3=>{const _0x313b71=_0xc38e45;console[_0x313b71(0x167)](_0x313b71(0x17c),_0x3720d3);});}router[_0xe8855c(0x159)](_0xe8855c(0x153),(_0x449876,_0x321acf,_0x35f2df)=>{const _0x5cba1b=_0xe8855c;if(dbUserTable[_0x5cba1b(0x1a0)](_0x449876,_0x321acf)!==!![])return;let _0x32b073=_0x449876[_0x5cba1b(0x19c)][_0x5cba1b(0x172)];if(_0x32b073==0x0||_0x32b073==0x1)return dbConfigTable[_0x5cba1b(0x19f)](_0x449876[_0x5cba1b(0x16f)]['dbOther'],{'title':'nasRemoteEnable','value':_0x32b073+''}),process[_0x5cba1b(0x177)]({'type':_0x5cba1b(0x175)}),_0x321acf[_0x5cba1b(0x182)]({'code':0x0});}),module[_0xe8855c(0x169)]=router;