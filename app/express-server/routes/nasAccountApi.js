function _0x570b(_0x35a9e7,_0x4d85e4){const _0x14a20a=_0x14a2();return _0x570b=function(_0x570b85,_0x4ca859){_0x570b85=_0x570b85-0x7e;let _0x31296f=_0x14a20a[_0x570b85];return _0x31296f;},_0x570b(_0x35a9e7,_0x4d85e4);}const _0x2251ca=_0x570b;(function(_0x3aa7ae,_0x5d0494){const _0x2e638a=_0x570b,_0x2afcd4=_0x3aa7ae();while(!![]){try{const _0x35452a=parseInt(_0x2e638a(0x9b))/0x1+parseInt(_0x2e638a(0xa7))/0x2*(-parseInt(_0x2e638a(0x94))/0x3)+-parseInt(_0x2e638a(0xdc))/0x4+-parseInt(_0x2e638a(0xbc))/0x5+parseInt(_0x2e638a(0xbf))/0x6+-parseInt(_0x2e638a(0xb8))/0x7*(parseInt(_0x2e638a(0xc9))/0x8)+parseInt(_0x2e638a(0xd2))/0x9;if(_0x35452a===_0x5d0494)break;else _0x2afcd4['push'](_0x2afcd4['shift']());}catch(_0x2085e2){_0x2afcd4['push'](_0x2afcd4['shift']());}}}(_0x14a2,0x6dd39));var express=require('express'),router=express[_0x2251ca(0xb0)]();let config=require(_0x2251ca(0xc2)),dbConfigTable=require(_0x2251ca(0xad)),dbNoticeCenterTable=require(_0x2251ca(0xb5)),path=require(_0x2251ca(0x8e)),cryptoUtils=require('../utils/cryptoUtils'),nasAccountUtil=require(_0x2251ca(0x92));function _0x14a2(){const _0xe14e1e=['../../myConfig/config','NasCab\x20account\x20not\x20found','/setRemoteEnable','msg','nasDdnsState','proxy.frpcDownloaded','type','8bLjhHe','key','nasDdnsEnable','serverId','value','crt','create','getCerts','downloadUrl','9095004TxjjPL','nasCabLoginByToken','proxyServerList','useNasCabCerts','/setDdnsEnable','Params\x20invalid','token','frpcPath','platform','deleteByTitle','1147636fBYDEP','vipType','netWorkRequestFail','globalIpList','nasRemoteEnable','/getProxyState','nasAccountInfoConfigKey','ddns','json','httpsKey','nasRemoteState','findByTitle','existsSync','/reconnectRemote','log','proxy.frpcExist','ddnsType','app','path','renameSync','nasAccountInfoPwd','isAdmin','../utils/nasAccountUtils','ipv6addressNotFound','291vxLLQq','arch','exports','GET','info','win32','finish','267401RKsluW','httpsCert','nasAccountLogin','ipv6','parse','/downloadFrpc','axios','frpcTempPath','nasProxyRestart','then','mkdirSync','nasDdnsRestart','5366yPgVrp','/getVipInfo','frpcFolder','pipe','FRPC\x20download\x20finish','returnErrMsg','../../db/dbConfigTable','decryptString','post','Router','Downloading','/getNasAccountInfo','/getDDNSState','catch','../../db/dbNoticeCenterTable','frpc','apiBaseUrl','3811486QlsWID','length','frpc.exe','dbOther','1964865wjcTIj','data','error','3939138yMvnaZ','/nasCabLoginByToken','send'];_0x14a2=function(){return _0xe14e1e;};return _0x14a2();}const dbUserTable=require('../../db/dbUserTable'),fs=require('fs');let axios=require(_0x2251ca(0xa1));const os=require('os');router[_0x2251ca(0xaf)](_0x2251ca(0xb3),(_0x55a461,_0x4dfa32,_0x45a2ff)=>{const _0x47efcc=_0x2251ca;if(dbUserTable['isAdmin'](_0x55a461,_0x4dfa32)!==!![])return;let _0x58e9ed=dbConfigTable[_0x47efcc(0x87)](_0x55a461[_0x47efcc(0x8d)][_0x47efcc(0xbb)],_0x47efcc(0xc6));return _0x4dfa32[_0x47efcc(0x84)]({'code':0x0,'ddnsState':_0x58e9ed?JSON[_0x47efcc(0x9f)](_0x58e9ed[_0x47efcc(0xcd)]):''});}),router[_0x2251ca(0xaf)](_0x2251ca(0xd6),(_0x28acd1,_0x4494e9,_0x377b6e)=>{const _0x3b80e4=_0x2251ca;if(dbUserTable['isAdmin'](_0x28acd1,_0x4494e9)!==!![])return;let _0x2d2944=_0x28acd1['body']['nasDdnsEnable'];if(_0x2d2944==0x0||_0x2d2944==0x1)return dbConfigTable['create'](_0x28acd1[_0x3b80e4(0x8d)][_0x3b80e4(0xbb)],{'title':_0x3b80e4(0xcb),'value':_0x2d2944+''}),process[_0x3b80e4(0xc1)]({'type':_0x3b80e4(0xa6)}),_0x4494e9[_0x3b80e4(0x84)]({'code':0x0});});function saveConfig(_0x2edf7b,_0x3244e8,_0x75a50){dbConfigTable['create'](_0x2edf7b,{'title':_0x3244e8,'value':_0x75a50+''});}function saveNasCabHttpsCerts(_0x5bac47,_0x5c30ea){const _0x420c0b=_0x2251ca;let _0x4d53d4=dbConfigTable[_0x420c0b(0x87)](_0x5bac47,config[_0x420c0b(0x82)]);if(!_0x4d53d4){if(_0x5c30ea)return _0x5c30ea[_0x420c0b(0x84)]({'code':0x1,'message':_0x420c0b(0xc3)});}cryptoUtils[_0x420c0b(0xae)](config['nasAccountInfoPwd'],_0x4d53d4[_0x420c0b(0xcd)])[_0x420c0b(0xa4)](_0x2ccad0=>{const _0x1a5d4c=_0x420c0b;let _0x2ef173=JSON['parse'](_0x2ccad0),_0x5afb88=_0x2ef173['userInfo'];_0x5afb88[_0x1a5d4c(0xd8)]&&_0x5afb88[_0x1a5d4c(0xd8)][_0x1a5d4c(0xb9)]>0x0&&(userToken=_0x5afb88['token'][_0x5afb88[_0x1a5d4c(0xd8)][_0x1a5d4c(0xb9)]-0x1]);if(!userToken){if(_0x5c30ea)return _0x5c30ea[_0x1a5d4c(0x84)]({'code':0x1,'message':_0x1a5d4c(0xc3)});}let _0x41959c={'token':userToken,'type':_0x1a5d4c(0xd0)};axios[_0x1a5d4c(0xaf)](config[_0x1a5d4c(0xb7)]+_0x1a5d4c(0x83),_0x41959c)[_0x1a5d4c(0xa4)](_0x20c567=>{const _0x3e4b04=_0x1a5d4c;if(_0x20c567[_0x3e4b04(0xbd)]['code']){if(_0x5c30ea)return _0x5c30ea['json']({'code':0x1,'message':_0x20c567[_0x3e4b04(0xbd)][_0x3e4b04(0xc5)]});}else{saveConfig(_0x5bac47,_0x3e4b04(0x85),_0x20c567[_0x3e4b04(0xbd)][_0x3e4b04(0xca)]),saveConfig(_0x5bac47,_0x3e4b04(0x9c),_0x20c567[_0x3e4b04(0xbd)][_0x3e4b04(0xce)]);if(_0x5c30ea)return _0x5c30ea['json']({'code':0x0});}})[_0x1a5d4c(0xb4)](_0x498204=>{const _0x3a2ac8=_0x1a5d4c;if(_0x5c30ea)return _0x5c30ea['json']({'code':0x1,'message':_0x5c30ea['__'](_0x3a2ac8(0x7e))});});})[_0x420c0b(0xb4)](_0x2b6d1e=>{const _0x34b8f9=_0x420c0b;console[_0x34b8f9(0x8a)](_0x2b6d1e),dbConfigTable[_0x34b8f9(0xdb)](dbOther,config[_0x34b8f9(0x82)]);});}router[_0x2251ca(0xaf)]('/setUseNasCabCert',(_0x439d11,_0x29dc9a,_0x2e9f1a)=>{const _0x3605f7=_0x2251ca;if(dbUserTable[_0x3605f7(0x91)](_0x439d11,_0x29dc9a)!==!![])return;let _0x196397=_0x439d11['body']['useNasCabCerts'];if(_0x196397==0x0||_0x196397==0x1){saveConfig(_0x439d11['app']['dbOther'],_0x3605f7(0xd5),_0x196397+'');if(_0x196397==0x1)saveNasCabHttpsCerts(_0x439d11['app'][_0x3605f7(0xbb)],_0x29dc9a);else return saveConfig(_0x439d11[_0x3605f7(0x8d)][_0x3605f7(0xbb)],_0x3605f7(0x85),''),saveConfig(_0x439d11['app'][_0x3605f7(0xbb)],_0x3605f7(0x9c),''),_0x29dc9a['json']({'code':0x0});}else return _0x29dc9a[_0x3605f7(0x84)]({'code':0x1});}),router[_0x2251ca(0xaf)]('/setDdnsType',(_0x13168e,_0x57b142,_0x12f81e)=>{const _0xb74e3e=_0x2251ca;if(dbUserTable['isAdmin'](_0x13168e,_0x57b142)!==!![])return;let _0x1c9970=_0x13168e['body'][_0xb74e3e(0x8c)];if(_0x1c9970!='ipv4'&&_0x1c9970!=_0xb74e3e(0x9e))return _0x57b142[_0xb74e3e(0x84)]({'code':0x1});if(_0x1c9970=='ipv6'){let _0xf3426c='';try{let _0x38167e=dbConfigTable['findByTitle'](_0x13168e[_0xb74e3e(0x8d)][_0xb74e3e(0xbb)],_0xb74e3e(0x7f));_0x38167e&&(_0x38167e=JSON[_0xb74e3e(0x9f)](_0x38167e[_0xb74e3e(0xcd)]));for(let _0x357a7a in _0x38167e){if(_0x38167e[_0x357a7a][_0xb74e3e(0xc8)]==_0xb74e3e(0x9e)){_0xf3426c=_0x38167e[_0x357a7a]['ip'];break;}}}catch(_0xe1b1a3){console[_0xb74e3e(0x8a)](_0xe1b1a3);}if(!_0xf3426c)return _0x13168e[_0xb74e3e(0x8d)][_0xb74e3e(0xac)](_0x57b142,_0x57b142['__'](_0xb74e3e(0x93)));}return dbConfigTable[_0xb74e3e(0xcf)](_0x13168e[_0xb74e3e(0x8d)]['dbOther'],{'title':'ddnsType','value':_0x1c9970}),process[_0xb74e3e(0xc1)]({'type':'nasDdnsRestart'}),_0x57b142['json']({'code':0x0});}),router[_0x2251ca(0xaf)](_0x2251ca(0xa8),(_0x571119,_0x454e54,_0x5a518c)=>{const _0x3eef0d=_0x2251ca;let _0x44f6fd={'code':0x0};nasAccountUtil['getVipInfo'](_0x571119[_0x3eef0d(0x8d)][_0x3eef0d(0xbb)])[_0x3eef0d(0xa4)](_0x3d0339=>{const _0x1149bb=_0x3eef0d;return _0x3d0339==![]?_0x44f6fd[_0x1149bb(0xdd)]=0x0:_0x44f6fd[_0x1149bb(0xdd)]=_0x3d0339[_0x1149bb(0xc8)],_0x454e54[_0x1149bb(0x84)](_0x44f6fd);})[_0x3eef0d(0xb4)](_0x1edfff=>{const _0x4c0092=_0x3eef0d;return _0x44f6fd['vipType']=0x0,_0x454e54[_0x4c0092(0x84)](_0x44f6fd);});}),router[_0x2251ca(0xaf)](_0x2251ca(0xb2),(_0x24c505,_0x387632,_0x4456e7)=>{const _0xd69484=_0x2251ca;let _0x336d35=dbConfigTable[_0xd69484(0x87)](_0x24c505[_0xd69484(0x8d)]['dbOther'],config[_0xd69484(0x82)]),_0x5f164a=dbConfigTable[_0xd69484(0x87)](_0x24c505['app']['dbOther'],_0xd69484(0xc6)),_0x763292=dbConfigTable[_0xd69484(0x87)](_0x24c505[_0xd69484(0x8d)]['dbOther'],_0xd69484(0xcb)),_0x43c65f=dbConfigTable[_0xd69484(0x87)](_0x24c505[_0xd69484(0x8d)][_0xd69484(0xbb)],_0xd69484(0x80));if(_0x336d35)cryptoUtils['decryptString'](config[_0xd69484(0x90)],_0x336d35[_0xd69484(0xcd)])[_0xd69484(0xa4)](_0x42b80d=>{const _0x5640f9=_0xd69484;return _0x387632[_0x5640f9(0x84)]({'code':0x0,'data':JSON[_0x5640f9(0x9f)](_0x42b80d),'nasDdnsState':_0x5f164a?JSON[_0x5640f9(0x9f)](_0x5f164a[_0x5640f9(0xcd)]):'','nasDdnsEnable':_0x763292?_0x763292[_0x5640f9(0xcd)]:0x0,'nasRemoteEnable':_0x43c65f?_0x43c65f[_0x5640f9(0xcd)]:0x0});})['catch'](_0x3c8e86=>{const _0x2f5ff8=_0xd69484;return console[_0x2f5ff8(0x8a)](_0x3c8e86),dbConfigTable['deleteByTitle'](_0x24c505['app']['dbOther'],config[_0x2f5ff8(0x82)]),_0x387632[_0x2f5ff8(0x84)]({'code':0x0,'data':''});});else return _0x387632[_0xd69484(0x84)]({'code':0x0,'data':''});}),router['post'](_0x2251ca(0xc0),(_0x40ecf9,_0xcee81e,_0x286a6b)=>{const _0x73ee9c=_0x2251ca;let _0x50138c=_0x40ecf9['body']['nascabToken'];if(!_0x50138c)return _0x40ecf9[_0x73ee9c(0x8d)][_0x73ee9c(0xac)](_0xcee81e,_0x73ee9c(0xd7));console[_0x73ee9c(0x8a)](_0x73ee9c(0xd3),_0x50138c);if(dbUserTable[_0x73ee9c(0x91)](_0x40ecf9,_0xcee81e)!==!![])return;nasAccountUtil['loginByToken'](_0x40ecf9[_0x73ee9c(0x8d)][_0x73ee9c(0xbb)],_0x50138c,()=>{const _0x3d3ca7=_0x73ee9c;return process['send']({'type':_0x3d3ca7(0x9d)}),_0xcee81e[_0x3d3ca7(0x84)]({'code':0x0});},()=>{const _0x3d9f34=_0x73ee9c;return _0x40ecf9['app'][_0x3d9f34(0xac)](_0xcee81e,_0xcee81e['__']('loginFailedTryLater'));});}),router[_0x2251ca(0xaf)]('/nasCabLogout',(_0x44474d,_0x42702a,_0x2c4437)=>{const _0x55a688=_0x2251ca;if(dbUserTable[_0x55a688(0x91)](_0x44474d,_0x42702a)!==!![])return;return dbConfigTable[_0x55a688(0xdb)](_0x44474d[_0x55a688(0x8d)][_0x55a688(0xbb)],config['nasAccountInfoConfigKey']),process['send']({'type':'nasCabLogout'}),_0x42702a['json']({'code':0x0,'data':''});}),router[_0x2251ca(0xaf)](_0x2251ca(0x89),(_0x3b612c,_0x32e677,_0x484461)=>{const _0x4c3178=_0x2251ca;if(dbUserTable['isAdmin'](_0x3b612c,_0x32e677)!==!![])return;let _0x1284da=_0x3b612c['body'][_0x4c3178(0xcc)];return process[_0x4c3178(0xc1)]({'type':_0x4c3178(0xa3),'serverId':_0x1284da}),_0x32e677[_0x4c3178(0x84)]({'code':0x0});}),router[_0x2251ca(0xaf)](_0x2251ca(0x81),(_0x476761,_0xf23de2,_0x29fca6)=>{const _0x751894=_0x2251ca;if(dbUserTable[_0x751894(0x91)](_0x476761,_0xf23de2)!==!![])return;let _0xa4b0a0=fs[_0x751894(0x88)](config[_0x751894(0xd9)]),_0x421df2=dbConfigTable[_0x751894(0x87)](_0x476761[_0x751894(0x8d)][_0x751894(0xbb)],_0x751894(0x86)),_0x1a48bf=dbConfigTable[_0x751894(0x87)](_0x476761[_0x751894(0x8d)][_0x751894(0xbb)],_0x751894(0xd4));return _0xf23de2['json']({'code':0x0,'proxyState':_0x421df2?JSON[_0x751894(0x9f)](_0x421df2[_0x751894(0xcd)]):'','pluginExists':_0xa4b0a0,'pluginPath':config['frpcPath'],'proxyServerList':_0x1a48bf?_0x1a48bf[_0x751894(0xcd)]:'[]'});}),router[_0x2251ca(0xaf)](_0x2251ca(0xa0),(_0x4e24a1,_0xa88c90,_0x428bcf)=>{const _0x5a92a2=_0x2251ca;if(dbUserTable['isAdmin'](_0x4e24a1,_0xa88c90)!==!![])return;if(fs['existsSync'](config['frpcPath']))return _0x4e24a1[_0x5a92a2(0x8d)][_0x5a92a2(0xac)](_0xa88c90,_0xa88c90['__'](_0x5a92a2(0x8b)));return downloadFrpc(_0x4e24a1,_0xa88c90),_0xa88c90['json']({'code':0x0});});function downloadFrpc(_0x137233,_0x5927c3){const _0x4dc033=_0x2251ca;let _0x3717b5=config[_0x4dc033(0xd1)]+('/frpc/'+os[_0x4dc033(0xda)]()+'/'+os[_0x4dc033(0x95)]()+'/'+(os['platform']()==_0x4dc033(0x99)?_0x4dc033(0xba):_0x4dc033(0xb6)));console[_0x4dc033(0x8a)](_0x4dc033(0xb1),_0x3717b5),!fs['existsSync'](config[_0x4dc033(0xa9)])&&fs[_0x4dc033(0xa5)](config[_0x4dc033(0xa9)],{'recursive':!![]}),axios({'url':_0x3717b5,'method':_0x4dc033(0x97),'responseType':'stream'})[_0x4dc033(0xa4)](_0x1e0c27=>{const _0x4b2e7a=_0x4dc033;let _0x14cd43=fs['createWriteStream'](config[_0x4b2e7a(0xa2)]);_0x1e0c27[_0x4b2e7a(0xbd)][_0x4b2e7a(0xaa)](_0x14cd43),_0x14cd43['on'](_0x4b2e7a(0x9a),()=>{const _0x622189=_0x4b2e7a;console[_0x622189(0x8a)](_0x622189(0xab)),fs[_0x622189(0x8f)](config['frpcTempPath'],config[_0x622189(0xd9)]),dbNoticeCenterTable[_0x622189(0xcf)](_0x137233[_0x622189(0x8d)]['dbOther'],{'title':_0x5927c3['__'](_0x622189(0xc7)),'level':_0x622189(0x98),'content':_0x5927c3['__'](_0x622189(0xc7))}),process['send']({'type':'nasProxyRestart'});}),_0x14cd43['on'](_0x4b2e7a(0xbe),_0x28159d=>{console['log']('FRPC\x20download\x20error',_0x28159d);});})[_0x4dc033(0xb4)](_0x4bb0a4=>{console['log']('FRPC\x20download\x20exception',_0x4bb0a4);});}router['post'](_0x2251ca(0xc4),(_0x101286,_0x14f568,_0x52a932)=>{const _0x5d1a9d=_0x2251ca;if(dbUserTable['isAdmin'](_0x101286,_0x14f568)!==!![])return;let _0x1daf9c=_0x101286['body'][_0x5d1a9d(0x80)];if(_0x1daf9c==0x0||_0x1daf9c==0x1)return dbConfigTable[_0x5d1a9d(0xcf)](_0x101286[_0x5d1a9d(0x8d)][_0x5d1a9d(0xbb)],{'title':_0x5d1a9d(0x80),'value':_0x1daf9c+''}),process[_0x5d1a9d(0xc1)]({'type':_0x5d1a9d(0xa3)}),_0x14f568[_0x5d1a9d(0x84)]({'code':0x0});}),module[_0x2251ca(0x96)]=router;