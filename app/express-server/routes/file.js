const _0x2092b8=_0x57af;(function(_0x240a5e,_0x39b0ae){const _0x1dc58f=_0x57af,_0x17372b=_0x240a5e();while(!![]){try{const _0x3c3d56=parseInt(_0x1dc58f(0x179))/0x1+parseInt(_0x1dc58f(0x163))/0x2*(parseInt(_0x1dc58f(0x1fa))/0x3)+parseInt(_0x1dc58f(0x195))/0x4*(parseInt(_0x1dc58f(0x1a3))/0x5)+-parseInt(_0x1dc58f(0x23a))/0x6+parseInt(_0x1dc58f(0x1e4))/0x7*(-parseInt(_0x1dc58f(0x18d))/0x8)+-parseInt(_0x1dc58f(0x20a))/0x9+parseInt(_0x1dc58f(0x239))/0xa*(-parseInt(_0x1dc58f(0x23c))/0xb);if(_0x3c3d56===_0x39b0ae)break;else _0x17372b['push'](_0x17372b['shift']());}catch(_0x52b4a9){_0x17372b['push'](_0x17372b['shift']());}}}(_0x4232,0xce92d));let express=require('express'),router=express[_0x2092b8(0x22f)](),path=require(_0x2092b8(0x175)),fs=require('fs'),sha256=require(_0x2092b8(0x168)),fileUtil=require(_0x2092b8(0x1de));const sharp=require('sharp'),os=require('os');let platform=os[_0x2092b8(0x1b5)]();const dbUserTable=require(_0x2092b8(0x1fb)),dbNoticeCenterTable=require(_0x2092b8(0x1be)),dbConfigTable=require('../../db/dbConfigTable'),dbSourceFolderTable=require(_0x2092b8(0x21f)),dbFileOperationRecord=require(_0x2092b8(0x214)),fileStatUtil=require(_0x2092b8(0x15b)),config=require(_0x2092b8(0x1fe)),sharpUtil=require('../utils/sharpUtils'),globalInfoUtil=require('../../utils/globalInfoUtil'),archiver=require(_0x2092b8(0x171)),encodingUtil=require(_0x2092b8(0x230));function _0x4232(){const _0x193431=['TYPE_DELETE','SELECT\x20*\x20FROM\x20share_temp\x20where\x20user_id=?','INSERT\x20INTO\x20share_temp(path,password,token,create_timestamp,end_timestamp,user_id)\x20VALUES(?,?,?,?,?,?)','zip\x20error','error','.sys','basename','../../db/dbFileOperationRecord','R_OK','fullPath','stringify','/getPathTree','localeCompare','type','err','send','access','pipe','../../db/dbSourceFolderTable','returnDealedFile','$RECYCLE.BIN','readdir','charAt','PerfLogs','getTempShareObj','SELECT\x20*\x20FROM\x20share_temp\x20WHERE\x20token=?','directory','.zip','stack','returnFileError','doUserCanGet','LEVEL_MAIN_OPERATION','power_add','targetPath','Router','../../utils/encodingUtil','addFileOperationRecord','createTime','name','sourcePathList','Documents','replace','fileName','sendFile','17260EboLpD','1085112gZUkAL','data','2035qGpBEI','statSync','attachment;\x20filename*=UTF-8\x27\x27','days','join','Content-Disposition','removeHeader','../../utils/fileStatUtil','destroy','extname','login.pwdErr','query','zip','unpipe','headersSent','2cqeHGA','targetPathInvalid','operationType','/operationFolder','STATE_FAIL','sha256','getExcludePathList','/rawFile*','lastInsertRowid','constants','children','operationFail','floor','getByPage','archiver','url','result','/deleteByPath','path','sourceFolderMovie','checkPath','putInSystemTrash','534960VuBTMo','ctimeMs','/zipFile','create','power_delete','birthtimeMs','findByTitle','delete','is_admin','/Users','shareToken','checkPower','folderNotExist','then','value','append','sourceFolderMusic','sizeStr','.tmp','$WinREAgent','7829512tqRLmn','INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)','zip\x20finish','app','/operationFileList','select\x20id,type,url,name,remark\x20from\x20path_mount','STATE_SUC','/getTempShare','4cUvirw','book','/checkFolderPower','parse','mtimeMs','status','getTime','test','log','stat','toUpperCase','\x20->\x20','deleteSuccess','localPathIsReadable','6379960PdyfSd','Desktop','add','code','sameNameFileAlreadExist','searchStr','sort','cannotCopyToSelf','exports','returnErrMsg','decodePath','webdav','sep','folder','START_WORKER_FILE_OPERATION','power_get','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REPLACE\x20INTO\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path_mount(type,url,name,username,password,remark)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES(?,?,?,?,?,?)','mkdir','platform','length','setHeader','fileRenameFail','dbOther','run','DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?\x20and\x20user_id=?','prepare','.txt','../../db/dbNoticeCenterTable','atimeMs','custom','parent','cut','/customImageFile','quality','read','pathName','FILE_OPERATION','userDataFolder','$Recycle.Bin','push','all','localPathIsFolder','currentUser','startsWith','env','username','folderName','USER','/getPathState','sourcePath','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','deleteId','An\x20error\x20occurred\x20while\x20compressing\x20the\x20files.','download','Unable\x20to\x20read\x20file','doUserCanGetTempShare','music','System\x20Volume\x20Information','page','../utils/fileUtils','samba','getUtf8FileStream','photo','/operationPathMount','res\x20closed,destroy\x20zip\x20stream','7ngwekC','message','trash','isFile','end','TYPE_RENMAE','size','/addNewFolder','password','shell','write','filename','body','noWritePermission','root','rename','includes','/getOperationRecord','post','noReadPermission','toLowerCase','copy','4998423ImTKsH','../../db/dbUserTable','endsWith','isDirectory','../../myConfig/config','raw','getWindowsDiskList','local','deleteFileRecordAll','W_OK','cachePathRoot','json','(\x27customLogoImage\x27,\x27customHomeBgImage\x27)','DELETE\x20FROM\x20share_temp\x20WHERE\x20id\x20=\x20?','getPathByType','get','10369053CZHpFm','/zipFile/*','sourceFolderBook'];_0x4232=function(){return _0x193431;};return _0x4232();}let macPowerDetected=![],win32ExcludeList=[_0x2092b8(0x1dc),_0x2092b8(0x1c9),_0x2092b8(0x221),_0x2092b8(0x18c),'Documents\x20and\x20Settings',_0x2092b8(0x224)];function _0x57af(_0x41619a,_0x306ddf){const _0x42328b=_0x4232();return _0x57af=function(_0x57afc,_0x1fbc9b){_0x57afc=_0x57afc-0x15b;let _0x7e21e3=_0x42328b[_0x57afc];return _0x7e21e3;},_0x57af(_0x41619a,_0x306ddf);}router['get'](_0x2092b8(0x20b),(_0x4375cf,_0x55847e,_0xef542d)=>{const _0x2fc302=_0x2092b8;if(!_0x4375cf[_0x2fc302(0x15f)][_0x2fc302(0x175)])return _0x55847e[_0x2fc302(0x19a)](0x194)[_0x2fc302(0x1e8)]();let _0x1a2496=fileUtil[_0x2fc302(0x1ad)](_0x4375cf['query'][_0x2fc302(0x175)]),_0x34e8ad=_0x4375cf[_0x2fc302(0x15f)][_0x2fc302(0x1ef)];_0x34e8ad&&(_0x1a2496=path[_0x2fc302(0x240)](_0x1a2496,_0x34e8ad)),dbUserTable['doUserCanGet'](_0x4375cf,_0x55847e,'',_0x2fc302(0x1b2),_0x1a2496)==!![]&&fs[_0x2fc302(0x19e)](_0x1a2496,(_0x1f53d1,_0x50e449)=>{const _0x17038a=_0x2fc302;if(_0x1f53d1)return _0x55847e['status'](0x194)['end']();let _0x4c88bc=path[_0x17038a(0x213)](_0x1a2496)+_0x17038a(0x228);try{const _0x226d5d=encodeURIComponent(_0x4c88bc)[_0x17038a(0x236)](/%([0-9A-F]{2})/g,(_0x16bf15,_0x5b994c)=>'%'+_0x5b994c[_0x17038a(0x19f)]());_0x55847e['setHeader'](_0x17038a(0x241),_0x17038a(0x23e)+_0x226d5d);}catch(_0x307737){console[_0x17038a(0x19d)](_0x307737);}const _0x13fea2=archiver(_0x17038a(0x160),{'zlib':{'level':0x0}});_0x13fea2['on'](_0x17038a(0x211),function(_0x321c9c){const _0x478aac=_0x17038a;console[_0x478aac(0x19d)](_0x478aac(0x210),_0x321c9c[_0x478aac(0x1e5)]||_0x321c9c[_0x478aac(0x229)]),_0x13fea2[_0x478aac(0x161)](),!_0x55847e[_0x478aac(0x162)]?(_0x55847e[_0x478aac(0x242)](_0x478aac(0x241)),_0x55847e[_0x478aac(0x19a)](0x1f4)['send'](_0x478aac(0x1d7))):_0x55847e[_0x478aac(0x15c)]();}),_0x13fea2['on'](_0x17038a(0x1e8),function(){const _0x714b1d=_0x17038a;console[_0x714b1d(0x19d)](_0x714b1d(0x18f)),_0x13fea2[_0x714b1d(0x15c)]();});try{fs[_0x17038a(0x222)](_0x1a2496,(_0x55448f,_0x1f4260)=>{const _0x56a211=_0x17038a;for(let _0xf3eb10 in _0x1f4260){let _0x71c113=_0x1f4260[_0xf3eb10];const _0x594501=path['join'](_0x1a2496,_0x71c113);let _0x1a7717=fs[_0x56a211(0x23d)](_0x594501);_0x1a7717[_0x56a211(0x1fd)]()?_0x13fea2[_0x56a211(0x227)](_0x594501,_0x71c113):_0x13fea2[_0x56a211(0x188)](fs['createReadStream'](_0x594501),{'name':_0x71c113});}_0x13fea2['finalize'](),_0x13fea2[_0x56a211(0x21e)](_0x55847e);});}catch(_0x155bf7){!_0x55847e[_0x17038a(0x162)]&&_0x55847e['status'](0x1f4)[_0x17038a(0x21c)]({'error':'An\x20error\x20occurred\x20while\x20reading\x20the\x20directory.'}),console['error'](_0x155bf7);}_0x55847e['on']('close',()=>{const _0x3d30c3=_0x17038a;console['log'](_0x3d30c3(0x1e3)),_0x13fea2[_0x3d30c3(0x15c)]();});});}),router[_0x2092b8(0x1f6)](_0x2092b8(0x218),(_0x4f4992,_0x5c9839,_0x236502)=>{const _0x45d443=_0x2092b8;let _0x16fe8a=_0x4f4992[_0x45d443(0x1f0)]['parent'],_0x546217=path['sep'],_0x38b964=_0x4f4992[_0x45d443(0x1f0)]['type'],_0x239390=_0x4f4992[_0x45d443(0x1f0)][_0x45d443(0x1a8)],_0x2f1c56=[],_0x790e33=parseInt(_0x4f4992[_0x45d443(0x1cd)]['is_admin'])==0x1,_0x387da3=fileUtil[_0x45d443(0x169)](_0x4f4992['app']['dbOther']);try{function _0x5ed3c1(){const _0x1d78a4=_0x45d443;let _0x213062=dbUserTable['getUserPower'](_0x4f4992[_0x1d78a4(0x190)][_0x1d78a4(0x1b9)],_0x4f4992[_0x1d78a4(0x1cd)][_0x1d78a4(0x1d0)],_0x1d78a4(0x1b0),_0x1d78a4(0x1b2));for(let _0x52775d of _0x213062){if(_0x387da3[_0x1d78a4(0x1f4)](_0x52775d[_0x1d78a4(0x175)]))continue;_0x2f1c56[_0x1d78a4(0x1ca)]({'type':0x2,'name':_0x52775d[_0x1d78a4(0x175)],'fileFullPath':_0x52775d['path']});}return _0x5c9839['json']({'code':0x0,'data':{'parent':'','children':_0x2f1c56,'sep':_0x546217,'platform':platform}});}if(!_0x16fe8a){if(_0x790e33){if(platform=='win32'){function _0xec421d(_0x58ce66){const _0x2dec98=_0x45d443;let _0x2718f1=[];for(let _0x1edbf4 of _0x58ce66){if(_0x387da3[_0x2dec98(0x1f4)](_0x1edbf4[_0x2dec98(0x233)]))continue;_0x1edbf4[_0x2dec98(0x21a)]=0x2,_0x2718f1['push'](_0x1edbf4);}for(let _0x1dd976 in _0x2718f1){_0x2718f1[_0x1dd976]['fileFullPath']=_0x2718f1[_0x1dd976][_0x2dec98(0x233)];}return _0x5c9839['json']({'code':0x0,'data':{'parent':_0x16fe8a,'children':_0x2718f1,'sep':path[_0x2dec98(0x1af)],'platform':platform}});}let _0x130163=dbConfigTable[_0x45d443(0x17f)](_0x4f4992[_0x45d443(0x190)][_0x45d443(0x1b9)],_0x45d443(0x204));if(_0x130163)try{_0x130163=JSON[_0x45d443(0x198)](_0x130163[_0x45d443(0x187)]),_0x3c6bae(![]),_0xec421d(_0x130163);}catch(_0x2b4c66){_0x3c6bae(!![]);}else _0x3c6bae(!![]);function _0x3c6bae(_0x2b4bb7){const _0x72f15e=_0x45d443;globalInfoUtil[_0x72f15e(0x200)](_0x17b3f9=>{const _0x5b49ef=_0x72f15e;_0x17b3f9=_0x17b3f9[_0x5b49ef(0x1a9)]((_0x33a5c5,_0x3a6032)=>{const _0x5e9b53=_0x5b49ef;if(!_0x33a5c5[_0x5e9b53(0x233)]||!_0x3a6032[_0x5e9b53(0x233)])return;return _0x33a5c5[_0x5e9b53(0x233)][_0x5e9b53(0x219)](_0x3a6032['name']);}),dbConfigTable[_0x5b49ef(0x17c)](_0x4f4992['app']['dbOther'],{'title':_0x5b49ef(0x204),'value':JSON[_0x5b49ef(0x217)](_0x17b3f9)}),_0x2b4bb7&&_0xec421d(_0x17b3f9);});}}else{if(platform=='darwin'){if(!macPowerDetected){macPowerDetected=!![];try{const _0xf62a78=process[_0x45d443(0x1cf)][_0x45d443(0x1d2)];let _0x28ad62=[path['join']('/Users',_0xf62a78,_0x45d443(0x235)),path[_0x45d443(0x240)](_0x45d443(0x182),_0xf62a78,'Downloads'),path[_0x45d443(0x240)]('/Users',_0xf62a78,_0x45d443(0x1a4))];for(let _0x1d72d4 in _0x28ad62){fs['stat'](_0x28ad62[_0x1d72d4],(_0x51874d,_0x2fb425)=>{});}}catch(_0xfc8751){}}let _0x5dee06=path[_0x45d443(0x198)](process['cwd']())[_0x45d443(0x1f2)];_0x1fe226(_0x5dee06);}else _0x16fe8a=path[_0x45d443(0x198)](process['cwd']())['root'],_0x1fe226(_0x16fe8a);}}else return _0x5ed3c1();}else _0x1fe226(_0x16fe8a);function _0x1fe226(_0x585610){const _0xa56466=_0x45d443;if(!_0x790e33){if(!dbUserTable['doUserCanGet'](_0x4f4992,_0x5c9839,_0xa56466(0x1b0),_0xa56466(0x1b2),_0x585610,!![]))return _0x5ed3c1();}if(_0x585610=='sourceFolderPhoto'||_0x585610==_0xa56466(0x176)||_0x585610=='sourceFolderMusic'||_0x585610==_0xa56466(0x20c)){let _0x110826=_0xa56466(0x1e1);if(_0x585610==_0xa56466(0x176))_0x110826='movie';else{if(_0x585610==_0xa56466(0x189))_0x110826=_0xa56466(0x1db);else _0x585610==_0xa56466(0x20c)&&(_0x110826=_0xa56466(0x196));}let _0x226b19=dbSourceFolderTable[_0xa56466(0x208)](_0x4f4992[_0xa56466(0x190)]['dbOther'],_0x110826);for(let _0x40cdf0 in _0x226b19){_0x2f1c56[_0xa56466(0x1ca)]({'type':0x2,'name':path[_0xa56466(0x213)](_0x226b19[_0x40cdf0]['path']),'fileFullPath':_0x226b19[_0x40cdf0][_0xa56466(0x175)]});}return _0x5c9839[_0xa56466(0x205)]({'code':0x0,'data':{'parent':_0x585610,'children':_0x2f1c56,'sep':_0x546217,'platform':platform}});}fs[_0xa56466(0x222)](_0x585610,{'withFileTypes':!![]},(_0x1e35ae,_0x56d672)=>{const _0x57e3c8=_0xa56466;if(_0x1e35ae)return console[_0x57e3c8(0x19d)](_0x1e35ae),fileUtil[_0x57e3c8(0x22a)](_0x5c9839,_0x1e35ae);for(let _0x4f0bfd=0x0;_0x4f0bfd<_0x56d672[_0x57e3c8(0x1b6)];_0x4f0bfd++){let _0x1025a5=_0x56d672[_0x4f0bfd],_0x192000=_0x56d672[_0x4f0bfd][_0x57e3c8(0x233)];if(_0x192000[_0x57e3c8(0x1b6)]>0x0){if(_0x192000[0x0]=='.')continue;if(/[A-Z]:\\/i[_0x57e3c8(0x19c)](_0x585610)&&_0x585610[_0x57e3c8(0x1b6)]<=0x3){if(win32ExcludeList[_0x57e3c8(0x1f4)](_0x192000)||_0x192000[_0x57e3c8(0x1fc)](_0x57e3c8(0x212))||_0x192000[_0x57e3c8(0x1fc)](_0x57e3c8(0x18b)))continue;}}let _0x52309e=path[_0x57e3c8(0x240)](_0x585610,_0x192000);if(_0x387da3['includes'](_0x52309e))continue;let _0x12e7bf=_0x1025a5['isFile'](),_0x3bd968=_0x1025a5[_0x57e3c8(0x1fd)]();function _0x37e0cf(){const _0x3e1d=_0x57e3c8;if(_0x12e7bf)(_0x38b964==0x0||_0x38b964==0x1)&&_0x2f1c56[_0x3e1d(0x1ca)]({'type':0x1,'name':_0x192000,'fileFullPath':_0x52309e});else _0x3bd968&&_0x2f1c56[_0x3e1d(0x1ca)]({'type':0x2,'name':_0x192000,'fileFullPath':_0x52309e});}_0x239390?_0x192000[_0x57e3c8(0x1f4)](_0x239390)&&_0x37e0cf():_0x37e0cf();try{if(_0x2f1c56[_0x57e3c8(0x1b6)]>0x1770)break;}catch(_0x43071b){continue;}}let _0x350129=_0x2f1c56['length'],_0x1368d2=0x0;if(_0x2f1c56['length']<0x1)return _0x5c9839[_0x57e3c8(0x205)]({'code':0x0,'data':{'parent':_0x585610,'children':_0x2f1c56,'sep':_0x546217,'platform':platform}});for(let _0x395c76 of _0x2f1c56){fs[_0x57e3c8(0x19e)](_0x395c76['fileFullPath'],(_0x4fcb53,_0x3f9dce)=>{const _0x102951=_0x57e3c8;_0x1368d2+=0x1;!_0x4fcb53&&(_0x395c76[_0x102951(0x1bf)]=_0x3f9dce[_0x102951(0x1bf)],_0x395c76['mtimeMs']=_0x3f9dce[_0x102951(0x199)],_0x395c76[_0x102951(0x17e)]=_0x3f9dce['birthtimeMs'],_0x395c76['size']=_0x3f9dce[_0x102951(0x1ea)]);if(_0x1368d2>=_0x350129)return _0x5c9839[_0x102951(0x205)]({'code':0x0,'data':{'parent':_0x585610,'children':_0x2f1c56,'sep':_0x546217,'platform':platform}});});}});}}catch(_0x5d5c13){return fileUtil['returnFileError'](_0x5c9839,_0x5d5c13);}}),router['get'](_0x2092b8(0x1c3),(_0x15b20e,_0x5db703,_0x1dfa39)=>{const _0x74aaba=_0x2092b8;let _0x285477=fileUtil['decodePath'](_0x15b20e[_0x74aaba(0x15f)][_0x74aaba(0x175)]);if(!_0x285477)return _0x5db703['status'](0x194)[_0x74aaba(0x1e8)]();_0x285477=path[_0x74aaba(0x240)](_0x285477);let _0x24de5f=path[_0x74aaba(0x240)](config[_0x74aaba(0x1c8)],_0x74aaba(0x1c0),path[_0x74aaba(0x1af)]);return _0x285477[_0x74aaba(0x1ce)](_0x24de5f)?_0x5db703[_0x74aaba(0x238)](_0x285477):_0x5db703[_0x74aaba(0x19a)](0x194)[_0x74aaba(0x1e8)]();}),router[_0x2092b8(0x209)](_0x2092b8(0x16a),(_0x268a28,_0x309308,_0x524cf5)=>{const _0x549da8=_0x2092b8;let _0x394470=_0x268a28[_0x549da8(0x15f)][_0x549da8(0x175)],_0x4c8ca4=_0x268a28[_0x549da8(0x15f)][_0x549da8(0x1d8)]==0x1,_0x2e51e2=fileUtil[_0x549da8(0x1ad)](_0x394470),_0x17a597=_0x268a28[_0x549da8(0x15f)][_0x549da8(0x1ea)],_0xfcfdd9=_0x268a28[_0x549da8(0x15f)][_0x549da8(0x1c4)];if(dbUserTable['doUserCanGet'](_0x268a28,_0x309308,'',_0x549da8(0x1b2),_0x2e51e2)==!![])try{let _0x4b0ccb=_0x268a28[_0x549da8(0x15f)][_0x549da8(0x1ff)];if(_0x4b0ccb&&_0x4b0ccb==0x1){if(_0x4c8ca4){const _0x44a5eb=encodeURIComponent(path[_0x549da8(0x213)](_0x2e51e2))[_0x549da8(0x236)](/%([0-9A-F]{2})/g,(_0xbb864b,_0x131c58)=>'%'+_0x131c58[_0x549da8(0x19f)]());_0x309308[_0x549da8(0x1b7)](_0x549da8(0x241),_0x549da8(0x23e)+_0x44a5eb);}return _0x309308[_0x549da8(0x238)](_0x2e51e2);}else _0x268a28[_0x549da8(0x15f)][_0x549da8(0x1a6)]&&_0x268a28[_0x549da8(0x15f)][_0x549da8(0x1a6)]=='utf8'&&path['extname'](_0x2e51e2)&&path[_0x549da8(0x15d)](_0x2e51e2)[_0x549da8(0x1f8)]()==_0x549da8(0x1bd)?(console[_0x549da8(0x19d)]('Convert\x20to\x20utf8\x20',_0x2e51e2),encodingUtil[_0x549da8(0x1e0)](_0x2e51e2)[_0x549da8(0x186)](_0x543542=>{const _0x5859e5=_0x549da8;return _0x543542?_0x543542[_0x5859e5(0x21e)](_0x309308):(console[_0x5859e5(0x19d)](_0x5859e5(0x1d9),_0x2e51e2),_0x309308[_0x5859e5(0x238)](_0x2e51e2));})):sharpUtil[_0x549da8(0x220)](_0x309308,_0x2e51e2,_0x4c8ca4,_0x17a597,_0xfcfdd9);}catch(_0x31408a){return console[_0x549da8(0x19d)](_0x31408a),fileUtil[_0x549da8(0x22a)](_0x309308,_0x31408a);}}),router[_0x2092b8(0x1f6)](_0x2092b8(0x197),(_0x5af37e,_0x142975,_0x329ef8)=>{const _0x5c6bea=_0x2092b8;let _0xd5cb42=fileUtil[_0x5c6bea(0x1ad)](_0x5af37e['body'][_0x5c6bea(0x177)]),_0xddcf1d=_0x5af37e[_0x5c6bea(0x1f0)][_0x5c6bea(0x184)];if(_0xddcf1d==_0x5c6bea(0x1ee))_0xddcf1d=fs[_0x5c6bea(0x16c)][_0x5c6bea(0x203)];else _0xddcf1d==_0x5c6bea(0x1c5)&&(_0xddcf1d=fs[_0x5c6bea(0x16c)]['R_OK']);try{_0xddcf1d==_0x5c6bea(0x1cb)?fs[_0x5c6bea(0x21d)](_0xd5cb42,fs['constants'][_0x5c6bea(0x203)],_0x1b6e4f=>{const _0x102004=_0x5c6bea;if(_0x1b6e4f)return fileUtil['returnFileError'](_0x142975,_0x1b6e4f);return _0x142975[_0x102004(0x205)]({'code':0x0,'access':!![]});}):fs[_0x5c6bea(0x21d)](_0xd5cb42,_0xddcf1d,_0x150169=>{const _0x18faf6=_0x5c6bea;if(_0x150169)return fileUtil[_0x18faf6(0x22a)](_0x142975,_0x150169);return _0x142975[_0x18faf6(0x205)]({'code':0x0,'access':!![]});});}catch(_0x52ac38){return _0x142975[_0x5c6bea(0x205)]({'code':0x0,'access':![]});}}),router['post'](_0x2092b8(0x1eb),(_0x4d39ae,_0x3d0a7e,_0x1d0353)=>{const _0x382be5=_0x2092b8;let _0x245736=fileUtil['decodePath'](_0x4d39ae[_0x382be5(0x1f0)]['parentPath']),_0x104fa8=_0x4d39ae[_0x382be5(0x1f0)][_0x382be5(0x1d1)],_0x39f606=path[_0x382be5(0x240)](_0x245736,_0x104fa8);if(dbUserTable['doUserCanGet'](_0x4d39ae,_0x3d0a7e,_0x382be5(0x1b0),_0x382be5(0x22d),_0x39f606)==!![])try{fs[_0x382be5(0x19e)](_0x39f606,_0xca996d=>{const _0x5dca53=_0x382be5;if(!_0xca996d)return _0x4d39ae['app'][_0x5dca53(0x1ac)](_0x3d0a7e,_0x3d0a7e['__']('sameNameFileAlreadExist')+':'+_0x39f606);else fs[_0x5dca53(0x1b4)](_0x39f606,{'recursive':!![]},_0x4f5543=>{const _0x3dbaeb=_0x5dca53;return _0x4f5543?fileUtil[_0x3dbaeb(0x22a)](_0x3d0a7e,_0x4f5543):_0x3d0a7e[_0x3dbaeb(0x205)]({'code':0x0});});});}catch(_0x48d507){return fileUtil[_0x382be5(0x22a)](_0x3d0a7e,_0x48d507);}}),router[_0x2092b8(0x1f6)](_0x2092b8(0x17b),(_0x347f09,_0xff34cd,_0x765046)=>{const _0x3060a5=_0x2092b8;let _0x577e6b=_0x347f09['body'][_0x3060a5(0x1d4)],_0x47eaf5=_0x347f09[_0x3060a5(0x1f0)][_0x3060a5(0x22e)],_0x42a993=_0x347f09[_0x3060a5(0x1f0)][_0x3060a5(0x21a)];if(_0x42a993!=_0x3060a5(0x160)&&_0x42a993!='unzip')return _0x347f09['app'][_0x3060a5(0x1ac)](_0xff34cd,_0xff34cd['__'](_0x3060a5(0x16e)));if(dbUserTable['doUserCanGet'](_0x347f09,_0xff34cd,_0x3060a5(0x1b0),_0x3060a5(0x1b2),_0x577e6b)==!![]&&dbUserTable[_0x3060a5(0x22b)](_0x347f09,_0xff34cd,_0x3060a5(0x1b0),_0x3060a5(0x22d),_0x47eaf5)==!![]){let _0x70bcd1=_0x347f09['app'][_0x3060a5(0x1b9)][_0x3060a5(0x1bc)]('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')[_0x3060a5(0x1ba)]('FILE_OPERATION',JSON[_0x3060a5(0x217)]({'sourcePath':_0x577e6b,'targetPath':_0x47eaf5,'type':_0x42a993,'username':_0x347f09[_0x3060a5(0x1cd)]['username']}));return process[_0x3060a5(0x21c)]({'type':_0x3060a5(0x1b1),'taskIdList':[_0x70bcd1[_0x3060a5(0x16b)]]}),_0xff34cd[_0x3060a5(0x205)]({'code':0x0});}}),router[_0x2092b8(0x1f6)](_0x2092b8(0x191),(_0x17164f,_0x1e3781,_0x4a7282)=>{const _0x329c1a=_0x2092b8;let _0x4fdb5d=_0x17164f[_0x329c1a(0x1f0)][_0x329c1a(0x234)],_0x312f11=_0x17164f[_0x329c1a(0x1f0)]['targetPath'],_0x658472=_0x17164f['body'][_0x329c1a(0x21a)];if(_0x4fdb5d[_0x329c1a(0x1b6)]<0x1)return _0x17164f[_0x329c1a(0x190)]['returnErrMsg'](_0x1e3781,_0x1e3781['__'](_0x329c1a(0x16e)));if(dbUserTable[_0x329c1a(0x22b)](_0x17164f,_0x1e3781,_0x329c1a(0x1b0),_0x329c1a(0x1b2),_0x4fdb5d[0x0])==!![]&&dbUserTable['doUserCanGet'](_0x17164f,_0x1e3781,_0x329c1a(0x1b0),_0x329c1a(0x22d),_0x312f11)==!![])try{let _0x4ead01=[];for(let _0x17e3e7 in _0x4fdb5d){let _0xb1aa53=_0x4fdb5d[_0x17e3e7],_0x5d2898=path[_0x329c1a(0x213)](_0xb1aa53),_0x18d1b1=path['join'](_0x312f11,_0x5d2898),_0x55873c=_0x17164f[_0x329c1a(0x190)]['dbOther']['prepare']('INSERT\x20INTO\x20bg_task(task_type,task_json)\x20VALUES(?,?)')[_0x329c1a(0x1ba)]('FILE_OPERATION',JSON['stringify']({'sourcePath':_0xb1aa53,'targetPath':_0x18d1b1,'type':_0x658472,'username':_0x17164f[_0x329c1a(0x1cd)]['username']}));_0x4ead01[_0x329c1a(0x1ca)](_0x55873c[_0x329c1a(0x16b)]);}return process[_0x329c1a(0x21c)]({'type':_0x329c1a(0x1b1),'taskIdList':_0x4ead01}),_0x1e3781[_0x329c1a(0x205)]({'code':0x0});}catch(_0x579fa4){return _0x17164f[_0x329c1a(0x190)]['returnErrMsg'](_0x1e3781,_0x1e3781['__'](_0x329c1a(0x16e)));}}),router[_0x2092b8(0x1f6)](_0x2092b8(0x166),(_0x235984,_0x1b21b2,_0x113c43)=>{const _0x5a8167=_0x2092b8;let _0x5c8e0a=fileUtil[_0x5a8167(0x1ad)](_0x235984['body']['sourcePath']),_0x161aa8=fileUtil[_0x5a8167(0x1ad)](_0x235984[_0x5a8167(0x1f0)][_0x5a8167(0x22e)]),_0x33bb0b=path[_0x5a8167(0x213)](_0x5c8e0a),_0x5c2a96=_0x235984[_0x5a8167(0x1f0)]['type'],_0x5accf2=path[_0x5a8167(0x240)](_0x161aa8,_0x33bb0b);if(_0x5c2a96==_0x5a8167(0x1f9)||_0x5c2a96==_0x5a8167(0x1c2)){if(fs['existsSync'](_0x5accf2))return _0x235984[_0x5a8167(0x190)][_0x5a8167(0x1ac)](_0x1b21b2,_0x1b21b2['__']('sameNameFileAlreadExist')+':'+_0x5accf2);}let _0xc2d851=_0x235984[_0x5a8167(0x1f0)]['newName'];function _0x4ffae5(_0x160ef3,_0x3f8530){const _0x1992d2=_0x5a8167;let _0x53bc25=_0x235984[_0x1992d2(0x190)][_0x1992d2(0x1b9)][_0x1992d2(0x1bc)](_0x1992d2(0x18e))['run'](_0x1992d2(0x1c7),JSON['stringify']({'sourcePath':_0x160ef3,'targetPath':_0x3f8530,'type':_0x5c2a96,'username':_0x235984[_0x1992d2(0x1cd)][_0x1992d2(0x1d0)]}));return _0x53bc25['lastInsertRowid'];}try{_0x5c8e0a=path[_0x5a8167(0x240)](_0x5c8e0a),_0x161aa8=path[_0x5a8167(0x240)](_0x161aa8);if(_0x161aa8==_0x5c8e0a||_0x161aa8[_0x5a8167(0x1ce)](_0x5c8e0a+path['sep']))return _0x235984[_0x5a8167(0x190)][_0x5a8167(0x1ac)](_0x1b21b2,_0x1b21b2['__'](_0x5a8167(0x1aa)));if(dbUserTable[_0x5a8167(0x22b)](_0x235984,_0x1b21b2,_0x5a8167(0x1b0),_0x5a8167(0x1b2),_0x5c8e0a)==!![]){let _0x5b602b=![];fs[_0x5a8167(0x19e)](_0x5c8e0a,(_0x4bd917,_0x2dc204)=>{const _0x3f030a=_0x5a8167;if(_0x4bd917)return _0x235984['app'][_0x3f030a(0x1ac)](_0x1b21b2,_0x1b21b2['__'](_0x3f030a(0x1f7))+':'+_0x5c8e0a);let _0x50b6b0=path[_0x3f030a(0x213)](_0x5c8e0a);fs['access'](_0x161aa8,fs[_0x3f030a(0x16c)][_0x3f030a(0x215)]|fs[_0x3f030a(0x16c)][_0x3f030a(0x203)],_0x340587=>{const _0x403713=_0x3f030a;if(_0x340587)return _0x235984[_0x403713(0x190)]['returnErrMsg'](_0x1b21b2,_0x1b21b2['__']('noWritePermission')+':'+_0x161aa8);if(_0x5c2a96==_0x403713(0x1f3))dbUserTable[_0x403713(0x22b)](_0x235984,_0x1b21b2,_0x403713(0x1b0),'power_change',_0x161aa8)==!![]&&(_0x161aa8=path[_0x403713(0x240)](_0x161aa8,_0xc2d851),fs[_0x403713(0x19e)](_0x161aa8,_0x57d2b1=>{const _0x336c02=_0x403713;if(!_0x57d2b1)return _0x235984[_0x336c02(0x190)][_0x336c02(0x1ac)](_0x1b21b2,_0x1b21b2['__'](_0x336c02(0x1a7))+':'+_0x161aa8);else fs['rename'](_0x5c8e0a,_0x161aa8,_0x3fa806=>{const _0x5a8a47=_0x336c02;if(_0x3fa806)return dbFileOperationRecord[_0x5a8a47(0x231)](_0x235984[_0x5a8a47(0x190)][_0x5a8a47(0x1b9)],{'username':_0x235984[_0x5a8a47(0x1cd)][_0x5a8a47(0x1d0)],'sourcePath':_0x5c8e0a,'targetPath':_0x161aa8,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'belongId':null,'type':dbFileOperationRecord[_0x5a8a47(0x1e9)],'subType':null,'state':dbFileOperationRecord[_0x5a8a47(0x167)],'remark':fileUtil[_0x5a8a47(0x22a)](_0x1b21b2,_0x3fa806,!![])}),dbNoticeCenterTable[_0x5a8a47(0x17c)](_0x235984['app'][_0x5a8a47(0x1b9)],{'title':_0x1b21b2['__']('operationFail'),'level':_0x5a8a47(0x211),'content':_0x1b21b2['__'](_0x5a8a47(0x1b8))+':'+(_0x5c8e0a+_0x5a8a47(0x1a0)+_0x161aa8)});_0x5b602b=!![],dbFileOperationRecord[_0x5a8a47(0x231)](_0x235984[_0x5a8a47(0x190)][_0x5a8a47(0x1b9)],{'username':_0x235984[_0x5a8a47(0x1cd)][_0x5a8a47(0x1d0)],'sourcePath':_0x5c8e0a,'targetPath':_0x161aa8,'level':dbFileOperationRecord[_0x5a8a47(0x22c)],'belongId':null,'type':dbFileOperationRecord[_0x5a8a47(0x1e9)],'subType':null,'state':dbFileOperationRecord[_0x5a8a47(0x193)]});}),setTimeout(()=>{return _0x1b21b2['json']({'code':0x0,'isOver':_0x5b602b?0x1:0x0});},0x3e8);}));else{if(_0x5c2a96==_0x403713(0x1c2)){if(dbUserTable[_0x403713(0x22b)](_0x235984,_0x1b21b2,_0x403713(0x1b0),_0x403713(0x17d),_0x161aa8)!==!![])return;}if(dbUserTable[_0x403713(0x22b)](_0x235984,_0x1b21b2,_0x403713(0x1b0),_0x403713(0x22d),_0x161aa8)==!![]){_0x161aa8=path[_0x403713(0x240)](_0x161aa8,_0x50b6b0);let _0x5ead48=_0x4ffae5(_0x5c8e0a,_0x161aa8);return process[_0x403713(0x21c)]({'type':_0x403713(0x1b1),'taskIdList':[_0x5ead48]}),_0x1b21b2['json']({'code':0x0});}}});});}}catch(_0x154100){return _0x235984[_0x5a8167(0x190)][_0x5a8167(0x1ac)](_0x1b21b2,_0x1b21b2['__'](_0x5a8167(0x16e)));}}),router[_0x2092b8(0x1f6)](_0x2092b8(0x1d3),(_0x1447ab,_0x4cac9d,_0x3e972a)=>{const _0x349852=_0x2092b8;let _0x44b2b5=_0x1447ab[_0x349852(0x1f0)][_0x349852(0x216)];if(!_0x44b2b5)return _0x4cac9d['status'](0x194)[_0x349852(0x1e8)]();dbUserTable['doUserCanGet'](_0x1447ab,_0x4cac9d,_0x349852(0x1b0),'power_get',_0x44b2b5)==!![]&&fs[_0x349852(0x19e)](_0x44b2b5,(_0x1b6c74,_0x18250d)=>{const _0x2c0a6f=_0x349852;if(_0x1b6c74)return fileUtil[_0x2c0a6f(0x22a)](_0x4cac9d,_0x1b6c74);return _0x18250d[_0x2c0a6f(0x18a)]=fileUtil['getTransSizeStr'](_0x18250d[_0x2c0a6f(0x1ea)]),_0x4cac9d[_0x2c0a6f(0x205)]({'code':0x0,'data':_0x18250d});});}),router[_0x2092b8(0x1f6)]('/fileExist',(_0x3bc3af,_0xc2a691,_0x1a11d5)=>{const _0x1372f3=_0x2092b8;let _0x474094=_0x3bc3af[_0x1372f3(0x1f0)]['folderPath'],_0xa44fdf=_0x3bc3af[_0x1372f3(0x1f0)][_0x1372f3(0x237)];_0xa44fdf&&(_0xa44fdf=_0xa44fdf[_0x1372f3(0x236)](/[<>\\\/:\*\?\"\|]/g,'_')),_0x474094&&(_0x474094=fileUtil['decodePath'](_0x474094)),fs[_0x1372f3(0x21d)](_0x474094,fs[_0x1372f3(0x16c)][_0x1372f3(0x203)]|fs[_0x1372f3(0x16c)]['R_OK'],_0x2b87f2=>{const _0x531113=_0x1372f3;if(_0x2b87f2)return _0xc2a691[_0x531113(0x205)]({'code':0x1,'message':_0xc2a691['__'](_0x531113(0x1f1))+':'+_0x474094});else{let _0x30bf9f='';if(_0x474094&&_0xa44fdf)_0x30bf9f=path[_0x531113(0x240)](_0x474094,_0xa44fdf);else{if(_0x474094)_0x30bf9f=path['join'](_0x474094);else return _0xc2a691[_0x531113(0x205)]({'code':0x1,'message':_0xc2a691['__'](_0x531113(0x185))+':'+_0x474094});}fs[_0x531113(0x19e)](_0x30bf9f,_0x1ed316=>{const _0x2a4cba=_0x531113;return _0x1ed316?(console[_0x2a4cba(0x19d)](_0x2a4cba(0x21b),_0x30bf9f),_0xc2a691['json']({'code':0x0})):_0xc2a691['json']({'code':0x1,'remark':'EXIST'});});}});}),router['post'](_0x2092b8(0x174),(_0x179eb8,_0x43d018,_0x19de81)=>{const _0x166190=_0x2092b8;let _0x1522c4=_0x179eb8['body'][_0x166190(0x216)],_0x18079c=_0x179eb8[_0x166190(0x1f0)][_0x166190(0x178)];if(!_0x1522c4)return _0x43d018['status'](0x194)['end']();_0x1522c4=path[_0x166190(0x240)](_0x1522c4);if(dbUserTable[_0x166190(0x22b)](_0x179eb8,_0x43d018,_0x166190(0x1b0),_0x166190(0x17d),_0x1522c4)==!![]){if(_0x18079c==0x1)return process[_0x166190(0x21c)]({'type':_0x166190(0x1ed),'shellType':_0x166190(0x1e6),'path':_0x1522c4}),dbFileOperationRecord[_0x166190(0x231)](_0x179eb8[_0x166190(0x190)][_0x166190(0x1b9)],{'username':_0x179eb8['currentUser'][_0x166190(0x1d0)],'targetPath':_0x1522c4,'level':dbFileOperationRecord['LEVEL_MAIN_OPERATION'],'type':dbFileOperationRecord[_0x166190(0x20d)],'state':dbFileOperationRecord['STATE_SUC']}),_0x43d018[_0x166190(0x205)]({'code':0x0,'message':_0x43d018['__'](_0x166190(0x1a1))});else fs['rm'](_0x1522c4,{'recursive':!![]},_0xaf2cf2=>{const _0x1ff20d=_0x166190;if(_0xaf2cf2)return dbFileOperationRecord[_0x1ff20d(0x231)](_0x179eb8['app']['dbOther'],{'username':_0x179eb8[_0x1ff20d(0x1cd)]['username'],'targetPath':_0x1522c4,'level':dbFileOperationRecord[_0x1ff20d(0x22c)],'type':dbFileOperationRecord[_0x1ff20d(0x20d)],'state':dbFileOperationRecord['STATE_FAIL'],'remark':fileUtil[_0x1ff20d(0x22a)](_0x43d018,_0xaf2cf2,!![])}),fileUtil['returnFileError'](_0x43d018,_0xaf2cf2);return dbFileOperationRecord['addFileOperationRecord'](_0x179eb8[_0x1ff20d(0x190)]['dbOther'],{'username':_0x179eb8[_0x1ff20d(0x1cd)]['username'],'targetPath':_0x1522c4,'level':dbFileOperationRecord[_0x1ff20d(0x22c)],'type':dbFileOperationRecord[_0x1ff20d(0x20d)],'state':dbFileOperationRecord[_0x1ff20d(0x193)]}),_0x43d018[_0x1ff20d(0x205)]({'code':0x0,'message':_0x43d018['__']('deleteSuccess')});});}}),router[_0x2092b8(0x1f6)]('/clearOperationRecord',(_0x379a43,_0x46cb45,_0xe70a8e)=>{const _0x37ebd3=_0x2092b8;if(_0x379a43['currentUser'][_0x37ebd3(0x181)]!=0x1)return _0x46cb45['json']({'code':0x66});return dbFileOperationRecord[_0x37ebd3(0x202)](_0x379a43[_0x37ebd3(0x190)][_0x37ebd3(0x1b9)]),_0x46cb45[_0x37ebd3(0x205)]({'code':0x0});}),router[_0x2092b8(0x1f6)](_0x2092b8(0x1f5),(_0x529d4d,_0x312fcb,_0x2b589c)=>{const _0x8e319d=_0x2092b8;let _0x4737e4=_0x529d4d[_0x8e319d(0x1f0)][_0x8e319d(0x1dd)],_0x59d2f6=_0x529d4d['body']['pageSize'],_0x3869b0=_0x529d4d['body'][_0x8e319d(0x21a)],_0x3b71aa=_0x529d4d[_0x8e319d(0x1f0)]['level'],_0x3a42c6=_0x529d4d[_0x8e319d(0x1f0)]['subType'],_0x53d89c=_0x529d4d['body'][_0x8e319d(0x173)],_0x584b98=_0x529d4d[_0x8e319d(0x1f0)][_0x8e319d(0x1a8)],_0x231e03;return _0x529d4d[_0x8e319d(0x1cd)][_0x8e319d(0x181)]==0x1?_0x231e03=dbFileOperationRecord[_0x8e319d(0x170)](_0x529d4d[_0x8e319d(0x190)][_0x8e319d(0x1b9)],_0x4737e4,_0x59d2f6,_0x3b71aa,_0x3869b0,_0x3a42c6,_0x53d89c,_0x584b98):_0x231e03=dbFileOperationRecord[_0x8e319d(0x170)](_0x529d4d[_0x8e319d(0x190)]['dbOther'],_0x4737e4,_0x59d2f6,_0x3b71aa,_0x3869b0,_0x3a42c6,_0x53d89c,_0x584b98,_0x529d4d['currentUser'][_0x8e319d(0x1d0)]),_0x312fcb[_0x8e319d(0x205)]({'code':0x0,'data':_0x231e03});}),router[_0x2092b8(0x1f6)](_0x2092b8(0x1e2),(_0x233cec,_0x531fd7,_0x186e92)=>{const _0x35d283=_0x2092b8;let _0x460e48=_0x233cec['body'][_0x35d283(0x165)];if(_0x460e48==_0x35d283(0x1a5)||_0x460e48==_0x35d283(0x180)){if(_0x233cec[_0x35d283(0x1cd)]['is_admin']!=0x1)return _0x531fd7['json']({'code':0x66});}if(_0x460e48==_0x35d283(0x1a5)){let _0x5f0129=_0x233cec[_0x35d283(0x1f0)]['type'],_0x44d790=_0x233cec[_0x35d283(0x1f0)]['url'],_0x465e82=_0x233cec['body'][_0x35d283(0x1d0)],_0x5b009c=_0x233cec[_0x35d283(0x1f0)][_0x35d283(0x1c6)],_0x302b62=_0x233cec['body']['username'],_0x25b770=_0x233cec[_0x35d283(0x1f0)][_0x35d283(0x1ec)],_0x124544=['local',_0x35d283(0x1ae),_0x35d283(0x1df)];if(!_0x5f0129||!_0x44d790||!_0x124544[_0x35d283(0x1f4)](_0x5f0129))return _0x233cec['app'][_0x35d283(0x1ac)](_0x531fd7,_0x531fd7['__']('operationFail'));_0x5f0129==_0x35d283(0x201)&&fileStatUtil[_0x35d283(0x1cc)](_0x44d790,()=>{const _0x3f8b1f=_0x35d283;fileStatUtil[_0x3f8b1f(0x1a2)](_0x44d790,()=>{const _0x2f8ed0=_0x3f8b1f,_0x4d5bc7=_0x2f8ed0(0x1b3);return _0x233cec['app'][_0x2f8ed0(0x1b9)][_0x2f8ed0(0x1bc)](_0x4d5bc7)['run'](_0x5f0129,_0x44d790,_0x465e82,_0x302b62,_0x25b770,_0x5b009c),_0x531fd7[_0x2f8ed0(0x205)]({'code':0x0});},()=>{const _0x412ae0=_0x3f8b1f;return _0x233cec[_0x412ae0(0x190)][_0x412ae0(0x1ac)](_0x531fd7,_0x531fd7['__'](_0x412ae0(0x1f7)));});},()=>{const _0x39358b=_0x35d283;return _0x233cec[_0x39358b(0x190)][_0x39358b(0x1ac)](_0x531fd7,_0x531fd7['__'](_0x39358b(0x164)));});}else{if(_0x460e48==_0x35d283(0x180)){let _0x310cda=_0x233cec['body']['id'];return _0x233cec[_0x35d283(0x190)]['dbOther'][_0x35d283(0x1bc)]('delete\x20from\x20path_mount\x20where\x20id=?')[_0x35d283(0x1ba)](_0x310cda),_0x531fd7[_0x35d283(0x205)]({'code':0x0});}else{if(_0x460e48==_0x35d283(0x209)){let _0x156d13=[],_0x37bb14=_0x233cec[_0x35d283(0x190)][_0x35d283(0x1b9)]['prepare'](_0x35d283(0x192))[_0x35d283(0x1cb)]();if(_0x233cec[_0x35d283(0x1cd)][_0x35d283(0x181)]==0x1)_0x156d13=_0x37bb14;else{let _0x4eeeba=dbUserTable['getUserPower'](_0x233cec['app'][_0x35d283(0x1b9)],_0x233cec['currentUser'][_0x35d283(0x1d0)],_0x35d283(0x1b0),'power_get');for(let _0x5e148d in _0x4eeeba){let _0x5d9213=_0x4eeeba[_0x5e148d]['path'][_0x35d283(0x1f8)]();_0x5d9213=path[_0x35d283(0x240)](_0x5d9213);for(let _0x1cec38 in _0x37bb14){try{if(_0x37bb14[_0x1cec38]['url']&&_0x5d9213){let _0x12b0a0=_0x37bb14[_0x1cec38][_0x35d283(0x172)][_0x35d283(0x1f8)]();_0x12b0a0[_0x35d283(0x1fc)](':')&&_0x12b0a0[_0x35d283(0x1b6)]==0x2&&(_0x12b0a0=_0x12b0a0+path['sep']),_0x12b0a0=path[_0x35d283(0x240)](_0x12b0a0)[_0x35d283(0x1f8)](),(_0x5d9213==_0x12b0a0||_0x12b0a0['startsWith'](path[_0x35d283(0x240)](_0x5d9213+path[_0x35d283(0x1af)])))&&_0x156d13[_0x35d283(0x1ca)](_0x37bb14[_0x1cec38]);}}catch(_0x226ffd){continue;}}}}return _0x531fd7[_0x35d283(0x205)]({'code':0x0,'data':_0x156d13});}}}});function getRandomString(_0x2f500e){const _0x546990=_0x2092b8;let _0x7d5faf='';const _0x395143=_0x546990(0x1d5),_0x47a97f=_0x395143[_0x546990(0x1b6)];for(let _0x483038=0x0;_0x483038<_0x2f500e;_0x483038++){_0x7d5faf+=_0x395143[_0x546990(0x223)](Math[_0x546990(0x16f)](Math['random']()*_0x47a97f));}return _0x7d5faf;}router['post'](_0x2092b8(0x194),(_0x403e7e,_0x2eaccc,_0x5cfd30)=>{const _0x70f6cb=_0x2092b8;let _0x341c4f=[];return _0x403e7e[_0x70f6cb(0x1cd)][_0x70f6cb(0x181)]==0x1?_0x341c4f=_0x403e7e[_0x70f6cb(0x190)][_0x70f6cb(0x1b9)][_0x70f6cb(0x1bc)]('SELECT\x20*\x20FROM\x20share_temp')['all']():_0x341c4f=_0x403e7e[_0x70f6cb(0x190)][_0x70f6cb(0x1b9)][_0x70f6cb(0x1bc)](_0x70f6cb(0x20e))['all'](_0x403e7e[_0x70f6cb(0x1cd)]['id']),_0x2eaccc[_0x70f6cb(0x205)]({'code':0x0,'data':_0x341c4f});}),router[_0x2092b8(0x1f6)]('/tempShare',(_0x2cc649,_0x51659b,_0x459ece)=>{const _0x4df1a0=_0x2092b8;let _0x23aa31=_0x2cc649[_0x4df1a0(0x1f0)][_0x4df1a0(0x165)];if(_0x23aa31==_0x4df1a0(0x1a5))try{if(!_0x2cc649[_0x4df1a0(0x1f0)][_0x4df1a0(0x175)])return _0x2cc649[_0x4df1a0(0x190)]['returnErrMsg'](_0x51659b,_0x4df1a0(0x211));let _0xf7368a=fileUtil[_0x4df1a0(0x1ad)](_0x2cc649[_0x4df1a0(0x1f0)]['path']);function _0x1392ce(){const _0x14b8c8=_0x4df1a0;if(dbUserTable['doUserCanGet'](_0x2cc649,_0x51659b,'','power_get',_0xf7368a)==!![]){let _0x5ccf6e=_0x2cc649['body'][_0x14b8c8(0x1ec)]?_0x2cc649['body'][_0x14b8c8(0x1ec)]:'',_0x3e15f6=new Date()[_0x14b8c8(0x19b)](),_0x50dc59=getRandomString(0x5),_0x1c7be4=_0x2cc649[_0x14b8c8(0x190)][_0x14b8c8(0x1b9)][_0x14b8c8(0x1bc)](_0x14b8c8(0x226))[_0x14b8c8(0x209)](_0x50dc59);if(_0x1c7be4)return _0x1392ce();let _0x228653=_0x2cc649[_0x14b8c8(0x1f0)][_0x14b8c8(0x23f)]?_0x2cc649['body'][_0x14b8c8(0x23f)]:0x1e,_0x46bd2c=0xe10*0x3e8*0x18*_0x228653+_0x3e15f6;return _0x2cc649['app'][_0x14b8c8(0x1b9)]['prepare'](_0x14b8c8(0x20f))['run'](_0xf7368a,_0x5ccf6e,_0x50dc59,_0x3e15f6,_0x46bd2c,_0x2cc649[_0x14b8c8(0x1cd)]['id']),_0x51659b[_0x14b8c8(0x205)]({'code':0x0,'token':_0x50dc59});}}return _0x1392ce();}catch(_0x124f9e){return console['log'](_0x124f9e),_0x2cc649[_0x4df1a0(0x190)][_0x4df1a0(0x1ac)](_0x51659b,_0x4df1a0(0x211));}else{if(_0x23aa31==_0x4df1a0(0x180)){let _0x1aa0a0=_0x2cc649['body'][_0x4df1a0(0x1d6)];return _0x2cc649[_0x4df1a0(0x1cd)][_0x4df1a0(0x181)]==0x1?_0x2cc649[_0x4df1a0(0x190)]['dbOther'][_0x4df1a0(0x1bc)](_0x4df1a0(0x207))[_0x4df1a0(0x1ba)](_0x1aa0a0):_0x2cc649[_0x4df1a0(0x190)][_0x4df1a0(0x1b9)][_0x4df1a0(0x1bc)](_0x4df1a0(0x1bb))['run'](_0x1aa0a0,_0x2cc649[_0x4df1a0(0x1cd)]['id']),_0x51659b[_0x4df1a0(0x205)]({'code':0x0});}}}),router['post']('/getTempShareFiles',(_0x1344d7,_0xe4d0f6,_0x548ebc)=>{const _0x2d04cf=_0x2092b8;let _0x526294=_0x1344d7[_0x2d04cf(0x1f0)][_0x2d04cf(0x183)]||_0x1344d7[_0x2d04cf(0x1f0)]['st'],_0x574df8=_0x1344d7[_0x2d04cf(0x1f0)][_0x2d04cf(0x1c1)],_0x108066=_0x1344d7[_0x2d04cf(0x1f0)][_0x2d04cf(0x1ec)],_0x6994b=[],_0x206e3b=dbConfigTable['findByTitleArr'](_0x1344d7['app']['dbOther'],_0x2d04cf(0x206)),_0x1f8ee3={'code':0x0,'data':{'customConfig':_0x206e3b,'parent':_0x574df8,'children':_0x6994b,'sep':path[_0x2d04cf(0x1af)],'platform':platform}};if(!_0x526294)return _0xe4d0f6[_0x2d04cf(0x205)](_0x1f8ee3);let _0x274a3a=dbUserTable[_0x2d04cf(0x225)](_0x1344d7[_0x2d04cf(0x190)][_0x2d04cf(0x1b9)],_0x526294);if(!_0x274a3a)return _0xe4d0f6['json'](_0x1f8ee3);if(_0x274a3a[_0x2d04cf(0x1ec)]){if(!_0x108066)return _0xe4d0f6[_0x2d04cf(0x205)]({'code':0x2});if(_0x274a3a[_0x2d04cf(0x1ec)]!=_0x108066)return _0xe4d0f6[_0x2d04cf(0x205)]({'code':0x2,'message':_0xe4d0f6['__'](_0x2d04cf(0x15e))});}function _0x128117(){const _0x444a47=_0x2d04cf;fs[_0x444a47(0x19e)](_0x274a3a['path'],(_0x3af817,_0x5227ce)=>{const _0x31f910=_0x444a47;if(_0x3af817)return _0xe4d0f6[_0x31f910(0x205)](_0x1f8ee3);return _0x1f8ee3[_0x31f910(0x23b)][_0x31f910(0x16d)][_0x31f910(0x1ca)]({'type':_0x5227ce['isFile']()?0x1:0x2,'name':path[_0x31f910(0x213)](_0x274a3a[_0x31f910(0x175)]),'fileFullPath':_0x274a3a[_0x31f910(0x175)]}),_0xe4d0f6['json'](_0x1f8ee3);});}if(!_0x574df8)_0x128117();else{let _0x41d916=dbUserTable[_0x2d04cf(0x1da)](_0x1344d7[_0x2d04cf(0x190)][_0x2d04cf(0x1b9)],_0x526294,_0x574df8,_0x108066);if(!_0x41d916)return console[_0x2d04cf(0x19d)]('no\x20permission\x20',_0x574df8),_0x128117();fs[_0x2d04cf(0x222)](_0x574df8,{'withFileTypes':!![]},(_0x57153a,_0x3a1cc5)=>{const _0x26dc16=_0x2d04cf;if(_0x57153a)return _0xe4d0f6[_0x26dc16(0x205)](_0x1f8ee3);let _0x4d93f3=0x0;if(_0x3a1cc5[_0x26dc16(0x1b6)]<0x1)return _0xe4d0f6[_0x26dc16(0x205)](_0x1f8ee3);for(let _0xede80e=0x0;_0xede80e<_0x3a1cc5[_0x26dc16(0x1b6)];_0xede80e++){let _0x882abc=_0x3a1cc5[_0xede80e],_0x2189c4=_0x3a1cc5[_0xede80e]['name'];if(_0x2189c4['length']>0x0){if(_0x2189c4[0x0]=='.'){_0x4d93f3+=0x1;if(_0x4d93f3>=_0x3a1cc5[_0x26dc16(0x1b6)])return _0xe4d0f6[_0x26dc16(0x205)](_0x1f8ee3);continue;}if(/[A-Z]:\\/i[_0x26dc16(0x19c)](_0x574df8)&&_0x574df8[_0x26dc16(0x1b6)]<=0x3){if(win32ExcludeList[_0x26dc16(0x1f4)](_0x2189c4)||_0x2189c4[_0x26dc16(0x1fc)]('.sys')||_0x2189c4[_0x26dc16(0x1fc)](_0x26dc16(0x18b))){_0x4d93f3+=0x1;if(_0x4d93f3>=_0x3a1cc5[_0x26dc16(0x1b6)])return _0xe4d0f6['json'](_0x1f8ee3);continue;}}}let _0x849de9=path[_0x26dc16(0x240)](_0x574df8,_0x2189c4);fs['stat'](_0x849de9,(_0x2e7355,_0x225dd2)=>{const _0x213bce=_0x26dc16;_0x4d93f3+=0x1;let _0x1010eb=_0x882abc[_0x213bce(0x1e7)](),_0x1519d5=_0x882abc[_0x213bce(0x1fd)](),_0x24d23a={'name':_0x2189c4,'fileFullPath':_0x849de9};!_0x2e7355&&_0x225dd2&&(_0x24d23a[_0x213bce(0x1ea)]=_0x225dd2['size'],_0x24d23a[_0x213bce(0x232)]=_0x225dd2[_0x213bce(0x17e)]||_0x225dd2[_0x213bce(0x17a)]);_0x1010eb?_0x24d23a[_0x213bce(0x21a)]=0x1:_0x24d23a[_0x213bce(0x21a)]=0x2;_0x1f8ee3['data'][_0x213bce(0x16d)][_0x213bce(0x1ca)](_0x24d23a);if(_0x4d93f3>=_0x3a1cc5[_0x213bce(0x1b6)])return _0xe4d0f6[_0x213bce(0x205)](_0x1f8ee3);});}});}}),module[_0x2092b8(0x1ab)]=router;