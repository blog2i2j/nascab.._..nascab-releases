const _0x54d231=_0x331d;function _0x331d(_0x2eda35,_0x55eb5c){const _0x5268d5=_0x5268();return _0x331d=function(_0x331dd2,_0x438fe6){_0x331dd2=_0x331dd2-0x7f;let _0x38ebfd=_0x5268d5[_0x331dd2];return _0x38ebfd;},_0x331d(_0x2eda35,_0x55eb5c);}(function(_0x552853,_0x4adfef){const _0x1b22c1=_0x331d,_0x117e2c=_0x552853();while(!![]){try{const _0x47b009=-parseInt(_0x1b22c1(0x99))/0x1*(parseInt(_0x1b22c1(0xa0))/0x2)+parseInt(_0x1b22c1(0x8b))/0x3+-parseInt(_0x1b22c1(0x91))/0x4+-parseInt(_0x1b22c1(0x87))/0x5*(-parseInt(_0x1b22c1(0x93))/0x6)+parseInt(_0x1b22c1(0x8f))/0x7+parseInt(_0x1b22c1(0x83))/0x8+parseInt(_0x1b22c1(0x94))/0x9;if(_0x47b009===_0x4adfef)break;else _0x117e2c['push'](_0x117e2c['shift']());}catch(_0x20ec2b){_0x117e2c['push'](_0x117e2c['shift']());}}}(_0x5268,0x302e6));const path=require(_0x54d231(0x8a));function _0x5268(){const _0x38387c=['sharp','294750CLUedt','441765psDRQE','.zip','extname','.cbr','../myConfig/config','3937MlhjuP','then','toLowerCase','readFile','entryName','name','getSharpDealedBuffer','44nnIjKA','extraction','length','isDirectory','getZipCover','push','log','adm-zip','toBuffer','getInnerFileContent','getFileList','.cbz','.epub','./arrayUtil','./zipEpubUtil','112672MbZWQd','sortFileNamesByNumber','from','imgTypeList','20QcTnCK','includes','createExtractorFromData','path','990309PZACdj','getZipInnerFileList','forEach','不支持的压缩文件格式','54551kRKgwt','fileHeaders','1254404CxlohB'];_0x5268=function(){return _0x38387c;};return _0x5268();}let zipUtil={};const sharp=require(_0x54d231(0x92)),AdmZip=require(_0x54d231(0xa7)),unrar=require('node-unrar-js'),fs=require('fs'),config=require(_0x54d231(0x98)),EPub=require('epub'),zipEpubUtil=require(_0x54d231(0x82)),arrayUtil=require(_0x54d231(0x81));zipUtil['getZipInnerFileList']=(_0xcc89ef,_0x948601)=>{return new Promise((_0x5326,_0x46ba5e)=>{const _0xaa243d=_0x331d;let _0x37a625=[];try{let _0x51bbe7=path['extname'](_0xcc89ef);_0x51bbe7&&(_0x51bbe7=_0x51bbe7[_0xaa243d(0x9b)]());if(_0x51bbe7==_0xaa243d(0x95)||_0x51bbe7==_0xaa243d(0x7f)){const _0x285780=new AdmZip(_0xcc89ef);_0x285780['getEntries']()[_0xaa243d(0x8d)](_0x3ca2b7=>{const _0x1807b5=_0xaa243d;let _0x27e603=!![],_0x519438=path[_0x1807b5(0x96)](_0x3ca2b7['entryName']);_0x948601&&(_0x27e603=![],_0x519438&&config['imgTypeList'][_0x1807b5(0x88)](_0x519438['toLowerCase']())&&(_0x27e603=!![])),_0x27e603&&_0x37a625[_0x1807b5(0xa5)]({'isDir':_0x3ca2b7[_0x1807b5(0xa3)],'name':_0x3ca2b7[_0x1807b5(0x9d)]});}),_0x5326(arrayUtil['sortFileNamesByNumber'](_0x37a625,'name'));}else{if(_0x51bbe7=='.rar'||_0x51bbe7==_0xaa243d(0x97))fs[_0xaa243d(0x9c)](_0xcc89ef,(_0x39a5ac,_0x5b6a2a)=>{unrar['createExtractorFromData']({'data':_0x5b6a2a})['then'](_0x2e23cc=>{const _0x541a19=_0x331d,_0x3482c1=_0x2e23cc[_0x541a19(0xaa)](),_0x2f123a=[..._0x3482c1[_0x541a19(0x90)]];for(let _0xc103a of _0x2f123a){let _0x42b351=!![],_0x39a25e=path[_0x541a19(0x96)](_0xc103a[_0x541a19(0x9e)]);_0x948601&&(_0x42b351=![],_0x39a25e&&config[_0x541a19(0x86)][_0x541a19(0x88)](_0x39a25e[_0x541a19(0x9b)]())&&(_0x42b351=!![])),_0x42b351&&_0x37a625[_0x541a19(0xa5)]({'isDir':![],'name':_0xc103a[_0x541a19(0x9e)]});}_0x5326(arrayUtil[_0x541a19(0x84)](_0x37a625,_0x541a19(0x9e)));});});else _0x51bbe7=='.epub'?zipEpubUtil['getEpubImageList'](_0xcc89ef)[_0xaa243d(0x9a)](_0x531144=>{const _0x197e30=_0xaa243d;for(let _0x1e892d of _0x531144){_0x37a625[_0x197e30(0xa5)]({'isDir':![],'name':_0x1e892d});}_0x5326(_0x37a625);}):(console[_0xaa243d(0xa6)](_0xaa243d(0x8e),_0xcc89ef),_0x5326([]));}}catch(_0x251652){console[_0xaa243d(0xa6)](_0x251652),_0x5326([]);}});},zipUtil[_0x54d231(0x9f)]=(_0x4c907c,_0x538099)=>{return new Promise((_0x131cb1,_0x554d52)=>{const _0x29c25a=_0x331d;let _0x5cd559=path[_0x29c25a(0x96)](_0x538099);_0x5cd559&&config[_0x29c25a(0x86)][_0x29c25a(0x88)](_0x5cd559[_0x29c25a(0x9b)]())?sharp(_0x4c907c,{'failOnError':![]})['jpeg']({'quality':0x4d})[_0x29c25a(0xa8)]()['then'](_0x16d478=>{_0x131cb1(_0x16d478);})['catch'](_0x473a60=>{const _0x5d4fe8=_0x29c25a;console[_0x5d4fe8(0xa6)](_0x473a60),_0x131cb1(_0x4c907c);}):_0x131cb1(_0x4c907c);});},zipUtil[_0x54d231(0xa9)]=(_0x402617,_0x42ad48)=>{return new Promise((_0x243fd5,_0x4e32a3)=>{const _0x42372c=_0x331d;try{let _0x786605=path[_0x42372c(0x96)](_0x402617);_0x786605&&(_0x786605=_0x786605[_0x42372c(0x9b)]());if(_0x786605==_0x42372c(0x95)||_0x786605==_0x42372c(0x7f)||_0x786605==_0x42372c(0x80)){const _0x22bc8f=new AdmZip(_0x402617);let _0x1aba88=_0x22bc8f[_0x42372c(0x9c)](_0x42ad48);zipUtil[_0x42372c(0x9f)](_0x1aba88,_0x42ad48)[_0x42372c(0x9a)](_0x321702=>{_0x243fd5(_0x321702);});}else _0x786605=='.rar'||_0x786605==_0x42372c(0x97)?fs[_0x42372c(0x9c)](_0x402617,(_0x50ee11,_0x1b64e1)=>{const _0x45e9f3=_0x42372c;if(_0x50ee11)return console[_0x45e9f3(0xa6)](_0x50ee11),_0x243fd5(null);unrar[_0x45e9f3(0x89)]({'data':_0x1b64e1})[_0x45e9f3(0x9a)](_0x244013=>{const _0x395dba=_0x45e9f3;try{const _0x3dbae8=_0x244013['extract']({'files':[_0x42ad48]}),_0x4e5436=[..._0x3dbae8['files']];if(_0x4e5436&&_0x4e5436[_0x395dba(0xa2)]>0x0){let _0x97c855=Buffer[_0x395dba(0x85)](_0x4e5436[0x0][_0x395dba(0xa1)]);zipUtil[_0x395dba(0x9f)](_0x97c855,_0x42ad48)['then'](_0x52eccb=>{_0x243fd5(_0x52eccb);});}else _0x243fd5(null);}catch(_0x179815){_0x243fd5(null);}});}):(console['log']('不支持的压缩文件格式',_0x402617),_0x243fd5(null));}catch(_0x5da498){console['log'](_0x5da498),_0x243fd5(null);}});},zipUtil[_0x54d231(0xa4)]=_0x57421c=>{return new Promise((_0x40dfa5,_0xa44f45)=>{const _0x2356fa=_0x331d;try{zipUtil[_0x2356fa(0x8c)](_0x57421c,!![])[_0x2356fa(0x9a)](_0x3cb5c7=>{const _0x21c45d=_0x2356fa;if(_0x3cb5c7['length']>0x0){let _0x285472=_0x3cb5c7[0x0];zipUtil[_0x21c45d(0xa9)](_0x57421c,_0x285472[_0x21c45d(0x9e)])[_0x21c45d(0x9a)](_0x342cef=>{_0x40dfa5({'dealedBuffer':_0x342cef,'fileCount':_0x3cb5c7['length']});});}else _0x40dfa5(null);});}catch(_0x3dbe3a){_0x40dfa5(null);}});},module['exports']=zipUtil;