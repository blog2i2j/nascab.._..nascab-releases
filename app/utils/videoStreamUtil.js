const _0x50281d=_0x3161;function _0x55b1(){const _0x8f2a1e=['movie_regions','2101824NYQUMl','DURATION','91618deMxfy','403712hQSmfr','trim','rotate','movie_genres','lastTimeStampMatchMovieInfo','file_index_movie','prepare','split','getVideoOriginalTime','run','push','getTime','height','110442cOwZjt','REPLACE\x20INTO\x20config(title,value)\x20values(\x27lastTimeStampMatchMovieInfo\x27,','../libs/nasTrans','\x27,\x20\x27','com.apple.quicktime.creationdate','N/A','1704rbDSbB','saveLastMatchTime','getVideoMeta','DELETE\x20FROM\x20movie_keys\x20where\x201=1','parseVideoWH','streams','duration','tags','661584mZuaXw','video','width','movie_language','\x20WHERE\x20title=\x27lastTimeStampMatchMovieInfo\x27','ffprobe','indexOf','20oUeHVk','\x20movie_info_state=1\x20and\x20is_file=1\x20and\x20type=2','4hUNPzf','includes','UPDATE\x20movie_keys\x20SET\x20index_count=0\x20where\x201=1','codec_type','REPLACE\x20INTO\x20\x20movie_keys(key_type,key_value,index_count)\x20VALUES(\x27','20XJOTgX','format','getAllByWhere','UPDATE\x20config\x20SET\x20value=','rotation','2133307TDzYOo','findByTitle','length','creation_time','FFmpeg','value','763fXixxE','parseMovieKeys','exports'];_0x55b1=function(){return _0x8f2a1e;};return _0x55b1();}function _0x3161(_0x223d03,_0x34dde2){const _0x55b13d=_0x55b1();return _0x3161=function(_0x3161e7,_0x53e7bd){_0x3161e7=_0x3161e7-0x82;let _0x4128e6=_0x55b13d[_0x3161e7];return _0x4128e6;},_0x3161(_0x223d03,_0x34dde2);}(function(_0x2babfe,_0x27d032){const _0x56928f=_0x3161,_0x51d46f=_0x2babfe();while(!![]){try{const _0x4fee0d=-parseInt(_0x56928f(0xa8))/0x1*(-parseInt(_0x56928f(0x83))/0x2)+-parseInt(_0x56928f(0x9f))/0x3+parseInt(_0x56928f(0x84))/0x4+-parseInt(_0x56928f(0xa6))/0x5*(parseInt(_0x56928f(0x91))/0x6)+-parseInt(_0x56928f(0xb8))/0x7*(parseInt(_0x56928f(0x97))/0x8)+-parseInt(_0x56928f(0xbc))/0x9+-parseInt(_0x56928f(0xad))/0xa*(-parseInt(_0x56928f(0xb2))/0xb);if(_0x4fee0d===_0x27d032)break;else _0x51d46f['push'](_0x51d46f['shift']());}catch(_0x3320a8){_0x51d46f['push'](_0x51d46f['shift']());}}}(_0x55b1,0x1d929));let FFmpeg=require(_0x50281d(0x93))[_0x50281d(0xb6)];const dbConfigTable=require('../db/dbConfigTable'),dbFileIndexTable=require('../db/dbFileIndexTable'),transCodeUtil=require('./transCodeUtil');let videoStreamUtil={};function timeToSec(_0x17e08e){const _0x54100e=_0x50281d;var _0x441464='',_0x2803dc=_0x17e08e[_0x54100e(0x8b)](':')[0x0],_0x480610=_0x17e08e[_0x54100e(0x8b)](':')[0x1],_0x153c40=_0x17e08e['split'](':')[0x2];return _0x441464=parseFloat(_0x2803dc*0xe10)+parseFloat(_0x480610*0x3c)+parseFloat(_0x153c40),_0x441464;};videoStreamUtil[_0x50281d(0x98)]=function(_0x4680d3){const _0x4d2269=_0x50281d;let _0x28fb11=dbConfigTable[_0x4d2269(0xb3)](_0x4680d3,_0x4d2269(0x88));!_0x28fb11?_0x4680d3[_0x4d2269(0x8a)](_0x4d2269(0x92)+new Date()['getTime']()+')')['run']():_0x4680d3[_0x4d2269(0x8a)](_0x4d2269(0xb0)+new Date()[_0x4d2269(0x8f)]()+_0x4d2269(0xa3))[_0x4d2269(0x8d)]();};let lastMovieInfoUpdateTime=0x0;videoStreamUtil['goParseMoviesKeys']=function(_0x482131,_0x2c8920,_0x3845d3){const _0x15edc0=_0x50281d;let _0x4451ac=dbConfigTable['findByTitle'](_0x482131,_0x15edc0(0x88));if(_0x3845d3)videoStreamUtil['parseMovieKeys'](_0x2c8920);else _0x4451ac&&lastMovieInfoUpdateTime!=_0x4451ac[_0x15edc0(0xb7)]&&(videoStreamUtil[_0x15edc0(0xb9)](_0x2c8920),lastMovieInfoUpdateTime=_0x4451ac['value']);};let isParsingMovie=![];videoStreamUtil[_0x50281d(0xb9)]=function(_0x2af03c){const _0x3d266f=_0x50281d;if(isParsingMovie)return;let _0x42830a={};isParsingMovie=!![];let _0x5aacb4=dbFileIndexTable[_0x3d266f(0xaf)](_0x2af03c,_0x3d266f(0xa7),'movie_regions,movie_language,movie_genres',_0x3d266f(0x89)),_0x5572d9=[],_0x1ae08e=[],_0x1f76d3=[];function _0x310a9f(_0x3ec762,_0x21bdee,_0x362323){const _0x8977f9=_0x3d266f;if(_0x3ec762){if(_0x3ec762[_0x8977f9(0xa5)]('/')!=-0x1){let _0x17e357=_0x3ec762[_0x8977f9(0x8b)]('/');for(let _0x11102f in _0x17e357){_0x17e357[_0x11102f]&&(!_0x21bdee[_0x8977f9(0xa9)](_0x17e357[_0x11102f]['trim']())?(_0x21bdee[_0x8977f9(0x8e)](_0x17e357[_0x11102f][_0x8977f9(0x85)]()),_0x42830a[_0x362323+_0x17e357[_0x11102f]['trim']()]=0x1):_0x42830a[_0x362323+_0x17e357[_0x11102f][_0x8977f9(0x85)]()]+=0x1);}}else!_0x21bdee['includes'](_0x3ec762[_0x8977f9(0x85)]())?(_0x21bdee['push'](_0x3ec762[_0x8977f9(0x85)]()),_0x42830a[_0x362323+_0x3ec762[_0x8977f9(0x85)]()]=0x1):_0x42830a[_0x362323+_0x3ec762['trim']()]+=0x1;}for(let _0x2f8574=0x0;_0x2f8574<_0x21bdee[_0x8977f9(0xb4)];_0x2f8574++){const _0x512ca6=_0x8977f9(0xac)+_0x362323+_0x8977f9(0x94)+_0x21bdee[_0x2f8574]+'\x27,'+_0x42830a[_0x362323+_0x21bdee[_0x2f8574]]+')';_0x2af03c[_0x8977f9(0x8a)](_0x512ca6)[_0x8977f9(0x8d)]();}}if(_0x5aacb4&&_0x5aacb4[_0x3d266f(0xb4)]>0x0){_0x2af03c[_0x3d266f(0x8a)](_0x3d266f(0xaa))[_0x3d266f(0x8d)]();for(let _0x378b37=0x0;_0x378b37<_0x5aacb4[_0x3d266f(0xb4)];_0x378b37++){let _0x46d7a3=_0x5aacb4[_0x378b37],_0x41e029=_0x46d7a3[_0x3d266f(0x87)],_0x1398fe=_0x46d7a3['movie_language'],_0x2c7f2d=_0x46d7a3[_0x3d266f(0xbb)];_0x310a9f(_0x41e029,_0x1f76d3,'movie_genres'),_0x310a9f(_0x1398fe,_0x5572d9,_0x3d266f(0xa2)),_0x310a9f(_0x2c7f2d,_0x1ae08e,_0x3d266f(0xbb));}}else _0x2af03c[_0x3d266f(0x8a)](_0x3d266f(0x9a))['run']();isParsingMovie=![];},videoStreamUtil[_0x50281d(0x8c)]=function(_0x15c8cb){const _0x4af62b=_0x50281d;let _0x459009=new Date()[_0x4af62b(0x8f)]();if(_0x15c8cb&&_0x15c8cb[_0x4af62b(0xae)]&&_0x15c8cb[_0x4af62b(0xae)][_0x4af62b(0x9e)]){let _0x45eb13=_0x15c8cb[_0x4af62b(0xae)][_0x4af62b(0x9e)][_0x4af62b(0x95)],_0x5f4c3a=null;_0x45eb13&&(_0x5f4c3a=_0x45eb13,_0x459009=new Date(_0x5f4c3a)[_0x4af62b(0x8f)]()),!_0x5f4c3a&&_0x15c8cb['format'][_0x4af62b(0x9e)][_0x4af62b(0xb5)]&&(_0x5f4c3a=_0x15c8cb[_0x4af62b(0xae)][_0x4af62b(0x9e)][_0x4af62b(0xb5)],_0x459009=new Date(_0x5f4c3a)[_0x4af62b(0x8f)]());}return _0x459009;},videoStreamUtil['getDurationFromStream']=function(_0x5ea109){const _0x5cf913=_0x50281d;let _0x3e2060=_0x5ea109[_0x5cf913(0x9c)];if(_0x5ea109&&_0x5ea109[_0x5cf913(0xae)]&&_0x5ea109[_0x5cf913(0xae)][_0x5cf913(0x9d)]){let _0x6e6b6b=_0x5ea109['format']['duration'];if(_0x6e6b6b&&_0x6e6b6b!=_0x5cf913(0x96)&&!isNaN(_0x6e6b6b)&&_0x6e6b6b>0x0)return _0x6e6b6b;}for(let _0xe06777=0x0;_0xe06777<_0x3e2060[_0x5cf913(0xb4)];_0xe06777++){let _0x492a54=_0x3e2060[_0xe06777];if(_0x492a54[_0x5cf913(0x9d)]&&_0x492a54[_0x5cf913(0x9d)]!='N/A'&&!isNaN(_0x492a54[_0x5cf913(0x9d)])&&_0x492a54[_0x5cf913(0x9d)]>0x0)return _0x492a54['duration'];if(_0x492a54[_0x5cf913(0x9e)]){if(_0x492a54[_0x5cf913(0x9e)]['DURATION']||_0x492a54['tags'][_0x5cf913(0x9d)]){let _0x50fcbd=_0x492a54['tags'][_0x5cf913(0x82)]||_0x492a54[_0x5cf913(0x9e)][_0x5cf913(0x9d)];if(_0x50fcbd[_0x5cf913(0xa5)](':')!=-0x1)return timeToSec(_0x50fcbd);}}}return 0x0;},videoStreamUtil[_0x50281d(0x99)]=function(_0x14a2d1){return new Promise((_0x576f94,_0x2ecaef)=>{const _0x152116=_0x3161;FFmpeg(_0x14a2d1)[_0x152116(0xa4)]((_0x1705f4,_0x3349b7)=>{_0x1705f4?_0x2ecaef(_0x1705f4):_0x576f94(_0x3349b7);});});},videoStreamUtil[_0x50281d(0x9b)]=function(_0xd91bf7){const _0x1d8eb0=_0x50281d;let _0x28165e=0x0,_0x3cbab8=0x0,_0x321b3d=0x0,_0x4f7eb3=null;for(let _0x37899d=0x0;_0x37899d<_0xd91bf7[_0x1d8eb0(0xb4)];_0x37899d++){let _0x4fe152=_0xd91bf7[_0x37899d];_0x4fe152[_0x1d8eb0(0xab)]==_0x1d8eb0(0xa0)&&(_0x4f7eb3=_0x4fe152,_0x4fe152[_0x1d8eb0(0xb1)]&&(_0x321b3d=_0x4fe152[_0x1d8eb0(0xb1)]),!_0x321b3d&&(_0x4fe152['tags']&&_0x4fe152[_0x1d8eb0(0x9e)][_0x1d8eb0(0x86)]&&(_0x321b3d=_0x4fe152[_0x1d8eb0(0x9e)][_0x1d8eb0(0x86)])));if(_0x4fe152[_0x1d8eb0(0xa1)]&&_0x4fe152[_0x1d8eb0(0x90)]){if(_0x4fe152[_0x1d8eb0(0xa1)]!=_0x1d8eb0(0x96)&&!isNaN(_0x4fe152[_0x1d8eb0(0xa1)])&&_0x4fe152['width']>0x0){_0x28165e=_0x4fe152[_0x1d8eb0(0xa1)],_0x3cbab8=_0x4fe152[_0x1d8eb0(0x90)];break;}}}if((_0x321b3d==0x5a||_0x321b3d==-0x5a||_0x321b3d==0x10e)&&_0x28165e&&_0x3cbab8){let _0x319b71=_0x28165e,_0x302e2e=_0x3cbab8;_0x28165e=_0x302e2e,_0x3cbab8=_0x319b71;}return{'videoHeight':_0x3cbab8,'videoWidth':_0x28165e,'videoStream':_0x4f7eb3};},module[_0x50281d(0xba)]=videoStreamUtil;