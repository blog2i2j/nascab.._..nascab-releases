const _0x1c3526=_0x166a;(function(_0x211440,_0x4ccd88){const _0x5748d3=_0x166a,_0x3c9174=_0x211440();while(!![]){try{const _0x2c61a3=parseInt(_0x5748d3(0x123))/0x1+-parseInt(_0x5748d3(0x134))/0x2*(parseInt(_0x5748d3(0x13f))/0x3)+parseInt(_0x5748d3(0x127))/0x4*(-parseInt(_0x5748d3(0x12f))/0x5)+parseInt(_0x5748d3(0x129))/0x6*(-parseInt(_0x5748d3(0x124))/0x7)+-parseInt(_0x5748d3(0x121))/0x8+-parseInt(_0x5748d3(0x13b))/0x9+parseInt(_0x5748d3(0x122))/0xa;if(_0x2c61a3===_0x4ccd88)break;else _0x3c9174['push'](_0x3c9174['shift']());}catch(_0x556dee){_0x3c9174['push'](_0x3c9174['shift']());}}}(_0x54a6,0x54d3c));let FFmpeg=require(_0x1c3526(0x149))['FFmpeg'];const dbConfigTable=require('../db/dbConfigTable'),dbFileIndexTable=require(_0x1c3526(0x141)),transCodeUtil=require(_0x1c3526(0x138));let videoStreamUtil={};function timeToSec(_0x43d65d){const _0x40725e=_0x1c3526;var _0x9ba16='',_0x3f666c=_0x43d65d[_0x40725e(0x12c)](':')[0x0],_0x3d2812=_0x43d65d['split'](':')[0x1],_0x44c256=_0x43d65d[_0x40725e(0x12c)](':')[0x2];return _0x9ba16=parseFloat(_0x3f666c*0xe10)+parseFloat(_0x3d2812*0x3c)+parseFloat(_0x44c256),_0x9ba16;};function _0x166a(_0x18339e,_0x2fd46d){const _0x54a61c=_0x54a6();return _0x166a=function(_0x166aa4,_0x43f91f){_0x166aa4=_0x166aa4-0x121;let _0x13860a=_0x54a61c[_0x166aa4];return _0x13860a;},_0x166a(_0x18339e,_0x2fd46d);}videoStreamUtil['saveLastMatchTime']=function(_0x225e6d){const _0x5ee631=_0x1c3526;let _0x65eb1e=dbConfigTable['findByTitle'](_0x225e6d,_0x5ee631(0x13e));!_0x65eb1e?_0x225e6d[_0x5ee631(0x12b)]('REPLACE\x20INTO\x20config(title,value)\x20values(\x27lastTimeStampMatchMovieInfo\x27,'+new Date()[_0x5ee631(0x150)]()+')')[_0x5ee631(0x144)]():_0x225e6d[_0x5ee631(0x12b)](_0x5ee631(0x142)+new Date()[_0x5ee631(0x150)]()+'\x20WHERE\x20title=\x27lastTimeStampMatchMovieInfo\x27')[_0x5ee631(0x144)]();};let lastMovieInfoUpdateTime=0x0;videoStreamUtil[_0x1c3526(0x128)]=function(_0x34e743,_0x465d8a,_0x47254d){const _0x59d583=_0x1c3526;let _0x52d92d=dbConfigTable[_0x59d583(0x145)](_0x34e743,_0x59d583(0x13e));if(_0x47254d)videoStreamUtil[_0x59d583(0x14a)](_0x465d8a);else _0x52d92d&&lastMovieInfoUpdateTime!=_0x52d92d[_0x59d583(0x140)]&&(videoStreamUtil[_0x59d583(0x14a)](_0x465d8a),lastMovieInfoUpdateTime=_0x52d92d[_0x59d583(0x140)]);};function _0x54a6(){const _0x30f6eb=['push','format','ffprobe','getDurationFromStream','movie_genres','getTime','movie_language','DURATION','1216552JWEGsz','11972740IjdfQx','518467HOPYny','491806iaKPXP','rotation','getAllByWhere','347948PTxByk','goParseMoviesKeys','48DdcxvC','tags','prepare','split','includes','\x20movie_info_state=1\x20and\x20is_file=1\x20and\x20type=2','15EUdrzX','creation_time','exports','N/A','height','10Khwgiw','rotate','width','duration','./transCodeUtil','codec_type','trim','3338460wnqIgp','movie_regions','parseVideoWH','lastTimeStampMatchMovieInfo','13353CRQYpu','value','../db/dbFileIndexTable','UPDATE\x20config\x20SET\x20value=','indexOf','run','findByTitle','length','DELETE\x20FROM\x20movie_keys\x20where\x201=1','UPDATE\x20movie_keys\x20SET\x20index_count=0\x20where\x201=1','../libs/nasTrans','parseMovieKeys'];_0x54a6=function(){return _0x30f6eb;};return _0x54a6();}let isParsingMovie=![];videoStreamUtil[_0x1c3526(0x14a)]=function(_0x24d25b){const _0xb3d449=_0x1c3526;if(isParsingMovie)return;let _0x3d676c={};isParsingMovie=!![];let _0x39a914=dbFileIndexTable[_0xb3d449(0x126)](_0x24d25b,_0xb3d449(0x12e),'movie_regions,movie_language,movie_genres','file_index_movie'),_0x49cfaa=[],_0x5c73bf=[],_0xb76612=[];function _0x412446(_0x528f5c,_0x4bebf9,_0x14b748){const _0x2c85a1=_0xb3d449;if(_0x528f5c){if(_0x528f5c[_0x2c85a1(0x143)]('/')!=-0x1){let _0x287be9=_0x528f5c[_0x2c85a1(0x12c)]('/');for(let _0x206a23 in _0x287be9){_0x287be9[_0x206a23]&&(!_0x4bebf9[_0x2c85a1(0x12d)](_0x287be9[_0x206a23][_0x2c85a1(0x13a)]())?(_0x4bebf9[_0x2c85a1(0x14b)](_0x287be9[_0x206a23][_0x2c85a1(0x13a)]()),_0x3d676c[_0x14b748+_0x287be9[_0x206a23][_0x2c85a1(0x13a)]()]=0x1):_0x3d676c[_0x14b748+_0x287be9[_0x206a23][_0x2c85a1(0x13a)]()]+=0x1);}}else!_0x4bebf9[_0x2c85a1(0x12d)](_0x528f5c[_0x2c85a1(0x13a)]())?(_0x4bebf9[_0x2c85a1(0x14b)](_0x528f5c[_0x2c85a1(0x13a)]()),_0x3d676c[_0x14b748+_0x528f5c[_0x2c85a1(0x13a)]()]=0x1):_0x3d676c[_0x14b748+_0x528f5c[_0x2c85a1(0x13a)]()]+=0x1;}for(let _0x19210f=0x0;_0x19210f<_0x4bebf9[_0x2c85a1(0x146)];_0x19210f++){const _0x16aaf6='REPLACE\x20INTO\x20\x20movie_keys(key_type,key_value,index_count)\x20VALUES(\x27'+_0x14b748+'\x27,\x20\x27'+_0x4bebf9[_0x19210f]+'\x27,'+_0x3d676c[_0x14b748+_0x4bebf9[_0x19210f]]+')';_0x24d25b[_0x2c85a1(0x12b)](_0x16aaf6)[_0x2c85a1(0x144)]();}}if(_0x39a914&&_0x39a914[_0xb3d449(0x146)]>0x0){_0x24d25b[_0xb3d449(0x12b)](_0xb3d449(0x148))[_0xb3d449(0x144)]();for(let _0x45c01e=0x0;_0x45c01e<_0x39a914['length'];_0x45c01e++){let _0x2d4713=_0x39a914[_0x45c01e],_0x3f43f8=_0x2d4713[_0xb3d449(0x14f)],_0x563b4d=_0x2d4713[_0xb3d449(0x151)],_0x45d43b=_0x2d4713[_0xb3d449(0x13c)];_0x412446(_0x3f43f8,_0xb76612,_0xb3d449(0x14f)),_0x412446(_0x563b4d,_0x49cfaa,'movie_language'),_0x412446(_0x45d43b,_0x5c73bf,_0xb3d449(0x13c));}}else _0x24d25b[_0xb3d449(0x12b)](_0xb3d449(0x147))['run']();isParsingMovie=![];},videoStreamUtil['getVideoOriginalTime']=function(_0x3a8a7f){const _0x1b4645=_0x1c3526;let _0x1c222f=new Date()[_0x1b4645(0x150)]();if(_0x3a8a7f&&_0x3a8a7f[_0x1b4645(0x14c)]&&_0x3a8a7f[_0x1b4645(0x14c)][_0x1b4645(0x12a)]){let _0x545cf2=_0x3a8a7f[_0x1b4645(0x14c)][_0x1b4645(0x12a)]['com.apple.quicktime.creationdate'],_0x5d25f4=null;_0x545cf2&&(_0x5d25f4=_0x545cf2,_0x1c222f=new Date(_0x5d25f4)['getTime']()),!_0x5d25f4&&_0x3a8a7f[_0x1b4645(0x14c)][_0x1b4645(0x12a)][_0x1b4645(0x130)]&&(_0x5d25f4=_0x3a8a7f['format'][_0x1b4645(0x12a)][_0x1b4645(0x130)],_0x1c222f=new Date(_0x5d25f4)[_0x1b4645(0x150)]());}return _0x1c222f;},videoStreamUtil[_0x1c3526(0x14e)]=function(_0x1a3b80){const _0x4bfea5=_0x1c3526;let _0x5bf1a3=_0x1a3b80['streams'];if(_0x1a3b80&&_0x1a3b80['format']&&_0x1a3b80['format'][_0x4bfea5(0x137)]){let _0x4bc7c9=_0x1a3b80[_0x4bfea5(0x14c)]['duration'];if(_0x4bc7c9&&_0x4bc7c9!=_0x4bfea5(0x132)&&!isNaN(_0x4bc7c9)&&_0x4bc7c9>0x0)return _0x4bc7c9;}for(let _0xcb3ac6=0x0;_0xcb3ac6<_0x5bf1a3['length'];_0xcb3ac6++){let _0x670a6=_0x5bf1a3[_0xcb3ac6];if(_0x670a6[_0x4bfea5(0x137)]&&_0x670a6['duration']!=_0x4bfea5(0x132)&&!isNaN(_0x670a6[_0x4bfea5(0x137)])&&_0x670a6['duration']>0x0)return _0x670a6[_0x4bfea5(0x137)];if(_0x670a6[_0x4bfea5(0x12a)]){if(_0x670a6[_0x4bfea5(0x12a)][_0x4bfea5(0x152)]||_0x670a6[_0x4bfea5(0x12a)][_0x4bfea5(0x137)]){let _0x3721b6=_0x670a6[_0x4bfea5(0x12a)]['DURATION']||_0x670a6[_0x4bfea5(0x12a)][_0x4bfea5(0x137)];if(_0x3721b6[_0x4bfea5(0x143)](':')!=-0x1)return timeToSec(_0x3721b6);}}}return 0x0;},videoStreamUtil['getVideoMeta']=function(_0x26fd8a){return new Promise((_0x5b5fb1,_0x4a9d20)=>{const _0x11d5b7=_0x166a;FFmpeg(_0x26fd8a)[_0x11d5b7(0x14d)]((_0x2df92d,_0xb605e6)=>{_0x2df92d?_0x4a9d20(_0x2df92d):_0x5b5fb1(_0xb605e6);});});},videoStreamUtil[_0x1c3526(0x13d)]=function(_0x41069f){const _0xb820a4=_0x1c3526;let _0x54d1ef=0x0,_0x17fc04=0x0,_0x1f029f=0x0,_0x44188c=null;for(let _0x2daf8e=0x0;_0x2daf8e<_0x41069f[_0xb820a4(0x146)];_0x2daf8e++){let _0x3973e1=_0x41069f[_0x2daf8e];_0x3973e1[_0xb820a4(0x139)]=='video'&&(_0x44188c=_0x3973e1,_0x3973e1[_0xb820a4(0x125)]&&(_0x1f029f=_0x3973e1['rotation']),!_0x1f029f&&(_0x3973e1[_0xb820a4(0x12a)]&&_0x3973e1[_0xb820a4(0x12a)][_0xb820a4(0x135)]&&(_0x1f029f=_0x3973e1[_0xb820a4(0x12a)]['rotate'])));if(_0x3973e1[_0xb820a4(0x136)]&&_0x3973e1[_0xb820a4(0x133)]){if(_0x3973e1['width']!=_0xb820a4(0x132)&&!isNaN(_0x3973e1[_0xb820a4(0x136)])&&_0x3973e1['width']>0x0){_0x54d1ef=_0x3973e1[_0xb820a4(0x136)],_0x17fc04=_0x3973e1['height'];break;}}}if((_0x1f029f==0x5a||_0x1f029f==-0x5a||_0x1f029f==0x10e)&&_0x54d1ef&&_0x17fc04){let _0x4f4be6=_0x54d1ef,_0x36a192=_0x17fc04;_0x54d1ef=_0x36a192,_0x17fc04=_0x4f4be6;}return{'videoHeight':_0x17fc04,'videoWidth':_0x54d1ef,'videoStream':_0x44188c};},module[_0x1c3526(0x131)]=videoStreamUtil;