const _0x57e001=_0x3176;(function(_0x5778aa,_0x37eb73){const _0x4361d0=_0x3176,_0x208b4a=_0x5778aa();while(!![]){try{const _0x553888=-parseInt(_0x4361d0(0x1e0))/0x1*(-parseInt(_0x4361d0(0x1e1))/0x2)+parseInt(_0x4361d0(0x1b9))/0x3*(parseInt(_0x4361d0(0x1d8))/0x4)+parseInt(_0x4361d0(0x1ae))/0x5+parseInt(_0x4361d0(0x1b3))/0x6*(-parseInt(_0x4361d0(0x1c0))/0x7)+parseInt(_0x4361d0(0x1e2))/0x8+-parseInt(_0x4361d0(0x1d2))/0x9+parseInt(_0x4361d0(0x1c1))/0xa*(-parseInt(_0x4361d0(0x1cc))/0xb);if(_0x553888===_0x37eb73)break;else _0x208b4a['push'](_0x208b4a['shift']());}catch(_0xd3508c){_0x208b4a['push'](_0x208b4a['shift']());}}}(_0x2398,0x57d70));let FFmpeg=require('../libs/nasTrans')['FFmpeg'];const dbConfigTable=require('../db/dbConfigTable'),dbFileIndexTable=require(_0x57e001(0x1cd)),transCodeUtil=require('./transCodeUtil');let videoStreamUtil={};function timeToSec(_0x15b855){const _0x21bab3=_0x57e001;var _0x800711='',_0x981315=_0x15b855[_0x21bab3(0x1be)](':')[0x0],_0x14eff5=_0x15b855[_0x21bab3(0x1be)](':')[0x1],_0x1a7ab9=_0x15b855[_0x21bab3(0x1be)](':')[0x2];return _0x800711=parseFloat(_0x981315*0xe10)+parseFloat(_0x14eff5*0x3c)+parseFloat(_0x1a7ab9),_0x800711;};videoStreamUtil[_0x57e001(0x1c9)]=function(_0x4c68d6){const _0x1a4512=_0x57e001;let _0x4bc698=dbConfigTable[_0x1a4512(0x1b7)](_0x4c68d6,_0x1a4512(0x1bd));!_0x4bc698?_0x4c68d6[_0x1a4512(0x1bb)](_0x1a4512(0x1d4)+new Date()[_0x1a4512(0x1de)]()+')')['run']():_0x4c68d6[_0x1a4512(0x1bb)](_0x1a4512(0x1b6)+new Date()[_0x1a4512(0x1de)]()+_0x1a4512(0x1d0))['run']();};let lastMovieInfoUpdateTime=0x0;function _0x3176(_0x2f30d0,_0x28be0e){const _0x239814=_0x2398();return _0x3176=function(_0x3176b4,_0x53ee0e){_0x3176b4=_0x3176b4-0x1ae;let _0x2304da=_0x239814[_0x3176b4];return _0x2304da;},_0x3176(_0x2f30d0,_0x28be0e);}videoStreamUtil[_0x57e001(0x1e3)]=function(_0x160792,_0x204ef2,_0x19ca92){const _0x12bf0b=_0x57e001;let _0x420cf7=dbConfigTable[_0x12bf0b(0x1b7)](_0x160792,_0x12bf0b(0x1bd));if(_0x19ca92)videoStreamUtil[_0x12bf0b(0x1e7)](_0x204ef2);else _0x420cf7&&lastMovieInfoUpdateTime!=_0x420cf7[_0x12bf0b(0x1da)]&&(videoStreamUtil[_0x12bf0b(0x1e7)](_0x204ef2),lastMovieInfoUpdateTime=_0x420cf7[_0x12bf0b(0x1da)]);};let isParsingMovie=![];videoStreamUtil[_0x57e001(0x1e7)]=function(_0x43474c){const _0x28bd5=_0x57e001;if(isParsingMovie)return;let _0x57347d={};isParsingMovie=!![];let _0x1117c9=dbFileIndexTable[_0x28bd5(0x1c2)](_0x43474c,'\x20movie_info_state=1\x20and\x20is_file=1\x20and\x20type=2',_0x28bd5(0x1d6),_0x28bd5(0x1cf)),_0x3ffe35=[],_0x3df18e=[],_0x508d90=[];function _0x4bd68d(_0x11d09a,_0x37bc09,_0x521d20){const _0x570d20=_0x28bd5;if(_0x11d09a){if(_0x11d09a[_0x570d20(0x1b8)]('/')!=-0x1){let _0x4cb010=_0x11d09a[_0x570d20(0x1be)]('/');for(let _0x1d4aee in _0x4cb010){_0x4cb010[_0x1d4aee]&&(!_0x37bc09['includes'](_0x4cb010[_0x1d4aee][_0x570d20(0x1c4)]())?(_0x37bc09['push'](_0x4cb010[_0x1d4aee][_0x570d20(0x1c4)]()),_0x57347d[_0x521d20+_0x4cb010[_0x1d4aee]['trim']()]=0x1):_0x57347d[_0x521d20+_0x4cb010[_0x1d4aee][_0x570d20(0x1c4)]()]+=0x1);}}else!_0x37bc09[_0x570d20(0x1c3)](_0x11d09a[_0x570d20(0x1c4)]())?(_0x37bc09[_0x570d20(0x1b2)](_0x11d09a[_0x570d20(0x1c4)]()),_0x57347d[_0x521d20+_0x11d09a[_0x570d20(0x1c4)]()]=0x1):_0x57347d[_0x521d20+_0x11d09a[_0x570d20(0x1c4)]()]+=0x1;}for(let _0x19d869=0x0;_0x19d869<_0x37bc09[_0x570d20(0x1e6)];_0x19d869++){const _0x337086=_0x570d20(0x1b4)+_0x521d20+_0x570d20(0x1c6)+_0x37bc09[_0x19d869]+'\x27,'+_0x57347d[_0x521d20+_0x37bc09[_0x19d869]]+')';_0x43474c[_0x570d20(0x1bb)](_0x337086)[_0x570d20(0x1af)]();}}if(_0x1117c9&&_0x1117c9[_0x28bd5(0x1e6)]>0x0){_0x43474c[_0x28bd5(0x1bb)]('UPDATE\x20movie_keys\x20SET\x20index_count=0\x20where\x201=1')[_0x28bd5(0x1af)]();for(let _0x43e56c=0x0;_0x43e56c<_0x1117c9[_0x28bd5(0x1e6)];_0x43e56c++){let _0xee1007=_0x1117c9[_0x43e56c],_0xf1bbe9=_0xee1007[_0x28bd5(0x1d5)],_0x434fbe=_0xee1007['movie_language'],_0x58a8a5=_0xee1007[_0x28bd5(0x1cb)];_0x4bd68d(_0xf1bbe9,_0x508d90,_0x28bd5(0x1d5)),_0x4bd68d(_0x434fbe,_0x3ffe35,_0x28bd5(0x1b1)),_0x4bd68d(_0x58a8a5,_0x3df18e,_0x28bd5(0x1cb));}}else _0x43474c[_0x28bd5(0x1bb)](_0x28bd5(0x1c7))[_0x28bd5(0x1af)]();isParsingMovie=![];},videoStreamUtil[_0x57e001(0x1c8)]=function(_0x46f854){const _0x546e20=_0x57e001;let _0x550e4f=new Date()[_0x546e20(0x1de)]();if(_0x46f854&&_0x46f854[_0x546e20(0x1d1)]&&_0x46f854[_0x546e20(0x1d1)][_0x546e20(0x1b5)]){let _0x15a186=_0x46f854['format'][_0x546e20(0x1b5)][_0x546e20(0x1e4)],_0x1f1c6=null;_0x15a186&&(_0x1f1c6=_0x15a186,_0x550e4f=new Date(_0x1f1c6)[_0x546e20(0x1de)]()),!_0x1f1c6&&_0x46f854[_0x546e20(0x1d1)][_0x546e20(0x1b5)]['creation_time']&&(_0x1f1c6=_0x46f854[_0x546e20(0x1d1)]['tags']['creation_time'],_0x550e4f=new Date(_0x1f1c6)[_0x546e20(0x1de)]());}return _0x550e4f;},videoStreamUtil[_0x57e001(0x1ca)]=function(_0x607524){const _0x4674da=_0x57e001;let _0x79c97c=_0x607524[_0x4674da(0x1bf)];if(_0x607524&&_0x607524['format']&&_0x607524[_0x4674da(0x1d1)]['duration']){let _0x46a195=_0x607524[_0x4674da(0x1d1)][_0x4674da(0x1d7)];if(_0x46a195&&_0x46a195!=_0x4674da(0x1b0)&&!isNaN(_0x46a195)&&_0x46a195>0x0)return _0x46a195;}for(let _0xfeb639=0x0;_0xfeb639<_0x79c97c[_0x4674da(0x1e6)];_0xfeb639++){let _0x1b07f9=_0x79c97c[_0xfeb639];if(_0x1b07f9[_0x4674da(0x1d7)]&&_0x1b07f9[_0x4674da(0x1d7)]!=_0x4674da(0x1b0)&&!isNaN(_0x1b07f9['duration'])&&_0x1b07f9['duration']>0x0)return _0x1b07f9[_0x4674da(0x1d7)];if(_0x1b07f9[_0x4674da(0x1b5)]){if(_0x1b07f9[_0x4674da(0x1b5)][_0x4674da(0x1c5)]||_0x1b07f9['tags'][_0x4674da(0x1d7)]){let _0x2ef50b=_0x1b07f9['tags'][_0x4674da(0x1c5)]||_0x1b07f9['tags'][_0x4674da(0x1d7)];if(_0x2ef50b[_0x4674da(0x1b8)](':')!=-0x1)return timeToSec(_0x2ef50b);}}}return 0x0;},videoStreamUtil[_0x57e001(0x1e5)]=function(_0x271c5b){return new Promise((_0x3ed8e7,_0x3cf757)=>{const _0x3620c8=_0x3176;FFmpeg(_0x271c5b)[_0x3620c8(0x1d9)]((_0x421fd6,_0x4c53e4)=>{_0x421fd6?_0x3cf757(_0x421fd6):_0x3ed8e7(_0x4c53e4);});});},videoStreamUtil[_0x57e001(0x1dc)]=function(_0x358e7c){const _0x19b3b7=_0x57e001;let _0x18c905=0x0,_0x4aba92=0x0,_0x144fde=0x0,_0x24cff6=null;for(let _0x357470=0x0;_0x357470<_0x358e7c[_0x19b3b7(0x1e6)];_0x357470++){let _0x37577e=_0x358e7c[_0x357470];_0x37577e[_0x19b3b7(0x1dd)]==_0x19b3b7(0x1bc)&&(_0x24cff6=_0x37577e,_0x37577e[_0x19b3b7(0x1ba)]&&(_0x144fde=_0x37577e[_0x19b3b7(0x1ba)]),!_0x144fde&&(_0x37577e[_0x19b3b7(0x1b5)]&&_0x37577e[_0x19b3b7(0x1b5)]['rotate']&&(_0x144fde=_0x37577e[_0x19b3b7(0x1b5)][_0x19b3b7(0x1d3)])));if(_0x37577e[_0x19b3b7(0x1ce)]&&_0x37577e['height']){if(_0x37577e[_0x19b3b7(0x1ce)]!=_0x19b3b7(0x1b0)&&!isNaN(_0x37577e[_0x19b3b7(0x1ce)])&&_0x37577e['width']>0x0){_0x18c905=_0x37577e[_0x19b3b7(0x1ce)],_0x4aba92=_0x37577e[_0x19b3b7(0x1df)];break;}}}if((_0x144fde==0x5a||_0x144fde==-0x5a||_0x144fde==0x10e)&&_0x18c905&&_0x4aba92){let _0x339f84=_0x18c905,_0x3b44ef=_0x4aba92;_0x18c905=_0x3b44ef,_0x4aba92=_0x339f84;}return{'videoHeight':_0x4aba92,'videoWidth':_0x18c905,'videoStream':_0x24cff6};},module[_0x57e001(0x1db)]=videoStreamUtil;function _0x2398(){const _0x100ee1=['27273lTCJMG','rotation','prepare','video','lastTimeStampMatchMovieInfo','split','streams','260141frFHMK','90TmOaas','getAllByWhere','includes','trim','DURATION','\x27,\x20\x27','DELETE\x20FROM\x20movie_keys\x20where\x201=1','getVideoOriginalTime','saveLastMatchTime','getDurationFromStream','movie_regions','93995UvksNX','../db/dbFileIndexTable','width','file_index_movie','\x20WHERE\x20title=\x27lastTimeStampMatchMovieInfo\x27','format','324864fqjPUb','rotate','REPLACE\x20INTO\x20config(title,value)\x20values(\x27lastTimeStampMatchMovieInfo\x27,','movie_genres','movie_regions,movie_language,movie_genres','duration','92eCiBaY','ffprobe','value','exports','parseVideoWH','codec_type','getTime','height','10WBqvgO','62180EWbWjX','3874520UAZJKU','goParseMoviesKeys','com.apple.quicktime.creationdate','getVideoMeta','length','parseMovieKeys','501280CXGlun','run','N/A','movie_language','push','102sFOMOD','REPLACE\x20INTO\x20\x20movie_keys(key_type,key_value,index_count)\x20VALUES(\x27','tags','UPDATE\x20config\x20SET\x20value=','findByTitle','indexOf'];_0x2398=function(){return _0x100ee1;};return _0x2398();}