const _0x30e480=_0x507e;(function(_0x40558d,_0x1c0bf9){const _0x372024=_0x507e,_0x3040c3=_0x40558d();while(!![]){try{const _0xe607fc=-parseInt(_0x372024(0x1e9))/0x1*(-parseInt(_0x372024(0x1b5))/0x2)+parseInt(_0x372024(0x1b0))/0x3*(parseInt(_0x372024(0x184))/0x4)+-parseInt(_0x372024(0x19c))/0x5*(-parseInt(_0x372024(0x1e5))/0x6)+parseInt(_0x372024(0x1a1))/0x7+-parseInt(_0x372024(0x1d5))/0x8*(parseInt(_0x372024(0x1c2))/0x9)+parseInt(_0x372024(0x175))/0xa+-parseInt(_0x372024(0x199))/0xb*(parseInt(_0x372024(0x1b1))/0xc);if(_0xe607fc===_0x1c0bf9)break;else _0x3040c3['push'](_0x3040c3['shift']());}catch(_0x2d80d5){_0x3040c3['push'](_0x3040c3['shift']());}}}(_0x196b,0xc1258));let app,BrowserWindow,Menu,Tray,protocol;try{let elec=require(_0x30e480(0x1db));app=elec['app'],BrowserWindow=elec[_0x30e480(0x171)],Menu=elec[_0x30e480(0x1a5)],Tray=elec[_0x30e480(0x1c3)],protocol=elec['protocol'];}catch(_0x24cb46){console[_0x30e480(0x180)](_0x30e480(0x187));}const {fork}=require('child_process');function _0x196b(){const _0x552097=['value','Show/Hide','dbOther','4JCWIDi','type','./globalInfoUtil','Clientless\x20service\x20mode','loadFile','dbCity','kill','zh-CN','REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)','isPackaged','\x20WHERE\x20last_login_time\x20<?','relaunch','close','webContents','checkWebClientAutoUpdate','prepare','language','cpus','setLanguage','compressing','deleteUserTokenByWhere','4254338shaHfS','../myConfig/config','facesPath','10AIRryG','logo-tray.png','apiPortHttps','cachePath','../myWorkers/autoLaunchWorker.js','8524600zfoFlR','Using\x20file\x20config\x20port','minimize','init','Menu','m3u8TmpPath','subtitlePath','../db/dbScanTaskTable','tokenKeepHour','dirname','startsWith','findByTitle','getUpdateInfo','openDev','getRootPath','2113503TiDPYG','108nlEATS','getExpressApiCount','../db/dbUtil','darwin','1274aGHWbe','posterPath','utf-8','axios','../express-server/utils/netUtils','getFreePort','runNewVersionTask','hide','readFileSync','database','dbFileIndex','click','startUpdate','1017ajuVqD','Tray','NasCab','run','getLocale','tempFilePath','autoLaunch','destroy','createUserFolder','quit','loading/loading.html','process_id','processList','initDbu','platform','getTime','existsSync','isPortFree','SIGTERM','57512Puokpg','libs','../../package.json','appRootPath','httpport.txt','Loading...','electron','setContextMenu','then','autoShowWindow','DELETE\x20FROM\x20play_record','Exit(退出)','path','Restart(重启应用)','openDevTools','musicCoverPath','4446138UGhwND','createMainWindow','addScanTaskWhenStart','isVisible','1759ZdSpJC','pid','BrowserWindow','preventDefault','all','DELETE\x20FROM\x20process_record\x20WHERE\x201=1','5594770uYgHnl','create','../express-server/utils/privateSpaceUtils','show','join','../db/dbUserTable','userDataFolder','exports','../db/dbSourceFolderTable','getAll','subtitleUploadPath','log'];_0x196b=function(){return _0x552097;};return _0x196b();}let path=require(_0x30e480(0x1e1)),fs=require('fs'),os=require('os'),initUtil={},privateSpaceUtil=require(_0x30e480(0x177)),dbConfigTable=require('../db/dbConfigTable'),dbu='',mainWindow='';const config=require(_0x30e480(0x19a));let netUtils=require(_0x30e480(0x1b9)),appTray;const dbUserTable=require(_0x30e480(0x17a));function _0x507e(_0x5b75d3,_0x13a13d){const _0x196bd4=_0x196b();return _0x507e=function(_0x507efe,_0x137cb9){_0x507efe=_0x507efe-0x170;let _0x157970=_0x196bd4[_0x507efe];return _0x157970;},_0x507e(_0x5b75d3,_0x13a13d);}let axios=require(_0x30e480(0x1b8));var package=require('../../package.json');const compressing=require(_0x30e480(0x197));let packageInfo=require(_0x30e480(0x1d7));const dbSourceFolderTable=require(_0x30e480(0x17d)),dbScanTaskTable=require(_0x30e480(0x1a8));initUtil[_0x30e480(0x1bb)]=function(_0x9b4967){},initUtil[_0x30e480(0x1af)]=function(){const _0x3de630=_0x30e480;let _0x89f2fb='';return app&&app[_0x3de630(0x18d)]?(_0x89f2fb=path[_0x3de630(0x1aa)](app['getPath']('exe')),os[_0x3de630(0x1d0)]()==_0x3de630(0x1b4)&&(_0x89f2fb=path[_0x3de630(0x1aa)](_0x89f2fb))):_0x89f2fb=path[_0x3de630(0x179)](__dirname,'../../'),_0x89f2fb;},initUtil[_0x30e480(0x1cf)]=function(){const _0x4eeb85=_0x30e480;var _0x4eeec2=require(_0x4eeb85(0x1b3));return dbu=new _0x4eeec2(),dbu;},initUtil[_0x30e480(0x1e7)]=function(_0x3ec4ff){const _0x59df2b=_0x30e480;let _0x201d56=dbSourceFolderTable[_0x59df2b(0x17e)](_0x3ec4ff);for(let _0x4595be of _0x201d56){_0x4595be['scan_when_start']==0x1&&dbScanTaskTable['addScanTask'](_0x3ec4ff,_0x4595be[_0x59df2b(0x185)],_0x4595be[_0x59df2b(0x1e1)]);}},initUtil['addProcessRecord']=function(_0x1b2d8c,_0x110458){const _0x34c304=_0x30e480;_0x1b2d8c['prepare'](_0x34c304(0x18c))[_0x34c304(0x1c5)](_0x110458+'');},initUtil[_0x30e480(0x1e6)]=function(){const _0x490d9e=_0x30e480;if(!app||!BrowserWindow)return;let _0x4c1405=![],_0x34011f=dbConfigTable['findByTitle'](dbu['dbOther'],_0x490d9e(0x1de));return(!_0x34011f||_0x34011f[_0x490d9e(0x181)]=='1')&&(_0x4c1405=!![]),mainWindow=new BrowserWindow({'width':0x578,'height':0x3e8,'show':_0x4c1405,'webPreferences':{'webSecurity':![],'nodeIntegration':!![],'contextIsolation':![],'nodeIntegrationInWorker':!![]}}),mainWindow;},initUtil[_0x30e480(0x1ca)]=function(){const _0x2bdbf2=_0x30e480;function _0x36b279(_0x5c2470){!fs['existsSync'](_0x5c2470)&&fs['mkdirSync'](_0x5c2470,{'recursive':!![]});}return fs['rm'](config[_0x2bdbf2(0x1c7)],{'recursive':!![]},()=>{_0x36b279(config['tempFilePath']);}),_0x36b279(config[_0x2bdbf2(0x19f)]),_0x36b279(config[_0x2bdbf2(0x1b6)]),_0x36b279(config[_0x2bdbf2(0x1e4)]),_0x36b279(config[_0x2bdbf2(0x19b)]),_0x36b279(config[_0x2bdbf2(0x1a7)]),_0x36b279(config[_0x2bdbf2(0x17f)]),_0x36b279(path[_0x2bdbf2(0x179)](config[_0x2bdbf2(0x17b)],_0x2bdbf2(0x1be))),config[_0x2bdbf2(0x17b)];},initUtil['startUpdate']=function(){const _0x277009=_0x30e480;let _0x637ea=require('../utils/updateUtil');_0x637ea[_0x277009(0x1c1)]();},initUtil[_0x30e480(0x1a4)]=function(_0x30ac9a){const _0x4dcaad=_0x30e480;if(Menu)Menu['setApplicationMenu'](null);privateSpaceUtil['clearSpaceTempFiles'](_0x30ac9a[_0x4dcaad(0x183)]),globalInfoUtil[_0x4dcaad(0x1ad)](_0x30ac9a[_0x4dcaad(0x183)]);let _0x108c1b=_0x30ac9a[_0x4dcaad(0x183)][_0x4dcaad(0x193)]('SELECT\x20*\x20FROM\x20process_record')[_0x4dcaad(0x173)]();for(let _0x4e9bb3 in _0x108c1b){try{process[_0x4dcaad(0x18a)](_0x108c1b[_0x4e9bb3][_0x4dcaad(0x1cd)],_0x4dcaad(0x1d4));}catch(_0x1090ac){}}_0x30ac9a['dbOther']['prepare'](_0x4dcaad(0x174))[_0x4dcaad(0x1c5)](),clearM3u8File(_0x30ac9a);},initUtil[_0x30e480(0x1ce)]=[];function clearM3u8File(_0x6560a){const _0x20dbb4=_0x30e480;fs['rm'](config[_0x20dbb4(0x1a6)],{'recursive':!![],'force':!![],'maxRetries':0xa},_0xc9f06a=>{if(_0xc9f06a)console['log'](_0xc9f06a);}),_0x6560a&&_0x6560a['dbOther']&&_0x6560a[_0x20dbb4(0x183)][_0x20dbb4(0x193)](_0x20dbb4(0x1df))[_0x20dbb4(0x1c5)]();}function exitApp(_0x473dd0){const _0x24820d=_0x30e480;if(app)app[_0x24820d(0x1cb)]();if(mainWindow)mainWindow=null;for(let _0x42a44c in initUtil[_0x24820d(0x1ce)]){initUtil['processList'][_0x42a44c]&&(initUtil[_0x24820d(0x1ce)][_0x42a44c][_0x24820d(0x18a)](),initUtil[_0x24820d(0x1ce)][_0x42a44c]=null);}if(_0x473dd0[_0x24820d(0x183)]){let _0x915c8e=_0x473dd0[_0x24820d(0x183)]['prepare']('DELETE\x20FROM\x20process_record\x20WHERE\x201=1')['run']();}clearM3u8File(_0x473dd0),_0x473dd0&&(_0x473dd0[_0x24820d(0x1bf)]&&(_0x473dd0[_0x24820d(0x1bf)][_0x24820d(0x190)](),_0x473dd0[_0x24820d(0x1bf)]=null),_0x473dd0[_0x24820d(0x183)]&&(_0x473dd0[_0x24820d(0x183)][_0x24820d(0x190)](),_0x473dd0['dbOther']=null),_0x473dd0['dbCity']&&(_0x473dd0[_0x24820d(0x189)][_0x24820d(0x190)](),_0x473dd0[_0x24820d(0x189)]=null)),appTray&&appTray[_0x24820d(0x1c9)](),process[_0x24820d(0x18a)](process[_0x24820d(0x170)],_0x24820d(0x1d4));}initUtil['exitApp']=exitApp,initUtil['initWindowEventAndLoadLoading']=function(_0x3a4485,_0x12fed3){const _0x8aaf33=_0x30e480;if(!app||!_0x12fed3)return;_0x12fed3['on'](_0x8aaf33(0x190),_0x2956cb=>{const _0x5b38cb=_0x8aaf33;if(!_0x12fed3)return;!_0x12fed3[_0x5b38cb(0x1e8)]()?exitApp(_0x3a4485):(_0x2956cb[_0x5b38cb(0x172)](),os[_0x5b38cb(0x1d0)]()=='win32'?_0x12fed3[_0x5b38cb(0x1bc)]():_0x12fed3[_0x5b38cb(0x1a3)]());}),console[_0x8aaf33(0x180)](_0x8aaf33(0x1da)),_0x12fed3[_0x8aaf33(0x188)](_0x8aaf33(0x1cc));},initUtil['initTray']=function(_0x188685,_0x176eb8){const _0x2395f3=_0x30e480;if(!app)return;var _0x163eeb=[{'label':_0x2395f3(0x182),'click':function(){const _0x5364b2=_0x2395f3;_0x176eb8[_0x5364b2(0x1e8)]()?_0x176eb8[_0x5364b2(0x1bc)]():_0x176eb8[_0x5364b2(0x178)]();}},{'label':_0x2395f3(0x1e2),'click':function(){const _0x9d0f03=_0x2395f3;if(app)app[_0x9d0f03(0x18f)]();exitApp(_0x188685);}},{'label':_0x2395f3(0x1e0),'click':function(){if(app)app['quit']();exitApp(_0x188685);}}];appTray=new Tray(path[_0x2395f3(0x179)](initUtil[_0x2395f3(0x1af)](),_0x2395f3(0x1d6),_0x2395f3(0x19d)));const _0x33d4d6=Menu['buildFromTemplate'](_0x163eeb);appTray['setToolTip'](_0x2395f3(0x1c4)),appTray[_0x2395f3(0x1dc)](_0x33d4d6),appTray['on'](_0x2395f3(0x1c0),function(){_0x176eb8['show']();});},initUtil[_0x30e480(0x1ae)]=function(){const _0x3d2032=_0x30e480;if(!app)return;!app['isPackaged']&&mainWindow[_0x3d2032(0x191)][_0x3d2032(0x1e3)]();};function clearExpiredToken(){const _0x2aa105=_0x30e480;let _0x132c95=dbConfigTable[_0x2aa105(0x1ac)](dbu[_0x2aa105(0x183)],_0x2aa105(0x1a9));if(!_0x132c95||!_0x132c95[_0x2aa105(0x181)]||_0x132c95['value']<0x1)_0x132c95=0x18;else _0x132c95&&_0x132c95[_0x2aa105(0x181)]&&(_0x132c95=_0x132c95[_0x2aa105(0x181)]);let _0x5d4017=new Date()[_0x2aa105(0x1d1)](),_0x2589bf=_0x5d4017-parseInt(_0x132c95)*0xe10*0x3e8;dbUserTable[_0x2aa105(0x198)](dbu['dbOther'],_0x2aa105(0x18e),[_0x2589bf]);}initUtil['expireTokenOnTime']=function(){setInterval(()=>{clearExpiredToken();},0xe10*0x3e8),clearExpiredToken();};const globalInfoUtil=require(_0x30e480(0x186));initUtil['launchWithSys']=function(){const _0xe35453=_0x30e480;if(!app)return;if(!app[_0xe35453(0x18d)])return;let _0x44e33f=dbConfigTable['findByTitle'](dbu['dbOther'],_0xe35453(0x1c8)),_0x234959=0x0;_0x44e33f&&(_0x44e33f[_0xe35453(0x181)]=='1'||_0x44e33f[_0xe35453(0x181)]==0x1)&&(_0x234959=0x1);try{fork(path['resolve'](__dirname,_0xe35453(0x1a0)),[],{'env':{'enableAutoLaunch':_0x234959},'detached':![],'killSignal':_0xe35453(0x1d4)});}catch(_0x4f503a){console['log'](_0x4f503a);}},initUtil[_0x30e480(0x196)]=function(){const _0x3fccdf=_0x30e480;let _0x120da5=dbConfigTable['findByTitle'](dbu[_0x3fccdf(0x183)],_0x3fccdf(0x194));if(!_0x120da5){let _0x588a54=app?app[_0x3fccdf(0x1c6)]():'zh';_0x588a54[_0x3fccdf(0x1ab)]('en')?dbConfigTable[_0x3fccdf(0x176)](dbu['dbOther'],{'title':_0x3fccdf(0x194),'value':'en-US'}):dbConfigTable[_0x3fccdf(0x176)](dbu['dbOther'],{'title':_0x3fccdf(0x194),'value':_0x3fccdf(0x18b)});}},initUtil['getFreePort']=function(_0x10128e,_0x24433b){const _0x4ff0d5=_0x30e480;let _0x10ebda=path[_0x4ff0d5(0x179)](config[_0x4ff0d5(0x1d8)],_0x4ff0d5(0x1d9));try{if(fs[_0x4ff0d5(0x1d2)](_0x10ebda)){console['log']('从配置文件读取端口设置[http\x20port\x20config\x20file]',_0x10ebda);let _0x21fffc=fs[_0x4ff0d5(0x1bd)](_0x10ebda,_0x4ff0d5(0x1b7));_0x21fffc&&(_0x21fffc=parseInt(_0x21fffc),_0x21fffc>0x0&&_0x21fffc<0xfff6&&(_0x10128e=_0x21fffc,dbConfigTable[_0x4ff0d5(0x176)](dbu[_0x4ff0d5(0x183)],{'title':'apiPort','value':_0x10128e+''}),console[_0x4ff0d5(0x180)](_0x4ff0d5(0x1a2),_0x10128e)));}}catch(_0x1b35b2){}_0x10128e=parseInt(_0x10128e),netUtils[_0x4ff0d5(0x1d3)](_0x10128e)[_0x4ff0d5(0x1dd)](_0x1cad88=>{const _0x279f89=_0x4ff0d5;_0x1cad88?_0x24433b(_0x10128e):(_0x10128e+=0x1,initUtil[_0x279f89(0x1ba)](_0x10128e,_0x24433b));});},initUtil['getConfigApiPort']=function(_0x17e0f9){const _0x3f060f=_0x30e480;let _0x5e8ca7=_0x17e0f9?config[_0x3f060f(0x19e)]:config['apiPort'],_0x4be5f8=dbConfigTable[_0x3f060f(0x1ac)](dbu[_0x3f060f(0x183)],_0x17e0f9?_0x3f060f(0x19e):'apiPort');if(_0x4be5f8){let _0x3defdf=parseInt(_0x4be5f8[_0x3f060f(0x181)]);if(_0x3defdf<=0x0||_0x3defdf>0xffff){}else _0x5e8ca7=_0x3defdf;}return _0x5e8ca7;},initUtil[_0x30e480(0x1b2)]=function(){const _0x436edd=_0x30e480;let _0x587563=os[_0x436edd(0x195)](),_0x4efcca=0x2,_0x5e34eb=dbConfigTable[_0x436edd(0x1ac)](dbu[_0x436edd(0x183)],'threadCount');return _0x5e34eb&&(_0x4efcca=_0x5e34eb[_0x436edd(0x181)],_0x4efcca>_0x587563['length']&&(_0x4efcca=_0x587563['length'])),(!_0x4efcca||_0x4efcca<0x2)&&(_0x4efcca=0x2),dbConfigTable[_0x436edd(0x176)](dbu[_0x436edd(0x183)],{'title':'apiServerCount','value':parseInt(_0x4efcca)+''}),_0x4efcca;},initUtil[_0x30e480(0x192)]=function(){},module[_0x30e480(0x17c)]=initUtil;