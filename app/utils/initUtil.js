const _0x45d7ef=_0x51ff;(function(_0x3b8b0d,_0x38fdc3){const _0x4f929b=_0x51ff,_0x2c6c5e=_0x3b8b0d();while(!![]){try{const _0x374765=-parseInt(_0x4f929b(0xfc))/0x1+parseInt(_0x4f929b(0xf9))/0x2+-parseInt(_0x4f929b(0x144))/0x3+parseInt(_0x4f929b(0x14c))/0x4+-parseInt(_0x4f929b(0x10b))/0x5+-parseInt(_0x4f929b(0x117))/0x6*(-parseInt(_0x4f929b(0x105))/0x7)+-parseInt(_0x4f929b(0x125))/0x8*(-parseInt(_0x4f929b(0xdb))/0x9);if(_0x374765===_0x38fdc3)break;else _0x2c6c5e['push'](_0x2c6c5e['shift']());}catch(_0x402a40){_0x2c6c5e['push'](_0x2c6c5e['shift']());}}}(_0x1621,0x5d840));function _0x51ff(_0x5d2d9c,_0x32afdc){const _0x16213=_0x1621();return _0x51ff=function(_0x51ff74,_0x3593ad){_0x51ff74=_0x51ff74-0xd5;let _0x470d0e=_0x16213[_0x51ff74];return _0x470d0e;},_0x51ff(_0x5d2d9c,_0x32afdc);}let app,BrowserWindow,Menu,Tray,protocol;try{let elec=require(_0x45d7ef(0x13a));app=elec['app'],BrowserWindow=elec[_0x45d7ef(0x13c)],Menu=elec[_0x45d7ef(0x14a)],Tray=elec[_0x45d7ef(0x149)],protocol=elec['protocol'];}catch(_0x11035c){console[_0x45d7ef(0x127)](_0x45d7ef(0x120));}const {fork}=require(_0x45d7ef(0x13d));let path=require(_0x45d7ef(0xf0)),fs=require('fs'),os=require('os'),initUtil={},privateSpaceUtil=require(_0x45d7ef(0x113)),dbConfigTable=require(_0x45d7ef(0x130)),dbu='',mainWindow='';const config=require('../myConfig/config');let netUtils=require('../express-server/utils/netUtils'),appTray;const dbUserTable=require(_0x45d7ef(0x114));let axios=require(_0x45d7ef(0xde));var package=require('../../package.json');const compressing=require(_0x45d7ef(0xd5));let packageInfo=require(_0x45d7ef(0x10f));const dbSourceFolderTable=require('../db/dbSourceFolderTable'),dbScanTaskTable=require('../db/dbScanTaskTable');initUtil[_0x45d7ef(0xec)]=function(_0x30ce75){},initUtil[_0x45d7ef(0x146)]=function(){const _0x5caf37=_0x45d7ef;let _0x34c426='';return app&&app[_0x5caf37(0x108)]?(_0x34c426=path[_0x5caf37(0xe3)](app[_0x5caf37(0x12a)](_0x5caf37(0x110))),os[_0x5caf37(0x121)]()==_0x5caf37(0xea)&&(_0x34c426=path[_0x5caf37(0xe3)](_0x34c426))):_0x34c426=path[_0x5caf37(0x129)](__dirname,_0x5caf37(0x11c)),_0x34c426;},initUtil['initDbu']=function(){const _0x1e1294=_0x45d7ef;var _0x4c4d1d=require(_0x1e1294(0xe0));return dbu=new _0x4c4d1d(),dbu;},initUtil[_0x45d7ef(0xed)]=function(_0x57544c){const _0x11d642=_0x45d7ef;let _0x18dd02=dbSourceFolderTable[_0x11d642(0xfd)](_0x57544c);for(let _0x551262 of _0x18dd02){_0x551262[_0x11d642(0x133)]==0x1&&dbScanTaskTable[_0x11d642(0xd6)](_0x57544c,_0x551262['type'],_0x551262['path']);}},initUtil[_0x45d7ef(0x104)]=function(_0x1fb877,_0x105904){const _0x3a014d=_0x45d7ef;_0x1fb877[_0x3a014d(0xee)]('REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)')[_0x3a014d(0x12c)](_0x105904+'');},initUtil[_0x45d7ef(0x11e)]=function(){const _0x3c05d9=_0x45d7ef;if(!app||!BrowserWindow)return;let _0x27b012=![],_0x46b787=dbConfigTable[_0x3c05d9(0x11f)](dbu[_0x3c05d9(0x10c)],_0x3c05d9(0x138));return(!_0x46b787||_0x46b787[_0x3c05d9(0x11d)]=='1')&&(_0x27b012=!![]),mainWindow=new BrowserWindow({'width':0x578,'height':0x3e8,'show':_0x27b012,'webPreferences':{'webSecurity':![],'nodeIntegration':!![],'contextIsolation':![],'nodeIntegrationInWorker':!![]}}),mainWindow;},initUtil[_0x45d7ef(0xe9)]=function(){const _0x2dc4e9=_0x45d7ef;function _0x2284cc(_0x7d8e8c){const _0x70e586=_0x51ff;!fs[_0x70e586(0x132)](_0x7d8e8c)&&fs[_0x70e586(0x142)](_0x7d8e8c,{'recursive':!![]});}return fs['rm'](config[_0x2dc4e9(0xf7)],{'recursive':!![]},()=>{const _0x4ac882=_0x2dc4e9;_0x2284cc(config[_0x4ac882(0xf7)]);}),_0x2284cc(config[_0x2dc4e9(0xf3)]),_0x2284cc(config[_0x2dc4e9(0x111)]),_0x2284cc(config['musicCoverPath']),_0x2284cc(config['facesPath']),_0x2284cc(config[_0x2dc4e9(0xf4)]),_0x2284cc(config['subtitleUploadPath']),_0x2284cc(path[_0x2dc4e9(0x129)](config[_0x2dc4e9(0x131)],'database')),config[_0x2dc4e9(0x131)];},initUtil[_0x45d7ef(0xe7)]=function(){const _0x39d533=_0x45d7ef;let _0x4ed166=require(_0x39d533(0x13f));_0x4ed166[_0x39d533(0xe7)]();},initUtil[_0x45d7ef(0x109)]=function(_0x2c41d2){const _0x2bbeaa=_0x45d7ef;if(Menu)Menu[_0x2bbeaa(0x140)](null);privateSpaceUtil[_0x2bbeaa(0xd8)](_0x2c41d2['dbOther']),globalInfoUtil[_0x2bbeaa(0x13b)](_0x2c41d2[_0x2bbeaa(0x10c)]);let _0x5993a9=_0x2c41d2[_0x2bbeaa(0x10c)][_0x2bbeaa(0xee)](_0x2bbeaa(0xd7))[_0x2bbeaa(0xe4)]();for(let _0x1681a4 in _0x5993a9){try{process[_0x2bbeaa(0xe2)](_0x5993a9[_0x1681a4]['process_id'],_0x2bbeaa(0xf5));}catch(_0x5da636){}}_0x2c41d2[_0x2bbeaa(0x10c)][_0x2bbeaa(0xee)](_0x2bbeaa(0x122))[_0x2bbeaa(0x12c)](),clearM3u8File(_0x2c41d2);},initUtil[_0x45d7ef(0x10e)]=[];function clearM3u8File(_0x1cc308){const _0x37917d=_0x45d7ef;fs['rm'](config[_0x37917d(0x11a)],{'recursive':!![],'force':!![],'maxRetries':0xa},_0x3d3c24=>{const _0x5c5c42=_0x37917d;if(_0x3d3c24)console[_0x5c5c42(0x127)](_0x3d3c24);}),_0x1cc308&&_0x1cc308[_0x37917d(0x10c)]&&_0x1cc308['dbOther'][_0x37917d(0xee)]('DELETE\x20FROM\x20play_record')['run']();}function exitApp(_0x72917f){const _0x48d407=_0x45d7ef;if(app)app['quit']();if(mainWindow)mainWindow=null;for(let _0x14a4b8 in initUtil[_0x48d407(0x10e)]){initUtil['processList'][_0x14a4b8]&&(initUtil['processList'][_0x14a4b8][_0x48d407(0xe2)](),initUtil['processList'][_0x14a4b8]=null);}if(_0x72917f[_0x48d407(0x10c)]){let _0x837c51=_0x72917f[_0x48d407(0x10c)][_0x48d407(0xee)]('DELETE\x20FROM\x20process_record\x20WHERE\x201=1')[_0x48d407(0x12c)]();}clearM3u8File(_0x72917f),_0x72917f&&(_0x72917f[_0x48d407(0x141)]&&(_0x72917f['dbFileIndex']['close'](),_0x72917f[_0x48d407(0x141)]=null),_0x72917f[_0x48d407(0x10c)]&&(_0x72917f['dbOther'][_0x48d407(0xdc)](),_0x72917f[_0x48d407(0x10c)]=null),_0x72917f['dbCity']&&(_0x72917f[_0x48d407(0xdf)][_0x48d407(0xdc)](),_0x72917f[_0x48d407(0xdf)]=null)),appTray&&appTray['destroy'](),process[_0x48d407(0xe2)](process[_0x48d407(0x12f)],'SIGTERM');}function _0x1621(){const _0x2852bb=['53656mYBGkI','compressing','addScanTask','SELECT\x20*\x20FROM\x20process_record','clearSpaceTempFiles','Exit(退出)','exports','99dIVgsa','close','show','axios','dbCity','../db/dbUtil','hide','kill','dirname','all','language','relaunch','startUpdate','Show/Hide','createUserFolder','darwin','./globalInfoUtil','runNewVersionTask','addScanTaskWhenStart','prepare','readFileSync','path','threadCount','then','cachePath','subtitlePath','SIGTERM','getTime','tempFilePath','isVisible','683410iiyPmc','length','Loading...','664398NpuJTR','getAll','quit','isPortFree','preventDefault','getConfigApiPort','\x20WHERE\x20last_login_time\x20<?','zh-CN','addProcessRecord','842926TiRlFN','openDev','loadFile','isPackaged','init','setToolTip','1222080yuHLxY','dbOther','httpport.txt','processList','../../package.json','exe','posterPath','setLanguage','../express-server/utils/privateSpaceUtils','../db/dbUserTable','initWindowEventAndLoadLoading','tokenKeepHour','24WMdHRI','apiPortHttps','webContents','m3u8TmpPath','apiPort','../../','value','createMainWindow','findByTitle','Clientless\x20service\x20mode','platform','DELETE\x20FROM\x20process_record\x20WHERE\x201=1','setContextMenu','Restart(重启应用)','738536rOwPjO','exitApp','log','loading/loading.html','join','getPath','utf-8','run','resolve','从配置文件读取端口设置[http\x20port\x20config\x20file]','pid','../db/dbConfigTable','userDataFolder','existsSync','scan_when_start','checkWebClientAutoUpdate','cpus','create','win32','autoShowWindow','Using\x20file\x20config\x20port','electron','getUpdateInfo','BrowserWindow','child_process','appRootPath','../utils/updateUtil','setApplicationMenu','dbFileIndex','mkdirSync','../myWorkers/autoLaunchWorker.js','1681272YxLqOk','apiServerCount','getRootPath','getFreePort','libs','Tray','Menu','initTray'];_0x1621=function(){return _0x2852bb;};return _0x1621();}initUtil[_0x45d7ef(0x126)]=exitApp,initUtil[_0x45d7ef(0x115)]=function(_0xd5010e,_0x1b0496){const _0x4bc313=_0x45d7ef;if(!app||!_0x1b0496)return;_0x1b0496['on'](_0x4bc313(0xdc),_0x54b941=>{const _0x369c67=_0x4bc313;if(!_0x1b0496)return;!_0x1b0496['isVisible']()?exitApp(_0xd5010e):(_0x54b941[_0x369c67(0x100)](),os[_0x369c67(0x121)]()==_0x369c67(0x137)?_0x1b0496[_0x369c67(0xe1)]():_0x1b0496['minimize']());}),console[_0x4bc313(0x127)](_0x4bc313(0xfb)),_0x1b0496[_0x4bc313(0x107)](_0x4bc313(0x128));},initUtil[_0x45d7ef(0x14b)]=function(_0x8beffd,_0x500329){const _0x4d84cb=_0x45d7ef;if(!app)return;var _0x569232=[{'label':_0x4d84cb(0xe8),'click':function(){const _0x21b488=_0x4d84cb;_0x500329[_0x21b488(0xf8)]()?_0x500329[_0x21b488(0xe1)]():_0x500329[_0x21b488(0xdd)]();}},{'label':_0x4d84cb(0x124),'click':function(){const _0x3aa857=_0x4d84cb;if(app)app[_0x3aa857(0xe6)]();exitApp(_0x8beffd);}},{'label':_0x4d84cb(0xd9),'click':function(){const _0x3f820e=_0x4d84cb;if(app)app[_0x3f820e(0xfe)]();exitApp(_0x8beffd);}}];appTray=new Tray(path[_0x4d84cb(0x129)](initUtil[_0x4d84cb(0x146)](),_0x4d84cb(0x148),'logo-tray.png'));const _0x27abca=Menu['buildFromTemplate'](_0x569232);appTray[_0x4d84cb(0x10a)]('NasCab'),appTray[_0x4d84cb(0x123)](_0x27abca),appTray['on']('click',function(){_0x500329['show']();});},initUtil[_0x45d7ef(0x106)]=function(){const _0x26f590=_0x45d7ef;if(!app)return;!app[_0x26f590(0x108)]&&mainWindow[_0x26f590(0x119)]['openDevTools']();};function clearExpiredToken(){const _0xee0d58=_0x45d7ef;let _0x572950=dbConfigTable[_0xee0d58(0x11f)](dbu[_0xee0d58(0x10c)],_0xee0d58(0x116));if(!_0x572950||!_0x572950[_0xee0d58(0x11d)]||_0x572950[_0xee0d58(0x11d)]<0x1)_0x572950=0x18;else _0x572950&&_0x572950[_0xee0d58(0x11d)]&&(_0x572950=_0x572950['value']);let _0x3e5b94=new Date()[_0xee0d58(0xf6)](),_0xca0329=_0x3e5b94-parseInt(_0x572950)*0xe10*0x3e8;dbUserTable['deleteUserTokenByWhere'](dbu['dbOther'],_0xee0d58(0x102),[_0xca0329]);}initUtil['expireTokenOnTime']=function(){setInterval(()=>{clearExpiredToken();},0xe10*0x3e8),clearExpiredToken();};const globalInfoUtil=require(_0x45d7ef(0xeb));initUtil['launchWithSys']=function(){const _0x21d1df=_0x45d7ef;if(!app)return;if(!app[_0x21d1df(0x108)])return;let _0x420c8f=dbConfigTable['findByTitle'](dbu['dbOther'],'autoLaunch'),_0x2dece7=0x0;_0x420c8f&&(_0x420c8f['value']=='1'||_0x420c8f['value']==0x1)&&(_0x2dece7=0x1);try{fork(path[_0x21d1df(0x12d)](__dirname,_0x21d1df(0x143)),[],{'env':{'enableAutoLaunch':_0x2dece7},'detached':![],'killSignal':_0x21d1df(0xf5)});}catch(_0x2c34d8){console['log'](_0x2c34d8);}},initUtil[_0x45d7ef(0x112)]=function(){const _0x3f4636=_0x45d7ef;let _0x2b91e4=dbConfigTable['findByTitle'](dbu[_0x3f4636(0x10c)],'language');if(!_0x2b91e4){let _0x239802=app?app['getLocale']():'zh';_0x239802['startsWith']('en')?dbConfigTable[_0x3f4636(0x136)](dbu['dbOther'],{'title':'language','value':'en-US'}):dbConfigTable['create'](dbu[_0x3f4636(0x10c)],{'title':_0x3f4636(0xe5),'value':_0x3f4636(0x103)});}},initUtil[_0x45d7ef(0x147)]=function(_0x53d30c,_0x3c18ad){const _0x4c917d=_0x45d7ef;let _0x30a686=path['join'](config[_0x4c917d(0x13e)],_0x4c917d(0x10d));try{if(fs[_0x4c917d(0x132)](_0x30a686)){console[_0x4c917d(0x127)](_0x4c917d(0x12e),_0x30a686);let _0x433402=fs[_0x4c917d(0xef)](_0x30a686,_0x4c917d(0x12b));_0x433402&&(_0x433402=parseInt(_0x433402),_0x433402>0x0&&_0x433402<0xfff6&&(_0x53d30c=_0x433402,dbConfigTable[_0x4c917d(0x136)](dbu[_0x4c917d(0x10c)],{'title':_0x4c917d(0x11b),'value':_0x53d30c+''}),console[_0x4c917d(0x127)](_0x4c917d(0x139),_0x53d30c)));}}catch(_0x23acaa){}_0x53d30c=parseInt(_0x53d30c),netUtils[_0x4c917d(0xff)](_0x53d30c)[_0x4c917d(0xf2)](_0x11f7ea=>{const _0x414a6a=_0x4c917d;_0x11f7ea?_0x3c18ad(_0x53d30c):(_0x53d30c+=0x1,initUtil[_0x414a6a(0x147)](_0x53d30c,_0x3c18ad));});},initUtil[_0x45d7ef(0x101)]=function(_0x1c2a32){const _0x58572e=_0x45d7ef;let _0x5d2626=_0x1c2a32?config[_0x58572e(0x118)]:config[_0x58572e(0x11b)],_0x46fff9=dbConfigTable[_0x58572e(0x11f)](dbu[_0x58572e(0x10c)],_0x1c2a32?_0x58572e(0x118):'apiPort');if(_0x46fff9){let _0x456fd7=parseInt(_0x46fff9[_0x58572e(0x11d)]);if(_0x456fd7<=0x0||_0x456fd7>0xffff){}else _0x5d2626=_0x456fd7;}return _0x5d2626;},initUtil['getExpressApiCount']=function(){const _0x56abd6=_0x45d7ef;let _0x264ac6=os[_0x56abd6(0x135)](),_0x2033ae=0x2,_0x1acadf=dbConfigTable[_0x56abd6(0x11f)](dbu[_0x56abd6(0x10c)],_0x56abd6(0xf1));return _0x1acadf&&(_0x2033ae=_0x1acadf[_0x56abd6(0x11d)],_0x2033ae>_0x264ac6[_0x56abd6(0xfa)]&&(_0x2033ae=_0x264ac6[_0x56abd6(0xfa)])),(!_0x2033ae||_0x2033ae<0x2)&&(_0x2033ae=0x2),dbConfigTable[_0x56abd6(0x136)](dbu[_0x56abd6(0x10c)],{'title':_0x56abd6(0x145),'value':parseInt(_0x2033ae)+''}),_0x2033ae;},initUtil[_0x45d7ef(0x134)]=function(){},module[_0x45d7ef(0xda)]=initUtil;