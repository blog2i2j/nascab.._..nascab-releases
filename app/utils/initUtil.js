const _0x2d9a2a=_0x2473;(function(_0x227de5,_0x3715b3){const _0x5d85e3=_0x2473,_0x4a8ea5=_0x227de5();while(!![]){try{const _0x17fc5a=parseInt(_0x5d85e3(0x203))/0x1*(parseInt(_0x5d85e3(0x1be))/0x2)+-parseInt(_0x5d85e3(0x1c1))/0x3+-parseInt(_0x5d85e3(0x1cc))/0x4*(parseInt(_0x5d85e3(0x1bc))/0x5)+parseInt(_0x5d85e3(0x1de))/0x6*(-parseInt(_0x5d85e3(0x1b0))/0x7)+parseInt(_0x5d85e3(0x1b4))/0x8*(parseInt(_0x5d85e3(0x1ae))/0x9)+parseInt(_0x5d85e3(0x223))/0xa+-parseInt(_0x5d85e3(0x1e8))/0xb;if(_0x17fc5a===_0x3715b3)break;else _0x4a8ea5['push'](_0x4a8ea5['shift']());}catch(_0x235dea){_0x4a8ea5['push'](_0x4a8ea5['shift']());}}}(_0x1c41,0xc2ea2));let app,BrowserWindow,Menu,Tray,protocol;function _0x1c41(){const _0x4c9532=['setApplicationMenu','path','deleteUserTokenByWhere','12477377JbSbcg','openDevTools','startsWith','../utils/updateUtil','join','hide','../db/dbUserTable','threadCount','getFreePort','clearSpaceTempFiles','autoShowWindow','dbOther','initDbu','then','从配置文件读取端口设置[http\x20port\x20config\x20file]','apiServerCount','cpus','loadFile','httpport.txt','process_id','readFileSync','./globalInfoUtil','subtitleUploadPath','isPortFree','protocol','zh-CN','libs','431KlOxNx','../db/dbSourceFolderTable','apiPortHttps','SELECT\x20*\x20FROM\x20process_record','../db/dbConfigTable','../../','dirname','../myConfig/config','getUpdateInfo','findByTitle','tempFilePath','preventDefault','resolve','Exit(退出)','electron','getAll','createMainWindow','show','apiPort','../db/dbScanTaskTable','type','DELETE\x20FROM\x20process_record\x20WHERE\x201=1','getConfigApiPort','prepare','app','close','length','logo-tray.png','kill','initTray','create','posterPath','11357070pLOEvG','relaunch','4113729uTGNaU','../myWorkers/autoLaunchWorker.js','7CzFDRI','setLanguage','click','autoLaunch','16aSFyub','platform','pid','subtitlePath','log','Clientless\x20service\x20mode','../express-server/utils/privateSpaceUtils','expireTokenOnTime','10osdVjZ','Show/Hide','5972SXZyfo','cachePath','existsSync','2558907vWClJW','Menu','child_process','checkWebClientAutoUpdate','quit','NasCab','init','isPackaged','addScanTask','buildFromTemplate','getRootPath','1000364iTVZeQ','destroy','minimize','getPath','SIGTERM','dbCity','userDataFolder','value','language','../../package.json','dbFileIndex','tokenKeepHour','Restart(重启应用)','launchWithSys','../express-server/utils/netUtils','createUserFolder','run','startUpdate','306042NQvhMU','processList','BrowserWindow','setContextMenu','database','isVisible','m3u8TmpPath'];_0x1c41=function(){return _0x4c9532;};return _0x1c41();}try{let elec=require(_0x2d9a2a(0x211));app=elec[_0x2d9a2a(0x21b)],BrowserWindow=elec[_0x2d9a2a(0x1e0)],Menu=elec[_0x2d9a2a(0x1c2)],Tray=elec['Tray'],protocol=elec[_0x2d9a2a(0x200)];}catch(_0x3e8dfe){console['log'](_0x2d9a2a(0x1b9));}const {fork}=require(_0x2d9a2a(0x1c3));let path=require(_0x2d9a2a(0x1e6)),fs=require('fs'),os=require('os'),initUtil={},privateSpaceUtil=require(_0x2d9a2a(0x1ba)),dbConfigTable=require(_0x2d9a2a(0x207)),dbu='',mainWindow='';const config=require(_0x2d9a2a(0x20a));function _0x2473(_0x292300,_0x1bc1cc){const _0x1c410a=_0x1c41();return _0x2473=function(_0x2473c9,_0x300f0d){_0x2473c9=_0x2473c9-0x1ad;let _0x188746=_0x1c410a[_0x2473c9];return _0x188746;},_0x2473(_0x292300,_0x1bc1cc);}let netUtils=require(_0x2d9a2a(0x1da)),appTray;const dbUserTable=require(_0x2d9a2a(0x1ee));let axios=require('axios');var package=require('../../package.json');const compressing=require('compressing');let packageInfo=require(_0x2d9a2a(0x1d5));const dbSourceFolderTable=require(_0x2d9a2a(0x204)),dbScanTaskTable=require(_0x2d9a2a(0x216));initUtil['runNewVersionTask']=function(_0x127f12){},initUtil[_0x2d9a2a(0x1cb)]=function(){const _0x461805=_0x2d9a2a;let _0x3cf035='';return app&&app[_0x461805(0x1c8)]?(_0x3cf035=path[_0x461805(0x209)](app[_0x461805(0x1cf)]('exe')),os['platform']()=='darwin'&&(_0x3cf035=path[_0x461805(0x209)](_0x3cf035))):_0x3cf035=path[_0x461805(0x1ec)](__dirname,_0x461805(0x208)),_0x3cf035;},initUtil[_0x2d9a2a(0x1f4)]=function(){var _0x59c187=require('../db/dbUtil');return dbu=new _0x59c187(),dbu;},initUtil['addScanTaskWhenStart']=function(_0x152feb){const _0x48ba1a=_0x2d9a2a;let _0x5a8878=dbSourceFolderTable[_0x48ba1a(0x212)](_0x152feb);for(let _0x2079f8 of _0x5a8878){_0x2079f8['scan_when_start']==0x1&&dbScanTaskTable[_0x48ba1a(0x1c9)](_0x152feb,_0x2079f8[_0x48ba1a(0x217)],_0x2079f8[_0x48ba1a(0x1e6)]);}},initUtil['addProcessRecord']=function(_0x71e059,_0x37562a){const _0x33b6b7=_0x2d9a2a;_0x71e059['prepare']('REPLACE\x20INTO\x20process_record(process_id)\x20VALUES(?)')[_0x33b6b7(0x1dc)](_0x37562a+'');},initUtil[_0x2d9a2a(0x213)]=function(){const _0x233d9b=_0x2d9a2a;if(!app||!BrowserWindow)return;let _0xfb5e26=![],_0x10a4d7=dbConfigTable[_0x233d9b(0x20c)](dbu['dbOther'],_0x233d9b(0x1f2));return(!_0x10a4d7||_0x10a4d7[_0x233d9b(0x1d3)]=='1')&&(_0xfb5e26=!![]),mainWindow=new BrowserWindow({'width':0x578,'height':0x3e8,'show':_0xfb5e26,'webPreferences':{'webSecurity':![],'nodeIntegration':!![],'contextIsolation':![],'nodeIntegrationInWorker':!![]}}),mainWindow;},initUtil[_0x2d9a2a(0x1db)]=function(){const _0x5bcdf8=_0x2d9a2a;function _0x57975e(_0x231136){const _0x58fabe=_0x2473;!fs[_0x58fabe(0x1c0)](_0x231136)&&fs['mkdirSync'](_0x231136,{'recursive':!![]});}return fs['rm'](config[_0x5bcdf8(0x20d)],{'recursive':!![]},()=>{const _0x413545=_0x5bcdf8;_0x57975e(config[_0x413545(0x20d)]);}),_0x57975e(config[_0x5bcdf8(0x1bf)]),_0x57975e(config[_0x5bcdf8(0x222)]),_0x57975e(config['musicCoverPath']),_0x57975e(config['facesPath']),_0x57975e(config[_0x5bcdf8(0x1b7)]),_0x57975e(config[_0x5bcdf8(0x1fe)]),_0x57975e(path[_0x5bcdf8(0x1ec)](config[_0x5bcdf8(0x1d2)],_0x5bcdf8(0x1e2))),config[_0x5bcdf8(0x1d2)];},initUtil[_0x2d9a2a(0x1dd)]=function(){const _0x4eed76=_0x2d9a2a;let _0x336e2d=require(_0x4eed76(0x1eb));_0x336e2d['startUpdate']();},initUtil[_0x2d9a2a(0x1c7)]=function(_0x21a535){const _0xab9e95=_0x2d9a2a;if(Menu)Menu[_0xab9e95(0x1e5)](null);privateSpaceUtil[_0xab9e95(0x1f1)](_0x21a535['dbOther']),globalInfoUtil[_0xab9e95(0x20b)](_0x21a535[_0xab9e95(0x1f3)]);let _0x4d5d3e=_0x21a535['dbOther'][_0xab9e95(0x21a)](_0xab9e95(0x206))['all']();for(let _0x4f10e1 in _0x4d5d3e){try{process[_0xab9e95(0x21f)](_0x4d5d3e[_0x4f10e1][_0xab9e95(0x1fb)],_0xab9e95(0x1d0));}catch(_0x11b8b9){}}_0x21a535['dbOther'][_0xab9e95(0x21a)](_0xab9e95(0x218))[_0xab9e95(0x1dc)](),clearM3u8File(_0x21a535);},initUtil[_0x2d9a2a(0x1df)]=[];function clearM3u8File(_0x3ecb0d){const _0x44d6c6=_0x2d9a2a;fs['rm'](config[_0x44d6c6(0x1e4)],{'recursive':!![],'force':!![],'maxRetries':0xa},_0x2b73b2=>{const _0x902c73=_0x44d6c6;if(_0x2b73b2)console[_0x902c73(0x1b8)](_0x2b73b2);}),_0x3ecb0d&&_0x3ecb0d[_0x44d6c6(0x1f3)]&&_0x3ecb0d[_0x44d6c6(0x1f3)][_0x44d6c6(0x21a)]('DELETE\x20FROM\x20play_record')[_0x44d6c6(0x1dc)]();}function exitApp(_0x169ee1){const _0x15a841=_0x2d9a2a;if(app)app['quit']();if(mainWindow)mainWindow=null;for(let _0x2c01de in initUtil['processList']){initUtil[_0x15a841(0x1df)][_0x2c01de]&&(initUtil[_0x15a841(0x1df)][_0x2c01de]['kill'](),initUtil['processList'][_0x2c01de]=null);}if(_0x169ee1[_0x15a841(0x1f3)]){let _0x1044ad=_0x169ee1[_0x15a841(0x1f3)]['prepare'](_0x15a841(0x218))['run']();}clearM3u8File(_0x169ee1),_0x169ee1&&(_0x169ee1[_0x15a841(0x1d6)]&&(_0x169ee1[_0x15a841(0x1d6)][_0x15a841(0x21c)](),_0x169ee1[_0x15a841(0x1d6)]=null),_0x169ee1[_0x15a841(0x1f3)]&&(_0x169ee1[_0x15a841(0x1f3)][_0x15a841(0x21c)](),_0x169ee1[_0x15a841(0x1f3)]=null),_0x169ee1['dbCity']&&(_0x169ee1[_0x15a841(0x1d1)][_0x15a841(0x21c)](),_0x169ee1['dbCity']=null)),appTray&&appTray[_0x15a841(0x1cd)](),process[_0x15a841(0x21f)](process[_0x15a841(0x1b6)],_0x15a841(0x1d0));}initUtil['exitApp']=exitApp,initUtil['initWindowEventAndLoadLoading']=function(_0x109ffb,_0x1104ea){const _0x4a185a=_0x2d9a2a;if(!app||!_0x1104ea)return;_0x1104ea['on'](_0x4a185a(0x21c),_0x2b0ff=>{const _0x3d47ae=_0x4a185a;if(!_0x1104ea)return;!_0x1104ea[_0x3d47ae(0x1e3)]()?exitApp(_0x109ffb):(_0x2b0ff[_0x3d47ae(0x20e)](),os[_0x3d47ae(0x1b5)]()=='win32'?_0x1104ea[_0x3d47ae(0x1ed)]():_0x1104ea[_0x3d47ae(0x1ce)]());}),console[_0x4a185a(0x1b8)]('Loading...'),_0x1104ea[_0x4a185a(0x1f9)]('loading/loading.html');},initUtil[_0x2d9a2a(0x220)]=function(_0x34b581,_0x308ecf){const _0x1b90fa=_0x2d9a2a;if(!app)return;var _0x249aaa=[{'label':_0x1b90fa(0x1bd),'click':function(){const _0x25ce9d=_0x1b90fa;_0x308ecf[_0x25ce9d(0x1e3)]()?_0x308ecf[_0x25ce9d(0x1ed)]():_0x308ecf['show']();}},{'label':_0x1b90fa(0x1d8),'click':function(){const _0x2bd725=_0x1b90fa;if(app)app[_0x2bd725(0x1ad)]();exitApp(_0x34b581);}},{'label':_0x1b90fa(0x210),'click':function(){const _0x19757a=_0x1b90fa;if(app)app[_0x19757a(0x1c5)]();exitApp(_0x34b581);}}];appTray=new Tray(path[_0x1b90fa(0x1ec)](initUtil[_0x1b90fa(0x1cb)](),_0x1b90fa(0x202),_0x1b90fa(0x21e)));const _0xdab9=Menu[_0x1b90fa(0x1ca)](_0x249aaa);appTray['setToolTip'](_0x1b90fa(0x1c6)),appTray[_0x1b90fa(0x1e1)](_0xdab9),appTray['on'](_0x1b90fa(0x1b2),function(){const _0x58bef3=_0x1b90fa;_0x308ecf[_0x58bef3(0x214)]();});},initUtil['openDev']=function(){const _0x591569=_0x2d9a2a;if(!app)return;!app[_0x591569(0x1c8)]&&mainWindow['webContents'][_0x591569(0x1e9)]();};function clearExpiredToken(){const _0x191a1b=_0x2d9a2a;let _0x28a350=dbConfigTable['findByTitle'](dbu['dbOther'],_0x191a1b(0x1d7));if(!_0x28a350||!_0x28a350['value']||_0x28a350[_0x191a1b(0x1d3)]<0x1)_0x28a350=0x18;else _0x28a350&&_0x28a350[_0x191a1b(0x1d3)]&&(_0x28a350=_0x28a350['value']);let _0x4a6c95=new Date()['getTime'](),_0x171625=_0x4a6c95-parseInt(_0x28a350)*0xe10*0x3e8;dbUserTable[_0x191a1b(0x1e7)](dbu[_0x191a1b(0x1f3)],'\x20WHERE\x20last_login_time\x20<?',[_0x171625]);}initUtil[_0x2d9a2a(0x1bb)]=function(){setInterval(()=>{clearExpiredToken();},0xe10*0x3e8),clearExpiredToken();};const globalInfoUtil=require(_0x2d9a2a(0x1fd));initUtil[_0x2d9a2a(0x1d9)]=function(){const _0x1cd770=_0x2d9a2a;if(!app)return;if(!app[_0x1cd770(0x1c8)])return;let _0xee6a2b=dbConfigTable[_0x1cd770(0x20c)](dbu[_0x1cd770(0x1f3)],_0x1cd770(0x1b3)),_0x4b0800=0x0;_0xee6a2b&&(_0xee6a2b[_0x1cd770(0x1d3)]=='1'||_0xee6a2b[_0x1cd770(0x1d3)]==0x1)&&(_0x4b0800=0x1);try{fork(path[_0x1cd770(0x20f)](__dirname,_0x1cd770(0x1af)),[],{'env':{'enableAutoLaunch':_0x4b0800},'detached':![],'killSignal':'SIGTERM'});}catch(_0x5c8999){console[_0x1cd770(0x1b8)](_0x5c8999);}},initUtil[_0x2d9a2a(0x1b1)]=function(){const _0x15baf8=_0x2d9a2a;let _0x272ec4=dbConfigTable['findByTitle'](dbu[_0x15baf8(0x1f3)],_0x15baf8(0x1d4));if(!_0x272ec4){let _0x22ab86=app?app['getLocale']():'zh';_0x22ab86[_0x15baf8(0x1ea)]('en')?dbConfigTable[_0x15baf8(0x221)](dbu[_0x15baf8(0x1f3)],{'title':_0x15baf8(0x1d4),'value':'en-US'}):dbConfigTable[_0x15baf8(0x221)](dbu[_0x15baf8(0x1f3)],{'title':'language','value':_0x15baf8(0x201)});}},initUtil[_0x2d9a2a(0x1f0)]=function(_0x113b64,_0x389290){const _0x535d7b=_0x2d9a2a;let _0x46540a=path[_0x535d7b(0x1ec)](config['appRootPath'],_0x535d7b(0x1fa));try{if(fs['existsSync'](_0x46540a)){console[_0x535d7b(0x1b8)](_0x535d7b(0x1f6),_0x46540a);let _0x3fbfbd=fs[_0x535d7b(0x1fc)](_0x46540a,'utf-8');_0x3fbfbd&&(_0x3fbfbd=parseInt(_0x3fbfbd),_0x3fbfbd>0x0&&_0x3fbfbd<0xfff6&&(_0x113b64=_0x3fbfbd,dbConfigTable[_0x535d7b(0x221)](dbu['dbOther'],{'title':'apiPort','value':_0x113b64+''}),console[_0x535d7b(0x1b8)]('Using\x20file\x20config\x20port',_0x113b64)));}}catch(_0x1af38c){}_0x113b64=parseInt(_0x113b64),netUtils[_0x535d7b(0x1ff)](_0x113b64)[_0x535d7b(0x1f5)](_0xcd1c60=>{const _0x54f664=_0x535d7b;_0xcd1c60?_0x389290(_0x113b64):(_0x113b64+=0x1,initUtil[_0x54f664(0x1f0)](_0x113b64,_0x389290));});},initUtil[_0x2d9a2a(0x219)]=function(_0x1baac7){const _0x5abc7c=_0x2d9a2a;let _0x37f7c0=_0x1baac7?config[_0x5abc7c(0x205)]:config[_0x5abc7c(0x215)],_0x4da6db=dbConfigTable[_0x5abc7c(0x20c)](dbu[_0x5abc7c(0x1f3)],_0x1baac7?'apiPortHttps':'apiPort');if(_0x4da6db){let _0xd6e3fb=parseInt(_0x4da6db[_0x5abc7c(0x1d3)]);if(_0xd6e3fb<=0x0||_0xd6e3fb>0xffff){}else _0x37f7c0=_0xd6e3fb;}return _0x37f7c0;},initUtil['getExpressApiCount']=function(){const _0x37f13a=_0x2d9a2a;let _0x1c02b4=os[_0x37f13a(0x1f8)](),_0x12a1a1=0x2,_0x545f62=dbConfigTable[_0x37f13a(0x20c)](dbu['dbOther'],_0x37f13a(0x1ef));return _0x545f62&&(_0x12a1a1=_0x545f62[_0x37f13a(0x1d3)],_0x12a1a1>_0x1c02b4[_0x37f13a(0x21d)]&&(_0x12a1a1=_0x1c02b4[_0x37f13a(0x21d)])),(!_0x12a1a1||_0x12a1a1<0x2)&&(_0x12a1a1=0x2),dbConfigTable[_0x37f13a(0x221)](dbu[_0x37f13a(0x1f3)],{'title':_0x37f13a(0x1f7),'value':parseInt(_0x12a1a1)+''}),_0x12a1a1;},initUtil[_0x2d9a2a(0x1c4)]=function(){},module['exports']=initUtil;