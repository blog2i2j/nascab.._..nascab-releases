const _0x48c9bc=_0x5e17;(function(_0x4c2319,_0x5cd393){const _0x9883b5=_0x5e17,_0x370eea=_0x4c2319();while(!![]){try{const _0x534da9=-parseInt(_0x9883b5(0x152))/0x1*(-parseInt(_0x9883b5(0x133))/0x2)+parseInt(_0x9883b5(0x12c))/0x3*(parseInt(_0x9883b5(0x158))/0x4)+parseInt(_0x9883b5(0x11a))/0x5*(parseInt(_0x9883b5(0x15b))/0x6)+-parseInt(_0x9883b5(0x11f))/0x7+-parseInt(_0x9883b5(0x159))/0x8+parseInt(_0x9883b5(0x129))/0x9+parseInt(_0x9883b5(0x144))/0xa;if(_0x534da9===_0x5cd393)break;else _0x370eea['push'](_0x370eea['shift']());}catch(_0x37b253){_0x370eea['push'](_0x370eea['shift']());}}}(_0x24d2,0xa18a4));const config=require(_0x48c9bc(0x130));let fs=require('fs'),path=require(_0x48c9bc(0x12b));const dbFileIndexTable=require('../db/dbFileIndexTable'),dbConfigTable=require(_0x48c9bc(0x13b));let transCodeUtil=require(_0x48c9bc(0x153)),sha256=require(_0x48c9bc(0x13f)),FFmpeg=require(_0x48c9bc(0x120))['FFmpeg'];process[_0x48c9bc(0x14e)]=_0x48c9bc(0x140);const Database=require(_0x48c9bc(0x136));let dbFileIndex=new Database(config['dbFileIndex'],{'timeout':0xea60});dbFileIndex[_0x48c9bc(0x157)](_0x48c9bc(0x142));let dbOther=new Database(config[_0x48c9bc(0x12f)],{});dbOther[_0x48c9bc(0x157)](_0x48c9bc(0x142));const messageUtil=require(_0x48c9bc(0x132));function dealFinish(_0x425c9b,_0xa28dc5){const _0x4440b1=_0x48c9bc;if(_0x425c9b){let _0x375d7a=_0x4440b1(0x147)+dbFileIndexTable[_0x4440b1(0x139)]+_0x4440b1(0x151);dbFileIndex[_0x4440b1(0x126)](_0x375d7a)[_0x4440b1(0x14c)](_0x425c9b['id']);}_0xa28dc5&&_0xa28dc5();}function genStart(){return new Promise(async(_0x2ed05b,_0x4ff9f0)=>{const _0x13cc28=_0x5e17;let _0x36f285=dbFileIndexTable[_0x13cc28(0x11b)](dbFileIndex,_0x13cc28(0x138),'*',dbFileIndexTable[_0x13cc28(0x139)]);if(_0x36f285){let _0x3e06a1=_0x36f285[_0x13cc28(0x13d)];if(!_0x3e06a1)return dealFinish(_0x36f285,_0x2ed05b);let _0x586380=path[_0x13cc28(0x124)](_0x36f285[_0x13cc28(0x12b)],_0x36f285[_0x13cc28(0x14f)]);try{_0x3e06a1=JSON[_0x13cc28(0x123)](_0x3e06a1);}catch(_0x396e19){return dealFinish(_0x36f285,_0x2ed05b);}let _0x570804=[];for(let _0x574b66 in _0x3e06a1){let _0x1861b4=_0x3e06a1[_0x574b66];_0x1861b4['codec_type']==_0x13cc28(0x148)&&_0x570804[_0x13cc28(0x125)](_0x1861b4);}if(_0x570804['length']<0x1)return dealFinish(_0x36f285,_0x2ed05b);let _0x33b99c=0x0;function _0x944f59(){const _0x1b62e6=_0x13cc28;if(_0x33b99c>=_0x570804[_0x1b62e6(0x131)])return dealFinish(_0x36f285,_0x2ed05b);}function _0x2f5922(_0x10981a,_0x123f98,_0x51bdd9){const _0x446fc2=_0x13cc28;try{bgTaskId&&dbOther[_0x446fc2(0x126)](_0x446fc2(0x119)+bgTaskId)[_0x446fc2(0x14c)]();}catch(_0x4187fc){}return new Promise((_0x1d27a7,_0x4c9aa8)=>{const _0x2e6ccb=_0x446fc2;let _0x3a3fb0=FFmpeg({'timeout':0x258});_0x3a3fb0[_0x2e6ccb(0x127)](transCodeUtil[_0x2e6ccb(0x135)](_0x10981a))[_0x2e6ccb(0x134)]()[_0x2e6ccb(0x13c)]()[_0x2e6ccb(0x156)]([_0x2e6ccb(0x11e)+_0x51bdd9])[_0x2e6ccb(0x15a)](_0x123f98)['on'](_0x2e6ccb(0x143),function(_0x11ac18){})['on'](_0x2e6ccb(0x122),function(_0x4d77ad){const _0x4203c4=_0x2e6ccb;_0x4d77ad[_0x4203c4(0x11d)]&&_0x4d77ad['message'][_0x4203c4(0x154)](_0x4203c4(0x11c))==-0x1&&(fs['rm'](_0x123f98,_0x3fe209=>{}),dealFinish(_0x36f285,_0x1d27a7),_0x3a3fb0[_0x4203c4(0x12d)]());})['on']('end',function(){const _0x36dac5=_0x2e6ccb;console[_0x36dac5(0x13a)](_0x36dac5(0x146),_0x10981a),_0x3a3fb0[_0x36dac5(0x12d)](),_0x1d27a7();}),_0x3a3fb0[_0x2e6ccb(0x14c)]();});}for(let _0x245af7 in _0x570804){let _0x3a34fd=path[_0x13cc28(0x124)](config['subtitlePath'],sha256(_0x586380+_0x245af7)+_0x13cc28(0x155));try{let _0x901007=!![],_0x2853df=fs[_0x13cc28(0x13e)](_0x3a34fd);if(_0x2853df){let _0xa15dd4=fs[_0x13cc28(0x141)](_0x3a34fd);_0xa15dd4['size']>0x2710&&(_0x901007=![]);}if(_0x901007)await _0x2f5922(_0x586380,_0x3a34fd,_0x245af7),_0x33b99c+=0x1,_0x944f59();else{_0x33b99c+=0x1,_0x944f59();continue;}}catch(_0x22fb00){_0x33b99c+=0x1,_0x944f59();}}}else exitProcess();});}function _0x5e17(_0x268b7b,_0x5e2e14){const _0x24d21f=_0x24d2();return _0x5e17=function(_0x5e17ea,_0x1b447f){_0x5e17ea=_0x5e17ea-0x119;let _0x5581eb=_0x24d21f[_0x5e17ea];return _0x5581eb;},_0x5e17(_0x268b7b,_0x5e2e14);}let bgTaskId;try{let info=dbOther[_0x48c9bc(0x126)]('INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)')[_0x48c9bc(0x14c)]('SUBTITLE_PRE_GEN');bgTaskId=info[_0x48c9bc(0x12a)];}catch(_0xd6c1b5){}function exitProcess(){const _0x166963=_0x48c9bc;try{bgTaskId&&dbOther[_0x166963(0x126)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id='+bgTaskId)['run']();}catch(_0xf45724){}return process[_0x166963(0x128)]({'type':_0x166963(0x121)}),process[_0x166963(0x149)]();}async function runGen(){const _0x4fa5cd=_0x48c9bc;let _0x58404f=dbConfigTable['findByTitle'](dbOther,_0x4fa5cd(0x14a));!_0x58404f||_0x58404f&&_0x58404f[_0x4fa5cd(0x145)]=='1'?genStart(dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'])[_0x4fa5cd(0x137)](()=>{runGen();})[_0x4fa5cd(0x12e)](()=>{runGen();}):exitProcess();}process['on'](_0x48c9bc(0x14d),(_0xf0acf6,_0x2d828a)=>{const _0x120358=_0x48c9bc;console[_0x120358(0x13a)](_0xf0acf6),messageUtil[_0x120358(0x150)](dbOther,'Error\x20occurred\x20in\x20subtitles\x20gen\x20process',_0x120358(0x122),_0xf0acf6[_0x120358(0x14b)]||_0xf0acf6[_0x120358(0x11d)]);}),process['on']('exit',(_0x43f87d,_0x1ecd59)=>{process['send']({'type':'close'});}),runGen();function _0x24d2(){const _0xb93808=['../db/dbConfigTable','noVideo','stream_info','existsSync','sha256','NasCabSubtitleWorker','statSync','journal_mode\x20=\x20WAL','start','5435430gYuzIS','value','Subtitle\x20extraction\x20:\x20','UPDATE\x20','subtitle','exit','subtitlePreGen','stack','run','uncaughtException','title','filename','saveMsg','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','4899XZMEIP','../utils/transCodeUtil','indexOf','.vtt','outputOptions','pragma','4429644GHjoCG','7134712wtkbxW','output','67884SaHJVb','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','75vzeDyz','getByWhere','killed','message','-map\x200:s:','7113526PUyhDK','../libs/nasTrans','close','error','parse','join','push','prepare','input','send','6432912BYccQl','lastInsertRowid','path','3rvPmrX','kill','catch','dbOther','../myConfig/config','length','../utils/messageUtil','14FCCpyQ','noAudio','dealFFmpegPath','better-sqlite3','then','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','INDEX_TABLE_NAME_MOVIE','log'];_0x24d2=function(){return _0xb93808;};return _0x24d2();}