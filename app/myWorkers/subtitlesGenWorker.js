const _0x6d693e=_0x3072;(function(_0x563ae7,_0x2d6476){const _0x42343d=_0x3072,_0x5b8739=_0x563ae7();while(!![]){try{const _0x4c0c9d=-parseInt(_0x42343d(0x1c7))/0x1*(-parseInt(_0x42343d(0x1c0))/0x2)+-parseInt(_0x42343d(0x19e))/0x3+parseInt(_0x42343d(0x1ca))/0x4+parseInt(_0x42343d(0x1c4))/0x5+-parseInt(_0x42343d(0x1c2))/0x6+parseInt(_0x42343d(0x1a3))/0x7+parseInt(_0x42343d(0x19d))/0x8*(parseInt(_0x42343d(0x19a))/0x9);if(_0x4c0c9d===_0x2d6476)break;else _0x5b8739['push'](_0x5b8739['shift']());}catch(_0x12d847){_0x5b8739['push'](_0x5b8739['shift']());}}}(_0x5921,0x47055));const config=require(_0x6d693e(0x1a7));let fs=require('fs'),path=require(_0x6d693e(0x1cf));const dbFileIndexTable=require(_0x6d693e(0x1d9)),dbConfigTable=require('../db/dbConfigTable');let transCodeUtil=require(_0x6d693e(0x199)),sha256=require('sha256'),FFmpeg=require(_0x6d693e(0x1c6))[_0x6d693e(0x1db)];process[_0x6d693e(0x1b8)]=_0x6d693e(0x1d8);const Database=require(_0x6d693e(0x1d3));let dbFileIndex=new Database(config['dbFileIndex'],{'timeout':0xea60});dbFileIndex[_0x6d693e(0x1c9)](_0x6d693e(0x1b4));let dbOther=new Database(config[_0x6d693e(0x1d6)],{});dbOther['pragma']('journal_mode\x20=\x20WAL');const messageUtil=require(_0x6d693e(0x1cc));function _0x3072(_0x43765a,_0x35e11e){const _0x592103=_0x5921();return _0x3072=function(_0x30729d,_0x23964c){_0x30729d=_0x30729d-0x199;let _0x1c81b1=_0x592103[_0x30729d];return _0x1c81b1;},_0x3072(_0x43765a,_0x35e11e);}function dealFinish(_0x32410b,_0x51d9f3){const _0x11aad8=_0x6d693e;if(_0x32410b){let _0x97ca00=_0x11aad8(0x1c5)+dbFileIndexTable[_0x11aad8(0x1d1)]+_0x11aad8(0x1af);dbFileIndex['prepare'](_0x97ca00)[_0x11aad8(0x1b7)](_0x32410b['id']);}_0x51d9f3&&_0x51d9f3();}function genStart(){return new Promise(async(_0x4fc65b,_0x3000db)=>{const _0x59d0e6=_0x3072;let _0x565da8=dbFileIndexTable['getByWhere'](dbFileIndex,_0x59d0e6(0x1dd),'*',dbFileIndexTable[_0x59d0e6(0x1d1)]);if(_0x565da8){let _0xa2ea2f=_0x565da8[_0x59d0e6(0x19c)];if(!_0xa2ea2f)return dealFinish(_0x565da8,_0x4fc65b);let _0x46b7ee=path[_0x59d0e6(0x1ce)](_0x565da8['path'],_0x565da8['filename']);try{_0xa2ea2f=JSON[_0x59d0e6(0x1bb)](_0xa2ea2f);}catch(_0x273ce6){return dealFinish(_0x565da8,_0x4fc65b);}let _0x37dead=[];for(let _0x459120 in _0xa2ea2f){let _0x4c7745=_0xa2ea2f[_0x459120];_0x4c7745[_0x59d0e6(0x1b3)]==_0x59d0e6(0x1d7)&&_0x37dead[_0x59d0e6(0x1d2)](_0x4c7745);}if(_0x37dead[_0x59d0e6(0x1a1)]<0x1)return dealFinish(_0x565da8,_0x4fc65b);let _0x151c65=0x0;function _0x4fa2cc(){const _0x407e0c=_0x59d0e6;if(_0x151c65>=_0x37dead[_0x407e0c(0x1a1)])return dealFinish(_0x565da8,_0x4fc65b);}function _0x291a13(_0x457b2e,_0x4fbe7c,_0x3f2d4b){const _0x14b1d5=_0x59d0e6;try{bgTaskId&&dbOther[_0x14b1d5(0x1d4)](_0x14b1d5(0x1b2)+bgTaskId)['run']();}catch(_0x35f430){}return new Promise((_0x5f55c1,_0x1dd40d)=>{const _0x20fe1f=_0x14b1d5;let _0x3b140a=FFmpeg({'timeout':0x258});_0x3b140a[_0x20fe1f(0x1c1)](transCodeUtil[_0x20fe1f(0x1ba)](_0x457b2e))[_0x20fe1f(0x19b)]()[_0x20fe1f(0x1ae)]()[_0x20fe1f(0x1aa)]([_0x20fe1f(0x1ac)+_0x3f2d4b])[_0x20fe1f(0x1da)](_0x4fbe7c)['on'](_0x20fe1f(0x1a8),function(_0x7388af){})['on']('error',function(_0x10e01f){const _0x526bd2=_0x20fe1f;_0x10e01f[_0x526bd2(0x1a6)]&&_0x10e01f[_0x526bd2(0x1a6)][_0x526bd2(0x1b5)](_0x526bd2(0x1b6))==-0x1&&(fs['rm'](_0x4fbe7c,_0x3f6658=>{}),dealFinish(_0x565da8,_0x5f55c1),_0x3b140a[_0x526bd2(0x1d0)]());})['on'](_0x20fe1f(0x1ad),function(){const _0x5c0e25=_0x20fe1f;console[_0x5c0e25(0x1b0)](_0x5c0e25(0x1d5),_0x457b2e),_0x3b140a[_0x5c0e25(0x1d0)](),_0x5f55c1();}),_0x3b140a[_0x20fe1f(0x1b7)]();});}for(let _0x456b55 in _0x37dead){let _0x52288b=path[_0x59d0e6(0x1ce)](config[_0x59d0e6(0x1b9)],sha256(_0x46b7ee+_0x456b55)+_0x59d0e6(0x1be));try{let _0x42fe13=!![],_0x92b5cd=fs[_0x59d0e6(0x1a2)](_0x52288b);if(_0x92b5cd){let _0x24691a=fs[_0x59d0e6(0x1bf)](_0x52288b);_0x24691a['size']>0x2710&&(_0x42fe13=![]);}if(_0x42fe13)await _0x291a13(_0x46b7ee,_0x52288b,_0x456b55),_0x151c65+=0x1,_0x4fa2cc();else{_0x151c65+=0x1,_0x4fa2cc();continue;}}catch(_0x2102dc){_0x151c65+=0x1,_0x4fa2cc();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther[_0x6d693e(0x1d4)](_0x6d693e(0x1a4))[_0x6d693e(0x1b7)]('SUBTITLE_PRE_GEN');bgTaskId=info[_0x6d693e(0x1c8)];}catch(_0x2b81fd){}function exitProcess(){const _0x42c422=_0x6d693e;try{bgTaskId&&dbOther[_0x42c422(0x1d4)](_0x42c422(0x1ab)+bgTaskId)[_0x42c422(0x1b7)]();}catch(_0x29f0cd){}return process[_0x42c422(0x19f)]({'type':_0x42c422(0x1cd)}),process['exit']();}async function runGen(){const _0x3eabe0=_0x6d693e;let _0x284ac0=dbConfigTable[_0x3eabe0(0x1a0)](dbOther,'subtitlePreGen');!_0x284ac0||_0x284ac0&&_0x284ac0[_0x3eabe0(0x1dc)]=='1'?genStart(dbFileIndexTable[_0x3eabe0(0x1d1)])[_0x3eabe0(0x1b1)](()=>{runGen();})[_0x3eabe0(0x1bc)](()=>{runGen();}):exitProcess();}process['on']('uncaughtException',(_0x4e47fd,_0x53b372)=>{const _0x1bec78=_0x6d693e;console[_0x1bec78(0x1b0)](_0x4e47fd),messageUtil[_0x1bec78(0x1cb)](dbOther,_0x1bec78(0x1a5),_0x1bec78(0x1a9),_0x4e47fd[_0x1bec78(0x1bd)]||_0x4e47fd[_0x1bec78(0x1a6)]);}),process['on'](_0x6d693e(0x1c3),(_0xe969f4,_0x1e6184)=>{const _0xf121fe=_0x6d693e;process[_0xf121fe(0x19f)]({'type':'close'});}),runGen();function _0x5921(){const _0x28643c=['end','noVideo','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','log','then','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','codec_type','journal_mode\x20=\x20WAL','indexOf','killed','run','title','subtitlePath','dealFFmpegPath','parse','catch','stack','.vtt','statSync','218oPdHEb','input','719052HAvxLX','exit','187030fdgZii','UPDATE\x20','../libs/nasTrans','1103NVnzsu','lastInsertRowid','pragma','243416FdienU','saveMsg','../utils/messageUtil','close','join','path','kill','INDEX_TABLE_NAME_MOVIE','push','better-sqlite3','prepare','Subtitle\x20extraction\x20:\x20','dbOther','subtitle','NasCabSubtitleWorker','../db/dbFileIndexTable','output','FFmpeg','value','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','../utils/transCodeUtil','1197RFXiEJ','noAudio','stream_info','392gtEUdS','761691jrUEkp','send','findByTitle','length','existsSync','3077452ajsNnm','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','Error\x20occurred\x20in\x20subtitles\x20gen\x20process','message','../myConfig/config','start','error','outputOptions','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','-map\x200:s:'];_0x5921=function(){return _0x28643c;};return _0x5921();}