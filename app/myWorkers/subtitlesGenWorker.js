function _0x2568(_0x150cfb,_0x3de549){const _0x303dad=_0x303d();return _0x2568=function(_0x25685d,_0x48b747){_0x25685d=_0x25685d-0x1d3;let _0x49a95a=_0x303dad[_0x25685d];return _0x49a95a;},_0x2568(_0x150cfb,_0x3de549);}const _0xa542d2=_0x2568;(function(_0xc7d305,_0x308fa0){const _0x1dd5cc=_0x2568,_0x58336e=_0xc7d305();while(!![]){try{const _0x544350=parseInt(_0x1dd5cc(0x1d7))/0x1*(-parseInt(_0x1dd5cc(0x1d5))/0x2)+parseInt(_0x1dd5cc(0x204))/0x3+-parseInt(_0x1dd5cc(0x203))/0x4+-parseInt(_0x1dd5cc(0x1ea))/0x5*(-parseInt(_0x1dd5cc(0x209))/0x6)+-parseInt(_0x1dd5cc(0x1dc))/0x7*(parseInt(_0x1dd5cc(0x1e6))/0x8)+-parseInt(_0x1dd5cc(0x1f7))/0x9*(parseInt(_0x1dd5cc(0x200))/0xa)+parseInt(_0x1dd5cc(0x217))/0xb;if(_0x544350===_0x308fa0)break;else _0x58336e['push'](_0x58336e['shift']());}catch(_0x396f85){_0x58336e['push'](_0x58336e['shift']());}}}(_0x303d,0xe7399));const config=require(_0xa542d2(0x1f4));let fs=require('fs'),path=require(_0xa542d2(0x1db));function _0x303d(){const _0x5db7c4=['dealFFmpegPath','outputOptions','join','filename','findByTitle','NasCabSubtitleWorker','exit','Subtitle\x20extraction\x20:\x20','close','337816RDtHPa','subtitlePreGen','message','kill','3107765ZYTRvl','sha256','stack','start','better-sqlite3','log','../db/dbFileIndexTable','length','stream_info','subtitle','../myConfig/config','subtitlePath','catch','2113650MPaPXa','prepare','pragma','end','title','lastInsertRowid','input','value','getByWhere','40ynOxkX','indexOf','INDEX_TABLE_NAME_MOVIE','5557348fIPvjb','3641172nnFsdq','push','../utils/messageUtil','statSync','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','12JLObVQ','../db/dbConfigTable','UPDATE\x20','uncaughtException','error','../libs/nasTrans','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','then','parse','../utils/transCodeUtil','journal_mode\x20=\x20WAL','send','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','33095194YmfxVI','size','.vtt','saveMsg','4090VSqirf','existsSync','761pnPQJG','FFmpeg','dbFileIndex','run','path','105dmVXce'];_0x303d=function(){return _0x5db7c4;};return _0x303d();}const dbFileIndexTable=require(_0xa542d2(0x1f0)),dbConfigTable=require(_0xa542d2(0x20a));let transCodeUtil=require(_0xa542d2(0x213)),sha256=require(_0xa542d2(0x1eb)),FFmpeg=require(_0xa542d2(0x20e))[_0xa542d2(0x1d8)];process[_0xa542d2(0x1fb)]=_0xa542d2(0x1e2);const Database=require(_0xa542d2(0x1ee));let dbFileIndex=new Database(config[_0xa542d2(0x1d9)],{'timeout':0xea60});dbFileIndex[_0xa542d2(0x1f9)](_0xa542d2(0x214));let dbOther=new Database(config['dbOther'],{});dbOther[_0xa542d2(0x1f9)](_0xa542d2(0x214));const messageUtil=require(_0xa542d2(0x206));function dealFinish(_0xb91c99,_0x17ff8a){const _0x46176f=_0xa542d2;if(_0xb91c99){let _0x3c070e=_0x46176f(0x20b)+dbFileIndexTable[_0x46176f(0x202)]+_0x46176f(0x208);dbFileIndex[_0x46176f(0x1f8)](_0x3c070e)[_0x46176f(0x1da)](_0xb91c99['id']);}_0x17ff8a&&_0x17ff8a();}function genStart(){return new Promise(async(_0x263ad2,_0x47229d)=>{const _0x23142a=_0x2568;let _0x7ef3f4=dbFileIndexTable[_0x23142a(0x1ff)](dbFileIndex,_0x23142a(0x210),'*',dbFileIndexTable[_0x23142a(0x202)]);if(_0x7ef3f4){let _0x4315be=_0x7ef3f4[_0x23142a(0x1f2)];if(!_0x4315be)return dealFinish(_0x7ef3f4,_0x263ad2);let _0x2b0d5d=path[_0x23142a(0x1df)](_0x7ef3f4[_0x23142a(0x1db)],_0x7ef3f4[_0x23142a(0x1e0)]);try{_0x4315be=JSON[_0x23142a(0x212)](_0x4315be);}catch(_0xd8825d){return dealFinish(_0x7ef3f4,_0x263ad2);}let _0x19eff4=[];for(let _0x479875 in _0x4315be){let _0x58eb99=_0x4315be[_0x479875];_0x58eb99['codec_type']==_0x23142a(0x1f3)&&_0x19eff4[_0x23142a(0x205)](_0x58eb99);}if(_0x19eff4[_0x23142a(0x1f1)]<0x1)return dealFinish(_0x7ef3f4,_0x263ad2);let _0x5dc082=0x0;function _0x1d1467(){const _0x31723d=_0x23142a;if(_0x5dc082>=_0x19eff4[_0x31723d(0x1f1)])return dealFinish(_0x7ef3f4,_0x263ad2);}function _0x1d393f(_0x1b8a4d,_0x36940e,_0x55c539){const _0x1f04c8=_0x23142a;try{bgTaskId&&dbOther[_0x1f04c8(0x1f8)](_0x1f04c8(0x20f)+bgTaskId)[_0x1f04c8(0x1da)]();}catch(_0x17a051){}return new Promise((_0x42d9c1,_0x1460f3)=>{const _0x164f44=_0x1f04c8;let _0x21bf31=FFmpeg({'timeout':0x258});_0x21bf31[_0x164f44(0x1fd)](transCodeUtil[_0x164f44(0x1dd)](_0x1b8a4d))['noAudio']()['noVideo']()[_0x164f44(0x1de)](['-map\x200:s:'+_0x55c539])['output'](_0x36940e)['on'](_0x164f44(0x1ed),function(_0x3f2d15){})['on'](_0x164f44(0x20d),function(_0x3a66ef){const _0x56e476=_0x164f44;_0x3a66ef[_0x56e476(0x1e8)]&&_0x3a66ef[_0x56e476(0x1e8)][_0x56e476(0x201)]('killed')==-0x1&&(fs['rm'](_0x36940e,_0xad4b77=>{}),dealFinish(_0x7ef3f4,_0x42d9c1),_0x21bf31[_0x56e476(0x1e9)]());})['on'](_0x164f44(0x1fa),function(){const _0xd859f3=_0x164f44;console[_0xd859f3(0x1ef)](_0xd859f3(0x1e4),_0x1b8a4d),_0x21bf31['kill'](),_0x42d9c1();}),_0x21bf31[_0x164f44(0x1da)]();});}for(let _0x1ce4cf in _0x19eff4){let _0x3b3ffc=path[_0x23142a(0x1df)](config[_0x23142a(0x1f5)],sha256(_0x2b0d5d+_0x1ce4cf)+_0x23142a(0x1d3));try{let _0x446dc7=!![],_0x21c644=fs[_0x23142a(0x1d6)](_0x3b3ffc);if(_0x21c644){let _0x22122a=fs[_0x23142a(0x207)](_0x3b3ffc);_0x22122a[_0x23142a(0x218)]>0x2710&&(_0x446dc7=![]);}if(_0x446dc7)await _0x1d393f(_0x2b0d5d,_0x3b3ffc,_0x1ce4cf),_0x5dc082+=0x1,_0x1d1467();else{_0x5dc082+=0x1,_0x1d1467();continue;}}catch(_0x4d59d2){_0x5dc082+=0x1,_0x1d1467();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther['prepare'](_0xa542d2(0x216))[_0xa542d2(0x1da)]('SUBTITLE_PRE_GEN');bgTaskId=info[_0xa542d2(0x1fc)];}catch(_0x39085e){}function exitProcess(){const _0x2302b9=_0xa542d2;try{bgTaskId&&dbOther[_0x2302b9(0x1f8)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id='+bgTaskId)[_0x2302b9(0x1da)]();}catch(_0x58a775){}return process[_0x2302b9(0x215)]({'type':_0x2302b9(0x1e5)}),process['exit']();}async function runGen(){const _0x2275bf=_0xa542d2;let _0x57606b=dbConfigTable[_0x2275bf(0x1e1)](dbOther,_0x2275bf(0x1e7));!_0x57606b||_0x57606b&&_0x57606b[_0x2275bf(0x1fe)]=='1'?genStart(dbFileIndexTable[_0x2275bf(0x202)])[_0x2275bf(0x211)](()=>{runGen();})[_0x2275bf(0x1f6)](()=>{runGen();}):exitProcess();}process['on'](_0xa542d2(0x20c),(_0x523542,_0x24bc52)=>{const _0x168d19=_0xa542d2;console[_0x168d19(0x1ef)](_0x523542),messageUtil[_0x168d19(0x1d4)](dbOther,'Error\x20occurred\x20in\x20subtitles\x20gen\x20process',_0x168d19(0x20d),_0x523542[_0x168d19(0x1ec)]||_0x523542[_0x168d19(0x1e8)]);}),process['on'](_0xa542d2(0x1e3),(_0x54020a,_0x206503)=>{const _0x196afc=_0xa542d2;process['send']({'type':_0x196afc(0x1e5)});}),runGen();