const _0x85ed59=_0x26b5;(function(_0x1a66f6,_0x306b39){const _0x54ff9a=_0x26b5,_0x5efc1f=_0x1a66f6();while(!![]){try{const _0x311d51=-parseInt(_0x54ff9a(0xe2))/0x1*(parseInt(_0x54ff9a(0xdb))/0x2)+-parseInt(_0x54ff9a(0xd6))/0x3+parseInt(_0x54ff9a(0xba))/0x4*(-parseInt(_0x54ff9a(0xd0))/0x5)+-parseInt(_0x54ff9a(0xc6))/0x6+parseInt(_0x54ff9a(0xcc))/0x7*(parseInt(_0x54ff9a(0xf6))/0x8)+parseInt(_0x54ff9a(0xe6))/0x9+parseInt(_0x54ff9a(0xd4))/0xa*(parseInt(_0x54ff9a(0xf7))/0xb);if(_0x311d51===_0x306b39)break;else _0x5efc1f['push'](_0x5efc1f['shift']());}catch(_0xf350d3){_0x5efc1f['push'](_0x5efc1f['shift']());}}}(_0x542a,0x263c0));const config=require('../myConfig/config');let fs=require('fs'),path=require(_0x85ed59(0xf0));function _0x542a(){const _0x4c37f8=['input','findByTitle','then','dbOther','1232YkOVQb','4015FAXkBm','codec_type','Subtitle\x20extraction\x20:\x20','killed','exit','run','subtitlePreGen','SUBTITLE_PRE_GEN','24qOPAXW','prepare','dealFFmpegPath','subtitlePath','UPDATE\x20','noAudio','INDEX_TABLE_NAME_MOVIE','kill','FFmpeg','dbFileIndex','../libs/nasTrans','output','273060RUAyMT','saveMsg','\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','push','log','value','3045ewKVDX','uncaughtException','close','journal_mode\x20=\x20WAL','126340ayjkUm','message','.vtt','noVideo','9390YcGzjR','title','293457UhKGAi','../db/dbFileIndexTable','send','end','outputOptions','220876BxHCnN','../utils/transCodeUtil','stack','parse','existsSync','size','NasCabSubtitleWorker','2lqfZGL','lastInsertRowid','length','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','2364264Wjidra','Error\x20occurred\x20in\x20subtitles\x20gen\x20process','join','sha256','indexOf','start','getByWhere','pragma','catch','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','path','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id='];_0x542a=function(){return _0x4c37f8;};return _0x542a();}const dbFileIndexTable=require(_0x85ed59(0xd7)),dbConfigTable=require('../db/dbConfigTable');let transCodeUtil=require(_0x85ed59(0xdc)),sha256=require(_0x85ed59(0xe9)),FFmpeg=require(_0x85ed59(0xc4))[_0x85ed59(0xc2)];process[_0x85ed59(0xd5)]=_0x85ed59(0xe1);const Database=require('better-sqlite3');function _0x26b5(_0x3aa98d,_0x4e374a){const _0x542a32=_0x542a();return _0x26b5=function(_0x26b51c,_0xb05b0d){_0x26b51c=_0x26b51c-0xb7;let _0x5d1ed7=_0x542a32[_0x26b51c];return _0x5d1ed7;},_0x26b5(_0x3aa98d,_0x4e374a);}let dbFileIndex=new Database(config[_0x85ed59(0xc3)],{'timeout':0xea60});dbFileIndex[_0x85ed59(0xed)](_0x85ed59(0xcf));let dbOther=new Database(config[_0x85ed59(0xf5)],{});dbOther[_0x85ed59(0xed)](_0x85ed59(0xcf));const messageUtil=require('../utils/messageUtil');function dealFinish(_0x557199,_0x44134d){const _0x452009=_0x85ed59;if(_0x557199){let _0xa0f912=_0x452009(0xbe)+dbFileIndexTable[_0x452009(0xc0)]+_0x452009(0xef);dbFileIndex[_0x452009(0xbb)](_0xa0f912)[_0x452009(0xb7)](_0x557199['id']);}_0x44134d&&_0x44134d();}function genStart(){return new Promise(async(_0x127ab4,_0x4ae7b4)=>{const _0xc96f84=_0x26b5;let _0x4c1e31=dbFileIndexTable[_0xc96f84(0xec)](dbFileIndex,_0xc96f84(0xc8),'*',dbFileIndexTable[_0xc96f84(0xc0)]);if(_0x4c1e31){let _0x2d8965=_0x4c1e31['stream_info'];if(!_0x2d8965)return dealFinish(_0x4c1e31,_0x127ab4);let _0x101e41=path[_0xc96f84(0xe8)](_0x4c1e31[_0xc96f84(0xf0)],_0x4c1e31['filename']);try{_0x2d8965=JSON[_0xc96f84(0xde)](_0x2d8965);}catch(_0xb6271f){return dealFinish(_0x4c1e31,_0x127ab4);}let _0x1d50c4=[];for(let _0x341b93 in _0x2d8965){let _0x3c232a=_0x2d8965[_0x341b93];_0x3c232a[_0xc96f84(0xf8)]=='subtitle'&&_0x1d50c4[_0xc96f84(0xc9)](_0x3c232a);}if(_0x1d50c4[_0xc96f84(0xe4)]<0x1)return dealFinish(_0x4c1e31,_0x127ab4);let _0x149875=0x0;function _0x4b2fdb(){if(_0x149875>=_0x1d50c4['length'])return dealFinish(_0x4c1e31,_0x127ab4);}function _0x3b7f36(_0x29514f,_0x36fb24,_0x5a2ac0){const _0xc05acd=_0xc96f84;try{bgTaskId&&dbOther[_0xc05acd(0xbb)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)['run']();}catch(_0x542ca3){}return new Promise((_0x3efd09,_0x14abb6)=>{const _0x337d8b=_0xc05acd;let _0x2d7f06=FFmpeg({'timeout':0x258});_0x2d7f06[_0x337d8b(0xf2)](transCodeUtil[_0x337d8b(0xbc)](_0x29514f))[_0x337d8b(0xbf)]()[_0x337d8b(0xd3)]()[_0x337d8b(0xda)](['-map\x200:s:'+_0x5a2ac0])[_0x337d8b(0xc5)](_0x36fb24)['on'](_0x337d8b(0xeb),function(_0x42e84c){})['on']('error',function(_0xdb08c6){const _0x514dc6=_0x337d8b;_0xdb08c6[_0x514dc6(0xd1)]&&_0xdb08c6[_0x514dc6(0xd1)][_0x514dc6(0xea)](_0x514dc6(0xfa))==-0x1&&(fs['rm'](_0x36fb24,_0x26b7dc=>{}),dealFinish(_0x4c1e31,_0x3efd09),_0x2d7f06[_0x514dc6(0xc1)]());})['on'](_0x337d8b(0xd9),function(){const _0x38b1c4=_0x337d8b;console[_0x38b1c4(0xca)](_0x38b1c4(0xf9),_0x29514f),_0x2d7f06['kill'](),_0x3efd09();}),_0x2d7f06['run']();});}for(let _0x4d2232 in _0x1d50c4){let _0x54dabb=path[_0xc96f84(0xe8)](config[_0xc96f84(0xbd)],sha256(_0x101e41+_0x4d2232)+_0xc96f84(0xd2));try{let _0xfc9409=!![],_0x2066b9=fs[_0xc96f84(0xdf)](_0x54dabb);if(_0x2066b9){let _0xc9fe2f=fs['statSync'](_0x54dabb);_0xc9fe2f[_0xc96f84(0xe0)]>0x2710&&(_0xfc9409=![]);}if(_0xfc9409)await _0x3b7f36(_0x101e41,_0x54dabb,_0x4d2232),_0x149875+=0x1,_0x4b2fdb();else{_0x149875+=0x1,_0x4b2fdb();continue;}}catch(_0x43b061){_0x149875+=0x1,_0x4b2fdb();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther[_0x85ed59(0xbb)](_0x85ed59(0xe5))['run'](_0x85ed59(0xb9));bgTaskId=info[_0x85ed59(0xe3)];}catch(_0x4b6222){}function exitProcess(){const _0x15d30c=_0x85ed59;try{bgTaskId&&dbOther[_0x15d30c(0xbb)](_0x15d30c(0xf1)+bgTaskId)[_0x15d30c(0xb7)]();}catch(_0xc698cf){}return process[_0x15d30c(0xd8)]({'type':_0x15d30c(0xce)}),process[_0x15d30c(0xfb)]();}async function runGen(){const _0x204ff4=_0x85ed59;let _0xaee9d9=dbConfigTable[_0x204ff4(0xf3)](dbOther,_0x204ff4(0xb8));!_0xaee9d9||_0xaee9d9&&_0xaee9d9[_0x204ff4(0xcb)]=='1'?genStart(dbFileIndexTable[_0x204ff4(0xc0)])[_0x204ff4(0xf4)](()=>{runGen();})[_0x204ff4(0xee)](()=>{runGen();}):exitProcess();}process['on'](_0x85ed59(0xcd),(_0x40fee2,_0x558af5)=>{const _0x2dfeb6=_0x85ed59;console[_0x2dfeb6(0xca)](_0x40fee2),messageUtil[_0x2dfeb6(0xc7)](dbOther,_0x2dfeb6(0xe7),'error',_0x40fee2[_0x2dfeb6(0xdd)]||_0x40fee2[_0x2dfeb6(0xd1)]);}),process['on'](_0x85ed59(0xfb),(_0x5d3e47,_0x45a8d8)=>{const _0x10a45c=_0x85ed59;process[_0x10a45c(0xd8)]({'type':'close'});}),runGen();