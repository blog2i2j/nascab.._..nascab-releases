const _0x596c02=_0x254c;(function(_0x5dffce,_0x5e3be1){const _0x367e28=_0x254c,_0x53a665=_0x5dffce();while(!![]){try{const _0x1225a2=-parseInt(_0x367e28(0x1e5))/0x1*(-parseInt(_0x367e28(0x219))/0x2)+parseInt(_0x367e28(0x1e9))/0x3*(-parseInt(_0x367e28(0x20a))/0x4)+-parseInt(_0x367e28(0x1f3))/0x5+parseInt(_0x367e28(0x1f6))/0x6*(-parseInt(_0x367e28(0x1fa))/0x7)+-parseInt(_0x367e28(0x1e4))/0x8*(parseInt(_0x367e28(0x1f2))/0x9)+-parseInt(_0x367e28(0x21a))/0xa*(parseInt(_0x367e28(0x1e6))/0xb)+-parseInt(_0x367e28(0x1f0))/0xc*(-parseInt(_0x367e28(0x208))/0xd);if(_0x1225a2===_0x5e3be1)break;else _0x53a665['push'](_0x53a665['shift']());}catch(_0x19266c){_0x53a665['push'](_0x53a665['shift']());}}}(_0x2052,0x6d294));const config=require(_0x596c02(0x217));let fs=require('fs'),path=require(_0x596c02(0x21c));function _0x2052(){const _0x57b881=['11641cZMtaf','close','dealFFmpegPath','log','subtitle','saveMsg','output','../db/dbConfigTable','value','exit','push','uncaughtException','start','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','91DutHky','end','4KBzDLE','SUBTITLE_PRE_GEN','sha256','FFmpeg','message','error','killed','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','kill','\x20set\x20pre_gen_subtitles=1\x20where\x20id=?','prepare','.vtt','lastInsertRowid','../myConfig/config','codec_type','142TafooQ','225510PvqzUf','../utils/transCodeUtil','path','pragma','../db/dbFileIndexTable','catch','join','then','journal_mode\x20=\x20WAL','-map\x200:s:','findByTitle','statSync','2504QlnLHa','7261JRhHYi','253KPQEYm','outputOptions','dbFileIndex','2092146eFbIWk','noVideo','size','run','INDEX_TABLE_NAME_MOVIE','NasCabSubtitleWorker','noAudio','4312632FmIJwD','../utils/messageUtil','12861KeDvWp','2633230wjlrmz','UPDATE\x20','better-sqlite3','1422ZGZWID','send','Error\x20occurred\x20in\x20subtitles\x20gen\x20process','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)'];_0x2052=function(){return _0x57b881;};return _0x2052();}const dbFileIndexTable=require(_0x596c02(0x21e)),dbConfigTable=require(_0x596c02(0x201));let transCodeUtil=require(_0x596c02(0x21b)),sha256=require(_0x596c02(0x20c)),FFmpeg=require('../libs/nasTrans')[_0x596c02(0x20d)];process['title']=_0x596c02(0x1ee);const Database=require(_0x596c02(0x1f5));let dbFileIndex=new Database(config[_0x596c02(0x1e8)],{'timeout':0xea60});dbFileIndex[_0x596c02(0x21d)](_0x596c02(0x1e0));let dbOther=new Database(config['dbOther'],{});dbOther[_0x596c02(0x21d)](_0x596c02(0x1e0));const messageUtil=require(_0x596c02(0x1f1));function dealFinish(_0x5ebcb6,_0x419e00){const _0x406ba2=_0x596c02;if(_0x5ebcb6){let _0x3970c3=_0x406ba2(0x1f4)+dbFileIndexTable[_0x406ba2(0x1ed)]+_0x406ba2(0x213);dbFileIndex['prepare'](_0x3970c3)['run'](_0x5ebcb6['id']);}_0x419e00&&_0x419e00();}function _0x254c(_0x739cbe,_0x4ecbc3){const _0x205296=_0x2052();return _0x254c=function(_0x254c59,_0x48920e){_0x254c59=_0x254c59-0x1de;let _0x8a16d3=_0x205296[_0x254c59];return _0x8a16d3;},_0x254c(_0x739cbe,_0x4ecbc3);}function genStart(){return new Promise(async(_0x1253d5,_0x6fa4f0)=>{const _0x38f2e9=_0x254c;let _0x128e6d=dbFileIndexTable['getByWhere'](dbFileIndex,'\x20pre_gen_subtitles\x20=0\x20\x20and\x20is_file=1\x20and\x20type=2\x20and\x20stream_info\x20is\x20not\x20null\x20and\x20stream_info\x20!=\x27undefined\x27\x20and\x20stream_info\x20!=0\x20LIMIT\x201','*',dbFileIndexTable[_0x38f2e9(0x1ed)]);if(_0x128e6d){let _0x6c6855=_0x128e6d['stream_info'];if(!_0x6c6855)return dealFinish(_0x128e6d,_0x1253d5);let _0x254517=path[_0x38f2e9(0x1de)](_0x128e6d[_0x38f2e9(0x21c)],_0x128e6d['filename']);try{_0x6c6855=JSON['parse'](_0x6c6855);}catch(_0x52e7fd){return dealFinish(_0x128e6d,_0x1253d5);}let _0x54404a=[];for(let _0x1478fa in _0x6c6855){let _0xd82bbe=_0x6c6855[_0x1478fa];_0xd82bbe[_0x38f2e9(0x218)]==_0x38f2e9(0x1fe)&&_0x54404a[_0x38f2e9(0x204)](_0xd82bbe);}if(_0x54404a['length']<0x1)return dealFinish(_0x128e6d,_0x1253d5);let _0x2dc302=0x0;function _0x49bea9(){if(_0x2dc302>=_0x54404a['length'])return dealFinish(_0x128e6d,_0x1253d5);}function _0x3111c7(_0x3b9e0a,_0x1bd2fd,_0x167afe){const _0x43c7c4=_0x38f2e9;try{bgTaskId&&dbOther['prepare'](_0x43c7c4(0x211)+bgTaskId)[_0x43c7c4(0x1ec)]();}catch(_0x172ce0){}return new Promise((_0x2e2a26,_0x1d265a)=>{const _0x225bb5=_0x43c7c4;let _0xe82f88=FFmpeg({'timeout':0x258});_0xe82f88['input'](transCodeUtil[_0x225bb5(0x1fc)](_0x3b9e0a))[_0x225bb5(0x1ef)]()[_0x225bb5(0x1ea)]()[_0x225bb5(0x1e7)]([_0x225bb5(0x1e1)+_0x167afe])[_0x225bb5(0x200)](_0x1bd2fd)['on'](_0x225bb5(0x206),function(_0x5734dd){})['on'](_0x225bb5(0x20f),function(_0x5c5a15){const _0x4df869=_0x225bb5;_0x5c5a15[_0x4df869(0x20e)]&&_0x5c5a15[_0x4df869(0x20e)]['indexOf'](_0x4df869(0x210))==-0x1&&(fs['rm'](_0x1bd2fd,_0x5c7d0b=>{}),dealFinish(_0x128e6d,_0x2e2a26),_0xe82f88[_0x4df869(0x212)]());})['on'](_0x225bb5(0x209),function(){const _0x2b75b5=_0x225bb5;console[_0x2b75b5(0x1fd)]('Subtitle\x20extraction\x20:\x20',_0x3b9e0a),_0xe82f88[_0x2b75b5(0x212)](),_0x2e2a26();}),_0xe82f88[_0x225bb5(0x1ec)]();});}for(let _0x3b3892 in _0x54404a){let _0x26a45e=path[_0x38f2e9(0x1de)](config['subtitlePath'],sha256(_0x254517+_0x3b3892)+_0x38f2e9(0x215));try{let _0x4c1af3=!![],_0x2d557b=fs['existsSync'](_0x26a45e);if(_0x2d557b){let _0x240fee=fs[_0x38f2e9(0x1e3)](_0x26a45e);_0x240fee[_0x38f2e9(0x1eb)]>0x2710&&(_0x4c1af3=![]);}if(_0x4c1af3)await _0x3111c7(_0x254517,_0x26a45e,_0x3b3892),_0x2dc302+=0x1,_0x49bea9();else{_0x2dc302+=0x1,_0x49bea9();continue;}}catch(_0x3add76){_0x2dc302+=0x1,_0x49bea9();}}}else exitProcess();});}let bgTaskId;try{let info=dbOther[_0x596c02(0x214)](_0x596c02(0x1f9))[_0x596c02(0x1ec)](_0x596c02(0x20b));bgTaskId=info[_0x596c02(0x216)];}catch(_0x559f4c){}function exitProcess(){const _0x2494cd=_0x596c02;try{bgTaskId&&dbOther['prepare'](_0x2494cd(0x207)+bgTaskId)['run']();}catch(_0x44c574){}return process[_0x2494cd(0x1f7)]({'type':_0x2494cd(0x1fb)}),process[_0x2494cd(0x203)]();}async function runGen(){const _0x3c4ff0=_0x596c02;let _0x35d3cd=dbConfigTable[_0x3c4ff0(0x1e2)](dbOther,'subtitlePreGen');!_0x35d3cd||_0x35d3cd&&_0x35d3cd[_0x3c4ff0(0x202)]=='1'?genStart(dbFileIndexTable[_0x3c4ff0(0x1ed)])[_0x3c4ff0(0x1df)](()=>{runGen();})[_0x3c4ff0(0x21f)](()=>{runGen();}):exitProcess();}process['on'](_0x596c02(0x205),(_0x338f9d,_0x373671)=>{const _0x33e00a=_0x596c02;console[_0x33e00a(0x1fd)](_0x338f9d),messageUtil[_0x33e00a(0x1ff)](dbOther,_0x33e00a(0x1f8),'error',_0x338f9d['stack']||_0x338f9d[_0x33e00a(0x20e)]);}),process['on'](_0x596c02(0x203),(_0x98abb4,_0x4a352c)=>{const _0x3b7355=_0x596c02;process[_0x3b7355(0x1f7)]({'type':_0x3b7355(0x1fb)});}),runGen();