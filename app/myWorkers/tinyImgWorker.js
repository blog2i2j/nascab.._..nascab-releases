const _0xfce3e5=_0x5115;(function(_0x41aa3f,_0x5e2b5b){const _0x5d540f=_0x5115,_0x13fb10=_0x41aa3f();while(!![]){try{const _0x5950c5=-parseInt(_0x5d540f(0x104))/0x1+parseInt(_0x5d540f(0x118))/0x2*(parseInt(_0x5d540f(0x119))/0x3)+parseInt(_0x5d540f(0x129))/0x4+-parseInt(_0x5d540f(0x109))/0x5+parseInt(_0x5d540f(0x10d))/0x6*(-parseInt(_0x5d540f(0x114))/0x7)+parseInt(_0x5d540f(0x12e))/0x8+parseInt(_0x5d540f(0x123))/0x9*(-parseInt(_0x5d540f(0x105))/0xa);if(_0x5950c5===_0x5e2b5b)break;else _0x13fb10['push'](_0x13fb10['shift']());}catch(_0x48daf7){_0x13fb10['push'](_0x13fb10['shift']());}}}(_0x892d,0x8d02d));const config=require(_0xfce3e5(0x128));let fs=require('fs'),path=require(_0xfce3e5(0x10a)),sharpUtil=require('../express-server/utils/sharpUtils');const dbFileIndexTable=require(_0xfce3e5(0x134)),Database=require('better-sqlite3');let dbOther=new Database(config[_0xfce3e5(0x11d)],{'timeout':0xea60});dbOther[_0xfce3e5(0x113)](_0xfce3e5(0x132));let dbFileIndex=new Database(config[_0xfce3e5(0x11c)],{'timeout':0xea60});dbFileIndex[_0xfce3e5(0x113)](_0xfce3e5(0x132));function _0x892d(){const _0x2ba690=['\x20tiny_path\x20is\x20null\x20and\x20type=1\x20LIMIT\x201','type','996045wAdfNZ','path','stat','log','1549968ypBiHl','genTinyFile','prepare','INDEX_TABLE_NAME_PHOTO','../utils/messageUtil','run','pragma','14kIIiPi','isFile','exit','image','2219396gXPMee','3mtvaro','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','NEW_TINY_IMAGE','dbFileIndex','dbOther','Error\x20occurred\x20in\x20thumbnail\x20process\x20','lastInsertRowid','INDEX_TABLE_NAME_MOVIE','basename','tiny_path','7443zWhMfy','send','GEN_TINY_IMAGE','getByWhere','dirname','../myConfig/config','3561892KZkAZe','uncaughtException','size','cachePath','updateById','9116112Piqymd','\x20tiny_path\x20is\x20null\x20and\x20type=2\x20LIMIT\x201','video','noData','journal_mode\x20=\x20WAL','title','../db/dbFileIndexTable','1092015SvCYlo','9120rdUVgu','join'];_0x892d=function(){return _0x2ba690;};return _0x892d();}const messageUtil=require(_0xfce3e5(0x111));process[_0xfce3e5(0x133)]='NasCabThumbnailWorker';function dealFail(_0x2b5c93,_0x3476c9,_0x1ce8d5,_0x2fe667,_0x2b0bff){const _0x446957=_0xfce3e5;dbFileIndexTable[_0x446957(0x12d)](_0x3476c9,_0x2fe667['id'],_0x446957(0x122),'0',_0x2b0bff),_0x2b5c93();}function genTiny(_0x4ff4d5,_0x9191c6,_0x2c05ba,_0x57bdf3,_0x5aca93,_0xbca7f4){const _0x166591=_0xfce3e5;let _0x5f26c6=_0x166591(0x117);_0x57bdf3[_0x166591(0x108)]==0x2&&(_0x5f26c6=_0x166591(0x130)),sharpUtil[_0x166591(0x10e)](_0x2c05ba,path[_0x166591(0x127)](_0x5aca93),path[_0x166591(0x121)](_0x5aca93),_0x5f26c6,_0x57bdf3,_0x339f27=>{const _0x8e17c5=_0x166591;dbFileIndexTable[_0x8e17c5(0x12d)](_0x9191c6,_0x57bdf3['id'],_0x8e17c5(0x122),_0x339f27,_0xbca7f4),_0x4ff4d5();},_0x2c9c32=>{dealFail(_0x4ff4d5,_0x9191c6,_0x2c05ba,_0x57bdf3,_0xbca7f4);});}function genStart(_0x52e572){return new Promise((_0x569af0,_0x505ba2)=>{const _0x2c8c98=_0x5115;let _0x374b7e=dbFileIndexTable[_0x2c8c98(0x126)](dbFileIndex,_0x2c8c98(0x107),'*',_0x52e572);!_0x374b7e&&(_0x374b7e=dbFileIndexTable[_0x2c8c98(0x126)](dbFileIndex,_0x2c8c98(0x12f),'*',_0x52e572));if(_0x374b7e){try{bgTaskId&&dbOther[_0x2c8c98(0x10f)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)['run']();}catch(_0x2c6e61){}let _0x463742=path[_0x2c8c98(0x106)](_0x374b7e[_0x2c8c98(0x10a)],_0x374b7e['filename']),_0x35ddd4=config['getFileHashName'](_0x374b7e),_0x32ec31=path[_0x2c8c98(0x106)](config[_0x2c8c98(0x12c)],_0x35ddd4);fs[_0x2c8c98(0x10b)](_0x32ec31,(_0xcef558,_0x3664c4)=>{const _0xc9e58d=_0x2c8c98;if(_0xcef558)return genTiny(_0x569af0,dbFileIndex,_0x463742,_0x374b7e,_0x32ec31,_0x52e572);_0x3664c4[_0xc9e58d(0x115)]()&&_0x3664c4[_0xc9e58d(0x12b)]>0x7d0?(dbFileIndexTable[_0xc9e58d(0x12d)](dbFileIndex,_0x374b7e['id'],_0xc9e58d(0x122),_0x32ec31,_0x52e572),_0x569af0()):genTiny(_0x569af0,dbFileIndex,_0x463742,_0x374b7e,_0x32ec31,_0x52e572);});}else _0x569af0('noData');});}let bgTaskId;try{let info=dbOther[_0xfce3e5(0x10f)](_0xfce3e5(0x11a))['run'](_0xfce3e5(0x125));bgTaskId=info[_0xfce3e5(0x11f)];}catch(_0x19640b){}let genCount=0x0;function _0x5115(_0x5c0085,_0x5e5699){const _0x892d42=_0x892d();return _0x5115=function(_0x51158b,_0x408ab2){_0x51158b=_0x51158b-0x104;let _0x476959=_0x892d42[_0x51158b];return _0x476959;},_0x5115(_0x5c0085,_0x5e5699);}async function runGen(){const _0x31ae3f=_0xfce3e5;try{let _0x26de89=await genStart(dbFileIndexTable[_0x31ae3f(0x110)]);_0x26de89!=_0x31ae3f(0x131)&&(genCount+=0x1);let _0x46c127=await genStart(dbFileIndexTable[_0x31ae3f(0x120)]);if(_0x26de89==_0x31ae3f(0x131)&&_0x46c127==_0x31ae3f(0x131)){try{bgTaskId&&dbOther[_0x31ae3f(0x10f)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20task_type=\x27GEN_TINY_IMAGE\x27')[_0x31ae3f(0x112)]();}catch(_0x36f735){}genCount>0x0&&process['send']({'type':_0x31ae3f(0x11b)}),process[_0x31ae3f(0x124)]({'type':'close'}),process[_0x31ae3f(0x116)]();}else return runGen();}catch(_0x18e5f0){return console[_0x31ae3f(0x10c)](_0x18e5f0),runGen();}}runGen();function exitProcess(){const _0x3cdfa0=_0xfce3e5;process[_0x3cdfa0(0x124)]({'type':'close'}),process[_0x3cdfa0(0x116)]();}process['on'](_0xfce3e5(0x12a),(_0x64a924,_0x448a33)=>{const _0x1d1f7c=_0xfce3e5;console[_0x1d1f7c(0x10c)](_0x1d1f7c(0x11e),_0x64a924),exitProcess();});