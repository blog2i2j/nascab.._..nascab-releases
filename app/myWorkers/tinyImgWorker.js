const _0x3fd531=_0x31fe;(function(_0x927ed,_0x2033aa){const _0x2e8e1d=_0x31fe,_0x5f1bea=_0x927ed();while(!![]){try{const _0x511635=parseInt(_0x2e8e1d(0x7f))/0x1+parseInt(_0x2e8e1d(0x72))/0x2*(parseInt(_0x2e8e1d(0x79))/0x3)+-parseInt(_0x2e8e1d(0x94))/0x4+-parseInt(_0x2e8e1d(0x8b))/0x5*(-parseInt(_0x2e8e1d(0x8f))/0x6)+parseInt(_0x2e8e1d(0x95))/0x7+parseInt(_0x2e8e1d(0x6d))/0x8*(parseInt(_0x2e8e1d(0x6f))/0x9)+-parseInt(_0x2e8e1d(0x92))/0xa;if(_0x511635===_0x2033aa)break;else _0x5f1bea['push'](_0x5f1bea['shift']());}catch(_0x1dcf6d){_0x5f1bea['push'](_0x5f1bea['shift']());}}}(_0x5cdd,0x89d6e));const config=require('../myConfig/config');let fs=require('fs'),path=require('path'),sharpUtil=require(_0x3fd531(0x8e));const dbFileIndexTable=require(_0x3fd531(0x8c)),Database=require('better-sqlite3');let dbOther=new Database(config['dbOther'],{'timeout':0xea60});dbOther[_0x3fd531(0x7a)](_0x3fd531(0x80));let dbFileIndex=new Database(config[_0x3fd531(0x8a)],{'timeout':0xea60});dbFileIndex[_0x3fd531(0x7a)](_0x3fd531(0x80));const messageUtil=require(_0x3fd531(0x8d));process['title']=_0x3fd531(0x86);function dealFail(_0x29827a,_0x18aced,_0x57e37c,_0x262e32,_0x1c7f73){const _0x677077=_0x3fd531;dbFileIndexTable[_0x677077(0x75)](_0x18aced,_0x262e32['id'],_0x677077(0x77),'0',_0x1c7f73),_0x29827a();}function genTiny(_0x50335c,_0x2b09bc,_0x14c9ea,_0x559e40,_0x2f92cc,_0x2cd222){const _0x278856=_0x3fd531;let _0xa36e3b=_0x278856(0x76);_0x559e40['type']==0x2&&(_0xa36e3b='video'),sharpUtil[_0x278856(0x70)](_0x14c9ea,path[_0x278856(0x96)](_0x2f92cc),path['basename'](_0x2f92cc),_0xa36e3b,_0x559e40,_0x5753ec=>{const _0xc8051f=_0x278856;dbFileIndexTable[_0xc8051f(0x75)](_0x2b09bc,_0x559e40['id'],'tiny_path',_0x5753ec,_0x2cd222),_0x50335c();},_0x2d9f4b=>{dealFail(_0x50335c,_0x2b09bc,_0x14c9ea,_0x559e40,_0x2cd222);});}function genStart(_0x6401f9){return new Promise((_0x3d5587,_0x71168a)=>{const _0x319660=_0x31fe;let _0x4a420b=dbFileIndexTable[_0x319660(0x84)](dbFileIndex,_0x319660(0x7d),'*',_0x6401f9);!_0x4a420b&&(_0x4a420b=dbFileIndexTable[_0x319660(0x84)](dbFileIndex,_0x319660(0x7e),'*',_0x6401f9));if(_0x4a420b){try{bgTaskId&&dbOther[_0x319660(0x91)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+bgTaskId)[_0x319660(0x87)]();}catch(_0x3e0bdd){}let _0x5db4cd=path[_0x319660(0x78)](_0x4a420b[_0x319660(0x7b)],_0x4a420b[_0x319660(0x89)]),_0x1c3358=config[_0x319660(0x6e)](_0x4a420b),_0x713dd1=path['join'](config['cachePath'],_0x1c3358);fs['stat'](_0x713dd1,(_0x300a9b,_0x409d57)=>{const _0x3d491a=_0x319660;if(_0x300a9b)return genTiny(_0x3d5587,dbFileIndex,_0x5db4cd,_0x4a420b,_0x713dd1,_0x6401f9);_0x409d57['isFile']()&&_0x409d57['size']>0x7d0?(dbFileIndexTable[_0x3d491a(0x75)](dbFileIndex,_0x4a420b['id'],_0x3d491a(0x77),_0x713dd1,_0x6401f9),_0x3d5587()):genTiny(_0x3d5587,dbFileIndex,_0x5db4cd,_0x4a420b,_0x713dd1,_0x6401f9);});}else _0x3d5587(_0x319660(0x71));});}let bgTaskId;try{let info=dbOther['prepare'](_0x3fd531(0x7c))['run'](_0x3fd531(0x83));bgTaskId=info[_0x3fd531(0x82)];}catch(_0x2b9e8b){}let genCount=0x0;function _0x31fe(_0x5e8381,_0x212b54){const _0x5cdda1=_0x5cdd();return _0x31fe=function(_0x31fe04,_0x41a3d9){_0x31fe04=_0x31fe04-0x6d;let _0x1cd94f=_0x5cdda1[_0x31fe04];return _0x1cd94f;},_0x31fe(_0x5e8381,_0x212b54);}async function runGen(){const _0xb220d6=_0x3fd531;try{let _0x13dd60=await genStart(dbFileIndexTable[_0xb220d6(0x74)]);_0x13dd60!=_0xb220d6(0x71)&&(genCount+=0x1);let _0x53f265=await genStart(dbFileIndexTable[_0xb220d6(0x81)]);if(_0x13dd60==_0xb220d6(0x71)&&_0x53f265==_0xb220d6(0x71)){try{bgTaskId&&dbOther[_0xb220d6(0x91)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20task_type=\x27GEN_TINY_IMAGE\x27')['run']();}catch(_0x1f003e){}genCount>0x0&&process['send']({'type':'NEW_TINY_IMAGE'}),process[_0xb220d6(0x93)]({'type':_0xb220d6(0x90)}),process['exit']();}else return runGen();}catch(_0x35a240){return console['log'](_0x35a240),runGen();}}function _0x5cdd(){const _0x346913=['dirname','8sBKQiL','getFileHashName','2981421JVYmbw','genTinyFile','noData','171628GkYteu','Error\x20occurred\x20in\x20thumbnail\x20process\x20','INDEX_TABLE_NAME_PHOTO','updateById','image','tiny_path','join','27TnIANU','pragma','path','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','\x20tiny_path\x20is\x20null\x20and\x20type=1\x20LIMIT\x201','\x20tiny_path\x20is\x20null\x20and\x20type=2\x20LIMIT\x201','817093xykuFt','journal_mode\x20=\x20WAL','INDEX_TABLE_NAME_MOVIE','lastInsertRowid','GEN_TINY_IMAGE','getByWhere','uncaughtException','NasCabThumbnailWorker','run','exit','filename','dbFileIndex','890NqAKWE','../db/dbFileIndexTable','../utils/messageUtil','../express-server/utils/sharpUtils','9804EdsZGQ','close','prepare','14337690ZxXkrv','send','2397724VvUwKy','2703750vPLrKb'];_0x5cdd=function(){return _0x346913;};return _0x5cdd();}runGen();function exitProcess(){const _0x3c82a1=_0x3fd531;process[_0x3c82a1(0x93)]({'type':_0x3c82a1(0x90)}),process[_0x3c82a1(0x88)]();}process['on'](_0x3fd531(0x85),(_0x3fa450,_0x555574)=>{const _0x55fad1=_0x3fd531;console['log'](_0x55fad1(0x73),_0x3fa450),exitProcess();});