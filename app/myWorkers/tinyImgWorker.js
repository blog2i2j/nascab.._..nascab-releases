const _0x4c212e=_0x33e0;(function(_0x74939c,_0x356c6a){const _0x39aa5f=_0x33e0,_0x5b89f4=_0x74939c();while(!![]){try{const _0x4c728c=parseInt(_0x39aa5f(0x176))/0x1*(parseInt(_0x39aa5f(0x17e))/0x2)+-parseInt(_0x39aa5f(0x17d))/0x3+parseInt(_0x39aa5f(0x189))/0x4*(-parseInt(_0x39aa5f(0x16e))/0x5)+-parseInt(_0x39aa5f(0x18e))/0x6+-parseInt(_0x39aa5f(0x18f))/0x7*(-parseInt(_0x39aa5f(0x16b))/0x8)+parseInt(_0x39aa5f(0x16f))/0x9+parseInt(_0x39aa5f(0x170))/0xa;if(_0x4c728c===_0x356c6a)break;else _0x5b89f4['push'](_0x5b89f4['shift']());}catch(_0x54954e){_0x5b89f4['push'](_0x5b89f4['shift']());}}}(_0x4de9,0xa1512));const config=require(_0x4c212e(0x16d));let fs=require('fs'),path=require(_0x4c212e(0x17c)),sharpUtil=require(_0x4c212e(0x163));const dbFileIndexTable=require(_0x4c212e(0x169)),Database=require(_0x4c212e(0x17b));let dbOther=new Database(config[_0x4c212e(0x187)],{'timeout':0xea60});dbOther['pragma'](_0x4c212e(0x177));function _0x33e0(_0x4e49c9,_0x12710a){const _0x4de9b2=_0x4de9();return _0x33e0=function(_0x33e08f,_0x5e8a57){_0x33e08f=_0x33e08f-0x163;let _0x416913=_0x4de9b2[_0x33e08f];return _0x416913;},_0x33e0(_0x4e49c9,_0x12710a);}let dbFileIndex=new Database(config[_0x4c212e(0x191)],{'timeout':0xea60});dbFileIndex['pragma'](_0x4c212e(0x177));const messageUtil=require('../utils/messageUtil');process[_0x4c212e(0x184)]=_0x4c212e(0x188);function dealFail(_0x2d838d,_0x493108,_0x1dcf39,_0x45842e,_0x1c0897){const _0x4d9309=_0x4c212e;dbFileIndexTable[_0x4d9309(0x16a)](_0x493108,_0x45842e['id'],_0x4d9309(0x166),'0',_0x1c0897),_0x2d838d();}function genTiny(_0x2a023c,_0x11cb1d,_0x4539e5,_0x3d037e,_0x2da6e3,_0x259796){const _0x52c453=_0x4c212e;let _0x58a700='image';_0x3d037e[_0x52c453(0x18c)]==0x2&&(_0x58a700=_0x52c453(0x185)),sharpUtil[_0x52c453(0x17f)](_0x4539e5,path[_0x52c453(0x18b)](_0x2da6e3),path[_0x52c453(0x182)](_0x2da6e3),_0x58a700,_0x3d037e,_0x528333=>{const _0x1780bc=_0x52c453;dbFileIndexTable['updateById'](_0x11cb1d,_0x3d037e['id'],_0x1780bc(0x166),_0x528333,_0x259796),_0x2a023c();},_0x3c4030=>{dealFail(_0x2a023c,_0x11cb1d,_0x4539e5,_0x3d037e,_0x259796);});}function genStart(_0x11e0a5){return new Promise((_0x74cef4,_0x1d13a8)=>{const _0x3029d2=_0x33e0;let _0x4f9a42=dbFileIndexTable[_0x3029d2(0x18a)](dbFileIndex,_0x3029d2(0x164),'*',_0x11e0a5);!_0x4f9a42&&(_0x4f9a42=dbFileIndexTable[_0x3029d2(0x18a)](dbFileIndex,'\x20tiny_path\x20is\x20null\x20and\x20type=2\x20LIMIT\x201','*',_0x11e0a5));if(_0x4f9a42){try{bgTaskId&&dbOther['prepare'](_0x3029d2(0x173)+bgTaskId)[_0x3029d2(0x167)]();}catch(_0x24c9d6){}let _0x2d7365=path[_0x3029d2(0x190)](_0x4f9a42[_0x3029d2(0x17c)],_0x4f9a42[_0x3029d2(0x171)]),_0x480ce0=config['getFileHashName'](_0x4f9a42),_0x20a4eb=path[_0x3029d2(0x190)](config['cachePath'],_0x480ce0);fs[_0x3029d2(0x165)](_0x20a4eb,(_0x2fe1ea,_0x11ef44)=>{const _0x403409=_0x3029d2;if(_0x2fe1ea)return genTiny(_0x74cef4,dbFileIndex,_0x2d7365,_0x4f9a42,_0x20a4eb,_0x11e0a5);_0x11ef44[_0x403409(0x174)]()&&_0x11ef44['size']>0x7d0?(dbFileIndexTable[_0x403409(0x16a)](dbFileIndex,_0x4f9a42['id'],'tiny_path',_0x20a4eb,_0x11e0a5),_0x74cef4()):genTiny(_0x74cef4,dbFileIndex,_0x2d7365,_0x4f9a42,_0x20a4eb,_0x11e0a5);});}else _0x74cef4('noData');});}let bgTaskId;try{let info=dbOther['prepare'](_0x4c212e(0x168))[_0x4c212e(0x167)]('GEN_TINY_IMAGE');bgTaskId=info[_0x4c212e(0x175)];}catch(_0x4fcfe8){}let genCount=0x0;async function runGen(){const _0x328be4=_0x4c212e;try{let _0x46ff61=await genStart(dbFileIndexTable[_0x328be4(0x183)]);_0x46ff61!=_0x328be4(0x180)&&(genCount+=0x1);let _0xce9646=await genStart(dbFileIndexTable['INDEX_TABLE_NAME_MOVIE']);if(_0x46ff61==_0x328be4(0x180)&&_0xce9646==_0x328be4(0x180)){try{bgTaskId&&dbOther[_0x328be4(0x172)](_0x328be4(0x186))[_0x328be4(0x167)]();}catch(_0x3f327a){}genCount>0x0&&process[_0x328be4(0x181)]({'type':'NEW_TINY_IMAGE'}),process['send']({'type':_0x328be4(0x18d)}),process[_0x328be4(0x17a)]();}else return runGen();}catch(_0x3d31b3){return console[_0x328be4(0x179)](_0x3d31b3),runGen();}}runGen();function exitProcess(){const _0x256778=_0x4c212e;process['send']({'type':'close'}),process[_0x256778(0x17a)]();}function _0x4de9(){const _0x57e680=['dbFileIndex','../express-server/utils/sharpUtils','\x20tiny_path\x20is\x20null\x20and\x20type=1\x20LIMIT\x201','stat','tiny_path','run','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','../db/dbFileIndexTable','updateById','118848CTptTy','uncaughtException','../myConfig/config','25kOlSDD','5560956kQLCgW','14643380NAOChO','filename','prepare','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','isFile','lastInsertRowid','344327dsNIFi','journal_mode\x20=\x20WAL','Error\x20occurred\x20in\x20thumbnail\x20process\x20','log','exit','better-sqlite3','path','1283250TwUCWr','4qZqupx','genTinyFile','noData','send','basename','INDEX_TABLE_NAME_PHOTO','title','video','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20task_type=\x27GEN_TINY_IMAGE\x27','dbOther','NasCabThumbnailWorker','961372IZXFKg','getByWhere','dirname','type','close','3686166NpfJso','63TotKIs','join'];_0x4de9=function(){return _0x57e680;};return _0x4de9();}process['on'](_0x4c212e(0x16c),(_0x333322,_0x2f4b52)=>{const _0x3223bf=_0x4c212e;console[_0x3223bf(0x179)](_0x3223bf(0x178),_0x333322),exitProcess();});