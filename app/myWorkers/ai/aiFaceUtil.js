const _0xdb3204=_0xe916;(function(_0x163842,_0xad4511){const _0x54b531=_0xe916,_0x456c85=_0x163842();while(!![]){try{const _0x515efc=-parseInt(_0x54b531(0x1c1))/0x1+-parseInt(_0x54b531(0x15d))/0x2*(-parseInt(_0x54b531(0x155))/0x3)+-parseInt(_0x54b531(0x174))/0x4+parseInt(_0x54b531(0x198))/0x5+-parseInt(_0x54b531(0x185))/0x6*(-parseInt(_0x54b531(0x165))/0x7)+parseInt(_0x54b531(0x180))/0x8+-parseInt(_0x54b531(0x177))/0x9;if(_0x515efc===_0xad4511)break;else _0x456c85['push'](_0x456c85['shift']());}catch(_0x4be9da){_0x456c85['push'](_0x456c85['shift']());}}}(_0x4bcc,0x56860));const fs=require('fs'),path=require(_0xdb3204(0x153)),tfjs=require('@tensorflow/tfjs'),wasm=require(_0xdb3204(0x1bd)),sharpUtil=require(_0xdb3204(0x1cd)),exifUtils=require('../../utils/exifUtils'),faceapi=require('../../libs/faceapi/face-api.node-wasm'),config=require(_0xdb3204(0x161)),Database=require('better-sqlite3'),https=require(_0xdb3204(0x189)),dbConfigTable=require('../../db/dbConfigTable');process[_0xdb3204(0x187)]=_0xdb3204(0x157);let dbFileIndex=new Database(config[_0xdb3204(0x1ba)],{}),dbOther=new Database(config[_0xdb3204(0x178)],{});dbOther['pragma'](_0xdb3204(0x16a)),dbFileIndex[_0xdb3204(0x15f)](_0xdb3204(0x16a)),process['on'](_0xdb3204(0x163),()=>{const _0x38d911=_0xdb3204;dbOther['close'](),dbFileIndex[_0x38d911(0x1b2)]();});const sharp=require(_0xdb3204(0x193)),DEAL_GAP=0x7530;let TABLE_NAME_FACE2INDEX='photo_faces2index',TABLE_NAME_PHOTO_FACES=_0xdb3204(0x1b1),modelInit=![],modelSavePath=path[_0xdb3204(0x18a)](config[_0xdb3204(0x1c3)],'tfModel','faceapi_models');!fs['existsSync'](modelSavePath)&&fs[_0xdb3204(0x173)](modelSavePath,{'recursive':!![]});function _0xe916(_0x471002,_0xc034f2){const _0x4bcc08=_0x4bcc();return _0xe916=function(_0xe91647,_0x2633f1){_0xe91647=_0xe91647-0x152;let _0x338c95=_0x4bcc08[_0xe91647];return _0x338c95;},_0xe916(_0x471002,_0xc034f2);}let modelBaseUrl=_0xdb3204(0x152),modelFileUrlList=[],modelFileList=[_0xdb3204(0x168),_0xdb3204(0x171),_0xdb3204(0x1be),_0xdb3204(0x19a),_0xdb3204(0x1a8),'ssd_mobilenetv1_model-weights_manifest.json',_0xdb3204(0x19f),_0xdb3204(0x1c4)];for(let i=0x0;i<modelFileList[_0xdb3204(0x18b)];i++){modelFileUrlList[_0xdb3204(0x18f)](modelBaseUrl+modelFileList[i]);}function httpDownload(_0x193ab5,_0xa7a8d5,_0x211049){return new Promise((_0x557d4b,_0x53802a)=>{const _0x20926f=_0xe916;https['get'](_0x193ab5,_0x46e86a=>{const _0x164335=_0xe916,_0x587619=fs['createWriteStream'](_0xa7a8d5);_0x46e86a[_0x164335(0x1a9)](_0x587619),_0x587619['on'](_0x164335(0x1b3),()=>{const _0x162f03=_0x164335;_0x587619['close'](),fs[_0x162f03(0x179)](_0xa7a8d5,_0x211049),_0x557d4b();})['on']('error',_0x548e7c=>{});})['on'](_0x20926f(0x1b9),_0x391de5=>{_0x53802a(_0x391de5['message']);});});}function downloadModelFile(){return new Promise(async(_0x440064,_0x58b477)=>{const _0x1b3318=_0xe916;try{for(let _0x25b837=0x0;_0x25b837<modelFileList[_0x1b3318(0x18b)];_0x25b837++){let _0x3ad9c8=path[_0x1b3318(0x18a)](modelSavePath,modelFileList[_0x25b837]),_0xc29262=path['join'](modelSavePath,_0x1b3318(0x1c6)+modelFileList[_0x25b837]);if(!fs['existsSync'](_0x3ad9c8)){let _0xe856a6=modelFileUrlList[_0x25b837];await httpDownload(_0xe856a6,_0xc29262,_0x3ad9c8);}else{}}_0x440064();}catch(_0x3a9e7b){_0x58b477(_0x3a9e7b);}});}function _0x4bcc(){const _0x38a4ee=['log','ssdMobilenetv1','detection','withFaceDescriptors','face_landmark_68_tiny_model-weights_manifest.json','tiny_path','mkdirSync','648896pUARZs','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20(type=1\x20OR\x20type=2)\x20AND\x20ai_face_detect_state=0\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20is_raw!=1\x20\x20LIMIT\x201','loadFromDisk','7215003PeyAUj','dbOther','renameSync','send','ready','\x20WHERE\x20id=','\x20,min_similar_score=','filename','width','3810368RMHPRg',',\x20compare_state=1\x20where\x20id\x20=\x20','height','\x20AND\x20(type=1\x20OR\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20ai_face_detect_state=0\x20\x20AND\x20is_raw!=1\x20LIMIT\x201','DELETE\x20FROM\x20','1206060Pzosyv','\x20where\x20belong_face_id\x20is\x20null','title','value','https','join','length','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id=','engine','get','push','uncaughtException','run','aiFaceEnable','sharp','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20WHERE\x20ai_face_detect_state=0\x20and\x20size<=','_box','type','resize','2440305eHiLsd','nets','face_recognition_model-weights_manifest.json','SELECT\x20id\x20from\x20','face_id','dispose','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','face_landmark_68_model.bin','FaceMatcher','\x20where\x20id=','_distance','\x20SET\x20face_id=','stat','\x20and\x20disabled=0','lastInsertRowid','\x20WHERE\x20\x20compare_state=0\x20\x20and\x20face_id\x20is\x20null\x20LIMIT\x201','ssd_mobilenetv1_model.bin','pipe','SELECT\x20COUNT(photo_index_id)\x20as\x20count\x20FROM\x20','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','SELECT\x20*\x20from\x20','(face_descriptor)\x20VALUES(?)','faceRecognitionNet','AI_FACES','slice','photo_faces','close','finish','stringify','transSpcielFormat','REPLACE\x20INTO\x20\x20','deleteRawTempFile','values','error','dbFileIndex','tensor','then','@tensorflow/tfjs-backend-wasm','face_recognition_model.bin','wasm','face_descriptor','161147GjXTTj','_score','userDataFolder','face_landmark_68_model-weights_manifest.json','all','tmp_','endScope','getSharpInstanceFromInput','descriptor','count','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20size>','getRotateFromTags','../../express-server/utils/sharpUtils','https://down.nascab.cn/tfModel/face_api/','path','rotate','7419ljRMVM','\x20SET\x20compare_state=1\x20where\x20id=','NasCabAiFace','detectAllFaces','\x20where\x20face_id\x20in\x20','prepare','\x20where\x20face_photo_count<1\x20and\x20belong_face_id\x20is\x20null','min_similar_score','254WETwPP','_width','pragma','_height','../../myConfig/config','\x20where\x20belong_face_id=','exit','catch','7gFvRIT','\x20SET\x20face_photo_count=','parse','face_landmark_68_tiny_model.bin','findByTitle','journal_mode\x20=\x20WAL','channels','UPDATE\x20'];_0x4bcc=function(){return _0x38a4ee;};return _0x4bcc();}async function initFaceAPI(){return new Promise(async(_0x4167de,_0x352a55)=>{const _0x18c65c=_0xe916;try{!modelInit&&(await downloadModelFile(),await tfjs['setBackend'](_0x18c65c(0x1bf)),await tfjs[_0x18c65c(0x17b)](),await faceapi['nets'][_0x18c65c(0x16e)][_0x18c65c(0x176)](modelSavePath),await faceapi[_0x18c65c(0x199)]['faceLandmark68Net'][_0x18c65c(0x176)](modelSavePath),await faceapi['nets'][_0x18c65c(0x1ae)]['loadFromDisk'](modelSavePath),modelInit=!![]),_0x4167de();}catch(_0x249fb2){console[_0x18c65c(0x16d)](_0x249fb2),_0x352a55(_0x249fb2);}});}let currentDetectIndex=null;function runInfinitDetectFaces(){return new Promise(async _0xc45d1f=>{const _0x9b91c6=_0xe916;let _0x53c0db;try{let _0x2c758e=0x32*0x400;dbFileIndex[_0x9b91c6(0x15a)](_0x9b91c6(0x194)+_0x2c758e)[_0x9b91c6(0x191)](),_0x53c0db=dbFileIndex[_0x9b91c6(0x15a)](_0x9b91c6(0x1cb)+_0x2c758e+_0x9b91c6(0x183))[_0x9b91c6(0x18e)]();if(!_0x53c0db)return setTimeout(()=>{_0xc45d1f();},DEAL_GAP);currentDetectIndex=_0x53c0db,await initFaceAPI();try{bgTaskId&&dbOther[_0x9b91c6(0x15a)](_0x9b91c6(0x19e)+bgTaskId)[_0x9b91c6(0x191)]();}catch(_0x4d5a0f){}function _0x3d5af2(){const _0x5c167d=_0x9b91c6;dbFileIndex[_0x5c167d(0x15a)](_0x5c167d(0x18c)+_0x53c0db['id'])[_0x5c167d(0x191)](),currentDetectIndex=null,_0xc45d1f();}let _0x18889f=path[_0x9b91c6(0x18a)](_0x53c0db['path'],_0x53c0db[_0x9b91c6(0x17e)]);parseInt(_0x53c0db[_0x9b91c6(0x196)])==0x2&&(_0x18889f=path[_0x9b91c6(0x18a)](_0x53c0db[_0x9b91c6(0x172)]));let _0x2a3148=0x7d0;fs[_0x9b91c6(0x1a4)](_0x18889f,async(_0x48c773,_0x1cc330)=>{const _0x5db578=_0x9b91c6;if(_0x48c773)return _0x3d5af2();sharpUtil[_0x5db578(0x1b5)](_0x18889f,(_0x52265c,_0x688c77,_0x305067)=>{const _0x492fe2=_0x5db578;let _0x3256ce=sharpUtil[_0x492fe2(0x1c8)](_0x52265c),_0x2c7bc4=exifUtils[_0x492fe2(0x1cc)](_0x305067);_0x2c7bc4?_0x3256ce=_0x3256ce[_0x492fe2(0x154)](_0x2c7bc4):_0x3256ce=_0x3256ce[_0x492fe2(0x154)](),_0x3256ce[_0x492fe2(0x197)]({'width':_0x2a3148,'height':_0x2a3148,'withoutEnlargement':!![]})['jpeg']()['raw']()['toBuffer'](async(_0x309e69,_0x54b53b,_0x4c106c)=>{const _0x2fdab4=_0x492fe2;_0x688c77&&sharpUtil[_0x2fdab4(0x1b7)](_0x52265c);if(_0x309e69)return _0x54b53b=null,_0x3d5af2();let _0x15bae2;try{faceapi['tf'][_0x2fdab4(0x18d)]()['startScope'](),temp=tfjs[_0x2fdab4(0x1bb)](_0x54b53b,[_0x4c106c[_0x2fdab4(0x182)],_0x4c106c[_0x2fdab4(0x17f)],_0x4c106c[_0x2fdab4(0x16b)]]),_0x15bae2=tfjs[_0x2fdab4(0x1b0)](temp,[0x0,0x0,0x0],[-0x1,-0x1,0x3]),faceapi['tf']['dispose'](temp);}catch(_0x4c3370){if(_0x15bae2)faceapi['tf'][_0x2fdab4(0x19d)](_0x15bae2);if(temp)faceapi['tf']['dispose'](temp);return faceapi['tf'][_0x2fdab4(0x18d)]()['endScope'](),_0x3d5af2();}_0x54b53b=null,faceapi[_0x2fdab4(0x158)](_0x15bae2)['withFaceLandmarks']()[_0x2fdab4(0x170)]()[_0x2fdab4(0x1bc)](_0x4c8909=>{const _0x3ddd3d=_0x2fdab4;faceapi['tf'][_0x3ddd3d(0x19d)](_0x15bae2),faceapi['tf'][_0x3ddd3d(0x18d)]()[_0x3ddd3d(0x1c7)]();if(!_0x4c8909[_0x3ddd3d(0x18b)])return _0x3d5af2();let _0x286bde=[];for(let _0x59e974 of _0x4c8909){let _0x19b3d9=_0x59e974['detection'][_0x3ddd3d(0x195)][_0x3ddd3d(0x15e)],_0x1c5e02=_0x59e974['detection'][_0x3ddd3d(0x195)]['_height'];if(_0x19b3d9>_0x2a3148||_0x1c5e02>_0x2a3148)continue;let _0xcf9622=_0x59e974[_0x3ddd3d(0x16f)][_0x3ddd3d(0x1c2)];if(_0x19b3d9<0x50||_0x1c5e02<0x50||_0xcf9622<0.8)continue;_0x286bde[_0x3ddd3d(0x18f)](_0x59e974);}if(!_0x286bde[_0x3ddd3d(0x18b)])return _0x3d5af2();for(let _0x37b31a=0x0;_0x37b31a<_0x286bde[_0x3ddd3d(0x18b)];_0x37b31a++){let _0x503e44=_0x286bde[_0x37b31a],_0x421d37=_0x503e44[_0x3ddd3d(0x16f)][_0x3ddd3d(0x195)];dbFileIndex[_0x3ddd3d(0x15a)](_0x3ddd3d(0x1b6)+TABLE_NAME_FACE2INDEX+'(photo_index_id,score,x,y,width,height,face_descriptor)\x20\x20VALUES(?,?,?,?,?,?,?)')[_0x3ddd3d(0x191)](_0x53c0db['id'],_0x503e44['detection']['_score'],_0x421d37['_x'],_0x421d37['_y'],_0x421d37[_0x3ddd3d(0x15e)],_0x421d37[_0x3ddd3d(0x160)],JSON[_0x3ddd3d(0x1b4)](_0x503e44[_0x3ddd3d(0x1c9)]));}return _0x4c8909=null,_0x3d5af2();})[_0x2fdab4(0x164)](_0x19fdb4=>{const _0x5a8521=_0x2fdab4;return _0x688c77&&sharpUtil[_0x5a8521(0x1b7)](_0x52265c),faceapi['tf'][_0x5a8521(0x19d)](_0x15bae2),faceapi['tf'][_0x5a8521(0x18d)]()[_0x5a8521(0x1c7)](),_0x3d5af2();});});});});}catch(_0x3bb8e7){_0x53c0db&&dbFileIndex['prepare'](_0x9b91c6(0x18c)+_0x53c0db['id'])[_0x9b91c6(0x191)](),_0xc45d1f();}});}function exitProcess(){const _0xfa9a98=_0xdb3204;try{bgTaskId&&dbOther[_0xfa9a98(0x15a)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id='+bgTaskId)[_0xfa9a98(0x191)]();}catch(_0x4345e1){}return process[_0xfa9a98(0x17a)]({'type':_0xfa9a98(0x1b2)}),statisticFacePhotoCount(),process['exit']();}function runInfinitCompareFaces(){let _0x3015aa=0.35;return new Promise(async _0x3da1f2=>{const _0x3001b3=_0xe916;let _0x256894=dbFileIndex[_0x3001b3(0x15a)](_0x3001b3(0x175))['get']();if(_0x256894)return setTimeout(()=>{_0x3da1f2();},DEAL_GAP);let _0x5d6adb;try{try{bgTaskId&&dbOther['prepare'](_0x3001b3(0x19e)+bgTaskId)['run']();}catch(_0x47e115){}_0x5d6adb=dbFileIndex['prepare']('SELECT\x20*\x20from\x20'+TABLE_NAME_FACE2INDEX+_0x3001b3(0x1a7))[_0x3001b3(0x18e)]();if(!_0x5d6adb)return exitProcess();await initFaceAPI();function _0x19c4a1(){const _0x418b74=_0x3001b3;dbFileIndex['prepare']('UPDATE\x20'+TABLE_NAME_FACE2INDEX+_0x418b74(0x156)+_0x5d6adb['id'])[_0x418b74(0x191)](),_0x3da1f2();}let _0x43ba95=new Float32Array(Object[_0x3001b3(0x1b8)](JSON[_0x3001b3(0x167)](_0x5d6adb[_0x3001b3(0x1c0)])));const _0x2cd705=new faceapi[(_0x3001b3(0x1a0))]([_0x43ba95]);let _0x6a93af=[_0x5d6adb],_0x555c56=dbFileIndex[_0x3001b3(0x15a)](_0x3001b3(0x19b)+TABLE_NAME_FACE2INDEX+'\x20where\x20id!='+_0x5d6adb['id'])[_0x3001b3(0x1c5)](),_0x38eb88=0x1,_0x3a3c83=null;for(let _0x5a125e=0x0;_0x5a125e<_0x555c56['length'];_0x5a125e++){let _0xfa6666=dbFileIndex[_0x3001b3(0x15a)](_0x3001b3(0x1ac)+TABLE_NAME_FACE2INDEX+_0x3001b3(0x17c)+_0x555c56[_0x5a125e]['id'])[_0x3001b3(0x18e)]();if(!_0xfa6666)continue;const _0x430fa3=_0x2cd705['findBestMatch'](new Float32Array(Object[_0x3001b3(0x1b8)](JSON[_0x3001b3(0x167)](_0xfa6666[_0x3001b3(0x1c0)]))));_0x430fa3[_0x3001b3(0x1a2)]<_0x3015aa&&(_0x430fa3[_0x3001b3(0x1a2)]<_0x38eb88&&_0xfa6666[_0x3001b3(0x19c)]&&(_0x38eb88=_0x430fa3[_0x3001b3(0x1a2)],_0x3a3c83=_0xfa6666[_0x3001b3(0x19c)]),_0x430fa3[_0x3001b3(0x1a2)]<_0xfa6666[_0x3001b3(0x15c)]&&(_0xfa6666[_0x3001b3(0x15c)]=_0x430fa3['_distance'],_0x6a93af[_0x3001b3(0x18f)](_0xfa6666)));}if(_0x6a93af[_0x3001b3(0x18b)]<0x2){if(_0x3a3c83&&!_0x5d6adb[_0x3001b3(0x19c)]){let _0x459f69=_0x3001b3(0x16c)+TABLE_NAME_FACE2INDEX+_0x3001b3(0x1a3)+_0x3a3c83+'\x20,min_similar_score='+_0x38eb88+_0x3001b3(0x181)+_0x5d6adb['id'];dbFileIndex[_0x3001b3(0x15a)](_0x459f69)[_0x3001b3(0x191)]();}else{}return _0x19c4a1();}let _0x4d79df={};for(let _0x17842d=0x0;_0x17842d<_0x6a93af[_0x3001b3(0x18b)];_0x17842d++){let _0x148b2a=_0x6a93af[_0x17842d][_0x3001b3(0x19c)];_0x148b2a&&(_0x4d79df[_0x148b2a]?_0x4d79df[_0x148b2a]+=0x1:_0x4d79df[_0x148b2a]=0x1);}if(Object['keys'](_0x4d79df)[_0x3001b3(0x18b)]>0x0){let _0x1e0c7a=0x0,_0x4a5b2e=0x0;for(let _0x1bd2da in _0x4d79df){_0x4d79df[_0x1bd2da]>_0x4a5b2e&&(_0x4a5b2e=_0x4d79df[_0x1bd2da],_0x1e0c7a=_0x1bd2da);}if(_0x4a5b2e>0x0&&_0x4a5b2e>=(_0x6a93af[_0x3001b3(0x18b)]-0x1)/0x6){for(let _0x499428 in _0x6a93af){let _0x26e4e7=_0x3001b3(0x16c)+TABLE_NAME_FACE2INDEX+_0x3001b3(0x1a3)+_0x1e0c7a+_0x3001b3(0x17d)+_0x6a93af[_0x499428][_0x3001b3(0x15c)]+_0x3001b3(0x181)+_0x6a93af[_0x499428]['id'];dbFileIndex[_0x3001b3(0x15a)](_0x26e4e7)['run']();}return _0x19c4a1();}else{let _0x5e594c=dbFileIndex[_0x3001b3(0x15a)]('REPLACE\x20INTO\x20'+TABLE_NAME_PHOTO_FACES+'(face_descriptor)\x20VALUES(?)')[_0x3001b3(0x191)](JSON[_0x3001b3(0x1b4)](_0x43ba95));for(let _0x4c67b0 in _0x6a93af){let _0x2c1649=_0x3001b3(0x16c)+TABLE_NAME_FACE2INDEX+_0x3001b3(0x1a3)+_0x5e594c['lastInsertRowid']+'\x20,min_similar_score='+_0x6a93af[_0x4c67b0][_0x3001b3(0x15c)]+',\x20compare_state=1\x20where\x20id\x20=\x20'+_0x6a93af[_0x4c67b0]['id'];dbFileIndex[_0x3001b3(0x15a)](_0x2c1649)[_0x3001b3(0x191)]();}return _0x19c4a1();}}else{let _0x4340b6=dbFileIndex['prepare']('REPLACE\x20INTO\x20'+TABLE_NAME_PHOTO_FACES+_0x3001b3(0x1ad))['run'](JSON[_0x3001b3(0x1b4)](_0x43ba95));for(let _0x1084a7 in _0x6a93af){let _0x106025=_0x3001b3(0x16c)+TABLE_NAME_FACE2INDEX+_0x3001b3(0x1a3)+_0x4340b6[_0x3001b3(0x1a6)]+_0x3001b3(0x17d)+_0x6a93af[_0x1084a7][_0x3001b3(0x15c)]+_0x3001b3(0x181)+_0x6a93af[_0x1084a7]['id'];dbFileIndex[_0x3001b3(0x15a)](_0x106025)[_0x3001b3(0x191)]();}return _0x19c4a1();}}catch(_0x503f70){console[_0x3001b3(0x16d)](_0x503f70),_0x5d6adb&&dbFileIndex[_0x3001b3(0x15a)](_0x3001b3(0x16c)+TABLE_NAME_FACE2INDEX+_0x3001b3(0x156)+_0x5d6adb['id'])[_0x3001b3(0x191)](),_0x3da1f2();}});}async function runFaceDetect(){const _0x4e2e75=_0xdb3204;let _0x4bcd82=dbConfigTable[_0x4e2e75(0x169)](dbOther,_0x4e2e75(0x192));_0x4bcd82&&_0x4bcd82[_0x4e2e75(0x188)]=='1'?runInfinitDetectFaces()[_0x4e2e75(0x1bc)](()=>{runFaceDetect();}):exitProcess();}async function runFaceCompare(){runInfinitCompareFaces()['then'](()=>{runFaceCompare();});}function statisticFacePhotoCount(){const _0x2260b7=_0xdb3204;try{let _0x3e5c83=dbFileIndex[_0x2260b7(0x15a)](_0x2260b7(0x19b)+TABLE_NAME_PHOTO_FACES+_0x2260b7(0x186))[_0x2260b7(0x1c5)]();for(let _0x134a32 of _0x3e5c83){let _0x35b7fe=dbFileIndex[_0x2260b7(0x15a)](_0x2260b7(0x19b)+TABLE_NAME_PHOTO_FACES+_0x2260b7(0x162)+_0x134a32['id'])['all']();_0x35b7fe['push'](_0x134a32);let _0x56b910='(';for(let _0x49dd17 in _0x35b7fe){_0x56b910+=_0x35b7fe[_0x49dd17]['id'],_0x49dd17!=_0x35b7fe['length']-0x1&&(_0x56b910+=',');}_0x56b910+=')';let _0x32b091=dbFileIndex[_0x2260b7(0x15a)](_0x2260b7(0x1aa)+TABLE_NAME_FACE2INDEX+_0x2260b7(0x159)+_0x56b910+_0x2260b7(0x1a5))[_0x2260b7(0x18e)]();dbFileIndex[_0x2260b7(0x15a)]('UPDATE\x20'+TABLE_NAME_PHOTO_FACES+_0x2260b7(0x166)+_0x32b091[_0x2260b7(0x1ca)]+_0x2260b7(0x1a1)+_0x134a32['id'])[_0x2260b7(0x191)]();}dbFileIndex['prepare']('UPDATE\x20'+TABLE_NAME_PHOTO_FACES+'\x20SET\x20face_photo_count=0\x20where\x20belong_face_id\x20is\x20not\x20null')[_0x2260b7(0x191)](),dbFileIndex[_0x2260b7(0x15a)](_0x2260b7(0x184)+TABLE_NAME_PHOTO_FACES+_0x2260b7(0x15b))[_0x2260b7(0x191)]();}catch(_0x10f0a2){console[_0x2260b7(0x16d)](_0x10f0a2);}}let bgTaskId;try{let info=dbOther[_0xdb3204(0x15a)](_0xdb3204(0x1ab))['run'](_0xdb3204(0x1af));bgTaskId=info[_0xdb3204(0x1a6)];}catch(_0x1549d8){}async function main(){setTimeout(async()=>{runFaceDetect();},0x7d0),setTimeout(async()=>{runFaceCompare();},0x1388);}main(),process['on'](_0xdb3204(0x190),(_0x16a3e0,_0x50aeb6)=>{const _0x49fe51=_0xdb3204;currentDetectIndex&&dbFileIndex[_0x49fe51(0x15a)](_0x49fe51(0x18c)+currentDetectIndex['id'])[_0x49fe51(0x191)](),process[_0x49fe51(0x17a)]({'type':_0x49fe51(0x1b2)}),process[_0x49fe51(0x163)]();});