const _0x29db17=_0x1f55;(function(_0x36c132,_0x494719){const _0x2f68fb=_0x1f55,_0x3ec3d5=_0x36c132();while(!![]){try{const _0x5be577=parseInt(_0x2f68fb(0x1d1))/0x1*(parseInt(_0x2f68fb(0x168))/0x2)+parseInt(_0x2f68fb(0x165))/0x3+parseInt(_0x2f68fb(0x162))/0x4+parseInt(_0x2f68fb(0x1bb))/0x5*(-parseInt(_0x2f68fb(0x1a4))/0x6)+parseInt(_0x2f68fb(0x16a))/0x7*(parseInt(_0x2f68fb(0x194))/0x8)+-parseInt(_0x2f68fb(0x1c2))/0x9+parseInt(_0x2f68fb(0x1b1))/0xa*(-parseInt(_0x2f68fb(0x1a9))/0xb);if(_0x5be577===_0x494719)break;else _0x3ec3d5['push'](_0x3ec3d5['shift']());}catch(_0x30bc90){_0x3ec3d5['push'](_0x3ec3d5['shift']());}}}(_0x2e32,0xabcb8));const fs=require('fs'),path=require(_0x29db17(0x1d6)),tfjs=require(_0x29db17(0x17b)),wasm=require(_0x29db17(0x1a0)),sharpUtil=require(_0x29db17(0x1a5)),exifUtils=require(_0x29db17(0x1a6)),faceapi=require(_0x29db17(0x176)),config=require(_0x29db17(0x181)),Database=require(_0x29db17(0x177)),https=require(_0x29db17(0x1cf)),dbConfigTable=require(_0x29db17(0x1ad));process[_0x29db17(0x1d7)]='NasCabAiFace';let dbFileIndex=new Database(config['dbFileIndex'],{}),dbOther=new Database(config['dbOther'],{});function _0x1f55(_0x149f82,_0x264f09){const _0x2e32ef=_0x2e32();return _0x1f55=function(_0x1f551d,_0x4d19b6){_0x1f551d=_0x1f551d-0x161;let _0x467155=_0x2e32ef[_0x1f551d];return _0x467155;},_0x1f55(_0x149f82,_0x264f09);}dbOther[_0x29db17(0x1a7)]('journal_mode\x20=\x20WAL'),dbFileIndex[_0x29db17(0x1a7)](_0x29db17(0x1ac)),process['on'](_0x29db17(0x1ca),()=>{const _0x1b1bf7=_0x29db17;dbOther[_0x1b1bf7(0x167)](),dbFileIndex[_0x1b1bf7(0x167)]();});const sharp=require('sharp'),DEAL_GAP=0x7530;function _0x2e32(){const _0x31dc24=['detectAllFaces','3399fgMpCA','parse','join','journal_mode\x20=\x20WAL','../../db/dbConfigTable','userDataFolder','\x20SET\x20face_id=','startScope','33450bjsoKK','tiny_path','face_id','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20WHERE\x20ai_face_detect_state=0\x20and\x20size<=','detection','stat','pipe','aiFaceEnable','then','resize','20465cPnKif','UPDATE\x20','length','FaceMatcher','findBestMatch','channels','REPLACE\x20INTO\x20','8410059CGljxv','\x20where\x20belong_face_id=','filename','face_descriptor','getRotateFromTags','ready','width','\x20SET\x20face_photo_count=','exit','SELECT\x20id\x20from\x20','deleteRawTempFile','face_landmark_68_tiny_model.bin','jpeg','https','face_landmark_68_model.bin','804065XVRSKl','uncaughtException','\x20WHERE\x20id=','run','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id=','path','title','\x20WHERE\x20\x20compare_state=0\x20\x20and\x20face_id\x20is\x20null\x20LIMIT\x201','raw','REPLACE\x20INTO\x20\x20','\x20SET\x20face_photo_count=0\x20where\x20belong_face_id\x20is\x20not\x20null','3514192klkSNf','_width','\x20SET\x20compare_state=1\x20where\x20id=','417726VpHgRv','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','close','2zcOgcj','mkdirSync','9759694YHgKFN','photo_faces','AI_FACES','withFaceLandmarks','descriptor','min_similar_score','height','error','photo_faces2index','slice','(photo_index_id,score,x,y,width,height,face_descriptor)\x20\x20VALUES(?,?,?,?,?,?,?)','push','../../libs/faceapi/face-api.node-wasm','better-sqlite3','\x20AND\x20(type=1\x20OR\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20ai_face_detect_state=0\x20\x20AND\x20is_raw!=1\x20LIMIT\x201','endScope','SELECT\x20COUNT(photo_index_id)\x20as\x20count\x20FROM\x20','@tensorflow/tfjs','existsSync','values','_distance','ssdMobilenetv1','nets','../../myConfig/config','send','_height','_box','dispose','prepare','_score','type',',\x20compare_state=1\x20where\x20id\x20=\x20','stringify','\x20,min_similar_score=','renameSync','\x20where\x20face_id\x20in\x20','loadFromDisk','tfModel','\x20where\x20face_photo_count<1\x20and\x20belong_face_id\x20is\x20null','ssd_mobilenetv1_model.bin','rotate','get','8SQHgsu','findByTitle','catch','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20size>','all','tmp_','https://down.nascab.cn/tfModel/face_api/','(face_descriptor)\x20VALUES(?)','toBuffer','transSpcielFormat','tensor','log','@tensorflow/tfjs-backend-wasm','engine','SELECT\x20*\x20from\x20','faceLandmark68Net','798gqPFgS','../../express-server/utils/sharpUtils','../../utils/exifUtils','pragma'];_0x2e32=function(){return _0x31dc24;};return _0x2e32();}let TABLE_NAME_FACE2INDEX=_0x29db17(0x172),TABLE_NAME_PHOTO_FACES=_0x29db17(0x16b),modelInit=![],modelSavePath=path['join'](config[_0x29db17(0x1ae)],_0x29db17(0x18f),'faceapi_models');!fs[_0x29db17(0x17c)](modelSavePath)&&fs[_0x29db17(0x169)](modelSavePath,{'recursive':!![]});let modelBaseUrl=_0x29db17(0x19a),modelFileUrlList=[],modelFileList=[_0x29db17(0x1cd),'face_landmark_68_tiny_model-weights_manifest.json','face_recognition_model.bin','face_recognition_model-weights_manifest.json',_0x29db17(0x191),'ssd_mobilenetv1_model-weights_manifest.json',_0x29db17(0x1d0),'face_landmark_68_model-weights_manifest.json'];for(let i=0x0;i<modelFileList[_0x29db17(0x1bd)];i++){modelFileUrlList['push'](modelBaseUrl+modelFileList[i]);}function httpDownload(_0x5ece92,_0x8aa4a1,_0x1deb5e){return new Promise((_0x519c68,_0x514517)=>{const _0x105dc0=_0x1f55;https['get'](_0x5ece92,_0x480b7e=>{const _0x248a3d=_0x1f55,_0x175f2e=fs['createWriteStream'](_0x8aa4a1);_0x480b7e[_0x248a3d(0x1b7)](_0x175f2e),_0x175f2e['on']('finish',()=>{const _0x215b7d=_0x248a3d;_0x175f2e['close'](),fs[_0x215b7d(0x18c)](_0x8aa4a1,_0x1deb5e),_0x519c68();})['on'](_0x248a3d(0x171),_0xcf8e6b=>{});})['on'](_0x105dc0(0x171),_0xe89a5c=>{_0x514517(_0xe89a5c['message']);});});}function downloadModelFile(){return new Promise(async(_0x282158,_0x1e0a9e)=>{const _0x4b5179=_0x1f55;try{for(let _0x39b87d=0x0;_0x39b87d<modelFileList[_0x4b5179(0x1bd)];_0x39b87d++){let _0x4e58bf=path['join'](modelSavePath,modelFileList[_0x39b87d]),_0x52a6a1=path['join'](modelSavePath,_0x4b5179(0x199)+modelFileList[_0x39b87d]);if(!fs[_0x4b5179(0x17c)](_0x4e58bf)){let _0x22561e=modelFileUrlList[_0x39b87d];await httpDownload(_0x22561e,_0x52a6a1,_0x4e58bf);}else{}}_0x282158();}catch(_0x531a8e){_0x1e0a9e(_0x531a8e);}});}async function initFaceAPI(){return new Promise(async(_0x1d8c35,_0x576c4c)=>{const _0x4148ad=_0x1f55;try{!modelInit&&(await downloadModelFile(),await tfjs['setBackend']('wasm'),await tfjs[_0x4148ad(0x1c7)](),await faceapi[_0x4148ad(0x180)][_0x4148ad(0x17f)][_0x4148ad(0x18e)](modelSavePath),await faceapi[_0x4148ad(0x180)][_0x4148ad(0x1a3)][_0x4148ad(0x18e)](modelSavePath),await faceapi['nets']['faceRecognitionNet']['loadFromDisk'](modelSavePath),modelInit=!![]),_0x1d8c35();}catch(_0x35cb27){console[_0x4148ad(0x19f)](_0x35cb27),_0x576c4c(_0x35cb27);}});}let currentDetectIndex=null;function runInfinitDetectFaces(){return new Promise(async _0xb0f5c4=>{const _0x17447c=_0x1f55;let _0x823ae8;try{let _0x2a021f=0x32*0x400;dbFileIndex[_0x17447c(0x186)](_0x17447c(0x1b4)+_0x2a021f)[_0x17447c(0x1d4)](),_0x823ae8=dbFileIndex[_0x17447c(0x186)](_0x17447c(0x197)+_0x2a021f+_0x17447c(0x178))[_0x17447c(0x193)]();if(!_0x823ae8)return setTimeout(()=>{_0xb0f5c4();},DEAL_GAP);currentDetectIndex=_0x823ae8,await initFaceAPI();try{bgTaskId&&dbOther[_0x17447c(0x186)](_0x17447c(0x166)+bgTaskId)[_0x17447c(0x1d4)]();}catch(_0x149b7b){}function _0x124df2(){const _0x2d979e=_0x17447c;dbFileIndex['prepare']('UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id='+_0x823ae8['id'])[_0x2d979e(0x1d4)](),currentDetectIndex=null,_0xb0f5c4();}let _0x25727e=path['join'](_0x823ae8[_0x17447c(0x1d6)],_0x823ae8[_0x17447c(0x1c4)]);parseInt(_0x823ae8[_0x17447c(0x188)])==0x2&&(_0x25727e=path[_0x17447c(0x1ab)](_0x823ae8[_0x17447c(0x1b2)]));let _0x113b14=0x7d0;fs[_0x17447c(0x1b6)](_0x25727e,async(_0x11d688,_0x5665e1)=>{const _0x342d81=_0x17447c;if(_0x11d688)return _0x124df2();sharpUtil[_0x342d81(0x19d)](_0x25727e,(_0x130f10,_0x1e1c91,_0x30df66)=>{const _0x3adf49=_0x342d81;let _0x1f7171=sharpUtil['getSharpInstanceFromInput'](_0x130f10),_0x4a4b0f=exifUtils[_0x3adf49(0x1c6)](_0x30df66);_0x4a4b0f?_0x1f7171=_0x1f7171[_0x3adf49(0x192)](_0x4a4b0f):_0x1f7171=_0x1f7171[_0x3adf49(0x192)](),_0x1f7171[_0x3adf49(0x1ba)]({'width':_0x113b14,'height':_0x113b14,'withoutEnlargement':!![]})[_0x3adf49(0x1ce)]()[_0x3adf49(0x1d9)]()[_0x3adf49(0x19c)](async(_0x35733d,_0x4b0aae,_0x390b6a)=>{const _0x1def63=_0x3adf49;_0x1e1c91&&sharpUtil['deleteRawTempFile'](_0x130f10);if(_0x35733d)return _0x4b0aae=null,_0x124df2();let _0xe1c3eb;try{faceapi['tf'][_0x1def63(0x1a1)]()[_0x1def63(0x1b0)](),temp=tfjs[_0x1def63(0x19e)](_0x4b0aae,[_0x390b6a[_0x1def63(0x170)],_0x390b6a[_0x1def63(0x1c8)],_0x390b6a[_0x1def63(0x1c0)]]),_0xe1c3eb=tfjs[_0x1def63(0x173)](temp,[0x0,0x0,0x0],[-0x1,-0x1,0x3]),faceapi['tf'][_0x1def63(0x185)](temp);}catch(_0x58f08c){if(_0xe1c3eb)faceapi['tf'][_0x1def63(0x185)](_0xe1c3eb);if(temp)faceapi['tf'][_0x1def63(0x185)](temp);return faceapi['tf'][_0x1def63(0x1a1)]()['endScope'](),_0x124df2();}_0x4b0aae=null,faceapi[_0x1def63(0x1a8)](_0xe1c3eb)[_0x1def63(0x16d)]()['withFaceDescriptors']()[_0x1def63(0x1b9)](_0x2bd80a=>{const _0x1d1ed6=_0x1def63;faceapi['tf'][_0x1d1ed6(0x185)](_0xe1c3eb),faceapi['tf']['engine']()['endScope']();if(!_0x2bd80a['length'])return _0x124df2();let _0x5cbfb6=[];for(let _0x5b079d of _0x2bd80a){let _0xdf314f=_0x5b079d[_0x1d1ed6(0x1b5)]['_box'][_0x1d1ed6(0x163)],_0x390ae8=_0x5b079d[_0x1d1ed6(0x1b5)]['_box']['_height'];if(_0xdf314f>_0x113b14||_0x390ae8>_0x113b14)continue;let _0x4395d7=_0x5b079d[_0x1d1ed6(0x1b5)][_0x1d1ed6(0x187)];if(_0xdf314f<0x50||_0x390ae8<0x50||_0x4395d7<0.8)continue;_0x5cbfb6[_0x1d1ed6(0x175)](_0x5b079d);}if(!_0x5cbfb6[_0x1d1ed6(0x1bd)])return _0x124df2();for(let _0x41f65b=0x0;_0x41f65b<_0x5cbfb6['length'];_0x41f65b++){let _0x34dd62=_0x5cbfb6[_0x41f65b],_0x509639=_0x34dd62[_0x1d1ed6(0x1b5)][_0x1d1ed6(0x184)];dbFileIndex['prepare'](_0x1d1ed6(0x1da)+TABLE_NAME_FACE2INDEX+_0x1d1ed6(0x174))[_0x1d1ed6(0x1d4)](_0x823ae8['id'],_0x34dd62[_0x1d1ed6(0x1b5)][_0x1d1ed6(0x187)],_0x509639['_x'],_0x509639['_y'],_0x509639[_0x1d1ed6(0x163)],_0x509639[_0x1d1ed6(0x183)],JSON['stringify'](_0x34dd62[_0x1d1ed6(0x16e)]));}return _0x2bd80a=null,_0x124df2();})[_0x1def63(0x196)](_0x3c725b=>{const _0x5e8271=_0x1def63;return _0x1e1c91&&sharpUtil[_0x5e8271(0x1cc)](_0x130f10),faceapi['tf']['dispose'](_0xe1c3eb),faceapi['tf'][_0x5e8271(0x1a1)]()[_0x5e8271(0x179)](),_0x124df2();});});});});}catch(_0x50b1bf){_0x823ae8&&dbFileIndex['prepare'](_0x17447c(0x1d5)+_0x823ae8['id'])[_0x17447c(0x1d4)](),_0xb0f5c4();}});}function exitProcess(){const _0x352023=_0x29db17;try{bgTaskId&&dbOther[_0x352023(0x186)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id='+bgTaskId)[_0x352023(0x1d4)]();}catch(_0x4e9aa9){}return process[_0x352023(0x182)]({'type':_0x352023(0x167)}),statisticFacePhotoCount(),process['exit']();}function runInfinitCompareFaces(){let _0x28155f=0.35;return new Promise(async _0x405855=>{const _0x2107d9=_0x1f55;let _0x2f9ba8=dbFileIndex[_0x2107d9(0x186)]('SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20(type=1\x20OR\x20type=2)\x20AND\x20ai_face_detect_state=0\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20is_raw!=1\x20\x20LIMIT\x201')[_0x2107d9(0x193)]();if(_0x2f9ba8)return setTimeout(()=>{_0x405855();},DEAL_GAP);let _0x24eb7c;try{try{bgTaskId&&dbOther[_0x2107d9(0x186)](_0x2107d9(0x166)+bgTaskId)[_0x2107d9(0x1d4)]();}catch(_0x43450c){}_0x24eb7c=dbFileIndex[_0x2107d9(0x186)]('SELECT\x20*\x20from\x20'+TABLE_NAME_FACE2INDEX+_0x2107d9(0x1d8))['get']();if(!_0x24eb7c)return exitProcess();await initFaceAPI();function _0x73c46e(){const _0x25d049=_0x2107d9;dbFileIndex[_0x25d049(0x186)](_0x25d049(0x1bc)+TABLE_NAME_FACE2INDEX+_0x25d049(0x164)+_0x24eb7c['id'])[_0x25d049(0x1d4)](),_0x405855();}let _0x46d782=new Float32Array(Object[_0x2107d9(0x17d)](JSON['parse'](_0x24eb7c[_0x2107d9(0x1c5)])));const _0x4309cc=new faceapi[(_0x2107d9(0x1be))]([_0x46d782]);let _0x102aa4=[_0x24eb7c],_0x5dd5c4=dbFileIndex['prepare']('SELECT\x20id\x20from\x20'+TABLE_NAME_FACE2INDEX+'\x20where\x20id!='+_0x24eb7c['id'])[_0x2107d9(0x198)](),_0x26a502=0x1,_0x24ee06=null;for(let _0x2b8af1=0x0;_0x2b8af1<_0x5dd5c4[_0x2107d9(0x1bd)];_0x2b8af1++){let _0x5effa7=dbFileIndex[_0x2107d9(0x186)](_0x2107d9(0x1a2)+TABLE_NAME_FACE2INDEX+_0x2107d9(0x1d3)+_0x5dd5c4[_0x2b8af1]['id'])[_0x2107d9(0x193)]();if(!_0x5effa7)continue;const _0x545c3e=_0x4309cc[_0x2107d9(0x1bf)](new Float32Array(Object[_0x2107d9(0x17d)](JSON[_0x2107d9(0x1aa)](_0x5effa7['face_descriptor']))));_0x545c3e[_0x2107d9(0x17e)]<_0x28155f&&(_0x545c3e[_0x2107d9(0x17e)]<_0x26a502&&_0x5effa7[_0x2107d9(0x1b3)]&&(_0x26a502=_0x545c3e[_0x2107d9(0x17e)],_0x24ee06=_0x5effa7['face_id']),_0x545c3e[_0x2107d9(0x17e)]<_0x5effa7[_0x2107d9(0x16f)]&&(_0x5effa7[_0x2107d9(0x16f)]=_0x545c3e[_0x2107d9(0x17e)],_0x102aa4['push'](_0x5effa7)));}if(_0x102aa4['length']<0x2){if(_0x24ee06&&!_0x24eb7c[_0x2107d9(0x1b3)]){let _0x40e6ff='UPDATE\x20'+TABLE_NAME_FACE2INDEX+_0x2107d9(0x1af)+_0x24ee06+_0x2107d9(0x18b)+_0x26a502+_0x2107d9(0x189)+_0x24eb7c['id'];dbFileIndex[_0x2107d9(0x186)](_0x40e6ff)[_0x2107d9(0x1d4)]();}else{}return _0x73c46e();}let _0x4b3a62={};for(let _0x37d6bd=0x0;_0x37d6bd<_0x102aa4[_0x2107d9(0x1bd)];_0x37d6bd++){let _0x3b1aae=_0x102aa4[_0x37d6bd][_0x2107d9(0x1b3)];_0x3b1aae&&(_0x4b3a62[_0x3b1aae]?_0x4b3a62[_0x3b1aae]+=0x1:_0x4b3a62[_0x3b1aae]=0x1);}if(Object['keys'](_0x4b3a62)[_0x2107d9(0x1bd)]>0x0){let _0x3824ac=0x0,_0x1debc2=0x0;for(let _0xa0c5d2 in _0x4b3a62){_0x4b3a62[_0xa0c5d2]>_0x1debc2&&(_0x1debc2=_0x4b3a62[_0xa0c5d2],_0x3824ac=_0xa0c5d2);}if(_0x1debc2>0x0&&_0x1debc2>=(_0x102aa4[_0x2107d9(0x1bd)]-0x1)/0x6){for(let _0x3f764a in _0x102aa4){let _0x4e6343=_0x2107d9(0x1bc)+TABLE_NAME_FACE2INDEX+_0x2107d9(0x1af)+_0x3824ac+'\x20,min_similar_score='+_0x102aa4[_0x3f764a][_0x2107d9(0x16f)]+_0x2107d9(0x189)+_0x102aa4[_0x3f764a]['id'];dbFileIndex['prepare'](_0x4e6343)['run']();}return _0x73c46e();}else{let _0xc17e21=dbFileIndex[_0x2107d9(0x186)](_0x2107d9(0x1c1)+TABLE_NAME_PHOTO_FACES+_0x2107d9(0x19b))[_0x2107d9(0x1d4)](JSON[_0x2107d9(0x18a)](_0x46d782));for(let _0x28a621 in _0x102aa4){let _0xd5e6e='UPDATE\x20'+TABLE_NAME_FACE2INDEX+_0x2107d9(0x1af)+_0xc17e21['lastInsertRowid']+_0x2107d9(0x18b)+_0x102aa4[_0x28a621][_0x2107d9(0x16f)]+_0x2107d9(0x189)+_0x102aa4[_0x28a621]['id'];dbFileIndex[_0x2107d9(0x186)](_0xd5e6e)[_0x2107d9(0x1d4)]();}return _0x73c46e();}}else{let _0x2f6517=dbFileIndex['prepare']('REPLACE\x20INTO\x20'+TABLE_NAME_PHOTO_FACES+_0x2107d9(0x19b))[_0x2107d9(0x1d4)](JSON[_0x2107d9(0x18a)](_0x46d782));for(let _0x56ee6e in _0x102aa4){let _0x83dd7c=_0x2107d9(0x1bc)+TABLE_NAME_FACE2INDEX+_0x2107d9(0x1af)+_0x2f6517['lastInsertRowid']+_0x2107d9(0x18b)+_0x102aa4[_0x56ee6e][_0x2107d9(0x16f)]+_0x2107d9(0x189)+_0x102aa4[_0x56ee6e]['id'];dbFileIndex['prepare'](_0x83dd7c)['run']();}return _0x73c46e();}}catch(_0x53dddb){console['log'](_0x53dddb),_0x24eb7c&&dbFileIndex[_0x2107d9(0x186)](_0x2107d9(0x1bc)+TABLE_NAME_FACE2INDEX+_0x2107d9(0x164)+_0x24eb7c['id'])[_0x2107d9(0x1d4)](),_0x405855();}});}async function runFaceDetect(){const _0x341ff5=_0x29db17;let _0x417437=dbConfigTable[_0x341ff5(0x195)](dbOther,_0x341ff5(0x1b8));_0x417437&&_0x417437['value']=='1'?runInfinitDetectFaces()[_0x341ff5(0x1b9)](()=>{runFaceDetect();}):exitProcess();}async function runFaceCompare(){const _0x6beee=_0x29db17;runInfinitCompareFaces()[_0x6beee(0x1b9)](()=>{runFaceCompare();});}function statisticFacePhotoCount(){const _0x2fc0b1=_0x29db17;try{let _0x5d6da6=dbFileIndex[_0x2fc0b1(0x186)](_0x2fc0b1(0x1cb)+TABLE_NAME_PHOTO_FACES+'\x20where\x20belong_face_id\x20is\x20null')[_0x2fc0b1(0x198)]();for(let _0x6e17d4 of _0x5d6da6){let _0x16e144=dbFileIndex[_0x2fc0b1(0x186)](_0x2fc0b1(0x1cb)+TABLE_NAME_PHOTO_FACES+_0x2fc0b1(0x1c3)+_0x6e17d4['id'])[_0x2fc0b1(0x198)]();_0x16e144[_0x2fc0b1(0x175)](_0x6e17d4);let _0x527c90='(';for(let _0x30f15b in _0x16e144){_0x527c90+=_0x16e144[_0x30f15b]['id'],_0x30f15b!=_0x16e144[_0x2fc0b1(0x1bd)]-0x1&&(_0x527c90+=',');}_0x527c90+=')';let _0x8f2bbe=dbFileIndex[_0x2fc0b1(0x186)](_0x2fc0b1(0x17a)+TABLE_NAME_FACE2INDEX+_0x2fc0b1(0x18d)+_0x527c90+'\x20and\x20disabled=0')[_0x2fc0b1(0x193)]();dbFileIndex[_0x2fc0b1(0x186)](_0x2fc0b1(0x1bc)+TABLE_NAME_PHOTO_FACES+_0x2fc0b1(0x1c9)+_0x8f2bbe['count']+'\x20where\x20id='+_0x6e17d4['id'])[_0x2fc0b1(0x1d4)]();}dbFileIndex[_0x2fc0b1(0x186)](_0x2fc0b1(0x1bc)+TABLE_NAME_PHOTO_FACES+_0x2fc0b1(0x161))['run'](),dbFileIndex['prepare']('DELETE\x20FROM\x20'+TABLE_NAME_PHOTO_FACES+_0x2fc0b1(0x190))[_0x2fc0b1(0x1d4)]();}catch(_0x34197e){console[_0x2fc0b1(0x19f)](_0x34197e);}}let bgTaskId;try{let info=dbOther[_0x29db17(0x186)]('INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)')[_0x29db17(0x1d4)](_0x29db17(0x16c));bgTaskId=info['lastInsertRowid'];}catch(_0x4c78bc){}async function main(){setTimeout(async()=>{runFaceDetect();},0x7d0),setTimeout(async()=>{runFaceCompare();},0x1388);}main(),process['on'](_0x29db17(0x1d2),(_0x3215ad,_0x5f2ab0)=>{const _0x4611f2=_0x29db17;currentDetectIndex&&dbFileIndex[_0x4611f2(0x186)](_0x4611f2(0x1d5)+currentDetectIndex['id'])[_0x4611f2(0x1d4)](),process[_0x4611f2(0x182)]({'type':_0x4611f2(0x167)}),process[_0x4611f2(0x1ca)]();});