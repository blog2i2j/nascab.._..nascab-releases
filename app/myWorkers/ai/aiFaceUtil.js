function _0x24b8(){const _0x5b1cba=['tfModel','log','1865907xaYPGp','prepare','face_landmark_68_model-weights_manifest.json','get','engine','https://down.nascab.cn/tfModel/face_api/','resize','join','(face_descriptor)\x20VALUES(?)','dispose','faceRecognitionNet','667037SUKRpw','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','../../db/dbConfigTable','\x20,min_similar_score=','wasm','withFaceLandmarks','pipe','ssd_mobilenetv1_model-weights_manifest.json','1475730BWadrf','close','\x20where\x20id!=','SELECT\x20id\x20from\x20','existsSync','_score','message','_distance','stringify','all','face_recognition_model.bin','@tensorflow/tfjs-backend-wasm','INSERT\x20INTO\x20bg_task(task_type)\x20VALUES(?)','values','exit','loadFromDisk','error','face_landmark_68_tiny_model-weights_manifest.json','findBestMatch','min_similar_score','parse','raw','\x20SET\x20compare_state=1\x20where\x20id=','length','\x20where\x20face_photo_count<1\x20and\x20belong_face_id\x20is\x20null','setBackend','deleteRawTempFile','createWriteStream','withFaceDescriptors','face_landmark_68_model.bin',',\x20compare_state=1\x20where\x20id\x20=\x20','7088336GHMAvo','path','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20where\x20id=','8605kdspOZ','_height','\x20and\x20disabled=0','@tensorflow/tfjs','UPDATE\x20','2TRFmGa','stat','3557916ShmtAR','SELECT\x20*\x20from\x20','(photo_index_id,score,x,y,width,height,face_descriptor)\x20\x20VALUES(?,?,?,?,?,?,?)','pragma','filename','\x20SET\x20face_id=','value','photo_faces','aiFaceEnable','\x20where\x20belong_face_id=','then','1432LVTsrZ','width','type','run','face_landmark_68_tiny_model.bin','UPDATE\x20file_index_photo\x20SET\x20ai_face_detect_state=1\x20WHERE\x20ai_face_detect_state=0\x20and\x20size<=','\x20SET\x20face_photo_count=','\x20where\x20belong_face_id\x20is\x20null','lastInsertRowid','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20(type=1\x20OR\x20type=2)\x20AND\x20ai_face_detect_state=0\x20and\x20tiny_path\x20is\x20not\x20null\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20is_raw!=1\x20\x20LIMIT\x201','ready','\x20WHERE\x20id=','AI_FACES','ssdMobilenetv1','537607PhOUcO','detection','endScope','transSpcielFormat','renameSync','\x20SET\x20face_photo_count=0\x20where\x20belong_face_id\x20is\x20not\x20null','toBuffer','SELECT\x20*\x20from\x20file_index_photo\x20WHERE\x20is_file=1\x20AND\x20size>','_width','SELECT\x20COUNT(photo_index_id)\x20as\x20count\x20FROM\x20','catch','dbOther','\x20AND\x20(type=1\x20OR\x20type=2)\x20and\x20tiny_path\x20is\x20not\x20null\x20\x20AND\x20tiny_path\x20!=\x20\x270\x27\x20\x20AND\x20ai_face_detect_state=0\x20\x20AND\x20is_raw!=1\x20LIMIT\x201','jpeg','nets','https','height','userDataFolder','_box','face_descriptor','send','mkdirSync','FaceMatcher','channels','journal_mode\x20=\x20WAL','ssd_mobilenetv1_model.bin','../../libs/faceapi/face-api.node-wasm','findByTitle','face_id','title'];_0x24b8=function(){return _0x5b1cba;};return _0x24b8();}const _0x93d7f6=_0x4130;(function(_0x4152bb,_0x19d951){const _0x296a92=_0x4130,_0x2dad1b=_0x4152bb();while(!![]){try{const _0x213e2d=-parseInt(_0x296a92(0x1e9))/0x1*(parseInt(_0x296a92(0x1ce))/0x2)+parseInt(_0x296a92(0x1a7))/0x3+-parseInt(_0x296a92(0x1db))/0x4*(-parseInt(_0x296a92(0x1c9))/0x5)+-parseInt(_0x296a92(0x1d0))/0x6+-parseInt(_0x296a92(0x19f))/0x7+parseInt(_0x296a92(0x1c6))/0x8+-parseInt(_0x296a92(0x194))/0x9;if(_0x213e2d===_0x19d951)break;else _0x2dad1b['push'](_0x2dad1b['shift']());}catch(_0x247aa9){_0x2dad1b['push'](_0x2dad1b['shift']());}}}(_0x24b8,0x88edf));const fs=require('fs'),path=require(_0x93d7f6(0x1c7)),tfjs=require(_0x93d7f6(0x1cc)),wasm=require(_0x93d7f6(0x1b2)),sharpUtil=require('../../express-server/utils/sharpUtils'),exifUtils=require('../../utils/exifUtils'),faceapi=require(_0x93d7f6(0x203)),config=require('../../myConfig/config'),Database=require('better-sqlite3'),https=require(_0x93d7f6(0x1f8)),dbConfigTable=require(_0x93d7f6(0x1a1));process[_0x93d7f6(0x206)]='NasCabAiFace';function _0x4130(_0x40da25,_0x5446c3){const _0x24b8b5=_0x24b8();return _0x4130=function(_0x4130c6,_0x198d34){_0x4130c6=_0x4130c6-0x192;let _0x25a96=_0x24b8b5[_0x4130c6];return _0x25a96;},_0x4130(_0x40da25,_0x5446c3);}let dbFileIndex=new Database(config['dbFileIndex'],{}),dbOther=new Database(config[_0x93d7f6(0x1f4)],{});dbOther[_0x93d7f6(0x1d3)](_0x93d7f6(0x201)),dbFileIndex[_0x93d7f6(0x1d3)](_0x93d7f6(0x201)),process['on']('exit',()=>{const _0x22238b=_0x93d7f6;dbOther[_0x22238b(0x1a8)](),dbFileIndex['close']();});const sharp=require('sharp'),DEAL_GAP=0x7530;let TABLE_NAME_FACE2INDEX='photo_faces2index',TABLE_NAME_PHOTO_FACES=_0x93d7f6(0x1d7),modelInit=![],modelSavePath=path['join'](config[_0x93d7f6(0x1fa)],_0x93d7f6(0x192),'faceapi_models');!fs[_0x93d7f6(0x1ab)](modelSavePath)&&fs[_0x93d7f6(0x1fe)](modelSavePath,{'recursive':!![]});let modelBaseUrl=_0x93d7f6(0x199),modelFileUrlList=[],modelFileList=[_0x93d7f6(0x1df),_0x93d7f6(0x1b8),_0x93d7f6(0x1b1),'face_recognition_model-weights_manifest.json',_0x93d7f6(0x202),_0x93d7f6(0x1a6),_0x93d7f6(0x1c4),_0x93d7f6(0x196)];for(let i=0x0;i<modelFileList[_0x93d7f6(0x1be)];i++){modelFileUrlList['push'](modelBaseUrl+modelFileList[i]);}function httpDownload(_0x1a41b0,_0x3162d1,_0x4be27f){return new Promise((_0xb49a88,_0x115702)=>{const _0x2ce334=_0x4130;https[_0x2ce334(0x197)](_0x1a41b0,_0x15628a=>{const _0x1242a6=_0x2ce334,_0x137d56=fs[_0x1242a6(0x1c2)](_0x3162d1);_0x15628a[_0x1242a6(0x1a5)](_0x137d56),_0x137d56['on']('finish',()=>{const _0x322956=_0x1242a6;_0x137d56[_0x322956(0x1a8)](),fs[_0x322956(0x1ed)](_0x3162d1,_0x4be27f),_0xb49a88();})['on'](_0x1242a6(0x1b7),_0x549c32=>{});})['on'](_0x2ce334(0x1b7),_0x549b3e=>{const _0x23f4e9=_0x2ce334;_0x115702(_0x549b3e[_0x23f4e9(0x1ad)]);});});}function downloadModelFile(){return new Promise(async(_0x2d2207,_0x1dd7b4)=>{const _0x494074=_0x4130;try{for(let _0x47401f=0x0;_0x47401f<modelFileList['length'];_0x47401f++){let _0x56edf5=path['join'](modelSavePath,modelFileList[_0x47401f]),_0x25699e=path[_0x494074(0x19b)](modelSavePath,'tmp_'+modelFileList[_0x47401f]);if(!fs['existsSync'](_0x56edf5)){let _0x1ebdd1=modelFileUrlList[_0x47401f];await httpDownload(_0x1ebdd1,_0x25699e,_0x56edf5);}else{}}_0x2d2207();}catch(_0xee36){_0x1dd7b4(_0xee36);}});}async function initFaceAPI(){return new Promise(async(_0x388b92,_0x275d67)=>{const _0x25ab4f=_0x4130;try{!modelInit&&(await downloadModelFile(),await tfjs[_0x25ab4f(0x1c0)](_0x25ab4f(0x1a3)),await tfjs[_0x25ab4f(0x1e5)](),await faceapi[_0x25ab4f(0x1f7)][_0x25ab4f(0x1e8)][_0x25ab4f(0x1b6)](modelSavePath),await faceapi[_0x25ab4f(0x1f7)]['faceLandmark68Net'][_0x25ab4f(0x1b6)](modelSavePath),await faceapi[_0x25ab4f(0x1f7)][_0x25ab4f(0x19e)]['loadFromDisk'](modelSavePath),modelInit=!![]),_0x388b92();}catch(_0x525771){console[_0x25ab4f(0x193)](_0x525771),_0x275d67(_0x525771);}});}let currentDetectIndex=null;function runInfinitDetectFaces(){return new Promise(async _0x1ac31d=>{const _0x567149=_0x4130;let _0x54f31a;try{let _0x4e6b44=0x32*0x400;dbFileIndex[_0x567149(0x195)](_0x567149(0x1e0)+_0x4e6b44)[_0x567149(0x1de)](),_0x54f31a=dbFileIndex[_0x567149(0x195)](_0x567149(0x1f0)+_0x4e6b44+_0x567149(0x1f5))[_0x567149(0x197)]();if(!_0x54f31a)return setTimeout(()=>{_0x1ac31d();},DEAL_GAP);currentDetectIndex=_0x54f31a,await initFaceAPI();try{bgTaskId&&dbOther[_0x567149(0x195)](_0x567149(0x1a0)+bgTaskId)[_0x567149(0x1de)]();}catch(_0x26c827){}function _0x43bf38(){const _0x9748eb=_0x567149;dbFileIndex[_0x9748eb(0x195)](_0x9748eb(0x1c8)+_0x54f31a['id'])[_0x9748eb(0x1de)](),currentDetectIndex=null,_0x1ac31d();}let _0x3ec214=path[_0x567149(0x19b)](_0x54f31a['path'],_0x54f31a[_0x567149(0x1d4)]);parseInt(_0x54f31a[_0x567149(0x1dd)])==0x2&&(_0x3ec214=path[_0x567149(0x19b)](_0x54f31a['tiny_path']));let _0x46de5b=0x7d0;fs[_0x567149(0x1cf)](_0x3ec214,async(_0x425d70,_0x1fdf9c)=>{const _0x1104d6=_0x567149;if(_0x425d70)return _0x43bf38();sharpUtil[_0x1104d6(0x1ec)](_0x3ec214,(_0x25b125,_0x1e0c28,_0x503ebf)=>{const _0x8f09fe=_0x1104d6;let _0x3af9bf=sharpUtil['getSharpInstanceFromInput'](_0x25b125),_0x6d6270=exifUtils['getRotateFromTags'](_0x503ebf);_0x6d6270?_0x3af9bf=_0x3af9bf['rotate'](_0x6d6270):_0x3af9bf=_0x3af9bf['rotate'](),_0x3af9bf[_0x8f09fe(0x19a)]({'width':_0x46de5b,'height':_0x46de5b,'withoutEnlargement':!![]})[_0x8f09fe(0x1f6)]()[_0x8f09fe(0x1bc)]()[_0x8f09fe(0x1ef)](async(_0x4d7e4b,_0x167a62,_0x2186a1)=>{const _0x1176ed=_0x8f09fe;_0x1e0c28&&sharpUtil[_0x1176ed(0x1c1)](_0x25b125);if(_0x4d7e4b)return _0x167a62=null,_0x43bf38();let _0x48b9c3;try{faceapi['tf'][_0x1176ed(0x198)]()['startScope'](),temp=tfjs['tensor'](_0x167a62,[_0x2186a1[_0x1176ed(0x1f9)],_0x2186a1[_0x1176ed(0x1dc)],_0x2186a1[_0x1176ed(0x200)]]),_0x48b9c3=tfjs['slice'](temp,[0x0,0x0,0x0],[-0x1,-0x1,0x3]),faceapi['tf'][_0x1176ed(0x19d)](temp);}catch(_0x809a99){if(_0x48b9c3)faceapi['tf'][_0x1176ed(0x19d)](_0x48b9c3);if(temp)faceapi['tf'][_0x1176ed(0x19d)](temp);return faceapi['tf'][_0x1176ed(0x198)]()[_0x1176ed(0x1eb)](),_0x43bf38();}_0x167a62=null,faceapi['detectAllFaces'](_0x48b9c3)[_0x1176ed(0x1a4)]()[_0x1176ed(0x1c3)]()[_0x1176ed(0x1da)](_0x3867da=>{const _0x24b4ac=_0x1176ed;faceapi['tf'][_0x24b4ac(0x19d)](_0x48b9c3),faceapi['tf'][_0x24b4ac(0x198)]()[_0x24b4ac(0x1eb)]();if(!_0x3867da[_0x24b4ac(0x1be)])return _0x43bf38();let _0x3c28e3=[];for(let _0x438b6b of _0x3867da){let _0x596ac1=_0x438b6b[_0x24b4ac(0x1ea)]['_box'][_0x24b4ac(0x1f1)],_0x4a8341=_0x438b6b['detection'][_0x24b4ac(0x1fb)][_0x24b4ac(0x1ca)];if(_0x596ac1>_0x46de5b||_0x4a8341>_0x46de5b)continue;let _0xe2f7fd=_0x438b6b[_0x24b4ac(0x1ea)][_0x24b4ac(0x1ac)];if(_0x596ac1<0x50||_0x4a8341<0x50||_0xe2f7fd<0.8)continue;_0x3c28e3['push'](_0x438b6b);}if(!_0x3c28e3[_0x24b4ac(0x1be)])return _0x43bf38();for(let _0x38329d=0x0;_0x38329d<_0x3c28e3[_0x24b4ac(0x1be)];_0x38329d++){let _0x17b248=_0x3c28e3[_0x38329d],_0x302827=_0x17b248['detection'][_0x24b4ac(0x1fb)];dbFileIndex['prepare']('REPLACE\x20INTO\x20\x20'+TABLE_NAME_FACE2INDEX+_0x24b4ac(0x1d2))[_0x24b4ac(0x1de)](_0x54f31a['id'],_0x17b248[_0x24b4ac(0x1ea)][_0x24b4ac(0x1ac)],_0x302827['_x'],_0x302827['_y'],_0x302827['_width'],_0x302827[_0x24b4ac(0x1ca)],JSON[_0x24b4ac(0x1af)](_0x17b248['descriptor']));}return _0x3867da=null,_0x43bf38();})[_0x1176ed(0x1f3)](_0x47567d=>{const _0x1ec933=_0x1176ed;return _0x1e0c28&&sharpUtil['deleteRawTempFile'](_0x25b125),faceapi['tf'][_0x1ec933(0x19d)](_0x48b9c3),faceapi['tf'][_0x1ec933(0x198)]()[_0x1ec933(0x1eb)](),_0x43bf38();});});});});}catch(_0xc840da){_0x54f31a&&dbFileIndex['prepare'](_0x567149(0x1c8)+_0x54f31a['id'])[_0x567149(0x1de)](),_0x1ac31d();}});}function exitProcess(){const _0xaa9e41=_0x93d7f6;try{bgTaskId&&dbOther[_0xaa9e41(0x195)]('UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id='+bgTaskId)[_0xaa9e41(0x1de)]();}catch(_0x17f647){}return process[_0xaa9e41(0x1fd)]({'type':_0xaa9e41(0x1a8)}),statisticFacePhotoCount(),process[_0xaa9e41(0x1b5)]();}function runInfinitCompareFaces(){let _0x3eb592=0.35;return new Promise(async _0x44af5b=>{const _0x2d10d3=_0x4130;let _0x5c581a=dbFileIndex[_0x2d10d3(0x195)](_0x2d10d3(0x1e4))[_0x2d10d3(0x197)]();if(_0x5c581a)return setTimeout(()=>{_0x44af5b();},DEAL_GAP);let _0x57702e;try{try{bgTaskId&&dbOther[_0x2d10d3(0x195)](_0x2d10d3(0x1a0)+bgTaskId)[_0x2d10d3(0x1de)]();}catch(_0x1ee7ff){}_0x57702e=dbFileIndex[_0x2d10d3(0x195)](_0x2d10d3(0x1d1)+TABLE_NAME_FACE2INDEX+'\x20WHERE\x20\x20compare_state=0\x20\x20and\x20face_id\x20is\x20null\x20LIMIT\x201')['get']();if(!_0x57702e)return exitProcess();await initFaceAPI();function _0xb176b4(){const _0x704662=_0x2d10d3;dbFileIndex[_0x704662(0x195)](_0x704662(0x1cd)+TABLE_NAME_FACE2INDEX+'\x20SET\x20compare_state=1\x20where\x20id='+_0x57702e['id'])[_0x704662(0x1de)](),_0x44af5b();}let _0xb11f76=new Float32Array(Object[_0x2d10d3(0x1b4)](JSON[_0x2d10d3(0x1bb)](_0x57702e[_0x2d10d3(0x1fc)])));const _0x4f5028=new faceapi[(_0x2d10d3(0x1ff))]([_0xb11f76]);let _0x1fb8d1=[_0x57702e],_0x46b670=dbFileIndex['prepare'](_0x2d10d3(0x1aa)+TABLE_NAME_FACE2INDEX+_0x2d10d3(0x1a9)+_0x57702e['id'])[_0x2d10d3(0x1b0)](),_0x57a309=0x1,_0x498f85=null;for(let _0x4ff6fc=0x0;_0x4ff6fc<_0x46b670[_0x2d10d3(0x1be)];_0x4ff6fc++){let _0x1912cf=dbFileIndex['prepare'](_0x2d10d3(0x1d1)+TABLE_NAME_FACE2INDEX+_0x2d10d3(0x1e6)+_0x46b670[_0x4ff6fc]['id'])[_0x2d10d3(0x197)]();if(!_0x1912cf)continue;const _0x3db77f=_0x4f5028[_0x2d10d3(0x1b9)](new Float32Array(Object[_0x2d10d3(0x1b4)](JSON[_0x2d10d3(0x1bb)](_0x1912cf['face_descriptor']))));_0x3db77f[_0x2d10d3(0x1ae)]<_0x3eb592&&(_0x3db77f['_distance']<_0x57a309&&_0x1912cf[_0x2d10d3(0x205)]&&(_0x57a309=_0x3db77f['_distance'],_0x498f85=_0x1912cf[_0x2d10d3(0x205)]),_0x3db77f[_0x2d10d3(0x1ae)]<_0x1912cf[_0x2d10d3(0x1ba)]&&(_0x1912cf['min_similar_score']=_0x3db77f['_distance'],_0x1fb8d1['push'](_0x1912cf)));}if(_0x1fb8d1[_0x2d10d3(0x1be)]<0x2){if(_0x498f85&&!_0x57702e['face_id']){let _0x38a66f='UPDATE\x20'+TABLE_NAME_FACE2INDEX+'\x20SET\x20face_id='+_0x498f85+'\x20,min_similar_score='+_0x57a309+_0x2d10d3(0x1c5)+_0x57702e['id'];dbFileIndex[_0x2d10d3(0x195)](_0x38a66f)['run']();}else{}return _0xb176b4();}let _0x17c5ab={};for(let _0x39f5de=0x0;_0x39f5de<_0x1fb8d1['length'];_0x39f5de++){let _0x43dc27=_0x1fb8d1[_0x39f5de][_0x2d10d3(0x205)];_0x43dc27&&(_0x17c5ab[_0x43dc27]?_0x17c5ab[_0x43dc27]+=0x1:_0x17c5ab[_0x43dc27]=0x1);}if(Object['keys'](_0x17c5ab)[_0x2d10d3(0x1be)]>0x0){let _0x3f6ec5=0x0,_0x22db13=0x0;for(let _0x1c6927 in _0x17c5ab){_0x17c5ab[_0x1c6927]>_0x22db13&&(_0x22db13=_0x17c5ab[_0x1c6927],_0x3f6ec5=_0x1c6927);}if(_0x22db13>0x0&&_0x22db13>=(_0x1fb8d1[_0x2d10d3(0x1be)]-0x1)/0x6){for(let _0x3100d6 in _0x1fb8d1){let _0x2d4d97='UPDATE\x20'+TABLE_NAME_FACE2INDEX+'\x20SET\x20face_id='+_0x3f6ec5+_0x2d10d3(0x1a2)+_0x1fb8d1[_0x3100d6]['min_similar_score']+_0x2d10d3(0x1c5)+_0x1fb8d1[_0x3100d6]['id'];dbFileIndex['prepare'](_0x2d4d97)[_0x2d10d3(0x1de)]();}return _0xb176b4();}else{let _0x123db9=dbFileIndex['prepare']('REPLACE\x20INTO\x20'+TABLE_NAME_PHOTO_FACES+_0x2d10d3(0x19c))[_0x2d10d3(0x1de)](JSON[_0x2d10d3(0x1af)](_0xb11f76));for(let _0x4dd13d in _0x1fb8d1){let _0x4ce4b9=_0x2d10d3(0x1cd)+TABLE_NAME_FACE2INDEX+_0x2d10d3(0x1d5)+_0x123db9['lastInsertRowid']+_0x2d10d3(0x1a2)+_0x1fb8d1[_0x4dd13d]['min_similar_score']+_0x2d10d3(0x1c5)+_0x1fb8d1[_0x4dd13d]['id'];dbFileIndex[_0x2d10d3(0x195)](_0x4ce4b9)[_0x2d10d3(0x1de)]();}return _0xb176b4();}}else{let _0x294ba7=dbFileIndex['prepare']('REPLACE\x20INTO\x20'+TABLE_NAME_PHOTO_FACES+_0x2d10d3(0x19c))[_0x2d10d3(0x1de)](JSON[_0x2d10d3(0x1af)](_0xb11f76));for(let _0x5d29a2 in _0x1fb8d1){let _0x5159aa=_0x2d10d3(0x1cd)+TABLE_NAME_FACE2INDEX+_0x2d10d3(0x1d5)+_0x294ba7[_0x2d10d3(0x1e3)]+_0x2d10d3(0x1a2)+_0x1fb8d1[_0x5d29a2]['min_similar_score']+_0x2d10d3(0x1c5)+_0x1fb8d1[_0x5d29a2]['id'];dbFileIndex[_0x2d10d3(0x195)](_0x5159aa)['run']();}return _0xb176b4();}}catch(_0x4111f9){console[_0x2d10d3(0x193)](_0x4111f9),_0x57702e&&dbFileIndex[_0x2d10d3(0x195)](_0x2d10d3(0x1cd)+TABLE_NAME_FACE2INDEX+_0x2d10d3(0x1bd)+_0x57702e['id'])[_0x2d10d3(0x1de)](),_0x44af5b();}});}async function runFaceDetect(){const _0x1dcdee=_0x93d7f6;let _0x5619ca=dbConfigTable[_0x1dcdee(0x204)](dbOther,_0x1dcdee(0x1d8));_0x5619ca&&_0x5619ca[_0x1dcdee(0x1d6)]=='1'?runInfinitDetectFaces()[_0x1dcdee(0x1da)](()=>{runFaceDetect();}):exitProcess();}async function runFaceCompare(){const _0x454270=_0x93d7f6;runInfinitCompareFaces()[_0x454270(0x1da)](()=>{runFaceCompare();});}function statisticFacePhotoCount(){const _0x283bc3=_0x93d7f6;try{let _0x58438b=dbFileIndex[_0x283bc3(0x195)]('SELECT\x20id\x20from\x20'+TABLE_NAME_PHOTO_FACES+_0x283bc3(0x1e2))[_0x283bc3(0x1b0)]();for(let _0x5b3412 of _0x58438b){let _0x43634a=dbFileIndex[_0x283bc3(0x195)](_0x283bc3(0x1aa)+TABLE_NAME_PHOTO_FACES+_0x283bc3(0x1d9)+_0x5b3412['id'])['all']();_0x43634a['push'](_0x5b3412);let _0x43151d='(';for(let _0x17c501 in _0x43634a){_0x43151d+=_0x43634a[_0x17c501]['id'],_0x17c501!=_0x43634a[_0x283bc3(0x1be)]-0x1&&(_0x43151d+=',');}_0x43151d+=')';let _0x6e7e47=dbFileIndex['prepare'](_0x283bc3(0x1f2)+TABLE_NAME_FACE2INDEX+'\x20where\x20face_id\x20in\x20'+_0x43151d+_0x283bc3(0x1cb))[_0x283bc3(0x197)]();dbFileIndex[_0x283bc3(0x195)](_0x283bc3(0x1cd)+TABLE_NAME_PHOTO_FACES+_0x283bc3(0x1e1)+_0x6e7e47['count']+'\x20where\x20id='+_0x5b3412['id'])[_0x283bc3(0x1de)]();}dbFileIndex['prepare'](_0x283bc3(0x1cd)+TABLE_NAME_PHOTO_FACES+_0x283bc3(0x1ee))[_0x283bc3(0x1de)](),dbFileIndex[_0x283bc3(0x195)]('DELETE\x20FROM\x20'+TABLE_NAME_PHOTO_FACES+_0x283bc3(0x1bf))[_0x283bc3(0x1de)]();}catch(_0x42fb0e){console[_0x283bc3(0x193)](_0x42fb0e);}}let bgTaskId;try{let info=dbOther[_0x93d7f6(0x195)](_0x93d7f6(0x1b3))[_0x93d7f6(0x1de)](_0x93d7f6(0x1e7));bgTaskId=info[_0x93d7f6(0x1e3)];}catch(_0x236451){}async function main(){setTimeout(async()=>{runFaceDetect();},0x7d0),setTimeout(async()=>{runFaceCompare();},0x1388);}main(),process['on']('uncaughtException',(_0x4e63d2,_0x499a55)=>{const _0x2d0813=_0x93d7f6;currentDetectIndex&&dbFileIndex['prepare'](_0x2d0813(0x1c8)+currentDetectIndex['id'])[_0x2d0813(0x1de)](),process[_0x2d0813(0x1fd)]({'type':_0x2d0813(0x1a8)}),process[_0x2d0813(0x1b5)]();});