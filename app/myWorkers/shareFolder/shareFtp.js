const _0x50e6aa=_0x3560;(function(_0x3d868f,_0x3aa937){const _0x5672b0=_0x3560,_0x1df807=_0x3d868f();while(!![]){try{const _0xc8f38c=-parseInt(_0x5672b0(0x179))/0x1+-parseInt(_0x5672b0(0x184))/0x2+parseInt(_0x5672b0(0x175))/0x3+-parseInt(_0x5672b0(0x176))/0x4+-parseInt(_0x5672b0(0x16a))/0x5*(parseInt(_0x5672b0(0x170))/0x6)+parseInt(_0x5672b0(0x193))/0x7*(parseInt(_0x5672b0(0x181))/0x8)+parseInt(_0x5672b0(0x188))/0x9;if(_0xc8f38c===_0x3aa937)break;else _0x1df807['push'](_0x1df807['shift']());}catch(_0x27d840){_0x1df807['push'](_0x1df807['shift']());}}}(_0x4287,0xe738d));function _0x3560(_0x33f7ae,_0x5ab417){const _0x428709=_0x4287();return _0x3560=function(_0x3560ac,_0x15836f){_0x3560ac=_0x3560ac-0x16a;let _0x30393b=_0x428709[_0x3560ac];return _0x30393b;},_0x3560(_0x33f7ae,_0x5ab417);}const config=require(_0x50e6aa(0x196)),Database=require(_0x50e6aa(0x18f));let dbOther=new Database(config[_0x50e6aa(0x19a)],{});dbOther[_0x50e6aa(0x173)](_0x50e6aa(0x16c));const dbConfigTable=require(_0x50e6aa(0x17c)),dbFileShare=require('../../db/dbFileShare'),dbUserTable=require('../../db/dbUserTable'),FtpSrv=require(_0x50e6aa(0x18e));process['title']=_0x50e6aa(0x191);function _0x4287(){const _0x27e4d7=['code','\x20server_type=\x27FTP\x27','stop','dbOther','FTPPort','135fmNUww','ftp://0.0.0.0:','journal_mode\x20=\x20WAL','FTP\x20Start\x20failed','stringify','path','303174YbuCBd','userHasFtp','FTPServer','pragma','create','5217516sAQTaM','773016TdEueF','close','../../express-server/utils/netUtils','58599MUTDjh','../../db/dbNoticeCenterTable','isPortFree','../../db/dbConfigTable','getAllByWhere','FTP','message','Restart\x20FTP','72trETwC','passwordKey','catch','3303272NjYLxC','then','length','GeneralError','14961276saZWrm','log','login','type','shareType','run','ftp-srv','better-sqlite3','EADDRINUSE','NasCabFtpWorker','closed','632583byCLqA','../../express-server/utils/cryptoUtils','error','../../myConfig/config'];_0x4287=function(){return _0x27e4d7;};return _0x4287();}let cryptoUtils=require(_0x50e6aa(0x194)),myFtpServer=null;const dbNoticeCenterTable=require(_0x50e6aa(0x17a));let netUtils=require(_0x50e6aa(0x178));function saveMsg(_0x1b10e6,_0x529439,_0x55e508){const _0x2a0c0b=_0x50e6aa;dbNoticeCenterTable[_0x2a0c0b(0x174)](dbOther,{'title':_0x1b10e6,'level':_0x529439,'content':_0x55e508});}function ftpListenNew(_0x4975ee){const _0x310c2e=_0x50e6aa;myFtpServer=new FtpSrv({'url':_0x310c2e(0x16b)+_0x4975ee});let _0x2f8c2c=dbFileShare[_0x310c2e(0x17d)](dbOther,_0x310c2e(0x198),[]);_0x2f8c2c&&_0x2f8c2c[_0x310c2e(0x186)]>0x0?(myFtpServer['on'](_0x310c2e(0x18a),({connection:_0x32961b,username:_0x28766c,password:_0x3682dc},_0xb954cf,_0x38dd38)=>{const _0x57e1be=_0x310c2e;cryptoUtils['encryptString'](config[_0x57e1be(0x182)],_0x3682dc)[_0x57e1be(0x185)](_0x372a69=>{const _0x4da056=_0x57e1be;let _0x3799bf=dbUserTable['login'](dbOther,_0x28766c,_0x372a69);if(!_0x3799bf)return _0x38dd38(new errors[(_0x4da056(0x187))]('Invalid\x20username\x20or\x20password',0x191));let _0x59e701=dbFileShare[_0x4da056(0x171)](dbOther,_0x3799bf['id'],_0x4da056(0x17e));return _0x59e701?_0xb954cf({'root':_0x59e701[_0x4da056(0x16f)]}):_0x38dd38(0x191);})[_0x57e1be(0x183)](_0x4af397=>{const _0x4bccb9=_0x57e1be;return console[_0x4bccb9(0x189)](_0x4bccb9(0x195),_0x4af397),_0x38dd38(0x191);});}),myFtpServer['listen']()['then'](()=>{const _0x168cc2=_0x310c2e;console[_0x168cc2(0x189)]('FTP\x20start\x20running\x20on\x20:'+_0x4975ee),dbConfigTable['create'](dbOther,{'title':'FTPServer','value':JSON[_0x168cc2(0x16e)]({'state':_0x168cc2(0x18d),'port':_0x4975ee})});})['catch'](_0x1427f0=>{const _0x52d142=_0x310c2e;console[_0x52d142(0x189)](_0x52d142(0x195),_0x1427f0),_0x1427f0[_0x52d142(0x197)]==_0x52d142(0x190)?initFtpShare(_0x4975ee+0x1):(dbConfigTable['create'](dbOther,{'title':'FTPServer','value':JSON[_0x52d142(0x16e)]({'state':_0x52d142(0x199),'port':_0x4975ee})}),saveMsg(_0x52d142(0x16d),_0x52d142(0x195),_0x1427f0[_0x52d142(0x197)]));})):dbConfigTable[_0x310c2e(0x174)](dbOther,{'title':_0x310c2e(0x172),'value':JSON[_0x310c2e(0x16e)]({'state':_0x310c2e(0x199),'port':_0x4975ee})});}async function initFtpShare(_0x2c4c3d){const _0x175dbd=_0x50e6aa;myFtpServer?(myFtpServer[_0x175dbd(0x177)](),myFtpServer['on'](_0x175dbd(0x192),({})=>{ftpListenNew(_0x2c4c3d);})):ftpListenNew(_0x2c4c3d);}let getFreePort=function(_0x6bb715,_0x95c9c2){const _0x1a4b82=_0x50e6aa;netUtils[_0x1a4b82(0x17b)](_0x6bb715)[_0x1a4b82(0x185)](_0x26c24b=>{_0x26c24b?_0x95c9c2(_0x6bb715):(_0x6bb715+=0x1,getFreePort(_0x6bb715,_0x95c9c2));});};function getFtpSetPort(_0x382d36){const _0x2e4ca9=_0x50e6aa;let _0x220a3e=config[_0x2e4ca9(0x19b)],_0xa2761b=_0x2e4ca9(0x19b),_0xe169e6=dbConfigTable['findByTitle'](dbOther,_0xa2761b);if(_0xe169e6){let _0x320950=parseInt(_0xe169e6['value']);if(_0x320950<=0x0||_0x320950>0xffff){}else _0x220a3e=_0x320950;}getFreePort(_0x220a3e,_0x382d36);}process['on'](_0x50e6aa(0x17f),_0x275556=>{const _0x437725=_0x50e6aa;if(_0x275556[_0x437725(0x18b)]=='fileShareRestart'&&_0x275556[_0x437725(0x18c)]=='FTP')console[_0x437725(0x189)](_0x437725(0x180)),getFtpSetPort(_0x3cd3a8=>{initFtpShare(_0x3cd3a8);});else _0x275556['type']==_0x437725(0x177)&&(myFtpServer&&myFtpServer[_0x437725(0x177)]());}),getFtpSetPort(_0x16d65c=>{initFtpShare(_0x16d65c);});