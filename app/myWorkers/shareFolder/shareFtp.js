function _0x38e6(_0xaea4ad,_0xc7e0b1){const _0xe96fbe=_0xe96f();return _0x38e6=function(_0x38e6eb,_0x84edfb){_0x38e6eb=_0x38e6eb-0x1a4;let _0x46745c=_0xe96fbe[_0x38e6eb];return _0x46745c;},_0x38e6(_0xaea4ad,_0xc7e0b1);}const _0x1c1f42=_0x38e6;(function(_0x416322,_0x2ef1cf){const _0x3490ac=_0x38e6,_0x238671=_0x416322();while(!![]){try{const _0x203c04=-parseInt(_0x3490ac(0x1cf))/0x1+parseInt(_0x3490ac(0x1b0))/0x2+-parseInt(_0x3490ac(0x1c5))/0x3*(parseInt(_0x3490ac(0x1c2))/0x4)+-parseInt(_0x3490ac(0x1ad))/0x5+-parseInt(_0x3490ac(0x1ca))/0x6+-parseInt(_0x3490ac(0x1d1))/0x7*(-parseInt(_0x3490ac(0x1a4))/0x8)+parseInt(_0x3490ac(0x1b8))/0x9;if(_0x203c04===_0x2ef1cf)break;else _0x238671['push'](_0x238671['shift']());}catch(_0x2218d5){_0x238671['push'](_0x238671['shift']());}}}(_0xe96f,0x20740));const config=require('../../myConfig/config'),Database=require('better-sqlite3');let dbOther=new Database(config['dbOther'],{});dbOther[_0x1c1f42(0x1af)](_0x1c1f42(0x1be));const dbConfigTable=require('../../db/dbConfigTable'),dbFileShare=require(_0x1c1f42(0x1a6)),dbUserTable=require('../../db/dbUserTable'),FtpSrv=require('ftp-srv');process[_0x1c1f42(0x1c8)]=_0x1c1f42(0x1cc);let cryptoUtils=require(_0x1c1f42(0x1a5)),myFtpServer=null;const dbNoticeCenterTable=require(_0x1c1f42(0x1c0));let netUtils=require('../../express-server/utils/netUtils');function saveMsg(_0x228e53,_0x59b188,_0x8f4831){dbNoticeCenterTable['create'](dbOther,{'title':_0x228e53,'level':_0x59b188,'content':_0x8f4831});}function ftpListenNew(_0x96a62b){const _0xcc59b1=_0x1c1f42;myFtpServer=new FtpSrv({'url':_0xcc59b1(0x1d0)+_0x96a62b});let _0x86ccf5=dbFileShare['getAllByWhere'](dbOther,_0xcc59b1(0x1b7),[]);_0x86ccf5&&_0x86ccf5[_0xcc59b1(0x1aa)]>0x0?(myFtpServer['on'](_0xcc59b1(0x1c7),({connection:_0x53bc90,username:_0x3a21bf,password:_0x4dc8ec},_0x4b2d12,_0x1bb4dc)=>{const _0x4982be=_0xcc59b1;cryptoUtils['encryptString'](config[_0x4982be(0x1ae)],_0x4dc8ec)['then'](_0x1edb0a=>{const _0x465876=_0x4982be;let _0x4fcdb9=dbUserTable[_0x465876(0x1c7)](dbOther,_0x3a21bf,_0x1edb0a);if(!_0x4fcdb9)return _0x1bb4dc(new errors[(_0x465876(0x1b6))](_0x465876(0x1c9),0x191));let _0x64ab7d=dbFileShare[_0x465876(0x1bd)](dbOther,_0x4fcdb9['id'],_0x465876(0x1c1));return _0x64ab7d?_0x4b2d12({'root':_0x64ab7d['path']}):_0x1bb4dc(0x191);})[_0x4982be(0x1bc)](_0x3f76e1=>{const _0x31b9f5=_0x4982be;return console[_0x31b9f5(0x1ce)](_0x31b9f5(0x1b9),_0x3f76e1),_0x1bb4dc(0x191);});}),myFtpServer['listen']()[_0xcc59b1(0x1a7)](()=>{const _0x48b056=_0xcc59b1;console['log']('FTP\x20start\x20running\x20on\x20:'+_0x96a62b),dbConfigTable['create'](dbOther,{'title':_0x48b056(0x1ac),'value':JSON['stringify']({'state':'run','port':_0x96a62b})});})['catch'](_0x11f685=>{const _0x5f2269=_0xcc59b1;console['log'](_0x5f2269(0x1b9),_0x11f685),_0x11f685[_0x5f2269(0x1b4)]==_0x5f2269(0x1b1)?initFtpShare(_0x96a62b+0x1):(dbConfigTable['create'](dbOther,{'title':_0x5f2269(0x1ac),'value':JSON[_0x5f2269(0x1bb)]({'state':'stop','port':_0x96a62b})}),saveMsg(_0x5f2269(0x1bf),_0x5f2269(0x1b9),_0x11f685[_0x5f2269(0x1b4)]));})):dbConfigTable['create'](dbOther,{'title':_0xcc59b1(0x1ac),'value':JSON[_0xcc59b1(0x1bb)]({'state':_0xcc59b1(0x1cd),'port':_0x96a62b})});}async function initFtpShare(_0x163b20){const _0x8718fb=_0x1c1f42;myFtpServer?(myFtpServer['close'](),myFtpServer['on'](_0x8718fb(0x1c3),({})=>{ftpListenNew(_0x163b20);})):ftpListenNew(_0x163b20);}let getFreePort=function(_0x2ed6f9,_0x220c38){const _0x1e1aa9=_0x1c1f42;netUtils[_0x1e1aa9(0x1cb)](_0x2ed6f9)[_0x1e1aa9(0x1a7)](_0x2b0916=>{_0x2b0916?_0x220c38(_0x2ed6f9):(_0x2ed6f9+=0x1,getFreePort(_0x2ed6f9,_0x220c38));});};function getFtpSetPort(_0x34712f){const _0x5216c3=_0x1c1f42;let _0x3c99c1=config[_0x5216c3(0x1a8)],_0x5e8b1d='FTPPort',_0x215fc9=dbConfigTable[_0x5216c3(0x1c4)](dbOther,_0x5e8b1d);if(_0x215fc9){let _0x494dac=parseInt(_0x215fc9[_0x5216c3(0x1b3)]);if(_0x494dac<=0x0||_0x494dac>0xffff){}else _0x3c99c1=_0x494dac;}getFreePort(_0x3c99c1,_0x34712f);}function _0xe96f(){const _0x302407=['fileShareRestart','GeneralError','\x20server_type=\x27FTP\x27','4846437gPZLPf','error','close','stringify','catch','userHasFtp','journal_mode\x20=\x20WAL','FTP\x20Start\x20failed','../../db/dbNoticeCenterTable','FTP','257368jvgSLF','closed','findByTitle','3hpdPNc','message','login','title','Invalid\x20username\x20or\x20password','124806eNjMYp','isPortFree','NasCabFtpWorker','stop','log','180635crhfkK','ftp://0.0.0.0:','1491ajvhLY','488vKkdqU','../../express-server/utils/cryptoUtils','../../db/dbFileShare','then','FTPPort','Restart\x20FTP','length','type','FTPServer','965625tDRfeS','passwordKey','pragma','80690djeoJq','EADDRINUSE','shareType','value','code'];_0xe96f=function(){return _0x302407;};return _0xe96f();}process['on'](_0x1c1f42(0x1c6),_0x50507b=>{const _0x5b1b45=_0x1c1f42;if(_0x50507b[_0x5b1b45(0x1ab)]==_0x5b1b45(0x1b5)&&_0x50507b[_0x5b1b45(0x1b2)]=='FTP')console['log'](_0x5b1b45(0x1a9)),getFtpSetPort(_0x1eef8f=>{initFtpShare(_0x1eef8f);});else _0x50507b[_0x5b1b45(0x1ab)]==_0x5b1b45(0x1ba)&&(myFtpServer&&myFtpServer['close']());}),getFtpSetPort(_0x1dba35=>{initFtpShare(_0x1dba35);});