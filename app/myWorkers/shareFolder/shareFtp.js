const _0xe18c5b=_0x23dd;(function(_0x483a31,_0x521055){const _0xafc2a8=_0x23dd,_0x37a40b=_0x483a31();while(!![]){try{const _0x500fa5=-parseInt(_0xafc2a8(0xd5))/0x1+-parseInt(_0xafc2a8(0xcd))/0x2+parseInt(_0xafc2a8(0xb2))/0x3+-parseInt(_0xafc2a8(0xd3))/0x4*(parseInt(_0xafc2a8(0xb5))/0x5)+-parseInt(_0xafc2a8(0xc1))/0x6*(parseInt(_0xafc2a8(0xbd))/0x7)+-parseInt(_0xafc2a8(0xac))/0x8+-parseInt(_0xafc2a8(0xbc))/0x9*(-parseInt(_0xafc2a8(0xca))/0xa);if(_0x500fa5===_0x521055)break;else _0x37a40b['push'](_0x37a40b['shift']());}catch(_0x17d182){_0x37a40b['push'](_0x37a40b['shift']());}}}(_0x56b3,0x9766d));const config=require(_0xe18c5b(0xb6)),Database=require(_0xe18c5b(0xb9));let dbOther=new Database(config['dbOther'],{});dbOther['pragma']('journal_mode\x20=\x20WAL');const dbConfigTable=require(_0xe18c5b(0xd2)),dbFileShare=require(_0xe18c5b(0xc2)),dbUserTable=require(_0xe18c5b(0xbf)),FtpSrv=require(_0xe18c5b(0xb4));process['title']=_0xe18c5b(0xab);let cryptoUtils=require('../../express-server/utils/cryptoUtils'),myFtpServer=null;const dbNoticeCenterTable=require(_0xe18c5b(0xae));function _0x23dd(_0x56ce17,_0x3e3887){const _0x56b30b=_0x56b3();return _0x23dd=function(_0x23dd81,_0x50a4c7){_0x23dd81=_0x23dd81-0xa9;let _0x408c63=_0x56b30b[_0x23dd81];return _0x408c63;},_0x23dd(_0x56ce17,_0x3e3887);}let netUtils=require(_0xe18c5b(0xba));function saveMsg(_0x5a7268,_0x12ee48,_0x51166b){const _0x5d24e5=_0xe18c5b;dbNoticeCenterTable[_0x5d24e5(0xc8)](dbOther,{'title':_0x5a7268,'level':_0x12ee48,'content':_0x51166b});}function _0x56b3(){const _0x2e3b00=['log','better-sqlite3','../../express-server/utils/netUtils','catch','9hLCrWK','704998qebqeI','run','../../db/dbUserTable','FTPServer','66eGITcu','../../db/dbFileShare','userHasFtp','Restart\x20FTP','type','\x20server_type=\x27FTP\x27','FTP','create','path','33631760OKyaeb','stringify','EADDRINUSE','1870042LTyzNm','ftp://0.0.0.0:','value','FTP\x20Start\x20failed','login','../../db/dbConfigTable','242956RpHMjg','closed','64007rWNWlL','error','passwordKey','then','NasCabFtpWorker','8353144OeMqDy','Invalid\x20username\x20or\x20password','../../db/dbNoticeCenterTable','message','code','shareType','3410574ScsPnO','FTPPort','ftp-srv','60qmbIMO','../../myConfig/config','close'];_0x56b3=function(){return _0x2e3b00;};return _0x56b3();}function ftpListenNew(_0x455835){const _0x468487=_0xe18c5b;myFtpServer=new FtpSrv({'url':_0x468487(0xce)+_0x455835});let _0xcabc13=dbFileShare['getAllByWhere'](dbOther,_0x468487(0xc6),[]);_0xcabc13&&_0xcabc13['length']>0x0?(myFtpServer['on'](_0x468487(0xd1),({connection:_0x51eee6,username:_0x34fe4a,password:_0x5686da},_0x8c86ff,_0x45f35b)=>{const _0x431779=_0x468487;cryptoUtils['encryptString'](config[_0x431779(0xa9)],_0x5686da)[_0x431779(0xaa)](_0x21fb34=>{const _0x588a48=_0x431779;let _0x275dd1=dbUserTable['login'](dbOther,_0x34fe4a,_0x21fb34);if(!_0x275dd1)return _0x45f35b(new errors['GeneralError'](_0x588a48(0xad),0x191));let _0x53dba8=dbFileShare[_0x588a48(0xc3)](dbOther,_0x275dd1['id'],_0x588a48(0xc7));return _0x53dba8?_0x8c86ff({'root':_0x53dba8[_0x588a48(0xc9)]}):_0x45f35b(0x191);})['catch'](_0x3c3c66=>{const _0x14d281=_0x431779;return console[_0x14d281(0xb8)]('error',_0x3c3c66),_0x45f35b(0x191);});}),myFtpServer['listen']()[_0x468487(0xaa)](()=>{const _0x1e3fa8=_0x468487;console['log']('FTP\x20start\x20running\x20on\x20:'+_0x455835),dbConfigTable[_0x1e3fa8(0xc8)](dbOther,{'title':'FTPServer','value':JSON[_0x1e3fa8(0xcb)]({'state':_0x1e3fa8(0xbe),'port':_0x455835})});})[_0x468487(0xbb)](_0x2e9185=>{const _0x1f6851=_0x468487;console[_0x1f6851(0xb8)]('error',_0x2e9185),_0x2e9185[_0x1f6851(0xb0)]==_0x1f6851(0xcc)?initFtpShare(_0x455835+0x1):(dbConfigTable[_0x1f6851(0xc8)](dbOther,{'title':_0x1f6851(0xc0),'value':JSON[_0x1f6851(0xcb)]({'state':'stop','port':_0x455835})}),saveMsg(_0x1f6851(0xd0),_0x1f6851(0xd6),_0x2e9185['code']));})):dbConfigTable['create'](dbOther,{'title':_0x468487(0xc0),'value':JSON[_0x468487(0xcb)]({'state':'stop','port':_0x455835})});}async function initFtpShare(_0x35c2f2){const _0x9711dd=_0xe18c5b;myFtpServer?(myFtpServer['close'](),myFtpServer['on'](_0x9711dd(0xd4),({})=>{ftpListenNew(_0x35c2f2);})):ftpListenNew(_0x35c2f2);}let getFreePort=function(_0x2e5fad,_0x1e5fd9){const _0x4cf14b=_0xe18c5b;netUtils['isPortFree'](_0x2e5fad)[_0x4cf14b(0xaa)](_0x227482=>{_0x227482?_0x1e5fd9(_0x2e5fad):(_0x2e5fad+=0x1,getFreePort(_0x2e5fad,_0x1e5fd9));});};function getFtpSetPort(_0x26408f){const _0x265625=_0xe18c5b;let _0x4bc190=config[_0x265625(0xb3)],_0x2de2be='FTPPort',_0x2f28ea=dbConfigTable['findByTitle'](dbOther,_0x2de2be);if(_0x2f28ea){let _0x22b67e=parseInt(_0x2f28ea[_0x265625(0xcf)]);if(_0x22b67e<=0x0||_0x22b67e>0xffff){}else _0x4bc190=_0x22b67e;}getFreePort(_0x4bc190,_0x26408f);}process['on'](_0xe18c5b(0xaf),_0x9b9ccd=>{const _0x53873f=_0xe18c5b;if(_0x9b9ccd[_0x53873f(0xc5)]=='fileShareRestart'&&_0x9b9ccd[_0x53873f(0xb1)]==_0x53873f(0xc7))console[_0x53873f(0xb8)](_0x53873f(0xc4)),getFtpSetPort(_0x485c11=>{initFtpShare(_0x485c11);});else _0x9b9ccd[_0x53873f(0xc5)]==_0x53873f(0xb7)&&(myFtpServer&&myFtpServer[_0x53873f(0xb7)]());}),getFtpSetPort(_0x238143=>{initFtpShare(_0x238143);});