const _0x11c434=_0x306c;(function(_0x1f9be3,_0x36422d){const _0x3d3c49=_0x306c,_0x856cf3=_0x1f9be3();while(!![]){try{const _0x34acd4=-parseInt(_0x3d3c49(0x1f7))/0x1+parseInt(_0x3d3c49(0x203))/0x2*(-parseInt(_0x3d3c49(0x1d2))/0x3)+parseInt(_0x3d3c49(0x246))/0x4*(-parseInt(_0x3d3c49(0x15c))/0x5)+-parseInt(_0x3d3c49(0x168))/0x6+parseInt(_0x3d3c49(0x18d))/0x7+parseInt(_0x3d3c49(0x1ca))/0x8*(parseInt(_0x3d3c49(0x15b))/0x9)+parseInt(_0x3d3c49(0x225))/0xa;if(_0x34acd4===_0x36422d)break;else _0x856cf3['push'](_0x856cf3['shift']());}catch(_0x152385){_0x856cf3['push'](_0x856cf3['shift']());}}}(_0x5b5a,0xe6792));const {XMLParser,XMLBuilder}=require(_0x11c434(0x17f)),path=require(_0x11c434(0x175));let axios=require(_0x11c434(0x167));const {HttpsProxyAgent}=require(_0x11c434(0x1e6)),https=require(_0x11c434(0x1f2)),{URL}=require(_0x11c434(0x215)),fs=require('fs'),movieSeasonUtil=require(_0x11c434(0x15a)),mediaTypeConfig=require(_0x11c434(0x24a)),{parentPort,workerData}=require(_0x11c434(0x1cb)),movieInfoTmdbApi=require(_0x11c434(0x1fe)),dbConfigTable=require(_0x11c434(0x16b)),nfoUtil=require(_0x11c434(0x219)),Database=require(_0x11c434(0x15f)),config=require('../myConfig/config'),dbFileIndex=new Database(config[_0x11c434(0x193)],{'timeout':0xea60});dbFileIndex[_0x11c434(0x19e)](_0x11c434(0x198));let dbOther=new Database(config[_0x11c434(0x1ec)],{});dbOther[_0x11c434(0x19e)](_0x11c434(0x198));let i18nUtil=require(_0x11c434(0x247));i18n=i18nUtil[_0x11c434(0x1e2)](dbOther);let excludeList=['阳光电影dygod.org',_0x11c434(0x1fb),_0x11c434(0x202),_0x11c434(0x1f9),_0x11c434(0x16c),_0x11c434(0x232),_0x11c434(0x230),_0x11c434(0x17b),_0x11c434(0x1cf),_0x11c434(0x227),_0x11c434(0x20f),_0x11c434(0x174),_0x11c434(0x17a),_0x11c434(0x228),_0x11c434(0x161),_0x11c434(0x1e7),'4audio',_0x11c434(0x1c0),_0x11c434(0x23b),'6audio',_0x11c434(0x1e1),_0x11c434(0x1b8),_0x11c434(0x166),_0x11c434(0x17c),_0x11c434(0x221),'7audios','cee',_0x11c434(0x21c),_0x11c434(0x196),_0x11c434(0x159),_0x11c434(0x249),'fgt',_0x11c434(0x1b9),_0x11c434(0x224),_0x11c434(0x1b0),_0x11c434(0x20d),'hdr10',_0x11c434(0x1b3),'hd',_0x11c434(0x204),_0x11c434(0x179),_0x11c434(0x1b7),_0x11c434(0x214),'swtyblz',_0x11c434(0x1f6),_0x11c434(0x187),_0x11c434(0x21f),'ma',_0x11c434(0x160),'dv','ddp','cmrg',_0x11c434(0x1e9),_0x11c434(0x180),_0x11c434(0x181),_0x11c434(0x1c8),_0x11c434(0x1f1),_0x11c434(0x1df),_0x11c434(0x1bc),_0x11c434(0x184),_0x11c434(0x23f),_0x11c434(0x1ef),_0x11c434(0x1f4),'eng','nahom','ita',_0x11c434(0x244),_0x11c434(0x1eb),_0x11c434(0x233),_0x11c434(0x238),_0x11c434(0x18f),_0x11c434(0x18b),'hdtv',_0x11c434(0x201),_0x11c434(0x197),_0x11c434(0x18e),_0x11c434(0x1a9),_0x11c434(0x236),_0x11c434(0x17d),_0x11c434(0x19c),_0x11c434(0x23e),'rm','mov','3gp',_0x11c434(0x174),'tbs',_0x11c434(0x1ce),'aac',_0x11c434(0x1cd),_0x11c434(0x173),_0x11c434(0x1b1),'dreamhd',_0x11c434(0x222),'电影天堂',_0x11c434(0x17e),_0x11c434(0x1d7),_0x11c434(0x217),'英文中字',_0x11c434(0x226),_0x11c434(0x16a),'dl','-',_0x11c434(0x1ee),_0x11c434(0x1b5),'韩语中字',_0x11c434(0x1f8),'高清mp4电影'];function isObjectInQueryArray(_0x481671,_0x3f40b6){const _0x4a4612=_0x11c434;return _0x481671[_0x4a4612(0x22f)](function(_0x398486){const _0x24073d=_0x4a4612,_0x2ff5dc=Object[_0x24073d(0x164)](_0x3f40b6);return _0x2ff5dc[_0x24073d(0x1d4)](_0x497427=>_0x398486[_0x497427]===_0x3f40b6[_0x497427]);});}function getQueryArray(_0x163989){const _0x563e58=_0x11c434;let _0x445a29=[];if(!_0x163989||!_0x163989['filename'])return[];let _0xfa4d27=_0x163989['filename']['toLowerCase']();if(!_0xfa4d27||_0xfa4d27[_0x563e58(0x182)]<0x2)return[];function _0x459ca2(_0x6f05bb,_0x275db8){const _0x30d466=_0x563e58;let _0x5b353d={'title':_0x6f05bb,'year':_0x275db8};_0x6f05bb!=_0x30d466(0x22c)&&!isObjectInQueryArray(_0x445a29,_0x5b353d)&&_0x445a29['push'](_0x5b353d);}function _0xe76461(_0x345740){const _0x2c5163=_0x563e58;let _0x4215af=path['extname'](_0x345740);_0x4215af&&(_0x345740=_0x345740[_0x2c5163(0x1d9)](_0x4215af,''));if(/^[0-9]*$/[_0x2c5163(0x191)](_0x345740)&&_0x345740!='1942'&&!_0x345740[_0x2c5163(0x176)](_0x2c5163(0x1a5)))return[];if(_0x345740[_0x2c5163(0x176)](_0x2c5163(0x157))||_0x345740[_0x2c5163(0x176)](_0x2c5163(0x1e3))||_0x345740[_0x2c5163(0x176)](_0x2c5163(0x242))||_0x345740[_0x2c5163(0x176)]('vid')||_0x345740[_0x2c5163(0x176)](_0x2c5163(0x1c9))||_0x345740[_0x2c5163(0x176)](_0x2c5163(0x189))||_0x345740[_0x2c5163(0x176)](_0x2c5163(0x1d8)))return[];_0x345740[_0x345740[_0x2c5163(0x182)]-0x1]=='.'&&(_0x345740=_0x345740[_0x2c5163(0x158)](0x0,_0x345740[_0x2c5163(0x182)]-0x1));_0x345740=_0x345740[_0x2c5163(0x1d9)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')['replace']('5.1','')[_0x2c5163(0x1d9)](_0x2c5163(0x1a2),''),_0x345740=_0x345740[_0x2c5163(0x1d9)](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')[_0x2c5163(0x1d9)](/[ ]+/gi,'\x20');let _0x4b5b1c=_0x345740['split']('\x20'),_0x8b743e=[],_0x53e3c9=null;for(let _0x67c045 in _0x4b5b1c){let _0x48c7c9=_0x4b5b1c[_0x67c045][_0x2c5163(0x188)]();if(excludeList[_0x2c5163(0x1bd)](_0x48c7c9))continue;if(isNumber(_0x48c7c9)){if(parseInt(_0x48c7c9)>0x767&&parseInt(_0x48c7c9)<0x834){_0x53e3c9=_0x48c7c9;continue;}}_0x8b743e['push'](_0x48c7c9);}for(let _0x116c2b=_0x8b743e[_0x2c5163(0x182)];_0x116c2b>=0x0;_0x116c2b--){let _0x36a021=_0x8b743e['join']('\x20')[_0x2c5163(0x188)]();_0x36a021&&(_0x53e3c9&&_0x459ca2(_0x36a021,_0x53e3c9),_0x459ca2(_0x36a021)),_0x8b743e['splice'](_0x8b743e[_0x2c5163(0x182)]-0x1,0x1);}}if(_0x163989['is_tvplay']==0x1)try{let _0x56978b=path[_0x563e58(0x208)](_0x163989['path'])[_0x563e58(0x210)](),_0x8431eb=movieSeasonUtil[_0x563e58(0x240)](_0x56978b);if(_0x8431eb>-0x1){let _0x4d62e=path[_0x563e58(0x208)](path['dirname'](_0x163989[_0x563e58(0x175)]))[_0x563e58(0x210)]();_0x4d62e&&_0xe76461(_0x4d62e);}else _0xe76461(_0x56978b);}catch(_0x581757){console[_0x563e58(0x206)](_0x581757);}const _0x1a9cad=_0xfa4d27[_0x563e58(0x1d9)](/s\d{1,2}e\d{1,2}/g,'');return _0xe76461(_0x1a9cad),_0x445a29;}function isNumber(_0x5ad688){return/^-?[\d.]+(?:e-?\d+)?$/['test'](_0x5ad688);}function getTmdbApi(){const _0xf6f19e=_0x11c434;let _0x2fc21f=dbConfigTable[_0xf6f19e(0x1c7)](dbOther,'tmdbProxyEnable'),_0x5ba829=null;if(_0x2fc21f&&_0x2fc21f[_0xf6f19e(0x205)]==0x1){let _0x51656f=dbConfigTable[_0xf6f19e(0x1c7)](dbOther,_0xf6f19e(0x183));_0x51656f&&_0x51656f[_0xf6f19e(0x205)]&&(_0x5ba829=_0x51656f['value']),log(_0xf6f19e(0x18c)+_0x5ba829);}return tmdbApiObj=new movieInfoTmdbApi[(_0xf6f19e(0x19d))](workerData[_0xf6f19e(0x20b)],workerData['tmdb_api_language'],workerData[_0xf6f19e(0x15e)],_0x5ba829),tmdbApiObj;}function getProxyUrl(_0x3824ac){const _0x2d73e7=_0x11c434;let _0x3c0f18=dbConfigTable[_0x2d73e7(0x1c7)](_0x3824ac,'tmdbProxyEnable'),_0x507dfd=null;if(_0x3c0f18&&_0x3c0f18[_0x2d73e7(0x205)]==0x1){let _0x5b1ddb=dbConfigTable[_0x2d73e7(0x1c7)](_0x3824ac,_0x2d73e7(0x183));_0x5b1ddb&&_0x5b1ddb[_0x2d73e7(0x205)]&&(_0x507dfd=_0x5b1ddb[_0x2d73e7(0x205)]);}return _0x507dfd;}function downloadPoster(_0x1ed251,_0x2c3f18){return new Promise((_0x10cb74,_0x39f0fb)=>{fs['stat'](_0x1ed251,(_0x39e9f3,_0x50a86a)=>{const _0x515fe1=_0x306c;if(_0x39e9f3){console['log'](_0x515fe1(0x1fc),_0x2c3f18);let _0x38d442=getProxyUrl(dbOther),_0x12bc39=null;_0x38d442&&(_0x12bc39=new HttpsProxyAgent({'proxy':_0x38d442}));const _0x5ec7c0=new URL(_0x2c3f18);https[_0x515fe1(0x190)]({'hostname':_0x5ec7c0[_0x515fe1(0x1ae)],'port':_0x5ec7c0[_0x515fe1(0x171)]||0x1bb,'path':_0x5ec7c0[_0x515fe1(0x1a0)]+_0x5ec7c0[_0x515fe1(0x1dc)],'agent':_0x12bc39?_0x12bc39:![]},_0x2104a9=>{const _0x2bd4a5=_0x515fe1;if(_0x2104a9[_0x2bd4a5(0x1fd)]!==0xc8)return console[_0x2bd4a5(0x1c5)](_0x2bd4a5(0x194)+_0x2104a9[_0x2bd4a5(0x1fd)]),addScrapeLog(path[_0x2bd4a5(0x20e)](workerData[_0x2bd4a5(0x175)]),_0x2bd4a5(0x248),'',_0x1ed251,_0x2bd4a5(0x16d)),_0x10cb74('');let _0x14924b=_0x1ed251+_0x2bd4a5(0x172),_0x479d71=fs[_0x2bd4a5(0x16f)](_0x14924b);_0x2104a9[_0x2bd4a5(0x1c2)](_0x479d71),_0x479d71['on'](_0x2bd4a5(0x1e8),()=>{const _0x227e56=_0x2bd4a5;fs[_0x227e56(0x21b)](_0x14924b,_0x1ed251,_0x4bb95b=>{const _0x3de0ed=_0x227e56;if(_0x4bb95b)return _0x10cb74('');addScrapeLog(path[_0x3de0ed(0x20e)](workerData[_0x3de0ed(0x175)]),_0x3de0ed(0x248),'',_0x1ed251,_0x3de0ed(0x1b2)),_0x10cb74(_0x1ed251);});}),_0x479d71['on'](_0x2bd4a5(0x1c5),_0x21e4e2=>{const _0xd332e3=_0x2bd4a5;console[_0xd332e3(0x206)](_0x21e4e2),addScrapeLog(path[_0xd332e3(0x20e)](workerData[_0xd332e3(0x175)]),_0xd332e3(0x248),'',_0x1ed251,_0xd332e3(0x16d)),_0x10cb74('');}),_0x479d71['on']('close',()=>{});})['on']('error',_0x2ce33d=>{_0x10cb74('');});}else _0x10cb74(_0x1ed251);});});}function downloadPosterAndSaveNfo(_0x270f49,_0x1a4461,_0x46e4f7,_0x1b8526,_0x47797b,_0x23a563,_0x177131){return new Promise((_0x431f47,_0x5d9327)=>{const _0x2f96eb=_0x306c;let _0x18c2c5=[];_0x1a4461&&_0x270f49&&(!_0x177131||_0x177131&&!fs[_0x2f96eb(0x178)](_0x270f49)?_0x18c2c5[_0x2f96eb(0x1d6)](downloadPoster(_0x270f49,_0x1a4461)):log('跳过保存海报:'+_0x270f49)),_0x46e4f7&&_0x1b8526&&(!_0x177131||_0x177131&&!fs['existsSync'](_0x1b8526)?(console[_0x2f96eb(0x206)](_0x2f96eb(0x15d),_0x1b8526,_0x177131),addScrapeLog(path[_0x2f96eb(0x20e)](workerData[_0x2f96eb(0x175)]),'NFO',_0x1b8526,'','SUCCESS'),_0x18c2c5[_0x2f96eb(0x1d6)](nfoUtil['saveNfoFile'](_0x46e4f7,_0x1b8526,_0x47797b))):log(_0x2f96eb(0x1ab)+_0x1b8526)),_0x46e4f7[_0x2f96eb(0x199)]&&_0x23a563&&(!_0x177131||_0x177131&&!fs[_0x2f96eb(0x178)](_0x23a563)?(log(_0x2f96eb(0x239)+_0x23a563),_0x18c2c5[_0x2f96eb(0x1d6)](downloadPoster(_0x23a563,_0x46e4f7[_0x2f96eb(0x199)]))):log('跳过保存fanart:'+_0x23a563)),Promise['allSettled'](_0x18c2c5)[_0x2f96eb(0x1dd)](_0x2121a5=>{_0x431f47();});});}function saveEpisodeInfo(_0x4b422e,_0x9b2e82,_0x1aa1a2,_0x56d67b,_0x1d5ee3){return new Promise((_0x333d16,_0x396e9e)=>{const _0x44e07d=_0x306c;if(!mediaTypeConfig[_0x44e07d(0x19f)][_0x44e07d(0x1bd)](path[_0x44e07d(0x1d0)](_0x1aa1a2)[_0x44e07d(0x1a4)]()))return log(_0x44e07d(0x207)+_0x1aa1a2),_0x333d16();if(!_0x9b2e82[_0x44e07d(0x22e)]||_0x9b2e82[_0x44e07d(0x22e)][_0x44e07d(0x182)]<0x1)return log(_0x44e07d(0x1d1)),_0x333d16();let _0x1bb626;for(let _0x223eb8 of _0x9b2e82['episodes']){if(_0x223eb8[_0x44e07d(0x1af)]==_0x56d67b){_0x1bb626=_0x223eb8;break;}}if(!_0x1bb626)return log(_0x44e07d(0x162)+_0x56d67b),_0x333d16();_0x9b2e82[_0x44e07d(0x192)]&&(_0x1bb626[_0x44e07d(0x220)]=_0x9b2e82[_0x44e07d(0x192)]);_0x1bb626[_0x44e07d(0x163)]=_0x56d67b;let {dir:_0x28395f,name:_0x1dba6a}=path['parse'](path[_0x44e07d(0x20e)](_0x4b422e,_0x1aa1a2)),_0x1555f7=path[_0x44e07d(0x20e)](_0x28395f,_0x1dba6a)+_0x44e07d(0x18a),_0x4fbeb6=path[_0x44e07d(0x20e)](_0x28395f,_0x1dba6a)+'.nfo';downloadPosterAndSaveNfo(_0x1555f7,_0x1bb626[_0x44e07d(0x185)],_0x1bb626,_0x4fbeb6,_0x44e07d(0x19b),null,_0x1d5ee3)['then'](_0x475319=>{_0x333d16();});});}function detectIsMissingEpisodeInfo(_0x3ab8c4){const _0x207c97=_0x11c434;let _0x17f019=fs[_0x207c97(0x1c6)](_0x3ab8c4),_0x473ecb=![];for(let _0x2d7370 of _0x17f019){let _0x51b34b=path[_0x207c97(0x1d0)](_0x2d7370)?path[_0x207c97(0x1d0)](_0x2d7370)['toLowerCase']():null;if(_0x51b34b&&config['videoTypeList']['includes'](_0x51b34b)){let _0xf873d7=_0x2d7370['substring'](0x0,_0x2d7370[_0x207c97(0x243)]('.')),_0x3660d0=path[_0x207c97(0x20e)](_0x3ab8c4,_0xf873d7+_0x207c97(0x1e5));if(!fs[_0x207c97(0x178)](_0x3660d0))return console['log']('缺失:'+_0x3660d0),_0x473ecb=!![],_0x473ecb;}}return _0x473ecb;}function saveSeasonInfo(_0x88fc92,_0x4539e4,_0x28ccae,_0x4362dd,_0x3fe2c8){return new Promise((_0x1f829e,_0x401ae5)=>{const _0x31c887=_0x306c;if(!_0x4539e4[_0x31c887(0x213)]||_0x4539e4[_0x31c887(0x213)][_0x31c887(0x182)]<0x1)return log(_0x31c887(0x195)),_0x1f829e();let _0x9d617f;for(let _0xe5cf4a of _0x4539e4[_0x31c887(0x213)]){log(_0x31c887(0x1ed)+_0xe5cf4a[_0x31c887(0x192)]);if(_0xe5cf4a[_0x31c887(0x192)]==_0x28ccae){_0x9d617f=_0xe5cf4a;break;}}if(!_0x9d617f)return log(_0x31c887(0x1ac)+_0x28ccae),_0x1f829e();let _0x1e9570,_0x405c60,_0x319e51,_0x4ee664;if(_0x4362dd){let _0xf75da9=_0x28ccae+'';if(_0x28ccae<0xa)_0xf75da9='0'+_0x28ccae;_0x1e9570=path[_0x31c887(0x20e)](path[_0x31c887(0x23c)](_0x88fc92),'season'+_0xf75da9+_0x31c887(0x211)),_0x319e51=path[_0x31c887(0x20e)](_0x88fc92,_0x31c887(0x186)),_0x4ee664=path['join'](path[_0x31c887(0x23c)](_0x88fc92),'fanart.jpg');}else _0x1e9570=path[_0x31c887(0x20e)](_0x88fc92,'poster.jpg'),_0x319e51=path[_0x31c887(0x20e)](_0x88fc92,_0x31c887(0x1b4)),_0x4ee664=path[_0x31c887(0x20e)](_0x88fc92,_0x31c887(0x1b6)),!_0x9d617f[_0x31c887(0x199)]&&(_0x9d617f[_0x31c887(0x199)]=_0x4539e4[_0x31c887(0x199)]);!_0x9d617f['cover_url']&&(_0x9d617f[_0x31c887(0x185)]=_0x4539e4[_0x31c887(0x185)]),_0x9d617f[_0x31c887(0x220)]=_0x28ccae,_0x4539e4[_0x31c887(0x1a6)]&&_0x9d617f[_0x31c887(0x1a6)]&&(_0x9d617f[_0x31c887(0x22d)]=_0x4539e4[_0x31c887(0x1a6)]+'\x20'+_0x9d617f[_0x31c887(0x1a6)],_0x9d617f[_0x31c887(0x1a6)]=_0x9d617f[_0x31c887(0x22d)]),_0x4539e4[_0x31c887(0x1c4)]&&!_0x9d617f['actors']&&(_0x9d617f[_0x31c887(0x1c4)]=_0x4539e4[_0x31c887(0x1c4)]),_0x4539e4['actorsOriginal']&&!_0x9d617f['actorsOriginal']&&(_0x9d617f[_0x31c887(0x1fa)]=_0x4539e4['actorsOriginal']),_0x4539e4[_0x31c887(0x1ff)]&&!_0x9d617f[_0x31c887(0x1ff)]&&(_0x9d617f[_0x31c887(0x1ff)]=_0x4539e4[_0x31c887(0x1ff)]),_0x4539e4[_0x31c887(0x1ad)]&&!_0x9d617f[_0x31c887(0x1ad)]&&(_0x9d617f[_0x31c887(0x1ad)]=_0x4539e4['directorsOriginal']),_0x4539e4[_0x31c887(0x1aa)]&&!_0x9d617f['creator']&&(_0x9d617f['creator']=_0x4539e4[_0x31c887(0x1aa)]),_0x4539e4[_0x31c887(0x20a)]&&!_0x9d617f[_0x31c887(0x20a)]&&(_0x9d617f[_0x31c887(0x20a)]=_0x4539e4[_0x31c887(0x20a)]),_0x4539e4[_0x31c887(0x177)]&&!_0x9d617f[_0x31c887(0x177)]&&(_0x9d617f[_0x31c887(0x177)]=_0x4539e4[_0x31c887(0x177)]),_0x4539e4['genres']&&!_0x9d617f[_0x31c887(0x20c)]&&(_0x9d617f[_0x31c887(0x20c)]=_0x4539e4['genres']),_0x4539e4[_0x31c887(0x156)]&&!_0x9d617f[_0x31c887(0x156)]&&(_0x9d617f[_0x31c887(0x156)]=_0x4539e4[_0x31c887(0x156)]),_0x4539e4[_0x31c887(0x1e4)]&&(_0x9d617f['tmdb_id']=_0x4539e4['tmdb_id']),downloadPosterAndSaveNfo(_0x1e9570,_0x9d617f[_0x31c887(0x185)],_0x9d617f,_0x319e51,_0x31c887(0x200),_0x4ee664,_0x3fe2c8)['then'](_0x463401=>{const _0x1f29ec=_0x31c887;log(_0x1f29ec(0x1a1));if(!_0x4539e4[_0x1f29ec(0x1e4)])return _0x1f829e();if(_0x3fe2c8&&!detectIsMissingEpisodeInfo(_0x88fc92))return log('跳过不缺失任何信息的季'),_0x1f829e();let _0xd3365e=getTmdbApi();_0xd3365e[_0x1f29ec(0x1a8)](_0x4539e4[_0x1f29ec(0x1e4)],_0x28ccae)[_0x1f29ec(0x1dd)](_0x503a8b=>{const _0x444f72=_0x1f29ec;log(_0x444f72(0x16e)),fs['readdir'](_0x88fc92,(_0x3c703d,_0x5d4989)=>{const _0x5b6b93=_0x444f72;if(_0x3c703d)return _0x1f829e();let _0x536210=[];for(let _0x345292 of _0x5d4989){try{let _0x441c37=path['join'](_0x88fc92,_0x345292),_0x5df4e3=fs['statSync'](_0x441c37);if(_0x5df4e3[_0x5b6b93(0x234)]()){let _0x21beb6=movieSeasonUtil[_0x5b6b93(0x1d3)](_0x345292);_0x21beb6&&_0x21beb6[_0x5b6b93(0x163)]&&_0x21beb6[_0x5b6b93(0x163)]>0x0&&_0x536210[_0x5b6b93(0x1d6)](saveEpisodeInfo(_0x88fc92,_0x503a8b,_0x345292,_0x21beb6[_0x5b6b93(0x163)],_0x3fe2c8));}}catch(_0x4b861a){log(_0x4b861a);continue;}}Promise[_0x5b6b93(0x1cc)](_0x536210)['then'](_0xd05868=>{_0x1f829e();});});})[_0x1f29ec(0x1be)](_0x7a102e=>{const _0x1cb9b9=_0x1f29ec;return log(_0x7a102e),addScrapeLog(path[_0x1cb9b9(0x20e)](workerData[_0x1cb9b9(0x175)]),_0x1cb9b9(0x1de),'','','FAIL',_0x7a102e[_0x1cb9b9(0x237)]?_0x7a102e[_0x1cb9b9(0x237)]:'ERROR'),_0x1f829e();});});});}function onSearchFinish(_0x5176cf,_0x12a3de,_0x50f976){return new Promise((_0x411cd9,_0x494591)=>{const _0x270ef3=_0x306c;let _0x1421c3=path[_0x270ef3(0x20e)](_0x5176cf[_0x270ef3(0x175)],_0x5176cf['filename']),_0x19dc51=_0x5176cf[_0x270ef3(0x218)]==0x1,_0x22201e=getTmdbApi();_0x22201e[_0x270ef3(0x1f0)](_0x12a3de,_0x19dc51)[_0x270ef3(0x1dd)](_0x1f5aa8=>{const _0x1e605c=_0x270ef3;if(!_0x19dc51){let {dir:_0x10c5a5,name:_0x46b8d0}=path[_0x1e605c(0x169)](_0x1421c3),_0x1819ea=path[_0x1e605c(0x20e)](_0x10c5a5,_0x46b8d0+_0x1e605c(0x18a)),_0x350cc4=_0x1f5aa8[_0x1e605c(0x185)],_0x2e37a2=path['join'](_0x10c5a5,_0x46b8d0+_0x1e605c(0x1e5)),_0x18a1ff=path[_0x1e605c(0x20e)](_0x10c5a5,_0x46b8d0+_0x1e605c(0x1c3));downloadPosterAndSaveNfo(_0x1819ea,_0x350cc4,_0x1f5aa8,_0x2e37a2,_0x1e605c(0x23a),_0x18a1ff,_0x50f976)[_0x1e605c(0x1dd)](_0x1c2331=>{const _0x40a953=_0x1e605c;return log(_0x40a953(0x165)),_0x411cd9();});}else{let _0x3c3367=movieSeasonUtil[_0x1e605c(0x240)](path['basename'](_0x5176cf[_0x1e605c(0x175)]));if(_0x3c3367>-0x1){log('符合三级命名规则:'+_0x1421c3);let {dir:_0x4d2ce8,name:_0x5bf05e}=path[_0x1e605c(0x169)](_0x1421c3),_0x183c1d=path[_0x1e605c(0x20e)](path[_0x1e605c(0x23c)](_0x4d2ce8),_0x1e605c(0x1e0)),_0x2073b2=path[_0x1e605c(0x20e)](path['dirname'](_0x4d2ce8),'fanart.jpg'),_0x2bfba3=path[_0x1e605c(0x20e)](path['dirname'](_0x4d2ce8),_0x1e605c(0x1b4));downloadPosterAndSaveNfo(_0x183c1d,_0x1f5aa8['cover_url'],_0x1f5aa8,_0x2bfba3,_0x1e605c(0x200),_0x2073b2,_0x50f976)[_0x1e605c(0x1dd)](_0x2ff469=>{const _0x18fbf4=_0x1e605c;log('整部剧的海报和nfo保存完毕'),fs[_0x18fbf4(0x21a)](path[_0x18fbf4(0x23c)](_0x4d2ce8),(_0x444a6a,_0xa581)=>{const _0x44a0a3=_0x18fbf4;if(_0x444a6a)return _0x411cd9();let _0x84ea65=[];for(let _0x314339 of _0xa581){try{let _0x5bbc31=path[_0x44a0a3(0x20e)](path[_0x44a0a3(0x23c)](_0x4d2ce8),_0x314339),_0x3f6947=fs[_0x44a0a3(0x1f3)](_0x5bbc31);if(_0x3f6947[_0x44a0a3(0x235)]()){let _0x2a8c15=movieSeasonUtil[_0x44a0a3(0x240)](_0x314339);_0x2a8c15>-0x1&&_0x84ea65[_0x44a0a3(0x1d6)](saveSeasonInfo(_0x5bbc31,_0x1f5aa8,_0x2a8c15,!![],_0x50f976));}}catch(_0x3d505c){log(_0x3d505c);continue;}}Promise[_0x44a0a3(0x1cc)](_0x84ea65)['then'](_0x26b48e=>{_0x411cd9();});});});}else{log('不符合三级命名规则:'+_0x1421c3);let _0x351f96=movieSeasonUtil[_0x1e605c(0x240)](path[_0x1e605c(0x208)](_0x5176cf[_0x1e605c(0x175)]),![]);if(_0x351f96>-0x1)saveSeasonInfo(path[_0x1e605c(0x23c)](_0x1421c3),_0x1f5aa8,_0x351f96,![],_0x50f976)[_0x1e605c(0x1dd)](_0x3d165c=>{_0x411cd9();});else{let _0x3b62fc=movieSeasonUtil[_0x1e605c(0x1d3)](_0x1421c3);_0x3b62fc&&_0x3b62fc['season']&&_0x3b62fc[_0x1e605c(0x220)]>0x0?saveSeasonInfo(path['dirname'](_0x1421c3),_0x1f5aa8,_0x3b62fc['season'],![],_0x50f976)['then'](_0x1c1bd6=>{_0x411cd9();}):(log(_0x1e605c(0x212)),saveSeasonInfo(path['dirname'](_0x1421c3),_0x1f5aa8,0x1,![],_0x50f976)[_0x1e605c(0x1dd)](_0x807c13=>{_0x411cd9();}));}}}})[_0x270ef3(0x1be)](_0x1fe760=>{const _0x7e81cf=_0x270ef3;return log(_0x1fe760),addScrapeLog(path[_0x7e81cf(0x20e)](workerData[_0x7e81cf(0x175)]),_0x7e81cf(0x1db),'','',_0x7e81cf(0x16d),_0x1fe760[_0x7e81cf(0x237)]?_0x1fe760['status_message']:_0x7e81cf(0x229)),_0x411cd9();});});}function _0x5b5a(){const _0x1d1a4c=['5audio','dirname','信息不足\x20无法搜索\x20退出worker','rmvb','atmos-swtyblz','getSeasonNumber','tmdbid','VID','lastIndexOf','265-apex','要查询的数据不存在','4XiUYzr','../utils/i18nUtil','POSTER','hds','../myConfig/mediaType','regions','IMG_','substr','internal','../utils/movieSeasonUtil','846MshPav','2851125wxgEQW','nfo不存在,开始保存','tmdb_api_url','better-sqlite3','bhd','brrip','没有找到要保存的集信息\x20对应号码:','episode','keys','电影的海报和nfo保存完毕','4audios','axios','3541050Gpmcli','parse','beitai','../db/dbConfigTable','hd1080p','FAIL','开始保存每一集的信息','createWriteStream','刮削任务结束','port','.tmp','chs-eng','web','path','startsWith','guestActorsOriginal','existsSync','dts-hd','nexusnf','720p','5audios','mkv','阳光电影','fast-xml-parser','fgt','web-dl','length','tmdbProxyUrl','4ktrash','cover_url','season.nfo','cmct','trim','vid_','.jpg','bluray','Search\x20Worker:Tmdb代理已经开启','6375628bcekNb','ultra-hd','remux','get','test','season_number','dbFileIndex','请求失败:\x20HTTP\x20','seriesInfo没找到季信息','remastered','ultrahd','journal_mode\x20=\x20WAL','backdrop_url','tmdbidNotFound','episodedetails','mp4','API','pragma','videoTypeList','pathname','season海报和nfo保存完毕','7.1','filename','toLowerCase','0000','movie_name','TMDB\x20search接口请求失败','getSeasonDetail','h264','creator','跳过保存NFO:','没有找到要保存的季信息\x20对应号码:','directorsOriginal','hostname','episode_number','8bit','ac3','SUCCESS','hdr','tvshow.nfo','电影天堂','fanart.jpg','dts','3audios','truehd','prepare','now','x260bit','includes','catch','tmdb.没有获取到相关信息','hdwing','postMessage','pipe','-fanart.jpg','actors','error','readdirSync','findByTitle','x265-dvsux','VID_','142048rEfOKk','worker_threads','allSettled','dvd','2audios','x264','extname','seasonInfo没找到每一集的信息','687WjsPMr','extractEpisodeNumbers','every','exit','push','高清晰版','IMG','replace','根据TMDBID搜索','API_DETAIL','search','then','API_SEASON_DETAIL','dvsux','poster.jpg','7audio','getI18n','img_','tmdb_id','.nfo','hpagent','3audio','finish','surcode','信息获取完毕','atmos','dbOther','season.season_number:','中文字幕','atmos-iamable','getDetail','x265','https','statSync','atmos-coaster','scrapeMissing','iamable','1803343MJFpOp','日语中字','bd1080p','actorsOriginal','dolby-multi-bodhmall','开始下载','statusCode','../utils/movieInfoTmdbApi','directors','tvshow','blue-ray','2160p','9722WKcIyj','dts-ift','value','log','跳过非视频文件:','basename','tmdbId','creatorOriginal','tmdb_api_key','genres','sdr','join','240p','toLocaleLowerCase','-poster.jpg','没有季信息\x20默认使用第一季','seasons','rargb','url','noSearchResult','英语中字','is_tvplay','../utils/nfoUtil','readdir','rename','hevc','stringify','readFileSync','coaster','season','6audios','高清版','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','10bit','24410620dTJItP','西语中字','480p','x265-terminal','ERROR','year','run','STREAM','showtitle','episodes','some','bd720p','title','1080p','uhd','isFile','isDirectory','h265','status_message','bdrip','下载fanart:','movie'];_0x5b5a=function(){return _0x1d1a4c;};return _0x5b5a();}function addScrapeLog(_0x301201,_0x67698c,_0xa1f13e,_0x4d6ac2,_0x4909d6,_0x23b7e3){const _0x1003ba=_0x11c434;dbFileIndex[_0x1003ba(0x1ba)]('INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)')[_0x1003ba(0x22b)](_0x301201,_0x67698c,_0xa1f13e,_0x4d6ac2,_0x4909d6,_0x23b7e3,Date[_0x1003ba(0x1bb)]());}function _0x306c(_0x116936,_0x1f9aac){const _0x5b5a99=_0x5b5a();return _0x306c=function(_0x306cee,_0x128bd7){_0x306cee=_0x306cee-0x156;let _0x2b2b45=_0x5b5a99[_0x306cee];return _0x2b2b45;},_0x306c(_0x116936,_0x1f9aac);}function getTvExistTmdbId(_0x106da4){const _0x55aff6=_0x11c434;if(_0x106da4[_0x55aff6(0x218)]!=0x1)return null;let _0x21ab86=path[_0x55aff6(0x23c)](_0x106da4[_0x55aff6(0x175)]),_0x5899c8=movieSeasonUtil['getSeasonNumber'](path[_0x55aff6(0x208)](_0x106da4[_0x55aff6(0x175)]),!![]),_0x228fb3=null,_0x1db21f='';_0x5899c8>-0x1&&(_0x1db21f=path['join'](_0x21ab86,'tvshow.nfo'));(!_0x1db21f||!fs[_0x55aff6(0x178)](_0x1db21f))&&(_0x1db21f=path['join'](_0x106da4[_0x55aff6(0x175)],'tvshow.nfo'));if(!_0x1db21f||!fs[_0x55aff6(0x178)](_0x1db21f))return null;const _0x2e959d=new XMLParser();let _0x4d3bfa=_0x2e959d['parse'](fs[_0x55aff6(0x21e)](_0x1db21f));return _0x4d3bfa[_0x55aff6(0x200)]&&(_0x4d3bfa=_0x4d3bfa[_0x55aff6(0x200)],_0x4d3bfa[_0x55aff6(0x241)]&&(_0x228fb3=_0x4d3bfa[_0x55aff6(0x241)])),{'tmdbId':_0x228fb3,'seassonNumber':_0x5899c8};}function searchMovieInfo(_0x140435,_0x25b2da){const _0x34f999=_0x11c434;return!_0x25b2da&&(_0x25b2da=getQueryArray(_0x140435)),log(JSON[_0x34f999(0x21d)](_0x25b2da)),new Promise((_0x505342,_0x1c527d)=>{const _0x4409b6=_0x34f999;function _0x18b16f(){return _0x1c527d();}if(!_0x25b2da||_0x25b2da[_0x4409b6(0x182)]<0x1)return log(_0x4409b6(0x245)),_0x18b16f();let _0x5f131e=_0x25b2da[0x0][_0x4409b6(0x231)],_0x1ce485=_0x25b2da[0x0][_0x4409b6(0x22a)];log('Matching\x20movie\x20information\x20',_0x5f131e[_0x4409b6(0x231)]);let _0x4b5e40=getTmdbApi();if(!_0x4b5e40)return log(_0x4409b6(0x223)),_0x18b16f();let _0x3b7494=_0x140435['is_tvplay']==0x1;_0x4b5e40[_0x4409b6(0x1dc)](_0x5f131e,_0x3b7494,_0x1ce485)[_0x4409b6(0x1dd)](_0x2caecd=>{const _0x4ae26e=_0x4409b6;if(_0x2caecd&&_0x2caecd[_0x4ae26e(0x182)]>0x0){let _0x295d78=_0x2caecd[0x0];onSearchFinish(_0x140435,_0x295d78[_0x4ae26e(0x1e4)])[_0x4ae26e(0x1dd)](()=>{return _0x505342();});}else{if(_0x25b2da[_0x4ae26e(0x182)]>0x1){let _0x1d7550=_0x25b2da['splice'](0x1);return searchMovieInfo(_0x140435,_0x1d7550)[_0x4ae26e(0x1dd)](_0x505342);}else return log(_0x4ae26e(0x1bf),_0x5f131e),addScrapeLog(path['join'](workerData[_0x4ae26e(0x175)]),_0x4ae26e(0x1db),'','',_0x4ae26e(0x16d),i18n['__'](_0x4ae26e(0x216))),_0x18b16f();}})['catch'](_0x4b64a2=>{const _0x10124c=_0x4409b6;return log(_0x10124c(0x1a7),_0x4b64a2),_0x18b16f();});});}function returnResult(){const _0x5052c3=_0x11c434;log(_0x5052c3(0x170)),parentPort[_0x5052c3(0x1c1)]({'code':0x0}),process[_0x5052c3(0x1d5)](0x0);}function log(_0x1a30af){const _0x189d02=_0x11c434;parentPort[_0x189d02(0x1c1)]({'type':_0x189d02(0x206),'message':_0x1a30af});}if(workerData&&workerData[_0x11c434(0x1a3)]&&workerData[_0x11c434(0x175)]&&workerData['tmdb_api_language']&&workerData[_0x11c434(0x20b)]&&workerData[_0x11c434(0x15e)]){if(workerData[_0x11c434(0x1e4)])log(_0x11c434(0x1da)),onSearchFinish(workerData,workerData[_0x11c434(0x1e4)])[_0x11c434(0x1dd)](_0x44b37d=>{const _0x16119d=_0x11c434;log(_0x16119d(0x1ea),workerData[_0x16119d(0x1e4)],workerData[_0x16119d(0x175)],workerData['filename']),returnResult();})[_0x11c434(0x1be)](_0x241c81=>{returnResult();});else{if(workerData[_0x11c434(0x1f5)]==0x1){log('根据已有NFO刮削缺失集');let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId[_0x11c434(0x209)]){addScrapeLog(path['join'](workerData['path']),'SCRAPE_MISSING','','',_0x11c434(0x16d),i18n['__'](_0x11c434(0x19a)));return;}let tmdbId=foundTmdbId[_0x11c434(0x209)];onSearchFinish(workerData,tmdbId,!![])[_0x11c434(0x1dd)](_0x17873b=>{const _0x5db7fd=_0x11c434;log(_0x5db7fd(0x1ea)),returnResult();})['catch'](_0x407e5e=>{returnResult();});}else log('根据文件名和路径搜索'),searchMovieInfo(workerData)[_0x11c434(0x1dd)](_0x271ee1=>{const _0x5920f7=_0x11c434;log('信息获取完毕'+workerData[_0x5920f7(0x175)]+'\x20'+workerData[_0x5920f7(0x1a3)]),returnResult();})[_0x11c434(0x1be)](_0x2b9783=>{returnResult();});}}else log(_0x11c434(0x23d)),returnResult();