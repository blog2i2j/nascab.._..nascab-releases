const _0x50dd80=_0x933b;(function(_0x3876ce,_0x2ec8e3){const _0x28332e=_0x933b,_0x45905a=_0x3876ce();while(!![]){try{const _0x35bdc4=parseInt(_0x28332e(0x17f))/0x1*(-parseInt(_0x28332e(0x145))/0x2)+parseInt(_0x28332e(0x1a1))/0x3+-parseInt(_0x28332e(0x1cc))/0x4+parseInt(_0x28332e(0x1b0))/0x5+-parseInt(_0x28332e(0x197))/0x6+-parseInt(_0x28332e(0x14e))/0x7+parseInt(_0x28332e(0x1e1))/0x8;if(_0x35bdc4===_0x2ec8e3)break;else _0x45905a['push'](_0x45905a['shift']());}catch(_0x4dacd5){_0x45905a['push'](_0x45905a['shift']());}}}(_0x3b68,0x78d07));const {XMLParser,XMLBuilder}=require('fast-xml-parser'),path=require(_0x50dd80(0x19b));let axios=require(_0x50dd80(0x114));const {HttpsProxyAgent}=require(_0x50dd80(0x1cb)),https=require(_0x50dd80(0x179)),{URL}=require(_0x50dd80(0x14f)),fs=require('fs'),movieSeasonUtil=require('../utils/movieSeasonUtil'),mediaTypeConfig=require(_0x50dd80(0x11c)),{parentPort,workerData}=require(_0x50dd80(0x185)),movieInfoTmdbApi=require(_0x50dd80(0x151)),dbConfigTable=require(_0x50dd80(0x1c3)),nfoUtil=require(_0x50dd80(0x1e5)),Database=require(_0x50dd80(0x15a)),config=require(_0x50dd80(0x171)),dbFileIndex=new Database(config[_0x50dd80(0x125)],{'timeout':0xea60});dbFileIndex['pragma'](_0x50dd80(0x1af));let dbOther=new Database(config[_0x50dd80(0x1a6)],{});dbOther[_0x50dd80(0x135)](_0x50dd80(0x1af));let i18nUtil=require('../utils/i18nUtil');i18n=i18nUtil['getI18n'](dbOther);let excludeList=[_0x50dd80(0x12f),_0x50dd80(0x1db),'2160p',_0x50dd80(0x1d2),_0x50dd80(0x1dc),'1080p',_0x50dd80(0x13a),_0x50dd80(0x112),_0x50dd80(0x16d),_0x50dd80(0x1b9),_0x50dd80(0x199),'web','nexusnf','x265-terminal',_0x50dd80(0x187),_0x50dd80(0x1c6),_0x50dd80(0x116),_0x50dd80(0x1e8),_0x50dd80(0x146),_0x50dd80(0x162),_0x50dd80(0x1ca),_0x50dd80(0x160),_0x50dd80(0x180),_0x50dd80(0x15c),_0x50dd80(0x1d5),_0x50dd80(0x17d),_0x50dd80(0x19f),'hevc','remastered',_0x50dd80(0x18a),_0x50dd80(0x141),_0x50dd80(0x1b7),_0x50dd80(0x174),_0x50dd80(0x18c),'8bit',_0x50dd80(0x122),'hdr10',_0x50dd80(0x18e),'hd',_0x50dd80(0x1c2),_0x50dd80(0x117),_0x50dd80(0x1ef),'rargb',_0x50dd80(0x167),_0x50dd80(0x12e),_0x50dd80(0x110),_0x50dd80(0x13d),'ma',_0x50dd80(0x1ed),'dv',_0x50dd80(0x118),_0x50dd80(0x191),_0x50dd80(0x136),_0x50dd80(0x1b7),_0x50dd80(0x19c),'x265-dvsux',_0x50dd80(0x1d4),_0x50dd80(0x1e2),_0x50dd80(0x190),_0x50dd80(0x1a0),_0x50dd80(0x1be),'atmos-iamable',_0x50dd80(0x1a8),_0x50dd80(0x1e0),'nahom',_0x50dd80(0x16b),_0x50dd80(0x1b8),_0x50dd80(0x173),'uhd',_0x50dd80(0x155),'remux',_0x50dd80(0x1c4),_0x50dd80(0x11f),_0x50dd80(0x148),_0x50dd80(0x1b3),_0x50dd80(0x175),'h264','h265',_0x50dd80(0x193),_0x50dd80(0x1ee),'rmvb','rm',_0x50dd80(0x12b),'3gp',_0x50dd80(0x1d3),_0x50dd80(0x129),'2audios','aac',_0x50dd80(0x12d),_0x50dd80(0x14a),'ac3',_0x50dd80(0x15f),_0x50dd80(0x196),_0x50dd80(0x1d9),_0x50dd80(0x131),'高清晰版',_0x50dd80(0x1e9),_0x50dd80(0x1c9),_0x50dd80(0x12a),_0x50dd80(0x120),'dl','-','中文字幕',_0x50dd80(0x1d9),_0x50dd80(0x144),_0x50dd80(0x109),_0x50dd80(0x1a7)];function isObjectInQueryArray(_0x4688c3,_0x13cef0){const _0x328fed=_0x50dd80;return _0x4688c3[_0x328fed(0x14d)](function(_0x1a0ae3){const _0x676fdf=_0x328fed,_0x33bc7f=Object[_0x676fdf(0x1d8)](_0x13cef0);return _0x33bc7f[_0x676fdf(0x19d)](_0x40672c=>_0x1a0ae3[_0x40672c]===_0x13cef0[_0x40672c]);});}function getQueryArray(_0x5c5962){const _0x30fa40=_0x50dd80;let _0x450a82=[];if(!_0x5c5962||!_0x5c5962[_0x30fa40(0x126)])return[];let _0x382257=_0x5c5962[_0x30fa40(0x126)][_0x30fa40(0x10a)]();if(!_0x382257||_0x382257['length']<0x2)return[];function _0x323480(_0x175b95,_0x3dc00c){const _0x1a1f1b=_0x30fa40;let _0xa33a19={'title':_0x175b95,'year':_0x3dc00c};_0x175b95!='STREAM'&&!isObjectInQueryArray(_0x450a82,_0xa33a19)&&_0x450a82[_0x1a1f1b(0x17e)](_0xa33a19);}function _0x5347fd(_0x2a1dd1){const _0x413dca=_0x30fa40;let _0x5ad47a=path[_0x413dca(0x177)](_0x2a1dd1);_0x5ad47a&&(_0x2a1dd1=_0x2a1dd1['replace'](_0x5ad47a,''));if(/^[0-9]*$/[_0x413dca(0x123)](_0x2a1dd1)&&_0x2a1dd1!=_0x413dca(0x143)&&!_0x2a1dd1['startsWith'](_0x413dca(0x1ba)))return[];if(_0x2a1dd1[_0x413dca(0x181)](_0x413dca(0x16a))||_0x2a1dd1[_0x413dca(0x181)](_0x413dca(0x152))||_0x2a1dd1[_0x413dca(0x181)]('VID')||_0x2a1dd1[_0x413dca(0x181)]('vid')||_0x2a1dd1[_0x413dca(0x181)](_0x413dca(0x115))||_0x2a1dd1[_0x413dca(0x181)]('vid_')||_0x2a1dd1[_0x413dca(0x181)]('IMG'))return[];_0x2a1dd1[_0x2a1dd1[_0x413dca(0x184)]-0x1]=='.'&&(_0x2a1dd1=_0x2a1dd1[_0x413dca(0x14b)](0x0,_0x2a1dd1['length']-0x1));_0x2a1dd1=_0x2a1dd1[_0x413dca(0x1ae)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x413dca(0x1ae)]('5.1','')['replace']('7.1',''),_0x2a1dd1=_0x2a1dd1['replace'](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')['replace'](/[ ]+/gi,'\x20');let _0x367bfc=_0x2a1dd1[_0x413dca(0x164)]('\x20'),_0x4d0726=[],_0x1fd8a6=null;for(let _0x149066 in _0x367bfc){let _0x401f6f=_0x367bfc[_0x149066][_0x413dca(0x13b)]();if(excludeList['includes'](_0x401f6f))continue;if(isNumber(_0x401f6f)){if(parseInt(_0x401f6f)>0x767&&parseInt(_0x401f6f)<0x834){_0x1fd8a6=_0x401f6f;continue;}}_0x4d0726[_0x413dca(0x17e)](_0x401f6f);}for(let _0x23e117=_0x4d0726['length'];_0x23e117>=0x0;_0x23e117--){let _0x559733=_0x4d0726[_0x413dca(0x11b)]('\x20')['trim']();_0x559733&&(_0x1fd8a6&&_0x323480(_0x559733,_0x1fd8a6),_0x323480(_0x559733)),_0x4d0726[_0x413dca(0x14c)](_0x4d0726[_0x413dca(0x184)]-0x1,0x1);}}if(_0x5c5962[_0x30fa40(0x1dd)]==0x1)try{let _0x22851f=path[_0x30fa40(0x17a)](_0x5c5962[_0x30fa40(0x19b)])['toLocaleLowerCase'](),_0x28c886=movieSeasonUtil['getSeasonNumber'](_0x22851f);if(_0x28c886>-0x1){let _0x5f0687=path['basename'](path['dirname'](_0x5c5962['path']))[_0x30fa40(0x142)]();_0x5f0687&&_0x5347fd(_0x5f0687);}else _0x5347fd(_0x22851f);}catch(_0x1c8356){console[_0x30fa40(0x1c5)](_0x1c8356);}const _0x1655b4=_0x382257['replace'](/s\d{1,2}e\d{1,2}/g,'');return _0x5347fd(_0x1655b4),_0x450a82;}function isNumber(_0x5446ae){return/^-?[\d.]+(?:e-?\d+)?$/['test'](_0x5446ae);}function getTmdbApi(){const _0x459b80=_0x50dd80;let _0x20b93c=dbConfigTable[_0x459b80(0x1a4)](dbOther,_0x459b80(0x18f)),_0x4408f7=null;if(_0x20b93c&&_0x20b93c[_0x459b80(0x16e)]==0x1){let _0x14f839=dbConfigTable[_0x459b80(0x1a4)](dbOther,_0x459b80(0x1bd));_0x14f839&&_0x14f839[_0x459b80(0x16e)]&&(_0x4408f7=_0x14f839['value']),log(_0x459b80(0x130)+_0x4408f7);}return tmdbApiObj=new movieInfoTmdbApi['API'](workerData[_0x459b80(0x16c)],workerData['tmdb_api_language'],workerData[_0x459b80(0x168)],_0x4408f7),tmdbApiObj;}function getProxyUrl(_0x361853){const _0xd38f4f=_0x50dd80;let _0x3a6189=dbConfigTable[_0xd38f4f(0x1a4)](_0x361853,_0xd38f4f(0x18f)),_0x47b954=null;if(_0x3a6189&&_0x3a6189['value']==0x1){let _0x41b651=dbConfigTable['findByTitle'](_0x361853,_0xd38f4f(0x1bd));_0x41b651&&_0x41b651[_0xd38f4f(0x16e)]&&(_0x47b954=_0x41b651['value']);}return _0x47b954;}function _0x3b68(){const _0xe53d2=['dts','日语中字','toLowerCase','readdirSync','regions','根据TMDBID搜索','saveNfoFile','缺失:','cmct','scrapeMissing','720p','finish','axios','VID_','4audio','dts-hd','ddp','信息不足\x20无法搜索\x20退出worker','then','join','../myConfig/mediaType','guestActorsOriginal','actorsOriginal','hdtv','beitai','get','sdr','test','postMessage','dbFileIndex','filename','backdrop_url','includes','tbs','西语中字','mov','statSync','dvd','iamable','阳光电影dygod.org','Search\x20Worker:Tmdb代理已经开启','阳光电影','episodes','tmdb.没有获取到相关信息','tmdbidNotFound','pragma','surcode','根据文件名和路径搜索','stringify','readFileSync','bd720p','trim','movie','coaster','allSettled','seasonInfo没找到每一集的信息','creator','hds','toLocaleLowerCase','1942','韩语中字','6978YHhLqW','5audio','showtitle','blue-ray','POSTER','chs-eng','substr','splice','some','82684suysXi','url','tmdbid','../utils/movieInfoTmdbApi','img_','Matching\x20movie\x20information\x20','不符合三级命名规则:','bdrip','dirname','SUCCESS','getSeasonDetail','season.nfo','better-sqlite3','status_message','5audios','跳过保存fanart:','刮削任务结束','dreamhd','3audios','pathname','6audio','要查询的数据不存在','split','existsSync','season','swtyblz','tmdb_api_url','creatorOriginal','IMG_','ita','tmdb_api_key','x264','value','episode','poster.jpg','../myConfig/config','seasons','atmos','truehd','ultra-hd','跳过非视频文件:','extname','getSeasonNumber','https','basename','根据已有NFO刮削缺失集','rename','7audios','push','97zYzPIe','4audios','startsWith','.jpg','season_number','length','worker_threads','noSearchResult','brrip','movie_name','没有找到要保存的集信息\x20对应号码:','internal','year','10bit','tvshow','hdr','tmdbProxyEnable','x260bit','cmrg','createWriteStream','mkv','.nfo','cover_url','高清版','2755494fKmMIN','stat','240p','error','path','web-dl','every','tmdb_api_language','cee','4ktrash','73578FAhHQU','episode_number','directors','findByTitle','hostname','dbOther','高清mp4电影','atmos-coaster','fanart.jpg','tvshow.nfo','没有找到要保存的季信息\x20对应号码:','电影的海报和nfo保存完毕','title','replace','journal_mode\x20=\x20WAL','698105nsdaHe','没有季信息\x20默认使用第一季','videoTypeList','ultrahd','catch','directorsOriginal','-fanart.jpg','fgt','265-apex','480p','0000','statusCode','readdir','tmdbProxyUrl','atmos-swtyblz','信息获取完毕','extractEpisodeNumbers','tmdbId','dts-ift','../db/dbConfigTable','bluray','log','3audio','genres','isDirectory','英文中字','7audio','hpagent','3445036lJlIpO','tmdb_id','isFile','actors','search','now','bd1080p','web','x265','6audios','FAIL','nfo不存在,开始保存','keys','电影天堂','跳过保存NFO:','dolby-multi-bodhmall','hd1080p','is_tvplay','API_DETAIL','下载fanart:','eng','16011688QxQaKM','dvsux','TMDB\x20search接口请求失败','parse','../utils/nfoUtil','开始下载','.tmp','hdwing','英语中字','pipe','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','ERROR','bhd','mp4'];_0x3b68=function(){return _0xe53d2;};return _0x3b68();}function downloadPoster(_0x561013,_0x1004f9){return new Promise((_0x583e4b,_0x3dc6a0)=>{const _0xe0d117=_0x933b;fs[_0xe0d117(0x198)](_0x561013,(_0x53e3f9,_0x36a62c)=>{const _0x5c8763=_0xe0d117;if(_0x53e3f9){console[_0x5c8763(0x1c5)](_0x5c8763(0x1e6),_0x1004f9);let _0x912649=getProxyUrl(dbOther),_0x21533d=null;_0x912649&&(_0x21533d=new HttpsProxyAgent({'proxy':_0x912649}));const _0x3eb33d=new URL(_0x1004f9);https[_0x5c8763(0x121)]({'hostname':_0x3eb33d[_0x5c8763(0x1a5)],'port':_0x3eb33d['port']||0x1bb,'path':_0x3eb33d[_0x5c8763(0x161)]+_0x3eb33d[_0x5c8763(0x1d0)],'agent':_0x21533d?_0x21533d:![]},_0xc7f6a0=>{const _0x49ba7e=_0x5c8763;if(_0xc7f6a0[_0x49ba7e(0x1bb)]!==0xc8)return console[_0x49ba7e(0x19a)]('请求失败:\x20HTTP\x20'+_0xc7f6a0['statusCode']),addScrapeLog(path[_0x49ba7e(0x11b)](workerData[_0x49ba7e(0x19b)]),_0x49ba7e(0x149),'',_0x561013,'FAIL'),_0x583e4b('');let _0x399e0c=_0x561013+_0x49ba7e(0x1e7),_0x2c2984=fs[_0x49ba7e(0x192)](_0x399e0c);_0xc7f6a0[_0x49ba7e(0x1ea)](_0x2c2984),_0x2c2984['on'](_0x49ba7e(0x113),()=>{const _0x44ae51=_0x49ba7e;fs[_0x44ae51(0x17c)](_0x399e0c,_0x561013,_0x2d237b=>{const _0x177d64=_0x44ae51;if(_0x2d237b)return _0x583e4b('');addScrapeLog(path['join'](workerData[_0x177d64(0x19b)]),_0x177d64(0x149),'',_0x561013,_0x177d64(0x157)),_0x583e4b(_0x561013);});}),_0x2c2984['on'](_0x49ba7e(0x19a),_0x200d23=>{const _0x35e32e=_0x49ba7e;console[_0x35e32e(0x1c5)](_0x200d23),addScrapeLog(path[_0x35e32e(0x11b)](workerData[_0x35e32e(0x19b)]),_0x35e32e(0x149),'',_0x561013,_0x35e32e(0x1d6)),_0x583e4b('');}),_0x2c2984['on']('close',()=>{});})['on'](_0x5c8763(0x19a),_0x3b769e=>{_0x583e4b('');});}else _0x583e4b(_0x561013);});});}function downloadPosterAndSaveNfo(_0x2000f3,_0x4a1b6c,_0x4a421e,_0x25c26b,_0x932cfb,_0x35fa42,_0x501c0f){return new Promise((_0x40ec57,_0x43f25a)=>{const _0xdd9112=_0x933b;let _0x7eb96e=[];_0x4a1b6c&&_0x2000f3&&(!_0x501c0f||_0x501c0f&&!fs[_0xdd9112(0x165)](_0x2000f3)?_0x7eb96e[_0xdd9112(0x17e)](downloadPoster(_0x2000f3,_0x4a1b6c)):log('跳过保存海报:'+_0x2000f3)),_0x4a421e&&_0x25c26b&&(!_0x501c0f||_0x501c0f&&!fs[_0xdd9112(0x165)](_0x25c26b)?(console[_0xdd9112(0x1c5)](_0xdd9112(0x1d7),_0x25c26b,_0x501c0f),addScrapeLog(path[_0xdd9112(0x11b)](workerData[_0xdd9112(0x19b)]),'NFO',_0x25c26b,'','SUCCESS'),_0x7eb96e[_0xdd9112(0x17e)](nfoUtil[_0xdd9112(0x10e)](_0x4a421e,_0x25c26b,_0x932cfb))):log(_0xdd9112(0x1da)+_0x25c26b)),_0x4a421e[_0xdd9112(0x127)]&&_0x35fa42&&(!_0x501c0f||_0x501c0f&&!fs[_0xdd9112(0x165)](_0x35fa42)?(log(_0xdd9112(0x1df)+_0x35fa42),_0x7eb96e['push'](downloadPoster(_0x35fa42,_0x4a421e['backdrop_url']))):log(_0xdd9112(0x15d)+_0x35fa42)),Promise[_0xdd9112(0x13e)](_0x7eb96e)[_0xdd9112(0x11a)](_0x3d9ca4=>{_0x40ec57();});});}function saveEpisodeInfo(_0x36de67,_0x52d873,_0x574232,_0x52773e,_0x5833eb){return new Promise((_0x513f56,_0x4931d1)=>{const _0x471589=_0x933b;if(!mediaTypeConfig[_0x471589(0x1b2)]['includes'](path['extname'](_0x574232)[_0x471589(0x10a)]()))return log(_0x471589(0x176)+_0x574232),_0x513f56();if(!_0x52d873[_0x471589(0x132)]||_0x52d873['episodes'][_0x471589(0x184)]<0x1)return log(_0x471589(0x13f)),_0x513f56();let _0x495fb2;for(let _0xdc7569 of _0x52d873['episodes']){if(_0xdc7569[_0x471589(0x1a2)]==_0x52773e){_0x495fb2=_0xdc7569;break;}}if(!_0x495fb2)return log(_0x471589(0x189)+_0x52773e),_0x513f56();_0x52d873['season_number']&&(_0x495fb2[_0x471589(0x166)]=_0x52d873[_0x471589(0x183)]);_0x495fb2[_0x471589(0x16f)]=_0x52773e;let {dir:_0x28ed97,name:_0x4e164e}=path['parse'](path[_0x471589(0x11b)](_0x36de67,_0x574232)),_0x2aaf95=path[_0x471589(0x11b)](_0x28ed97,_0x4e164e)+_0x471589(0x182),_0x13367a=path[_0x471589(0x11b)](_0x28ed97,_0x4e164e)+_0x471589(0x194);downloadPosterAndSaveNfo(_0x2aaf95,_0x495fb2[_0x471589(0x195)],_0x495fb2,_0x13367a,'episodedetails',null,_0x5833eb)[_0x471589(0x11a)](_0x346c1c=>{_0x513f56();});});}function detectIsMissingEpisodeInfo(_0x16b852){const _0x1bd006=_0x50dd80;let _0x393855=fs[_0x1bd006(0x10b)](_0x16b852),_0x12b843=![];for(let _0x3f68b3 of _0x393855){let _0x12e085=path[_0x1bd006(0x177)](_0x3f68b3)?path['extname'](_0x3f68b3)['toLowerCase']():null;if(_0x12e085&&config[_0x1bd006(0x1b2)][_0x1bd006(0x128)](_0x12e085)){let _0xad5acf=_0x3f68b3['substring'](0x0,_0x3f68b3['lastIndexOf']('.')),_0x3de4df=path[_0x1bd006(0x11b)](_0x16b852,_0xad5acf+_0x1bd006(0x194));if(!fs[_0x1bd006(0x165)](_0x3de4df))return console[_0x1bd006(0x1c5)](_0x1bd006(0x10f)+_0x3de4df),_0x12b843=!![],_0x12b843;}}return _0x12b843;}function saveSeasonInfo(_0x256914,_0x34e381,_0x1701c6,_0x161735,_0x4d11b7){return new Promise((_0x2aa486,_0x81a28)=>{const _0x340490=_0x933b;if(!_0x34e381[_0x340490(0x172)]||_0x34e381[_0x340490(0x172)][_0x340490(0x184)]<0x1)return log('seriesInfo没找到季信息'),_0x2aa486();let _0x11f442;for(let _0x491890 of _0x34e381[_0x340490(0x172)]){log('season.season_number:'+_0x491890['season_number']);if(_0x491890[_0x340490(0x183)]==_0x1701c6){_0x11f442=_0x491890;break;}}if(!_0x11f442)return log(_0x340490(0x1ab)+_0x1701c6),_0x2aa486();let _0x4ffc36,_0x40b92d,_0x584cb9,_0x5e99e6;if(_0x161735){let _0x46cf66=_0x1701c6+'';if(_0x1701c6<0xa)_0x46cf66='0'+_0x1701c6;_0x4ffc36=path[_0x340490(0x11b)](path['dirname'](_0x256914),_0x340490(0x166)+_0x46cf66+'-poster.jpg'),_0x584cb9=path[_0x340490(0x11b)](_0x256914,_0x340490(0x159)),_0x5e99e6=path['join'](path[_0x340490(0x156)](_0x256914),'fanart.jpg');}else _0x4ffc36=path[_0x340490(0x11b)](_0x256914,_0x340490(0x170)),_0x584cb9=path[_0x340490(0x11b)](_0x256914,_0x340490(0x1aa)),_0x5e99e6=path[_0x340490(0x11b)](_0x256914,_0x340490(0x1a9)),!_0x11f442['backdrop_url']&&(_0x11f442['backdrop_url']=_0x34e381['backdrop_url']);!_0x11f442['cover_url']&&(_0x11f442[_0x340490(0x195)]=_0x34e381['cover_url']),_0x11f442['season']=_0x1701c6,_0x34e381[_0x340490(0x188)]&&_0x11f442['movie_name']&&(_0x11f442[_0x340490(0x147)]=_0x34e381[_0x340490(0x188)]+'\x20'+_0x11f442[_0x340490(0x188)],_0x11f442[_0x340490(0x188)]=_0x11f442[_0x340490(0x147)]),_0x34e381[_0x340490(0x1cf)]&&!_0x11f442[_0x340490(0x1cf)]&&(_0x11f442[_0x340490(0x1cf)]=_0x34e381[_0x340490(0x1cf)]),_0x34e381[_0x340490(0x11e)]&&!_0x11f442['actorsOriginal']&&(_0x11f442[_0x340490(0x11e)]=_0x34e381[_0x340490(0x11e)]),_0x34e381['directors']&&!_0x11f442[_0x340490(0x1a3)]&&(_0x11f442[_0x340490(0x1a3)]=_0x34e381[_0x340490(0x1a3)]),_0x34e381[_0x340490(0x1b5)]&&!_0x11f442[_0x340490(0x1b5)]&&(_0x11f442[_0x340490(0x1b5)]=_0x34e381['directorsOriginal']),_0x34e381[_0x340490(0x140)]&&!_0x11f442[_0x340490(0x140)]&&(_0x11f442[_0x340490(0x140)]=_0x34e381[_0x340490(0x140)]),_0x34e381[_0x340490(0x169)]&&!_0x11f442[_0x340490(0x169)]&&(_0x11f442[_0x340490(0x169)]=_0x34e381[_0x340490(0x169)]),_0x34e381['guestActorsOriginal']&&!_0x11f442['guestActorsOriginal']&&(_0x11f442[_0x340490(0x11d)]=_0x34e381[_0x340490(0x11d)]),_0x34e381[_0x340490(0x1c7)]&&!_0x11f442[_0x340490(0x1c7)]&&(_0x11f442[_0x340490(0x1c7)]=_0x34e381[_0x340490(0x1c7)]),_0x34e381[_0x340490(0x10c)]&&!_0x11f442[_0x340490(0x10c)]&&(_0x11f442[_0x340490(0x10c)]=_0x34e381[_0x340490(0x10c)]),_0x34e381[_0x340490(0x1cd)]&&(_0x11f442[_0x340490(0x1cd)]=_0x34e381[_0x340490(0x1cd)]),downloadPosterAndSaveNfo(_0x4ffc36,_0x11f442[_0x340490(0x195)],_0x11f442,_0x584cb9,_0x340490(0x18d),_0x5e99e6,_0x4d11b7)[_0x340490(0x11a)](_0x437cd2=>{const _0x298eed=_0x340490;log('season海报和nfo保存完毕');if(!_0x34e381[_0x298eed(0x1cd)])return _0x2aa486();if(_0x4d11b7&&!detectIsMissingEpisodeInfo(_0x256914))return log('跳过不缺失任何信息的季'),_0x2aa486();let _0x555da8=getTmdbApi();_0x555da8[_0x298eed(0x158)](_0x34e381[_0x298eed(0x1cd)],_0x1701c6)[_0x298eed(0x11a)](_0x822e59=>{const _0x3bb7e4=_0x298eed;log('开始保存每一集的信息'),fs[_0x3bb7e4(0x1bc)](_0x256914,(_0x886279,_0x2d1a24)=>{const _0x47955b=_0x3bb7e4;if(_0x886279)return _0x2aa486();let _0x1ac491=[];for(let _0x119a79 of _0x2d1a24){try{let _0x23f447=path['join'](_0x256914,_0x119a79),_0x55a640=fs['statSync'](_0x23f447);if(_0x55a640[_0x47955b(0x1ce)]()){let _0x4e54c7=movieSeasonUtil[_0x47955b(0x1c0)](_0x119a79);_0x4e54c7&&_0x4e54c7['episode']&&_0x4e54c7[_0x47955b(0x16f)]>0x0&&_0x1ac491[_0x47955b(0x17e)](saveEpisodeInfo(_0x256914,_0x822e59,_0x119a79,_0x4e54c7[_0x47955b(0x16f)],_0x4d11b7));}}catch(_0x18388f){log(_0x18388f);continue;}}Promise[_0x47955b(0x13e)](_0x1ac491)[_0x47955b(0x11a)](_0x492ef6=>{_0x2aa486();});});})['catch'](_0x229330=>{const _0x3201b5=_0x298eed;return log(_0x229330),addScrapeLog(path['join'](workerData[_0x3201b5(0x19b)]),'API_SEASON_DETAIL','','',_0x3201b5(0x1d6),_0x229330[_0x3201b5(0x15b)]?_0x229330[_0x3201b5(0x15b)]:_0x3201b5(0x1ec)),_0x2aa486();});});});}function onSearchFinish(_0xa58148,_0x586596,_0x54a0d6){return new Promise((_0x424fdf,_0x260a38)=>{const _0x55ccfb=_0x933b;let _0x578bc8=path[_0x55ccfb(0x11b)](_0xa58148['path'],_0xa58148[_0x55ccfb(0x126)]),_0x1dfb55=_0xa58148[_0x55ccfb(0x1dd)]==0x1,_0x439fc2=getTmdbApi();_0x439fc2['getDetail'](_0x586596,_0x1dfb55)[_0x55ccfb(0x11a)](_0xe1c2bd=>{const _0x16ca5c=_0x55ccfb;if(!_0x1dfb55){let {dir:_0x109267,name:_0xbf4bb4}=path['parse'](_0x578bc8),_0x47090b=path[_0x16ca5c(0x11b)](_0x109267,_0xbf4bb4+'.jpg'),_0x2abf7b=_0xe1c2bd[_0x16ca5c(0x195)],_0x295b57=path[_0x16ca5c(0x11b)](_0x109267,_0xbf4bb4+_0x16ca5c(0x194)),_0x4c9eef=path[_0x16ca5c(0x11b)](_0x109267,_0xbf4bb4+_0x16ca5c(0x1b6));downloadPosterAndSaveNfo(_0x47090b,_0x2abf7b,_0xe1c2bd,_0x295b57,_0x16ca5c(0x13c),_0x4c9eef,_0x54a0d6)[_0x16ca5c(0x11a)](_0x20d811=>{const _0xb3d303=_0x16ca5c;return log(_0xb3d303(0x1ac)),_0x424fdf();});}else{let _0x49d854=movieSeasonUtil[_0x16ca5c(0x178)](path['basename'](_0xa58148['path']));if(_0x49d854>-0x1){log('符合三级命名规则:'+_0x578bc8);let {dir:_0x36cefb,name:_0x5703d2}=path[_0x16ca5c(0x1e4)](_0x578bc8),_0x2aaf28=path[_0x16ca5c(0x11b)](path['dirname'](_0x36cefb),_0x16ca5c(0x170)),_0x2ac9db=path[_0x16ca5c(0x11b)](path[_0x16ca5c(0x156)](_0x36cefb),_0x16ca5c(0x1a9)),_0x186ee8=path[_0x16ca5c(0x11b)](path['dirname'](_0x36cefb),'tvshow.nfo');downloadPosterAndSaveNfo(_0x2aaf28,_0xe1c2bd['cover_url'],_0xe1c2bd,_0x186ee8,_0x16ca5c(0x18d),_0x2ac9db,_0x54a0d6)[_0x16ca5c(0x11a)](_0xf2c1a1=>{const _0x271b5c=_0x16ca5c;log('整部剧的海报和nfo保存完毕'),fs[_0x271b5c(0x1bc)](path[_0x271b5c(0x156)](_0x36cefb),(_0x2e50ae,_0x20ae9f)=>{const _0x10ccdb=_0x271b5c;if(_0x2e50ae)return _0x424fdf();let _0x5a6a7d=[];for(let _0x3fdeba of _0x20ae9f){try{let _0x64a377=path[_0x10ccdb(0x11b)](path[_0x10ccdb(0x156)](_0x36cefb),_0x3fdeba),_0x2cc59c=fs[_0x10ccdb(0x12c)](_0x64a377);if(_0x2cc59c[_0x10ccdb(0x1c8)]()){let _0x57019c=movieSeasonUtil[_0x10ccdb(0x178)](_0x3fdeba);_0x57019c>-0x1&&_0x5a6a7d[_0x10ccdb(0x17e)](saveSeasonInfo(_0x64a377,_0xe1c2bd,_0x57019c,!![],_0x54a0d6));}}catch(_0xa9818c){log(_0xa9818c);continue;}}Promise[_0x10ccdb(0x13e)](_0x5a6a7d)[_0x10ccdb(0x11a)](_0x3cb0ad=>{_0x424fdf();});});});}else{log(_0x16ca5c(0x154)+_0x578bc8);let _0x20775f=movieSeasonUtil[_0x16ca5c(0x178)](path[_0x16ca5c(0x17a)](_0xa58148[_0x16ca5c(0x19b)]),![]);if(_0x20775f>-0x1)saveSeasonInfo(path['dirname'](_0x578bc8),_0xe1c2bd,_0x20775f,![],_0x54a0d6)[_0x16ca5c(0x11a)](_0x50eea0=>{_0x424fdf();});else{let _0x144300=movieSeasonUtil[_0x16ca5c(0x1c0)](_0x578bc8);_0x144300&&_0x144300[_0x16ca5c(0x166)]&&_0x144300[_0x16ca5c(0x166)]>0x0?saveSeasonInfo(path[_0x16ca5c(0x156)](_0x578bc8),_0xe1c2bd,_0x144300['season'],![],_0x54a0d6)[_0x16ca5c(0x11a)](_0x2e9c8e=>{_0x424fdf();}):(log(_0x16ca5c(0x1b1)),saveSeasonInfo(path[_0x16ca5c(0x156)](_0x578bc8),_0xe1c2bd,0x1,![],_0x54a0d6)[_0x16ca5c(0x11a)](_0x3eaf4a=>{_0x424fdf();}));}}}})[_0x55ccfb(0x1b4)](_0x1cc1ca=>{const _0x4b8a5=_0x55ccfb;return log(_0x1cc1ca),addScrapeLog(path[_0x4b8a5(0x11b)](workerData[_0x4b8a5(0x19b)]),_0x4b8a5(0x1de),'','',_0x4b8a5(0x1d6),_0x1cc1ca['status_message']?_0x1cc1ca[_0x4b8a5(0x15b)]:_0x4b8a5(0x1ec)),_0x424fdf();});});}function _0x933b(_0x315584,_0x5044de){const _0x3b6870=_0x3b68();return _0x933b=function(_0x933be0,_0x23cdbb){_0x933be0=_0x933be0-0x109;let _0x22ecb3=_0x3b6870[_0x933be0];return _0x22ecb3;},_0x933b(_0x315584,_0x5044de);}function addScrapeLog(_0x39bbb9,_0xa519d,_0x4d37d1,_0x3d95d0,_0x22272c,_0x372d37){const _0x1e9a37=_0x50dd80;dbFileIndex['prepare']('INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)')['run'](_0x39bbb9,_0xa519d,_0x4d37d1,_0x3d95d0,_0x22272c,_0x372d37,Date[_0x1e9a37(0x1d1)]());}function getTvExistTmdbId(_0x35bc55){const _0x3cfd9e=_0x50dd80;if(_0x35bc55[_0x3cfd9e(0x1dd)]!=0x1)return null;let _0x4671ae=path[_0x3cfd9e(0x156)](_0x35bc55[_0x3cfd9e(0x19b)]),_0x865c97=movieSeasonUtil[_0x3cfd9e(0x178)](path[_0x3cfd9e(0x17a)](_0x35bc55[_0x3cfd9e(0x19b)]),!![]),_0x4dbb34=null,_0x2e4c2c='';_0x865c97>-0x1&&(_0x2e4c2c=path['join'](_0x4671ae,_0x3cfd9e(0x1aa)));(!_0x2e4c2c||!fs[_0x3cfd9e(0x165)](_0x2e4c2c))&&(_0x2e4c2c=path[_0x3cfd9e(0x11b)](_0x35bc55[_0x3cfd9e(0x19b)],_0x3cfd9e(0x1aa)));if(!_0x2e4c2c||!fs[_0x3cfd9e(0x165)](_0x2e4c2c))return null;const _0x8923f6=new XMLParser();let _0x1699ed=_0x8923f6[_0x3cfd9e(0x1e4)](fs[_0x3cfd9e(0x139)](_0x2e4c2c));return _0x1699ed['tvshow']&&(_0x1699ed=_0x1699ed[_0x3cfd9e(0x18d)],_0x1699ed[_0x3cfd9e(0x150)]&&(_0x4dbb34=_0x1699ed[_0x3cfd9e(0x150)])),{'tmdbId':_0x4dbb34,'seassonNumber':_0x865c97};}function searchMovieInfo(_0x28aba3,_0x216ac4){const _0x5b8cd4=_0x50dd80;return!_0x216ac4&&(_0x216ac4=getQueryArray(_0x28aba3)),log(JSON[_0x5b8cd4(0x138)](_0x216ac4)),new Promise((_0x422041,_0x5236e8)=>{const _0x300c36=_0x5b8cd4;function _0x171916(){return _0x5236e8();}if(!_0x216ac4||_0x216ac4[_0x300c36(0x184)]<0x1)return log(_0x300c36(0x163)),_0x171916();let _0x2ce1aa=_0x216ac4[0x0][_0x300c36(0x1ad)],_0x381629=_0x216ac4[0x0][_0x300c36(0x18b)];log(_0x300c36(0x153),_0x2ce1aa['title']);let _0x55b07f=getTmdbApi();if(!_0x55b07f)return log(_0x300c36(0x1eb)),_0x171916();let _0x55d164=_0x28aba3['is_tvplay']==0x1;_0x55b07f['search'](_0x2ce1aa,_0x55d164,_0x381629)[_0x300c36(0x11a)](_0x1a7d50=>{const _0x326703=_0x300c36;if(_0x1a7d50&&_0x1a7d50[_0x326703(0x184)]>0x0){let _0x27ad63=_0x1a7d50[0x0];onSearchFinish(_0x28aba3,_0x27ad63[_0x326703(0x1cd)])['then'](()=>{return _0x422041();});}else{if(_0x216ac4['length']>0x1){let _0x2949f9=_0x216ac4[_0x326703(0x14c)](0x1);return searchMovieInfo(_0x28aba3,_0x2949f9)[_0x326703(0x11a)](_0x422041);}else return log(_0x326703(0x133),_0x2ce1aa),addScrapeLog(path[_0x326703(0x11b)](workerData[_0x326703(0x19b)]),'API_DETAIL','','',_0x326703(0x1d6),i18n['__'](_0x326703(0x186))),_0x171916();}})['catch'](_0x57c410=>{const _0x3bd12d=_0x300c36;return log(_0x3bd12d(0x1e3),_0x57c410),_0x171916();});});}function returnResult(){const _0x5829f1=_0x50dd80;log(_0x5829f1(0x15e)),parentPort['postMessage']({'code':0x0}),process['exit'](0x0);}function log(_0x67a27d){const _0x50010d=_0x50dd80;parentPort[_0x50010d(0x124)]({'type':'log','message':_0x67a27d});}if(workerData&&workerData[_0x50dd80(0x126)]&&workerData[_0x50dd80(0x19b)]&&workerData[_0x50dd80(0x19e)]&&workerData[_0x50dd80(0x16c)]&&workerData[_0x50dd80(0x168)]){if(workerData[_0x50dd80(0x1cd)])log(_0x50dd80(0x10d)),onSearchFinish(workerData,workerData[_0x50dd80(0x1cd)])[_0x50dd80(0x11a)](_0x173976=>{const _0x5d2ca7=_0x50dd80;log('信息获取完毕',workerData['tmdb_id'],workerData['path'],workerData[_0x5d2ca7(0x126)]),returnResult();})[_0x50dd80(0x1b4)](_0x3ed722=>{returnResult();});else{if(workerData[_0x50dd80(0x111)]==0x1){log(_0x50dd80(0x17b));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId['tmdbId']){addScrapeLog(path[_0x50dd80(0x11b)](workerData['path']),'SCRAPE_MISSING','','','FAIL',i18n['__'](_0x50dd80(0x134)));return;}let tmdbId=foundTmdbId[_0x50dd80(0x1c1)];onSearchFinish(workerData,tmdbId,!![])[_0x50dd80(0x11a)](_0x25d88c=>{log('信息获取完毕'),returnResult();})[_0x50dd80(0x1b4)](_0x3f8faa=>{returnResult();});}else log(_0x50dd80(0x137)),searchMovieInfo(workerData)[_0x50dd80(0x11a)](_0x4f6ae7=>{const _0x4b2b93=_0x50dd80;log(_0x4b2b93(0x1bf)+workerData['path']+'\x20'+workerData[_0x4b2b93(0x126)]),returnResult();})[_0x50dd80(0x1b4)](_0x107032=>{returnResult();});}}else log(_0x50dd80(0x119)),returnResult();