const _0x93202=_0x155a;(function(_0x1ff169,_0x4766e2){const _0x4070ef=_0x155a,_0x2314ba=_0x1ff169();while(!![]){try{const _0x2c5a74=-parseInt(_0x4070ef(0x25e))/0x1*(-parseInt(_0x4070ef(0x22d))/0x2)+parseInt(_0x4070ef(0x28d))/0x3*(parseInt(_0x4070ef(0x1fb))/0x4)+parseInt(_0x4070ef(0x28f))/0x5*(-parseInt(_0x4070ef(0x23d))/0x6)+parseInt(_0x4070ef(0x21c))/0x7+-parseInt(_0x4070ef(0x1ef))/0x8*(-parseInt(_0x4070ef(0x1fd))/0x9)+-parseInt(_0x4070ef(0x291))/0xa*(parseInt(_0x4070ef(0x1f0))/0xb)+-parseInt(_0x4070ef(0x224))/0xc*(parseInt(_0x4070ef(0x1c5))/0xd);if(_0x2c5a74===_0x4766e2)break;else _0x2314ba['push'](_0x2314ba['shift']());}catch(_0x180b25){_0x2314ba['push'](_0x2314ba['shift']());}}}(_0x1b20,0x8af37));const {XMLParser,XMLBuilder}=require(_0x93202(0x1be)),path=require(_0x93202(0x268));let axios=require(_0x93202(0x24f));const {HttpsProxyAgent}=require(_0x93202(0x283)),https=require(_0x93202(0x1de)),{URL}=require(_0x93202(0x27d)),fs=require('fs'),movieSeasonUtil=require(_0x93202(0x1c8)),mediaTypeConfig=require('../myConfig/mediaType'),{parentPort,workerData}=require(_0x93202(0x244)),movieInfoTmdbApi=require(_0x93202(0x23a)),dbConfigTable=require(_0x93202(0x27a)),nfoUtil=require('../utils/nfoUtil'),Database=require(_0x93202(0x241)),config=require('../myConfig/config'),dbFileIndex=new Database(config[_0x93202(0x1b0)],{'timeout':0xea60});function _0x1b20(){const _0x2e3b05=['getSeasonNumber','5.1','跳过非视频文件:','4audios','FAIL','dbFileIndex','substring','TMDB\x20api实例获取失败\x20请检查TMDB相关配置','internal','3gp','720p','value','filename','beitai','season.nfo','dbOther','readdirSync','search','some','fast-xml-parser','includes','web-dl','跳过保存海报:','没有季信息\x20默认使用第一季','replace','../utils/i18nUtil','13GhbGDE','hdwing','西语中字','../utils/movieSeasonUtil','nfo不存在,开始保存','240p','8bit','dolby-multi-bodhmall','INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)','ERROR','.tmp','tvshow','bhd','uhd','根据已有NFO刮削缺失集','POSTER','7.1','.jpg','fgt','tmdbId','英语中字','信息获取完毕','x265','7audios','10bit','https','没有找到要保存的季信息\x20对应号码:','season海报和nfo保存完毕','truehd','fanart.jpg','dvsux','rename','日语中字','tmdbProxyEnable','toLocaleLowerCase','tvshow.nfo','statusCode','h264','265-apex','根据文件名和路径搜索','480p','dreamhd','4496488LtTufg','2321geTWiB','now','basename','NFO','跳过不缺失任何信息的季','SCRAPE_MISSING','extractEpisodeNumbers','-poster.jpg','readFileSync','整部剧的海报和nfo保存完毕','stat','3328324judEhB','ita','9uwBBvr','error','eng','creatorOriginal','iamable','2audios','tmdb_api_url','VID_','4ktrash','remastered','getSeasonDetail','SUCCESS','log','toLowerCase','x265-terminal','cmct','directors','coaster','hdtv','Search\x20Worker:Tmdb代理已经开启','trim','getDetail','join','title','showtitle','高清mp4电影','hevc','seasons','sdr','catch','mov','790335DuxjBZ','tbs','findByTitle','ac3','6audio','regions','缺失:','pipe','1495920NdcohE','noSearchResult','aac','actors','web','isDirectory','status_message','ultra-hd','tmdb_id','2TNchJj','pragma','length','season','remux','bd1080p','backdrop_url','atmos-swtyblz','episodedetails','season.season_number:','get','movie_name','atmos-coaster','../utils/movieInfoTmdbApi','hds','episode','30PhSSBu','img_','dts-hd','0000','better-sqlite3','阳光电影','year','worker_threads','STREAM','tmdb.没有获取到相关信息','push','韩语中字','lastIndexOf','is_tvplay','4audio','then','atmos-iamable','cmrg','axios','tmdbidNotFound','符合三级命名规则:','extname','1080p','directorsOriginal','2160p','guestActorsOriginal','请求失败:\x20HTTP\x20','postMessage','mp4','-fanart.jpg','VID','开始下载','5audios','584461Zddjoa','英文中字','creator','seriesInfo没找到季信息','substr','API','parse','existsSync','不符合三级命名规则:','split','path','刮削任务结束','actorsOriginal','tmdb_api_key','stringify','nexusnf','test','movie','poster.jpg','genres','season_number','ddp','x265-dvsux','API_DETAIL','episodes','开始保存每一集的信息','bdrip','tmdbid','../db/dbConfigTable','port','ultrahd','url','tmdbProxyUrl','finish','hdr10','rmvb','.nfo','hpagent','dts-ift','swtyblz','startsWith','cover_url','Matching\x20movie\x20information\x20','createWriteStream','5audio','readdir','1942','3bSWAQj','高清版','967265sRZyBo','没有找到要保存的集信息\x20对应号码:','20400lNTrvW','allSettled','keys','close','电影的海报和nfo保存完毕','videoTypeList','电影天堂','isFile','brrip','journal_mode\x20=\x20WAL','nahom','dirname','statSync'];_0x1b20=function(){return _0x2e3b05;};return _0x1b20();}dbFileIndex[_0x93202(0x22e)](_0x93202(0x1a7));let dbOther=new Database(config[_0x93202(0x1ba)],{});dbOther['pragma']('journal_mode\x20=\x20WAL');let i18nUtil=require(_0x93202(0x1c4));i18n=i18nUtil['getI18n'](dbOther);let excludeList=['阳光电影dygod.org',_0x93202(0x1cc),_0x93202(0x255),_0x93202(0x232),'hd1080p',_0x93202(0x253),'bd720p',_0x93202(0x1b5),'x264',_0x93202(0x1ed),_0x93202(0x1ca),_0x93202(0x228),_0x93202(0x26d),_0x93202(0x20b),_0x93202(0x1a6),'3audio',_0x93202(0x24b),_0x93202(0x1c6),_0x93202(0x28a),_0x93202(0x220),'7audio','3audios',_0x93202(0x1ae),_0x93202(0x25d),'6audios',_0x93202(0x1dc),'cee',_0x93202(0x217),_0x93202(0x206),_0x93202(0x1b3),_0x93202(0x23b),_0x93202(0x1d7),_0x93202(0x1e1),_0x93202(0x1dd),_0x93202(0x1cb),_0x93202(0x219),_0x93202(0x280),'hdr','hd',_0x93202(0x284),_0x93202(0x23f),'dts','rargb',_0x93202(0x285),_0x93202(0x201),_0x93202(0x20c),_0x93202(0x20e),'ma',_0x93202(0x1d1),'dv',_0x93202(0x273),_0x93202(0x24e),'surcode',_0x93202(0x1d7),_0x93202(0x1c0),_0x93202(0x274),_0x93202(0x1db),_0x93202(0x1e3),'x260bit',_0x93202(0x205),_0x93202(0x234),_0x93202(0x24d),_0x93202(0x239),_0x93202(0x1ff),_0x93202(0x1a8),_0x93202(0x1fc),_0x93202(0x1eb),'atmos',_0x93202(0x1d2),_0x93202(0x278),_0x93202(0x231),'bluray',_0x93202(0x20f),'blue-ray',_0x93202(0x27c),_0x93202(0x22b),_0x93202(0x1ea),'h265','mkv',_0x93202(0x259),_0x93202(0x281),'rm',_0x93202(0x21b),_0x93202(0x1b4),_0x93202(0x228),_0x93202(0x21d),_0x93202(0x202),_0x93202(0x226),'dvd','chs-eng',_0x93202(0x21f),_0x93202(0x1ee),_0x93202(0x28e),_0x93202(0x1a4),_0x93202(0x242),'高清晰版',_0x93202(0x1d9),_0x93202(0x25f),_0x93202(0x1c7),_0x93202(0x1b8),'dl','-','中文字幕','电影天堂',_0x93202(0x248),_0x93202(0x1e5),_0x93202(0x216)];function isObjectInQueryArray(_0x2b742d,_0x3fa244){const _0x26a796=_0x93202;return _0x2b742d[_0x26a796(0x1bd)](function(_0x25b452){const _0x4d45ef=_0x26a796,_0x4a95ac=Object[_0x4d45ef(0x293)](_0x3fa244);return _0x4a95ac['every'](_0x4ace0d=>_0x25b452[_0x4ace0d]===_0x3fa244[_0x4ace0d]);});}function _0x155a(_0x477279,_0x386137){const _0x1b20fe=_0x1b20();return _0x155a=function(_0x155a1c,_0x43f644){_0x155a1c=_0x155a1c-0x1a4;let _0x3184f5=_0x1b20fe[_0x155a1c];return _0x3184f5;},_0x155a(_0x477279,_0x386137);}function getQueryArray(_0x44bd42){const _0xfe8556=_0x93202;let _0x43a341=[];if(!_0x44bd42||!_0x44bd42[_0xfe8556(0x1b7)])return[];let _0x34d707=_0x44bd42[_0xfe8556(0x1b7)][_0xfe8556(0x20a)]();if(!_0x34d707||_0x34d707[_0xfe8556(0x22f)]<0x2)return[];function _0x4080af(_0x127923,_0x4e8370){const _0x46c0b6=_0xfe8556;let _0x505b5c={'title':_0x127923,'year':_0x4e8370};_0x127923!=_0x46c0b6(0x245)&&!isObjectInQueryArray(_0x43a341,_0x505b5c)&&_0x43a341[_0x46c0b6(0x247)](_0x505b5c);}function _0x478ce1(_0x3b5a08){const _0x2afb42=_0xfe8556;let _0x98ab71=path[_0x2afb42(0x252)](_0x3b5a08);_0x98ab71&&(_0x3b5a08=_0x3b5a08[_0x2afb42(0x1c3)](_0x98ab71,''));if(/^[0-9]*$/[_0x2afb42(0x26e)](_0x3b5a08)&&_0x3b5a08!=_0x2afb42(0x28c)&&!_0x3b5a08[_0x2afb42(0x286)](_0x2afb42(0x240)))return[];if(_0x3b5a08['startsWith']('IMG_')||_0x3b5a08[_0x2afb42(0x286)](_0x2afb42(0x23e))||_0x3b5a08[_0x2afb42(0x286)](_0x2afb42(0x25b))||_0x3b5a08[_0x2afb42(0x286)]('vid')||_0x3b5a08['startsWith'](_0x2afb42(0x204))||_0x3b5a08[_0x2afb42(0x286)]('vid_')||_0x3b5a08[_0x2afb42(0x286)]('IMG'))return[];_0x3b5a08[_0x3b5a08[_0x2afb42(0x22f)]-0x1]=='.'&&(_0x3b5a08=_0x3b5a08[_0x2afb42(0x262)](0x0,_0x3b5a08[_0x2afb42(0x22f)]-0x1));_0x3b5a08=_0x3b5a08[_0x2afb42(0x1c3)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x2afb42(0x1c3)](_0x2afb42(0x1ac),'')[_0x2afb42(0x1c3)](_0x2afb42(0x1d5),''),_0x3b5a08=_0x3b5a08[_0x2afb42(0x1c3)](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')['replace'](/[ ]+/gi,'\x20');let _0x1527fe=_0x3b5a08[_0x2afb42(0x267)]('\x20'),_0x5be2ae=[],_0x31ed31=null;for(let _0x2dc711 in _0x1527fe){let _0x2f385c=_0x1527fe[_0x2dc711][_0x2afb42(0x211)]();if(excludeList['includes'](_0x2f385c))continue;if(isNumber(_0x2f385c)){if(parseInt(_0x2f385c)>0x767&&parseInt(_0x2f385c)<0x834){_0x31ed31=_0x2f385c;continue;}}_0x5be2ae['push'](_0x2f385c);}for(let _0x59e34e=_0x5be2ae['length'];_0x59e34e>=0x0;_0x59e34e--){let _0x1687d8=_0x5be2ae[_0x2afb42(0x213)]('\x20')[_0x2afb42(0x211)]();_0x1687d8&&(_0x31ed31&&_0x4080af(_0x1687d8,_0x31ed31),_0x4080af(_0x1687d8)),_0x5be2ae['splice'](_0x5be2ae[_0x2afb42(0x22f)]-0x1,0x1);}}if(_0x44bd42[_0xfe8556(0x24a)]==0x1)try{let _0x3fba44=path[_0xfe8556(0x1f2)](_0x44bd42[_0xfe8556(0x268)])[_0xfe8556(0x1e7)](),_0x451712=movieSeasonUtil[_0xfe8556(0x1ab)](_0x3fba44);if(_0x451712>-0x1){let _0x570066=path[_0xfe8556(0x1f2)](path['dirname'](_0x44bd42[_0xfe8556(0x268)]))[_0xfe8556(0x1e7)]();_0x570066&&_0x478ce1(_0x570066);}else _0x478ce1(_0x3fba44);}catch(_0x36224a){console[_0xfe8556(0x209)](_0x36224a);}const _0x55e5bb=_0x34d707['replace'](/s\d{1,2}e\d{1,2}/g,'');return _0x478ce1(_0x55e5bb),_0x43a341;}function isNumber(_0x1a0284){const _0x3733f5=_0x93202;return/^-?[\d.]+(?:e-?\d+)?$/[_0x3733f5(0x26e)](_0x1a0284);}function getTmdbApi(){const _0x1a650f=_0x93202;let _0x5219ef=dbConfigTable[_0x1a650f(0x21e)](dbOther,_0x1a650f(0x1e6)),_0x5b4d52=null;if(_0x5219ef&&_0x5219ef['value']==0x1){let _0x7ca824=dbConfigTable['findByTitle'](dbOther,_0x1a650f(0x27e));_0x7ca824&&_0x7ca824[_0x1a650f(0x1b6)]&&(_0x5b4d52=_0x7ca824[_0x1a650f(0x1b6)]),log(_0x1a650f(0x210)+_0x5b4d52);}return tmdbApiObj=new movieInfoTmdbApi[(_0x1a650f(0x263))](workerData[_0x1a650f(0x26b)],workerData['tmdb_api_language'],workerData[_0x1a650f(0x203)],_0x5b4d52),tmdbApiObj;}function getProxyUrl(_0x50400d){const _0x40d98c=_0x93202;let _0x5c7487=dbConfigTable['findByTitle'](_0x50400d,'tmdbProxyEnable'),_0x219a50=null;if(_0x5c7487&&_0x5c7487[_0x40d98c(0x1b6)]==0x1){let _0x4be69=dbConfigTable[_0x40d98c(0x21e)](_0x50400d,_0x40d98c(0x27e));_0x4be69&&_0x4be69[_0x40d98c(0x1b6)]&&(_0x219a50=_0x4be69[_0x40d98c(0x1b6)]);}return _0x219a50;}function downloadPoster(_0x4ce1ec,_0x4bd919){return new Promise((_0x152262,_0x560133)=>{const _0xf9ebe4=_0x155a;fs[_0xf9ebe4(0x1fa)](_0x4ce1ec,(_0x5e401f,_0x34c7bf)=>{const _0x3dca13=_0xf9ebe4;if(_0x5e401f){console[_0x3dca13(0x209)](_0x3dca13(0x25c),_0x4bd919);let _0x1a9757=getProxyUrl(dbOther),_0x54c5d9=null;_0x1a9757&&(_0x54c5d9=new HttpsProxyAgent({'proxy':_0x1a9757}));const _0x11d6a4=new URL(_0x4bd919);https[_0x3dca13(0x237)]({'hostname':_0x11d6a4['hostname'],'port':_0x11d6a4[_0x3dca13(0x27b)]||0x1bb,'path':_0x11d6a4['pathname']+_0x11d6a4[_0x3dca13(0x1bc)],'agent':_0x54c5d9?_0x54c5d9:![]},_0x4ba27f=>{const _0x42181a=_0x3dca13;if(_0x4ba27f[_0x42181a(0x1e9)]!==0xc8)return console[_0x42181a(0x1fe)](_0x42181a(0x257)+_0x4ba27f[_0x42181a(0x1e9)]),addScrapeLog(path[_0x42181a(0x213)](workerData[_0x42181a(0x268)]),_0x42181a(0x1d4),'',_0x4ce1ec,_0x42181a(0x1af)),_0x152262('');let _0x144a9e=_0x4ce1ec+_0x42181a(0x1cf),_0x56db33=fs[_0x42181a(0x289)](_0x144a9e);_0x4ba27f[_0x42181a(0x223)](_0x56db33),_0x56db33['on'](_0x42181a(0x27f),()=>{const _0x2050fa=_0x42181a;fs[_0x2050fa(0x1e4)](_0x144a9e,_0x4ce1ec,_0x4f613c=>{const _0x3e13cb=_0x2050fa;if(_0x4f613c)return _0x152262('');addScrapeLog(path[_0x3e13cb(0x213)](workerData[_0x3e13cb(0x268)]),_0x3e13cb(0x1d4),'',_0x4ce1ec,'SUCCESS'),_0x152262(_0x4ce1ec);});}),_0x56db33['on'](_0x42181a(0x1fe),_0x156299=>{const _0xaa9fe8=_0x42181a;console[_0xaa9fe8(0x209)](_0x156299),addScrapeLog(path['join'](workerData[_0xaa9fe8(0x268)]),_0xaa9fe8(0x1d4),'',_0x4ce1ec,'FAIL'),_0x152262('');}),_0x56db33['on'](_0x42181a(0x294),()=>{});})['on']('error',_0xe69380=>{_0x152262('');});}else _0x152262(_0x4ce1ec);});});}function downloadPosterAndSaveNfo(_0x258733,_0x2c168c,_0x2a40be,_0x89962d,_0x4f8bd5,_0x82d21,_0x102719){return new Promise((_0x498517,_0x486277)=>{const _0x4257fb=_0x155a;let _0x5ee350=[];_0x2c168c&&_0x258733&&(!_0x102719||_0x102719&&!fs[_0x4257fb(0x265)](_0x258733)?_0x5ee350['push'](downloadPoster(_0x258733,_0x2c168c)):log(_0x4257fb(0x1c1)+_0x258733)),_0x2a40be&&_0x89962d&&(!_0x102719||_0x102719&&!fs['existsSync'](_0x89962d)?(console['log'](_0x4257fb(0x1c9),_0x89962d,_0x102719),addScrapeLog(path[_0x4257fb(0x213)](workerData[_0x4257fb(0x268)]),_0x4257fb(0x1f3),_0x89962d,'',_0x4257fb(0x208)),_0x5ee350[_0x4257fb(0x247)](nfoUtil['saveNfoFile'](_0x2a40be,_0x89962d,_0x4f8bd5))):log('跳过保存NFO:'+_0x89962d)),_0x2a40be[_0x4257fb(0x233)]&&_0x82d21&&(!_0x102719||_0x102719&&!fs[_0x4257fb(0x265)](_0x82d21)?(log('下载fanart:'+_0x82d21),_0x5ee350[_0x4257fb(0x247)](downloadPoster(_0x82d21,_0x2a40be[_0x4257fb(0x233)]))):log('跳过保存fanart:'+_0x82d21)),Promise[_0x4257fb(0x292)](_0x5ee350)[_0x4257fb(0x24c)](_0x7c4a4a=>{_0x498517();});});}function saveEpisodeInfo(_0x1cb827,_0x1326cd,_0x494da1,_0x37c2d1,_0x3c9b3d){return new Promise((_0x10c54e,_0xbf4ad0)=>{const _0x178b68=_0x155a;if(!mediaTypeConfig[_0x178b68(0x296)]['includes'](path['extname'](_0x494da1)[_0x178b68(0x20a)]()))return log(_0x178b68(0x1ad)+_0x494da1),_0x10c54e();if(!_0x1326cd[_0x178b68(0x276)]||_0x1326cd[_0x178b68(0x276)][_0x178b68(0x22f)]<0x1)return log('seasonInfo没找到每一集的信息'),_0x10c54e();let _0x1ed846;for(let _0x283015 of _0x1326cd['episodes']){if(_0x283015['episode_number']==_0x37c2d1){_0x1ed846=_0x283015;break;}}if(!_0x1ed846)return log(_0x178b68(0x290)+_0x37c2d1),_0x10c54e();_0x1326cd[_0x178b68(0x272)]&&(_0x1ed846[_0x178b68(0x230)]=_0x1326cd['season_number']);_0x1ed846[_0x178b68(0x23c)]=_0x37c2d1;let {dir:_0x223953,name:_0x1c4171}=path['parse'](path[_0x178b68(0x213)](_0x1cb827,_0x494da1)),_0x15f4c6=path[_0x178b68(0x213)](_0x223953,_0x1c4171)+_0x178b68(0x1d6),_0x2f7df8=path[_0x178b68(0x213)](_0x223953,_0x1c4171)+_0x178b68(0x282);downloadPosterAndSaveNfo(_0x15f4c6,_0x1ed846['cover_url'],_0x1ed846,_0x2f7df8,_0x178b68(0x235),null,_0x3c9b3d)[_0x178b68(0x24c)](_0x32d978=>{_0x10c54e();});});}function detectIsMissingEpisodeInfo(_0x199748){const _0x1e5c71=_0x93202;let _0x16c1a=fs[_0x1e5c71(0x1bb)](_0x199748),_0x5a97a8=![];for(let _0x54fb9b of _0x16c1a){let _0x4ad36d=path[_0x1e5c71(0x252)](_0x54fb9b)?path[_0x1e5c71(0x252)](_0x54fb9b)[_0x1e5c71(0x20a)]():null;if(_0x4ad36d&&config['videoTypeList'][_0x1e5c71(0x1bf)](_0x4ad36d)){let _0x5d133c=_0x54fb9b[_0x1e5c71(0x1b1)](0x0,_0x54fb9b[_0x1e5c71(0x249)]('.')),_0x464981=path[_0x1e5c71(0x213)](_0x199748,_0x5d133c+_0x1e5c71(0x282));if(!fs['existsSync'](_0x464981))return console['log'](_0x1e5c71(0x222)+_0x464981),_0x5a97a8=!![],_0x5a97a8;}}return _0x5a97a8;}function saveSeasonInfo(_0x2f0929,_0x1965f1,_0x47efac,_0x3cf714,_0xe88312){return new Promise((_0x37d287,_0x5b67d6)=>{const _0x10b85d=_0x155a;if(!_0x1965f1[_0x10b85d(0x218)]||_0x1965f1[_0x10b85d(0x218)]['length']<0x1)return log(_0x10b85d(0x261)),_0x37d287();let _0x5f5916;for(let _0x5b80fb of _0x1965f1[_0x10b85d(0x218)]){log(_0x10b85d(0x236)+_0x5b80fb['season_number']);if(_0x5b80fb[_0x10b85d(0x272)]==_0x47efac){_0x5f5916=_0x5b80fb;break;}}if(!_0x5f5916)return log(_0x10b85d(0x1df)+_0x47efac),_0x37d287();let _0xfac4e1,_0x5623ef,_0x16a92a,_0x4903a2;if(_0x3cf714){let _0x26d413=_0x47efac+'';if(_0x47efac<0xa)_0x26d413='0'+_0x47efac;_0xfac4e1=path[_0x10b85d(0x213)](path['dirname'](_0x2f0929),_0x10b85d(0x230)+_0x26d413+_0x10b85d(0x1f7)),_0x16a92a=path['join'](_0x2f0929,_0x10b85d(0x1b9)),_0x4903a2=path[_0x10b85d(0x213)](path[_0x10b85d(0x1a9)](_0x2f0929),'fanart.jpg');}else _0xfac4e1=path['join'](_0x2f0929,'poster.jpg'),_0x16a92a=path[_0x10b85d(0x213)](_0x2f0929,_0x10b85d(0x1e8)),_0x4903a2=path['join'](_0x2f0929,_0x10b85d(0x1e2)),!_0x5f5916['backdrop_url']&&(_0x5f5916[_0x10b85d(0x233)]=_0x1965f1[_0x10b85d(0x233)]);!_0x5f5916[_0x10b85d(0x287)]&&(_0x5f5916[_0x10b85d(0x287)]=_0x1965f1['cover_url']),_0x5f5916[_0x10b85d(0x230)]=_0x47efac,_0x1965f1[_0x10b85d(0x238)]&&_0x5f5916['movie_name']&&(_0x5f5916[_0x10b85d(0x215)]=_0x1965f1[_0x10b85d(0x238)]+'\x20'+_0x5f5916[_0x10b85d(0x238)],_0x5f5916['movie_name']=_0x5f5916[_0x10b85d(0x215)]),_0x1965f1[_0x10b85d(0x227)]&&!_0x5f5916[_0x10b85d(0x227)]&&(_0x5f5916[_0x10b85d(0x227)]=_0x1965f1[_0x10b85d(0x227)]),_0x1965f1[_0x10b85d(0x26a)]&&!_0x5f5916[_0x10b85d(0x26a)]&&(_0x5f5916['actorsOriginal']=_0x1965f1[_0x10b85d(0x26a)]),_0x1965f1[_0x10b85d(0x20d)]&&!_0x5f5916[_0x10b85d(0x20d)]&&(_0x5f5916[_0x10b85d(0x20d)]=_0x1965f1[_0x10b85d(0x20d)]),_0x1965f1['directorsOriginal']&&!_0x5f5916[_0x10b85d(0x254)]&&(_0x5f5916['directorsOriginal']=_0x1965f1[_0x10b85d(0x254)]),_0x1965f1[_0x10b85d(0x260)]&&!_0x5f5916[_0x10b85d(0x260)]&&(_0x5f5916[_0x10b85d(0x260)]=_0x1965f1[_0x10b85d(0x260)]),_0x1965f1[_0x10b85d(0x200)]&&!_0x5f5916[_0x10b85d(0x200)]&&(_0x5f5916[_0x10b85d(0x200)]=_0x1965f1[_0x10b85d(0x200)]),_0x1965f1[_0x10b85d(0x256)]&&!_0x5f5916['guestActorsOriginal']&&(_0x5f5916[_0x10b85d(0x256)]=_0x1965f1[_0x10b85d(0x256)]),_0x1965f1['genres']&&!_0x5f5916[_0x10b85d(0x271)]&&(_0x5f5916[_0x10b85d(0x271)]=_0x1965f1[_0x10b85d(0x271)]),_0x1965f1[_0x10b85d(0x221)]&&!_0x5f5916[_0x10b85d(0x221)]&&(_0x5f5916[_0x10b85d(0x221)]=_0x1965f1[_0x10b85d(0x221)]),_0x1965f1[_0x10b85d(0x22c)]&&(_0x5f5916[_0x10b85d(0x22c)]=_0x1965f1[_0x10b85d(0x22c)]),downloadPosterAndSaveNfo(_0xfac4e1,_0x5f5916[_0x10b85d(0x287)],_0x5f5916,_0x16a92a,_0x10b85d(0x1d0),_0x4903a2,_0xe88312)[_0x10b85d(0x24c)](_0x524756=>{const _0x5ac522=_0x10b85d;log(_0x5ac522(0x1e0));if(!_0x1965f1['tmdb_id'])return _0x37d287();if(_0xe88312&&!detectIsMissingEpisodeInfo(_0x2f0929))return log(_0x5ac522(0x1f4)),_0x37d287();let _0x549cd0=getTmdbApi();_0x549cd0[_0x5ac522(0x207)](_0x1965f1['tmdb_id'],_0x47efac)[_0x5ac522(0x24c)](_0x2ce35a=>{const _0x117952=_0x5ac522;log(_0x117952(0x277)),fs[_0x117952(0x28b)](_0x2f0929,(_0x4feda1,_0x4b0900)=>{const _0x3ffcea=_0x117952;if(_0x4feda1)return _0x37d287();let _0x486e3a=[];for(let _0x5ae331 of _0x4b0900){try{let _0x4f1266=path[_0x3ffcea(0x213)](_0x2f0929,_0x5ae331),_0x26f2b2=fs[_0x3ffcea(0x1aa)](_0x4f1266);if(_0x26f2b2[_0x3ffcea(0x1a5)]()){let _0x18622d=movieSeasonUtil[_0x3ffcea(0x1f6)](_0x5ae331);_0x18622d&&_0x18622d[_0x3ffcea(0x23c)]&&_0x18622d[_0x3ffcea(0x23c)]>0x0&&_0x486e3a[_0x3ffcea(0x247)](saveEpisodeInfo(_0x2f0929,_0x2ce35a,_0x5ae331,_0x18622d[_0x3ffcea(0x23c)],_0xe88312));}}catch(_0xab2236){log(_0xab2236);continue;}}Promise['allSettled'](_0x486e3a)[_0x3ffcea(0x24c)](_0x15dde7=>{_0x37d287();});});})[_0x5ac522(0x21a)](_0x248e18=>{const _0x348671=_0x5ac522;return log(_0x248e18),addScrapeLog(path[_0x348671(0x213)](workerData[_0x348671(0x268)]),'API_SEASON_DETAIL','','',_0x348671(0x1af),_0x248e18[_0x348671(0x22a)]?_0x248e18['status_message']:_0x348671(0x1ce)),_0x37d287();});});});}function onSearchFinish(_0x3876c6,_0xd263a2,_0x12ddef){return new Promise((_0xbabd76,_0x4e9731)=>{const _0x31e651=_0x155a;let _0x322f4e=path['join'](_0x3876c6[_0x31e651(0x268)],_0x3876c6[_0x31e651(0x1b7)]),_0x1c1658=_0x3876c6[_0x31e651(0x24a)]==0x1,_0x539117=getTmdbApi();_0x539117[_0x31e651(0x212)](_0xd263a2,_0x1c1658)[_0x31e651(0x24c)](_0x47dece=>{const _0x20e153=_0x31e651;if(!_0x1c1658){let {dir:_0x14c4f0,name:_0x479891}=path['parse'](_0x322f4e),_0x24c4bc=path[_0x20e153(0x213)](_0x14c4f0,_0x479891+_0x20e153(0x1d6)),_0x23d8d8=_0x47dece[_0x20e153(0x287)],_0x5e6c74=path[_0x20e153(0x213)](_0x14c4f0,_0x479891+_0x20e153(0x282)),_0x2d240b=path[_0x20e153(0x213)](_0x14c4f0,_0x479891+_0x20e153(0x25a));downloadPosterAndSaveNfo(_0x24c4bc,_0x23d8d8,_0x47dece,_0x5e6c74,_0x20e153(0x26f),_0x2d240b,_0x12ddef)[_0x20e153(0x24c)](_0x29a44f=>{const _0x311a44=_0x20e153;return log(_0x311a44(0x295)),_0xbabd76();});}else{let _0x527e85=movieSeasonUtil['getSeasonNumber'](path[_0x20e153(0x1f2)](_0x3876c6[_0x20e153(0x268)]));if(_0x527e85>-0x1){log(_0x20e153(0x251)+_0x322f4e);let {dir:_0x2ff35d,name:_0x240289}=path['parse'](_0x322f4e),_0x76e1b3=path[_0x20e153(0x213)](path['dirname'](_0x2ff35d),_0x20e153(0x270)),_0x5cacc0=path['join'](path[_0x20e153(0x1a9)](_0x2ff35d),_0x20e153(0x1e2)),_0x504e84=path['join'](path[_0x20e153(0x1a9)](_0x2ff35d),'tvshow.nfo');downloadPosterAndSaveNfo(_0x76e1b3,_0x47dece[_0x20e153(0x287)],_0x47dece,_0x504e84,_0x20e153(0x1d0),_0x5cacc0,_0x12ddef)[_0x20e153(0x24c)](_0x7c9c82=>{const _0x5c9631=_0x20e153;log(_0x5c9631(0x1f9)),fs[_0x5c9631(0x28b)](path['dirname'](_0x2ff35d),(_0x2e3a36,_0x1c61da)=>{const _0x57547b=_0x5c9631;if(_0x2e3a36)return _0xbabd76();let _0x55ea2c=[];for(let _0x2e9f2c of _0x1c61da){try{let _0x5424fb=path[_0x57547b(0x213)](path['dirname'](_0x2ff35d),_0x2e9f2c),_0xae15e=fs['statSync'](_0x5424fb);if(_0xae15e[_0x57547b(0x229)]()){let _0x1313ad=movieSeasonUtil[_0x57547b(0x1ab)](_0x2e9f2c);_0x1313ad>-0x1&&_0x55ea2c['push'](saveSeasonInfo(_0x5424fb,_0x47dece,_0x1313ad,!![],_0x12ddef));}}catch(_0x2b44cf){log(_0x2b44cf);continue;}}Promise[_0x57547b(0x292)](_0x55ea2c)[_0x57547b(0x24c)](_0x1dc8a8=>{_0xbabd76();});});});}else{log(_0x20e153(0x266)+_0x322f4e);let _0x585db2=movieSeasonUtil['getSeasonNumber'](path[_0x20e153(0x1f2)](_0x3876c6['path']),![]);if(_0x585db2>-0x1)saveSeasonInfo(path[_0x20e153(0x1a9)](_0x322f4e),_0x47dece,_0x585db2,![],_0x12ddef)['then'](_0x2025ec=>{_0xbabd76();});else{let _0x361243=movieSeasonUtil[_0x20e153(0x1f6)](_0x322f4e);_0x361243&&_0x361243[_0x20e153(0x230)]&&_0x361243[_0x20e153(0x230)]>0x0?saveSeasonInfo(path['dirname'](_0x322f4e),_0x47dece,_0x361243[_0x20e153(0x230)],![],_0x12ddef)[_0x20e153(0x24c)](_0xa9089d=>{_0xbabd76();}):(log(_0x20e153(0x1c2)),saveSeasonInfo(path[_0x20e153(0x1a9)](_0x322f4e),_0x47dece,0x1,![],_0x12ddef)['then'](_0x4cff52=>{_0xbabd76();}));}}}})[_0x31e651(0x21a)](_0x79a987=>{const _0x41f140=_0x31e651;return log(_0x79a987),addScrapeLog(path[_0x41f140(0x213)](workerData[_0x41f140(0x268)]),_0x41f140(0x275),'','','FAIL',_0x79a987[_0x41f140(0x22a)]?_0x79a987['status_message']:_0x41f140(0x1ce)),_0xbabd76();});});}function addScrapeLog(_0x1429ef,_0xe769e2,_0x2e1596,_0x41cb92,_0xf39b3c,_0x3ce4f1){const _0x4741da=_0x93202;dbFileIndex['prepare'](_0x4741da(0x1cd))['run'](_0x1429ef,_0xe769e2,_0x2e1596,_0x41cb92,_0xf39b3c,_0x3ce4f1,Date[_0x4741da(0x1f1)]());}function getTvExistTmdbId(_0x4dfc6f){const _0x28da67=_0x93202;if(_0x4dfc6f[_0x28da67(0x24a)]!=0x1)return null;let _0x4f1bdb=path[_0x28da67(0x1a9)](_0x4dfc6f['path']),_0x32bcd5=movieSeasonUtil[_0x28da67(0x1ab)](path[_0x28da67(0x1f2)](_0x4dfc6f[_0x28da67(0x268)]),!![]),_0x2d4f49=null,_0x387787='';_0x32bcd5>-0x1&&(_0x387787=path[_0x28da67(0x213)](_0x4f1bdb,_0x28da67(0x1e8)));(!_0x387787||!fs[_0x28da67(0x265)](_0x387787))&&(_0x387787=path[_0x28da67(0x213)](_0x4dfc6f[_0x28da67(0x268)],_0x28da67(0x1e8)));if(!_0x387787||!fs[_0x28da67(0x265)](_0x387787))return null;const _0x105954=new XMLParser();let _0x3e8c0f=_0x105954[_0x28da67(0x264)](fs[_0x28da67(0x1f8)](_0x387787));return _0x3e8c0f[_0x28da67(0x1d0)]&&(_0x3e8c0f=_0x3e8c0f['tvshow'],_0x3e8c0f[_0x28da67(0x279)]&&(_0x2d4f49=_0x3e8c0f['tmdbid'])),{'tmdbId':_0x2d4f49,'seassonNumber':_0x32bcd5};}function searchMovieInfo(_0x4e74cb,_0x3cb5e1){const _0x36711f=_0x93202;return!_0x3cb5e1&&(_0x3cb5e1=getQueryArray(_0x4e74cb)),log(JSON[_0x36711f(0x26c)](_0x3cb5e1)),new Promise((_0x19ef8f,_0x195fef)=>{const _0x31444e=_0x36711f;function _0x57f407(){return _0x195fef();}if(!_0x3cb5e1||_0x3cb5e1['length']<0x1)return log('要查询的数据不存在'),_0x57f407();let _0x2d8694=_0x3cb5e1[0x0]['title'],_0x2db8bb=_0x3cb5e1[0x0][_0x31444e(0x243)];log(_0x31444e(0x288),_0x2d8694[_0x31444e(0x214)]);let _0x441eb4=getTmdbApi();if(!_0x441eb4)return log(_0x31444e(0x1b2)),_0x57f407();let _0x48f99d=_0x4e74cb[_0x31444e(0x24a)]==0x1;_0x441eb4[_0x31444e(0x1bc)](_0x2d8694,_0x48f99d,_0x2db8bb)[_0x31444e(0x24c)](_0x5e58bf=>{const _0x157d1f=_0x31444e;if(_0x5e58bf&&_0x5e58bf['length']>0x0){let _0x280392=_0x5e58bf[0x0];onSearchFinish(_0x4e74cb,_0x280392[_0x157d1f(0x22c)])[_0x157d1f(0x24c)](()=>{return _0x19ef8f();});}else{if(_0x3cb5e1[_0x157d1f(0x22f)]>0x1){let _0x38e1d5=_0x3cb5e1['splice'](0x1);return searchMovieInfo(_0x4e74cb,_0x38e1d5)[_0x157d1f(0x24c)](_0x19ef8f);}else return log(_0x157d1f(0x246),_0x2d8694),addScrapeLog(path[_0x157d1f(0x213)](workerData[_0x157d1f(0x268)]),'API_DETAIL','','','FAIL',i18n['__'](_0x157d1f(0x225))),_0x57f407();}})[_0x31444e(0x21a)](_0x14ae19=>{return log('TMDB\x20search接口请求失败',_0x14ae19),_0x57f407();});});}function returnResult(){const _0x544f8b=_0x93202;log(_0x544f8b(0x269)),parentPort[_0x544f8b(0x258)]({'code':0x0}),process['exit'](0x0);}function log(_0x526264){const _0x4448f3=_0x93202;parentPort['postMessage']({'type':_0x4448f3(0x209),'message':_0x526264});}if(workerData&&workerData[_0x93202(0x1b7)]&&workerData[_0x93202(0x268)]&&workerData['tmdb_api_language']&&workerData[_0x93202(0x26b)]&&workerData[_0x93202(0x203)]){if(workerData[_0x93202(0x22c)])log('根据TMDBID搜索'),onSearchFinish(workerData,workerData[_0x93202(0x22c)])[_0x93202(0x24c)](_0x2c597b=>{const _0x36b366=_0x93202;log(_0x36b366(0x1da),workerData[_0x36b366(0x22c)],workerData['path'],workerData[_0x36b366(0x1b7)]),returnResult();})[_0x93202(0x21a)](_0x480b37=>{returnResult();});else{if(workerData['scrapeMissing']==0x1){log(_0x93202(0x1d3));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId[_0x93202(0x1d8)]){addScrapeLog(path[_0x93202(0x213)](workerData[_0x93202(0x268)]),_0x93202(0x1f5),'','','FAIL',i18n['__'](_0x93202(0x250)));return;}let tmdbId=foundTmdbId['tmdbId'];onSearchFinish(workerData,tmdbId,!![])[_0x93202(0x24c)](_0x3b5165=>{const _0x3e3324=_0x93202;log(_0x3e3324(0x1da)),returnResult();})[_0x93202(0x21a)](_0x40861b=>{returnResult();});}else log(_0x93202(0x1ec)),searchMovieInfo(workerData)['then'](_0x3fa810=>{const _0xc8554d=_0x93202;log('信息获取完毕'+workerData[_0xc8554d(0x268)]+'\x20'+workerData[_0xc8554d(0x1b7)]),returnResult();})[_0x93202(0x21a)](_0x59919f=>{returnResult();});}}else log('信息不足\x20无法搜索\x20退出worker'),returnResult();