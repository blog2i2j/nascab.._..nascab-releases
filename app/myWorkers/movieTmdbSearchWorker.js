const _0x3600d5=_0x1e72;function _0x1e72(_0x47d501,_0x1b24d2){const _0x3ca580=_0x3ca5();return _0x1e72=function(_0x1e7298,_0x17faa1){_0x1e7298=_0x1e7298-0x102;let _0x5c6172=_0x3ca580[_0x1e7298];return _0x5c6172;},_0x1e72(_0x47d501,_0x1b24d2);}(function(_0x1c3cf4,_0x72ac94){const _0x52c768=_0x1e72,_0x329fcd=_0x1c3cf4();while(!![]){try{const _0x35cddc=parseInt(_0x52c768(0x1e4))/0x1*(-parseInt(_0x52c768(0x18f))/0x2)+parseInt(_0x52c768(0x13e))/0x3*(parseInt(_0x52c768(0x194))/0x4)+parseInt(_0x52c768(0x12a))/0x5+-parseInt(_0x52c768(0x192))/0x6+-parseInt(_0x52c768(0x12d))/0x7+-parseInt(_0x52c768(0x1d8))/0x8*(-parseInt(_0x52c768(0x14a))/0x9)+-parseInt(_0x52c768(0x16a))/0xa*(-parseInt(_0x52c768(0x1c9))/0xb);if(_0x35cddc===_0x72ac94)break;else _0x329fcd['push'](_0x329fcd['shift']());}catch(_0x3412d6){_0x329fcd['push'](_0x329fcd['shift']());}}}(_0x3ca5,0xd9992));const {XMLParser,XMLBuilder}=require(_0x3600d5(0x179)),path=require('path');let axios=require(_0x3600d5(0x14e));const {HttpsProxyAgent}=require('hpagent'),https=require(_0x3600d5(0x191)),{URL}=require('url'),fs=require('fs'),movieSeasonUtil=require('../utils/movieSeasonUtil'),mediaTypeConfig=require(_0x3600d5(0x105)),{parentPort,workerData}=require(_0x3600d5(0x17a)),movieInfoTmdbApi=require(_0x3600d5(0x10e)),dbConfigTable=require(_0x3600d5(0x117)),nfoUtil=require(_0x3600d5(0x104)),Database=require(_0x3600d5(0x1b1)),config=require(_0x3600d5(0x154)),dbFileIndex=new Database(config['dbFileIndex'],{'timeout':0xea60});dbFileIndex['pragma']('journal_mode\x20=\x20WAL');let dbOther=new Database(config['dbOther'],{});function _0x3ca5(){const _0x526be1=['tmdbidNotFound','scrapeMissing','7audio','7audios','finish','根据已有NFO刮削缺失集','跳过保存海报:','../db/dbConfigTable','ERROR','toLocaleLowerCase','SUCCESS','img_','hdr10','pathname','dirname','5audios','-poster.jpg','符合三级命名规则:','season','tbs','2160p','blue-ray','saveNfoFile','prepare','tmdbProxyEnable','bhd','7080HFZGqz','480p','../utils/i18nUtil','3315851fcAPzX','高清mp4电影','tmdbProxyUrl','x260bit','高清晰版','log','hdr','tvshow.nfo','ddp','1942','0000','stringify','pipe','port','3gp','刮削任务结束','mp4','33mkEwMn','truehd','poster.jpg','postMessage','hds','tmdb_api_language','x264','nexusnf','5.1','tmdb.没有获取到相关信息','h265','.nfo','1341VTAeLY','substring','join','getSeasonDetail','axios','x265','close','cmrg','replace','nahom','../myConfig/config','videoTypeList','now','dts-hd','INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)','bd720p','basename','nfo不存在,开始保存','swtyblz','journal_mode\x20=\x20WAL','regions','TMDB\x20search接口请求失败','rename','6audio','英文中字','vid','根据TMDBID搜索','seasonInfo没找到每一集的信息','episodes','title','265-apex','mov','5884030mcxfQF','parse','atmos','SCRAPE_MISSING','API_SEASON_DETAIL','seasons','dts','dvsux','7.1','then','Matching\x20movie\x20information\x20','startsWith','creatorOriginal','tvshow','10bit','fast-xml-parser','worker_threads','directorsOriginal','tmdb_api_key','请求失败:\x20HTTP\x20','tmdb_api_url','status_message','vid_','error','cmct','remastered','tmdbId','episode','VID_','POSTER','substr','.jpg','season_number','guestActorsOriginal','hostname','iamable','hdtv','44pesAoT','extractEpisodeNumbers','https','9612288rWPDyT','actorsOriginal','8088kIezmc','season.nfo','internal','actors','x265-terminal','lastIndexOf','fanart.jpg','brrip','开始保存每一集的信息','movie_name','fgt','catch','run','getDetail','ac3','aac','IMG_','cover_url','电影天堂','tmdb_id','中文字幕','movie','高清版','-fanart.jpg','extname','splice','API','value','filename','better-sqlite3','API_DETAIL','信息获取完毕','跳过非视频文件:','atmos-coaster','hd1080p','keys','韩语中字','FAIL','uhd','includes','backdrop_url','3audios','4audios','web-dl','split','is_tvplay','.tmp','path','dvd','不符合三级命名规则:','电影的海报和nfo保存完毕','existsSync','pragma','66AMQMSR','240p','rmvb','isFile','dolby-multi-bodhmall','要查询的数据不存在','directors','push','statSync','findByTitle','dts-ift','seriesInfo没找到季信息','readdir','没有找到要保存的集信息\x20对应号码:','season.season_number:','53512BysJPu','Search\x20Worker:Tmdb代理已经开启','getSeasonNumber','test','720p','length','genres','跳过不缺失任何信息的季','英语中字','web','showtitle','tmdbid','71987DKmHrg','dreamhd','allSettled','NFO','../utils/nfoUtil','../myConfig/mediaType','西语中字','toLowerCase','creator','VID','4audio','noSearchResult','statusCode','episode_number','../utils/movieInfoTmdbApi','h264'];_0x3ca5=function(){return _0x526be1;};return _0x3ca5();}dbOther[_0x3600d5(0x1c8)](_0x3600d5(0x15d));let i18nUtil=require(_0x3600d5(0x12c));i18n=i18nUtil['getI18n'](dbOther);let excludeList=['阳光电影dygod.org',_0x3600d5(0x1cd),_0x3600d5(0x124),'bd1080p',_0x3600d5(0x1b6),'1080p',_0x3600d5(0x159),_0x3600d5(0x1dc),_0x3600d5(0x144),_0x3600d5(0x12b),_0x3600d5(0x1ca),_0x3600d5(0x1e1),_0x3600d5(0x145),_0x3600d5(0x198),_0x3600d5(0x19b),'3audio',_0x3600d5(0x10a),'hdwing','5audio',_0x3600d5(0x161),_0x3600d5(0x112),_0x3600d5(0x1bd),_0x3600d5(0x1be),_0x3600d5(0x11f),'6audios',_0x3600d5(0x113),'cee','hevc',_0x3600d5(0x183),_0x3600d5(0x196),_0x3600d5(0x142),'fgt',_0x3600d5(0x13f),_0x3600d5(0x178),'8bit','sdr',_0x3600d5(0x11c),_0x3600d5(0x133),'hd',_0x3600d5(0x1d3),_0x3600d5(0x157),_0x3600d5(0x170),'rargb',_0x3600d5(0x15c),_0x3600d5(0x18d),_0x3600d5(0x182),'coaster','ma',_0x3600d5(0x129),'dv',_0x3600d5(0x135),_0x3600d5(0x151),'surcode',_0x3600d5(0x19e),_0x3600d5(0x1bf),'x265-dvsux',_0x3600d5(0x14f),_0x3600d5(0x171),_0x3600d5(0x130),'4ktrash','atmos-swtyblz','atmos-iamable',_0x3600d5(0x1b5),'eng',_0x3600d5(0x153),'ita',_0x3600d5(0x168),_0x3600d5(0x16c),_0x3600d5(0x1ba),'bdrip','remux','bluray',_0x3600d5(0x18e),_0x3600d5(0x125),'ultrahd','ultra-hd',_0x3600d5(0x10f),_0x3600d5(0x148),'mkv',_0x3600d5(0x13d),_0x3600d5(0x1cb),'rm',_0x3600d5(0x169),_0x3600d5(0x13b),_0x3600d5(0x1e1),_0x3600d5(0x123),'2audios',_0x3600d5(0x1a3),_0x3600d5(0x1c4),'chs-eng',_0x3600d5(0x1a2),_0x3600d5(0x1e5),_0x3600d5(0x1aa),_0x3600d5(0x1a6),'阳光电影',_0x3600d5(0x131),_0x3600d5(0x1e0),_0x3600d5(0x162),_0x3600d5(0x106),'beitai','dl','-',_0x3600d5(0x1a8),_0x3600d5(0x1a6),_0x3600d5(0x1b8),'日语中字',_0x3600d5(0x12e)];function isObjectInQueryArray(_0xa4bf1b,_0x2841ca){return _0xa4bf1b['some'](function(_0x5b5ec1){const _0x3039eb=_0x1e72,_0x139a74=Object[_0x3039eb(0x1b7)](_0x2841ca);return _0x139a74['every'](_0x201c8b=>_0x5b5ec1[_0x201c8b]===_0x2841ca[_0x201c8b]);});}function getQueryArray(_0x59b154){const _0x5ef6b4=_0x3600d5;let _0x5a5ba2=[];if(!_0x59b154||!_0x59b154[_0x5ef6b4(0x1b0)])return[];let _0x1b64cf=_0x59b154[_0x5ef6b4(0x1b0)][_0x5ef6b4(0x107)]();if(!_0x1b64cf||_0x1b64cf['length']<0x2)return[];function _0x3b5ee7(_0x29eb4e,_0x26f26){const _0x3ad266=_0x5ef6b4;let _0x36df4e={'title':_0x29eb4e,'year':_0x26f26};_0x29eb4e!='STREAM'&&!isObjectInQueryArray(_0x5a5ba2,_0x36df4e)&&_0x5a5ba2[_0x3ad266(0x1d0)](_0x36df4e);}function _0x1514ef(_0x3cfa90){const _0x1f9e64=_0x5ef6b4;let _0x1040aa=path['extname'](_0x3cfa90);_0x1040aa&&(_0x3cfa90=_0x3cfa90[_0x1f9e64(0x152)](_0x1040aa,''));if(/^[0-9]*$/['test'](_0x3cfa90)&&_0x3cfa90!=_0x1f9e64(0x136)&&!_0x3cfa90[_0x1f9e64(0x175)](_0x1f9e64(0x137)))return[];if(_0x3cfa90['startsWith'](_0x1f9e64(0x1a4))||_0x3cfa90[_0x1f9e64(0x175)](_0x1f9e64(0x11b))||_0x3cfa90[_0x1f9e64(0x175)](_0x1f9e64(0x109))||_0x3cfa90[_0x1f9e64(0x175)](_0x1f9e64(0x163))||_0x3cfa90[_0x1f9e64(0x175)](_0x1f9e64(0x186))||_0x3cfa90[_0x1f9e64(0x175)](_0x1f9e64(0x180))||_0x3cfa90['startsWith']('IMG'))return[];_0x3cfa90[_0x3cfa90[_0x1f9e64(0x1dd)]-0x1]=='.'&&(_0x3cfa90=_0x3cfa90[_0x1f9e64(0x188)](0x0,_0x3cfa90[_0x1f9e64(0x1dd)]-0x1));_0x3cfa90=_0x3cfa90[_0x1f9e64(0x152)](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x1f9e64(0x152)](_0x1f9e64(0x146),'')[_0x1f9e64(0x152)](_0x1f9e64(0x172),''),_0x3cfa90=_0x3cfa90[_0x1f9e64(0x152)](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')[_0x1f9e64(0x152)](/[ ]+/gi,'\x20');let _0x2f7798=_0x3cfa90[_0x1f9e64(0x1c0)]('\x20'),_0x345e28=[],_0x205654=null;for(let _0x50f256 in _0x2f7798){let _0x33c961=_0x2f7798[_0x50f256]['trim']();if(excludeList[_0x1f9e64(0x1bb)](_0x33c961))continue;if(isNumber(_0x33c961)){if(parseInt(_0x33c961)>0x767&&parseInt(_0x33c961)<0x834){_0x205654=_0x33c961;continue;}}_0x345e28[_0x1f9e64(0x1d0)](_0x33c961);}for(let _0x159477=_0x345e28['length'];_0x159477>=0x0;_0x159477--){let _0x2b844f=_0x345e28[_0x1f9e64(0x14c)]('\x20')['trim']();_0x2b844f&&(_0x205654&&_0x3b5ee7(_0x2b844f,_0x205654),_0x3b5ee7(_0x2b844f)),_0x345e28[_0x1f9e64(0x1ad)](_0x345e28[_0x1f9e64(0x1dd)]-0x1,0x1);}}if(_0x59b154[_0x5ef6b4(0x1c1)]==0x1)try{let _0x50765b=path[_0x5ef6b4(0x15a)](_0x59b154['path'])[_0x5ef6b4(0x119)](),_0x110ff8=movieSeasonUtil[_0x5ef6b4(0x1da)](_0x50765b);if(_0x110ff8>-0x1){let _0x294277=path['basename'](path[_0x5ef6b4(0x11e)](_0x59b154[_0x5ef6b4(0x1c3)]))['toLocaleLowerCase']();_0x294277&&_0x1514ef(_0x294277);}else _0x1514ef(_0x50765b);}catch(_0x4554b2){console[_0x5ef6b4(0x132)](_0x4554b2);}const _0x5c535a=_0x1b64cf['replace'](/s\d{1,2}e\d{1,2}/g,'');return _0x1514ef(_0x5c535a),_0x5a5ba2;}function isNumber(_0x413a99){const _0x511c2e=_0x3600d5;return/^-?[\d.]+(?:e-?\d+)?$/[_0x511c2e(0x1db)](_0x413a99);}function getTmdbApi(){const _0x563ae6=_0x3600d5;let _0x10a7f4=dbConfigTable[_0x563ae6(0x1d2)](dbOther,_0x563ae6(0x128)),_0x393df1=null;if(_0x10a7f4&&_0x10a7f4[_0x563ae6(0x1af)]==0x1){let _0x9b4cae=dbConfigTable[_0x563ae6(0x1d2)](dbOther,'tmdbProxyUrl');_0x9b4cae&&_0x9b4cae[_0x563ae6(0x1af)]&&(_0x393df1=_0x9b4cae[_0x563ae6(0x1af)]),log(_0x563ae6(0x1d9)+_0x393df1);}return tmdbApiObj=new movieInfoTmdbApi[(_0x563ae6(0x1ae))](workerData[_0x563ae6(0x17c)],workerData[_0x563ae6(0x143)],workerData[_0x563ae6(0x17e)],_0x393df1),tmdbApiObj;}function getProxyUrl(_0x486a65){const _0x5b90ce=_0x3600d5;let _0x23f5fd=dbConfigTable[_0x5b90ce(0x1d2)](_0x486a65,_0x5b90ce(0x128)),_0x42db49=null;if(_0x23f5fd&&_0x23f5fd['value']==0x1){let _0x14fa56=dbConfigTable[_0x5b90ce(0x1d2)](_0x486a65,_0x5b90ce(0x12f));_0x14fa56&&_0x14fa56['value']&&(_0x42db49=_0x14fa56[_0x5b90ce(0x1af)]);}return _0x42db49;}function downloadPoster(_0x119cbb,_0x4f30ba){return new Promise((_0x3742a4,_0x562f72)=>{fs['stat'](_0x119cbb,(_0x3f5764,_0xe14122)=>{const _0x307880=_0x1e72;if(_0x3f5764){console[_0x307880(0x132)]('开始下载',_0x4f30ba);let _0x306786=getProxyUrl(dbOther),_0x52aacc=null;_0x306786&&(_0x52aacc=new HttpsProxyAgent({'proxy':_0x306786}));const _0x1289ee=new URL(_0x4f30ba);https['get']({'hostname':_0x1289ee[_0x307880(0x18c)],'port':_0x1289ee[_0x307880(0x13a)]||0x1bb,'path':_0x1289ee[_0x307880(0x11d)]+_0x1289ee['search'],'agent':_0x52aacc?_0x52aacc:![]},_0x24a07c=>{const _0x43c9da=_0x307880;if(_0x24a07c[_0x43c9da(0x10c)]!==0xc8)return console[_0x43c9da(0x181)](_0x43c9da(0x17d)+_0x24a07c[_0x43c9da(0x10c)]),addScrapeLog(path['join'](workerData['path']),_0x43c9da(0x187),'',_0x119cbb,_0x43c9da(0x1b9)),_0x3742a4('');let _0x4442b5=_0x119cbb+_0x43c9da(0x1c2),_0x450c45=fs['createWriteStream'](_0x4442b5);_0x24a07c[_0x43c9da(0x139)](_0x450c45),_0x450c45['on'](_0x43c9da(0x114),()=>{const _0x2eb4c4=_0x43c9da;fs[_0x2eb4c4(0x160)](_0x4442b5,_0x119cbb,_0xf46816=>{const _0x4c9fb1=_0x2eb4c4;if(_0xf46816)return _0x3742a4('');addScrapeLog(path[_0x4c9fb1(0x14c)](workerData[_0x4c9fb1(0x1c3)]),_0x4c9fb1(0x187),'',_0x119cbb,_0x4c9fb1(0x11a)),_0x3742a4(_0x119cbb);});}),_0x450c45['on'](_0x43c9da(0x181),_0x210b34=>{const _0x5f3bb9=_0x43c9da;console[_0x5f3bb9(0x132)](_0x210b34),addScrapeLog(path[_0x5f3bb9(0x14c)](workerData[_0x5f3bb9(0x1c3)]),'POSTER','',_0x119cbb,_0x5f3bb9(0x1b9)),_0x3742a4('');}),_0x450c45['on'](_0x43c9da(0x150),()=>{});})['on'](_0x307880(0x181),_0x594762=>{_0x3742a4('');});}else _0x3742a4(_0x119cbb);});});}function downloadPosterAndSaveNfo(_0x2d4224,_0x3464bf,_0x29dc46,_0x4740ff,_0x4fcd5f,_0xa9e58c,_0x3de9b8){return new Promise((_0x154005,_0x1f80ef)=>{const _0x338723=_0x1e72;let _0x358838=[];_0x3464bf&&_0x2d4224&&(!_0x3de9b8||_0x3de9b8&&!fs['existsSync'](_0x2d4224)?_0x358838[_0x338723(0x1d0)](downloadPoster(_0x2d4224,_0x3464bf)):log(_0x338723(0x116)+_0x2d4224)),_0x29dc46&&_0x4740ff&&(!_0x3de9b8||_0x3de9b8&&!fs[_0x338723(0x1c7)](_0x4740ff)?(console[_0x338723(0x132)](_0x338723(0x15b),_0x4740ff,_0x3de9b8),addScrapeLog(path[_0x338723(0x14c)](workerData['path']),_0x338723(0x103),_0x4740ff,'','SUCCESS'),_0x358838[_0x338723(0x1d0)](nfoUtil[_0x338723(0x126)](_0x29dc46,_0x4740ff,_0x4fcd5f))):log('跳过保存NFO:'+_0x4740ff)),_0x29dc46['backdrop_url']&&_0xa9e58c&&(!_0x3de9b8||_0x3de9b8&&!fs[_0x338723(0x1c7)](_0xa9e58c)?(log('下载fanart:'+_0xa9e58c),_0x358838[_0x338723(0x1d0)](downloadPoster(_0xa9e58c,_0x29dc46[_0x338723(0x1bc)]))):log('跳过保存fanart:'+_0xa9e58c)),Promise['allSettled'](_0x358838)[_0x338723(0x173)](_0x8c460c=>{_0x154005();});});}function saveEpisodeInfo(_0x2600fc,_0x636803,_0xf3b700,_0x1081c6,_0x473067){return new Promise((_0x5ea039,_0xf0bc1b)=>{const _0xb432d=_0x1e72;if(!mediaTypeConfig[_0xb432d(0x155)][_0xb432d(0x1bb)](path[_0xb432d(0x1ac)](_0xf3b700)[_0xb432d(0x107)]()))return log(_0xb432d(0x1b4)+_0xf3b700),_0x5ea039();if(!_0x636803['episodes']||_0x636803[_0xb432d(0x166)][_0xb432d(0x1dd)]<0x1)return log(_0xb432d(0x165)),_0x5ea039();let _0x378b9d;for(let _0x164358 of _0x636803[_0xb432d(0x166)]){if(_0x164358[_0xb432d(0x10d)]==_0x1081c6){_0x378b9d=_0x164358;break;}}if(!_0x378b9d)return log(_0xb432d(0x1d6)+_0x1081c6),_0x5ea039();_0x636803[_0xb432d(0x18a)]&&(_0x378b9d[_0xb432d(0x122)]=_0x636803[_0xb432d(0x18a)]);_0x378b9d[_0xb432d(0x185)]=_0x1081c6;let {dir:_0x5053c3,name:_0x266ace}=path[_0xb432d(0x16b)](path[_0xb432d(0x14c)](_0x2600fc,_0xf3b700)),_0x382eef=path[_0xb432d(0x14c)](_0x5053c3,_0x266ace)+'.jpg',_0xc36097=path[_0xb432d(0x14c)](_0x5053c3,_0x266ace)+_0xb432d(0x149);downloadPosterAndSaveNfo(_0x382eef,_0x378b9d[_0xb432d(0x1a5)],_0x378b9d,_0xc36097,'episodedetails',null,_0x473067)['then'](_0x3e9419=>{_0x5ea039();});});}function detectIsMissingEpisodeInfo(_0x487130){const _0x2ec460=_0x3600d5;let _0x5f4aef=fs['readdirSync'](_0x487130),_0x437293=![];for(let _0xabc160 of _0x5f4aef){let _0x2df69b=path[_0x2ec460(0x1ac)](_0xabc160)?path[_0x2ec460(0x1ac)](_0xabc160)[_0x2ec460(0x107)]():null;if(_0x2df69b&&config[_0x2ec460(0x155)]['includes'](_0x2df69b)){let _0xf7aba=_0xabc160[_0x2ec460(0x14b)](0x0,_0xabc160[_0x2ec460(0x199)]('.')),_0x5394be=path[_0x2ec460(0x14c)](_0x487130,_0xf7aba+_0x2ec460(0x149));if(!fs[_0x2ec460(0x1c7)](_0x5394be))return console[_0x2ec460(0x132)]('缺失:'+_0x5394be),_0x437293=!![],_0x437293;}}return _0x437293;}function saveSeasonInfo(_0x376b06,_0x129045,_0x2c3f0b,_0x11675f,_0xc5dedd){return new Promise((_0x57d066,_0x4e6689)=>{const _0x2b5f0d=_0x1e72;if(!_0x129045[_0x2b5f0d(0x16f)]||_0x129045['seasons'][_0x2b5f0d(0x1dd)]<0x1)return log(_0x2b5f0d(0x1d4)),_0x57d066();let _0x1bbaab;for(let _0x399954 of _0x129045[_0x2b5f0d(0x16f)]){log(_0x2b5f0d(0x1d7)+_0x399954[_0x2b5f0d(0x18a)]);if(_0x399954[_0x2b5f0d(0x18a)]==_0x2c3f0b){_0x1bbaab=_0x399954;break;}}if(!_0x1bbaab)return log('没有找到要保存的季信息\x20对应号码:'+_0x2c3f0b),_0x57d066();let _0x5599d,_0x4d767a,_0x12e762,_0x44b007;if(_0x11675f){let _0x30e95c=_0x2c3f0b+'';if(_0x2c3f0b<0xa)_0x30e95c='0'+_0x2c3f0b;_0x5599d=path[_0x2b5f0d(0x14c)](path[_0x2b5f0d(0x11e)](_0x376b06),_0x2b5f0d(0x122)+_0x30e95c+_0x2b5f0d(0x120)),_0x12e762=path[_0x2b5f0d(0x14c)](_0x376b06,_0x2b5f0d(0x195)),_0x44b007=path[_0x2b5f0d(0x14c)](path[_0x2b5f0d(0x11e)](_0x376b06),_0x2b5f0d(0x19a));}else _0x5599d=path[_0x2b5f0d(0x14c)](_0x376b06,_0x2b5f0d(0x140)),_0x12e762=path[_0x2b5f0d(0x14c)](_0x376b06,_0x2b5f0d(0x134)),_0x44b007=path[_0x2b5f0d(0x14c)](_0x376b06,_0x2b5f0d(0x19a)),!_0x1bbaab[_0x2b5f0d(0x1bc)]&&(_0x1bbaab[_0x2b5f0d(0x1bc)]=_0x129045[_0x2b5f0d(0x1bc)]);!_0x1bbaab[_0x2b5f0d(0x1a5)]&&(_0x1bbaab[_0x2b5f0d(0x1a5)]=_0x129045[_0x2b5f0d(0x1a5)]),_0x1bbaab[_0x2b5f0d(0x122)]=_0x2c3f0b,_0x129045['movie_name']&&_0x1bbaab[_0x2b5f0d(0x19d)]&&(_0x1bbaab[_0x2b5f0d(0x1e2)]=_0x129045['movie_name']+'\x20'+_0x1bbaab[_0x2b5f0d(0x19d)],_0x1bbaab[_0x2b5f0d(0x19d)]=_0x1bbaab[_0x2b5f0d(0x1e2)]),_0x129045[_0x2b5f0d(0x197)]&&!_0x1bbaab[_0x2b5f0d(0x197)]&&(_0x1bbaab[_0x2b5f0d(0x197)]=_0x129045['actors']),_0x129045[_0x2b5f0d(0x193)]&&!_0x1bbaab[_0x2b5f0d(0x193)]&&(_0x1bbaab[_0x2b5f0d(0x193)]=_0x129045[_0x2b5f0d(0x193)]),_0x129045[_0x2b5f0d(0x1cf)]&&!_0x1bbaab['directors']&&(_0x1bbaab[_0x2b5f0d(0x1cf)]=_0x129045[_0x2b5f0d(0x1cf)]),_0x129045[_0x2b5f0d(0x17b)]&&!_0x1bbaab[_0x2b5f0d(0x17b)]&&(_0x1bbaab['directorsOriginal']=_0x129045[_0x2b5f0d(0x17b)]),_0x129045[_0x2b5f0d(0x108)]&&!_0x1bbaab[_0x2b5f0d(0x108)]&&(_0x1bbaab[_0x2b5f0d(0x108)]=_0x129045[_0x2b5f0d(0x108)]),_0x129045[_0x2b5f0d(0x176)]&&!_0x1bbaab[_0x2b5f0d(0x176)]&&(_0x1bbaab[_0x2b5f0d(0x176)]=_0x129045[_0x2b5f0d(0x176)]),_0x129045[_0x2b5f0d(0x18b)]&&!_0x1bbaab[_0x2b5f0d(0x18b)]&&(_0x1bbaab[_0x2b5f0d(0x18b)]=_0x129045[_0x2b5f0d(0x18b)]),_0x129045[_0x2b5f0d(0x1de)]&&!_0x1bbaab['genres']&&(_0x1bbaab[_0x2b5f0d(0x1de)]=_0x129045['genres']),_0x129045['regions']&&!_0x1bbaab[_0x2b5f0d(0x15e)]&&(_0x1bbaab[_0x2b5f0d(0x15e)]=_0x129045[_0x2b5f0d(0x15e)]),_0x129045[_0x2b5f0d(0x1a7)]&&(_0x1bbaab['tmdb_id']=_0x129045['tmdb_id']),downloadPosterAndSaveNfo(_0x5599d,_0x1bbaab['cover_url'],_0x1bbaab,_0x12e762,_0x2b5f0d(0x177),_0x44b007,_0xc5dedd)[_0x2b5f0d(0x173)](_0x21a80a=>{const _0x26f382=_0x2b5f0d;log('season海报和nfo保存完毕');if(!_0x129045[_0x26f382(0x1a7)])return _0x57d066();if(_0xc5dedd&&!detectIsMissingEpisodeInfo(_0x376b06))return log(_0x26f382(0x1df)),_0x57d066();let _0x49860c=getTmdbApi();_0x49860c[_0x26f382(0x14d)](_0x129045['tmdb_id'],_0x2c3f0b)[_0x26f382(0x173)](_0x1743b0=>{const _0x2eb112=_0x26f382;log(_0x2eb112(0x19c)),fs[_0x2eb112(0x1d5)](_0x376b06,(_0x4b3de4,_0xa09be7)=>{const _0x5df477=_0x2eb112;if(_0x4b3de4)return _0x57d066();let _0x41c414=[];for(let _0x319751 of _0xa09be7){try{let _0x8348ae=path[_0x5df477(0x14c)](_0x376b06,_0x319751),_0x4fceab=fs[_0x5df477(0x1d1)](_0x8348ae);if(_0x4fceab[_0x5df477(0x1cc)]()){let _0x322b34=movieSeasonUtil[_0x5df477(0x190)](_0x319751);_0x322b34&&_0x322b34[_0x5df477(0x185)]&&_0x322b34['episode']>0x0&&_0x41c414[_0x5df477(0x1d0)](saveEpisodeInfo(_0x376b06,_0x1743b0,_0x319751,_0x322b34[_0x5df477(0x185)],_0xc5dedd));}}catch(_0x4d143d){log(_0x4d143d);continue;}}Promise[_0x5df477(0x102)](_0x41c414)[_0x5df477(0x173)](_0x19e932=>{_0x57d066();});});})['catch'](_0x5e93c5=>{const _0x111e18=_0x26f382;return log(_0x5e93c5),addScrapeLog(path[_0x111e18(0x14c)](workerData[_0x111e18(0x1c3)]),_0x111e18(0x16e),'','',_0x111e18(0x1b9),_0x5e93c5[_0x111e18(0x17f)]?_0x5e93c5[_0x111e18(0x17f)]:_0x111e18(0x118)),_0x57d066();});});});}function onSearchFinish(_0xb4761c,_0x3108f3,_0x33b5c3){return new Promise((_0x10c587,_0x36f59b)=>{const _0x4315f6=_0x1e72;let _0x5316bb=path[_0x4315f6(0x14c)](_0xb4761c[_0x4315f6(0x1c3)],_0xb4761c['filename']),_0x2a4d80=_0xb4761c[_0x4315f6(0x1c1)]==0x1,_0x4c1d6a=getTmdbApi();_0x4c1d6a[_0x4315f6(0x1a1)](_0x3108f3,_0x2a4d80)[_0x4315f6(0x173)](_0x1f1920=>{const _0x41ab95=_0x4315f6;if(!_0x2a4d80){let {dir:_0x7c1ce,name:_0x5817d7}=path[_0x41ab95(0x16b)](_0x5316bb),_0x3e417a=path[_0x41ab95(0x14c)](_0x7c1ce,_0x5817d7+_0x41ab95(0x189)),_0x17ca9f=_0x1f1920[_0x41ab95(0x1a5)],_0x53b245=path[_0x41ab95(0x14c)](_0x7c1ce,_0x5817d7+_0x41ab95(0x149)),_0x108ec8=path[_0x41ab95(0x14c)](_0x7c1ce,_0x5817d7+_0x41ab95(0x1ab));downloadPosterAndSaveNfo(_0x3e417a,_0x17ca9f,_0x1f1920,_0x53b245,_0x41ab95(0x1a9),_0x108ec8,_0x33b5c3)[_0x41ab95(0x173)](_0x3dc0d6=>{const _0x5b740f=_0x41ab95;return log(_0x5b740f(0x1c6)),_0x10c587();});}else{let _0x58df5b=movieSeasonUtil[_0x41ab95(0x1da)](path[_0x41ab95(0x15a)](_0xb4761c[_0x41ab95(0x1c3)]));if(_0x58df5b>-0x1){log(_0x41ab95(0x121)+_0x5316bb);let {dir:_0x55c31b,name:_0x4704da}=path[_0x41ab95(0x16b)](_0x5316bb),_0x3be939=path[_0x41ab95(0x14c)](path[_0x41ab95(0x11e)](_0x55c31b),'poster.jpg'),_0x13c8e7=path[_0x41ab95(0x14c)](path[_0x41ab95(0x11e)](_0x55c31b),_0x41ab95(0x19a)),_0x21662f=path[_0x41ab95(0x14c)](path[_0x41ab95(0x11e)](_0x55c31b),_0x41ab95(0x134));downloadPosterAndSaveNfo(_0x3be939,_0x1f1920[_0x41ab95(0x1a5)],_0x1f1920,_0x21662f,_0x41ab95(0x177),_0x13c8e7,_0x33b5c3)[_0x41ab95(0x173)](_0x5946b7=>{const _0x1d22d3=_0x41ab95;log('整部剧的海报和nfo保存完毕'),fs[_0x1d22d3(0x1d5)](path[_0x1d22d3(0x11e)](_0x55c31b),(_0x237ceb,_0x524d88)=>{const _0x3e173a=_0x1d22d3;if(_0x237ceb)return _0x10c587();let _0x396a84=[];for(let _0x192b85 of _0x524d88){try{let _0x31eac2=path[_0x3e173a(0x14c)](path[_0x3e173a(0x11e)](_0x55c31b),_0x192b85),_0x3d0ba4=fs[_0x3e173a(0x1d1)](_0x31eac2);if(_0x3d0ba4['isDirectory']()){let _0x512886=movieSeasonUtil[_0x3e173a(0x1da)](_0x192b85);_0x512886>-0x1&&_0x396a84[_0x3e173a(0x1d0)](saveSeasonInfo(_0x31eac2,_0x1f1920,_0x512886,!![],_0x33b5c3));}}catch(_0x2058b3){log(_0x2058b3);continue;}}Promise[_0x3e173a(0x102)](_0x396a84)['then'](_0x4389b2=>{_0x10c587();});});});}else{log(_0x41ab95(0x1c5)+_0x5316bb);let _0x48f390=movieSeasonUtil[_0x41ab95(0x1da)](path[_0x41ab95(0x15a)](_0xb4761c[_0x41ab95(0x1c3)]),![]);if(_0x48f390>-0x1)saveSeasonInfo(path[_0x41ab95(0x11e)](_0x5316bb),_0x1f1920,_0x48f390,![],_0x33b5c3)[_0x41ab95(0x173)](_0x27f41f=>{_0x10c587();});else{let _0x43bead=movieSeasonUtil[_0x41ab95(0x190)](_0x5316bb);_0x43bead&&_0x43bead[_0x41ab95(0x122)]&&_0x43bead[_0x41ab95(0x122)]>0x0?saveSeasonInfo(path[_0x41ab95(0x11e)](_0x5316bb),_0x1f1920,_0x43bead[_0x41ab95(0x122)],![],_0x33b5c3)[_0x41ab95(0x173)](_0x5112be=>{_0x10c587();}):(log('没有季信息\x20默认使用第一季'),saveSeasonInfo(path[_0x41ab95(0x11e)](_0x5316bb),_0x1f1920,0x1,![],_0x33b5c3)[_0x41ab95(0x173)](_0x3ab558=>{_0x10c587();}));}}}})[_0x4315f6(0x19f)](_0x17974e=>{const _0x52ec6b=_0x4315f6;return log(_0x17974e),addScrapeLog(path[_0x52ec6b(0x14c)](workerData[_0x52ec6b(0x1c3)]),_0x52ec6b(0x1b2),'','',_0x52ec6b(0x1b9),_0x17974e[_0x52ec6b(0x17f)]?_0x17974e[_0x52ec6b(0x17f)]:_0x52ec6b(0x118)),_0x10c587();});});}function addScrapeLog(_0x1cb2bb,_0x58e6e6,_0x4a5b5d,_0x3d02d2,_0x5ce7aa,_0x2375ad){const _0x297943=_0x3600d5;dbFileIndex[_0x297943(0x127)](_0x297943(0x158))[_0x297943(0x1a0)](_0x1cb2bb,_0x58e6e6,_0x4a5b5d,_0x3d02d2,_0x5ce7aa,_0x2375ad,Date[_0x297943(0x156)]());}function getTvExistTmdbId(_0x18406c){const _0x13d2a3=_0x3600d5;if(_0x18406c['is_tvplay']!=0x1)return null;let _0x262ef8=path[_0x13d2a3(0x11e)](_0x18406c[_0x13d2a3(0x1c3)]),_0x13d75c=movieSeasonUtil['getSeasonNumber'](path[_0x13d2a3(0x15a)](_0x18406c['path']),!![]),_0x487ca0=null,_0x58af16='';_0x13d75c>-0x1&&(_0x58af16=path[_0x13d2a3(0x14c)](_0x262ef8,'tvshow.nfo'));(!_0x58af16||!fs[_0x13d2a3(0x1c7)](_0x58af16))&&(_0x58af16=path[_0x13d2a3(0x14c)](_0x18406c[_0x13d2a3(0x1c3)],'tvshow.nfo'));if(!_0x58af16||!fs[_0x13d2a3(0x1c7)](_0x58af16))return null;const _0x439fd7=new XMLParser();let _0x2de7b1=_0x439fd7[_0x13d2a3(0x16b)](fs['readFileSync'](_0x58af16));return _0x2de7b1[_0x13d2a3(0x177)]&&(_0x2de7b1=_0x2de7b1['tvshow'],_0x2de7b1['tmdbid']&&(_0x487ca0=_0x2de7b1[_0x13d2a3(0x1e3)])),{'tmdbId':_0x487ca0,'seassonNumber':_0x13d75c};}function searchMovieInfo(_0x599c02,_0x45af73){const _0x7b3106=_0x3600d5;return!_0x45af73&&(_0x45af73=getQueryArray(_0x599c02)),log(JSON[_0x7b3106(0x138)](_0x45af73)),new Promise((_0x624f6b,_0x565a8f)=>{const _0x4ae24b=_0x7b3106;function _0x3f2986(){return _0x565a8f();}if(!_0x45af73||_0x45af73['length']<0x1)return log(_0x4ae24b(0x1ce)),_0x3f2986();let _0x176471=_0x45af73[0x0][_0x4ae24b(0x167)],_0x48038c=_0x45af73[0x0]['year'];log(_0x4ae24b(0x174),_0x176471[_0x4ae24b(0x167)]);let _0x49800f=getTmdbApi();if(!_0x49800f)return log('TMDB\x20api实例获取失败\x20请检查TMDB相关配置'),_0x3f2986();let _0x59c77f=_0x599c02[_0x4ae24b(0x1c1)]==0x1;_0x49800f['search'](_0x176471,_0x59c77f,_0x48038c)['then'](_0x8d7280=>{const _0x240d8b=_0x4ae24b;if(_0x8d7280&&_0x8d7280[_0x240d8b(0x1dd)]>0x0){let _0x27e6b5=_0x8d7280[0x0];onSearchFinish(_0x599c02,_0x27e6b5['tmdb_id'])[_0x240d8b(0x173)](()=>{return _0x624f6b();});}else{if(_0x45af73[_0x240d8b(0x1dd)]>0x1){let _0x2d8cb7=_0x45af73['splice'](0x1);return searchMovieInfo(_0x599c02,_0x2d8cb7)[_0x240d8b(0x173)](_0x624f6b);}else return log(_0x240d8b(0x147),_0x176471),addScrapeLog(path[_0x240d8b(0x14c)](workerData[_0x240d8b(0x1c3)]),_0x240d8b(0x1b2),'','',_0x240d8b(0x1b9),i18n['__'](_0x240d8b(0x10b))),_0x3f2986();}})['catch'](_0x4bc089=>{const _0xbb3f9e=_0x4ae24b;return log(_0xbb3f9e(0x15f),_0x4bc089),_0x3f2986();});});}function returnResult(){const _0x5d6b52=_0x3600d5;log(_0x5d6b52(0x13c)),parentPort[_0x5d6b52(0x141)]({'code':0x0}),process['exit'](0x0);}function log(_0x1dbe8b){const _0x1904dd=_0x3600d5;parentPort[_0x1904dd(0x141)]({'type':_0x1904dd(0x132),'message':_0x1dbe8b});}if(workerData&&workerData[_0x3600d5(0x1b0)]&&workerData[_0x3600d5(0x1c3)]&&workerData[_0x3600d5(0x143)]&&workerData[_0x3600d5(0x17c)]&&workerData[_0x3600d5(0x17e)]){if(workerData['tmdb_id'])log(_0x3600d5(0x164)),onSearchFinish(workerData,workerData[_0x3600d5(0x1a7)])['then'](_0x549bdf=>{const _0x1764d2=_0x3600d5;log(_0x1764d2(0x1b3),workerData[_0x1764d2(0x1a7)],workerData[_0x1764d2(0x1c3)],workerData[_0x1764d2(0x1b0)]),returnResult();})[_0x3600d5(0x19f)](_0x190da9=>{returnResult();});else{if(workerData[_0x3600d5(0x111)]==0x1){log(_0x3600d5(0x115));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId[_0x3600d5(0x184)]){addScrapeLog(path[_0x3600d5(0x14c)](workerData[_0x3600d5(0x1c3)]),_0x3600d5(0x16d),'','','FAIL',i18n['__'](_0x3600d5(0x110)));return;}let tmdbId=foundTmdbId[_0x3600d5(0x184)];onSearchFinish(workerData,tmdbId,!![])[_0x3600d5(0x173)](_0x33adb5=>{log('信息获取完毕'),returnResult();})[_0x3600d5(0x19f)](_0x483028=>{returnResult();});}else log('根据文件名和路径搜索'),searchMovieInfo(workerData)[_0x3600d5(0x173)](_0x391109=>{const _0x87c470=_0x3600d5;log('信息获取完毕'+workerData['path']+'\x20'+workerData[_0x87c470(0x1b0)]),returnResult();})[_0x3600d5(0x19f)](_0x5b8881=>{returnResult();});}}else log('信息不足\x20无法搜索\x20退出worker'),returnResult();