const _0x4b2d7d=_0x1365;(function(_0x4bb75f,_0x395dfa){const _0x4aed85=_0x1365,_0x2c5fb1=_0x4bb75f();while(!![]){try{const _0x47cb3d=parseInt(_0x4aed85(0x1dc))/0x1+parseInt(_0x4aed85(0x1a4))/0x2+parseInt(_0x4aed85(0x1b4))/0x3+parseInt(_0x4aed85(0x231))/0x4*(-parseInt(_0x4aed85(0x241))/0x5)+parseInt(_0x4aed85(0x19d))/0x6+-parseInt(_0x4aed85(0x185))/0x7+parseInt(_0x4aed85(0x193))/0x8*(-parseInt(_0x4aed85(0x235))/0x9);if(_0x47cb3d===_0x395dfa)break;else _0x2c5fb1['push'](_0x2c5fb1['shift']());}catch(_0xd144db){_0x2c5fb1['push'](_0x2c5fb1['shift']());}}}(_0x4461,0x62790));const {XMLParser,XMLBuilder}=require(_0x4b2d7d(0x1a6)),path=require(_0x4b2d7d(0x1c8));let axios=require('axios');const {HttpsProxyAgent}=require('hpagent'),https=require(_0x4b2d7d(0x1a9)),{URL}=require(_0x4b2d7d(0x1bf)),fs=require('fs'),movieSeasonUtil=require(_0x4b2d7d(0x253)),mediaTypeConfig=require(_0x4b2d7d(0x20e)),{parentPort,workerData}=require('worker_threads'),movieInfoTmdbApi=require('../utils/movieInfoTmdbApi'),dbConfigTable=require(_0x4b2d7d(0x179)),nfoUtil=require('../utils/nfoUtil'),Database=require(_0x4b2d7d(0x1e4)),config=require(_0x4b2d7d(0x181)),dbFileIndex=new Database(config[_0x4b2d7d(0x21c)],{'timeout':0xea60});dbFileIndex[_0x4b2d7d(0x1e5)](_0x4b2d7d(0x1ff));let dbOther=new Database(config[_0x4b2d7d(0x1aa)],{});dbOther[_0x4b2d7d(0x1e5)](_0x4b2d7d(0x1ff));function _0x1365(_0x122b5d,_0x607c77){const _0x4461e8=_0x4461();return _0x1365=function(_0x13651e,_0x55d34e){_0x13651e=_0x13651e-0x176;let _0x4a0d09=_0x4461e8[_0x13651e];return _0x4a0d09;},_0x1365(_0x122b5d,_0x607c77);}let i18nUtil=require(_0x4b2d7d(0x243));i18n=i18nUtil['getI18n'](dbOther);let excludeList=[_0x4b2d7d(0x258),_0x4b2d7d(0x220),'2160p',_0x4b2d7d(0x204),_0x4b2d7d(0x183),_0x4b2d7d(0x1eb),'bd720p',_0x4b2d7d(0x24d),_0x4b2d7d(0x218),_0x4b2d7d(0x24c),_0x4b2d7d(0x1ec),_0x4b2d7d(0x1b0),_0x4b2d7d(0x1f2),_0x4b2d7d(0x1ae),_0x4b2d7d(0x1a5),_0x4b2d7d(0x1ca),'4audio',_0x4b2d7d(0x22f),_0x4b2d7d(0x1cd),_0x4b2d7d(0x23a),_0x4b2d7d(0x1b2),_0x4b2d7d(0x1fd),'4audios','5audios',_0x4b2d7d(0x1a1),_0x4b2d7d(0x20d),'cee',_0x4b2d7d(0x1da),'remastered',_0x4b2d7d(0x1e3),'hds','fgt',_0x4b2d7d(0x1f8),_0x4b2d7d(0x233),_0x4b2d7d(0x182),'sdr','hdr10',_0x4b2d7d(0x1d9),'hd',_0x4b2d7d(0x1df),'dts-hd',_0x4b2d7d(0x23b),_0x4b2d7d(0x249),_0x4b2d7d(0x244),_0x4b2d7d(0x20a),_0x4b2d7d(0x1a0),_0x4b2d7d(0x18d),'ma','bhd','dv',_0x4b2d7d(0x1ba),'cmrg',_0x4b2d7d(0x1d2),_0x4b2d7d(0x1a2),_0x4b2d7d(0x1a8),_0x4b2d7d(0x21d),_0x4b2d7d(0x1ee),_0x4b2d7d(0x255),_0x4b2d7d(0x203),_0x4b2d7d(0x200),_0x4b2d7d(0x238),_0x4b2d7d(0x21a),'atmos-coaster',_0x4b2d7d(0x1c4),'nahom',_0x4b2d7d(0x1f6),_0x4b2d7d(0x1c5),_0x4b2d7d(0x1c2),_0x4b2d7d(0x1d1),_0x4b2d7d(0x251),'remux',_0x4b2d7d(0x20c),_0x4b2d7d(0x237),_0x4b2d7d(0x1b6),'ultrahd',_0x4b2d7d(0x1a3),_0x4b2d7d(0x17d),'h265',_0x4b2d7d(0x177),_0x4b2d7d(0x254),_0x4b2d7d(0x188),'rm',_0x4b2d7d(0x197),_0x4b2d7d(0x1e7),_0x4b2d7d(0x1b0),'tbs',_0x4b2d7d(0x1ea),_0x4b2d7d(0x1f4),'dvd','chs-eng',_0x4b2d7d(0x1d5),_0x4b2d7d(0x17c),_0x4b2d7d(0x18f),_0x4b2d7d(0x22c),_0x4b2d7d(0x217),_0x4b2d7d(0x242),'英语中字','英文中字',_0x4b2d7d(0x212),'beitai','dl','-',_0x4b2d7d(0x1f3),_0x4b2d7d(0x22c),_0x4b2d7d(0x19a),'日语中字',_0x4b2d7d(0x23c)];function isObjectInQueryArray(_0x50f490,_0x1d8c23){const _0x7ae22a=_0x4b2d7d;return _0x50f490[_0x7ae22a(0x211)](function(_0x1f1223){const _0x37ee72=_0x7ae22a,_0x189f7a=Object[_0x37ee72(0x250)](_0x1d8c23);return _0x189f7a[_0x37ee72(0x1d0)](_0x1e33f3=>_0x1f1223[_0x1e33f3]===_0x1d8c23[_0x1e33f3]);});}function getQueryArray(_0x4160a6){const _0x5a0dee=_0x4b2d7d;let _0xa54532=[];if(!_0x4160a6||!_0x4160a6[_0x5a0dee(0x239)])return[];let _0x485fb1=_0x4160a6['filename']['toLowerCase']();if(!_0x485fb1||_0x485fb1[_0x5a0dee(0x213)]<0x2)return[];function _0x47fa4a(_0x49a884,_0x5bd7e6){const _0x3feeba=_0x5a0dee;let _0x274c4c={'title':_0x49a884,'year':_0x5bd7e6};_0x49a884!=_0x3feeba(0x1ce)&&!isObjectInQueryArray(_0xa54532,_0x274c4c)&&_0xa54532[_0x3feeba(0x196)](_0x274c4c);}function _0x7e8518(_0x53c5a2){const _0x5db2b4=_0x5a0dee;let _0x3c8e20=path['extname'](_0x53c5a2);_0x3c8e20&&(_0x53c5a2=_0x53c5a2['replace'](_0x3c8e20,''));if(/^[0-9]*$/[_0x5db2b4(0x1b3)](_0x53c5a2)&&_0x53c5a2!=_0x5db2b4(0x1fb)&&!_0x53c5a2['startsWith']('0000'))return[];if(_0x53c5a2[_0x5db2b4(0x206)](_0x5db2b4(0x1c7))||_0x53c5a2[_0x5db2b4(0x206)]('img_')||_0x53c5a2['startsWith'](_0x5db2b4(0x1cf))||_0x53c5a2['startsWith']('vid')||_0x53c5a2[_0x5db2b4(0x206)]('VID_')||_0x53c5a2[_0x5db2b4(0x206)](_0x5db2b4(0x245))||_0x53c5a2[_0x5db2b4(0x206)](_0x5db2b4(0x20b)))return[];_0x53c5a2[_0x53c5a2['length']-0x1]=='.'&&(_0x53c5a2=_0x53c5a2[_0x5db2b4(0x24a)](0x0,_0x53c5a2[_0x5db2b4(0x213)]-0x1));_0x53c5a2=_0x53c5a2['replace'](/www\.[a-zA-Z\d\-]+\.((com\.cn)|(cn)|(com)|(net)|(cc)|(de)|(uk)|(org)|(info)|(nl)|(eu)|(ru))/gi,'')[_0x5db2b4(0x194)](_0x5db2b4(0x1b1),'')[_0x5db2b4(0x194)]('7.1',''),_0x53c5a2=_0x53c5a2[_0x5db2b4(0x194)](/[`\-~!@#$%^&*()_【】（）《》`?|+\=?;:：'",.<>\{\}\[\]\\\/]/gi,'\x20')['replace'](/[ ]+/gi,'\x20');let _0x5085f2=_0x53c5a2[_0x5db2b4(0x234)]('\x20'),_0x2aeead=[],_0x31ab8b=null;for(let _0x266bc6 in _0x5085f2){let _0x2e54de=_0x5085f2[_0x266bc6][_0x5db2b4(0x236)]();if(excludeList[_0x5db2b4(0x1c3)](_0x2e54de))continue;if(isNumber(_0x2e54de)){if(parseInt(_0x2e54de)>0x767&&parseInt(_0x2e54de)<0x834){_0x31ab8b=_0x2e54de;continue;}}_0x2aeead[_0x5db2b4(0x196)](_0x2e54de);}for(let _0xf4d6f1=_0x2aeead['length'];_0xf4d6f1>=0x0;_0xf4d6f1--){let _0x5ce899=_0x2aeead[_0x5db2b4(0x1ab)]('\x20')['trim']();_0x5ce899&&(_0x31ab8b&&_0x47fa4a(_0x5ce899,_0x31ab8b),_0x47fa4a(_0x5ce899)),_0x2aeead['splice'](_0x2aeead['length']-0x1,0x1);}}if(_0x4160a6[_0x5a0dee(0x1e1)]==0x1)try{let _0x3a5ad1=path[_0x5a0dee(0x17b)](_0x4160a6[_0x5a0dee(0x1c8)])[_0x5a0dee(0x226)](),_0x66bff5=movieSeasonUtil['getSeasonNumber'](_0x3a5ad1);if(_0x66bff5>-0x1){let _0x52cd1d=path['basename'](path[_0x5a0dee(0x216)](_0x4160a6[_0x5a0dee(0x1c8)]))['toLocaleLowerCase']();_0x52cd1d&&_0x7e8518(_0x52cd1d);}else _0x7e8518(_0x3a5ad1);}catch(_0x20c363){console[_0x5a0dee(0x1bd)](_0x20c363);}const _0x1166b0=_0x485fb1['replace'](/s\d{1,2}e\d{1,2}/g,'');return _0x7e8518(_0x1166b0),_0xa54532;}function isNumber(_0x172a68){const _0x3027ae=_0x4b2d7d;return/^-?[\d.]+(?:e-?\d+)?$/[_0x3027ae(0x1b3)](_0x172a68);}function getTmdbApi(){const _0x5879b0=_0x4b2d7d;let _0x40649d=dbConfigTable[_0x5879b0(0x256)](dbOther,'tmdbProxyEnable'),_0x44b866=null;if(_0x40649d&&_0x40649d[_0x5879b0(0x219)]==0x1){let _0x3f6fe9=dbConfigTable['findByTitle'](dbOther,_0x5879b0(0x1bb));_0x3f6fe9&&_0x3f6fe9['value']&&(_0x44b866=_0x3f6fe9['value']),log(_0x5879b0(0x1b7)+_0x44b866);}return tmdbApiObj=new movieInfoTmdbApi[(_0x5879b0(0x21e))](workerData[_0x5879b0(0x18e)],workerData[_0x5879b0(0x1fc)],workerData[_0x5879b0(0x257)],_0x44b866),tmdbApiObj;}function getProxyUrl(_0x5d56f4){const _0x1d17d2=_0x4b2d7d;let _0x3994a9=dbConfigTable['findByTitle'](_0x5d56f4,_0x1d17d2(0x186)),_0x1ed8fd=null;if(_0x3994a9&&_0x3994a9[_0x1d17d2(0x219)]==0x1){let _0x3063c3=dbConfigTable['findByTitle'](_0x5d56f4,_0x1d17d2(0x1bb));_0x3063c3&&_0x3063c3[_0x1d17d2(0x219)]&&(_0x1ed8fd=_0x3063c3['value']);}return _0x1ed8fd;}function downloadPoster(_0x266a82,_0xb91e54){return new Promise((_0x5efc35,_0x2219e6)=>{const _0x30a79c=_0x1365;fs[_0x30a79c(0x1be)](_0x266a82,(_0x448ef7,_0x162b66)=>{const _0x13bae3=_0x30a79c;if(_0x448ef7){console[_0x13bae3(0x1bd)]('开始下载',_0xb91e54);let _0x18f1cd=getProxyUrl(dbOther),_0x304800=null;_0x18f1cd&&(_0x304800=new HttpsProxyAgent({'proxy':_0x18f1cd}));const _0x3b4e3f=new URL(_0xb91e54);https[_0x13bae3(0x248)]({'hostname':_0x3b4e3f[_0x13bae3(0x22b)],'port':_0x3b4e3f[_0x13bae3(0x1e9)]||0x1bb,'path':_0x3b4e3f[_0x13bae3(0x1e8)]+_0x3b4e3f[_0x13bae3(0x24b)],'agent':_0x304800?_0x304800:![]},_0x1dc090=>{const _0x4d2c4b=_0x13bae3;if(_0x1dc090[_0x4d2c4b(0x19b)]!==0xc8)return console['error'](_0x4d2c4b(0x252)+_0x1dc090['statusCode']),addScrapeLog(path[_0x4d2c4b(0x1ab)](workerData['path']),_0x4d2c4b(0x232),'',_0x266a82,_0x4d2c4b(0x180)),_0x5efc35('');let _0x1b6cad=_0x266a82+_0x4d2c4b(0x201),_0x4354e2=fs[_0x4d2c4b(0x24e)](_0x1b6cad);_0x1dc090[_0x4d2c4b(0x195)](_0x4354e2),_0x4354e2['on']('finish',()=>{fs['rename'](_0x1b6cad,_0x266a82,_0x13da36=>{const _0x190cf9=_0x1365;if(_0x13da36)return _0x5efc35('');addScrapeLog(path[_0x190cf9(0x1ab)](workerData[_0x190cf9(0x1c8)]),_0x190cf9(0x232),'',_0x266a82,_0x190cf9(0x18c)),_0x5efc35(_0x266a82);});}),_0x4354e2['on']('error',_0x1475fe=>{const _0x27c5d6=_0x4d2c4b;console['log'](_0x1475fe),addScrapeLog(path[_0x27c5d6(0x1ab)](workerData[_0x27c5d6(0x1c8)]),_0x27c5d6(0x232),'',_0x266a82,'FAIL'),_0x5efc35('');}),_0x4354e2['on'](_0x4d2c4b(0x207),()=>{});})['on'](_0x13bae3(0x1c6),_0x562449=>{_0x5efc35('');});}else _0x5efc35(_0x266a82);});});}function downloadPosterAndSaveNfo(_0x1e6b08,_0x5b0f9e,_0x4a4916,_0x103289,_0xe97882,_0x3208ae,_0x401331){return new Promise((_0x419c19,_0x22e01b)=>{const _0x4b7d7f=_0x1365;let _0x1a333e=[];_0x5b0f9e&&_0x1e6b08&&(!_0x401331||_0x401331&&!fs['existsSync'](_0x1e6b08)?_0x1a333e[_0x4b7d7f(0x196)](downloadPoster(_0x1e6b08,_0x5b0f9e)):log(_0x4b7d7f(0x1f1)+_0x1e6b08)),_0x4a4916&&_0x103289&&(!_0x401331||_0x401331&&!fs[_0x4b7d7f(0x17f)](_0x103289)?(console[_0x4b7d7f(0x1bd)]('nfo不存在,开始保存',_0x103289,_0x401331),addScrapeLog(path[_0x4b7d7f(0x1ab)](workerData[_0x4b7d7f(0x1c8)]),_0x4b7d7f(0x222),_0x103289,'',_0x4b7d7f(0x18c)),_0x1a333e['push'](nfoUtil['saveNfoFile'](_0x4a4916,_0x103289,_0xe97882))):log(_0x4b7d7f(0x184)+_0x103289)),_0x4a4916[_0x4b7d7f(0x1de)]&&_0x3208ae&&(!_0x401331||_0x401331&&!fs['existsSync'](_0x3208ae)?(log('下载fanart:'+_0x3208ae),_0x1a333e[_0x4b7d7f(0x196)](downloadPoster(_0x3208ae,_0x4a4916[_0x4b7d7f(0x1de)]))):log(_0x4b7d7f(0x189)+_0x3208ae)),Promise[_0x4b7d7f(0x18a)](_0x1a333e)['then'](_0x4b17ef=>{_0x419c19();});});}function saveEpisodeInfo(_0x32638d,_0x47182b,_0x288efa,_0x30cc98,_0x3e88c2){return new Promise((_0x488afa,_0x236704)=>{const _0x3b98f8=_0x1365;if(!mediaTypeConfig[_0x3b98f8(0x223)][_0x3b98f8(0x1c3)](path['extname'](_0x288efa)['toLowerCase']()))return log(_0x3b98f8(0x19f)+_0x288efa),_0x488afa();if(!_0x47182b[_0x3b98f8(0x1fa)]||_0x47182b[_0x3b98f8(0x1fa)][_0x3b98f8(0x213)]<0x1)return log('seasonInfo没找到每一集的信息'),_0x488afa();let _0x37633c;for(let _0x46f6cc of _0x47182b[_0x3b98f8(0x1fa)]){if(_0x46f6cc[_0x3b98f8(0x19c)]==_0x30cc98){_0x37633c=_0x46f6cc;break;}}if(!_0x37633c)return log(_0x3b98f8(0x1db)+_0x30cc98),_0x488afa();_0x47182b[_0x3b98f8(0x229)]&&(_0x37633c[_0x3b98f8(0x19e)]=_0x47182b[_0x3b98f8(0x229)]);_0x37633c[_0x3b98f8(0x21b)]=_0x30cc98;let {dir:_0x65d1bb,name:_0x1fcb3e}=path[_0x3b98f8(0x1ef)](path[_0x3b98f8(0x1ab)](_0x32638d,_0x288efa)),_0x261452=path['join'](_0x65d1bb,_0x1fcb3e)+_0x3b98f8(0x23f),_0x46a747=path[_0x3b98f8(0x1ab)](_0x65d1bb,_0x1fcb3e)+'.nfo';downloadPosterAndSaveNfo(_0x261452,_0x37633c[_0x3b98f8(0x20f)],_0x37633c,_0x46a747,_0x3b98f8(0x187),null,_0x3e88c2)['then'](_0x58a275=>{_0x488afa();});});}function detectIsMissingEpisodeInfo(_0x65f5a7){const _0x4a5cce=_0x4b2d7d;let _0x277acf=fs[_0x4a5cce(0x198)](_0x65f5a7),_0x4017ac=![];for(let _0x55f5e9 of _0x277acf){let _0x13e3d2=path['extname'](_0x55f5e9)?path[_0x4a5cce(0x1a7)](_0x55f5e9)[_0x4a5cce(0x1d6)]():null;if(_0x13e3d2&&config[_0x4a5cce(0x223)][_0x4a5cce(0x1c3)](_0x13e3d2)){let _0x5b6fef=_0x55f5e9[_0x4a5cce(0x240)](0x0,_0x55f5e9['lastIndexOf']('.')),_0x524650=path[_0x4a5cce(0x1ab)](_0x65f5a7,_0x5b6fef+_0x4a5cce(0x1c0));if(!fs[_0x4a5cce(0x17f)](_0x524650))return console[_0x4a5cce(0x1bd)]('缺失:'+_0x524650),_0x4017ac=!![],_0x4017ac;}}return _0x4017ac;}function saveSeasonInfo(_0x494b04,_0x150f41,_0x5c2330,_0x52c98a,_0x3f2e46){return new Promise((_0x480a55,_0xd6bf78)=>{const _0x4d9d39=_0x1365;if(!_0x150f41[_0x4d9d39(0x227)]||_0x150f41[_0x4d9d39(0x227)][_0x4d9d39(0x213)]<0x1)return log(_0x4d9d39(0x1ed)),_0x480a55();let _0x3c9154;for(let _0x131ac6 of _0x150f41[_0x4d9d39(0x227)]){log('season.season_number:'+_0x131ac6[_0x4d9d39(0x229)]);if(_0x131ac6['season_number']==_0x5c2330){_0x3c9154=_0x131ac6;break;}}if(!_0x3c9154)return log('没有找到要保存的季信息\x20对应号码:'+_0x5c2330),_0x480a55();let _0x51a742,_0x14830d,_0x54c32f,_0x379a6c;if(_0x52c98a){let _0x2d6f88=_0x5c2330+'';if(_0x5c2330<0xa)_0x2d6f88='0'+_0x5c2330;_0x51a742=path[_0x4d9d39(0x1ab)](path['dirname'](_0x494b04),_0x4d9d39(0x19e)+_0x2d6f88+_0x4d9d39(0x1cc)),_0x54c32f=path[_0x4d9d39(0x1ab)](_0x494b04,_0x4d9d39(0x1d3)),_0x379a6c=path[_0x4d9d39(0x1ab)](path[_0x4d9d39(0x216)](_0x494b04),'fanart.jpg');}else _0x51a742=path[_0x4d9d39(0x1ab)](_0x494b04,_0x4d9d39(0x1f0)),_0x54c32f=path[_0x4d9d39(0x1ab)](_0x494b04,_0x4d9d39(0x1e2)),_0x379a6c=path['join'](_0x494b04,'fanart.jpg'),!_0x3c9154[_0x4d9d39(0x1de)]&&(_0x3c9154['backdrop_url']=_0x150f41[_0x4d9d39(0x1de)]);!_0x3c9154[_0x4d9d39(0x20f)]&&(_0x3c9154[_0x4d9d39(0x20f)]=_0x150f41[_0x4d9d39(0x20f)]),_0x3c9154[_0x4d9d39(0x19e)]=_0x5c2330,_0x150f41[_0x4d9d39(0x23e)]&&_0x3c9154[_0x4d9d39(0x23e)]&&(_0x3c9154[_0x4d9d39(0x1b8)]=_0x150f41[_0x4d9d39(0x23e)]+'\x20'+_0x3c9154[_0x4d9d39(0x23e)],_0x3c9154[_0x4d9d39(0x23e)]=_0x3c9154[_0x4d9d39(0x1b8)]),_0x150f41[_0x4d9d39(0x246)]&&!_0x3c9154[_0x4d9d39(0x246)]&&(_0x3c9154[_0x4d9d39(0x246)]=_0x150f41[_0x4d9d39(0x246)]),_0x150f41[_0x4d9d39(0x18b)]&&!_0x3c9154[_0x4d9d39(0x18b)]&&(_0x3c9154[_0x4d9d39(0x18b)]=_0x150f41[_0x4d9d39(0x18b)]),_0x150f41[_0x4d9d39(0x23d)]&&!_0x3c9154[_0x4d9d39(0x23d)]&&(_0x3c9154[_0x4d9d39(0x23d)]=_0x150f41[_0x4d9d39(0x23d)]),_0x150f41[_0x4d9d39(0x1fe)]&&!_0x3c9154['directorsOriginal']&&(_0x3c9154[_0x4d9d39(0x1fe)]=_0x150f41[_0x4d9d39(0x1fe)]),_0x150f41['creator']&&!_0x3c9154[_0x4d9d39(0x22d)]&&(_0x3c9154[_0x4d9d39(0x22d)]=_0x150f41[_0x4d9d39(0x22d)]),_0x150f41[_0x4d9d39(0x178)]&&!_0x3c9154['creatorOriginal']&&(_0x3c9154[_0x4d9d39(0x178)]=_0x150f41[_0x4d9d39(0x178)]),_0x150f41[_0x4d9d39(0x247)]&&!_0x3c9154[_0x4d9d39(0x247)]&&(_0x3c9154[_0x4d9d39(0x247)]=_0x150f41[_0x4d9d39(0x247)]),_0x150f41[_0x4d9d39(0x1b9)]&&!_0x3c9154['genres']&&(_0x3c9154['genres']=_0x150f41['genres']),_0x150f41[_0x4d9d39(0x224)]&&!_0x3c9154['regions']&&(_0x3c9154[_0x4d9d39(0x224)]=_0x150f41[_0x4d9d39(0x224)]),_0x150f41[_0x4d9d39(0x1c1)]&&(_0x3c9154[_0x4d9d39(0x1c1)]=_0x150f41[_0x4d9d39(0x1c1)]),downloadPosterAndSaveNfo(_0x51a742,_0x3c9154['cover_url'],_0x3c9154,_0x54c32f,'tvshow',_0x379a6c,_0x3f2e46)[_0x4d9d39(0x1ad)](_0x4001d9=>{const _0x2d331e=_0x4d9d39;log(_0x2d331e(0x214));if(!_0x150f41[_0x2d331e(0x1c1)])return _0x480a55();if(_0x3f2e46&&!detectIsMissingEpisodeInfo(_0x494b04))return log(_0x2d331e(0x1f7)),_0x480a55();let _0x79cd68=getTmdbApi();_0x79cd68[_0x2d331e(0x202)](_0x150f41[_0x2d331e(0x1c1)],_0x5c2330)[_0x2d331e(0x1ad)](_0x13b730=>{const _0x5e9561=_0x2d331e;log('开始保存每一集的信息'),fs[_0x5e9561(0x17a)](_0x494b04,(_0x34521e,_0x49552b)=>{const _0x412d96=_0x5e9561;if(_0x34521e)return _0x480a55();let _0x3b8b32=[];for(let _0x42ee03 of _0x49552b){try{let _0x16c039=path[_0x412d96(0x1ab)](_0x494b04,_0x42ee03),_0x54e540=fs[_0x412d96(0x1ac)](_0x16c039);if(_0x54e540[_0x412d96(0x191)]()){let _0x1a75da=movieSeasonUtil[_0x412d96(0x1cb)](_0x42ee03);_0x1a75da&&_0x1a75da['episode']&&_0x1a75da[_0x412d96(0x21b)]>0x0&&_0x3b8b32[_0x412d96(0x196)](saveEpisodeInfo(_0x494b04,_0x13b730,_0x42ee03,_0x1a75da['episode'],_0x3f2e46));}}catch(_0x5b0db4){log(_0x5b0db4);continue;}}Promise[_0x412d96(0x18a)](_0x3b8b32)['then'](_0x75f90=>{_0x480a55();});});})[_0x2d331e(0x199)](_0xcac5ab=>{const _0x38e601=_0x2d331e;return log(_0xcac5ab),addScrapeLog(path[_0x38e601(0x1ab)](workerData[_0x38e601(0x1c8)]),_0x38e601(0x1dd),'','',_0x38e601(0x180),_0xcac5ab[_0x38e601(0x22a)]?_0xcac5ab[_0x38e601(0x22a)]:'ERROR'),_0x480a55();});});});}function onSearchFinish(_0x4fc33b,_0x5c8d60,_0x443d61){return new Promise((_0x4c15e8,_0x32a564)=>{const _0x51c18a=_0x1365;let _0x372f31=path['join'](_0x4fc33b['path'],_0x4fc33b[_0x51c18a(0x239)]),_0x5a800c=_0x4fc33b[_0x51c18a(0x1e1)]==0x1,_0x31b3d3=getTmdbApi();_0x31b3d3[_0x51c18a(0x1f5)](_0x5c8d60,_0x5a800c)[_0x51c18a(0x1ad)](_0x560e7c=>{const _0x216612=_0x51c18a;if(!_0x5a800c){let {dir:_0x27f38c,name:_0x33b31c}=path[_0x216612(0x1ef)](_0x372f31),_0x8ca3a5=path[_0x216612(0x1ab)](_0x27f38c,_0x33b31c+'.jpg'),_0x10d071=_0x560e7c[_0x216612(0x20f)],_0x1bfac3=path['join'](_0x27f38c,_0x33b31c+_0x216612(0x1c0)),_0x35494e=path['join'](_0x27f38c,_0x33b31c+'-fanart.jpg');downloadPosterAndSaveNfo(_0x8ca3a5,_0x10d071,_0x560e7c,_0x1bfac3,_0x216612(0x209),_0x35494e,_0x443d61)[_0x216612(0x1ad)](_0x36d2d1=>{const _0x39a2f9=_0x216612;return log(_0x39a2f9(0x228)),_0x4c15e8();});}else{let _0x3bff55=movieSeasonUtil[_0x216612(0x1af)](path[_0x216612(0x17b)](_0x4fc33b[_0x216612(0x1c8)]));if(_0x3bff55>-0x1){log(_0x216612(0x1d7)+_0x372f31);let {dir:_0x49eaca,name:_0x4fe074}=path['parse'](_0x372f31),_0x2f473d=path['join'](path[_0x216612(0x216)](_0x49eaca),_0x216612(0x1f0)),_0x5829d0=path[_0x216612(0x1ab)](path[_0x216612(0x216)](_0x49eaca),_0x216612(0x176)),_0x52ae67=path['join'](path[_0x216612(0x216)](_0x49eaca),_0x216612(0x1e2));downloadPosterAndSaveNfo(_0x2f473d,_0x560e7c[_0x216612(0x20f)],_0x560e7c,_0x52ae67,'tvshow',_0x5829d0,_0x443d61)[_0x216612(0x1ad)](_0x3f2037=>{const _0x5f446e=_0x216612;log(_0x5f446e(0x21f)),fs['readdir'](path[_0x5f446e(0x216)](_0x49eaca),(_0x5ce824,_0x43989d)=>{const _0x57d306=_0x5f446e;if(_0x5ce824)return _0x4c15e8();let _0x2fb24c=[];for(let _0x2b44a3 of _0x43989d){try{let _0x5c0a20=path[_0x57d306(0x1ab)](path[_0x57d306(0x216)](_0x49eaca),_0x2b44a3),_0x4ac067=fs[_0x57d306(0x1ac)](_0x5c0a20);if(_0x4ac067[_0x57d306(0x22e)]()){let _0x416a80=movieSeasonUtil[_0x57d306(0x1af)](_0x2b44a3);_0x416a80>-0x1&&_0x2fb24c['push'](saveSeasonInfo(_0x5c0a20,_0x560e7c,_0x416a80,!![],_0x443d61));}}catch(_0x5b416c){log(_0x5b416c);continue;}}Promise[_0x57d306(0x18a)](_0x2fb24c)['then'](_0x59c982=>{_0x4c15e8();});});});}else{log('不符合三级命名规则:'+_0x372f31);let _0x21dc6f=movieSeasonUtil[_0x216612(0x1af)](path[_0x216612(0x17b)](_0x4fc33b['path']),![]);if(_0x21dc6f>-0x1)saveSeasonInfo(path['dirname'](_0x372f31),_0x560e7c,_0x21dc6f,![],_0x443d61)[_0x216612(0x1ad)](_0x494b31=>{_0x4c15e8();});else{let _0x8e33d8=movieSeasonUtil[_0x216612(0x1cb)](_0x372f31);_0x8e33d8&&_0x8e33d8['season']&&_0x8e33d8[_0x216612(0x19e)]>0x0?saveSeasonInfo(path[_0x216612(0x216)](_0x372f31),_0x560e7c,_0x8e33d8[_0x216612(0x19e)],![],_0x443d61)[_0x216612(0x1ad)](_0x27d605=>{_0x4c15e8();}):(log('没有季信息\x20默认使用第一季'),saveSeasonInfo(path['dirname'](_0x372f31),_0x560e7c,0x1,![],_0x443d61)[_0x216612(0x1ad)](_0x572ea4=>{_0x4c15e8();}));}}}})['catch'](_0x2fbfe4=>{const _0x5ee75f=_0x51c18a;return log(_0x2fbfe4),addScrapeLog(path[_0x5ee75f(0x1ab)](workerData[_0x5ee75f(0x1c8)]),'API_DETAIL','','',_0x5ee75f(0x180),_0x2fbfe4['status_message']?_0x2fbfe4[_0x5ee75f(0x22a)]:'ERROR'),_0x4c15e8();});});}function _0x4461(){const _0x26343c=['FAIL','../myConfig/config','8bit','hd1080p','跳过保存NFO:','50771ouMOYS','tmdbProxyEnable','episodedetails','rmvb','跳过保存fanart:','allSettled','actorsOriginal','SUCCESS','coaster','tmdb_api_key','高清版','根据文件名和路径搜索','isFile','信息获取完毕','144kolEaV','replace','pipe','push','mov','readdirSync','catch','韩语中字','statusCode','episode_number','4137420JJQtOD','season','跳过非视频文件:','cmct','6audios','fgt','ultra-hd','168256KPwlMa','brrip','fast-xml-parser','extname','web-dl','https','dbOther','join','statSync','then','x265-terminal','getSeasonNumber','web','5.1','7audio','test','1294860RXXfPJ','year','blue-ray','Search\x20Worker:Tmdb代理已经开启','showtitle','genres','ddp','tmdbProxyUrl','stringify','log','stat','url','.nfo','tmdb_id','atmos','includes','eng','265-apex','error','IMG_','path','tmdb.没有获取到相关信息','3audio','extractEpisodeNumbers','-poster.jpg','5audio','STREAM','VID','every','uhd','surcode','season.nfo','title','ac3','toLowerCase','符合三级命名规则:','scrapeMissing','hdr','hevc','没有找到要保存的集信息\x20对应号码:','147252IMZAFW','API_SEASON_DETAIL','backdrop_url','dts-ift','postMessage','is_tvplay','tvshow.nfo','internal','better-sqlite3','pragma','tmdbid','3gp','pathname','port','2audios','1080p','240p','seriesInfo没找到季信息','x265','parse','poster.jpg','跳过保存海报:','nexusnf','中文字幕','aac','getDetail','ita','跳过不缺失任何信息的季','truehd','run','episodes','1942','tmdb_api_language','3audios','directorsOriginal','journal_mode\x20=\x20WAL','4ktrash','.tmp','getSeasonDetail','x260bit','bd1080p','readFileSync','startsWith','close','刮削任务结束','movie','iamable','IMG','bluray','7audios','../myConfig/mediaType','cover_url','要查询的数据不存在','some','西语中字','length','season海报和nfo保存完毕','tmdbId','dirname','阳光电影','x264','value','atmos-iamable','episode','dbFileIndex','x265-dvsux','API','整部剧的海报和nfo保存完毕','dolby-multi-bodhmall','exit','NFO','videoTypeList','regions','TMDB\x20search接口请求失败','toLocaleLowerCase','seasons','电影的海报和nfo保存完毕','season_number','status_message','hostname','电影天堂','creator','isDirectory','hdwing','prepare','4pxPerA','POSTER','10bit','split','322353wswPdM','trim','hdtv','atmos-swtyblz','filename','6audio','dts','高清mp4电影','directors','movie_name','.jpg','substring','1486335agRLvH','高清晰版','../utils/i18nUtil','swtyblz','vid_','actors','guestActorsOriginal','get','rargb','substr','search','480p','720p','createWriteStream','根据已有NFO刮削缺失集','keys','bdrip','请求失败:\x20HTTP\x20','../utils/movieSeasonUtil','mp4','dvsux','findByTitle','tmdb_api_url','阳光电影dygod.org','tvshow','fanart.jpg','mkv','creatorOriginal','../db/dbConfigTable','readdir','basename','dreamhd','h264','splice','existsSync'];_0x4461=function(){return _0x26343c;};return _0x4461();}function addScrapeLog(_0x2a6810,_0x3d3e2e,_0x466c68,_0xb7853f,_0x1989f4,_0x513600){const _0x17b950=_0x4b2d7d;dbFileIndex[_0x17b950(0x230)]('INSERT\x20INTO\x20movie_scrape_log(scrape_path,scrape_type,nfo_path,img_path,result,message,create_time)\x20VALUES(?,?,?,?,?,?,?)')[_0x17b950(0x1f9)](_0x2a6810,_0x3d3e2e,_0x466c68,_0xb7853f,_0x1989f4,_0x513600,Date['now']());}function getTvExistTmdbId(_0x2ff4ee){const _0x38c1cf=_0x4b2d7d;if(_0x2ff4ee['is_tvplay']!=0x1)return null;let _0x237e8b=path['dirname'](_0x2ff4ee[_0x38c1cf(0x1c8)]),_0xdd4a58=movieSeasonUtil[_0x38c1cf(0x1af)](path[_0x38c1cf(0x17b)](_0x2ff4ee[_0x38c1cf(0x1c8)]),!![]),_0x5b78a8=null,_0xed6cce='';_0xdd4a58>-0x1&&(_0xed6cce=path[_0x38c1cf(0x1ab)](_0x237e8b,'tvshow.nfo'));(!_0xed6cce||!fs[_0x38c1cf(0x17f)](_0xed6cce))&&(_0xed6cce=path[_0x38c1cf(0x1ab)](_0x2ff4ee[_0x38c1cf(0x1c8)],_0x38c1cf(0x1e2)));if(!_0xed6cce||!fs[_0x38c1cf(0x17f)](_0xed6cce))return null;const _0x1943df=new XMLParser();let _0x18c54d=_0x1943df[_0x38c1cf(0x1ef)](fs[_0x38c1cf(0x205)](_0xed6cce));return _0x18c54d[_0x38c1cf(0x259)]&&(_0x18c54d=_0x18c54d[_0x38c1cf(0x259)],_0x18c54d[_0x38c1cf(0x1e6)]&&(_0x5b78a8=_0x18c54d[_0x38c1cf(0x1e6)])),{'tmdbId':_0x5b78a8,'seassonNumber':_0xdd4a58};}function searchMovieInfo(_0x8d336b,_0x19e975){const _0xf43b3a=_0x4b2d7d;return!_0x19e975&&(_0x19e975=getQueryArray(_0x8d336b)),log(JSON[_0xf43b3a(0x1bc)](_0x19e975)),new Promise((_0x3d8762,_0x2fb507)=>{const _0x5c43dc=_0xf43b3a;function _0x38213d(){return _0x2fb507();}if(!_0x19e975||_0x19e975[_0x5c43dc(0x213)]<0x1)return log(_0x5c43dc(0x210)),_0x38213d();let _0x1ce4a2=_0x19e975[0x0][_0x5c43dc(0x1d4)],_0x23dbe3=_0x19e975[0x0][_0x5c43dc(0x1b5)];log('Matching\x20movie\x20information\x20',_0x1ce4a2[_0x5c43dc(0x1d4)]);let _0x40c600=getTmdbApi();if(!_0x40c600)return log('TMDB\x20api实例获取失败\x20请检查TMDB相关配置'),_0x38213d();let _0x2a3673=_0x8d336b['is_tvplay']==0x1;_0x40c600['search'](_0x1ce4a2,_0x2a3673,_0x23dbe3)[_0x5c43dc(0x1ad)](_0x1bd17a=>{const _0x4e4732=_0x5c43dc;if(_0x1bd17a&&_0x1bd17a[_0x4e4732(0x213)]>0x0){let _0x4f2e76=_0x1bd17a[0x0];onSearchFinish(_0x8d336b,_0x4f2e76[_0x4e4732(0x1c1)])[_0x4e4732(0x1ad)](()=>{return _0x3d8762();});}else{if(_0x19e975[_0x4e4732(0x213)]>0x1){let _0x172c2f=_0x19e975[_0x4e4732(0x17e)](0x1);return searchMovieInfo(_0x8d336b,_0x172c2f)[_0x4e4732(0x1ad)](_0x3d8762);}else return log(_0x4e4732(0x1c9),_0x1ce4a2),addScrapeLog(path[_0x4e4732(0x1ab)](workerData[_0x4e4732(0x1c8)]),'API_DETAIL','','',_0x4e4732(0x180),i18n['__']('noSearchResult')),_0x38213d();}})[_0x5c43dc(0x199)](_0x16e882=>{const _0x596718=_0x5c43dc;return log(_0x596718(0x225),_0x16e882),_0x38213d();});});}function returnResult(){const _0x58d1c3=_0x4b2d7d;log(_0x58d1c3(0x208)),parentPort[_0x58d1c3(0x1e0)]({'code':0x0}),process[_0x58d1c3(0x221)](0x0);}function log(_0x32192a){const _0x1bd305=_0x4b2d7d;parentPort[_0x1bd305(0x1e0)]({'type':_0x1bd305(0x1bd),'message':_0x32192a});}if(workerData&&workerData[_0x4b2d7d(0x239)]&&workerData[_0x4b2d7d(0x1c8)]&&workerData['tmdb_api_language']&&workerData['tmdb_api_key']&&workerData[_0x4b2d7d(0x257)]){if(workerData[_0x4b2d7d(0x1c1)])log('根据TMDBID搜索'),onSearchFinish(workerData,workerData[_0x4b2d7d(0x1c1)])[_0x4b2d7d(0x1ad)](_0x25eb13=>{const _0x1581a2=_0x4b2d7d;log(_0x1581a2(0x192),workerData[_0x1581a2(0x1c1)],workerData[_0x1581a2(0x1c8)],workerData[_0x1581a2(0x239)]),returnResult();})[_0x4b2d7d(0x199)](_0x24bddb=>{returnResult();});else{if(workerData[_0x4b2d7d(0x1d8)]==0x1){log(_0x4b2d7d(0x24f));let foundTmdbId=getTvExistTmdbId(workerData);if(!foundTmdbId||!foundTmdbId['tmdbId']){addScrapeLog(path[_0x4b2d7d(0x1ab)](workerData[_0x4b2d7d(0x1c8)]),'SCRAPE_MISSING','','',_0x4b2d7d(0x180),i18n['__']('tmdbidNotFound'));return;}let tmdbId=foundTmdbId[_0x4b2d7d(0x215)];onSearchFinish(workerData,tmdbId,!![])[_0x4b2d7d(0x1ad)](_0x4c0b89=>{const _0x447fa2=_0x4b2d7d;log(_0x447fa2(0x192)),returnResult();})['catch'](_0x2c0deb=>{returnResult();});}else log(_0x4b2d7d(0x190)),searchMovieInfo(workerData)[_0x4b2d7d(0x1ad)](_0x4dd60e=>{const _0x47c45b=_0x4b2d7d;log(_0x47c45b(0x192)+workerData[_0x47c45b(0x1c8)]+'\x20'+workerData[_0x47c45b(0x239)]),returnResult();})[_0x4b2d7d(0x199)](_0x2730d9=>{returnResult();});}}else log('信息不足\x20无法搜索\x20退出worker'),returnResult();