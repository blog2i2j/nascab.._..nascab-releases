const _0x46e672=_0x2d16;(function(_0x1b260d,_0x2d3dbd){const _0x25c498=_0x2d16,_0xa8f25b=_0x1b260d();while(!![]){try{const _0x1a00f1=parseInt(_0x25c498(0x98))/0x1+parseInt(_0x25c498(0x8c))/0x2+parseInt(_0x25c498(0xb0))/0x3+parseInt(_0x25c498(0x91))/0x4+parseInt(_0x25c498(0x96))/0x5*(parseInt(_0x25c498(0xa9))/0x6)+-parseInt(_0x25c498(0x9e))/0x7+-parseInt(_0x25c498(0x88))/0x8;if(_0x1a00f1===_0x2d3dbd)break;else _0xa8f25b['push'](_0xa8f25b['shift']());}catch(_0xdf95e2){_0xa8f25b['push'](_0xa8f25b['shift']());}}}(_0x57c3,0x6eae0));function _0x2d16(_0x306c31,_0x436f70){const _0x57c3f9=_0x57c3();return _0x2d16=function(_0x2d169f,_0x297385){_0x2d169f=_0x2d169f-0x82;let _0xb730a6=_0x57c3f9[_0x2d169f];return _0xb730a6;},_0x2d16(_0x306c31,_0x436f70);}const config=require('../myConfig/config');let path=require('path');const dbFileIndexTable=require('../db/dbFileIndexTable'),Database=require('better-sqlite3');let dbFileIndex=new Database(config[_0x46e672(0x82)],{'timeout':0xea60}),dbOther=new Database(config[_0x46e672(0xae)],{});dbOther[_0x46e672(0x89)]('journal_mode\x20=\x20WAL'),dbFileIndex[_0x46e672(0x89)](_0x46e672(0x8b));const nfoUtil=require(_0x46e672(0xaa)),messageUtil=require(_0x46e672(0xad)),movieInfoUtil=require('../utils/movieInfoUtil');process['title']=_0x46e672(0xa6);function updateMovieInfoState(_0x2c928b,_0x183363,_0x240d5b){const _0x51247c=_0x46e672;let _0x36aa8c=new Date()[_0x51247c(0x97)]();const _0x47dced='\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20file_index_movie\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20SET\x20movie_info_state='+_0x183363+',movie_info_get_time='+_0x36aa8c+_0x51247c(0x87)+_0x240d5b+_0x51247c(0x92)+_0x2c928b+_0x51247c(0x83);return dbFileIndex[_0x51247c(0x9c)](_0x47dced)[_0x51247c(0xa2)]();}function getInfoStart(){return new Promise((_0x1c85e0,_0x3ea438)=>{const _0x105fff=_0x2d16;let _0x3ecf8e=0x400*0x400*0x64,_0x1b9278=dbFileIndexTable[_0x105fff(0xb1)](dbFileIndex,_0x105fff(0x90)+_0x3ecf8e+_0x105fff(0x8f),'*',_0x105fff(0xa4));if(_0x1b9278){let _0x52788b=path[_0x105fff(0xa8)](_0x1b9278[_0x105fff(0xac)],_0x1b9278['filename']);nfoUtil[_0x105fff(0x95)](_0x1b9278,!![],![])[_0x105fff(0x9b)](_0x38207f=>{const _0x58936a=_0x105fff;return updateMovieInfoState(_0x1b9278['id'],0x1,0x1),movieInfoUtil[_0x58936a(0xa7)](dbFileIndex,_0x1b9278['id'],_0x38207f),_0x1c85e0({'usedNfo':!![]});})[_0x105fff(0x99)](_0x286f82=>{const _0x3fd143=_0x105fff;let _0x4628b2=_0x3fd143(0x86)+_0x3fd143(0x94)+path[_0x3fd143(0x85)]+'%\x27',_0x4b0ad7=dbOther[_0x3fd143(0x9c)](_0x4628b2)[_0x3fd143(0x9a)](path[_0x3fd143(0xa8)](_0x1b9278[_0x3fd143(0xac)],_0x1b9278[_0x3fd143(0xb2)]));if(_0x4b0ad7&&_0x4b0ad7[_0x3fd143(0x93)]==0x1)return updateMovieInfoState(_0x1b9278['id'],0x3,0x1),_0x1c85e0();console['log'](_0x3fd143(0x8a),_0x1b9278[_0x3fd143(0xb2)],_0x1b9278[_0x3fd143(0x8d)]),movieInfoUtil[_0x3fd143(0xaf)](dbOther,_0x1b9278['path'],_0x1b9278[_0x3fd143(0xb2)],_0x1b9278['is_tvplay'])['then'](_0x3b3139=>{const _0x3cf08a=_0x3fd143;updateMovieInfoState(_0x1b9278['id'],0x1,0x1),nfoUtil['parseNfo'](_0x1b9278,!![],![])['then'](_0x13a206=>{const _0x5470bf=_0x2d16;return movieInfoUtil[_0x5470bf(0xa7)](dbFileIndex,_0x1b9278['id'],_0x13a206),_0x1c85e0();})[_0x3cf08a(0x99)](_0x319d81=>{return _0x1c85e0();});})[_0x3fd143(0x99)](_0x1efae7=>{const _0x177366=_0x3fd143;return console[_0x177366(0x9d)]('nfo获取失败了'),updateMovieInfoState(_0x1b9278['id'],0x3,0x1),_0x1c85e0();});});}else exitProcess();});}function _0x57c3(){const _0x2d5a43=['6udQVMK','../utils/nfoUtil','send','path','../utils/messageUtil','dbOther','runSearchNfoWorker','1697268rCyRZg','getByWhere','filename','dbFileIndex','\x0a\x09\x20\x20\x20\x20','message','sep','SELECT\x20*\x20FROM\x20source_folder\x20where\x20type=\x27movie\x27\x20AND\x20\x20?\x20like\x20',',movie_info_get_times=','20315832DgUdZC','pragma','开始查询','journal_mode\x20=\x20WAL','1688380fDkBRm','movie_info_state','Error\x20occurred\x20in\x20movie\x20info\x20searching\x20process','\x20LIMIT\x201','\x20movie_info_state=0\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20size>','2757868tGdsvA','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id=','ignore_match_info','`path`||\x27','parseNfo','3912835oqPmac','getTime','885621bVMNEL','catch','get','then','prepare','log','5423446JPvjxH','uncaughtException','usedNfo','exit','run','close','file_index_movie','stack','NasCabMovieNfoWorker','saveMovieInfoToDb','join'];_0x57c3=function(){return _0x2d5a43;};return _0x57c3();}function exitProcess(){const _0x50ea81=_0x46e672;try{dbOther['close'](),dbFileIndex['close']();}catch(_0x3abdcd){}process[_0x50ea81(0xab)]({'type':_0x50ea81(0xa3)}),process[_0x50ea81(0xa1)]();}async function runGetMovieInfo(){const _0x44e0be=_0x46e672;getInfoStart()[_0x44e0be(0x9b)](_0x16fc1b=>{const _0x283de3=_0x44e0be;_0x16fc1b&&_0x16fc1b[_0x283de3(0xa0)]?runGetMovieInfo():setTimeout(()=>{runGetMovieInfo();},0x1388);})[_0x44e0be(0x99)](_0x156df3=>{const _0x1b9183=_0x44e0be;console[_0x1b9183(0x9d)](_0x156df3),exitProcess();});}runGetMovieInfo(),process['on'](_0x46e672(0x9f),(_0x4b21a6,_0x55c8f0)=>{const _0x1f8058=_0x46e672;console[_0x1f8058(0x9d)](_0x4b21a6),messageUtil['saveMsg'](dbOther,_0x1f8058(0x8e),'error',_0x4b21a6[_0x1f8058(0xa5)]||_0x4b21a6[_0x1f8058(0x84)]);});