const _0x5b1ab3=_0x1960;(function(_0x264041,_0x205648){const _0x2e5e0e=_0x1960,_0x2e151b=_0x264041();while(!![]){try{const _0x4d1297=parseInt(_0x2e5e0e(0xeb))/0x1+parseInt(_0x2e5e0e(0x116))/0x2*(parseInt(_0x2e5e0e(0xfe))/0x3)+parseInt(_0x2e5e0e(0x103))/0x4+parseInt(_0x2e5e0e(0xf7))/0x5*(-parseInt(_0x2e5e0e(0xe8))/0x6)+parseInt(_0x2e5e0e(0xf2))/0x7*(-parseInt(_0x2e5e0e(0x101))/0x8)+-parseInt(_0x2e5e0e(0x106))/0x9+-parseInt(_0x2e5e0e(0x105))/0xa*(-parseInt(_0x2e5e0e(0x107))/0xb);if(_0x4d1297===_0x205648)break;else _0x2e151b['push'](_0x2e151b['shift']());}catch(_0x367709){_0x2e151b['push'](_0x2e151b['shift']());}}}(_0x5a92,0x88a3c));const config=require('../myConfig/config');function _0x1960(_0x4206b9,_0x445e32){const _0x5a92ae=_0x5a92();return _0x1960=function(_0x196036,_0xf2fb08){_0x196036=_0x196036-0xe8;let _0x494df6=_0x5a92ae[_0x196036];return _0x494df6;},_0x1960(_0x4206b9,_0x445e32);}let path=require('path');function _0x5a92(){const _0x385fde=['getTime','../utils/nfoUtil','catch','file_index_movie','saveMsg','prepare','147KjZMOS',',movie_info_get_times=','\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id=','32jxJDHp','../utils/messageUtil','2812928mVWOSe','dbOther','10tcgFVv','6899454BNROzM','543807xJfqZx','\x0a\x09\x20\x20\x20\x20','saveMovieInfoToDb','error','\x20movie_info_state=0\x20and\x20is_file=1\x20and\x20type=2\x20and\x20show_in_list=1\x20and\x20size>','ignore_match_info','\x20LIMIT\x201','../utils/movieInfoUtil','getByWhere','title','NasCabMovieNfoWorker','message','journal_mode\x20=\x20WAL','开始查询','usedNfo','39166zCCcKE','filename','path','sep','log','48714KrhaSP','stack','nfo获取失败了','811345fSQeFr','is_tvplay','better-sqlite3','close','then','`path`||\x27','dbFileIndex','1853733bkhKxd','movie_info_state','join','../db/dbFileIndexTable','pragma','85ybHniJ'];_0x5a92=function(){return _0x385fde;};return _0x5a92();}const dbFileIndexTable=require(_0x5b1ab3(0xf5)),Database=require(_0x5b1ab3(0xed));let dbFileIndex=new Database(config[_0x5b1ab3(0xf1)],{'timeout':0xea60}),dbOther=new Database(config[_0x5b1ab3(0x104)],{});dbOther[_0x5b1ab3(0xf6)](_0x5b1ab3(0x113)),dbFileIndex[_0x5b1ab3(0xf6)](_0x5b1ab3(0x113));const nfoUtil=require(_0x5b1ab3(0xf9)),messageUtil=require(_0x5b1ab3(0x102)),movieInfoUtil=require(_0x5b1ab3(0x10e));process[_0x5b1ab3(0x110)]=_0x5b1ab3(0x111);function updateMovieInfoState(_0x26d3f1,_0x18711b,_0x321215){const _0x5731ee=_0x5b1ab3;let _0x49a458=new Date()[_0x5731ee(0xf8)]();const _0x20a902='\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20file_index_movie\x0a\x09\x20\x20\x20\x20\x20\x20\x20\x20SET\x20movie_info_state='+_0x18711b+',movie_info_get_time='+_0x49a458+_0x5731ee(0xff)+_0x321215+_0x5731ee(0x100)+_0x26d3f1+_0x5731ee(0x108);return dbFileIndex['prepare'](_0x20a902)['run']();}function getInfoStart(){return new Promise((_0x22793e,_0x282ab0)=>{const _0x307e33=_0x1960;let _0x4873cd=0x400*0x400*0x64,_0x5ef42d=dbFileIndexTable[_0x307e33(0x10f)](dbFileIndex,_0x307e33(0x10b)+_0x4873cd+_0x307e33(0x10d),'*',_0x307e33(0xfb));if(_0x5ef42d){let _0x4b1a94=path[_0x307e33(0xf4)](_0x5ef42d[_0x307e33(0x118)],_0x5ef42d['filename']);nfoUtil['parseNfo'](_0x5ef42d,!![],![])['then'](_0x251e81=>{const _0x553861=_0x307e33;return updateMovieInfoState(_0x5ef42d['id'],0x1,0x1),movieInfoUtil[_0x553861(0x109)](dbFileIndex,_0x5ef42d['id'],_0x251e81),_0x22793e({'usedNfo':!![]});})[_0x307e33(0xfa)](_0x22ea71=>{const _0x55a241=_0x307e33;let _0x3cef05='SELECT\x20*\x20FROM\x20source_folder\x20where\x20type=\x27movie\x27\x20AND\x20\x20?\x20like\x20'+_0x55a241(0xf0)+path[_0x55a241(0x119)]+'%\x27',_0x1b02c8=dbOther[_0x55a241(0xfd)](_0x3cef05)['get'](path[_0x55a241(0xf4)](_0x5ef42d[_0x55a241(0x118)],_0x5ef42d[_0x55a241(0x117)]));if(_0x1b02c8&&_0x1b02c8[_0x55a241(0x10c)]==0x1)return updateMovieInfoState(_0x5ef42d['id'],0x3,0x1),_0x22793e();console['log'](_0x55a241(0x114),_0x5ef42d[_0x55a241(0x117)],_0x5ef42d[_0x55a241(0xf3)]),movieInfoUtil['runSearchNfoWorker'](dbOther,_0x5ef42d['path'],_0x5ef42d[_0x55a241(0x117)],_0x5ef42d[_0x55a241(0xec)])[_0x55a241(0xef)](_0x2e6282=>{const _0x5760de=_0x55a241;updateMovieInfoState(_0x5ef42d['id'],0x1,0x1),nfoUtil['parseNfo'](_0x5ef42d,!![],![])['then'](_0x53345b=>{const _0x467fa7=_0x1960;return movieInfoUtil[_0x467fa7(0x109)](dbFileIndex,_0x5ef42d['id'],_0x53345b),_0x22793e();})[_0x5760de(0xfa)](_0x47c93f=>{return _0x22793e();});})[_0x55a241(0xfa)](_0x314def=>{const _0x32dc48=_0x55a241;return console['log'](_0x32dc48(0xea)),updateMovieInfoState(_0x5ef42d['id'],0x3,0x1),_0x22793e();});});}else exitProcess();});}function exitProcess(){const _0x18bdd6=_0x5b1ab3;try{dbOther[_0x18bdd6(0xee)](),dbFileIndex[_0x18bdd6(0xee)]();}catch(_0x2fe71f){}process['send']({'type':'close'}),process['exit']();}async function runGetMovieInfo(){const _0x3b3fa6=_0x5b1ab3;getInfoStart()[_0x3b3fa6(0xef)](_0x57435e=>{const _0x5290ce=_0x3b3fa6;_0x57435e&&_0x57435e[_0x5290ce(0x115)]?runGetMovieInfo():setTimeout(()=>{runGetMovieInfo();},0x1388);})['catch'](_0x4146d1=>{const _0x34e694=_0x3b3fa6;console[_0x34e694(0x11a)](_0x4146d1),exitProcess();});}runGetMovieInfo(),process['on']('uncaughtException',(_0x2fbbb8,_0x1a91bc)=>{const _0x1234a5=_0x5b1ab3;console['log'](_0x2fbbb8),messageUtil[_0x1234a5(0xfc)](dbOther,'Error\x20occurred\x20in\x20movie\x20info\x20searching\x20process',_0x1234a5(0x10a),_0x2fbbb8[_0x1234a5(0xe9)]||_0x2fbbb8[_0x1234a5(0x112)]);});