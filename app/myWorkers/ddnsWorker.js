const _0x561b93=_0x1332;(function(_0x21a464,_0x251400){const _0x1dd5da=_0x1332,_0x2ffe5e=_0x21a464();while(!![]){try{const _0x2ad024=-parseInt(_0x1dd5da(0x180))/0x1*(-parseInt(_0x1dd5da(0x19a))/0x2)+-parseInt(_0x1dd5da(0x191))/0x3*(-parseInt(_0x1dd5da(0x187))/0x4)+-parseInt(_0x1dd5da(0x177))/0x5+-parseInt(_0x1dd5da(0x16e))/0x6+parseInt(_0x1dd5da(0x15d))/0x7+-parseInt(_0x1dd5da(0x174))/0x8+parseInt(_0x1dd5da(0x185))/0x9;if(_0x2ad024===_0x251400)break;else _0x2ffe5e['push'](_0x2ffe5e['shift']());}catch(_0xc339f){_0x2ffe5e['push'](_0x2ffe5e['shift']());}}}(_0x1130,0xcfdf9));let path=require(_0x561b93(0x178)),fs=require('fs');function _0x1130(){const _0x5a99a0=['proxy.noSubdomain','apiGetIpv6','force','ddnsIp','1esDszQ','getI18n','DDNS\x20stop','start','ddns','18192825PDcnaz','ipv4','144712OKDeev','proxy.isntVip','subdomain','axios','获取公网ip失败','log','parse','apiBaseUrl','globalIpList','ipv6','21eWPdgF','create','journal_mode\x20=\x20WAL','Start\x20ddns...','ipv6addressNotFound','better-sqlite3','nasAccountInfoPwd','ddnsType','exit','1288348kwmSvM','success','type','findByTitle','data','value','nasAccountInfoConfigKey','then','../myConfig/config','send','message','3119389SoYgAc','stop','stack','../utils/messageUtil','proxy.conFail','User\x20didn\x27t\x20login\x20nascab','error','stopDdns','title','vipInfo','ipv6Address','ddnsIpv4Address','decryptString','code','proxy.noLoginInfo','length','deleteByTitle','3185328inZVId','fail','ddnsIpv6Address','close','apiGetIpv4','../express-server/utils/cryptoUtils','13185848rVRGzM','catch','token','1669520Yinlmc','path','../utils/i18nUtil','uncaughtException','dbOther'];_0x1130=function(){return _0x5a99a0;};return _0x1130();}const config=require(_0x561b93(0x1a2)),Database=require(_0x561b93(0x196));let dbOther=new Database(config[_0x561b93(0x17b)],{});function _0x1332(_0x19f9d1,_0x41412f){const _0x1130f3=_0x1130();return _0x1332=function(_0x1332a2,_0x55b15f){_0x1332a2=_0x1332a2-0x15d;let _0x9304f7=_0x1130f3[_0x1332a2];return _0x9304f7;},_0x1332(_0x19f9d1,_0x41412f);}dbOther['pragma'](_0x561b93(0x193));let dbConfigTable=require('../db/dbConfigTable'),cryptoUtils=require(_0x561b93(0x173)),axios=require(_0x561b93(0x18a)),i18nUtil=require(_0x561b93(0x179)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,reqInterval;const messageUtil=require(_0x561b93(0x160));process[_0x561b93(0x165)]='NasCabDDNSWorker',process['on'](_0x561b93(0x17a),(_0x59a0cc,_0x5f3b78)=>{const _0xafcc51=_0x561b93;messageUtil['saveMsg'](dbOther,'Error\x20occurred\x20in\x20ddns\x20process',_0xafcc51(0x163),_0x59a0cc[_0xafcc51(0x15f)]||_0x59a0cc[_0xafcc51(0x1a4)]);}),process['on'](_0x561b93(0x199),()=>{const _0x410fb0=_0x561b93;reqInterval&&clearInterval(reqInterval),dbOther[_0x410fb0(0x171)]();});function exitProcess(){const _0x4f2f15=_0x561b93;console['log'](_0x4f2f15(0x182)),process[_0x4f2f15(0x1a3)]({'type':'close'}),process[_0x4f2f15(0x199)]();}process['on'](_0x561b93(0x1a4),_0x3f445a=>{const _0x513e29=_0x561b93;if(_0x3f445a['type']==_0x513e29(0x183))startDdns();else _0x3f445a[_0x513e29(0x19c)]==_0x513e29(0x15e)&&exitProcess();});function getDdnsType(){const _0x3f0809=_0x561b93;let _0x518c2a=dbConfigTable[_0x3f0809(0x19d)](dbOther,_0x3f0809(0x198));return!_0x518c2a?_0x518c2a=_0x3f0809(0x186):_0x518c2a=_0x518c2a[_0x3f0809(0x19f)],_0x518c2a;}function saveNasDdnsState(_0x25fd62,_0x27a555,_0x193256,_0x28db7f){const _0xfcc0ea=_0x561b93;dbConfigTable[_0xfcc0ea(0x192)](dbOther,{'title':'nasDdnsState','value':JSON['stringify']({'status':_0x25fd62,'ddnsIp':_0x27a555,'error':_0x193256})}),_0x25fd62=='fail'&&!_0x28db7f&&exitProcess();}function reqSetDDNS(_0xfd6a24,_0x2cf26f){const _0x500ed3=_0x561b93;let _0x24951c=getDdnsType(),_0xd117ba='',_0x29048e='';_0x24951c==_0x500ed3(0x190)?(dbConfigTable[_0x500ed3(0x16d)](dbOther,_0x500ed3(0x168)),getMyIp(_0x24951c,_0x185ca3=>{const _0x471e30=_0x500ed3;if(_0x185ca3)_0xd117ba=_0x185ca3,_0x4f5d79();else try{let _0x524a3a=dbConfigTable[_0x471e30(0x19d)](dbOther,_0x471e30(0x18f));_0x524a3a&&(_0x524a3a=JSON[_0x471e30(0x18d)](_0x524a3a['value']));for(let _0x402f00 in _0x524a3a){if(_0x524a3a[_0x402f00][_0x471e30(0x19c)]=='ipv6'){_0xd117ba=_0x524a3a[_0x402f00]['ip'];break;}}if(_0xd117ba)_0x4f5d79();else return saveNasDdnsState(_0x471e30(0x16f),'',i18n['__']('ipv6addressNotFound'));}catch(_0x4eb54d){return saveNasDdnsState(_0x471e30(0x16f),'',i18n['__'](_0x471e30(0x195)));}})):(dbConfigTable[_0x500ed3(0x16d)](dbOther,_0x500ed3(0x170)),getMyIp(_0x24951c,_0x5df904=>{_0x29048e=_0x5df904,_0x4f5d79();}));function _0x4f5d79(){const _0x47b532=_0x500ed3;let _0x48318b={'token':userToken,'type':_0xfd6a24?'startDdns':_0x47b532(0x164)};_0x24951c&&(_0x48318b[_0x47b532(0x198)]=_0x24951c);_0xd117ba&&(_0x48318b[_0x47b532(0x167)]=_0xd117ba);if(_0x24951c==_0x47b532(0x190)&&_0xd117ba&&!_0x2cf26f){let _0x1a3b02=dbConfigTable[_0x47b532(0x19d)](dbOther,_0x47b532(0x170));if(_0x1a3b02&&_0x1a3b02[_0x47b532(0x19f)]==_0xd117ba)return;}if(_0x24951c==_0x47b532(0x186)&&_0x29048e&&!_0x2cf26f){let _0x2a6e2d=dbConfigTable[_0x47b532(0x19d)](dbOther,_0x47b532(0x168));if(_0x2a6e2d&&_0x2a6e2d[_0x47b532(0x19f)]==_0x29048e)return;}_0x2cf26f&&_0x2cf26f==0x1&&(_0x48318b[_0x47b532(0x17e)]=_0x2cf26f),axios['post'](config[_0x47b532(0x18e)]+_0x47b532(0x184),_0x48318b)[_0x47b532(0x1a1)](_0x4a19b4=>{const _0x31cb5c=_0x47b532;return _0x4a19b4['data'][_0x31cb5c(0x16a)]?saveNasDdnsState(_0x31cb5c(0x16f),'',i18n['__'](_0x31cb5c(0x161)),!![]):(_0x24951c==_0x31cb5c(0x190)&&dbConfigTable[_0x31cb5c(0x192)](dbOther,{'title':_0x31cb5c(0x170),'value':_0x4a19b4[_0x31cb5c(0x19e)]['ddnsIp']}),_0x24951c==_0x31cb5c(0x186)&&dbConfigTable[_0x31cb5c(0x192)](dbOther,{'title':_0x31cb5c(0x168),'value':_0x4a19b4[_0x31cb5c(0x19e)]['ddnsIp']}),console['log']('DDNS\x20设置成功：\x20',_0x4a19b4[_0x31cb5c(0x19e)][_0x31cb5c(0x17f)]),saveNasDdnsState(_0x31cb5c(0x19b),_0x4a19b4['data'][_0x31cb5c(0x17f)],''));})[_0x47b532(0x175)](_0x231a26=>{console['log']('DDNS\x20设置失败,\x20网络请求失败');});}}let startDdns=async function(){const _0x3a2208=_0x561b93;console['log'](_0x3a2208(0x194));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0x3a2208(0x181)](dbOther);let _0x45e515=dbConfigTable['findByTitle'](dbOther,'nasDdnsEnable');if(!_0x45e515||_0x45e515[_0x3a2208(0x19f)]!=0x1)return console[_0x3a2208(0x18c)]('DDNS\x20is\x20not\x20open'),reqSetDDNS(![]),saveNasDdnsState(_0x3a2208(0x16f),'','OFF');let _0x3049e1=dbConfigTable[_0x3a2208(0x19d)](dbOther,config[_0x3a2208(0x1a0)]);if(!_0x3049e1)return console[_0x3a2208(0x18c)](_0x3a2208(0x162)),saveNasDdnsState(_0x3a2208(0x16f),'',i18n['__'](_0x3a2208(0x16b)));cryptoUtils[_0x3a2208(0x169)](config[_0x3a2208(0x197)],_0x3049e1['value'])['then'](_0x2787ca=>{const _0x4e754e=_0x3a2208;let _0x2c7f57=JSON[_0x4e754e(0x18d)](_0x2787ca),_0x82d1d1=_0x2c7f57['userInfo'],_0x50bf17=_0x2c7f57[_0x4e754e(0x166)];_0x82d1d1['token']&&_0x82d1d1[_0x4e754e(0x176)][_0x4e754e(0x16c)]>0x0&&(userToken=_0x82d1d1[_0x4e754e(0x176)][_0x82d1d1[_0x4e754e(0x176)]['length']-0x1]);if(!userToken)return saveNasDdnsState(_0x4e754e(0x16f),'',i18n['__'](_0x4e754e(0x16b)));if(!_0x50bf17)return saveNasDdnsState(_0x4e754e(0x16f),'',i18n['__'](_0x4e754e(0x188)));if(!_0x50bf17[_0x4e754e(0x189)])return saveNasDdnsState(_0x4e754e(0x16f),'',i18n['__'](_0x4e754e(0x17c)));let _0x5b7a52=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x5b7a52==_0x4e754e(0x186)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x3a2208(0x175)](_0x4175fb=>{const _0x1bc128=_0x3a2208;console[_0x1bc128(0x18c)](_0x4175fb),dbConfigTable[_0x1bc128(0x16d)](dbOther,config['nasAccountInfoConfigKey']);});};function getMyIp(_0x15de90,_0x5800c3){const _0x405e48=_0x561b93;let _0x505b87=config[_0x405e48(0x172)];_0x15de90==_0x405e48(0x190)&&(_0x505b87=config[_0x405e48(0x17d)]);const _0x5888aa={'timeout':0x2710};axios['post'](_0x505b87,{},_0x5888aa)[_0x405e48(0x1a1)](_0x479f31=>{const _0x16836b=_0x405e48;_0x479f31&&_0x479f31['data']&&_0x479f31['data']['ip']?_0x5800c3&&_0x5800c3(_0x479f31[_0x16836b(0x19e)]['ip']):(console[_0x16836b(0x18c)]('获取公网ip失败'),_0x5800c3&&_0x5800c3(null));})[_0x405e48(0x175)](_0x270ad1=>{const _0x54dde7=_0x405e48;console['log'](_0x54dde7(0x18b),_0x270ad1[_0x54dde7(0x15f)]),_0x5800c3&&_0x5800c3(null);});}startDdns();