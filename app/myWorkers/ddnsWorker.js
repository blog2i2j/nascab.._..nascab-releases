const _0x5c8c11=_0x4420;(function(_0x4ad769,_0x229bdb){const _0x3b8269=_0x4420,_0x929d85=_0x4ad769();while(!![]){try{const _0x3e727f=-parseInt(_0x3b8269(0x18e))/0x1+-parseInt(_0x3b8269(0x1a0))/0x2+-parseInt(_0x3b8269(0x167))/0x3*(-parseInt(_0x3b8269(0x178))/0x4)+-parseInt(_0x3b8269(0x17d))/0x5+parseInt(_0x3b8269(0x170))/0x6*(parseInt(_0x3b8269(0x165))/0x7)+-parseInt(_0x3b8269(0x19f))/0x8+parseInt(_0x3b8269(0x199))/0x9;if(_0x3e727f===_0x229bdb)break;else _0x929d85['push'](_0x929d85['shift']());}catch(_0x2647a5){_0x929d85['push'](_0x929d85['shift']());}}}(_0x5c16,0x4b268));let path=require(_0x5c8c11(0x186)),fs=require('fs');function _0x4420(_0x281615,_0x9d477a){const _0x5c163b=_0x5c16();return _0x4420=function(_0x442055,_0x519b26){_0x442055=_0x442055-0x162;let _0x3fe11f=_0x5c163b[_0x442055];return _0x3fe11f;},_0x4420(_0x281615,_0x9d477a);}const config=require(_0x5c8c11(0x19c)),Database=require(_0x5c8c11(0x1aa));function _0x5c16(){const _0x49a342=['parse','error','journal_mode\x20=\x20WAL','OFF','../utils/i18nUtil','获取公网ip失败','apiGetIpv6','userInfo','path','vipInfo','ipv6addressNotFound','then','nasAccountInfoPwd','ipv4','proxy.noSubdomain','DDNS\x20is\x20not\x20open','144982mMJCLP','stringify','create','nasDdnsEnable','proxy.isntVip','value','data','ipv6','axios','nasDdnsState','ddns','10882422TpprIc','saveMsg','../db/dbConfigTable','../myConfig/config','apiBaseUrl','token','4510416CPAYDI','899298ZzAiUR','findByTitle','type','proxy.conFail','uncaughtException','length','startDdns','proxy.noLoginInfo','Error\x20occurred\x20in\x20ddns\x20process','deleteByTitle','better-sqlite3','stack','exit','decryptString','globalIpList','nasAccountInfoConfigKey','force','148071rgLJRh','log','97683MIrgsb','fail','subdomain','ddnsType','../utils/messageUtil','ddnsIpv4Address','apiGetIpv4','dbOther','success','114glnJIs','Start\x20ddns...','ddnsIpv6Address','DDNS\x20设置成功：\x20','post','ddnsIp','close','NasCabDDNSWorker','16HkZSdL','User\x20didn\x27t\x20login\x20nascab','start','catch','message','1375300PxaUsE'];_0x5c16=function(){return _0x49a342;};return _0x5c16();}let dbOther=new Database(config[_0x5c8c11(0x16e)],{});dbOther['pragma'](_0x5c8c11(0x180));let dbConfigTable=require(_0x5c8c11(0x19b)),cryptoUtils=require('../express-server/utils/cryptoUtils'),axios=require(_0x5c8c11(0x196)),i18nUtil=require(_0x5c8c11(0x182)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,reqInterval;const messageUtil=require(_0x5c8c11(0x16b));process['title']=_0x5c8c11(0x177),process['on'](_0x5c8c11(0x1a4),(_0x177d55,_0x5e6cf8)=>{const _0x48c277=_0x5c8c11;messageUtil[_0x48c277(0x19a)](dbOther,_0x48c277(0x1a8),_0x48c277(0x17f),_0x177d55[_0x48c277(0x1ab)]||_0x177d55[_0x48c277(0x17c)]);}),process['on'](_0x5c8c11(0x1ac),()=>{const _0x2d5032=_0x5c8c11;reqInterval&&clearInterval(reqInterval),dbOther[_0x2d5032(0x176)]();});function exitProcess(){const _0x1c4136=_0x5c8c11;console[_0x1c4136(0x166)]('DDNS\x20stop'),process['send']({'type':'close'}),process[_0x1c4136(0x1ac)]();}process['on'](_0x5c8c11(0x17c),_0x2111e7=>{const _0x3236d1=_0x5c8c11;if(_0x2111e7['type']==_0x3236d1(0x17a))startDdns();else _0x2111e7[_0x3236d1(0x1a2)]=='stop'&&exitProcess();});function getDdnsType(){const _0x3474f7=_0x5c8c11;let _0x4878b9=dbConfigTable['findByTitle'](dbOther,_0x3474f7(0x16a));return!_0x4878b9?_0x4878b9=_0x3474f7(0x18b):_0x4878b9=_0x4878b9[_0x3474f7(0x193)],_0x4878b9;}function saveNasDdnsState(_0x2c0098,_0xf05983,_0x50fd5e,_0x2d32c6){const _0x3cd7e8=_0x5c8c11;dbConfigTable['create'](dbOther,{'title':_0x3cd7e8(0x197),'value':JSON[_0x3cd7e8(0x18f)]({'status':_0x2c0098,'ddnsIp':_0xf05983,'error':_0x50fd5e})}),_0x2c0098==_0x3cd7e8(0x168)&&!_0x2d32c6&&exitProcess();}function reqSetDDNS(_0x109506,_0xe31fde){const _0x126452=_0x5c8c11;let _0x24cb45=getDdnsType(),_0x466696='',_0x4b1c27='';_0x24cb45==_0x126452(0x195)?(dbConfigTable[_0x126452(0x1a9)](dbOther,_0x126452(0x16c)),getMyIp(_0x24cb45,_0x27787f=>{const _0x51b53b=_0x126452;if(_0x27787f)_0x466696=_0x27787f,_0x1e8ab4();else try{let _0x583258=dbConfigTable[_0x51b53b(0x1a1)](dbOther,_0x51b53b(0x162));_0x583258&&(_0x583258=JSON[_0x51b53b(0x17e)](_0x583258[_0x51b53b(0x193)]));for(let _0x46176f in _0x583258){if(_0x583258[_0x46176f][_0x51b53b(0x1a2)]==_0x51b53b(0x195)){_0x466696=_0x583258[_0x46176f]['ip'];break;}}if(_0x466696)_0x1e8ab4();else return saveNasDdnsState('fail','',i18n['__'](_0x51b53b(0x188)));}catch(_0x2b492a){return saveNasDdnsState(_0x51b53b(0x168),'',i18n['__']('ipv6addressNotFound'));}})):(dbConfigTable[_0x126452(0x1a9)](dbOther,_0x126452(0x172)),getMyIp(_0x24cb45,_0x962a42=>{_0x4b1c27=_0x962a42,_0x1e8ab4();}));function _0x1e8ab4(){const _0x360e84=_0x126452;let _0x1d5691={'token':userToken,'type':_0x109506?_0x360e84(0x1a6):'stopDdns'};_0x24cb45&&(_0x1d5691['ddnsType']=_0x24cb45);_0x466696&&(_0x1d5691['ipv6Address']=_0x466696);if(_0x24cb45=='ipv6'&&_0x466696&&!_0xe31fde){let _0x47f230=dbConfigTable[_0x360e84(0x1a1)](dbOther,_0x360e84(0x172));if(_0x47f230&&_0x47f230['value']==_0x466696)return;}if(_0x24cb45==_0x360e84(0x18b)&&_0x4b1c27&&!_0xe31fde){let _0x512e8a=dbConfigTable[_0x360e84(0x1a1)](dbOther,_0x360e84(0x16c));if(_0x512e8a&&_0x512e8a['value']==_0x4b1c27)return;}_0xe31fde&&_0xe31fde==0x1&&(_0x1d5691[_0x360e84(0x164)]=_0xe31fde),axios['post'](config[_0x360e84(0x19d)]+_0x360e84(0x198),_0x1d5691)[_0x360e84(0x189)](_0x3428e5=>{const _0x263915=_0x360e84;return _0x3428e5[_0x263915(0x194)]['code']?saveNasDdnsState(_0x263915(0x168),'',i18n['__'](_0x263915(0x1a3)),!![]):(_0x24cb45==_0x263915(0x195)&&dbConfigTable[_0x263915(0x190)](dbOther,{'title':'ddnsIpv6Address','value':_0x3428e5['data'][_0x263915(0x175)]}),_0x24cb45==_0x263915(0x18b)&&dbConfigTable[_0x263915(0x190)](dbOther,{'title':_0x263915(0x16c),'value':_0x3428e5[_0x263915(0x194)][_0x263915(0x175)]}),console['log'](_0x263915(0x173),_0x3428e5[_0x263915(0x194)][_0x263915(0x175)]),saveNasDdnsState(_0x263915(0x16f),_0x3428e5['data'][_0x263915(0x175)],''));})[_0x360e84(0x17b)](_0x3a7350=>{const _0x3b4115=_0x360e84;console[_0x3b4115(0x166)]('DDNS\x20设置失败,\x20网络请求失败');});}}let startDdns=async function(){const _0x3455ce=_0x5c8c11;console[_0x3455ce(0x166)](_0x3455ce(0x171));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil['getI18n'](dbOther);let _0xfca4a6=dbConfigTable[_0x3455ce(0x1a1)](dbOther,_0x3455ce(0x191));if(!_0xfca4a6||_0xfca4a6['value']!=0x1)return console[_0x3455ce(0x166)](_0x3455ce(0x18d)),reqSetDDNS(![]),saveNasDdnsState(_0x3455ce(0x168),'',_0x3455ce(0x181));let _0x18edb5=dbConfigTable['findByTitle'](dbOther,config[_0x3455ce(0x163)]);if(!_0x18edb5)return console['log'](_0x3455ce(0x179)),saveNasDdnsState(_0x3455ce(0x168),'',i18n['__']('proxy.noLoginInfo'));cryptoUtils[_0x3455ce(0x1ad)](config[_0x3455ce(0x18a)],_0x18edb5['value'])[_0x3455ce(0x189)](_0x11843d=>{const _0x817b67=_0x3455ce;let _0x4523b8=JSON[_0x817b67(0x17e)](_0x11843d),_0x2b9af6=_0x4523b8[_0x817b67(0x185)],_0x40690a=_0x4523b8[_0x817b67(0x187)];_0x2b9af6['token']&&_0x2b9af6[_0x817b67(0x19e)][_0x817b67(0x1a5)]>0x0&&(userToken=_0x2b9af6['token'][_0x2b9af6[_0x817b67(0x19e)]['length']-0x1]);if(!userToken)return saveNasDdnsState(_0x817b67(0x168),'',i18n['__'](_0x817b67(0x1a7)));if(!_0x40690a)return saveNasDdnsState(_0x817b67(0x168),'',i18n['__'](_0x817b67(0x192)));if(!_0x40690a[_0x817b67(0x169)])return saveNasDdnsState('fail','',i18n['__'](_0x817b67(0x18c)));let _0x5a1ba8=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x5a1ba8=='ipv4'?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x3455ce(0x17b)](_0x24b12b=>{const _0x4e5389=_0x3455ce;console[_0x4e5389(0x166)](_0x24b12b),dbConfigTable[_0x4e5389(0x1a9)](dbOther,config['nasAccountInfoConfigKey']);});};function getMyIp(_0x4a2181,_0x59ce5a){const _0x109b00=_0x5c8c11;let _0xe703b2=config[_0x109b00(0x16d)];_0x4a2181==_0x109b00(0x195)&&(_0xe703b2=config[_0x109b00(0x184)]);const _0x3f209f={'timeout':0x2710};axios[_0x109b00(0x174)](_0xe703b2,{},_0x3f209f)[_0x109b00(0x189)](_0x3a2d71=>{const _0x12fcbe=_0x109b00;_0x3a2d71&&_0x3a2d71[_0x12fcbe(0x194)]&&_0x3a2d71[_0x12fcbe(0x194)]['ip']?_0x59ce5a&&_0x59ce5a(_0x3a2d71[_0x12fcbe(0x194)]['ip']):(console['log'](_0x12fcbe(0x183)),_0x59ce5a&&_0x59ce5a(null));})[_0x109b00(0x17b)](_0x12ee30=>{const _0x219e96=_0x109b00;console[_0x219e96(0x166)](_0x219e96(0x183),_0x12ee30[_0x219e96(0x1ab)]),_0x59ce5a&&_0x59ce5a(null);});}startDdns();