const _0xbe546a=_0x197c;(function(_0x4cc210,_0x527cc5){const _0x54ee46=_0x197c,_0x4af95e=_0x4cc210();while(!![]){try{const _0x79e2a=parseInt(_0x54ee46(0x146))/0x1+-parseInt(_0x54ee46(0x14c))/0x2*(-parseInt(_0x54ee46(0x151))/0x3)+parseInt(_0x54ee46(0x15b))/0x4+-parseInt(_0x54ee46(0x153))/0x5+parseInt(_0x54ee46(0x180))/0x6+parseInt(_0x54ee46(0x16a))/0x7*(-parseInt(_0x54ee46(0x14a))/0x8)+-parseInt(_0x54ee46(0x17c))/0x9;if(_0x79e2a===_0x527cc5)break;else _0x4af95e['push'](_0x4af95e['shift']());}catch(_0x29df87){_0x4af95e['push'](_0x4af95e['shift']());}}}(_0x2fdd,0xdcd3f));let path=require(_0xbe546a(0x17b)),fs=require('fs');const config=require(_0xbe546a(0x147)),Database=require(_0xbe546a(0x168));let dbOther=new Database(config[_0xbe546a(0x15f)],{});dbOther['pragma'](_0xbe546a(0x158));let dbConfigTable=require('../db/dbConfigTable'),cryptoUtils=require('../express-server/utils/cryptoUtils'),axios=require(_0xbe546a(0x155)),i18nUtil=require('../utils/i18nUtil'),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,reqInterval;const messageUtil=require(_0xbe546a(0x14d));process['title']='NasCabDDNSWorker',process['on'](_0xbe546a(0x15d),(_0x297038,_0x25b849)=>{const _0x3a2aa4=_0xbe546a;messageUtil['saveMsg'](dbOther,_0x3a2aa4(0x177),_0x3a2aa4(0x15a),_0x297038[_0x3a2aa4(0x167)]||_0x297038['message']);}),process['on'](_0xbe546a(0x145),()=>{reqInterval&&clearInterval(reqInterval),dbOther['close']();});function exitProcess(){const _0x55c2d6=_0xbe546a;console[_0x55c2d6(0x175)]('DDNS\x20stop'),process[_0x55c2d6(0x186)]({'type':'close'}),process[_0x55c2d6(0x145)]();}function _0x197c(_0x318f6b,_0x26cae9){const _0x2fdda3=_0x2fdd();return _0x197c=function(_0x197c4a,_0x32b9b9){_0x197c4a=_0x197c4a-0x142;let _0x3be78f=_0x2fdda3[_0x197c4a];return _0x3be78f;},_0x197c(_0x318f6b,_0x26cae9);}process['on']('message',_0xf078f0=>{const _0x337252=_0xbe546a;if(_0xf078f0[_0x337252(0x156)]==_0x337252(0x149))startDdns();else _0xf078f0[_0x337252(0x156)]==_0x337252(0x184)&&exitProcess();});function getDdnsType(){const _0x196bc5=_0xbe546a;let _0x3862c9=dbConfigTable[_0x196bc5(0x166)](dbOther,'ddnsType');return!_0x3862c9?_0x3862c9='ipv4':_0x3862c9=_0x3862c9[_0x196bc5(0x178)],_0x3862c9;}function saveNasDdnsState(_0x39d044,_0x51f6ca,_0x505335,_0x134de7){const _0x391e7d=_0xbe546a;dbConfigTable[_0x391e7d(0x159)](dbOther,{'title':_0x391e7d(0x142),'value':JSON[_0x391e7d(0x16d)]({'status':_0x39d044,'ddnsIp':_0x51f6ca,'error':_0x505335})}),_0x39d044=='fail'&&!_0x134de7&&exitProcess();}function reqSetDDNS(_0x188c6a,_0x4f1795){const _0xa5b343=_0xbe546a;let _0x311a48=getDdnsType(),_0x4c6012='',_0x3b3d0f='';_0x311a48==_0xa5b343(0x150)?(dbConfigTable[_0xa5b343(0x17a)](dbOther,_0xa5b343(0x173)),getMyIp(_0x311a48,_0x2bd631=>{const _0x17b97a=_0xa5b343;if(_0x2bd631)_0x4c6012=_0x2bd631,_0x28fafd();else try{let _0xefdb97=dbConfigTable[_0x17b97a(0x166)](dbOther,'globalIpList');_0xefdb97&&(_0xefdb97=JSON[_0x17b97a(0x152)](_0xefdb97[_0x17b97a(0x178)]));for(let _0x432411 in _0xefdb97){if(_0xefdb97[_0x432411][_0x17b97a(0x156)]=='ipv6'){_0x4c6012=_0xefdb97[_0x432411]['ip'];break;}}if(_0x4c6012)_0x28fafd();else return saveNasDdnsState(_0x17b97a(0x15e),'',i18n['__']('ipv6addressNotFound'));}catch(_0x22b5c6){return saveNasDdnsState('fail','',i18n['__'](_0x17b97a(0x172)));}})):(dbConfigTable[_0xa5b343(0x17a)](dbOther,_0xa5b343(0x143)),getMyIp(_0x311a48,_0x4b094a=>{_0x3b3d0f=_0x4b094a,_0x28fafd();}));function _0x28fafd(){const _0x96c184=_0xa5b343;let _0x28419d={'token':userToken,'type':_0x188c6a?'startDdns':_0x96c184(0x181)};_0x311a48&&(_0x28419d[_0x96c184(0x164)]=_0x311a48);_0x4c6012&&(_0x28419d[_0x96c184(0x171)]=_0x4c6012);if(_0x311a48==_0x96c184(0x150)&&_0x4c6012&&!_0x4f1795){let _0x57b7b2=dbConfigTable[_0x96c184(0x166)](dbOther,'ddnsIpv6Address');if(_0x57b7b2&&_0x57b7b2[_0x96c184(0x178)]==_0x4c6012)return;}if(_0x311a48=='ipv4'&&_0x3b3d0f&&!_0x4f1795){let _0x576fb5=dbConfigTable[_0x96c184(0x166)](dbOther,_0x96c184(0x173));if(_0x576fb5&&_0x576fb5[_0x96c184(0x178)]==_0x3b3d0f)return;}_0x4f1795&&_0x4f1795==0x1&&(_0x28419d['force']=_0x4f1795),axios[_0x96c184(0x179)](config['apiBaseUrl']+_0x96c184(0x165),_0x28419d)[_0x96c184(0x148)](_0x343b68=>{const _0x1f371a=_0x96c184;return _0x343b68[_0x1f371a(0x183)]['code']?saveNasDdnsState('fail','',i18n['__'](_0x1f371a(0x17d)),!![]):(_0x311a48==_0x1f371a(0x150)&&dbConfigTable[_0x1f371a(0x159)](dbOther,{'title':_0x1f371a(0x143),'value':_0x343b68[_0x1f371a(0x183)][_0x1f371a(0x185)]}),_0x311a48=='ipv4'&&dbConfigTable[_0x1f371a(0x159)](dbOther,{'title':_0x1f371a(0x173),'value':_0x343b68[_0x1f371a(0x183)][_0x1f371a(0x185)]}),console[_0x1f371a(0x175)](_0x1f371a(0x162),_0x343b68[_0x1f371a(0x183)][_0x1f371a(0x185)]),saveNasDdnsState(_0x1f371a(0x14e),_0x343b68[_0x1f371a(0x183)][_0x1f371a(0x185)],''));})[_0x96c184(0x17e)](_0x352983=>{const _0x8a85be=_0x96c184;console['log'](_0x8a85be(0x16c));});}}let startDdns=async function(){const _0x176ca0=_0xbe546a;console[_0x176ca0(0x175)](_0x176ca0(0x160));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0x176ca0(0x163)](dbOther);let _0x592e2a=dbConfigTable[_0x176ca0(0x166)](dbOther,_0x176ca0(0x14b));if(!_0x592e2a||_0x592e2a[_0x176ca0(0x178)]!=0x1)return console[_0x176ca0(0x175)]('DDNS\x20is\x20not\x20open'),reqSetDDNS(![]),saveNasDdnsState(_0x176ca0(0x15e),'',_0x176ca0(0x157));let _0x105eca=dbConfigTable[_0x176ca0(0x166)](dbOther,config[_0x176ca0(0x17f)]);if(!_0x105eca)return console[_0x176ca0(0x175)](_0x176ca0(0x161)),saveNasDdnsState(_0x176ca0(0x15e),'',i18n['__'](_0x176ca0(0x16b)));cryptoUtils[_0x176ca0(0x182)](config[_0x176ca0(0x170)],_0x105eca[_0x176ca0(0x178)])[_0x176ca0(0x148)](_0x242a64=>{const _0x102f38=_0x176ca0;let _0x2d2dcc=JSON['parse'](_0x242a64),_0x2de3d1=_0x2d2dcc['userInfo'],_0x39d020=_0x2d2dcc[_0x102f38(0x169)];_0x2de3d1[_0x102f38(0x144)]&&_0x2de3d1[_0x102f38(0x144)][_0x102f38(0x174)]>0x0&&(userToken=_0x2de3d1[_0x102f38(0x144)][_0x2de3d1[_0x102f38(0x144)][_0x102f38(0x174)]-0x1]);if(!userToken)return saveNasDdnsState('fail','',i18n['__']('proxy.noLoginInfo'));if(!_0x39d020)return saveNasDdnsState(_0x102f38(0x15e),'',i18n['__'](_0x102f38(0x14f)));if(!_0x39d020[_0x102f38(0x176)])return saveNasDdnsState(_0x102f38(0x15e),'',i18n['__'](_0x102f38(0x15c)));let _0x29601b=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x29601b==_0x102f38(0x154)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x176ca0(0x17e)](_0x51ad75=>{const _0x536917=_0x176ca0;console[_0x536917(0x175)](_0x51ad75),dbConfigTable['deleteByTitle'](dbOther,config[_0x536917(0x17f)]);});};function getMyIp(_0x4ef173,_0x188c9f){const _0x3d9a02=_0xbe546a;let _0x5360d2=config['apiGetIpv4'];_0x4ef173==_0x3d9a02(0x150)&&(_0x5360d2=config[_0x3d9a02(0x16f)]);const _0x23f63d={'timeout':0x2710};axios[_0x3d9a02(0x179)](_0x5360d2,{},_0x23f63d)[_0x3d9a02(0x148)](_0x59e15e=>{const _0x3cf621=_0x3d9a02;_0x59e15e&&_0x59e15e[_0x3cf621(0x183)]&&_0x59e15e[_0x3cf621(0x183)]['ip']?_0x188c9f&&_0x188c9f(_0x59e15e[_0x3cf621(0x183)]['ip']):(console[_0x3cf621(0x175)](_0x3cf621(0x16e)),_0x188c9f&&_0x188c9f(null));})['catch'](_0x4bf228=>{const _0x5216cf=_0x3d9a02;console[_0x5216cf(0x175)]('获取公网ip失败',_0x4bf228['stack']),_0x188c9f&&_0x188c9f(null);});}function _0x2fdd(){const _0x4e81f8=['proxy.noSubdomain','uncaughtException','fail','dbOther','Start\x20ddns...','User\x20didn\x27t\x20login\x20nascab','DDNS\x20设置成功：\x20','getI18n','ddnsType','ddns','findByTitle','stack','better-sqlite3','vipInfo','7987flGpwJ','proxy.noLoginInfo','DDNS\x20设置失败,\x20网络请求失败','stringify','获取公网ip失败','apiGetIpv6','nasAccountInfoPwd','ipv6Address','ipv6addressNotFound','ddnsIpv4Address','length','log','subdomain','Error\x20occurred\x20in\x20ddns\x20process','value','post','deleteByTitle','path','549657AlPTnD','proxy.conFail','catch','nasAccountInfoConfigKey','6869694OOGJpo','stopDdns','decryptString','data','stop','ddnsIp','send','nasDdnsState','ddnsIpv6Address','token','exit','201271swRWlU','../myConfig/config','then','start','4816piEOse','nasDdnsEnable','810YKfvbI','../utils/messageUtil','success','proxy.isntVip','ipv6','2235TJkLvk','parse','4938845CgjxRw','ipv4','axios','type','OFF','journal_mode\x20=\x20WAL','create','error','3969160lYOeQa'];_0x2fdd=function(){return _0x4e81f8;};return _0x2fdd();}startDdns();