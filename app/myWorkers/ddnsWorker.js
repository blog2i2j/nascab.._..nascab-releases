const _0x1e1b93=_0x1f56;function _0x1f56(_0x3a00cf,_0x33cc9b){const _0x193a9b=_0x193a();return _0x1f56=function(_0x1f5672,_0x9dd14a){_0x1f5672=_0x1f5672-0x150;let _0x50d403=_0x193a9b[_0x1f5672];return _0x50d403;},_0x1f56(_0x3a00cf,_0x33cc9b);}(function(_0x1eca8f,_0x73be98){const _0x4c2d6d=_0x1f56,_0x3c7858=_0x1eca8f();while(!![]){try{const _0x1844b9=-parseInt(_0x4c2d6d(0x153))/0x1+-parseInt(_0x4c2d6d(0x176))/0x2*(-parseInt(_0x4c2d6d(0x155))/0x3)+-parseInt(_0x4c2d6d(0x197))/0x4*(parseInt(_0x4c2d6d(0x198))/0x5)+parseInt(_0x4c2d6d(0x157))/0x6+parseInt(_0x4c2d6d(0x18e))/0x7+parseInt(_0x4c2d6d(0x165))/0x8+-parseInt(_0x4c2d6d(0x191))/0x9;if(_0x1844b9===_0x73be98)break;else _0x3c7858['push'](_0x3c7858['shift']());}catch(_0x368ba5){_0x3c7858['push'](_0x3c7858['shift']());}}}(_0x193a,0x795ce));let path=require('path'),fs=require('fs');const config=require(_0x1e1b93(0x159)),Database=require(_0x1e1b93(0x196));let dbOther=new Database(config[_0x1e1b93(0x183)],{});dbOther[_0x1e1b93(0x177)]('journal_mode\x20=\x20WAL');let dbConfigTable=require('../db/dbConfigTable'),cryptoUtils=require(_0x1e1b93(0x16c)),axios=require(_0x1e1b93(0x188)),i18nUtil=require(_0x1e1b93(0x17d)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,reqInterval;const messageUtil=require('../utils/messageUtil');process[_0x1e1b93(0x16f)]=_0x1e1b93(0x154),process['on'](_0x1e1b93(0x15a),(_0x16a536,_0x5ef3b7)=>{const _0xd25342=_0x1e1b93;messageUtil[_0xd25342(0x16e)](dbOther,_0xd25342(0x163),_0xd25342(0x164),_0x16a536['stack']||_0x16a536['message']);}),process['on']('exit',()=>{const _0x3c113f=_0x1e1b93;reqInterval&&clearInterval(reqInterval),dbOther[_0x3c113f(0x189)]();});function exitProcess(){const _0x24ca1f=_0x1e1b93;console['log'](_0x24ca1f(0x151)),process[_0x24ca1f(0x171)]({'type':_0x24ca1f(0x189)}),process['exit']();}process['on'](_0x1e1b93(0x194),_0xe607dc=>{const _0x5b6d26=_0x1e1b93;if(_0xe607dc['type']==_0x5b6d26(0x18a))startDdns();else _0xe607dc[_0x5b6d26(0x161)]==_0x5b6d26(0x15b)&&exitProcess();});function getDdnsType(){let _0x364ee3=dbConfigTable['findByTitle'](dbOther,'ddnsType');return!_0x364ee3?_0x364ee3='ipv4':_0x364ee3=_0x364ee3['value'],_0x364ee3;}function saveNasDdnsState(_0x659fa0,_0x22fbd6,_0x1e4807,_0x3a80f4){const _0x5438ca=_0x1e1b93;dbConfigTable[_0x5438ca(0x184)](dbOther,{'title':_0x5438ca(0x18b),'value':JSON['stringify']({'status':_0x659fa0,'ddnsIp':_0x22fbd6,'error':_0x1e4807})}),_0x659fa0==_0x5438ca(0x17e)&&!_0x3a80f4&&exitProcess();}function reqSetDDNS(_0x15dc1e,_0x35ae62){const _0x44f251=_0x1e1b93;let _0x51c929=getDdnsType(),_0x372d39='',_0x4def4e='';_0x51c929==_0x44f251(0x187)?(dbConfigTable[_0x44f251(0x15c)](dbOther,_0x44f251(0x172)),getMyIp(_0x51c929,_0x3e0ffe=>{const _0x2ec19f=_0x44f251;if(_0x3e0ffe)_0x372d39=_0x3e0ffe,_0x97c70();else try{let _0x2bd306=dbConfigTable['findByTitle'](dbOther,_0x2ec19f(0x18f));_0x2bd306&&(_0x2bd306=JSON[_0x2ec19f(0x190)](_0x2bd306[_0x2ec19f(0x166)]));for(let _0x76ab9c in _0x2bd306){if(_0x2bd306[_0x76ab9c][_0x2ec19f(0x161)]==_0x2ec19f(0x187)){_0x372d39=_0x2bd306[_0x76ab9c]['ip'];break;}}if(_0x372d39)_0x97c70();else return saveNasDdnsState('fail','',i18n['__']('ipv6addressNotFound'));}catch(_0x1ed141){return saveNasDdnsState(_0x2ec19f(0x17e),'',i18n['__'](_0x2ec19f(0x16a)));}})):(dbConfigTable[_0x44f251(0x15c)](dbOther,_0x44f251(0x178)),getMyIp(_0x51c929,_0x2df0ea=>{_0x4def4e=_0x2df0ea,_0x97c70();}));function _0x97c70(){const _0x579c4d=_0x44f251;let _0xe9f1de={'token':userToken,'type':_0x15dc1e?'startDdns':_0x579c4d(0x16d)};_0x51c929&&(_0xe9f1de[_0x579c4d(0x17a)]=_0x51c929);_0x372d39&&(_0xe9f1de[_0x579c4d(0x17b)]=_0x372d39);if(_0x51c929=='ipv6'&&_0x372d39&&!_0x35ae62){let _0xdc1465=dbConfigTable[_0x579c4d(0x170)](dbOther,_0x579c4d(0x178));if(_0xdc1465&&_0xdc1465['value']==_0x372d39)return;}if(_0x51c929==_0x579c4d(0x18d)&&_0x4def4e&&!_0x35ae62){let _0x46bb95=dbConfigTable[_0x579c4d(0x170)](dbOther,_0x579c4d(0x172));if(_0x46bb95&&_0x46bb95[_0x579c4d(0x166)]==_0x4def4e)return;}_0x35ae62&&_0x35ae62==0x1&&(_0xe9f1de['force']=_0x35ae62),axios['post'](config[_0x579c4d(0x16b)]+_0x579c4d(0x15d),_0xe9f1de)[_0x579c4d(0x160)](_0x14ff4d=>{const _0x11c394=_0x579c4d;return _0x14ff4d[_0x11c394(0x168)]['code']?saveNasDdnsState(_0x11c394(0x17e),'',i18n['__'](_0x11c394(0x17c)),!![]):(_0x51c929==_0x11c394(0x187)&&dbConfigTable[_0x11c394(0x184)](dbOther,{'title':_0x11c394(0x178),'value':_0x14ff4d[_0x11c394(0x168)][_0x11c394(0x174)]}),_0x51c929==_0x11c394(0x18d)&&dbConfigTable[_0x11c394(0x184)](dbOther,{'title':_0x11c394(0x172),'value':_0x14ff4d[_0x11c394(0x168)][_0x11c394(0x174)]}),console[_0x11c394(0x195)]('DDNS\x20设置成功：\x20',_0x14ff4d['data']['ddnsIp']),saveNasDdnsState(_0x11c394(0x181),_0x14ff4d[_0x11c394(0x168)]['ddnsIp'],''));})[_0x579c4d(0x162)](_0x2a8450=>{const _0x229659=_0x579c4d;console[_0x229659(0x195)](_0x229659(0x199));});}}function _0x193a(){const _0x49dd2e=['1620820qMkClE','5DYaYQi','DDNS\x20设置失败,\x20网络请求失败','proxy.noSubdomain','DDNS\x20stop','nasAccountInfoPwd','755241hCpfDq','NasCabDDNSWorker','118113TCaEab','proxy.isntVip','4341600OGUQhJ','OFF','../myConfig/config','uncaughtException','stop','deleteByTitle','ddns','token','nasAccountInfoConfigKey','then','type','catch','Error\x20occurred\x20in\x20ddns\x20process','error','238952yxCPzh','value','nasDdnsEnable','data','getI18n','ipv6addressNotFound','apiBaseUrl','../express-server/utils/cryptoUtils','stopDdns','saveMsg','title','findByTitle','send','ddnsIpv4Address','subdomain','ddnsIp','length','46VofoLy','pragma','ddnsIpv6Address','stack','ddnsType','ipv6Address','proxy.conFail','../utils/i18nUtil','fail','apiGetIpv4','decryptString','success','获取公网ip失败','dbOther','create','User\x20didn\x27t\x20login\x20nascab','Start\x20ddns...','ipv6','axios','close','start','nasDdnsState','vipInfo','ipv4','1119377GNyNTp','globalIpList','parse','1452285wzuuxz','proxy.noLoginInfo','userInfo','message','log','better-sqlite3'];_0x193a=function(){return _0x49dd2e;};return _0x193a();}let startDdns=async function(){const _0x5c0432=_0x1e1b93;console[_0x5c0432(0x195)](_0x5c0432(0x186));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil[_0x5c0432(0x169)](dbOther);let _0x47c8ff=dbConfigTable[_0x5c0432(0x170)](dbOther,_0x5c0432(0x167));if(!_0x47c8ff||_0x47c8ff[_0x5c0432(0x166)]!=0x1)return console[_0x5c0432(0x195)]('DDNS\x20is\x20not\x20open'),reqSetDDNS(![]),saveNasDdnsState(_0x5c0432(0x17e),'',_0x5c0432(0x158));let _0x2608fd=dbConfigTable[_0x5c0432(0x170)](dbOther,config['nasAccountInfoConfigKey']);if(!_0x2608fd)return console[_0x5c0432(0x195)](_0x5c0432(0x185)),saveNasDdnsState(_0x5c0432(0x17e),'',i18n['__']('proxy.noLoginInfo'));cryptoUtils[_0x5c0432(0x180)](config[_0x5c0432(0x152)],_0x2608fd['value'])[_0x5c0432(0x160)](_0x4a0f88=>{const _0x786feb=_0x5c0432;let _0xe52d8f=JSON[_0x786feb(0x190)](_0x4a0f88),_0x3e7503=_0xe52d8f[_0x786feb(0x193)],_0x5cf486=_0xe52d8f[_0x786feb(0x18c)];_0x3e7503[_0x786feb(0x15e)]&&_0x3e7503[_0x786feb(0x15e)][_0x786feb(0x175)]>0x0&&(userToken=_0x3e7503[_0x786feb(0x15e)][_0x3e7503[_0x786feb(0x15e)][_0x786feb(0x175)]-0x1]);if(!userToken)return saveNasDdnsState(_0x786feb(0x17e),'',i18n['__'](_0x786feb(0x192)));if(!_0x5cf486)return saveNasDdnsState(_0x786feb(0x17e),'',i18n['__'](_0x786feb(0x156)));if(!_0x5cf486[_0x786feb(0x173)])return saveNasDdnsState(_0x786feb(0x17e),'',i18n['__'](_0x786feb(0x150)));let _0x2418ef=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x2418ef==_0x786feb(0x18d)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x5c0432(0x162)](_0x2bafdf=>{const _0x5b63a2=_0x5c0432;console['log'](_0x2bafdf),dbConfigTable[_0x5b63a2(0x15c)](dbOther,config[_0x5b63a2(0x15f)]);});};function getMyIp(_0xb0e38f,_0xfdfe7f){const _0x4a8d83=_0x1e1b93;let _0x445a1c=config[_0x4a8d83(0x17f)];_0xb0e38f=='ipv6'&&(_0x445a1c=config['apiGetIpv6']);const _0x53ba75={'timeout':0x2710};axios['post'](_0x445a1c,{},_0x53ba75)[_0x4a8d83(0x160)](_0x4094d0=>{const _0xdb2290=_0x4a8d83;_0x4094d0&&_0x4094d0[_0xdb2290(0x168)]&&_0x4094d0[_0xdb2290(0x168)]['ip']?_0xfdfe7f&&_0xfdfe7f(_0x4094d0[_0xdb2290(0x168)]['ip']):(console['log'](_0xdb2290(0x182)),_0xfdfe7f&&_0xfdfe7f(null));})[_0x4a8d83(0x162)](_0x3193f7=>{const _0x58652f=_0x4a8d83;console['log'](_0x58652f(0x182),_0x3193f7[_0x58652f(0x179)]),_0xfdfe7f&&_0xfdfe7f(null);});}startDdns();