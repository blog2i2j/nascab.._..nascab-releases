const _0x4364f3=_0x32c7;(function(_0x59e5b8,_0x3d1eff){const _0x17be88=_0x32c7,_0x2a6ed7=_0x59e5b8();while(!![]){try{const _0x553011=parseInt(_0x17be88(0x1d4))/0x1*(parseInt(_0x17be88(0x1c8))/0x2)+-parseInt(_0x17be88(0x1fb))/0x3*(parseInt(_0x17be88(0x1ca))/0x4)+-parseInt(_0x17be88(0x1fe))/0x5*(parseInt(_0x17be88(0x1c1))/0x6)+-parseInt(_0x17be88(0x1c0))/0x7+parseInt(_0x17be88(0x1d1))/0x8+-parseInt(_0x17be88(0x207))/0x9+-parseInt(_0x17be88(0x1de))/0xa*(-parseInt(_0x17be88(0x201))/0xb);if(_0x553011===_0x3d1eff)break;else _0x2a6ed7['push'](_0x2a6ed7['shift']());}catch(_0x3f266e){_0x2a6ed7['push'](_0x2a6ed7['shift']());}}}(_0x4fbf,0xe90f2));let path=require(_0x4364f3(0x209)),fs=require('fs');const config=require(_0x4364f3(0x1ce)),Database=require(_0x4364f3(0x202));let dbOther=new Database(config[_0x4364f3(0x1c2)],{});dbOther[_0x4364f3(0x1fd)](_0x4364f3(0x1fc));let dbConfigTable=require(_0x4364f3(0x1f7)),cryptoUtils=require(_0x4364f3(0x1d6)),axios=require(_0x4364f3(0x1e9)),i18nUtil=require(_0x4364f3(0x1c3)),ddnsMinGapV4=0x3c*0x3e8,ddnsMinGapV6=0x1e*0x3e8,reqInterval;const messageUtil=require('../utils/messageUtil');process[_0x4364f3(0x20a)]=_0x4364f3(0x203),process['on'](_0x4364f3(0x1c4),(_0x34bbe5,_0x264ad6)=>{const _0x178f04=_0x4364f3;messageUtil[_0x178f04(0x1ee)](dbOther,_0x178f04(0x1d9),_0x178f04(0x1e8),_0x34bbe5[_0x178f04(0x1df)]||_0x34bbe5[_0x178f04(0x1ef)]);}),process['on'](_0x4364f3(0x1bf),()=>{const _0x487210=_0x4364f3;reqInterval&&clearInterval(reqInterval),dbOther[_0x487210(0x1cd)]();});function exitProcess(){const _0xe3ef3e=_0x4364f3;console[_0xe3ef3e(0x1e5)](_0xe3ef3e(0x1e2)),process[_0xe3ef3e(0x1da)]({'type':'close'}),process[_0xe3ef3e(0x1bf)]();}function _0x4fbf(){const _0x1abfeb=['stringify','saveMsg','message','stop','type','decryptString','ddnsType','ddnsIp','apiGetIpv6','DDNS\x20设置成功：\x20','../db/dbConfigTable','ddnsIpv6Address','ddns','catch','219045FuZkuN','journal_mode\x20=\x20WAL','pragma','390vfEgUp','nasAccountInfoConfigKey','parse','847mjMNpm','better-sqlite3','NasCabDDNSWorker','ipv6addressNotFound','create','token','13304439VfzGuK','fail','path','title','stopDdns','DDNS\x20is\x20not\x20open','Start\x20ddns...','ddnsIpv4Address','ipv4','exit','7320936uwUsgP','48126mNSIus','dbOther','../utils/i18nUtil','uncaughtException','nasDdnsEnable','start','proxy.noLoginInfo','1867900fwYgWl','startDdns','52TRJKRM','OFF','value','close','../myConfig/config','apiBaseUrl','success','2586112MxcWYY','proxy.isntVip','nasAccountInfoPwd','2tSxVid','userInfo','../express-server/utils/cryptoUtils','deleteByTitle','post','Error\x20occurred\x20in\x20ddns\x20process','send','proxy.noSubdomain','data','globalIpList','371740MYTdDl','stack','DDNS\x20设置失败,\x20网络请求失败','force','DDNS\x20stop','findByTitle','ipv6','log','code','nasDdnsState','error','axios','then','proxy.conFail','User\x20didn\x27t\x20login\x20nascab'];_0x4fbf=function(){return _0x1abfeb;};return _0x4fbf();}process['on'](_0x4364f3(0x1ef),_0xef304f=>{const _0x25dfb1=_0x4364f3;if(_0xef304f['type']==_0x25dfb1(0x1c6))startDdns();else _0xef304f[_0x25dfb1(0x1f1)]==_0x25dfb1(0x1f0)&&exitProcess();});function getDdnsType(){const _0x4e0eb4=_0x4364f3;let _0x4516e2=dbConfigTable[_0x4e0eb4(0x1e3)](dbOther,_0x4e0eb4(0x1f3));return!_0x4516e2?_0x4516e2='ipv4':_0x4516e2=_0x4516e2[_0x4e0eb4(0x1cc)],_0x4516e2;}function saveNasDdnsState(_0x27c71e,_0x3daff0,_0x457cef,_0x1a38f6){const _0x57cfb4=_0x4364f3;dbConfigTable[_0x57cfb4(0x205)](dbOther,{'title':_0x57cfb4(0x1e7),'value':JSON[_0x57cfb4(0x1ed)]({'status':_0x27c71e,'ddnsIp':_0x3daff0,'error':_0x457cef})}),_0x27c71e=='fail'&&!_0x1a38f6&&exitProcess();}function reqSetDDNS(_0x3084fd,_0x294871){const _0x9f0d22=_0x4364f3;let _0x46368d=getDdnsType(),_0x3ab5a2='',_0x58a513='';_0x46368d==_0x9f0d22(0x1e4)?(dbConfigTable[_0x9f0d22(0x1d7)](dbOther,_0x9f0d22(0x1bd)),getMyIp(_0x46368d,_0x409656=>{const _0x285113=_0x9f0d22;if(_0x409656)_0x3ab5a2=_0x409656,_0x19bebb();else try{let _0x3d76ab=dbConfigTable['findByTitle'](dbOther,_0x285113(0x1dd));_0x3d76ab&&(_0x3d76ab=JSON[_0x285113(0x200)](_0x3d76ab[_0x285113(0x1cc)]));for(let _0xe298af in _0x3d76ab){if(_0x3d76ab[_0xe298af]['type']==_0x285113(0x1e4)){_0x3ab5a2=_0x3d76ab[_0xe298af]['ip'];break;}}if(_0x3ab5a2)_0x19bebb();else return saveNasDdnsState(_0x285113(0x208),'',i18n['__']('ipv6addressNotFound'));}catch(_0x408c0e){return saveNasDdnsState(_0x285113(0x208),'',i18n['__'](_0x285113(0x204)));}})):(dbConfigTable[_0x9f0d22(0x1d7)](dbOther,'ddnsIpv6Address'),getMyIp(_0x46368d,_0x250ff9=>{_0x58a513=_0x250ff9,_0x19bebb();}));function _0x19bebb(){const _0x455589=_0x9f0d22;let _0x294203={'token':userToken,'type':_0x3084fd?_0x455589(0x1c9):_0x455589(0x20b)};_0x46368d&&(_0x294203[_0x455589(0x1f3)]=_0x46368d);_0x3ab5a2&&(_0x294203['ipv6Address']=_0x3ab5a2);if(_0x46368d==_0x455589(0x1e4)&&_0x3ab5a2&&!_0x294871){let _0xc6e9c=dbConfigTable[_0x455589(0x1e3)](dbOther,_0x455589(0x1f8));if(_0xc6e9c&&_0xc6e9c[_0x455589(0x1cc)]==_0x3ab5a2)return;}if(_0x46368d==_0x455589(0x1be)&&_0x58a513&&!_0x294871){let _0x53fb2f=dbConfigTable[_0x455589(0x1e3)](dbOther,_0x455589(0x1bd));if(_0x53fb2f&&_0x53fb2f['value']==_0x58a513)return;}_0x294871&&_0x294871==0x1&&(_0x294203[_0x455589(0x1e1)]=_0x294871),axios[_0x455589(0x1d8)](config[_0x455589(0x1cf)]+_0x455589(0x1f9),_0x294203)['then'](_0x5642b0=>{const _0x58eae5=_0x455589;return _0x5642b0[_0x58eae5(0x1dc)][_0x58eae5(0x1e6)]?saveNasDdnsState(_0x58eae5(0x208),'',i18n['__'](_0x58eae5(0x1eb)),!![]):(_0x46368d==_0x58eae5(0x1e4)&&dbConfigTable['create'](dbOther,{'title':_0x58eae5(0x1f8),'value':_0x5642b0[_0x58eae5(0x1dc)]['ddnsIp']}),_0x46368d==_0x58eae5(0x1be)&&dbConfigTable['create'](dbOther,{'title':_0x58eae5(0x1bd),'value':_0x5642b0[_0x58eae5(0x1dc)][_0x58eae5(0x1f4)]}),console[_0x58eae5(0x1e5)](_0x58eae5(0x1f6),_0x5642b0['data'][_0x58eae5(0x1f4)]),saveNasDdnsState(_0x58eae5(0x1d0),_0x5642b0[_0x58eae5(0x1dc)][_0x58eae5(0x1f4)],''));})[_0x455589(0x1fa)](_0x5710bb=>{const _0x33804c=_0x455589;console['log'](_0x33804c(0x1e0));});}}function _0x32c7(_0xe0ba8a,_0x28c996){const _0x4fbfd2=_0x4fbf();return _0x32c7=function(_0x32c7f2,_0x3bf780){_0x32c7f2=_0x32c7f2-0x1bb;let _0x1d6a38=_0x4fbfd2[_0x32c7f2];return _0x1d6a38;},_0x32c7(_0xe0ba8a,_0x28c996);}let startDdns=async function(){const _0x4277c7=_0x4364f3;console[_0x4277c7(0x1e5)](_0x4277c7(0x1bc));reqInterval&&clearInterval(reqInterval);i18n=i18nUtil['getI18n'](dbOther);let _0x225798=dbConfigTable[_0x4277c7(0x1e3)](dbOther,_0x4277c7(0x1c5));if(!_0x225798||_0x225798['value']!=0x1)return console[_0x4277c7(0x1e5)](_0x4277c7(0x1bb)),reqSetDDNS(![]),saveNasDdnsState(_0x4277c7(0x208),'',_0x4277c7(0x1cb));let _0x4abdbf=dbConfigTable[_0x4277c7(0x1e3)](dbOther,config[_0x4277c7(0x1ff)]);if(!_0x4abdbf)return console[_0x4277c7(0x1e5)](_0x4277c7(0x1ec)),saveNasDdnsState(_0x4277c7(0x208),'',i18n['__'](_0x4277c7(0x1c7)));cryptoUtils[_0x4277c7(0x1f2)](config[_0x4277c7(0x1d3)],_0x4abdbf[_0x4277c7(0x1cc)])[_0x4277c7(0x1ea)](_0x5524e9=>{const _0x473bf2=_0x4277c7;let _0xf36228=JSON[_0x473bf2(0x200)](_0x5524e9),_0x321054=_0xf36228[_0x473bf2(0x1d5)],_0x51f7bd=_0xf36228['vipInfo'];_0x321054[_0x473bf2(0x206)]&&_0x321054[_0x473bf2(0x206)]['length']>0x0&&(userToken=_0x321054[_0x473bf2(0x206)][_0x321054[_0x473bf2(0x206)]['length']-0x1]);if(!userToken)return saveNasDdnsState(_0x473bf2(0x208),'',i18n['__']('proxy.noLoginInfo'));if(!_0x51f7bd)return saveNasDdnsState(_0x473bf2(0x208),'',i18n['__'](_0x473bf2(0x1d2)));if(!_0x51f7bd['subdomain'])return saveNasDdnsState(_0x473bf2(0x208),'',i18n['__'](_0x473bf2(0x1db)));let _0x2c5aff=getDdnsType();reqInterval=setInterval(()=>{reqSetDDNS(!![],0x0);},_0x2c5aff==_0x473bf2(0x1be)?ddnsMinGapV4:ddnsMinGapV6),reqSetDDNS(!![],0x1);})[_0x4277c7(0x1fa)](_0x411fe6=>{const _0xc4f86d=_0x4277c7;console[_0xc4f86d(0x1e5)](_0x411fe6),dbConfigTable[_0xc4f86d(0x1d7)](dbOther,config['nasAccountInfoConfigKey']);});};function getMyIp(_0x193018,_0x38064a){const _0x3ad36d=_0x4364f3;let _0x3efecb=config['apiGetIpv4'];_0x193018=='ipv6'&&(_0x3efecb=config[_0x3ad36d(0x1f5)]);const _0xd336d8={'timeout':0x2710};axios[_0x3ad36d(0x1d8)](_0x3efecb,{},_0xd336d8)['then'](_0x2ff5d4=>{const _0x2a7d87=_0x3ad36d;_0x2ff5d4&&_0x2ff5d4['data']&&_0x2ff5d4[_0x2a7d87(0x1dc)]['ip']?_0x38064a&&_0x38064a(_0x2ff5d4[_0x2a7d87(0x1dc)]['ip']):(console[_0x2a7d87(0x1e5)]('获取公网ip失败'),_0x38064a&&_0x38064a(null));})[_0x3ad36d(0x1fa)](_0x53a8e9=>{const _0xe83e9f=_0x3ad36d;console[_0xe83e9f(0x1e5)]('获取公网ip失败',_0x53a8e9[_0xe83e9f(0x1df)]),_0x38064a&&_0x38064a(null);});}startDdns();