const _0x3ff291=_0x186e;(function(_0x185990,_0x4570dc){const _0x1c122c=_0x186e,_0x50b394=_0x185990();while(!![]){try{const _0x3c84de=-parseInt(_0x1c122c(0x152))/0x1*(parseInt(_0x1c122c(0x135))/0x2)+parseInt(_0x1c122c(0x14d))/0x3+parseInt(_0x1c122c(0x12d))/0x4*(parseInt(_0x1c122c(0x160))/0x5)+parseInt(_0x1c122c(0x15f))/0x6+parseInt(_0x1c122c(0x14c))/0x7*(parseInt(_0x1c122c(0x12f))/0x8)+-parseInt(_0x1c122c(0x134))/0x9*(-parseInt(_0x1c122c(0x143))/0xa)+-parseInt(_0x1c122c(0x139))/0xb;if(_0x3c84de===_0x4570dc)break;else _0x50b394['push'](_0x50b394['shift']());}catch(_0x4ac5e0){_0x50b394['push'](_0x50b394['shift']());}}}(_0xdf88,0x5367a));let path=require(_0x3ff291(0x144)),fs=require('fs'),cryptoUtils=require(_0x3ff291(0x13b));function _0xdf88(){const _0x50fb90=['get','dbOther','parse','from','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','length','decryptString','send','255576PxYCrh','5PnOizH','../../db/dbNoticeCenterTable','targetFolderPath','private.exportFail','2307404UpanTl','startsWith','225200lbHeFr','info','\x20where\x20id=','decryptFile','log','153aZFTaC','135922sjzcuC','stringify','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id=','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','15637094mIlWgw','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201','../../express-server/utils/cryptoUtils','UPDATE\x20bg_task\x20SET\x20progress_current=','privateSpaceKey',']\x20=>\x20[','private.exportSuc','spacePwd','prepare','folderPath','249580wjXquQ','path','../../utils/i18nUtil','run','error','private.exportStart','taskDeleted','readdirSync','task_json','154yASjhS','708207FqFMgv','join','close','isFile','then','2ooCkpu','journal_mode\x20=\x20WAL','catch','renameSync'];_0xdf88=function(){return _0x50fb90;};return _0xdf88();}const dbNoticeCenterTable=require(_0x3ff291(0x12a)),config=require('../../myConfig/config'),Database=require('better-sqlite3');let dbOther=new Database(config[_0x3ff291(0x157)],{});dbOther['pragma'](_0x3ff291(0x153));let i18nUtil=require(_0x3ff291(0x145)),i18n=i18nUtil['getI18n'](dbOther);process['title']='NasCabBgTaskWorker';function saveMsg(_0x382ff4,_0x34697b,_0x25181d){dbNoticeCenterTable['create'](dbOther,{'title':_0x382ff4,'level':_0x34697b,'content':_0x25181d});}async function exportPrivateSpace(_0x2f7ff4,_0x31b962,_0x5e645c,_0x1b0f66,_0x319982){const _0x14753d=_0x3ff291;saveMsg(i18n['__'](_0x14753d(0x148)),_0x14753d(0x130),'['+_0x2f7ff4+_0x14753d(0x13e)+_0x31b962+']'),cryptoUtils[_0x14753d(0x15d)](config[_0x14753d(0x13d)],_0x5e645c)['then'](async _0x12a3ba=>{const _0x562136=_0x14753d;_0x5e645c=Buffer[_0x562136(0x159)](_0x12a3ba,'base64')['toString']();try{let _0x4b5544=0x0,_0x302352=0x0,_0x3ffc73=fs[_0x562136(0x14a)](_0x2f7ff4);dbOther[_0x562136(0x141)]('UPDATE\x20bg_task\x20SET\x20progress_all='+_0x3ffc73[_0x562136(0x15c)]+_0x562136(0x131)+_0x1b0f66['id'])[_0x562136(0x146)]();let _0x4e143b;for(let _0x472da5=0x0;_0x472da5<_0x3ffc73[_0x562136(0x15c)];_0x472da5++){try{let _0x210f99=dbOther['prepare'](_0x562136(0x137)+_0x1b0f66['id'])[_0x562136(0x156)]();if(!_0x210f99)return saveMsg(i18n['__'](_0x562136(0x12c)),_0x562136(0x147),i18n['__'](_0x562136(0x149))),_0x319982();dbOther[_0x562136(0x141)](_0x562136(0x13c)+(_0x472da5+0x1)+_0x562136(0x131)+_0x1b0f66['id'])[_0x562136(0x146)](),_0x4e143b=_0x3ffc73[_0x472da5];if(_0x4e143b[_0x562136(0x12e)]('.'))continue;let _0x126e17=path[_0x562136(0x14e)](_0x2f7ff4,_0x4e143b),_0x2c0291=fs['statSync'](_0x126e17)[_0x562136(0x150)](),_0xb8e382=path[_0x562136(0x14e)](_0x31b962,_0x4e143b);if(_0x2c0291)try{await cryptoUtils[_0x562136(0x132)](_0x5e645c,_0x126e17,fs['createWriteStream'](_0xb8e382)),cryptoUtils[_0x562136(0x15d)](_0x5e645c,_0x4e143b)['then'](_0x4e9662=>{const _0x410e01=_0x562136;let _0x2594a0=path[_0x410e01(0x14e)](_0x31b962,_0x4e9662);fs[_0x410e01(0x155)](_0xb8e382,_0x2594a0);})['catch'](_0x209117=>{const _0x166013=_0x562136;console[_0x166013(0x133)]('error',_0x209117);});}catch(_0x293d02){console[_0x562136(0x133)](_0x562136(0x147),_0x293d02),saveMsg(i18n['__'](_0x562136(0x12c)),'error',_0x126e17+':'+JSON[_0x562136(0x136)](err));}}catch(_0x4cdad6){saveMsg(i18n['__'](_0x562136(0x12c)),'error',_0x4e143b+'\x20'+_0x4cdad6?JSON[_0x562136(0x136)](_0x4cdad6):'');continue;}}saveMsg(i18n['__'](_0x562136(0x13f)),_0x562136(0x130),'['+_0x2f7ff4+']\x20=>\x20['+_0x31b962+']'),dbOther[_0x562136(0x141)](_0x562136(0x138)+_0x1b0f66['id'])['run'](),_0x319982();}catch(_0x5bd8f8){console['log'](_0x5bd8f8),saveMsg(i18n['__'](_0x562136(0x12c)),_0x562136(0x147),_0x5bd8f8?JSON[_0x562136(0x136)](_0x5bd8f8):''),dbOther[_0x562136(0x141)]('UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id='+_0x1b0f66['id'])['run'](),_0x319982();}})[_0x14753d(0x154)](_0xf16ff3=>{const _0x35064f=_0x14753d;console[_0x35064f(0x133)](_0xf16ff3),saveMsg(i18n['__']('private.exportFail'),_0x35064f(0x147),i18n['__']('private.passwordIncorrect')),dbOther[_0x35064f(0x141)](_0x35064f(0x15a)+_0x1b0f66['id'])[_0x35064f(0x146)](),_0x319982();});}function _0x186e(_0x3b35b7,_0x5e2ab3){const _0xdf88ca=_0xdf88();return _0x186e=function(_0x186e7f,_0x14f29f){_0x186e7f=_0x186e7f-0x12a;let _0x4e9c27=_0xdf88ca[_0x186e7f];return _0x4e9c27;},_0x186e(_0x3b35b7,_0x5e2ab3);}async function taskStart(){return new Promise((_0x5b993d,_0x6aed92)=>{const _0x251dd2=_0x186e;let _0x18660b=dbOther[_0x251dd2(0x141)](_0x251dd2(0x13a))[_0x251dd2(0x156)]();if(_0x18660b){let _0xb93564=JSON[_0x251dd2(0x158)](_0x18660b[_0x251dd2(0x14b)]);dbOther[_0x251dd2(0x141)](_0x251dd2(0x15b)+_0x18660b['id'])[_0x251dd2(0x146)](),exportPrivateSpace(_0xb93564[_0x251dd2(0x142)],_0xb93564[_0x251dd2(0x12b)],_0xb93564[_0x251dd2(0x140)],_0x18660b,_0x5b993d);}else process[_0x251dd2(0x15e)]({'type':_0x251dd2(0x14f)});});}async function runGbTask(){const _0x5bc038=_0x3ff291;taskStart()[_0x5bc038(0x151)](()=>{runGbTask();});}runGbTask();