const _0x1ec33b=_0x3315;function _0x1b9a(){const _0x497fb0=['private.exportSuc','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=',']\x20=>\x20[','89495dQPBEC','128BrZiHA','readdirSync','taskDeleted','parse','dbOther','toString','stringify','881343tpjCBB','decryptFile','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201','createWriteStream','../../express-server/utils/cryptoUtils','from','private.exportStart','send','task_json','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id=','get','\x20where\x20id=','6YREBWt','../../db/dbNoticeCenterTable','4wUxoke','length','error','pragma','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','60npjMhV','path','../../myConfig/config','prepare','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','../../utils/i18nUtil','214742QvPxfV','journal_mode\x20=\x20WAL','136tbAfVz','close','182645OXGhQB','renameSync','5754ZrNlSy','then','better-sqlite3','private.exportFail','log','4507824eLpjJl','join','run','statSync','28586NNBQxY','catch','info','isFile','spacePwd','private.passwordIncorrect'];_0x1b9a=function(){return _0x497fb0;};return _0x1b9a();}(function(_0x179cc6,_0x165599){const _0x54b293=_0x3315,_0x22fbb1=_0x179cc6();while(!![]){try{const _0x3c9e15=-parseInt(_0x54b293(0x9c))/0x1*(-parseInt(_0x54b293(0xbb))/0x2)+-parseInt(_0x54b293(0xcc))/0x3*(-parseInt(_0x54b293(0xc8))/0x4)+-parseInt(_0x54b293(0xca))/0x5*(-parseInt(_0x54b293(0xb9))/0x6)+parseInt(_0x54b293(0xa5))/0x7*(-parseInt(_0x54b293(0xa6))/0x8)+-parseInt(_0x54b293(0xad))/0x9+parseInt(_0x54b293(0xc0))/0xa*(-parseInt(_0x54b293(0xc6))/0xb)+parseInt(_0x54b293(0x98))/0xc;if(_0x3c9e15===_0x165599)break;else _0x22fbb1['push'](_0x22fbb1['shift']());}catch(_0x3b12e2){_0x22fbb1['push'](_0x22fbb1['shift']());}}}(_0x1b9a,0x1c102));let path=require(_0x1ec33b(0xc1)),fs=require('fs'),cryptoUtils=require(_0x1ec33b(0xb1));const dbNoticeCenterTable=require(_0x1ec33b(0xba)),config=require(_0x1ec33b(0xc2)),Database=require(_0x1ec33b(0x95));let dbOther=new Database(config[_0x1ec33b(0xaa)],{});dbOther[_0x1ec33b(0xbe)](_0x1ec33b(0xc7));let i18nUtil=require(_0x1ec33b(0xc5)),i18n=i18nUtil['getI18n'](dbOther);function _0x3315(_0x5f38bd,_0x5302ce){const _0x1b9a55=_0x1b9a();return _0x3315=function(_0x3315d2,_0x2fa37d){_0x3315d2=_0x3315d2-0x95;let _0x3c3d65=_0x1b9a55[_0x3315d2];return _0x3c3d65;},_0x3315(_0x5f38bd,_0x5302ce);}process['title']='NasCabBgTaskWorker';function saveMsg(_0x1e342e,_0xdda3c1,_0x26cdb8){dbNoticeCenterTable['create'](dbOther,{'title':_0x1e342e,'level':_0xdda3c1,'content':_0x26cdb8});}async function exportPrivateSpace(_0x19be13,_0x2dc18d,_0x15e9b9,_0x59ed26,_0x2fdf1b){const _0x42cf92=_0x1ec33b;saveMsg(i18n['__'](_0x42cf92(0xb3)),_0x42cf92(0x9e),'['+_0x19be13+']\x20=>\x20['+_0x2dc18d+']'),cryptoUtils['decryptString'](config['privateSpaceKey'],_0x15e9b9)['then'](async _0x41bb10=>{const _0x5033f1=_0x42cf92;_0x15e9b9=Buffer[_0x5033f1(0xb2)](_0x41bb10,'base64')[_0x5033f1(0xab)]();try{let _0x38fdfc=0x0,_0x360b99=0x0,_0x447784=fs[_0x5033f1(0xa7)](_0x19be13);dbOther['prepare']('UPDATE\x20bg_task\x20SET\x20progress_all='+_0x447784[_0x5033f1(0xbc)]+_0x5033f1(0xb8)+_0x59ed26['id'])[_0x5033f1(0x9a)]();let _0x24d4e5;for(let _0x2e8c51=0x0;_0x2e8c51<_0x447784['length'];_0x2e8c51++){try{let _0x1a3714=dbOther[_0x5033f1(0xc3)](_0x5033f1(0xb6)+_0x59ed26['id'])[_0x5033f1(0xb7)]();if(!_0x1a3714)return saveMsg(i18n['__'](_0x5033f1(0x96)),_0x5033f1(0xbd),i18n['__'](_0x5033f1(0xa8))),_0x2fdf1b();dbOther[_0x5033f1(0xc3)]('UPDATE\x20bg_task\x20SET\x20progress_current='+(_0x2e8c51+0x1)+'\x20where\x20id='+_0x59ed26['id'])[_0x5033f1(0x9a)](),_0x24d4e5=_0x447784[_0x2e8c51];if(_0x24d4e5['startsWith']('.'))continue;let _0xd617c9=path['join'](_0x19be13,_0x24d4e5),_0x1c8b30=fs[_0x5033f1(0x9b)](_0xd617c9)[_0x5033f1(0x9f)](),_0x471dfa=path[_0x5033f1(0x99)](_0x2dc18d,_0x24d4e5);if(_0x1c8b30)try{await cryptoUtils[_0x5033f1(0xae)](_0x15e9b9,_0xd617c9,fs[_0x5033f1(0xb0)](_0x471dfa)),cryptoUtils['decryptString'](_0x15e9b9,_0x24d4e5)['then'](_0x2803a7=>{const _0x1ab529=_0x5033f1;let _0x481248=path[_0x1ab529(0x99)](_0x2dc18d,_0x2803a7);fs[_0x1ab529(0xcb)](_0x471dfa,_0x481248);})['catch'](_0x3bf751=>{const _0x3646a7=_0x5033f1;console[_0x3646a7(0x97)](_0x3646a7(0xbd),_0x3bf751);});}catch(_0x5a8c9c){console[_0x5033f1(0x97)](_0x5033f1(0xbd),_0x5a8c9c),saveMsg(i18n['__'](_0x5033f1(0x96)),_0x5033f1(0xbd),_0xd617c9+':'+JSON[_0x5033f1(0xac)](err));}}catch(_0x3ce992){saveMsg(i18n['__'](_0x5033f1(0x96)),_0x5033f1(0xbd),_0x24d4e5+'\x20'+_0x3ce992?JSON[_0x5033f1(0xac)](_0x3ce992):'');continue;}}saveMsg(i18n['__'](_0x5033f1(0xa2)),_0x5033f1(0x9e),'['+_0x19be13+_0x5033f1(0xa4)+_0x2dc18d+']'),dbOther['prepare'](_0x5033f1(0xbf)+_0x59ed26['id'])['run'](),_0x2fdf1b();}catch(_0x5ba459){console[_0x5033f1(0x97)](_0x5ba459),saveMsg(i18n['__'](_0x5033f1(0x96)),_0x5033f1(0xbd),_0x5ba459?JSON['stringify'](_0x5ba459):''),dbOther[_0x5033f1(0xc3)](_0x5033f1(0xa3)+_0x59ed26['id'])[_0x5033f1(0x9a)](),_0x2fdf1b();}})[_0x42cf92(0x9d)](_0x418fd9=>{const _0x2b8672=_0x42cf92;console[_0x2b8672(0x97)](_0x418fd9),saveMsg(i18n['__'](_0x2b8672(0x96)),_0x2b8672(0xbd),i18n['__'](_0x2b8672(0xa1))),dbOther['prepare'](_0x2b8672(0xa3)+_0x59ed26['id'])[_0x2b8672(0x9a)](),_0x2fdf1b();});}async function taskStart(){return new Promise((_0xf9e281,_0x3184f2)=>{const _0x430c91=_0x3315;let _0x4302a5=dbOther[_0x430c91(0xc3)](_0x430c91(0xaf))[_0x430c91(0xb7)]();if(_0x4302a5){let _0x475c04=JSON[_0x430c91(0xa9)](_0x4302a5[_0x430c91(0xb5)]);dbOther[_0x430c91(0xc3)](_0x430c91(0xc4)+_0x4302a5['id'])[_0x430c91(0x9a)](),exportPrivateSpace(_0x475c04['folderPath'],_0x475c04['targetFolderPath'],_0x475c04[_0x430c91(0xa0)],_0x4302a5,_0xf9e281);}else process[_0x430c91(0xb4)]({'type':_0x430c91(0xc9)});});}async function runGbTask(){const _0x57f0cd=_0x1ec33b;taskStart()[_0x57f0cd(0xcd)](()=>{runGbTask();});}runGbTask();