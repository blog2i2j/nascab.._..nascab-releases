const _0x42fb08=_0x9bd3;(function(_0x1b8ca0,_0x59b441){const _0x239939=_0x9bd3,_0x145909=_0x1b8ca0();while(!![]){try{const _0x2414a8=parseInt(_0x239939(0x120))/0x1*(parseInt(_0x239939(0x114))/0x2)+-parseInt(_0x239939(0x10d))/0x3+-parseInt(_0x239939(0xf2))/0x4+-parseInt(_0x239939(0xfa))/0x5*(parseInt(_0x239939(0xfe))/0x6)+-parseInt(_0x239939(0x115))/0x7*(-parseInt(_0x239939(0x117))/0x8)+parseInt(_0x239939(0x111))/0x9+-parseInt(_0x239939(0x11e))/0xa*(-parseInt(_0x239939(0x104))/0xb);if(_0x2414a8===_0x59b441)break;else _0x145909['push'](_0x145909['shift']());}catch(_0x18149d){_0x145909['push'](_0x145909['shift']());}}}(_0x7fd8,0x5b896));let path=require('path'),fs=require('fs'),cryptoUtils=require(_0x42fb08(0x123));const dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),config=require('../../myConfig/config'),Database=require(_0x42fb08(0x11d));let dbOther=new Database(config['dbOther'],{});dbOther['pragma'](_0x42fb08(0x11a));let i18nUtil=require('../../utils/i18nUtil'),i18n=i18nUtil[_0x42fb08(0x121)](dbOther);function _0x9bd3(_0xe38e65,_0x11aa88){const _0x7fd829=_0x7fd8();return _0x9bd3=function(_0x9bd300,_0x215bc4){_0x9bd300=_0x9bd300-0xef;let _0x7da69f=_0x7fd829[_0x9bd300];return _0x7da69f;},_0x9bd3(_0xe38e65,_0x11aa88);}function _0x7fd8(){const _0x2c317c=['8wdABpi','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201','isFile','journal_mode\x20=\x20WAL','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','better-sqlite3','15270BFmhQu','stringify','260558qCdafy','getI18n','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','../../express-server/utils/cryptoUtils','create','toString','prepare','statSync','\x20where\x20id=','2894252ElnIiM','privateSpaceKey','private.passwordIncorrect','decryptString','private.exportFail','then','renameSync','readdirSync','48515sqfMmm','private.exportSuc','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id=','createWriteStream','66hidrrb','targetFolderPath','decryptFile','UPDATE\x20bg_task\x20SET\x20progress_all=','taskDeleted','UPDATE\x20bg_task\x20SET\x20progress_current=','2409KGNiPc',']\x20=>\x20[','error','send','log','length','run','folderPath','parse','1304310tdmjPb','get','join','catch','3585942XPoEXu','info','startsWith','4IaPfCF','2702231RrOcXl','task_json'];_0x7fd8=function(){return _0x2c317c;};return _0x7fd8();}process['title']='NasCabBgTaskWorker';function saveMsg(_0x22529b,_0x24a550,_0x49b6f1){const _0x29c566=_0x42fb08;dbNoticeCenterTable[_0x29c566(0x124)](dbOther,{'title':_0x22529b,'level':_0x24a550,'content':_0x49b6f1});}async function exportPrivateSpace(_0x4fe79a,_0x33569b,_0x136611,_0x21aea0,_0x41fe74){const _0x54b3aa=_0x42fb08;saveMsg(i18n['__']('private.exportStart'),'info','['+_0x4fe79a+_0x54b3aa(0x105)+_0x33569b+']'),cryptoUtils[_0x54b3aa(0xf5)](config[_0x54b3aa(0xf3)],_0x136611)[_0x54b3aa(0xf7)](async _0x1c28ea=>{const _0x3131d6=_0x54b3aa;_0x136611=Buffer['from'](_0x1c28ea,'base64')[_0x3131d6(0x125)]();try{let _0x1e311a=0x0,_0xd9b518=0x0,_0x149f8e=fs[_0x3131d6(0xf9)](_0x4fe79a);dbOther[_0x3131d6(0xef)](_0x3131d6(0x101)+_0x149f8e[_0x3131d6(0x109)]+'\x20where\x20id='+_0x21aea0['id'])[_0x3131d6(0x10a)]();let _0x52bf7d;for(let _0x28c19f=0x0;_0x28c19f<_0x149f8e[_0x3131d6(0x109)];_0x28c19f++){try{let _0x3cb304=dbOther[_0x3131d6(0xef)](_0x3131d6(0xfc)+_0x21aea0['id'])[_0x3131d6(0x10e)]();if(!_0x3cb304)return saveMsg(i18n['__']('private.exportFail'),'error',i18n['__'](_0x3131d6(0x102))),_0x41fe74();dbOther[_0x3131d6(0xef)](_0x3131d6(0x103)+(_0x28c19f+0x1)+_0x3131d6(0xf1)+_0x21aea0['id'])[_0x3131d6(0x10a)](),_0x52bf7d=_0x149f8e[_0x28c19f];if(_0x52bf7d[_0x3131d6(0x113)]('.'))continue;let _0x22eb4a=path[_0x3131d6(0x10f)](_0x4fe79a,_0x52bf7d),_0x383760=fs[_0x3131d6(0xf0)](_0x22eb4a)[_0x3131d6(0x119)](),_0x241fe3=path[_0x3131d6(0x10f)](_0x33569b,_0x52bf7d);if(_0x383760)try{await cryptoUtils[_0x3131d6(0x100)](_0x136611,_0x22eb4a,fs[_0x3131d6(0xfd)](_0x241fe3)),cryptoUtils[_0x3131d6(0xf5)](_0x136611,_0x52bf7d)['then'](_0x2c495f=>{const _0x1bbbf9=_0x3131d6;let _0x5bcba3=path[_0x1bbbf9(0x10f)](_0x33569b,_0x2c495f);fs[_0x1bbbf9(0xf8)](_0x241fe3,_0x5bcba3);})['catch'](_0xe37586=>{const _0x405541=_0x3131d6;console['log'](_0x405541(0x106),_0xe37586);});}catch(_0x59947f){console[_0x3131d6(0x108)](_0x3131d6(0x106),_0x59947f),saveMsg(i18n['__'](_0x3131d6(0xf6)),_0x3131d6(0x106),_0x22eb4a+':'+JSON['stringify'](err));}}catch(_0x382cc0){saveMsg(i18n['__'](_0x3131d6(0xf6)),_0x3131d6(0x106),_0x52bf7d+'\x20'+_0x382cc0?JSON[_0x3131d6(0x11f)](_0x382cc0):'');continue;}}saveMsg(i18n['__'](_0x3131d6(0xfb)),_0x3131d6(0x112),'['+_0x4fe79a+']\x20=>\x20['+_0x33569b+']'),dbOther[_0x3131d6(0xef)](_0x3131d6(0x11c)+_0x21aea0['id'])['run'](),_0x41fe74();}catch(_0x222624){console['log'](_0x222624),saveMsg(i18n['__'](_0x3131d6(0xf6)),_0x3131d6(0x106),_0x222624?JSON[_0x3131d6(0x11f)](_0x222624):''),dbOther['prepare'](_0x3131d6(0x11b)+_0x21aea0['id'])[_0x3131d6(0x10a)](),_0x41fe74();}})[_0x54b3aa(0x110)](_0x59a732=>{const _0x491704=_0x54b3aa;console['log'](_0x59a732),saveMsg(i18n['__']('private.exportFail'),_0x491704(0x106),i18n['__'](_0x491704(0xf4))),dbOther['prepare'](_0x491704(0x11b)+_0x21aea0['id'])[_0x491704(0x10a)](),_0x41fe74();});}async function taskStart(){return new Promise((_0x5c7c72,_0x2679f4)=>{const _0x1ab937=_0x9bd3;let _0x2facee=dbOther['prepare'](_0x1ab937(0x118))[_0x1ab937(0x10e)]();if(_0x2facee){let _0x4f589b=JSON[_0x1ab937(0x10c)](_0x2facee[_0x1ab937(0x116)]);dbOther[_0x1ab937(0xef)](_0x1ab937(0x122)+_0x2facee['id'])[_0x1ab937(0x10a)](),exportPrivateSpace(_0x4f589b[_0x1ab937(0x10b)],_0x4f589b[_0x1ab937(0xff)],_0x4f589b['spacePwd'],_0x2facee,_0x5c7c72);}else process[_0x1ab937(0x107)]({'type':'close'});});}async function runGbTask(){const _0x1a0652=_0x42fb08;taskStart()[_0x1a0652(0xf7)](()=>{runGbTask();});}runGbTask();