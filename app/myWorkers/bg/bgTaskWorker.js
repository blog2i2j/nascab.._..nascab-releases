const _0xa82ff2=_0x36c2;(function(_0x42f4e1,_0x388a41){const _0x486e5a=_0x36c2,_0x2ca810=_0x42f4e1();while(!![]){try{const _0x45c99a=-parseInt(_0x486e5a(0x1e4))/0x1+-parseInt(_0x486e5a(0x1ed))/0x2+parseInt(_0x486e5a(0x1dc))/0x3+parseInt(_0x486e5a(0x1d5))/0x4*(parseInt(_0x486e5a(0x1e2))/0x5)+-parseInt(_0x486e5a(0x20f))/0x6*(parseInt(_0x486e5a(0x208))/0x7)+parseInt(_0x486e5a(0x201))/0x8+parseInt(_0x486e5a(0x1f4))/0x9*(parseInt(_0x486e5a(0x207))/0xa);if(_0x45c99a===_0x388a41)break;else _0x2ca810['push'](_0x2ca810['shift']());}catch(_0x1acf46){_0x2ca810['push'](_0x2ca810['shift']());}}}(_0x3296,0x7c271));let path=require('path'),fs=require('fs'),cryptoUtils=require(_0xa82ff2(0x20c));function _0x36c2(_0x140cbb,_0x469053){const _0x329667=_0x3296();return _0x36c2=function(_0x36c23c,_0x2b2423){_0x36c23c=_0x36c23c-0x1d5;let _0x5942be=_0x329667[_0x36c23c];return _0x5942be;},_0x36c2(_0x140cbb,_0x469053);}function _0x3296(){const _0xc0163f=['then','45oCDZdt','UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id=','decryptFile','../../utils/i18nUtil','toString','length','dbOther','close','log','decryptString','catch',']\x20=>\x20[','private.exportSuc','3297648sryVdD','private.exportFail','join','taskDeleted','from','get','665130NUCGSE','1840846NVfoJg','folderPath','task_json','prepare','../../express-server/utils/cryptoUtils','NasCabBgTaskWorker','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','6mDiyHD','883700XHDkhK','stringify','targetFolderPath','renameSync','private.passwordIncorrect','info','spacePwd','2200164JayHXH','createWriteStream','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id=','create','journal_mode\x20=\x20WAL','readdirSync','10hhBpJz','title','531171OmRXqE','../../myConfig/config','getI18n','UPDATE\x20bg_task\x20SET\x20progress_all=','SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201','\x20where\x20id=','startsWith','run','statSync','1234662qvqFTR','private.exportStart','base64','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','error','better-sqlite3'];_0x3296=function(){return _0xc0163f;};return _0x3296();}const dbNoticeCenterTable=require('../../db/dbNoticeCenterTable'),config=require(_0xa82ff2(0x1e5)),Database=require(_0xa82ff2(0x1f2));let dbOther=new Database(config[_0xa82ff2(0x1fa)],{});dbOther['pragma'](_0xa82ff2(0x1e0));let i18nUtil=require(_0xa82ff2(0x1f7)),i18n=i18nUtil[_0xa82ff2(0x1e6)](dbOther);process[_0xa82ff2(0x1e3)]=_0xa82ff2(0x20d);function saveMsg(_0x2535e2,_0x519ab3,_0x459ce6){const _0x1eceb9=_0xa82ff2;dbNoticeCenterTable[_0x1eceb9(0x1df)](dbOther,{'title':_0x2535e2,'level':_0x519ab3,'content':_0x459ce6});}async function exportPrivateSpace(_0x1699b6,_0x355854,_0x463c54,_0x58530b,_0x1381d6){const _0x1b0de2=_0xa82ff2;saveMsg(i18n['__'](_0x1b0de2(0x1ee)),'info','['+_0x1699b6+_0x1b0de2(0x1ff)+_0x355854+']'),cryptoUtils[_0x1b0de2(0x1fd)](config['privateSpaceKey'],_0x463c54)[_0x1b0de2(0x1f3)](async _0x5c4806=>{const _0x110a5f=_0x1b0de2;_0x463c54=Buffer[_0x110a5f(0x205)](_0x5c4806,_0x110a5f(0x1ef))[_0x110a5f(0x1f8)]();try{let _0x834a3c=0x0,_0x50d53f=0x0,_0x5b6199=fs[_0x110a5f(0x1e1)](_0x1699b6);dbOther[_0x110a5f(0x20b)](_0x110a5f(0x1e7)+_0x5b6199[_0x110a5f(0x1f9)]+_0x110a5f(0x1e9)+_0x58530b['id'])[_0x110a5f(0x1eb)]();let _0x147dde;for(let _0x5bfdd6=0x0;_0x5bfdd6<_0x5b6199['length'];_0x5bfdd6++){try{let _0x5ea676=dbOther['prepare'](_0x110a5f(0x1de)+_0x58530b['id'])['get']();if(!_0x5ea676)return saveMsg(i18n['__']('private.exportFail'),'error',i18n['__'](_0x110a5f(0x204))),_0x1381d6();dbOther[_0x110a5f(0x20b)]('UPDATE\x20bg_task\x20SET\x20progress_current='+(_0x5bfdd6+0x1)+_0x110a5f(0x1e9)+_0x58530b['id'])[_0x110a5f(0x1eb)](),_0x147dde=_0x5b6199[_0x5bfdd6];if(_0x147dde[_0x110a5f(0x1ea)]('.'))continue;let _0x1176ee=path[_0x110a5f(0x203)](_0x1699b6,_0x147dde),_0x1382a0=fs[_0x110a5f(0x1ec)](_0x1176ee)['isFile'](),_0x1156ed=path[_0x110a5f(0x203)](_0x355854,_0x147dde);if(_0x1382a0)try{await cryptoUtils[_0x110a5f(0x1f6)](_0x463c54,_0x1176ee,fs[_0x110a5f(0x1dd)](_0x1156ed)),cryptoUtils[_0x110a5f(0x1fd)](_0x463c54,_0x147dde)[_0x110a5f(0x1f3)](_0x2e4251=>{const _0x5bb9fd=_0x110a5f;let _0x2f03de=path[_0x5bb9fd(0x203)](_0x355854,_0x2e4251);fs[_0x5bb9fd(0x1d8)](_0x1156ed,_0x2f03de);})['catch'](_0x312a81=>{const _0x3d9a65=_0x110a5f;console[_0x3d9a65(0x1fc)](_0x3d9a65(0x1f1),_0x312a81);});}catch(_0x161281){console['log'](_0x110a5f(0x1f1),_0x161281),saveMsg(i18n['__']('private.exportFail'),_0x110a5f(0x1f1),_0x1176ee+':'+JSON[_0x110a5f(0x1d6)](err));}}catch(_0x401ba5){saveMsg(i18n['__']('private.exportFail'),_0x110a5f(0x1f1),_0x147dde+'\x20'+_0x401ba5?JSON[_0x110a5f(0x1d6)](_0x401ba5):'');continue;}}saveMsg(i18n['__'](_0x110a5f(0x200)),_0x110a5f(0x1da),'['+_0x1699b6+_0x110a5f(0x1ff)+_0x355854+']'),dbOther['prepare'](_0x110a5f(0x1f0)+_0x58530b['id'])['run'](),_0x1381d6();}catch(_0x4a37c6){console[_0x110a5f(0x1fc)](_0x4a37c6),saveMsg(i18n['__'](_0x110a5f(0x202)),'error',_0x4a37c6?JSON['stringify'](_0x4a37c6):''),dbOther[_0x110a5f(0x20b)](_0x110a5f(0x20e)+_0x58530b['id'])[_0x110a5f(0x1eb)](),_0x1381d6();}})[_0x1b0de2(0x1fe)](_0x18b5fa=>{const _0x3b4d1c=_0x1b0de2;console[_0x3b4d1c(0x1fc)](_0x18b5fa),saveMsg(i18n['__']('private.exportFail'),'error',i18n['__'](_0x3b4d1c(0x1d9))),dbOther[_0x3b4d1c(0x20b)](_0x3b4d1c(0x20e)+_0x58530b['id'])[_0x3b4d1c(0x1eb)](),_0x1381d6();});}async function taskStart(){return new Promise((_0x5010ed,_0x5b14a3)=>{const _0x42f240=_0x36c2;let _0x3c5394=dbOther[_0x42f240(0x20b)](_0x42f240(0x1e8))[_0x42f240(0x206)]();if(_0x3c5394){let _0x1de63f=JSON['parse'](_0x3c5394[_0x42f240(0x20a)]);dbOther[_0x42f240(0x20b)](_0x42f240(0x1f5)+_0x3c5394['id'])[_0x42f240(0x1eb)](),exportPrivateSpace(_0x1de63f[_0x42f240(0x209)],_0x1de63f[_0x42f240(0x1d7)],_0x1de63f[_0x42f240(0x1db)],_0x3c5394,_0x5010ed);}else process['send']({'type':_0x42f240(0x1fb)});});}async function runGbTask(){const _0x118a6d=_0xa82ff2;taskStart()[_0x118a6d(0x1f3)](()=>{runGbTask();});}runGbTask();