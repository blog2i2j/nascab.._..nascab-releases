const _0x15307b=_0x5c3a;(function(_0x2bd453,_0x18b017){const _0x141c9c=_0x5c3a,_0x3d79c2=_0x2bd453();while(!![]){try{const _0x4b4704=parseInt(_0x141c9c(0xca))/0x1*(-parseInt(_0x141c9c(0xd3))/0x2)+-parseInt(_0x141c9c(0xb5))/0x3+-parseInt(_0x141c9c(0xc8))/0x4*(parseInt(_0x141c9c(0xd5))/0x5)+-parseInt(_0x141c9c(0xce))/0x6*(parseInt(_0x141c9c(0xbc))/0x7)+parseInt(_0x141c9c(0xb1))/0x8+parseInt(_0x141c9c(0xc4))/0x9*(-parseInt(_0x141c9c(0xba))/0xa)+parseInt(_0x141c9c(0xb0))/0xb*(parseInt(_0x141c9c(0xd9))/0xc);if(_0x4b4704===_0x18b017)break;else _0x3d79c2['push'](_0x3d79c2['shift']());}catch(_0x3ecaa7){_0x3d79c2['push'](_0x3d79c2['shift']());}}}(_0x5462,0x8a7c2));let path=require('path'),fs=require('fs'),cryptoUtils=require(_0x15307b(0xd0));const dbNoticeCenterTable=require(_0x15307b(0xd8)),config=require(_0x15307b(0xaf)),Database=require('better-sqlite3');function _0x5c3a(_0x3cf48b,_0xf40911){const _0x5462e8=_0x5462();return _0x5c3a=function(_0x5c3a55,_0x4d6215){_0x5c3a55=_0x5c3a55-0xab;let _0x1cc501=_0x5462e8[_0x5c3a55];return _0x1cc501;},_0x5c3a(_0x3cf48b,_0xf40911);}let dbOther=new Database(config['dbOther'],{});dbOther[_0x15307b(0xde)](_0x15307b(0xbe));let i18nUtil=require(_0x15307b(0xd1)),i18n=i18nUtil[_0x15307b(0xae)](dbOther);process[_0x15307b(0xc0)]=_0x15307b(0xc5);function _0x5462(){const _0x32b2d2=['../../db/dbNoticeCenterTable','12sxZsWC','targetFolderPath','error','UPDATE\x20bg_task\x20SET\x20task_state=3\x20where\x20id=','UPDATE\x20bg_task\x20SET\x20task_state=2\x20where\x20id=','pragma','close','isFile','folderPath','log','prepare','run','getI18n','../../myConfig/config','20251957hNnGwn','8142352TtnxTd','statSync','decryptString','renameSync','1985556WHeSDG','UPDATE\x20bg_task\x20SET\x20progress_current=','then','base64','toString','20nWVaJm',']\x20=>\x20[','7LlxmWj','join','journal_mode\x20=\x20WAL','catch','title','spacePwd','task_json','private.exportSuc','2341602DXMOvh','NasCabBgTaskWorker','length','info','78956YFDnIt','privateSpaceKey','1jzmrUG','private.exportFail','\x20where\x20id=','stringify','1967892OjHfHR','taskDeleted','../../express-server/utils/cryptoUtils','../../utils/i18nUtil','from','773354WrAcbg','create','100yFIchC','private.exportStart','get'];_0x5462=function(){return _0x32b2d2;};return _0x5462();}function saveMsg(_0x59a033,_0x5801c7,_0x42945b){const _0x48c0d3=_0x15307b;dbNoticeCenterTable[_0x48c0d3(0xd4)](dbOther,{'title':_0x59a033,'level':_0x5801c7,'content':_0x42945b});}async function exportPrivateSpace(_0x2251ca,_0xab3766,_0x3b92d7,_0x2c1c04,_0x3d1009){const _0x2d82ef=_0x15307b;saveMsg(i18n['__'](_0x2d82ef(0xd6)),_0x2d82ef(0xc7),'['+_0x2251ca+_0x2d82ef(0xbb)+_0xab3766+']'),cryptoUtils[_0x2d82ef(0xb3)](config[_0x2d82ef(0xc9)],_0x3b92d7)['then'](async _0x4dc231=>{const _0x1ea84c=_0x2d82ef;_0x3b92d7=Buffer[_0x1ea84c(0xd2)](_0x4dc231,_0x1ea84c(0xb8))[_0x1ea84c(0xb9)]();try{let _0x20a0c6=0x0,_0x2111fd=0x0,_0x430023=fs['readdirSync'](_0x2251ca);dbOther[_0x1ea84c(0xac)]('UPDATE\x20bg_task\x20SET\x20progress_all='+_0x430023[_0x1ea84c(0xc6)]+_0x1ea84c(0xcc)+_0x2c1c04['id'])[_0x1ea84c(0xad)]();let _0x30b8e5;for(let _0x14b5b0=0x0;_0x14b5b0<_0x430023[_0x1ea84c(0xc6)];_0x14b5b0++){try{let _0x487811=dbOther['prepare']('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20id='+_0x2c1c04['id'])[_0x1ea84c(0xd7)]();if(!_0x487811)return saveMsg(i18n['__'](_0x1ea84c(0xcb)),_0x1ea84c(0xdb),i18n['__'](_0x1ea84c(0xcf))),_0x3d1009();dbOther[_0x1ea84c(0xac)](_0x1ea84c(0xb6)+(_0x14b5b0+0x1)+'\x20where\x20id='+_0x2c1c04['id'])[_0x1ea84c(0xad)](),_0x30b8e5=_0x430023[_0x14b5b0];if(_0x30b8e5['startsWith']('.'))continue;let _0x164716=path[_0x1ea84c(0xbd)](_0x2251ca,_0x30b8e5),_0x57369e=fs[_0x1ea84c(0xb2)](_0x164716)[_0x1ea84c(0xe0)](),_0x3b92cf=path['join'](_0xab3766,_0x30b8e5);if(_0x57369e)try{await cryptoUtils['decryptFile'](_0x3b92d7,_0x164716,fs['createWriteStream'](_0x3b92cf)),cryptoUtils[_0x1ea84c(0xb3)](_0x3b92d7,_0x30b8e5)[_0x1ea84c(0xb7)](_0x56761a=>{const _0x56e3d8=_0x1ea84c;let _0x4ebdcb=path['join'](_0xab3766,_0x56761a);fs[_0x56e3d8(0xb4)](_0x3b92cf,_0x4ebdcb);})[_0x1ea84c(0xbf)](_0xe9fcd4=>{const _0x523f39=_0x1ea84c;console['log'](_0x523f39(0xdb),_0xe9fcd4);});}catch(_0x4fe74a){console[_0x1ea84c(0xab)](_0x1ea84c(0xdb),_0x4fe74a),saveMsg(i18n['__']('private.exportFail'),'error',_0x164716+':'+JSON[_0x1ea84c(0xcd)](err));}}catch(_0x1461b5){saveMsg(i18n['__']('private.exportFail'),_0x1ea84c(0xdb),_0x30b8e5+'\x20'+_0x1461b5?JSON[_0x1ea84c(0xcd)](_0x1461b5):'');continue;}}saveMsg(i18n['__'](_0x1ea84c(0xc3)),_0x1ea84c(0xc7),'['+_0x2251ca+_0x1ea84c(0xbb)+_0xab3766+']'),dbOther[_0x1ea84c(0xac)](_0x1ea84c(0xdd)+_0x2c1c04['id'])[_0x1ea84c(0xad)](),_0x3d1009();}catch(_0x1b3438){console['log'](_0x1b3438),saveMsg(i18n['__'](_0x1ea84c(0xcb)),_0x1ea84c(0xdb),_0x1b3438?JSON[_0x1ea84c(0xcd)](_0x1b3438):''),dbOther[_0x1ea84c(0xac)](_0x1ea84c(0xdc)+_0x2c1c04['id'])[_0x1ea84c(0xad)](),_0x3d1009();}})['catch'](_0x57a87f=>{const _0x1a18f3=_0x2d82ef;console['log'](_0x57a87f),saveMsg(i18n['__']('private.exportFail'),_0x1a18f3(0xdb),i18n['__']('private.passwordIncorrect')),dbOther[_0x1a18f3(0xac)](_0x1a18f3(0xdc)+_0x2c1c04['id'])[_0x1a18f3(0xad)](),_0x3d1009();});}async function taskStart(){return new Promise((_0x2254aa,_0x5cc087)=>{const _0x310345=_0x5c3a;let _0x141eca=dbOther[_0x310345(0xac)]('SELECT\x20*\x20FROM\x20bg_task\x20WHERE\x20task_type=\x27EXPORT_PRIVATE_SPACE\x27\x20and\x20task_state=0\x20order\x20by\x20create_time\x20asc\x20limit\x201')[_0x310345(0xd7)]();if(_0x141eca){let _0x4008a5=JSON['parse'](_0x141eca[_0x310345(0xc2)]);dbOther[_0x310345(0xac)]('UPDATE\x20bg_task\x20SET\x20task_state=1\x20where\x20id='+_0x141eca['id'])[_0x310345(0xad)](),exportPrivateSpace(_0x4008a5[_0x310345(0xe1)],_0x4008a5[_0x310345(0xda)],_0x4008a5[_0x310345(0xc1)],_0x141eca,_0x2254aa);}else process['send']({'type':_0x310345(0xdf)});});}async function runGbTask(){const _0x4adb93=_0x15307b;taskStart()[_0x4adb93(0xb7)](()=>{runGbTask();});}runGbTask();