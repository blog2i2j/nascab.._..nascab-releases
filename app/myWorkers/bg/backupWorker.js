const _0x3c6990=_0x1642;(function(_0x324f5f,_0x36699b){const _0x2059f5=_0x1642,_0x33782c=_0x324f5f();while(!![]){try{const _0x283562=-parseInt(_0x2059f5(0x89))/0x1+parseInt(_0x2059f5(0x97))/0x2+-parseInt(_0x2059f5(0x80))/0x3*(parseInt(_0x2059f5(0xbb))/0x4)+parseInt(_0x2059f5(0x7b))/0x5*(-parseInt(_0x2059f5(0x8d))/0x6)+-parseInt(_0x2059f5(0x8e))/0x7*(parseInt(_0x2059f5(0x8f))/0x8)+parseInt(_0x2059f5(0xcb))/0x9+parseInt(_0x2059f5(0x7a))/0xa*(parseInt(_0x2059f5(0x9e))/0xb);if(_0x283562===_0x36699b)break;else _0x33782c['push'](_0x33782c['shift']());}catch(_0x546333){_0x33782c['push'](_0x33782c['shift']());}}}(_0x9f2f,0x84923));const Database=require(_0x3c6990(0x87)),config=require(_0x3c6990(0xb4));let dbOther=new Database(config[_0x3c6990(0xc9)],{});dbOther[_0x3c6990(0xa9)]('journal_mode\x20=\x20WAL');let moment=require(_0x3c6990(0xcf)),path=require(_0x3c6990(0xd2)),fs=require('fs'),i18nUtil=require(_0x3c6990(0xca)),i18n=i18nUtil[_0x3c6990(0x8b)](dbOther);process[_0x3c6990(0x7e)]=_0x3c6990(0xaf);let copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![],excludeList=[];function _0x9f2f(){const _0x57cefc=['exclude_list','constants','26004NOjbVw','%\x27)','copy_size=','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x272\x27\x20AND\x20task_time\x20LIKE\x20\x27','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x271\x27\x20AND\x20task_day=\x27','status',',copy_count=','target_path','\x27\x20AND\x20task_time\x20LIKE\x20\x27','select\x20count(*)\x20as\x20count\x20from\x20backup_task_record\x20where\x20task_id=',',status=\x27done\x27,fail_count=','isFile','select\x20count(*)\x20as\x20count\x20from\x20backup_task_msg\x20where\x20msg_type=\x27ERROR\x27\x20and\x20task_record_id=','getDay','dbOther','../../utils/i18nUtil','49842QEQqAk','ReadFolderFail','source_list','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x273\x27\x20AND\x20task_day=\x27','moment','existsSync','abs','path','noWritePermission','targetFolderNotExist',',exclude_count=','mtimeMs','7400230pJvvce','5HHZffa','folderNotExist','getHours','title','getDate','6iCgEbJ','stringify','status=\x27running\x27','ERROR','prepare','get','select\x20status\x20from\x20backup_task_record\x20where\x20id=','better-sqlite3','format','199679vNbETx','then','getI18n','exit','254946hnnqOu','317429AKtbgu','136vXmAAp','count','getMonth','cpSync','REPLACE\x20INTO\x20\x0a\x09\x20\x20\x20\x20\x20backup_task_msg(task_id,task_record_id,msg_type,content)\x20\x0a\x09\x20\x20\x20\x20\x20VALUES(\x20?,?,?,?)','replace','\x27,\x20\x27waiting\x27,\x27','join','166996wqTnNY','R_OK','accessSync','split','UPDATE\x20backup_task_record\x20SET\x20','\x20ERROR:','readdirSync','22txsXTw','getTime','fileCopyFail','includes','SELECT\x20*\x20FROM\x20backup_task_record\x20WHERE\x20status\x20=\x20\x27waiting\x27\x20order\x20by\x20start_time\x20limit\x201\x20','exec','test','task_id',',files_count=','length','map','pragma','\x5c$1','statSync','close','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x274\x27\x20AND\x20task_day=\x27','size','NasCabBackupWorker','getFullYear','basename','isDirectory',',end_time=\x27','../../myConfig/config','rmdirSync','\x27\x20or\x20status!=\x27done\x27)','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20id\x20=\x20','YYYY-MM-DD\x20HH:mm:ss'];_0x9f2f=function(){return _0x57cefc;};return _0x9f2f();}function copyFile(_0x52f8ff,_0x4a768a,_0x214105,_0x372152){const _0x32c8e2=_0x3c6990;try{let _0x1ed969=dbOther[_0x32c8e2(0x84)](_0x32c8e2(0x86)+_0x4a768a)[_0x32c8e2(0x85)]();if(_0x1ed969[_0x32c8e2(0xc0)]!='running')return paused=!![],![];let _0x12d17a=fs[_0x32c8e2(0xab)](_0x214105);filesCount+=0x1,totalSize+=_0x12d17a[_0x32c8e2(0xae)];let _0x34829f=!![];if(!fs['existsSync'](_0x372152))fs[_0x32c8e2(0x92)](_0x214105,_0x372152,{'preserveTimestamps':!![]}),copySize+=_0x12d17a['size'],copyFileCount+=0x1;else{let _0x247f7b=fs[_0x32c8e2(0xab)](_0x372152);_0x12d17a[_0x32c8e2(0xae)]==_0x247f7b[_0x32c8e2(0xae)]&&Math[_0x32c8e2(0xd1)](_0x12d17a[_0x32c8e2(0x79)]-_0x247f7b[_0x32c8e2(0x79)])<=0x3e8?_0x34829f=![]:(fs[_0x32c8e2(0x92)](_0x214105,_0x372152,{'preserveTimestamps':!![]}),copySize+=_0x12d17a['size'],copyFileCount+=0x1);}return _0x34829f&&updateTaskRecord(_0x4a768a,_0x32c8e2(0xbd)+copySize+_0x32c8e2(0xc1)+copyFileCount),!![];}catch(_0x4842f1){return addTaskMsg(_0x52f8ff,_0x4a768a,_0x32c8e2(0x83),_0x214105+':'+i18n['__']('fileCopyFail')+_0x32c8e2(0x9c)+JSON[_0x32c8e2(0x81)](_0x4842f1)),!![];}}function matchRuleShort(_0x26bd3e,_0x43f00e){const _0x4bcae6=_0x3c6990;var _0x441500=_0x1a350a=>_0x1a350a[_0x4bcae6(0x94)](/([.*+?^=!:${}()|\[\]\/\\])/g,_0x4bcae6(0xaa));return new RegExp('^'+_0x43f00e[_0x4bcae6(0x9a)]('*')[_0x4bcae6(0xa8)](_0x441500)['join']('.*')+'$')[_0x4bcae6(0xa4)](_0x26bd3e);}function copyFolder(_0x1c94fa,_0x264223,_0x20f493,_0x51640e,_0x2a30e8){const _0x324590=_0x3c6990;let _0x3c0d17=_0x1c94fa['id'],_0x4cf06c=checkFolderPower(_0x51640e,!![]);if(!_0x4cf06c)addTaskMsg(_0x3c0d17,_0x264223,_0x324590(0x83),i18n['__'](_0x324590(0x76))+':'+_0x51640e);else try{let _0x42edfe=fs[_0x324590(0x9d)](_0x51640e);for(let _0x47a339=0x0;_0x47a339<_0x42edfe[_0x324590(0xa7)];_0x47a339++){let _0x4300d4=_0x42edfe[_0x47a339];var _0x565613=path[_0x324590(0x96)](_0x51640e,_0x4300d4);let _0x5b2829=fs[_0x324590(0xab)](_0x565613);var _0x433772=_0x5b2829[_0x324590(0xc6)](),_0x45fed7=_0x5b2829['isDirectory']();if(_0x433772){if(excludeList[_0x324590(0xa1)](_0x4300d4))continue;if(_0x1c94fa[_0x324590(0xb9)]&&_0x1c94fa[_0x324590(0xb9)][_0x324590(0xa7)]>0x0){let _0xe5c837=JSON['parse'](_0x1c94fa[_0x324590(0xb9)]),_0x142230=!![];for(let _0x5e5a9c in _0xe5c837){if(_0xe5c837[_0x5e5a9c][_0x324590(0xa1)]('*')){if(matchRuleShort(_0x4300d4,_0xe5c837[_0x5e5a9c])){_0x142230=![];break;}}else{if(_0xe5c837[_0x5e5a9c]==_0x4300d4){_0x142230=![];break;}}}if(!_0x142230){excludeCount+=0x1;continue;}}let _0x49ad68=path[_0x324590(0x96)](_0x2a30e8,path[_0x324590(0xb1)](_0x20f493),_0x565613['substring'](_0x20f493[_0x324590(0xa7)])),_0x1a9246=copyFile(_0x3c0d17,_0x264223,_0x565613,_0x49ad68);if(_0x1a9246===![])return![];}else _0x45fed7&&copyFolder(_0x1c94fa,_0x264223,_0x20f493,_0x565613,_0x2a30e8);}}catch(_0x10b917){addTaskMsg(_0x3c0d17,_0x264223,'ERROR',i18n['__'](_0x324590(0xcc))+':'+_0x51640e);}}function reverseCheck(_0x397af3,_0x2da4e0,_0xc24bb9,_0x421f97,_0x360907){const _0x217366=_0x3c6990;try{if(!fs['existsSync'](_0x360907))return;let _0x446859=fs[_0x217366(0x9d)](_0x360907);for(let _0x1fd33e=0x0;_0x1fd33e<_0x446859[_0x217366(0xa7)];_0x1fd33e++){let _0x3f3434=_0x446859[_0x1fd33e];var _0x3266b1=path['join'](_0x360907,_0x3f3434);let _0x29166c=fs[_0x217366(0xab)](_0x3266b1);var _0x49d844=_0x29166c['isFile'](),_0x2744d6=_0x29166c[_0x217366(0xb2)]();let _0x222965=path[_0x217366(0x96)](_0x421f97,_0x3266b1['substring'](_0xc24bb9['length']));if(_0x49d844)!fs['existsSync'](_0x222965)&&fs['rmSync'](_0x3266b1,{'force':!![],'maxRetries':0xa});else _0x2744d6&&(!fs[_0x217366(0xd0)](_0x222965)?fs[_0x217366(0xb5)](_0x3266b1,{'recursive':!![],'maxRetries':0xa}):reverseCheck(_0x397af3,_0x2da4e0,_0xc24bb9,_0x421f97,_0x3266b1));}}catch(_0x4c9fcc){addTaskMsg(_0x397af3,_0x2da4e0,'ERROR',i18n['__'](_0x217366(0xcc))+':'+_0x421f97);}}function updateTaskRecord(_0x2b9fc1,_0x47e557){const _0x40eea3=_0x3c6990;let _0x198af3=_0x40eea3(0x9b);_0x198af3+=_0x47e557,_0x198af3+='\x20WHERE\x20id='+_0x2b9fc1,dbOther[_0x40eea3(0xa3)](_0x198af3);}function setTaskOver(_0x3ee2c4){const _0x3b9c25=_0x3c6990;let _0xa9f02c=dbOther[_0x3b9c25(0x84)](_0x3b9c25(0xc7)+_0x3ee2c4['id'])[_0x3b9c25(0x85)](),_0x5ae0d6=moment()[_0x3b9c25(0x88)](_0x3b9c25(0xb8));updateTaskRecord(_0x3ee2c4['id'],_0x3b9c25(0xbd)+copySize+_0x3b9c25(0xc1)+copyFileCount+_0x3b9c25(0x78)+excludeCount+_0x3b9c25(0xc5)+_0xa9f02c['count']+_0x3b9c25(0xa6)+filesCount+',total_size='+totalSize+_0x3b9c25(0xb3)+_0x5ae0d6+'\x27');}function addTaskMsg(_0x4b7821,_0x4d0c77,_0x9aae62,_0x21a120){const _0x3fdcee=_0x3c6990,_0xc40b00=_0x3fdcee(0x93);return dbOther['prepare'](_0xc40b00)['run'](''+_0x4b7821,''+_0x4d0c77,''+_0x9aae62,''+_0x21a120);}function checkFolderPower(_0x489836,_0x569b68){const _0x88679=_0x3c6990;try{return _0x569b68?fs[_0x88679(0x99)](_0x489836,fs['constants'][_0x88679(0x98)]):fs[_0x88679(0x99)](_0x489836,fs[_0x88679(0xba)][_0x88679(0x98)]|fs[_0x88679(0xba)]['W_OK']),!![];}catch(_0x4cd361){return![];}}function exeTask(_0x19345c){const _0x34e40e=_0x3c6990;let _0x1a2baa=_0x34e40e(0xa2),_0x100bb7=dbOther[_0x34e40e(0x84)](_0x1a2baa)[_0x34e40e(0x85)]();if(_0x100bb7){let _0x475735=_0x34e40e(0xb7)+_0x100bb7[_0x34e40e(0xa5)],_0x296560=dbOther[_0x34e40e(0x84)](_0x475735)[_0x34e40e(0x85)]();if(!fs['existsSync'](_0x296560[_0x34e40e(0xc2)]))return addTaskMsg(_0x296560['id'],_0x100bb7['id'],_0x34e40e(0x83),i18n['__'](_0x34e40e(0x77))+':'+_0x296560[_0x34e40e(0xc2)]),setTaskOver(_0x100bb7),_0x19345c();let _0x169b3f=checkFolderPower(_0x296560['target_path']);if(!_0x169b3f)return addTaskMsg(_0x296560['id'],_0x100bb7['id'],_0x34e40e(0x83),i18n['__'](_0x34e40e(0x76))+':'+_0x296560[_0x34e40e(0xc2)]),setTaskOver(_0x100bb7),_0x19345c();updateTaskRecord(_0x100bb7['id'],_0x34e40e(0x82));let _0x448c3a=JSON['parse'](_0x296560[_0x34e40e(0xcd)]);copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![];for(let _0x259867 in _0x448c3a){try{if(fs['existsSync'](_0x448c3a[_0x259867])){copyFolder(_0x296560,_0x100bb7['id'],_0x448c3a[_0x259867],_0x448c3a[_0x259867],_0x296560[_0x34e40e(0xc2)]);if(!paused){let _0x3cffcf=path[_0x34e40e(0x96)](_0x296560['target_path'],path[_0x34e40e(0xb1)](_0x448c3a[_0x259867]));reverseCheck(_0x296560['id'],_0x100bb7['id'],_0x3cffcf,_0x448c3a[_0x259867],_0x3cffcf);}}else addTaskMsg(_0x296560['id'],_0x100bb7['id'],_0x34e40e(0x83),i18n['__'](_0x34e40e(0x7c))+':'+_0x448c3a[_0x259867]);}catch(_0x51d1db){addTaskMsg(_0x296560['id'],_0x100bb7['id'],_0x34e40e(0x83),i18n['__'](_0x34e40e(0xa0))+':'+_0x448c3a[_0x259867]+':'+JSON[_0x34e40e(0x81)](_0x51d1db));}}!paused&&setTaskOver(_0x100bb7),_0x19345c();}else setTimeout(()=>{_0x19345c();},0x2710);}function runInfinit(){return new Promise(_0x563aec=>{exeTask(_0x563aec);});}async function runBacupExe(){const _0x24130e=_0x3c6990;runInfinit()[_0x24130e(0x8a)](()=>{runBacupExe();});}dbOther[_0x3c6990(0xa3)]('UPDATE\x20backup_task_record\x20SET\x20status=\x27waiting\x27\x20where\x20status=\x27running\x27'),runBacupExe();function addTask(_0x1b1617){const _0x335ebe=_0x3c6990;let _0x2e7177=dbOther[_0x335ebe(0x84)](_0x1b1617)['all']();if(_0x2e7177['length']>0x0)for(let _0x496836=0x0;_0x496836<_0x2e7177[_0x335ebe(0xa7)];_0x496836++){let _0x542a0b=_0x2e7177[_0x496836],_0x591945=moment(new Date()[_0x335ebe(0x9f)]()-0xea60)['format'](_0x335ebe(0xb8)),_0x5bac98=_0x335ebe(0xc4)+_0x542a0b['id']+'\x20and\x20(start_time>=\x27'+_0x591945+_0x335ebe(0xb6),_0x5af417=dbOther[_0x335ebe(0x84)](_0x5bac98)[_0x335ebe(0x85)]();if(_0x5af417[_0x335ebe(0x90)]<0x1){let _0x4e277c=moment()['format'](_0x335ebe(0xb8));const _0x37090c='REPLACE\x20INTO\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20backup_task_record(task_id,status,start_time)\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20VALUES(\x20\x27'+_0x542a0b['id']+_0x335ebe(0x95)+_0x4e277c+'\x27)';return dbOther[_0x335ebe(0xa3)](_0x37090c);}else{}}}function add0(_0x26e587){return _0x26e587<0xa?'0'+_0x26e587:_0x26e587;}function getYmd(_0x2327bb){const _0x281aef=_0x3c6990;var _0x517f09=_0x2327bb[_0x281aef(0xb0)](),_0xf808ce=_0x2327bb[_0x281aef(0x91)]()+0x1,_0x4ff859=_0x2327bb[_0x281aef(0x7f)]();return _0x517f09+'-'+add0(_0xf808ce)+'-'+add0(_0x4ff859);}function _0x1642(_0x2b1ebb,_0x23db4f){const _0x9f2f82=_0x9f2f();return _0x1642=function(_0x1642d4,_0x2e6a7d){_0x1642d4=_0x1642d4-0x76;let _0x27f419=_0x9f2f82[_0x1642d4];return _0x27f419;},_0x1642(_0x2b1ebb,_0x23db4f);}function runBackupCheck(){setInterval(()=>{const _0x511cef=_0x1642;let _0x2a88fd=new Date(),_0x20d091=_0x2a88fd[_0x511cef(0xc8)](),_0x15f38a=_0x2a88fd['getDate'](),_0x3ea8cb=add0(_0x2a88fd[_0x511cef(0x7d)]()),_0x1c1ee3=add0(_0x2a88fd['getMinutes']()),_0x294b39=getYmd(_0x2a88fd),_0x5c0827=_0x511cef(0xbf)+_0x294b39+_0x511cef(0xc3)+_0x3ea8cb+':'+_0x1c1ee3+_0x511cef(0xbc);addTask(_0x5c0827);let _0x480617=_0x511cef(0xbe)+_0x3ea8cb+':'+_0x1c1ee3+'%\x27)';addTask(_0x480617);let _0x37c8a0=_0x511cef(0xce)+_0x20d091+_0x511cef(0xc3)+_0x3ea8cb+':'+_0x1c1ee3+_0x511cef(0xbc);addTask(_0x37c8a0);let _0x33e3b4=_0x511cef(0xad)+_0x15f38a+'\x27\x20AND\x20task_time\x20LIKE\x20\x27'+_0x3ea8cb+':'+_0x1c1ee3+_0x511cef(0xbc);addTask(_0x33e3b4);},0x3a98);}runBackupCheck(),process['on'](_0x3c6990(0x8c),(_0x2fb561,_0x2d1b5d)=>{const _0x15abc9=_0x3c6990;process['send']({'type':_0x15abc9(0xac)});});