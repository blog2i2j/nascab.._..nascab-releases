const _0x3a6722=_0x1b8c;(function(_0x36eaae,_0x388018){const _0x51f2b7=_0x1b8c,_0x3606e0=_0x36eaae();while(!![]){try{const _0x41df69=parseInt(_0x51f2b7(0xe7))/0x1+-parseInt(_0x51f2b7(0xcf))/0x2*(parseInt(_0x51f2b7(0xcb))/0x3)+parseInt(_0x51f2b7(0xc4))/0x4+-parseInt(_0x51f2b7(0xba))/0x5+-parseInt(_0x51f2b7(0xd1))/0x6*(-parseInt(_0x51f2b7(0xb1))/0x7)+-parseInt(_0x51f2b7(0x9f))/0x8*(-parseInt(_0x51f2b7(0xda))/0x9)+-parseInt(_0x51f2b7(0xc6))/0xa;if(_0x41df69===_0x388018)break;else _0x3606e0['push'](_0x3606e0['shift']());}catch(_0x340e29){_0x3606e0['push'](_0x3606e0['shift']());}}}(_0xfb91,0xdfe1a));const Database=require('better-sqlite3'),config=require(_0x3a6722(0xc5));let dbOther=new Database(config[_0x3a6722(0xdc)],{});dbOther['pragma'](_0x3a6722(0xb9));let moment=require('moment'),path=require(_0x3a6722(0xe1)),fs=require('fs'),i18nUtil=require(_0x3a6722(0xe5)),i18n=i18nUtil[_0x3a6722(0xb2)](dbOther);process[_0x3a6722(0xcc)]=_0x3a6722(0xb3);let copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![],excludeList=[];function copyFile(_0x58dc0d,_0x2cdbc6,_0x2f67c9,_0x2dec1){const _0x508699=_0x3a6722;try{let _0x4d5cbf=dbOther['prepare'](_0x508699(0x95)+_0x2cdbc6)[_0x508699(0x9b)]();if(_0x4d5cbf['status']!='running')return paused=!![],![];let _0x437330=fs['statSync'](_0x2f67c9);filesCount+=0x1,totalSize+=_0x437330[_0x508699(0xa8)];let _0x18a600=!![];if(!fs[_0x508699(0xe4)](_0x2dec1))fs[_0x508699(0xae)](_0x2f67c9,_0x2dec1,{'preserveTimestamps':!![]}),copySize+=_0x437330[_0x508699(0xa8)],copyFileCount+=0x1;else{let _0x43c1a9=fs[_0x508699(0x9a)](_0x2dec1);_0x437330[_0x508699(0xa8)]==_0x43c1a9[_0x508699(0xa8)]&&Math[_0x508699(0x97)](_0x437330['mtimeMs']-_0x43c1a9[_0x508699(0xdf)])<=0x3e8?_0x18a600=![]:(fs['cpSync'](_0x2f67c9,_0x2dec1,{'preserveTimestamps':!![]}),copySize+=_0x437330[_0x508699(0xa8)],copyFileCount+=0x1);}return _0x18a600&&updateTaskRecord(_0x2cdbc6,_0x508699(0xbc)+copySize+',copy_count='+copyFileCount),!![];}catch(_0x297a4d){return addTaskMsg(_0x58dc0d,_0x2cdbc6,_0x508699(0xbf),_0x2f67c9+':'+i18n['__'](_0x508699(0x9c))+_0x508699(0xbb)+JSON[_0x508699(0xd4)](_0x297a4d)),!![];}}function _0x1b8c(_0x2e1efd,_0x45a69d){const _0xfb910e=_0xfb91();return _0x1b8c=function(_0x1b8c41,_0x25bc06){_0x1b8c41=_0x1b8c41-0x95;let _0x27e4c0=_0xfb910e[_0x1b8c41];return _0x27e4c0;},_0x1b8c(_0x2e1efd,_0x45a69d);}function matchRuleShort(_0x43d8c2,_0x5dec9a){const _0x28221f=_0x3a6722;var _0x1c878e=_0x6ac078=>_0x6ac078[_0x28221f(0xb8)](/([.*+?^=!:${}()|\[\]\/\\])/g,'\x5c$1');return new RegExp('^'+_0x5dec9a['split']('*')[_0x28221f(0xc7)](_0x1c878e)[_0x28221f(0xe2)]('.*')+'$')['test'](_0x43d8c2);}function copyFolder(_0x21a5ff,_0x38ddf7,_0x179661,_0xf93b0b,_0x515a53){const _0x2a05f6=_0x3a6722;let _0x8c241=_0x21a5ff['id'],_0x23c1d0=checkFolderPower(_0xf93b0b,!![]);if(!_0x23c1d0)addTaskMsg(_0x8c241,_0x38ddf7,_0x2a05f6(0xbf),i18n['__'](_0x2a05f6(0xd3))+':'+_0xf93b0b);else try{let _0x3d5b55=fs[_0x2a05f6(0xb6)](_0xf93b0b);for(let _0x3e8208=0x0;_0x3e8208<_0x3d5b55[_0x2a05f6(0xdd)];_0x3e8208++){let _0x5ffdd2=_0x3d5b55[_0x3e8208];var _0x4c33c7=path[_0x2a05f6(0xe2)](_0xf93b0b,_0x5ffdd2);let _0x46cf2c=fs[_0x2a05f6(0x9a)](_0x4c33c7);var _0x11303a=_0x46cf2c[_0x2a05f6(0xe9)](),_0x332fca=_0x46cf2c[_0x2a05f6(0xeb)]();if(_0x11303a){if(excludeList['includes'](_0x5ffdd2))continue;if(_0x21a5ff['exclude_list']&&_0x21a5ff[_0x2a05f6(0xce)]['length']>0x0){let _0x4f381a=JSON[_0x2a05f6(0xad)](_0x21a5ff[_0x2a05f6(0xce)]),_0x353134=!![];for(let _0x504ca0 in _0x4f381a){if(_0x4f381a[_0x504ca0][_0x2a05f6(0xd6)]('*')){if(matchRuleShort(_0x5ffdd2,_0x4f381a[_0x504ca0])){_0x353134=![];break;}}else{if(_0x4f381a[_0x504ca0]==_0x5ffdd2){_0x353134=![];break;}}}if(!_0x353134){excludeCount+=0x1;continue;}}let _0x2a68af=path[_0x2a05f6(0xe2)](_0x515a53,path[_0x2a05f6(0xa3)](_0x179661),_0x4c33c7[_0x2a05f6(0xa2)](_0x179661[_0x2a05f6(0xdd)])),_0x2beef3=copyFile(_0x8c241,_0x38ddf7,_0x4c33c7,_0x2a68af);if(_0x2beef3===![])return![];}else _0x332fca&&copyFolder(_0x21a5ff,_0x38ddf7,_0x179661,_0x4c33c7,_0x515a53);}}catch(_0x1f7e6b){addTaskMsg(_0x8c241,_0x38ddf7,_0x2a05f6(0xbf),i18n['__'](_0x2a05f6(0xa1))+':'+_0xf93b0b);}}function reverseCheck(_0x225559,_0x352f64,_0xbfff52,_0x386c62,_0x3eebca){const _0x4227f3=_0x3a6722;try{if(!fs[_0x4227f3(0xe4)](_0x3eebca))return;let _0x2b40d4=fs[_0x4227f3(0xb6)](_0x3eebca);for(let _0x294a85=0x0;_0x294a85<_0x2b40d4[_0x4227f3(0xdd)];_0x294a85++){let _0x5c217e=_0x2b40d4[_0x294a85];var _0x2cd28c=path[_0x4227f3(0xe2)](_0x3eebca,_0x5c217e);let _0xf8dbcd=fs['statSync'](_0x2cd28c);var _0x48f8c2=_0xf8dbcd[_0x4227f3(0xe9)](),_0x1c9866=_0xf8dbcd[_0x4227f3(0xeb)]();let _0x14b668=path[_0x4227f3(0xe2)](_0x386c62,_0x2cd28c[_0x4227f3(0xa2)](_0xbfff52[_0x4227f3(0xdd)]));if(_0x48f8c2)!fs[_0x4227f3(0xe4)](_0x14b668)&&fs[_0x4227f3(0xcd)](_0x2cd28c,{'force':!![],'maxRetries':0xa});else _0x1c9866&&(!fs[_0x4227f3(0xe4)](_0x14b668)?fs['rmdirSync'](_0x2cd28c,{'recursive':!![],'maxRetries':0xa}):reverseCheck(_0x225559,_0x352f64,_0xbfff52,_0x386c62,_0x2cd28c));}}catch(_0x3bc547){addTaskMsg(_0x225559,_0x352f64,_0x4227f3(0xbf),i18n['__']('ReadFolderFail')+':'+_0x386c62);}}function updateTaskRecord(_0x2868b4,_0x185ec9){const _0x2003fe=_0x3a6722;let _0x435433=_0x2003fe(0xab);_0x435433+=_0x185ec9,_0x435433+='\x20WHERE\x20id='+_0x2868b4,dbOther['exec'](_0x435433);}function setTaskOver(_0x3411a2){const _0x36ec9a=_0x3a6722;let _0x12bab8=dbOther[_0x36ec9a(0xea)](_0x36ec9a(0x99)+_0x3411a2['id'])[_0x36ec9a(0x9b)](),_0xd0fb0=moment()[_0x36ec9a(0xb0)](_0x36ec9a(0xe6));updateTaskRecord(_0x3411a2['id'],_0x36ec9a(0xbc)+copySize+',copy_count='+copyFileCount+_0x36ec9a(0xa0)+excludeCount+_0x36ec9a(0xc0)+_0x12bab8[_0x36ec9a(0xd9)]+_0x36ec9a(0xd0)+filesCount+_0x36ec9a(0xde)+totalSize+',end_time=\x27'+_0xd0fb0+'\x27');}function addTaskMsg(_0x136316,_0x2a6b38,_0x4689c7,_0x168679){const _0x59b1b1=_0x3a6722,_0x2e31f4=_0x59b1b1(0xb4);return dbOther[_0x59b1b1(0xea)](_0x2e31f4)[_0x59b1b1(0xac)](''+_0x136316,''+_0x2a6b38,''+_0x4689c7,''+_0x168679);}function checkFolderPower(_0x3d21ec,_0x1ca2c2){const _0x49070e=_0x3a6722;try{return _0x1ca2c2?fs[_0x49070e(0xe3)](_0x3d21ec,fs[_0x49070e(0xb5)][_0x49070e(0xaf)]):fs[_0x49070e(0xe3)](_0x3d21ec,fs[_0x49070e(0xb5)][_0x49070e(0xaf)]|fs[_0x49070e(0xb5)]['W_OK']),!![];}catch(_0x68c306){return![];}}function exeTask(_0x48286f){const _0x427515=_0x3a6722;let _0x4d2447=_0x427515(0xbe),_0x2e0b84=dbOther[_0x427515(0xea)](_0x4d2447)[_0x427515(0x9b)]();if(_0x2e0b84){let _0x38b3c4=_0x427515(0xe0)+_0x2e0b84[_0x427515(0x9d)],_0x5a0b88=dbOther['prepare'](_0x38b3c4)['get']();if(!fs[_0x427515(0xe4)](_0x5a0b88[_0x427515(0xec)]))return addTaskMsg(_0x5a0b88['id'],_0x2e0b84['id'],_0x427515(0xbf),i18n['__'](_0x427515(0xd2))+':'+_0x5a0b88[_0x427515(0xec)]),setTaskOver(_0x2e0b84),_0x48286f();let _0x34292f=checkFolderPower(_0x5a0b88['target_path']);if(!_0x34292f)return addTaskMsg(_0x5a0b88['id'],_0x2e0b84['id'],'ERROR',i18n['__'](_0x427515(0xd3))+':'+_0x5a0b88[_0x427515(0xec)]),setTaskOver(_0x2e0b84),_0x48286f();updateTaskRecord(_0x2e0b84['id'],'status=\x27running\x27');let _0x453d1f=JSON[_0x427515(0xad)](_0x5a0b88['source_list']);copyFileCount=0x0,copySize=0x0,filesCount=0x0,excludeCount=0x0,totalSize=0x0,paused=![];for(let _0x40d874 in _0x453d1f){try{if(fs[_0x427515(0xe4)](_0x453d1f[_0x40d874])){copyFolder(_0x5a0b88,_0x2e0b84['id'],_0x453d1f[_0x40d874],_0x453d1f[_0x40d874],_0x5a0b88[_0x427515(0xec)]);if(!paused){let _0x186c73=path[_0x427515(0xe2)](_0x5a0b88[_0x427515(0xec)],path['basename'](_0x453d1f[_0x40d874]));reverseCheck(_0x5a0b88['id'],_0x2e0b84['id'],_0x186c73,_0x453d1f[_0x40d874],_0x186c73);}}else addTaskMsg(_0x5a0b88['id'],_0x2e0b84['id'],_0x427515(0xbf),i18n['__'](_0x427515(0xd5))+':'+_0x453d1f[_0x40d874]);}catch(_0xdab54c){addTaskMsg(_0x5a0b88['id'],_0x2e0b84['id'],_0x427515(0xbf),i18n['__'](_0x427515(0x9c))+':'+_0x453d1f[_0x40d874]+':'+JSON['stringify'](_0xdab54c));}}!paused&&setTaskOver(_0x2e0b84),_0x48286f();}else setTimeout(()=>{_0x48286f();},0x2710);}function runInfinit(){return new Promise(_0x2575ca=>{exeTask(_0x2575ca);});}async function runBacupExe(){const _0x2bab61=_0x3a6722;runInfinit()[_0x2bab61(0xdb)](()=>{runBacupExe();});}dbOther['exec']('UPDATE\x20backup_task_record\x20SET\x20status=\x27waiting\x27\x20where\x20status=\x27running\x27'),runBacupExe();function addTask(_0x3c320d){const _0x1b7e25=_0x3a6722;let _0x1a2d3e=dbOther[_0x1b7e25(0xea)](_0x3c320d)[_0x1b7e25(0xa5)]();if(_0x1a2d3e[_0x1b7e25(0xdd)]>0x0)for(let _0x96059a=0x0;_0x96059a<_0x1a2d3e[_0x1b7e25(0xdd)];_0x96059a++){let _0x137792=_0x1a2d3e[_0x96059a],_0x57c892=moment(new Date()[_0x1b7e25(0xb7)]()-0xea60)[_0x1b7e25(0xb0)](_0x1b7e25(0xe6)),_0xcf5da3=_0x1b7e25(0xd8)+_0x137792['id']+'\x20and\x20(start_time>=\x27'+_0x57c892+_0x1b7e25(0xbd),_0x2f330b=dbOther[_0x1b7e25(0xea)](_0xcf5da3)['get']();if(_0x2f330b[_0x1b7e25(0xd9)]<0x1){let _0x495a16=moment()[_0x1b7e25(0xb0)](_0x1b7e25(0xe6));const _0x4515c8=_0x1b7e25(0xaa)+_0x137792['id']+_0x1b7e25(0xc3)+_0x495a16+'\x27)';return dbOther[_0x1b7e25(0xc1)](_0x4515c8);}else{}}}function _0xfb91(){const _0x33ec7c=['mtimeMs','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20id\x20=\x20','path','join','accessSync','existsSync','../../utils/i18nUtil','YYYY-MM-DD\x20HH:mm:ss','1579080vKbiah','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x271\x27\x20AND\x20task_day=\x27','isFile','prepare','isDirectory','target_path','select\x20status\x20from\x20backup_task_record\x20where\x20id=','getDay','abs','%\x27)','select\x20count(*)\x20as\x20count\x20from\x20backup_task_msg\x20where\x20msg_type=\x27ERROR\x27\x20and\x20task_record_id=','statSync','get','fileCopyFail','task_id','send','8JqkIOS',',exclude_count=','ReadFolderFail','substring','basename','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x272\x27\x20AND\x20task_time\x20LIKE\x20\x27','all','getMonth','getHours','size','SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x274\x27\x20AND\x20task_day=\x27','REPLACE\x20INTO\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20backup_task_record(task_id,status,start_time)\x20\x0a\x09\x09\x09\x09\x20\x20\x20\x20\x20VALUES(\x20\x27','UPDATE\x20backup_task_record\x20SET\x20','run','parse','cpSync','R_OK','format','469fmbrhU','getI18n','NasCabBackupWorker','REPLACE\x20INTO\x20\x0a\x09\x20\x20\x20\x20\x20backup_task_msg(task_id,task_record_id,msg_type,content)\x20\x0a\x09\x20\x20\x20\x20\x20VALUES(\x20?,?,?,?)','constants','readdirSync','getTime','replace','journal_mode\x20=\x20WAL','7763820yiUfLa','\x20ERROR:','copy_size=','\x27\x20or\x20status!=\x27done\x27)','SELECT\x20*\x20FROM\x20backup_task_record\x20WHERE\x20status\x20=\x20\x27waiting\x27\x20order\x20by\x20start_time\x20limit\x201\x20','ERROR',',status=\x27done\x27,fail_count=','exec','getFullYear','\x27,\x20\x27waiting\x27,\x27','4240032KouAnX','../../myConfig/config','3303480zdzTcE','map','getDate','\x27\x20AND\x20task_time\x20LIKE\x20\x27','exit','4007253cxSFOe','title','rmSync','exclude_list','2DBEFxF',',files_count=','51990CIWevG','targetFolderNotExist','noWritePermission','stringify','folderNotExist','includes','getMinutes','select\x20count(*)\x20as\x20count\x20from\x20backup_task_record\x20where\x20task_id=','count','8246142vOfFZn','then','dbOther','length',',total_size='];_0xfb91=function(){return _0x33ec7c;};return _0xfb91();}function add0(_0x26f022){return _0x26f022<0xa?'0'+_0x26f022:_0x26f022;}function getYmd(_0x91326){const _0x3f8927=_0x3a6722;var _0x21f0c1=_0x91326[_0x3f8927(0xc2)](),_0x5de120=_0x91326[_0x3f8927(0xa6)]()+0x1,_0x5722ed=_0x91326[_0x3f8927(0xc8)]();return _0x21f0c1+'-'+add0(_0x5de120)+'-'+add0(_0x5722ed);}function runBackupCheck(){setInterval(()=>{const _0x5f12c8=_0x1b8c;let _0x17efa0=new Date(),_0x14a068=_0x17efa0[_0x5f12c8(0x96)](),_0x246371=_0x17efa0[_0x5f12c8(0xc8)](),_0x4963ba=add0(_0x17efa0[_0x5f12c8(0xa7)]()),_0x5a7d38=add0(_0x17efa0[_0x5f12c8(0xd7)]()),_0xd15e5=getYmd(_0x17efa0),_0x153caa=_0x5f12c8(0xe8)+_0xd15e5+_0x5f12c8(0xc9)+_0x4963ba+':'+_0x5a7d38+'%\x27)';addTask(_0x153caa);let _0x3d9eb3=_0x5f12c8(0xa4)+_0x4963ba+':'+_0x5a7d38+_0x5f12c8(0x98);addTask(_0x3d9eb3);let _0x3a96f8='SELECT\x20*\x20FROM\x20backup_task\x20WHERE\x20(task_type=\x273\x27\x20AND\x20task_day=\x27'+_0x14a068+_0x5f12c8(0xc9)+_0x4963ba+':'+_0x5a7d38+_0x5f12c8(0x98);addTask(_0x3a96f8);let _0x530aa5=_0x5f12c8(0xa9)+_0x246371+_0x5f12c8(0xc9)+_0x4963ba+':'+_0x5a7d38+_0x5f12c8(0x98);addTask(_0x530aa5);},0x3a98);}runBackupCheck(),process['on'](_0x3a6722(0xca),(_0x43d373,_0x4484b9)=>{const _0x145742=_0x3a6722;process[_0x145742(0x9e)]({'type':'close'});});