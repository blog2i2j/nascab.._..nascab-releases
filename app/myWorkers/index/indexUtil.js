const _0x4939cd=_0x58fd;(function(_0x46e0ae,_0x15504f){const _0x480196=_0x58fd,_0xfc83e9=_0x46e0ae();while(!![]){try{const _0x54ccad=parseInt(_0x480196(0x20d))/0x1*(-parseInt(_0x480196(0x201))/0x2)+-parseInt(_0x480196(0x1de))/0x3*(-parseInt(_0x480196(0x225))/0x4)+-parseInt(_0x480196(0x1e7))/0x5*(parseInt(_0x480196(0x1ed))/0x6)+parseInt(_0x480196(0x1f7))/0x7+parseInt(_0x480196(0x202))/0x8*(parseInt(_0x480196(0x1f0))/0x9)+-parseInt(_0x480196(0x1f8))/0xa*(parseInt(_0x480196(0x224))/0xb)+parseInt(_0x480196(0x216))/0xc;if(_0x54ccad===_0x15504f)break;else _0xfc83e9['push'](_0xfc83e9['shift']());}catch(_0x515f8e){_0xfc83e9['push'](_0xfc83e9['shift']());}}}(_0x196e,0x88c3d));let indexUtil={};function _0x58fd(_0x372bef,_0x370cdf){const _0x196e59=_0x196e();return _0x58fd=function(_0x58fd08,_0x25ad2c){_0x58fd08=_0x58fd08-0x1dc;let _0x471b48=_0x196e59[_0x58fd08];return _0x471b48;},_0x58fd(_0x372bef,_0x370cdf);}const currentPlatform=require('os')[_0x4939cd(0x211)](),path=require(_0x4939cd(0x205)),dbSourceFolderTable=require('../../db/dbSourceFolderTable'),dbFileIndexTable=require(_0x4939cd(0x207)),dbConfigTable=require(_0x4939cd(0x217)),config=require(_0x4939cd(0x218)),fs=require('fs');let FFmpeg=require(_0x4939cd(0x230))['FFmpeg'];const transCodeUtil=require(_0x4939cd(0x1e5));indexUtil['recursionFilesAddIndex']=async function(_0x14f000,_0x26061c,_0x25e9b3,_0x5ec0f6,_0x2d21d2,_0x43d61e,_0x1f44d4){const _0x35448e=_0x4939cd;let _0x20e4dd=0x1,_0x2427a3=0x0;try{let _0x479272=[{'path':_0x2d21d2,'files':fs[_0x35448e(0x206)](_0x2d21d2)}];while(_0x479272[_0x35448e(0x1e9)]>0x0){let {path:_0x583c80,files:_0x567d0a}=_0x479272[_0x35448e(0x1e6)]();if(indexUtil[_0x35448e(0x227)](_0x14f000,_0x583c80))continue;if(indexUtil[_0x35448e(0x215)](_0x583c80)){console['log'](_0x35448e(0x21b)+_0x583c80);continue;}for(let _0x1533df=0x0;_0x1533df<_0x567d0a['length'];_0x1533df++){let _0x47012c=_0x567d0a[_0x1533df];if(_0x47012c[_0x35448e(0x1e2)](config[_0x35448e(0x203)]))continue;if(!indexUtil['isPathIsInSourceFolder'](_0x14f000,_0x5ec0f6,_0x2d21d2))return console[_0x35448e(0x1f3)]('来源目录已不存在\x20停止扫描',_0x2d21d2),![];let _0x314c0f=path[_0x35448e(0x1f9)](_0x583c80,_0x47012c);try{let _0x24a486=fs[_0x35448e(0x228)](_0x314c0f),_0x58a72e=dbFileIndexTable[_0x35448e(0x212)](_0x26061c,_0x583c80,_0x47012c,_0x25e9b3);if(_0x24a486[_0x35448e(0x22d)]())!_0x58a72e&&await _0x43d61e(_0x14f000,_0x26061c,_0x583c80,_0x47012c,0x1,_0x24a486),_0x2427a3+=0x1;else _0x24a486[_0x35448e(0x1e0)]()&&(!_0x58a72e&&await _0x43d61e(_0x14f000,_0x26061c,_0x583c80,_0x47012c,0x0,_0x24a486),_0x479272[_0x35448e(0x222)]({'path':_0x314c0f,'files':fs['readdirSync'](_0x314c0f)}),_0x20e4dd+=0x1);_0x1f44d4&&_0x1f44d4();}catch(_0x97cf7e){console[_0x35448e(0x1f3)](_0x35448e(0x229),_0x97cf7e);continue;}}}return{'checkFileCount':_0x2427a3,'checkPathCount':_0x20e4dd};}catch(_0x2638ec){return console[_0x35448e(0x1f3)](_0x35448e(0x1f5),_0x2638ec),{'checkFileCount':_0x2427a3,'checkPathCount':_0x20e4dd};}},indexUtil[_0x4939cd(0x20b)]=async function(_0x2bd616,_0x2dc377,_0x4c56f7,_0x5df900,_0x4f71e3,_0x50ffe0,_0x212f5b){const _0x1af221=_0x4939cd;let _0x55e63e=_0x4c56f7[_0x1af221(0x22c)],_0x1231a0=_0x4c56f7[_0x1af221(0x221)],_0x355857=_0x4c56f7[_0x1af221(0x233)],_0x159c90=_0x4c56f7[_0x1af221(0x209)];if(_0x355857[_0x1af221(0x1e2)](config[_0x1af221(0x203)]))return;let _0x142e37=dbSourceFolderTable[_0x1af221(0x212)](_0x2dc377,_0x55e63e);if(!_0x142e37){console['log'](_0x1af221(0x21e),_0x55e63e);return;}let _0x3bba32=dbFileIndexTable[_0x1af221(0x212)](_0x2bd616,_0x1231a0,_0x355857,_0x5df900);try{let _0x671048=fs[_0x1af221(0x228)](_0x159c90);if(_0x671048['isFile']()&&!_0x3bba32)console['log'](_0x1af221(0x20c),_0x355857),await _0x4f71e3(_0x2dc377,_0x2bd616,_0x1231a0,_0x355857,0x1,_0x671048);else{if(_0x671048['isDirectory']()&&!_0x3bba32)console[_0x1af221(0x1f3)](_0x1af221(0x1df),_0x159c90),await _0x4f71e3(_0x2dc377,_0x2bd616,_0x1231a0,_0x355857,0x0,_0x671048),await _0x50ffe0(_0x2dc377,_0x2bd616,_0x159c90);else{if(_0x671048&&_0x3bba32){if(_0x671048[_0x1af221(0x231)]!=_0x3bba32[_0x1af221(0x22f)]){let _0x2015c6=dbFileIndexTable[_0x1af221(0x1dc)](_0x2bd616,_0x1231a0,_0x355857,_0x5df900);_0x212f5b&&_0x212f5b(_0x3bba32,_0x2015c6),await _0x4f71e3(_0x2dc377,_0x2bd616,_0x1231a0,_0x355857,_0x671048['isFile']()?0x1:0x0,_0x671048);}else{}}}}}catch(_0x2db792){console[_0x1af221(0x1f3)](_0x1af221(0x1ff),_0x1231a0,_0x355857);try{if(_0x2db792[_0x1af221(0x22a)]==_0x1af221(0x1fe)){if(_0x3bba32&&_0x3bba32[_0x1af221(0x1fc)]==0x1){let _0x23ca6c=dbFileIndexTable['deleteByPathAndFileName'](_0x2bd616,_0x1231a0,_0x355857,_0x5df900);_0x212f5b&&_0x212f5b(_0x3bba32,_0x23ca6c);}else _0x3bba32&&_0x3bba32['is_file']==0x0&&(dbFileIndexTable[_0x1af221(0x1dc)](_0x2bd616,_0x1231a0,_0x355857,_0x5df900),dbFileIndexTable[_0x1af221(0x21f)](_0x2bd616,_0x159c90,_0x5df900));}else console[_0x1af221(0x1f3)](_0x2db792);}catch(_0x3afcd0){console[_0x1af221(0x1f3)](_0x3afcd0);}}return;},indexUtil[_0x4939cd(0x21c)]=function(_0x512073){return new Promise((_0x1e3507,_0x4406c7)=>{const _0xfbc63b=_0x58fd;try{FFmpeg(transCodeUtil[_0xfbc63b(0x20e)](_0x512073))[_0xfbc63b(0x214)]((_0x32aa44,_0x256465)=>{_0x32aa44?_0x4406c7(_0x32aa44):_0x1e3507(_0x256465);});}catch(_0x42ad52){_0x4406c7(_0x42ad52);}});},indexUtil[_0x4939cd(0x215)]=function(_0x5b263d){const _0x16bebf=_0x4939cd;try{const _0x1dbfba=_0x5b263d[_0x16bebf(0x220)](/[\/\\]/)['filter'](Boolean);return _0x1dbfba[_0x16bebf(0x1e1)](_0x3f8fbb=>_0x3f8fbb[_0x16bebf(0x1e2)]('.'));}catch(_0x4c7be2){return![];}},indexUtil[_0x4939cd(0x20f)]=function(_0x566718,_0x37f738,_0x3d4dab){const _0xb332a5=_0x4939cd;let _0x3cc384=dbSourceFolderTable[_0xb332a5(0x1f1)](_0x566718,_0x37f738);for(let _0x17e76c of _0x3cc384){if(_0x3d4dab==_0x17e76c[_0xb332a5(0x205)]||_0x3d4dab['startsWith'](path[_0xb332a5(0x1f9)](_0x17e76c[_0xb332a5(0x205)],path[_0xb332a5(0x213)])))return _0x17e76c;}return![];},indexUtil[_0x4939cd(0x227)]=function(_0x274494,_0x3e32aa){const _0x408e3e=_0x4939cd;if(_0x3e32aa['endsWith'](path[_0x408e3e(0x1f9)](_0x408e3e(0x1eb),path[_0x408e3e(0x213)],'dbnascab-journal'))||_0x3e32aa[_0x408e3e(0x1dd)](path[_0x408e3e(0x1f9)](_0x408e3e(0x1eb),path[_0x408e3e(0x213)],_0x408e3e(0x1f2)))||_0x3e32aa['endsWith'](path[_0x408e3e(0x1f9)](_0x408e3e(0x1eb),path[_0x408e3e(0x213)],'dbnascab')))return!![];try{_0x3e32aa=_0x3e32aa[_0x408e3e(0x1e4)](/\'/g,'\x27\x27');let _0x1337a7=_0x408e3e(0x1f4)+_0x3e32aa+_0x408e3e(0x1e8)+_0x3e32aa+'\x27\x20like\x20'+'`folder_path`||\x27'+path[_0x408e3e(0x213)]+'%\x27',_0x6d7058=_0x274494[_0x408e3e(0x1ea)](_0x1337a7)['get']();return _0x6d7058?!![]:![];}catch(_0x2307ab){return![];}},indexUtil[_0x4939cd(0x200)]=function(_0x29e5a6,_0x31c950){const _0xcd091c=_0x4939cd;try{if(currentPlatform=='linux'||currentPlatform==_0xcd091c(0x21a)){if(_0x31c950[_0xcd091c(0x1e2)]('/proc/'))return!![];if(_0x31c950=='/')return!![];}let _0x2411fc=path[_0xcd091c(0x1f9)](_0x29e5a6[_0xcd091c(0x204)]),_0x55064a=path['join'](_0x29e5a6[_0xcd091c(0x232)]),_0x358e5b=path[_0xcd091c(0x1f9)](_0x55064a,path[_0xcd091c(0x213)]),_0x21e0cc=path[_0xcd091c(0x1f9)](_0x2411fc);_0x31c950=path[_0xcd091c(0x1f9)](_0x31c950);if(_0x31c950==_0x2411fc||_0x31c950==_0x55064a||_0x31c950[_0xcd091c(0x1e2)](_0x21e0cc)||_0x31c950[_0xcd091c(0x1e2)](_0x358e5b))return console['log'](_0xcd091c(0x1ec),_0x31c950),!![];return![];}catch(_0x4cbddc){return console[_0xcd091c(0x1f3)](_0x4cbddc),![];}},indexUtil[_0x4939cd(0x1f6)]=function(_0x1dcf6f){const _0x132b98=_0x4939cd;try{if(_0x1dcf6f['startsWith']('.'))return!![];if(_0x1dcf6f[_0x132b98(0x1dd)](_0x132b98(0x1fa))||_0x1dcf6f['endsWith'](_0x132b98(0x20a))||_0x1dcf6f[_0x132b98(0x1dd)]('.td')||_0x1dcf6f[_0x132b98(0x1dd)]('.qkdownloading')||_0x1dcf6f['endsWith']('.xltd')||_0x1dcf6f[_0x132b98(0x1dd)](_0x132b98(0x208)))return!![];return![];}catch(_0x147afa){return console['log'](_0x147afa),![];}},indexUtil[_0x4939cd(0x1fb)]=function(_0x210588,_0x57ee19,_0x5a199c){const _0x268bdb=_0x4939cd;dbConfigTable[_0x268bdb(0x1e3)](_0x210588,{'title':_0x57ee19+_0x268bdb(0x1ef),'value':_0x5a199c?'1':'0'});},indexUtil['doesPathCanAddToDb']=function(_0x26dfa3,_0x58e594,_0x5d0bba,_0x2942c9,_0x4e5245){const _0x483bc9=_0x4939cd;if(indexUtil[_0x483bc9(0x200)](_0x5d0bba,_0x2942c9))return![];if(indexUtil[_0x483bc9(0x1f6)](_0x4e5245))return![];if(!fs['existsSync'](path[_0x483bc9(0x1f9)](_0x2942c9,_0x4e5245)))return console[_0x483bc9(0x1f3)]('Not\x20exist\x20',_0x2942c9,_0x4e5245),![];let _0x1147b9=indexUtil[_0x483bc9(0x20f)](_0x26dfa3,_0x58e594,_0x2942c9);if(!_0x1147b9)return console[_0x483bc9(0x1f3)](_0x483bc9(0x21d),_0x58e594,_0x2942c9,_0x4e5245),![];return _0x1147b9;},indexUtil[_0x4939cd(0x22b)]=async function(_0x5f49fc,_0x3833d0,_0x349553){const _0x30a068=_0x4939cd;let _0x3a8486=[_0x349553],_0xb9a1e=new Set([_0x349553]),_0x5a1f17=new Date()[_0x30a068(0x1ee)]();while(_0x3a8486[_0x30a068(0x1e9)]>0x0){let _0x5bf3d3=_0x3a8486[_0x30a068(0x1e6)](),_0x5d2f13=dbFileIndexTable[_0x30a068(0x210)](_0x5f49fc,_0x5bf3d3,_0x3833d0);for(let _0x610ec7=0x0;_0x610ec7<_0x5d2f13[_0x30a068(0x1e9)];_0x610ec7++){let _0x3d7c62=path[_0x30a068(0x1f9)](_0x5d2f13[_0x610ec7][_0x30a068(0x205)],_0x5d2f13[_0x610ec7][_0x30a068(0x22e)]);try{let _0x570d3c=fs['statSync'](_0x3d7c62);if(_0x570d3c[_0x30a068(0x22d)]()){}else _0x570d3c[_0x30a068(0x1e0)]()&&(!_0xb9a1e[_0x30a068(0x226)](_0x3d7c62)&&(_0x3a8486[_0x30a068(0x222)](_0x3d7c62),_0xb9a1e[_0x30a068(0x223)](_0x3d7c62)));}catch(_0x61c09c){_0x61c09c[_0x30a068(0x22a)]==_0x30a068(0x1fe)&&(_0x5d2f13[_0x610ec7][_0x30a068(0x1fc)]==0x1?dbFileIndexTable['delete'](_0x5f49fc,_0x5d2f13[_0x610ec7]['id'],_0x3833d0):(console[_0x30a068(0x1f3)](_0x30a068(0x219),_0x3d7c62),dbFileIndexTable[_0x30a068(0x1dc)](_0x5f49fc,_0x5d2f13[_0x610ec7][_0x30a068(0x205)],_0x5d2f13[_0x610ec7][_0x30a068(0x22e)],_0x3833d0),dbFileIndexTable[_0x30a068(0x21f)](_0x5f49fc,_0x3d7c62,_0x3833d0)));}}}console['log']('索引状态比对',_0x349553,_0x30a068(0x1fd),new Date()['getTime']()-_0x5a1f17,'ms');},module['exports']=indexUtil;function _0x196e(){const _0x35dde4=['cacheParentPath','fileName','deleteByPathAndFileName','endsWith','3ZiPPrh','******New\x20folder******','isDirectory','some','startsWith','create','replace','../../utils/transCodeUtil','pop','15vsimiu','\x27\x20or\x20\x27','length','prepare','nascabconfig','缓存数据目录内的变动，不处理','594564mEuvXg','getTime','-indexing','27zYumiG','getPathByType','tiny','log','SELECT\x20*\x20FROM\x20private_space\x20WHERE\x20folder_path=\x27','error','isForbiddenFilename','774977VFQABh','10919790bmEYbu','join','.tmp','setIndexingState','is_file','耗时:','ENOENT','文件已不存在','isForbiddenPath','202tbPeFy','1725968OVoAYE','uploadTempFilePrefix','dbPath','path','readdirSync','../../db/dbFileIndexTable','.downloading','fullPath','.bc!','dealFileChange','******New\x20file******:','7769mJwMih','dealFFmpegPath','isPathIsInSourceFolder','getPathAllOnlyChild','platform','getByPath','sep','ffprobe','isPathInHiddenDir','16144452fjEhoF','../../db/dbConfigTable','../../myConfig/config','文件夹已不存在\x20删除文件夹及文件夹下的索引','darwin','Skip\x20hidden\x20file/folder\x20','ffprobeSync','Not\x20in\x20source\x20folder\x20','来源目录不存在了\x20不处理文件\x20','deletePathAll','split','filePath','push','add','11IyWZor','2523196JrCPpo','has','checkPathIsInPrivateSpace','statSync','err','code','recursionDeleteIndex','watchPath','isFile','filename','mtime','../../libs/nasTrans','mtimeMs'];_0x196e=function(){return _0x35dde4;};return _0x196e();}