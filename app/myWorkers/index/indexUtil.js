function _0x21a6(){const _0x1d1d9a=['push','endsWith','log','code','tiny','耗时:','dbPath','getPathAllOnlyChild','******New\x20folder******','pop','mtimeMs','getByPath','deletePathAll','20UdDuqB','\x27\x20like\x20','setIndexingState','.downloading','replace','.tmp','35186280gQwgWX','uploadTempFilePrefix','缓存数据目录内的变动，不处理','join','文件夹已不存在\x20删除文件夹及文件夹下的索引','10206pjdLiQ','readdirSync','******New\x20file******:','../../db/dbConfigTable','11kNwrjX','6411650fWXYnW','.xltd','-indexing','nascabconfig','deleteByPathAndFileName','../../db/dbFileIndexTable','.td','dealFFmpegPath','isDirectory','startsWith','platform','Skip\x20hidden\x20file/folder\x20','isForbiddenPath','索引状态比对','has','690280IPoEur','fullPath','getPathByType','checkPathIsInPrivateSpace','isPathInHiddenDir','path','length','mtime','177385aDEtXM','FFmpeg','dbnascab','exports','.qkdownloading','isPathIsInSourceFolder','fileName','.bc!','ENOENT','filename','SELECT\x20*\x20FROM\x20private_space\x20WHERE\x20folder_path=\x27','add','../../db/dbSourceFolderTable','statSync','../../myConfig/config','来源目录不存在了\x20不处理文件\x20','linux','../../libs/nasTrans','split','/proc/','111793tcatkp','is_file','sep','existsSync','isFile','some','文件已不存在','filter','isForbiddenFilename','getTime','\x27\x20or\x20\x27','3KHsuOy','ffprobe','8290904EROgPG','doesPathCanAddToDb','6yhLBZV','dbnascab-journal','Not\x20exist\x20','`folder_path`||\x27','ffprobeSync'];_0x21a6=function(){return _0x1d1d9a;};return _0x21a6();}const _0x2217cf=_0x2bf3;(function(_0x213320,_0x47446d){const _0x378fb0=_0x2bf3,_0x4f6594=_0x213320();while(!![]){try{const _0x39a289=parseInt(_0x378fb0(0x1aa))/0x1*(-parseInt(_0x378fb0(0x1cb))/0x2)+-parseInt(_0x378fb0(0x1b5))/0x3*(-parseInt(_0x378fb0(0x1ea))/0x4)+parseInt(_0x378fb0(0x1f2))/0x5*(parseInt(_0x378fb0(0x1b9))/0x6)+-parseInt(_0x378fb0(0x1db))/0x7+-parseInt(_0x378fb0(0x1b7))/0x8+parseInt(_0x378fb0(0x1d6))/0x9+parseInt(_0x378fb0(0x1d1))/0xa*(parseInt(_0x378fb0(0x1da))/0xb);if(_0x39a289===_0x47446d)break;else _0x4f6594['push'](_0x4f6594['shift']());}catch(_0x28d1ea){_0x4f6594['push'](_0x4f6594['shift']());}}}(_0x21a6,0xa089e));let indexUtil={};function _0x2bf3(_0x296a05,_0x303bf3){const _0x21a699=_0x21a6();return _0x2bf3=function(_0x2bf303,_0x2bb5d0){_0x2bf303=_0x2bf303-0x19e;let _0x5ca4a2=_0x21a699[_0x2bf303];return _0x5ca4a2;},_0x2bf3(_0x296a05,_0x303bf3);}const currentPlatform=require('os')[_0x2217cf(0x1e5)](),path=require('path'),dbSourceFolderTable=require(_0x2217cf(0x1a2)),dbFileIndexTable=require(_0x2217cf(0x1e0)),dbConfigTable=require(_0x2217cf(0x1d9)),config=require(_0x2217cf(0x1a4)),fs=require('fs');let FFmpeg=require(_0x2217cf(0x1a7))[_0x2217cf(0x1f3)];const transCodeUtil=require('../../utils/transCodeUtil');indexUtil['recursionFilesAddIndex']=async function(_0x3e1a8,_0x6e0b85,_0x367f00,_0x2e5729,_0x22e5f8,_0x3c4b3f,_0x183d95){const _0x443279=_0x2217cf;let _0x4c2875=0x1,_0x4aa58a=0x0;try{let _0x5ec065=[{'path':_0x22e5f8,'files':fs[_0x443279(0x1d7)](_0x22e5f8)}];while(_0x5ec065['length']>0x0){let {path:_0x276a54,files:_0x1f8ffd}=_0x5ec065[_0x443279(0x1c7)]();if(indexUtil['checkPathIsInPrivateSpace'](_0x3e1a8,_0x276a54))continue;if(indexUtil['isPathInHiddenDir'](_0x276a54)){console[_0x443279(0x1c0)](_0x443279(0x1e6)+_0x276a54);continue;}for(let _0x3597ce=0x0;_0x3597ce<_0x1f8ffd[_0x443279(0x1f0)];_0x3597ce++){let _0x45ca61=_0x1f8ffd[_0x3597ce];if(_0x45ca61[_0x443279(0x1e4)](config[_0x443279(0x1d2)]))continue;if(!indexUtil[_0x443279(0x1f7)](_0x3e1a8,_0x2e5729,_0x22e5f8))return console[_0x443279(0x1c0)]('来源目录已不存在\x20停止扫描',_0x22e5f8),![];let _0x92242f=path[_0x443279(0x1d4)](_0x276a54,_0x45ca61);try{let _0x103cf1=fs[_0x443279(0x1a3)](_0x92242f),_0x40e189=dbFileIndexTable['getByPath'](_0x6e0b85,_0x276a54,_0x45ca61,_0x367f00);if(_0x103cf1[_0x443279(0x1ae)]())!_0x40e189&&await _0x3c4b3f(_0x3e1a8,_0x6e0b85,_0x276a54,_0x45ca61,0x1,_0x103cf1),_0x4aa58a+=0x1;else _0x103cf1[_0x443279(0x1e3)]()&&(!_0x40e189&&await _0x3c4b3f(_0x3e1a8,_0x6e0b85,_0x276a54,_0x45ca61,0x0,_0x103cf1),_0x5ec065[_0x443279(0x1be)]({'path':_0x92242f,'files':fs['readdirSync'](_0x92242f)}),_0x4c2875+=0x1);_0x183d95&&_0x183d95();}catch(_0x4baca9){console[_0x443279(0x1c0)]('err',_0x4baca9);continue;}}}return{'checkFileCount':_0x4aa58a,'checkPathCount':_0x4c2875};}catch(_0x3e6af0){return console[_0x443279(0x1c0)]('error',_0x3e6af0),{'checkFileCount':_0x4aa58a,'checkPathCount':_0x4c2875};}},indexUtil['dealFileChange']=async function(_0x538757,_0x41fdd8,_0x25425d,_0x5bfd2e,_0x1beaff,_0x3d70bd,_0x4e26bf){const _0x4bcf4f=_0x2217cf;let _0x98bb40=_0x25425d['watchPath'],_0x1974a2=_0x25425d['filePath'],_0x591061=_0x25425d[_0x4bcf4f(0x1f8)],_0x31765c=_0x25425d[_0x4bcf4f(0x1eb)];if(_0x591061[_0x4bcf4f(0x1e4)](config[_0x4bcf4f(0x1d2)]))return;let _0x4c749e=dbSourceFolderTable[_0x4bcf4f(0x1c9)](_0x41fdd8,_0x98bb40);if(!_0x4c749e){console[_0x4bcf4f(0x1c0)](_0x4bcf4f(0x1a5),_0x98bb40);return;}let _0x11e471=dbFileIndexTable[_0x4bcf4f(0x1c9)](_0x538757,_0x1974a2,_0x591061,_0x5bfd2e);try{let _0x4b8cf0=fs['statSync'](_0x31765c);if(_0x4b8cf0[_0x4bcf4f(0x1ae)]()&&!_0x11e471)console[_0x4bcf4f(0x1c0)](_0x4bcf4f(0x1d8),_0x591061),await _0x1beaff(_0x41fdd8,_0x538757,_0x1974a2,_0x591061,0x1,_0x4b8cf0);else{if(_0x4b8cf0['isDirectory']()&&!_0x11e471)console[_0x4bcf4f(0x1c0)](_0x4bcf4f(0x1c6),_0x31765c),await _0x1beaff(_0x41fdd8,_0x538757,_0x1974a2,_0x591061,0x0,_0x4b8cf0),await _0x3d70bd(_0x41fdd8,_0x538757,_0x31765c);else{if(_0x4b8cf0&&_0x11e471){if(_0x4b8cf0[_0x4bcf4f(0x1c8)]!=_0x11e471[_0x4bcf4f(0x1f1)]){let _0x1290a9=dbFileIndexTable[_0x4bcf4f(0x1df)](_0x538757,_0x1974a2,_0x591061,_0x5bfd2e);_0x4e26bf&&_0x4e26bf(_0x11e471,_0x1290a9),await _0x1beaff(_0x41fdd8,_0x538757,_0x1974a2,_0x591061,_0x4b8cf0['isFile']()?0x1:0x0,_0x4b8cf0);}else{}}}}}catch(_0x9345ed){console[_0x4bcf4f(0x1c0)](_0x4bcf4f(0x1b0),_0x1974a2,_0x591061);try{if(_0x9345ed[_0x4bcf4f(0x1c1)]==_0x4bcf4f(0x19e)){if(_0x11e471&&_0x11e471['is_file']==0x1){let _0x273a52=dbFileIndexTable[_0x4bcf4f(0x1df)](_0x538757,_0x1974a2,_0x591061,_0x5bfd2e);_0x4e26bf&&_0x4e26bf(_0x11e471,_0x273a52);}else _0x11e471&&_0x11e471[_0x4bcf4f(0x1ab)]==0x0&&(dbFileIndexTable[_0x4bcf4f(0x1df)](_0x538757,_0x1974a2,_0x591061,_0x5bfd2e),dbFileIndexTable[_0x4bcf4f(0x1ca)](_0x538757,_0x31765c,_0x5bfd2e));}else console['log'](_0x9345ed);}catch(_0xe71933){console['log'](_0xe71933);}}return;},indexUtil[_0x2217cf(0x1bd)]=function(_0x2cb97f){return new Promise((_0x50e4f8,_0x1c757c)=>{const _0x568f14=_0x2bf3;try{FFmpeg(transCodeUtil[_0x568f14(0x1e2)](_0x2cb97f))[_0x568f14(0x1b6)]((_0x9203c1,_0x3f0477)=>{_0x9203c1?_0x1c757c(_0x9203c1):_0x50e4f8(_0x3f0477);});}catch(_0x2b36bf){_0x1c757c(_0x2b36bf);}});},indexUtil[_0x2217cf(0x1ee)]=function(_0x341261){const _0x1c6425=_0x2217cf;try{const _0x1b2737=_0x341261[_0x1c6425(0x1a8)](/[\/\\]/)[_0x1c6425(0x1b1)](Boolean);return _0x1b2737[_0x1c6425(0x1af)](_0x56e4da=>_0x56e4da['startsWith']('.'));}catch(_0x47ac27){return![];}},indexUtil[_0x2217cf(0x1f7)]=function(_0x44c779,_0x24d4e2,_0x65c6bc){const _0x3161a0=_0x2217cf;let _0x2c6c30=dbSourceFolderTable[_0x3161a0(0x1ec)](_0x44c779,_0x24d4e2);for(let _0x1aac29 of _0x2c6c30){if(_0x65c6bc==_0x1aac29['path']||_0x65c6bc[_0x3161a0(0x1e4)](path[_0x3161a0(0x1d4)](_0x1aac29['path'],path[_0x3161a0(0x1ac)])))return _0x1aac29;}return![];},indexUtil[_0x2217cf(0x1ed)]=function(_0x31c5ab,_0xf514d){const _0x9b8362=_0x2217cf;if(_0xf514d[_0x9b8362(0x1bf)](path[_0x9b8362(0x1d4)](_0x9b8362(0x1de),path['sep'],_0x9b8362(0x1ba)))||_0xf514d[_0x9b8362(0x1bf)](path['join'](_0x9b8362(0x1de),path['sep'],_0x9b8362(0x1c2)))||_0xf514d[_0x9b8362(0x1bf)](path[_0x9b8362(0x1d4)](_0x9b8362(0x1de),path[_0x9b8362(0x1ac)],_0x9b8362(0x1f4))))return!![];try{_0xf514d=_0xf514d[_0x9b8362(0x1cf)](/\'/g,'\x27\x27');let _0x9d41c=_0x9b8362(0x1a0)+_0xf514d+_0x9b8362(0x1b4)+_0xf514d+_0x9b8362(0x1cc)+_0x9b8362(0x1bc)+path[_0x9b8362(0x1ac)]+'%\x27',_0x57a6a8=_0x31c5ab['prepare'](_0x9d41c)['get']();return _0x57a6a8?!![]:![];}catch(_0x149495){return![];}},indexUtil[_0x2217cf(0x1e7)]=function(_0x33fe7a,_0x993f91){const _0x25ee0f=_0x2217cf;try{if(currentPlatform==_0x25ee0f(0x1a6)||currentPlatform=='darwin'){if(_0x993f91[_0x25ee0f(0x1e4)](_0x25ee0f(0x1a9)))return!![];if(_0x993f91=='/')return!![];}let _0x2d85b4=path[_0x25ee0f(0x1d4)](_0x33fe7a[_0x25ee0f(0x1c4)]),_0x4e528d=path[_0x25ee0f(0x1d4)](_0x33fe7a['cacheParentPath']),_0x2a7eb8=path[_0x25ee0f(0x1d4)](_0x4e528d,path[_0x25ee0f(0x1ac)]),_0x2af3f1=path['join'](_0x2d85b4);_0x993f91=path[_0x25ee0f(0x1d4)](_0x993f91);if(_0x993f91==_0x2d85b4||_0x993f91==_0x4e528d||_0x993f91[_0x25ee0f(0x1e4)](_0x2af3f1)||_0x993f91['startsWith'](_0x2a7eb8))return console[_0x25ee0f(0x1c0)](_0x25ee0f(0x1d3),_0x993f91),!![];return![];}catch(_0x51de08){return console['log'](_0x51de08),![];}},indexUtil['isForbiddenFilename']=function(_0x58a811){const _0x2c3138=_0x2217cf;try{if(_0x58a811[_0x2c3138(0x1e4)]('.'))return!![];if(_0x58a811['endsWith'](_0x2c3138(0x1d0))||_0x58a811[_0x2c3138(0x1bf)](_0x2c3138(0x1f9))||_0x58a811[_0x2c3138(0x1bf)](_0x2c3138(0x1e1))||_0x58a811[_0x2c3138(0x1bf)](_0x2c3138(0x1f6))||_0x58a811[_0x2c3138(0x1bf)](_0x2c3138(0x1dc))||_0x58a811['endsWith'](_0x2c3138(0x1ce)))return!![];return![];}catch(_0x575327){return console['log'](_0x575327),![];}},indexUtil[_0x2217cf(0x1cd)]=function(_0x1ecab7,_0xe341a9,_0xcd1538){const _0x298992=_0x2217cf;dbConfigTable['create'](_0x1ecab7,{'title':_0xe341a9+_0x298992(0x1dd),'value':_0xcd1538?'1':'0'});},indexUtil[_0x2217cf(0x1b8)]=function(_0x221a24,_0x1bb239,_0x58338c,_0xa0020a,_0x3c95a4){const _0x285117=_0x2217cf;if(indexUtil[_0x285117(0x1e7)](_0x58338c,_0xa0020a))return![];if(indexUtil[_0x285117(0x1b2)](_0x3c95a4))return![];if(!fs[_0x285117(0x1ad)](path[_0x285117(0x1d4)](_0xa0020a,_0x3c95a4)))return console['log'](_0x285117(0x1bb),_0xa0020a,_0x3c95a4),![];let _0x2dbfa1=indexUtil['isPathIsInSourceFolder'](_0x221a24,_0x1bb239,_0xa0020a);if(!_0x2dbfa1)return console['log']('Not\x20in\x20source\x20folder\x20',_0x1bb239,_0xa0020a,_0x3c95a4),![];return _0x2dbfa1;},indexUtil['recursionDeleteIndex']=async function(_0x176d4c,_0x3110ce,_0x18554c){const _0x184507=_0x2217cf;let _0x2974ce=[_0x18554c],_0x1e3e47=new Set([_0x18554c]),_0x14b6aa=new Date()[_0x184507(0x1b3)]();while(_0x2974ce[_0x184507(0x1f0)]>0x0){let _0x5e9c00=_0x2974ce[_0x184507(0x1c7)](),_0x1779f9=dbFileIndexTable[_0x184507(0x1c5)](_0x176d4c,_0x5e9c00,_0x3110ce);for(let _0x3f7e06=0x0;_0x3f7e06<_0x1779f9[_0x184507(0x1f0)];_0x3f7e06++){let _0x1ba478=path[_0x184507(0x1d4)](_0x1779f9[_0x3f7e06][_0x184507(0x1ef)],_0x1779f9[_0x3f7e06][_0x184507(0x19f)]);try{let _0x218fe6=fs['statSync'](_0x1ba478);if(_0x218fe6[_0x184507(0x1ae)]()){}else _0x218fe6[_0x184507(0x1e3)]()&&(!_0x1e3e47[_0x184507(0x1e9)](_0x1ba478)&&(_0x2974ce['push'](_0x1ba478),_0x1e3e47[_0x184507(0x1a1)](_0x1ba478)));}catch(_0x2fce2f){_0x2fce2f[_0x184507(0x1c1)]==_0x184507(0x19e)&&(_0x1779f9[_0x3f7e06][_0x184507(0x1ab)]==0x1?dbFileIndexTable['delete'](_0x176d4c,_0x1779f9[_0x3f7e06]['id'],_0x3110ce):(console[_0x184507(0x1c0)](_0x184507(0x1d5),_0x1ba478),dbFileIndexTable[_0x184507(0x1df)](_0x176d4c,_0x1779f9[_0x3f7e06]['path'],_0x1779f9[_0x3f7e06]['filename'],_0x3110ce),dbFileIndexTable['deletePathAll'](_0x176d4c,_0x1ba478,_0x3110ce)));}}}console['log'](_0x184507(0x1e8),_0x18554c,_0x184507(0x1c3),new Date()[_0x184507(0x1b3)]()-_0x14b6aa,'ms');},module[_0x2217cf(0x1f5)]=indexUtil;