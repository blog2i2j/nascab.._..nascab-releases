const _0x6fc8c9=_0x4003;(function(_0x1449e0,_0x240920){const _0x13b97f=_0x4003,_0x27fd2d=_0x1449e0();while(!![]){try{const _0x282dce=-parseInt(_0x13b97f(0xe7))/0x1*(parseInt(_0x13b97f(0xa4))/0x2)+-parseInt(_0x13b97f(0xd2))/0x3*(parseInt(_0x13b97f(0xcb))/0x4)+-parseInt(_0x13b97f(0xc9))/0x5+parseInt(_0x13b97f(0x9f))/0x6+-parseInt(_0x13b97f(0x9b))/0x7+-parseInt(_0x13b97f(0xc8))/0x8+parseInt(_0x13b97f(0xd0))/0x9*(parseInt(_0x13b97f(0xbf))/0xa);if(_0x282dce===_0x240920)break;else _0x27fd2d['push'](_0x27fd2d['shift']());}catch(_0x4d87c8){_0x27fd2d['push'](_0x27fd2d['shift']());}}}(_0x4f8f,0x93aa8));let indexUtil={};const currentPlatform=require('os')[_0x6fc8c9(0x97)](),path=require(_0x6fc8c9(0xe2)),dbSourceFolderTable=require(_0x6fc8c9(0x98)),dbFileIndexTable=require(_0x6fc8c9(0xcf)),dbConfigTable=require(_0x6fc8c9(0x95)),config=require(_0x6fc8c9(0xe4)),fs=require('fs');let FFmpeg=require(_0x6fc8c9(0x96))[_0x6fc8c9(0xdd)];function _0x4f8f(){const _0x1e3dec=['.qkdownloading','../../db/dbFileIndexTable','2595465qWqoGl','来源目录已不存在\x20停止扫描','3118539PZKWla','existsSync','******New\x20folder******','add','SELECT\x20*\x20FROM\x20private_space\x20WHERE\x20folder_path=\x27','isPathInHiddenDir','statSync','.tmp','isForbiddenPath','getTime','nascabconfig','FFmpeg','deleteByPathAndFileName','`folder_path`||\x27','readdirSync','ENOENT','path','darwin','../../myConfig/config','error','delete','99859imUISQ','isFile','log','startsWith','ffprobeSync','err','mtimeMs','来源目录不存在了\x20不处理文件\x20','../../db/dbConfigTable','../../libs/nasTrans','platform','../../db/dbSourceFolderTable','pop','filename','5738159utwaxf','\x27\x20like\x20','缓存数据目录内的变动，不处理','文件已不存在','5478936nhOCVc','Not\x20in\x20source\x20folder\x20','******New\x20file******:','dealFFmpegPath','isForbiddenFilename','18HNcOKU','join','prepare','length','耗时:','recursionDeleteIndex','dbnascab','fileName','dbPath','doesPathCanAddToDb','isPathIsInSourceFolder','dealFileChange','ffprobe','is_file','replace','sep','Skip\x20hidden\x20file/folder\x20','deletePathAll','filePath','has','linux','filter','watchPath','fullPath','dbnascab-journal','create','../../utils/transCodeUtil','130iDAkZx','push','recursionFilesAddIndex','uploadTempFilePrefix','endsWith','isDirectory','cacheParentPath','.downloading','split','7445904xlpjNq','1843010fRUDse','getByPath','4qkmqAP','code','.bc!'];_0x4f8f=function(){return _0x1e3dec;};return _0x4f8f();}const transCodeUtil=require(_0x6fc8c9(0xbe));function _0x4003(_0x401857,_0x5f4aaf){const _0x4f8fca=_0x4f8f();return _0x4003=function(_0x4003f6,_0x4ebf4a){_0x4003f6=_0x4003f6-0x8e;let _0x58730d=_0x4f8fca[_0x4003f6];return _0x58730d;},_0x4003(_0x401857,_0x5f4aaf);}indexUtil[_0x6fc8c9(0xc1)]=async function(_0x3f9060,_0x3ea2ba,_0x839aa7,_0x1a6ae2,_0x4c16dd,_0x441c9c,_0x3536af){const _0x28f85e=_0x6fc8c9;let _0x42f2d8=0x1,_0x51cc4d=0x0;try{let _0x4ee5cc=[{'path':_0x4c16dd,'files':fs[_0x28f85e(0xe0)](_0x4c16dd)}];while(_0x4ee5cc[_0x28f85e(0xa7)]>0x0){let {path:_0x2523e8,files:_0x371aef}=_0x4ee5cc['pop']();if(indexUtil['checkPathIsInPrivateSpace'](_0x3f9060,_0x2523e8))continue;if(indexUtil[_0x28f85e(0xd7)](_0x2523e8)){console[_0x28f85e(0x8f)](_0x28f85e(0xb4)+_0x2523e8);continue;}for(let _0x341d36=0x0;_0x341d36<_0x371aef[_0x28f85e(0xa7)];_0x341d36++){let _0x2bfeab=_0x371aef[_0x341d36];if(_0x2bfeab[_0x28f85e(0x90)](config[_0x28f85e(0xc2)]))continue;if(!indexUtil[_0x28f85e(0xae)](_0x3f9060,_0x1a6ae2,_0x4c16dd))return console[_0x28f85e(0x8f)](_0x28f85e(0xd1),_0x4c16dd),![];let _0x591f3f=path[_0x28f85e(0xa5)](_0x2523e8,_0x2bfeab);try{let _0x30c72e=fs[_0x28f85e(0xd8)](_0x591f3f),_0x26c48a=dbFileIndexTable[_0x28f85e(0xca)](_0x3ea2ba,_0x2523e8,_0x2bfeab,_0x839aa7);if(_0x30c72e[_0x28f85e(0x8e)]())!_0x26c48a&&await _0x441c9c(_0x3f9060,_0x3ea2ba,_0x2523e8,_0x2bfeab,0x1,_0x30c72e),_0x51cc4d+=0x1;else _0x30c72e[_0x28f85e(0xc4)]()&&(!_0x26c48a&&await _0x441c9c(_0x3f9060,_0x3ea2ba,_0x2523e8,_0x2bfeab,0x0,_0x30c72e),_0x4ee5cc[_0x28f85e(0xc0)]({'path':_0x591f3f,'files':fs[_0x28f85e(0xe0)](_0x591f3f)}),_0x42f2d8+=0x1);_0x3536af&&_0x3536af();}catch(_0x29205e){console[_0x28f85e(0x8f)](_0x28f85e(0x92),_0x29205e);continue;}}}return{'checkFileCount':_0x51cc4d,'checkPathCount':_0x42f2d8};}catch(_0x23b67c){return console[_0x28f85e(0x8f)](_0x28f85e(0xe5),_0x23b67c),{'checkFileCount':_0x51cc4d,'checkPathCount':_0x42f2d8};}},indexUtil[_0x6fc8c9(0xaf)]=async function(_0x46cde9,_0x5ee48e,_0x3d71c0,_0x4ca2d2,_0x4a0061,_0x1ce007,_0x499f78){const _0x203899=_0x6fc8c9;let _0x5d8de4=_0x3d71c0[_0x203899(0xba)],_0xcb1eab=_0x3d71c0[_0x203899(0xb6)],_0x3543cb=_0x3d71c0[_0x203899(0xab)],_0x331275=_0x3d71c0[_0x203899(0xbb)];if(_0x3543cb['startsWith'](config['uploadTempFilePrefix']))return;let _0x37fe09=dbSourceFolderTable[_0x203899(0xca)](_0x5ee48e,_0x5d8de4);if(!_0x37fe09){console[_0x203899(0x8f)](_0x203899(0x94),_0x5d8de4);return;}let _0x534501=dbFileIndexTable[_0x203899(0xca)](_0x46cde9,_0xcb1eab,_0x3543cb,_0x4ca2d2);try{let _0x4aa4a0=fs[_0x203899(0xd8)](_0x331275);if(_0x4aa4a0[_0x203899(0x8e)]()&&!_0x534501)console[_0x203899(0x8f)](_0x203899(0xa1),_0x3543cb),await _0x4a0061(_0x5ee48e,_0x46cde9,_0xcb1eab,_0x3543cb,0x1,_0x4aa4a0);else{if(_0x4aa4a0['isDirectory']()&&!_0x534501)console['log'](_0x203899(0xd4),_0x331275),await _0x4a0061(_0x5ee48e,_0x46cde9,_0xcb1eab,_0x3543cb,0x0,_0x4aa4a0),await _0x1ce007(_0x5ee48e,_0x46cde9,_0x331275);else{if(_0x4aa4a0&&_0x534501){if(_0x4aa4a0[_0x203899(0x93)]!=_0x534501['mtime']){let _0x1ebf1c=dbFileIndexTable['deleteByPathAndFileName'](_0x46cde9,_0xcb1eab,_0x3543cb,_0x4ca2d2);_0x499f78&&_0x499f78(_0x534501,_0x1ebf1c),await _0x4a0061(_0x5ee48e,_0x46cde9,_0xcb1eab,_0x3543cb,_0x4aa4a0['isFile']()?0x1:0x0,_0x4aa4a0);}else{}}}}}catch(_0x442c00){console[_0x203899(0x8f)](_0x203899(0x9e),_0xcb1eab,_0x3543cb);try{if(_0x442c00[_0x203899(0xcc)]==_0x203899(0xe1)){if(_0x534501&&_0x534501[_0x203899(0xb1)]==0x1){let _0x47ede8=dbFileIndexTable[_0x203899(0xde)](_0x46cde9,_0xcb1eab,_0x3543cb,_0x4ca2d2);_0x499f78&&_0x499f78(_0x534501,_0x47ede8);}else _0x534501&&_0x534501[_0x203899(0xb1)]==0x0&&(dbFileIndexTable['deleteByPathAndFileName'](_0x46cde9,_0xcb1eab,_0x3543cb,_0x4ca2d2),dbFileIndexTable[_0x203899(0xb5)](_0x46cde9,_0x331275,_0x4ca2d2));}else console[_0x203899(0x8f)](_0x442c00);}catch(_0x562f8c){console[_0x203899(0x8f)](_0x562f8c);}}return;},indexUtil[_0x6fc8c9(0x91)]=function(_0x5475b9){return new Promise((_0x329e3b,_0x328976)=>{const _0x4cbace=_0x4003;try{FFmpeg(transCodeUtil[_0x4cbace(0xa2)](_0x5475b9))[_0x4cbace(0xb0)]((_0x5b38b1,_0x2e2a62)=>{_0x5b38b1?_0x328976(_0x5b38b1):_0x329e3b(_0x2e2a62);});}catch(_0x574c22){_0x328976(_0x574c22);}});},indexUtil['isPathInHiddenDir']=function(_0x3809d8){const _0x2cd856=_0x6fc8c9;try{const _0x10c997=_0x3809d8[_0x2cd856(0xc7)](/[\/\\]/)[_0x2cd856(0xb9)](Boolean);return _0x10c997['some'](_0xb87dc=>_0xb87dc['startsWith']('.'));}catch(_0x395a40){return![];}},indexUtil[_0x6fc8c9(0xae)]=function(_0xff73bd,_0x2edcdc,_0x528050){const _0x146f86=_0x6fc8c9;let _0x5a8cac=dbSourceFolderTable['getPathByType'](_0xff73bd,_0x2edcdc);for(let _0x24e100 of _0x5a8cac){if(_0x528050==_0x24e100[_0x146f86(0xe2)]||_0x528050['startsWith'](path['join'](_0x24e100['path'],path['sep'])))return _0x24e100;}return![];},indexUtil['checkPathIsInPrivateSpace']=function(_0x21d4cc,_0x537955){const _0x50a034=_0x6fc8c9;if(_0x537955[_0x50a034(0xc3)](path[_0x50a034(0xa5)](_0x50a034(0xdc),path[_0x50a034(0xb3)],_0x50a034(0xbc)))||_0x537955[_0x50a034(0xc3)](path[_0x50a034(0xa5)]('nascabconfig',path['sep'],'tiny'))||_0x537955['endsWith'](path[_0x50a034(0xa5)](_0x50a034(0xdc),path[_0x50a034(0xb3)],_0x50a034(0xaa))))return!![];try{_0x537955=_0x537955[_0x50a034(0xb2)](/\'/g,'\x27\x27');let _0x58a230=_0x50a034(0xd6)+_0x537955+'\x27\x20or\x20\x27'+_0x537955+_0x50a034(0x9c)+_0x50a034(0xdf)+path[_0x50a034(0xb3)]+'%\x27',_0x5f0440=_0x21d4cc[_0x50a034(0xa6)](_0x58a230)['get']();return _0x5f0440?!![]:![];}catch(_0x4c0921){return![];}},indexUtil[_0x6fc8c9(0xda)]=function(_0x28a082,_0xd56cd5){const _0x2d6af1=_0x6fc8c9;try{if(currentPlatform==_0x2d6af1(0xb8)||currentPlatform==_0x2d6af1(0xe3)){if(_0xd56cd5[_0x2d6af1(0x90)]('/proc/'))return!![];if(_0xd56cd5=='/')return!![];}let _0x1b6028=path[_0x2d6af1(0xa5)](_0x28a082[_0x2d6af1(0xac)]),_0x2da3f7=path[_0x2d6af1(0xa5)](_0x28a082[_0x2d6af1(0xc5)]),_0x13077b=path[_0x2d6af1(0xa5)](_0x2da3f7,path[_0x2d6af1(0xb3)]),_0x221076=path[_0x2d6af1(0xa5)](_0x1b6028);_0xd56cd5=path[_0x2d6af1(0xa5)](_0xd56cd5);if(_0xd56cd5==_0x1b6028||_0xd56cd5==_0x2da3f7||_0xd56cd5[_0x2d6af1(0x90)](_0x221076)||_0xd56cd5['startsWith'](_0x13077b))return console[_0x2d6af1(0x8f)](_0x2d6af1(0x9d),_0xd56cd5),!![];return![];}catch(_0x1cd77a){return console[_0x2d6af1(0x8f)](_0x1cd77a),![];}},indexUtil['isForbiddenFilename']=function(_0xa2004b){const _0x480041=_0x6fc8c9;try{if(_0xa2004b[_0x480041(0x90)]('.'))return!![];if(_0xa2004b[_0x480041(0xc3)](_0x480041(0xd9))||_0xa2004b[_0x480041(0xc3)](_0x480041(0xcd))||_0xa2004b[_0x480041(0xc3)]('.td')||_0xa2004b[_0x480041(0xc3)](_0x480041(0xce))||_0xa2004b[_0x480041(0xc3)]('.xltd')||_0xa2004b['endsWith'](_0x480041(0xc6)))return!![];return![];}catch(_0x6df708){return console[_0x480041(0x8f)](_0x6df708),![];}},indexUtil['setIndexingState']=function(_0x4396e,_0x18b35f,_0x39ae3c){const _0x546c50=_0x6fc8c9;dbConfigTable[_0x546c50(0xbd)](_0x4396e,{'title':_0x18b35f+'-indexing','value':_0x39ae3c?'1':'0'});},indexUtil[_0x6fc8c9(0xad)]=function(_0x5ef3cd,_0x23ab31,_0x4a4839,_0x5570d0,_0x440b50){const _0x3765e5=_0x6fc8c9;if(indexUtil[_0x3765e5(0xda)](_0x4a4839,_0x5570d0))return![];if(indexUtil[_0x3765e5(0xa3)](_0x440b50))return![];if(!fs[_0x3765e5(0xd3)](path['join'](_0x5570d0,_0x440b50)))return console[_0x3765e5(0x8f)]('Not\x20exist\x20',_0x5570d0,_0x440b50),![];let _0x1f9c12=indexUtil[_0x3765e5(0xae)](_0x5ef3cd,_0x23ab31,_0x5570d0);if(!_0x1f9c12)return console[_0x3765e5(0x8f)](_0x3765e5(0xa0),_0x23ab31,_0x5570d0,_0x440b50),![];return _0x1f9c12;},indexUtil[_0x6fc8c9(0xa9)]=async function(_0x526f3f,_0x4d2eb2,_0x423622){const _0x82b9bf=_0x6fc8c9;let _0x19fdb5=[_0x423622],_0x261b0e=new Set([_0x423622]),_0x4671e0=new Date()['getTime']();while(_0x19fdb5['length']>0x0){let _0x2e4ef7=_0x19fdb5[_0x82b9bf(0x99)](),_0x57f974=dbFileIndexTable['getPathAllOnlyChild'](_0x526f3f,_0x2e4ef7,_0x4d2eb2);for(let _0x47278c=0x0;_0x47278c<_0x57f974['length'];_0x47278c++){let _0x5bbd41=path[_0x82b9bf(0xa5)](_0x57f974[_0x47278c][_0x82b9bf(0xe2)],_0x57f974[_0x47278c][_0x82b9bf(0x9a)]);try{let _0x6dd51a=fs[_0x82b9bf(0xd8)](_0x5bbd41);if(_0x6dd51a[_0x82b9bf(0x8e)]()){}else _0x6dd51a['isDirectory']()&&(!_0x261b0e[_0x82b9bf(0xb7)](_0x5bbd41)&&(_0x19fdb5[_0x82b9bf(0xc0)](_0x5bbd41),_0x261b0e[_0x82b9bf(0xd5)](_0x5bbd41)));}catch(_0x5a19ee){_0x5a19ee[_0x82b9bf(0xcc)]==_0x82b9bf(0xe1)&&(_0x57f974[_0x47278c]['is_file']==0x1?dbFileIndexTable[_0x82b9bf(0xe6)](_0x526f3f,_0x57f974[_0x47278c]['id'],_0x4d2eb2):(console[_0x82b9bf(0x8f)]('文件夹已不存在\x20删除文件夹及文件夹下的索引',_0x5bbd41),dbFileIndexTable[_0x82b9bf(0xde)](_0x526f3f,_0x57f974[_0x47278c][_0x82b9bf(0xe2)],_0x57f974[_0x47278c]['filename'],_0x4d2eb2),dbFileIndexTable[_0x82b9bf(0xb5)](_0x526f3f,_0x5bbd41,_0x4d2eb2)));}}}console[_0x82b9bf(0x8f)]('索引状态比对',_0x423622,_0x82b9bf(0xa8),new Date()[_0x82b9bf(0xdb)]()-_0x4671e0,'ms');},module['exports']=indexUtil;