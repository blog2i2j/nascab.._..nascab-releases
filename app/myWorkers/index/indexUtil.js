const _0x21a13c=_0x3b34;(function(_0x4a00ca,_0x45a640){const _0x4e3ef8=_0x3b34,_0xb04955=_0x4a00ca();while(!![]){try{const _0x17ad40=parseInt(_0x4e3ef8(0xba))/0x1+parseInt(_0x4e3ef8(0x88))/0x2*(parseInt(_0x4e3ef8(0x9d))/0x3)+parseInt(_0x4e3ef8(0x9a))/0x4*(-parseInt(_0x4e3ef8(0xc3))/0x5)+parseInt(_0x4e3ef8(0xb1))/0x6*(-parseInt(_0x4e3ef8(0xb8))/0x7)+parseInt(_0x4e3ef8(0xd3))/0x8+parseInt(_0x4e3ef8(0x96))/0x9+-parseInt(_0x4e3ef8(0xa9))/0xa;if(_0x17ad40===_0x45a640)break;else _0xb04955['push'](_0xb04955['shift']());}catch(_0xf5b724){_0xb04955['push'](_0xb04955['shift']());}}}(_0x2fd3,0xd0c04));let indexUtil={};function _0x2fd3(){const _0x389081=['fullPath','.td','ffprobe','\x27\x20or\x20\x27','join','deleteByPathAndFileName','../../db/dbConfigTable','pop','../../myConfig/config','doesPathCanAddToDb','push','create','250776glUXhQ','getPathAllOnlyChild','checkPathIsInPrivateSpace','watchPath','131644guxwlH','isPathInHiddenDir','endsWith','228885kMXymw','prepare','mtime','linux','/proc/','darwin','nascabconfig','getByPath','err','code','dbnascab-journal','replace','12622960Eeodms','isFile','ENOENT','path','FFmpeg','耗时:','来源目录已不存在\x20停止扫描','isForbiddenPath','5262XSmmAY','来源目录不存在了\x20不处理文件\x20','dbnascab','fileName','dbPath','SELECT\x20*\x20FROM\x20private_space\x20WHERE\x20folder_path=\x27','filter','3563CQWEII','mtimeMs','1341775FIOqTF','.tmp','`folder_path`||\x27','length','some','getPathByType','cacheParentPath','platform','has','10XZXSkZ','log','startsWith','recursionDeleteIndex','isPathIsInSourceFolder','split','exports','filePath','******New\x20folder******','ffprobeSync','deletePathAll','isForbiddenFilename','.qkdownloading','\x27\x20like\x20','-indexing','getTime','923928BBdjZu','uploadTempFilePrefix','statSync','文件夹已不存在\x20删除文件夹及文件夹下的索引','isDirectory','../../utils/transCodeUtil','filename','readdirSync','文件已不存在','recursionFilesAddIndex','sep','setIndexingState','../../db/dbFileIndexTable','******New\x20file******:','缓存数据目录内的变动，不处理','30jYGpVs','is_file'];_0x2fd3=function(){return _0x389081;};return _0x2fd3();}const currentPlatform=require('os')[_0x21a13c(0xc1)](),path=require('path'),dbSourceFolderTable=require('../../db/dbSourceFolderTable'),dbFileIndexTable=require(_0x21a13c(0x85)),dbConfigTable=require(_0x21a13c(0x90)),config=require(_0x21a13c(0x92)),fs=require('fs');let FFmpeg=require('../../libs/nasTrans')[_0x21a13c(0xad)];const transCodeUtil=require(_0x21a13c(0xd8));function _0x3b34(_0x3406f7,_0x18a062){const _0x2fd308=_0x2fd3();return _0x3b34=function(_0x3b3411,_0x3f23ac){_0x3b3411=_0x3b3411-0x80;let _0x3c385d=_0x2fd308[_0x3b3411];return _0x3c385d;},_0x3b34(_0x3406f7,_0x18a062);}indexUtil[_0x21a13c(0x82)]=async function(_0x3ed450,_0x2fbdb0,_0x8aa4de,_0x4155ff,_0x3a59be,_0x4e54c6,_0xd0ebfb){const _0x37b1c6=_0x21a13c;let _0x1e7a4c=0x1,_0x20b29a=0x0;try{let _0x496a1a=[{'path':_0x3a59be,'files':fs[_0x37b1c6(0x80)](_0x3a59be)}];while(_0x496a1a[_0x37b1c6(0xbd)]>0x0){let {path:_0xcb4df9,files:_0x40225d}=_0x496a1a[_0x37b1c6(0x91)]();if(indexUtil[_0x37b1c6(0x98)](_0x3ed450,_0xcb4df9))continue;if(indexUtil[_0x37b1c6(0x9b)](_0xcb4df9)){console[_0x37b1c6(0xc4)]('Skip\x20hidden\x20file/folder\x20'+_0xcb4df9);continue;}for(let _0x3c54fb=0x0;_0x3c54fb<_0x40225d['length'];_0x3c54fb++){let _0x5a103e=_0x40225d[_0x3c54fb];if(_0x5a103e['startsWith'](config[_0x37b1c6(0xd4)]))continue;if(!indexUtil['isPathIsInSourceFolder'](_0x3ed450,_0x4155ff,_0x3a59be))return console[_0x37b1c6(0xc4)](_0x37b1c6(0xaf),_0x3a59be),![];let _0x44d184=path['join'](_0xcb4df9,_0x5a103e);try{let _0x5482c7=fs[_0x37b1c6(0xd5)](_0x44d184),_0x3c752a=dbFileIndexTable[_0x37b1c6(0xa4)](_0x2fbdb0,_0xcb4df9,_0x5a103e,_0x8aa4de);if(_0x5482c7[_0x37b1c6(0xaa)]())!_0x3c752a&&await _0x4e54c6(_0x3ed450,_0x2fbdb0,_0xcb4df9,_0x5a103e,0x1,_0x5482c7),_0x20b29a+=0x1;else _0x5482c7[_0x37b1c6(0xd7)]()&&(!_0x3c752a&&await _0x4e54c6(_0x3ed450,_0x2fbdb0,_0xcb4df9,_0x5a103e,0x0,_0x5482c7),_0x496a1a[_0x37b1c6(0x94)]({'path':_0x44d184,'files':fs[_0x37b1c6(0x80)](_0x44d184)}),_0x1e7a4c+=0x1);_0xd0ebfb&&_0xd0ebfb();}catch(_0x69cff){console['log'](_0x37b1c6(0xa5),_0x69cff);continue;}}}return{'checkFileCount':_0x20b29a,'checkPathCount':_0x1e7a4c};}catch(_0x4d606d){return console['log']('error',_0x4d606d),{'checkFileCount':_0x20b29a,'checkPathCount':_0x1e7a4c};}},indexUtil['dealFileChange']=async function(_0x522d7a,_0x3cb05f,_0x42006f,_0x44204,_0x557fae,_0x2b6f08,_0x39c2ba){const _0xf16da=_0x21a13c;let _0x366bd7=_0x42006f[_0xf16da(0x99)],_0x4ca9ab=_0x42006f[_0xf16da(0xca)],_0x178bc3=_0x42006f[_0xf16da(0xb4)],_0x27add1=_0x42006f[_0xf16da(0x8a)];if(_0x178bc3['startsWith'](config[_0xf16da(0xd4)]))return;let _0x2a539f=dbSourceFolderTable[_0xf16da(0xa4)](_0x3cb05f,_0x366bd7);if(!_0x2a539f){console[_0xf16da(0xc4)](_0xf16da(0xb2),_0x366bd7);return;}let _0x4ceed6=dbFileIndexTable['getByPath'](_0x522d7a,_0x4ca9ab,_0x178bc3,_0x44204);try{let _0x3b3df8=fs['statSync'](_0x27add1);if(_0x3b3df8['isFile']()&&!_0x4ceed6)console[_0xf16da(0xc4)](_0xf16da(0x86),_0x178bc3),await _0x557fae(_0x3cb05f,_0x522d7a,_0x4ca9ab,_0x178bc3,0x1,_0x3b3df8);else{if(_0x3b3df8[_0xf16da(0xd7)]()&&!_0x4ceed6)console[_0xf16da(0xc4)](_0xf16da(0xcb),_0x27add1),await _0x557fae(_0x3cb05f,_0x522d7a,_0x4ca9ab,_0x178bc3,0x0,_0x3b3df8),await _0x2b6f08(_0x3cb05f,_0x522d7a,_0x27add1);else{if(_0x3b3df8&&_0x4ceed6){if(_0x3b3df8[_0xf16da(0xb9)]!=_0x4ceed6[_0xf16da(0x9f)]){let _0x1a43a1=dbFileIndexTable[_0xf16da(0x8f)](_0x522d7a,_0x4ca9ab,_0x178bc3,_0x44204);_0x39c2ba&&_0x39c2ba(_0x4ceed6,_0x1a43a1),await _0x557fae(_0x3cb05f,_0x522d7a,_0x4ca9ab,_0x178bc3,_0x3b3df8[_0xf16da(0xaa)]()?0x1:0x0,_0x3b3df8);}else{}}}}}catch(_0x8d7977){console[_0xf16da(0xc4)](_0xf16da(0x81),_0x4ca9ab,_0x178bc3);try{if(_0x8d7977[_0xf16da(0xa6)]==_0xf16da(0xab)){if(_0x4ceed6&&_0x4ceed6[_0xf16da(0x89)]==0x1){let _0x4a4ed3=dbFileIndexTable[_0xf16da(0x8f)](_0x522d7a,_0x4ca9ab,_0x178bc3,_0x44204);_0x39c2ba&&_0x39c2ba(_0x4ceed6,_0x4a4ed3);}else _0x4ceed6&&_0x4ceed6[_0xf16da(0x89)]==0x0&&(dbFileIndexTable[_0xf16da(0x8f)](_0x522d7a,_0x4ca9ab,_0x178bc3,_0x44204),dbFileIndexTable[_0xf16da(0xcd)](_0x522d7a,_0x27add1,_0x44204));}else console[_0xf16da(0xc4)](_0x8d7977);}catch(_0x120f50){console[_0xf16da(0xc4)](_0x120f50);}}return;},indexUtil[_0x21a13c(0xcc)]=function(_0xfbd3ee){return new Promise((_0x7cbc8c,_0x1f1bfc)=>{const _0x3f34b5=_0x3b34;try{FFmpeg(transCodeUtil['dealFFmpegPath'](_0xfbd3ee))[_0x3f34b5(0x8c)]((_0x30319b,_0x59bc87)=>{_0x30319b?_0x1f1bfc(_0x30319b):_0x7cbc8c(_0x59bc87);});}catch(_0x2480a6){_0x1f1bfc(_0x2480a6);}});},indexUtil['isPathInHiddenDir']=function(_0x91ff4c){const _0x293c87=_0x21a13c;try{const _0x4b7000=_0x91ff4c[_0x293c87(0xc8)](/[\/\\]/)[_0x293c87(0xb7)](Boolean);return _0x4b7000[_0x293c87(0xbe)](_0x3eb762=>_0x3eb762[_0x293c87(0xc5)]('.'));}catch(_0x39f83a){return![];}},indexUtil[_0x21a13c(0xc7)]=function(_0xac5273,_0x4d19ba,_0x289778){const _0x17d9fd=_0x21a13c;let _0x81a0b6=dbSourceFolderTable[_0x17d9fd(0xbf)](_0xac5273,_0x4d19ba);for(let _0x3e7ab0 of _0x81a0b6){if(_0x289778==_0x3e7ab0[_0x17d9fd(0xac)]||_0x289778[_0x17d9fd(0xc5)](path[_0x17d9fd(0x8e)](_0x3e7ab0[_0x17d9fd(0xac)],path[_0x17d9fd(0x83)])))return _0x3e7ab0;}return![];},indexUtil[_0x21a13c(0x98)]=function(_0x2af4c6,_0x2897d6){const _0x42902d=_0x21a13c;if(_0x2897d6[_0x42902d(0x9c)](path['join'](_0x42902d(0xa3),path[_0x42902d(0x83)],_0x42902d(0xa7)))||_0x2897d6[_0x42902d(0x9c)](path['join'](_0x42902d(0xa3),path[_0x42902d(0x83)],'tiny'))||_0x2897d6[_0x42902d(0x9c)](path[_0x42902d(0x8e)](_0x42902d(0xa3),path[_0x42902d(0x83)],_0x42902d(0xb3))))return!![];try{_0x2897d6=_0x2897d6[_0x42902d(0xa8)](/\'/g,'\x27\x27');let _0x8947a4=_0x42902d(0xb6)+_0x2897d6+_0x42902d(0x8d)+_0x2897d6+_0x42902d(0xd0)+_0x42902d(0xbc)+path[_0x42902d(0x83)]+'%\x27',_0x302275=_0x2af4c6[_0x42902d(0x9e)](_0x8947a4)['get']();return _0x302275?!![]:![];}catch(_0x5e4b29){return![];}},indexUtil[_0x21a13c(0xb0)]=function(_0x2d46dd,_0x370ce3){const _0x4e7050=_0x21a13c;try{if(currentPlatform==_0x4e7050(0xa0)||currentPlatform==_0x4e7050(0xa2)){if(_0x370ce3[_0x4e7050(0xc5)](_0x4e7050(0xa1)))return!![];if(_0x370ce3=='/')return!![];}let _0x21e64a=path['join'](_0x2d46dd[_0x4e7050(0xb5)]),_0x27503c=path[_0x4e7050(0x8e)](_0x2d46dd[_0x4e7050(0xc0)]),_0x571133=path[_0x4e7050(0x8e)](_0x27503c,path[_0x4e7050(0x83)]),_0x4fda25=path[_0x4e7050(0x8e)](_0x21e64a);_0x370ce3=path[_0x4e7050(0x8e)](_0x370ce3);if(_0x370ce3==_0x21e64a||_0x370ce3==_0x27503c||_0x370ce3[_0x4e7050(0xc5)](_0x4fda25)||_0x370ce3[_0x4e7050(0xc5)](_0x571133))return console[_0x4e7050(0xc4)](_0x4e7050(0x87),_0x370ce3),!![];return![];}catch(_0x2ff8ad){return console[_0x4e7050(0xc4)](_0x2ff8ad),![];}},indexUtil[_0x21a13c(0xce)]=function(_0xc9794b){const _0x4f36a4=_0x21a13c;try{if(_0xc9794b['startsWith']('.'))return!![];if(_0xc9794b['endsWith'](_0x4f36a4(0xbb))||_0xc9794b[_0x4f36a4(0x9c)]('.bc!')||_0xc9794b[_0x4f36a4(0x9c)](_0x4f36a4(0x8b))||_0xc9794b[_0x4f36a4(0x9c)](_0x4f36a4(0xcf))||_0xc9794b[_0x4f36a4(0x9c)]('.xltd')||_0xc9794b['endsWith']('.downloading'))return!![];return![];}catch(_0x3e9ead){return console[_0x4f36a4(0xc4)](_0x3e9ead),![];}},indexUtil[_0x21a13c(0x84)]=function(_0x507922,_0x10a708,_0x542eb9){const _0x3b0ba8=_0x21a13c;dbConfigTable[_0x3b0ba8(0x95)](_0x507922,{'title':_0x10a708+_0x3b0ba8(0xd1),'value':_0x542eb9?'1':'0'});},indexUtil[_0x21a13c(0x93)]=function(_0x5515d6,_0x227f0c,_0x1f4231,_0x2c85e8,_0x425ce5){const _0x5d0d22=_0x21a13c;if(indexUtil[_0x5d0d22(0xb0)](_0x1f4231,_0x2c85e8))return![];if(indexUtil[_0x5d0d22(0xce)](_0x425ce5))return![];if(!fs['existsSync'](path[_0x5d0d22(0x8e)](_0x2c85e8,_0x425ce5)))return console[_0x5d0d22(0xc4)]('Not\x20exist\x20',_0x2c85e8,_0x425ce5),![];let _0x15a588=indexUtil[_0x5d0d22(0xc7)](_0x5515d6,_0x227f0c,_0x2c85e8);if(!_0x15a588)return console[_0x5d0d22(0xc4)]('Not\x20in\x20source\x20folder\x20',_0x227f0c,_0x2c85e8,_0x425ce5),![];return _0x15a588;},indexUtil[_0x21a13c(0xc6)]=async function(_0x7d56ee,_0x5b38b6,_0x3ed337){const _0x256493=_0x21a13c;let _0x25efd0=[_0x3ed337],_0x53c479=new Set([_0x3ed337]),_0x5c7c35=new Date()[_0x256493(0xd2)]();while(_0x25efd0[_0x256493(0xbd)]>0x0){let _0x1362ee=_0x25efd0[_0x256493(0x91)](),_0x56bcb7=dbFileIndexTable[_0x256493(0x97)](_0x7d56ee,_0x1362ee,_0x5b38b6);for(let _0x5bb251=0x0;_0x5bb251<_0x56bcb7[_0x256493(0xbd)];_0x5bb251++){let _0x28f54c=path[_0x256493(0x8e)](_0x56bcb7[_0x5bb251][_0x256493(0xac)],_0x56bcb7[_0x5bb251][_0x256493(0xd9)]);try{let _0x19c293=fs[_0x256493(0xd5)](_0x28f54c);if(_0x19c293[_0x256493(0xaa)]()){}else _0x19c293[_0x256493(0xd7)]()&&(!_0x53c479[_0x256493(0xc2)](_0x28f54c)&&(_0x25efd0[_0x256493(0x94)](_0x28f54c),_0x53c479['add'](_0x28f54c)));}catch(_0x2357f0){_0x2357f0[_0x256493(0xa6)]==_0x256493(0xab)&&(_0x56bcb7[_0x5bb251][_0x256493(0x89)]==0x1?dbFileIndexTable['delete'](_0x7d56ee,_0x56bcb7[_0x5bb251]['id'],_0x5b38b6):(console[_0x256493(0xc4)](_0x256493(0xd6),_0x28f54c),dbFileIndexTable['deleteByPathAndFileName'](_0x7d56ee,_0x56bcb7[_0x5bb251][_0x256493(0xac)],_0x56bcb7[_0x5bb251][_0x256493(0xd9)],_0x5b38b6),dbFileIndexTable[_0x256493(0xcd)](_0x7d56ee,_0x28f54c,_0x5b38b6)));}}}console[_0x256493(0xc4)]('索引状态比对',_0x3ed337,_0x256493(0xae),new Date()[_0x256493(0xd2)]()-_0x5c7c35,'ms');},module[_0x21a13c(0xc9)]=indexUtil;