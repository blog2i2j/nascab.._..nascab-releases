const _0x48624f=_0x485f;(function(_0x588202,_0x321603){const _0xb2effc=_0x485f,_0x2be14e=_0x588202();while(!![]){try{const _0x1db5fd=-parseInt(_0xb2effc(0x1d6))/0x1+parseInt(_0xb2effc(0x1c6))/0x2+-parseInt(_0xb2effc(0x1bd))/0x3*(parseInt(_0xb2effc(0x19a))/0x4)+parseInt(_0xb2effc(0x1d1))/0x5*(parseInt(_0xb2effc(0x1af))/0x6)+parseInt(_0xb2effc(0x1d4))/0x7+-parseInt(_0xb2effc(0x1c5))/0x8*(-parseInt(_0xb2effc(0x1d0))/0x9)+-parseInt(_0xb2effc(0x188))/0xa*(parseInt(_0xb2effc(0x1b9))/0xb);if(_0x1db5fd===_0x321603)break;else _0x2be14e['push'](_0x2be14e['shift']());}catch(_0x18dcf6){_0x2be14e['push'](_0x2be14e['shift']());}}}(_0x4fbf,0x4974f));let indexUtil={};function _0x4fbf(){const _0x38101a=['darwin','readdirSync','文件已不存在','join','isPathIsInSourceFolder','endsWith','fileName','fullPath','1719HmTegH','36095pXAjSR','\x27\x20or\x20\x27','filename','2279235osYzDu','create','221107FJPfyb','dealFFmpegPath','../../db/dbFileIndexTable','replace','../../myConfig/config','getByPath','length','recursionDeleteIndex','ffprobe','is_file','code','20uHCLVl','getTime','pop','.bc!','ENOENT','dealFileChange','文件夹已不存在\x20删除文件夹及文件夹下的索引','path','startsWith','mtimeMs','statSync','cacheParentPath','-indexing','索引状态比对','has','../../libs/nasTrans','../../utils/transCodeUtil','isPathInHiddenDir','26204VRtcIq','log','push','err','来源目录已不存在\x20停止扫描','platform','Not\x20in\x20source\x20folder\x20','sep','isForbiddenFilename','deletePathAll','exports','ffprobeSync','isFile','getPathAllOnlyChild','tiny','isForbiddenPath','../../db/dbSourceFolderTable','getPathByType','来源目录不存在了\x20不处理文件\x20','nascabconfig','watchPath','12zejDIi','some','recursionFilesAddIndex','耗时:','mtime','error','prepare','.xltd','setIndexingState','/proc/','75988IfdCPX','delete','dbnascab-journal','dbPath','225KRGBuM','split','deleteByPathAndFileName','uploadTempFilePrefix','.tmp','isDirectory','dbnascab','checkPathIsInPrivateSpace','22408iKtGVT','304186PPhgDd','.downloading'];_0x4fbf=function(){return _0x38101a;};return _0x4fbf();}const currentPlatform=require('os')[_0x48624f(0x19f)](),path=require(_0x48624f(0x18f)),dbSourceFolderTable=require(_0x48624f(0x1aa)),dbFileIndexTable=require(_0x48624f(0x1d8)),dbConfigTable=require('../../db/dbConfigTable'),config=require(_0x48624f(0x1da)),fs=require('fs');function _0x485f(_0x52d029,_0x36ec75){const _0x4fbf01=_0x4fbf();return _0x485f=function(_0x485f6f,_0x3c932a){_0x485f6f=_0x485f6f-0x183;let _0x5e69b4=_0x4fbf01[_0x485f6f];return _0x5e69b4;},_0x485f(_0x52d029,_0x36ec75);}let FFmpeg=require(_0x48624f(0x197))['FFmpeg'];const transCodeUtil=require(_0x48624f(0x198));indexUtil[_0x48624f(0x1b1)]=async function(_0x3c5653,_0x137762,_0x5d907d,_0x4aed78,_0x32889b,_0x14df08,_0x511266){const _0x2865af=_0x48624f;let _0x24de29=0x1,_0x21034c=0x0;try{let _0x306b61=[{'path':_0x32889b,'files':fs[_0x2865af(0x1c9)](_0x32889b)}];while(_0x306b61[_0x2865af(0x183)]>0x0){let {path:_0x2de9aa,files:_0x5a44e0}=_0x306b61[_0x2865af(0x18a)]();if(indexUtil[_0x2865af(0x1c4)](_0x3c5653,_0x2de9aa))continue;if(indexUtil[_0x2865af(0x199)](_0x2de9aa)){console['log']('Skip\x20hidden\x20file/folder\x20'+_0x2de9aa);continue;}for(let _0x46f49c=0x0;_0x46f49c<_0x5a44e0[_0x2865af(0x183)];_0x46f49c++){let _0x5f28ec=_0x5a44e0[_0x46f49c];if(_0x5f28ec[_0x2865af(0x190)](config[_0x2865af(0x1c0)]))continue;if(!indexUtil[_0x2865af(0x1cc)](_0x3c5653,_0x4aed78,_0x32889b))return console[_0x2865af(0x19b)](_0x2865af(0x19e),_0x32889b),![];let _0x4a72b7=path[_0x2865af(0x1cb)](_0x2de9aa,_0x5f28ec);try{let _0xb44ba9=fs[_0x2865af(0x192)](_0x4a72b7),_0x3bf8d2=dbFileIndexTable[_0x2865af(0x1db)](_0x137762,_0x2de9aa,_0x5f28ec,_0x5d907d);if(_0xb44ba9['isFile']())!_0x3bf8d2&&await _0x14df08(_0x3c5653,_0x137762,_0x2de9aa,_0x5f28ec,0x1,_0xb44ba9),_0x21034c+=0x1;else _0xb44ba9['isDirectory']()&&(!_0x3bf8d2&&await _0x14df08(_0x3c5653,_0x137762,_0x2de9aa,_0x5f28ec,0x0,_0xb44ba9),_0x306b61[_0x2865af(0x19c)]({'path':_0x4a72b7,'files':fs[_0x2865af(0x1c9)](_0x4a72b7)}),_0x24de29+=0x1);_0x511266&&_0x511266();}catch(_0x31086a){console[_0x2865af(0x19b)](_0x2865af(0x19d),_0x31086a);continue;}}}return{'checkFileCount':_0x21034c,'checkPathCount':_0x24de29};}catch(_0x5abc9b){return console['log'](_0x2865af(0x1b4),_0x5abc9b),{'checkFileCount':_0x21034c,'checkPathCount':_0x24de29};}},indexUtil[_0x48624f(0x18d)]=async function(_0x5d1df2,_0x35b998,_0x5eacca,_0x11daca,_0x4760a8,_0x53ec13,_0x554409){const _0x349559=_0x48624f;let _0x457840=_0x5eacca[_0x349559(0x1ae)],_0x17e4cc=_0x5eacca['filePath'],_0x2acee1=_0x5eacca[_0x349559(0x1ce)],_0x1af671=_0x5eacca[_0x349559(0x1cf)];if(_0x2acee1['startsWith'](config['uploadTempFilePrefix']))return;let _0x218b8e=dbSourceFolderTable['getByPath'](_0x35b998,_0x457840);if(!_0x218b8e){console[_0x349559(0x19b)](_0x349559(0x1ac),_0x457840);return;}let _0x3a41dc=dbFileIndexTable[_0x349559(0x1db)](_0x5d1df2,_0x17e4cc,_0x2acee1,_0x11daca);try{let _0x18eae3=fs[_0x349559(0x192)](_0x1af671);if(_0x18eae3['isFile']()&&!_0x3a41dc)console[_0x349559(0x19b)]('******New\x20file******:',_0x2acee1),await _0x4760a8(_0x35b998,_0x5d1df2,_0x17e4cc,_0x2acee1,0x1,_0x18eae3);else{if(_0x18eae3[_0x349559(0x1c2)]()&&!_0x3a41dc)console[_0x349559(0x19b)]('******New\x20folder******',_0x1af671),await _0x4760a8(_0x35b998,_0x5d1df2,_0x17e4cc,_0x2acee1,0x0,_0x18eae3),await _0x53ec13(_0x35b998,_0x5d1df2,_0x1af671);else{if(_0x18eae3&&_0x3a41dc){if(_0x18eae3[_0x349559(0x191)]!=_0x3a41dc[_0x349559(0x1b3)]){let _0x5693fc=dbFileIndexTable['deleteByPathAndFileName'](_0x5d1df2,_0x17e4cc,_0x2acee1,_0x11daca);_0x554409&&_0x554409(_0x3a41dc,_0x5693fc),await _0x4760a8(_0x35b998,_0x5d1df2,_0x17e4cc,_0x2acee1,_0x18eae3[_0x349559(0x1a6)]()?0x1:0x0,_0x18eae3);}else{}}}}}catch(_0x1d7bde){console[_0x349559(0x19b)](_0x349559(0x1ca),_0x17e4cc,_0x2acee1);try{if(_0x1d7bde[_0x349559(0x187)]=='ENOENT'){if(_0x3a41dc&&_0x3a41dc[_0x349559(0x186)]==0x1){let _0x24e50f=dbFileIndexTable[_0x349559(0x1bf)](_0x5d1df2,_0x17e4cc,_0x2acee1,_0x11daca);_0x554409&&_0x554409(_0x3a41dc,_0x24e50f);}else _0x3a41dc&&_0x3a41dc[_0x349559(0x186)]==0x0&&(dbFileIndexTable[_0x349559(0x1bf)](_0x5d1df2,_0x17e4cc,_0x2acee1,_0x11daca),dbFileIndexTable[_0x349559(0x1a3)](_0x5d1df2,_0x1af671,_0x11daca));}else console[_0x349559(0x19b)](_0x1d7bde);}catch(_0x4bb9ca){console[_0x349559(0x19b)](_0x4bb9ca);}}return;},indexUtil[_0x48624f(0x1a5)]=function(_0x3712ac){return new Promise((_0x8e24da,_0x390673)=>{const _0x472282=_0x485f;try{FFmpeg(transCodeUtil[_0x472282(0x1d7)](_0x3712ac))[_0x472282(0x185)]((_0x257525,_0x2d2343)=>{_0x257525?_0x390673(_0x257525):_0x8e24da(_0x2d2343);});}catch(_0x4adcc4){_0x390673(_0x4adcc4);}});},indexUtil['isPathInHiddenDir']=function(_0x48d54e){const _0x578f5b=_0x48624f;try{const _0x311665=_0x48d54e[_0x578f5b(0x1be)](/[\/\\]/)['filter'](Boolean);return _0x311665[_0x578f5b(0x1b0)](_0x3751c6=>_0x3751c6['startsWith']('.'));}catch(_0x380c56){return![];}},indexUtil[_0x48624f(0x1cc)]=function(_0x1254ba,_0x450546,_0x4a3da6){const _0x1714cb=_0x48624f;let _0x6a2126=dbSourceFolderTable[_0x1714cb(0x1ab)](_0x1254ba,_0x450546);for(let _0x336291 of _0x6a2126){if(_0x4a3da6==_0x336291[_0x1714cb(0x18f)]||_0x4a3da6['startsWith'](path[_0x1714cb(0x1cb)](_0x336291[_0x1714cb(0x18f)],path[_0x1714cb(0x1a1)])))return _0x336291;}return![];},indexUtil[_0x48624f(0x1c4)]=function(_0x296636,_0x5c712e){const _0x489f34=_0x48624f;if(_0x5c712e[_0x489f34(0x1cd)](path['join'](_0x489f34(0x1ad),path['sep'],_0x489f34(0x1bb)))||_0x5c712e[_0x489f34(0x1cd)](path[_0x489f34(0x1cb)](_0x489f34(0x1ad),path[_0x489f34(0x1a1)],_0x489f34(0x1a8)))||_0x5c712e[_0x489f34(0x1cd)](path['join'](_0x489f34(0x1ad),path[_0x489f34(0x1a1)],_0x489f34(0x1c3))))return!![];try{_0x5c712e=_0x5c712e[_0x489f34(0x1d9)](/\'/g,'\x27\x27');let _0x5b688f='SELECT\x20*\x20FROM\x20private_space\x20WHERE\x20folder_path=\x27'+_0x5c712e+_0x489f34(0x1d2)+_0x5c712e+'\x27\x20like\x20'+'`folder_path`||\x27'+path['sep']+'%\x27',_0x16d940=_0x296636[_0x489f34(0x1b5)](_0x5b688f)['get']();return _0x16d940?!![]:![];}catch(_0x5d8365){return![];}},indexUtil['isForbiddenPath']=function(_0x89f10,_0x2f83e3){const _0x15fc7b=_0x48624f;try{if(currentPlatform=='linux'||currentPlatform==_0x15fc7b(0x1c8)){if(_0x2f83e3['startsWith'](_0x15fc7b(0x1b8)))return!![];if(_0x2f83e3=='/')return!![];}let _0x31cf56=path['join'](_0x89f10[_0x15fc7b(0x1bc)]),_0x299b32=path['join'](_0x89f10[_0x15fc7b(0x193)]),_0x166b31=path['join'](_0x299b32,path[_0x15fc7b(0x1a1)]),_0x4d84fa=path[_0x15fc7b(0x1cb)](_0x31cf56);_0x2f83e3=path[_0x15fc7b(0x1cb)](_0x2f83e3);if(_0x2f83e3==_0x31cf56||_0x2f83e3==_0x299b32||_0x2f83e3[_0x15fc7b(0x190)](_0x4d84fa)||_0x2f83e3['startsWith'](_0x166b31))return console[_0x15fc7b(0x19b)]('缓存数据目录内的变动，不处理',_0x2f83e3),!![];return![];}catch(_0x2e7b8d){return console[_0x15fc7b(0x19b)](_0x2e7b8d),![];}},indexUtil[_0x48624f(0x1a2)]=function(_0x171b1c){const _0x31ff02=_0x48624f;try{if(_0x171b1c[_0x31ff02(0x190)]('.'))return!![];if(_0x171b1c[_0x31ff02(0x1cd)](_0x31ff02(0x1c1))||_0x171b1c[_0x31ff02(0x1cd)](_0x31ff02(0x18b))||_0x171b1c[_0x31ff02(0x1cd)]('.td')||_0x171b1c[_0x31ff02(0x1cd)]('.qkdownloading')||_0x171b1c[_0x31ff02(0x1cd)](_0x31ff02(0x1b6))||_0x171b1c[_0x31ff02(0x1cd)](_0x31ff02(0x1c7)))return!![];return![];}catch(_0x8266a0){return console['log'](_0x8266a0),![];}},indexUtil[_0x48624f(0x1b7)]=function(_0x111026,_0x500fc7,_0x488619){const _0x3896bc=_0x48624f;dbConfigTable[_0x3896bc(0x1d5)](_0x111026,{'title':_0x500fc7+_0x3896bc(0x194),'value':_0x488619?'1':'0'});},indexUtil['doesPathCanAddToDb']=function(_0x30939a,_0x3899cd,_0x11338d,_0x57c513,_0x44267f){const _0x5d5b1d=_0x48624f;if(indexUtil[_0x5d5b1d(0x1a9)](_0x11338d,_0x57c513))return![];if(indexUtil[_0x5d5b1d(0x1a2)](_0x44267f))return![];if(!fs['existsSync'](path['join'](_0x57c513,_0x44267f)))return console[_0x5d5b1d(0x19b)]('Not\x20exist\x20',_0x57c513,_0x44267f),![];let _0x129a13=indexUtil[_0x5d5b1d(0x1cc)](_0x30939a,_0x3899cd,_0x57c513);if(!_0x129a13)return console[_0x5d5b1d(0x19b)](_0x5d5b1d(0x1a0),_0x3899cd,_0x57c513,_0x44267f),![];return _0x129a13;},indexUtil[_0x48624f(0x184)]=async function(_0x1dede6,_0x8d3e5,_0x56a96f){const _0x34d507=_0x48624f;let _0xd8c15a=[_0x56a96f],_0x1795f5=new Set([_0x56a96f]),_0x42b7b3=new Date()[_0x34d507(0x189)]();while(_0xd8c15a[_0x34d507(0x183)]>0x0){let _0x5d50ff=_0xd8c15a['pop'](),_0x1198bb=dbFileIndexTable[_0x34d507(0x1a7)](_0x1dede6,_0x5d50ff,_0x8d3e5);for(let _0x52b4d7=0x0;_0x52b4d7<_0x1198bb[_0x34d507(0x183)];_0x52b4d7++){let _0x4c9b05=path[_0x34d507(0x1cb)](_0x1198bb[_0x52b4d7][_0x34d507(0x18f)],_0x1198bb[_0x52b4d7][_0x34d507(0x1d3)]);try{let _0x47f477=fs['statSync'](_0x4c9b05);if(_0x47f477['isFile']()){}else _0x47f477['isDirectory']()&&(!_0x1795f5[_0x34d507(0x196)](_0x4c9b05)&&(_0xd8c15a[_0x34d507(0x19c)](_0x4c9b05),_0x1795f5['add'](_0x4c9b05)));}catch(_0xcb42ee){_0xcb42ee['code']==_0x34d507(0x18c)&&(_0x1198bb[_0x52b4d7]['is_file']==0x1?dbFileIndexTable[_0x34d507(0x1ba)](_0x1dede6,_0x1198bb[_0x52b4d7]['id'],_0x8d3e5):(console['log'](_0x34d507(0x18e),_0x4c9b05),dbFileIndexTable[_0x34d507(0x1bf)](_0x1dede6,_0x1198bb[_0x52b4d7][_0x34d507(0x18f)],_0x1198bb[_0x52b4d7]['filename'],_0x8d3e5),dbFileIndexTable['deletePathAll'](_0x1dede6,_0x4c9b05,_0x8d3e5)));}}}console[_0x34d507(0x19b)](_0x34d507(0x195),_0x56a96f,_0x34d507(0x1b2),new Date()[_0x34d507(0x189)]()-_0x42b7b3,'ms');},module[_0x48624f(0x1a4)]=indexUtil;