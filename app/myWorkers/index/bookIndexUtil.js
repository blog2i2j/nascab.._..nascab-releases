const _0x2bb771=_0xa34e;(function(_0x10bd7e,_0x2b2c47){const _0x135c3a=_0xa34e,_0x22bce4=_0x10bd7e();while(!![]){try{const _0xcc1053=-parseInt(_0x135c3a(0x199))/0x1+-parseInt(_0x135c3a(0x1c5))/0x2*(parseInt(_0x135c3a(0x18c))/0x3)+-parseInt(_0x135c3a(0x1c7))/0x4*(-parseInt(_0x135c3a(0x1b1))/0x5)+parseInt(_0x135c3a(0x1e2))/0x6*(parseInt(_0x135c3a(0x1d5))/0x7)+parseInt(_0x135c3a(0x1ae))/0x8+-parseInt(_0x135c3a(0x1cc))/0x9*(parseInt(_0x135c3a(0x1b0))/0xa)+-parseInt(_0x135c3a(0x198))/0xb;if(_0xcc1053===_0x2b2c47)break;else _0x22bce4['push'](_0x22bce4['shift']());}catch(_0x2f8523){_0x22bce4['push'](_0x22bce4['shift']());}}}(_0x2388,0x875d7));const path=require('path'),fs=require('fs');let pinyin=require(_0x2bb771(0x1aa));const sharp=require(_0x2bb771(0x1df)),{Worker}=require(_0x2bb771(0x18f));let letterList=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];const dbSourceFolderTable=require(_0x2bb771(0x190)),dbFileIndexTable=require('../../db/dbFileIndexTable'),dbConfigTable=require(_0x2bb771(0x1bc)),config=require(_0x2bb771(0x1e5)),indexUtil=require(_0x2bb771(0x1c2)),nfoUtil=require('../../utils/nfoUtil'),indexTableName=dbFileIndexTable[_0x2bb771(0x196)],bookIndexUtil={};bookIndexUtil[_0x2bb771(0x1a3)]=async function(_0x157acf,_0x2bb012){return new Promise((_0x29b579,_0x239d38)=>{const _0x266a67=_0xa34e;sharp(_0x157acf,{'failOnError':![]})[_0x266a67(0x1e3)]({'quality':0x4d})[_0x266a67(0x1c9)]({'width':0x1f4})['toBuffer']()['then'](_0x269ad0=>{const _0xff3bd4=_0x266a67;fs[_0xff3bd4(0x1ca)](_0x2bb012,_0x269ad0,_0x358e75=>{if(_0x358e75)return _0x239d38();return _0x29b579(_0x2bb012);});})['catch'](_0x2b44fe=>{const _0x44284c=_0x266a67;return console[_0x44284c(0x18b)](_0x44284c(0x1ea),_0x2b44fe),_0x239d38();});});},bookIndexUtil[_0x2bb771(0x1bf)]=function(_0x19933d,_0x42b0b4,_0x2c134d=![]){return new Promise((_0x5aeafd,_0x1a502b)=>{const _0x48e462=_0xa34e;let _0x3f6489=new Worker(path[_0x48e462(0x1d6)](__dirname,'bookInfoWorker.js'),{'workerData':{'indexObj':_0x19933d,'bookCoverCachePath':_0x42b0b4,'onlyGenCover':_0x2c134d}}),_0x24eafc=setTimeout(()=>{const _0x366152=_0x48e462;_0x3f6489&&(console['log'](_0x366152(0x1b5)),_0x3f6489[_0x366152(0x1dc)](),_0x3f6489=null,_0x1a502b());},0x7530);_0x3f6489['on'](_0x48e462(0x1d9),_0x26d818=>{const _0x299ccc=_0x48e462;_0x26d818[_0x299ccc(0x1c3)]==0x0&&(_0x24eafc&&clearTimeout(_0x24eafc),_0x5aeafd(_0x26d818));}),_0x3f6489['on'](_0x48e462(0x1bd),_0x5ecef2=>{const _0x2ba5fa=_0x48e462;console[_0x2ba5fa(0x1bd)](_0x2ba5fa(0x1b7),_0x5ecef2),_0x3f6489&&(_0x3f6489[_0x2ba5fa(0x1dc)](),_0x3f6489=null),_0x1a502b();}),_0x3f6489['on'](_0x48e462(0x18e),_0x28c38c=>{const _0x5c482d=_0x48e462;if(_0x28c38c!==0x0)console[_0x5c482d(0x1bd)](_0x5c482d(0x1ba),_0x28c38c);else{}});});},bookIndexUtil[_0x2bb771(0x1b8)]=async function(_0x4c8add,_0x49df6e){const _0xdedd20=_0x2bb771;let _0x52ee53=![];if(_0x49df6e['is_file']==0x1&&_0x49df6e[_0xdedd20(0x1d8)]&&config['bookTypeList']['includes'](_0x49df6e[_0xdedd20(0x1d8)][_0xdedd20(0x19f)]())){!_0x49df6e[_0xdedd20(0x1af)]&&(_0x49df6e[_0xdedd20(0x1af)]=bookIndexUtil[_0xdedd20(0x1e8)](_0x49df6e));let _0x3d0fcc=config[_0xdedd20(0x1e9)](_0x49df6e);try{let _0x3a990a=await bookIndexUtil[_0xdedd20(0x1bf)](_0x49df6e,_0x3d0fcc);if(_0x3a990a[_0xdedd20(0x1ac)])try{let _0x5ac1be=await bookIndexUtil['sharpWriteCover'](_0x3a990a['coverData'],_0x3d0fcc);_0x5ac1be&&(console[_0xdedd20(0x18b)](_0xdedd20(0x1a6),_0x5ac1be),_0x3a990a[_0xdedd20(0x19c)][_0xdedd20(0x194)]=_0x5ac1be);}catch(_0x213dbf){console[_0xdedd20(0x18b)](_0x213dbf);}return console['log'](_0xdedd20(0x1d3),_0x3a990a[_0xdedd20(0x19c)]['filename'],_0x3a990a[_0xdedd20(0x19c)][_0xdedd20(0x1ad)]),bookIndexUtil[_0xdedd20(0x1ec)](_0x4c8add,_0x3a990a['originalTime'],_0x3a990a[_0xdedd20(0x19c)]);}catch(_0x4ac71c){return console['log']('err\x205',_0x4ac71c),bookIndexUtil[_0xdedd20(0x1ec)](_0x4c8add,_0x52ee53,_0x49df6e);}}else{if(_0x49df6e[_0xdedd20(0x1b6)]==0x1)return;return bookIndexUtil[_0xdedd20(0x1ec)](_0x4c8add,_0x52ee53,_0x49df6e);}},bookIndexUtil[_0x2bb771(0x1e8)]=function(_0x53c6d6){const _0x14b1a3=_0x2bb771;let _0x4b691e=[_0x14b1a3(0x1d4),_0x14b1a3(0x1cb),_0x14b1a3(0x1dd),_0x14b1a3(0x1a5)];return _0x53c6d6[_0x14b1a3(0x1d8)]&&_0x4b691e['includes'](_0x53c6d6['ext'][_0x14b1a3(0x19f)]())?0x2:0x1;},bookIndexUtil[_0x2bb771(0x1a0)]=function(_0x3eb615){const _0xd6246=_0x2bb771;let _0x3ee4b7=_0xd6246(0x1e0),_0x375559=_0xd6246(0x1c4)+_0x3ee4b7;_0x3eb615[_0xd6246(0x1d0)](_0x375559)[_0xd6246(0x1b4)](),_0x375559=_0xd6246(0x1d2)+_0x3ee4b7,_0x3eb615[_0xd6246(0x1d0)](_0x375559)[_0xd6246(0x1b4)]();},bookIndexUtil[_0x2bb771(0x1de)]=async function(_0x254202,_0x41a6fc,_0x333c6b){const _0x39cf27=_0x2bb771;return await indexUtil['recursionFilesAddIndex'](_0x254202,_0x41a6fc,indexTableName,_0x39cf27(0x18d),_0x333c6b,bookIndexUtil[_0x39cf27(0x1c0)]);},bookIndexUtil[_0x2bb771(0x1c0)]=async function(_0x509e7a,_0x28625e,_0x4380d1,_0x25481b,_0x4f8752,_0x847245){const _0x4a8a6c=_0x2bb771;let _0xc72be6=indexUtil[_0x4a8a6c(0x19d)](_0x509e7a,_0x4a8a6c(0x18d),config,_0x4380d1,_0x25481b);if(!_0xc72be6)return;let _0x34541d=_0x847245[_0x4a8a6c(0x192)];_0x847245[_0x4a8a6c(0x1d7)]<_0x34541d&&(_0x34541d=_0x847245[_0x4a8a6c(0x1d7)]);_0x847245['atimeMs']<_0x34541d&&(_0x34541d=_0x847245[_0x4a8a6c(0x1e7)]);_0x847245[_0x4a8a6c(0x1d1)]<_0x34541d&&(_0x34541d=_0x847245[_0x4a8a6c(0x1d1)]);let _0x581e63={'path':_0x4380d1,'filename':_0x25481b,'is_file':_0x4f8752,'ctime':_0x847245[_0x4a8a6c(0x1d1)],'mtime':_0x847245[_0x4a8a6c(0x1d7)],'ext':path[_0x4a8a6c(0x1be)](_0x25481b),'birthtime':Math[_0x4a8a6c(0x1cd)](_0x34541d),'size':_0x847245[_0x4a8a6c(0x1eb)],'check_time':new Date()[_0x4a8a6c(0x1ce)]()};_0x581e63=await bookIndexUtil[_0x4a8a6c(0x1b8)](_0x28625e,_0x581e63);},bookIndexUtil[_0x2bb771(0x1db)]=async function(_0x47cb74,_0x1191a4,_0x3e5f83){const _0x1faa46=_0x2bb771;await indexUtil[_0x1faa46(0x1db)](_0x47cb74,_0x1191a4,_0x3e5f83,indexTableName,bookIndexUtil[_0x1faa46(0x1c0)],bookIndexUtil[_0x1faa46(0x1de)]);return;},bookIndexUtil[_0x2bb771(0x1ec)]=function(_0x1e0c94,_0x568f19,_0x32df37){const _0x367e7=_0x2bb771;nfoUtil[_0x367e7(0x1c8)](_0x32df37)['then'](_0x4b25be=>{_0x53c907(_0x4b25be);})[_0x367e7(0x1e6)](_0x257097=>{_0x53c907(_0x32df37);});function _0x53c907(_0x47606e){const _0x7e4ad5=_0x367e7;_0x568f19&&_0x568f19<config['exifMinTimeStamp']&&(_0x568f19=![]);(!_0x568f19||_0x568f19==_0x7e4ad5(0x19a)||_0x568f19==_0x7e4ad5(0x193)||_0x568f19=='NaN'||_0x568f19==_0x7e4ad5(0x1a2))&&(_0x568f19=_0x47606e[_0x7e4ad5(0x1c1)]||_0x47606e[_0x7e4ad5(0x1bb)]);let _0xc15358=new Date(_0x568f19);_0x47606e[_0x7e4ad5(0x1a7)]=_0xc15358['getTime']();let _0x54f5a4=_0xc15358['getFullYear'](),_0x6bef4c=_0xc15358[_0x7e4ad5(0x19b)]()+0x1;_0x6bef4c=_0x6bef4c>=0xa?_0x6bef4c:'0'+_0x6bef4c;let _0x29ed7e=_0xc15358[_0x7e4ad5(0x1cf)]();_0x29ed7e=_0x29ed7e>=0xa?_0x29ed7e:'0'+_0x29ed7e,_0x47606e[_0x7e4ad5(0x19e)]=_0x54f5a4+'-'+_0x6bef4c+'-'+_0x29ed7e;let _0x42d888=dbFileIndexTable[_0x7e4ad5(0x1a4)](_0x1e0c94,_0x47606e,indexTableName);if(_0x42d888&&_0x42d888['lastInsertRowid']){let _0x4a308a=dbFileIndexTable['getById'](_0x1e0c94,_0x42d888[_0x7e4ad5(0x1b2)],dbFileIndexTable[_0x7e4ad5(0x196)]);_0x4a308a&&bookIndexUtil['dealFirstLetterSingle'](_0x1e0c94,_0x4a308a);}}},bookIndexUtil['dealFirstLetterAll']=function(_0x3f6dba){const _0xca742c=_0x2bb771;let _0x2751a1=_0xca742c(0x195),_0x300c5a=_0x3f6dba[_0xca742c(0x1d0)](_0x2751a1)[_0xca742c(0x1a1)]();for(let _0x114fb0 in _0x300c5a){bookIndexUtil[_0xca742c(0x197)](_0x3f6dba,_0x300c5a[_0x114fb0]);}};function _0x2388(){const _0x513980=['exports','../../myConfig/config','catch','atimeMs','getBookType','getMediaCoverCachePath','err1','size','addOriginalDate','log','6dJcldM','book','exit','worker_threads','../../db/dbSourceFolderTable','filename','birthtimeMs','Nan','coverPath','SELECT\x20id,filename,artist,album,title\x20FROM\x20file_index_book\x20WHERE\x20filename_fl\x20is\x20null','INDEX_TABLE_NAME_BOOK','dealFirstLetterSingle','12399376VKwprW','49789LqFuXM','NaN','getMonth','indexObj','doesPathCanAddToDb','original_date','toLowerCase','setAllBookType','all','Null','sharpWriteCover','create','.zip','封面写入成功','original_time','UPDATE\x20file_index_book\x20set\x20filename_fl=?,artist_fl=?,title_fl=?\x20where\x20id=?','includes','node-pinyin','title','coverData','total_page','5995296DnEXCh','type','6131810YDkNVQ','185bgfCgL','lastInsertRowid','toUpperCase','run','已超时\x20结束处理worker','is_file','Worker\x20error:','dealBookInfo','length','Worker\x20stopped\x20with\x20exit\x20code:','ctime','../../db/dbConfigTable','error','extname','runGetBookInfoWorker','addFileIndexToDb','birthtime','./indexUtil','code','UPDATE\x20file_index_book\x20SET\x20type=2\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20in\x20','551646gQeXQL','initials','115844LJtjtM','restoreBookNfo','resize','writeFile','.cbr','9vQiejK','ceil','getTime','getDate','prepare','ctimeMs','UPDATE\x20file_index_book\x20SET\x20type=1\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20not\x20in\x20','处理成功','.cbz','3763613GGqPds','resolve','mtimeMs','ext','message','test','dealFileChange','terminate','.rar','recursionFilesAddIndex','sharp','(\x27.cbz\x27,\x27.cbr\x27,\x27.rar\x27,\x27.zip\x27,\x27.CBZ\x27,\x27.CBR\x27,\x27.RAR\x27,\x27.ZIP\x27)','artist','12bbLrvx','jpeg'];_0x2388=function(){return _0x513980;};return _0x2388();}function isChinese(_0xb24374){const _0x10030f=_0x2bb771;var _0x22e89d=/[^\\u4e00-\\u9fa5]/;return _0x22e89d[_0x10030f(0x1da)](_0xb24374);}function _0xa34e(_0x4ec494,_0x59e6af){const _0x238871=_0x2388();return _0xa34e=function(_0xa34ec,_0x229efd){_0xa34ec=_0xa34ec-0x18b;let _0x305a89=_0x238871[_0xa34ec];return _0x305a89;},_0xa34e(_0x4ec494,_0x59e6af);}bookIndexUtil[_0x2bb771(0x197)]=function(_0x3fa543,_0x22175f){const _0x1aa3be=_0x2bb771;function _0x2e43e0(_0x5403e3){const _0x4ea064=_0xa34e;if(_0x5403e3&&_0x5403e3['length']>0x0){let _0x2a1a0d=_0x5403e3[0x0];if(letterList[_0x4ea064(0x1a9)](_0x2a1a0d))return _0x2a1a0d;else{if(isChinese(_0x2a1a0d)){let _0xbb7cfa=pinyin(_0x2a1a0d,{'style':_0x4ea064(0x1c6)});return _0xbb7cfa&&_0xbb7cfa['length']>0x0&&_0xbb7cfa[0x0][_0x4ea064(0x1b9)]>0x0&&_0xbb7cfa[0x0][0x0][_0x4ea064(0x1b9)]>0x0?_0xbb7cfa[0x0][0x0][0x0]:'#';}else return'#';}}else return'';}let _0x404edf=_0x2e43e0(_0x22175f['filename']?_0x22175f[_0x1aa3be(0x191)][_0x1aa3be(0x1b3)]():'')[_0x1aa3be(0x1b3)](),_0x2835ed=_0x2e43e0(_0x22175f[_0x1aa3be(0x1e1)]?_0x22175f[_0x1aa3be(0x1e1)][_0x1aa3be(0x1b3)]():'')[_0x1aa3be(0x1b3)](),_0x3932cc=_0x2e43e0(_0x22175f[_0x1aa3be(0x1ab)]?_0x22175f[_0x1aa3be(0x1ab)][_0x1aa3be(0x1b3)]():'')[_0x1aa3be(0x1b3)]();_0x3fa543[_0x1aa3be(0x1d0)](_0x1aa3be(0x1a8))['run'](_0x404edf,_0x2835ed,_0x3932cc,_0x22175f['id']);},module[_0x2bb771(0x1e4)]=bookIndexUtil;