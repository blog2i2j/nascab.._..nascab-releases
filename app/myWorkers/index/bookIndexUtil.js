const _0x1149cd=_0x1bba;function _0x2207(){const _0x34c8ab=['addOriginalDate','writeFile','11688SnqULz','err\x205','UPDATE\x20file_index_book\x20SET\x20type=1\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20not\x20in\x20','5048152rniRZo','log','665451pnovUP','ctime','./indexUtil','.cbz','doesPathCanAddToDb','INDEX_TABLE_NAME_BOOK','ceil','27juVLWg','处理成功','toLowerCase','getMediaCoverCachePath','artist','(\x27.cbz\x27,\x27.cbr\x27,\x27.rar\x27,\x27.zip\x27,\x27.CBZ\x27,\x27.CBR\x27,\x27.RAR\x27,\x27.ZIP\x27)','getTime','path','addFileIndexToDb','Worker\x20stopped\x20with\x20exit\x20code:','getById','../../utils/nfoUtil','total_page','dealFirstLetterAll','toBuffer','ctimeMs','Worker\x20error:','atimeMs','1115ZDLTbD','resize','dealFileChange','title','ext','size','SELECT\x20id,filename,artist,album,title\x20FROM\x20file_index_book\x20WHERE\x20filename_fl\x20is\x20null','Nan','sharp','message','mtimeMs','273291LwYZTo','error','UPDATE\x20file_index_book\x20set\x20filename_fl=?,artist_fl=?,title_fl=?\x20where\x20id=?','toUpperCase','err1','recursionFilesAddIndex','coverData','getMonth','worker_threads','.rar','NaN','exports','exit','then','../../db/dbFileIndexTable','.zip','738020nLKiEY','length','setAllBookType','terminate','create','is_file','prepare','已超时\x20结束处理worker','includes','code','getDate','restoreBookNfo','getBookType','extname','../../db/dbSourceFolderTable','getFullYear','bookTypeList','Null','2ZnbGvS','test','dealBookInfo','封面写入成功','4060630TFRTKC','jpeg','type','2852423BhNORa','sharpWriteCover','dealFirstLetterSingle','indexObj','original_date','run','initials','originalTime','book','lastInsertRowid'];_0x2207=function(){return _0x34c8ab;};return _0x2207();}(function(_0x241672,_0x56fdda){const _0x2d7309=_0x1bba,_0x3bfa2d=_0x241672();while(!![]){try{const _0x285fbd=-parseInt(_0x2d7309(0x222))/0x1+-parseInt(_0x2d7309(0x20a))/0x2*(parseInt(_0x2d7309(0x1e8))/0x3)+parseInt(_0x2d7309(0x1f8))/0x4+-parseInt(_0x2d7309(0x1dd))/0x5*(parseInt(_0x2d7309(0x21d))/0x6)+-parseInt(_0x2d7309(0x211))/0x7+parseInt(_0x2d7309(0x220))/0x8+parseInt(_0x2d7309(0x1cb))/0x9*(parseInt(_0x2d7309(0x20e))/0xa);if(_0x285fbd===_0x56fdda)break;else _0x3bfa2d['push'](_0x3bfa2d['shift']());}catch(_0x249d37){_0x3bfa2d['push'](_0x3bfa2d['shift']());}}}(_0x2207,0x6a448));const path=require(_0x1149cd(0x1d2)),fs=require('fs');let pinyin=require('node-pinyin');const sharp=require(_0x1149cd(0x1e5)),{Worker}=require(_0x1149cd(0x1f0));let letterList=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];const dbSourceFolderTable=require(_0x1149cd(0x206)),dbFileIndexTable=require(_0x1149cd(0x1f6)),dbConfigTable=require('../../db/dbConfigTable'),config=require('../../myConfig/config'),indexUtil=require(_0x1149cd(0x1c6)),nfoUtil=require(_0x1149cd(0x1d6)),indexTableName=dbFileIndexTable[_0x1149cd(0x1c9)],bookIndexUtil={};bookIndexUtil[_0x1149cd(0x212)]=async function(_0x1af1fd,_0x1592b7){return new Promise((_0x331e81,_0x39c4d2)=>{const _0x2f4f99=_0x1bba;sharp(_0x1af1fd,{'failOnError':![]})[_0x2f4f99(0x20f)]({'quality':0x4d})[_0x2f4f99(0x1de)]({'width':0x1f4})[_0x2f4f99(0x1d9)]()['then'](_0x6c8c7c=>{const _0x21054f=_0x2f4f99;fs[_0x21054f(0x21c)](_0x1592b7,_0x6c8c7c,_0x358692=>{if(_0x358692)return _0x39c4d2();return _0x331e81(_0x1592b7);});})['catch'](_0x78f4ef=>{const _0x40beb9=_0x2f4f99;return console[_0x40beb9(0x221)](_0x40beb9(0x1ec),_0x78f4ef),_0x39c4d2();});});},bookIndexUtil['runGetBookInfoWorker']=function(_0x21e6b3,_0x3e2b53,_0x14656a=![]){return new Promise((_0x2e32e2,_0x3e8e4a)=>{const _0x4e90be=_0x1bba;let _0x263c90=new Worker(path['resolve'](__dirname,'bookInfoWorker.js'),{'workerData':{'indexObj':_0x21e6b3,'bookCoverCachePath':_0x3e2b53,'onlyGenCover':_0x14656a}}),_0x395a90=setTimeout(()=>{const _0x11d859=_0x1bba;_0x263c90&&(console[_0x11d859(0x221)](_0x11d859(0x1ff)),_0x263c90[_0x11d859(0x1fb)](),_0x263c90=null,_0x3e8e4a());},0x7530);_0x263c90['on'](_0x4e90be(0x1e6),_0x37167f=>{const _0x37347b=_0x4e90be;_0x37167f[_0x37347b(0x201)]==0x0&&(_0x395a90&&clearTimeout(_0x395a90),_0x2e32e2(_0x37167f));}),_0x263c90['on'](_0x4e90be(0x1e9),_0x156db3=>{const _0x5102ad=_0x4e90be;console[_0x5102ad(0x1e9)](_0x5102ad(0x1db),_0x156db3),_0x263c90&&(_0x263c90[_0x5102ad(0x1fb)](),_0x263c90=null),_0x3e8e4a();}),_0x263c90['on'](_0x4e90be(0x1f4),_0x5f5074=>{const _0x2dd667=_0x4e90be;if(_0x5f5074!==0x0)console['error'](_0x2dd667(0x1d4),_0x5f5074);else{}});});},bookIndexUtil[_0x1149cd(0x20c)]=async function(_0xc4a8df,_0x3502e5){const _0x580869=_0x1149cd;let _0x3b7edb=![];if(_0x3502e5[_0x580869(0x1fd)]==0x1&&_0x3502e5['ext']&&config[_0x580869(0x208)][_0x580869(0x200)](_0x3502e5['ext'][_0x580869(0x1cd)]())){!_0x3502e5[_0x580869(0x210)]&&(_0x3502e5[_0x580869(0x210)]=bookIndexUtil[_0x580869(0x204)](_0x3502e5));let _0x5678d7=config[_0x580869(0x1ce)](_0x3502e5);try{let _0x28ba4e=await bookIndexUtil['runGetBookInfoWorker'](_0x3502e5,_0x5678d7);if(_0x28ba4e[_0x580869(0x1ee)])try{let _0x1e3ba7=await bookIndexUtil[_0x580869(0x212)](_0x28ba4e[_0x580869(0x1ee)],_0x5678d7);_0x1e3ba7&&(console[_0x580869(0x221)](_0x580869(0x20d),_0x1e3ba7),_0x28ba4e[_0x580869(0x214)]['coverPath']=_0x1e3ba7);}catch(_0x5f5254){console[_0x580869(0x221)](_0x5f5254);}return console[_0x580869(0x221)](_0x580869(0x1cc),_0x28ba4e[_0x580869(0x214)]['filename'],_0x28ba4e[_0x580869(0x214)][_0x580869(0x1d7)]),bookIndexUtil[_0x580869(0x21b)](_0xc4a8df,_0x28ba4e[_0x580869(0x218)],_0x28ba4e[_0x580869(0x214)]);}catch(_0x22e9ba){return console[_0x580869(0x221)](_0x580869(0x21e),_0x22e9ba),bookIndexUtil[_0x580869(0x21b)](_0xc4a8df,_0x3b7edb,_0x3502e5);}}else{if(_0x3502e5['is_file']==0x1)return;return bookIndexUtil[_0x580869(0x21b)](_0xc4a8df,_0x3b7edb,_0x3502e5);}},bookIndexUtil['getBookType']=function(_0xccfcdb){const _0x54ffd0=_0x1149cd;let _0xf4e21f=[_0x54ffd0(0x1c7),'.cbr',_0x54ffd0(0x1f1),_0x54ffd0(0x1f7)];return _0xccfcdb[_0x54ffd0(0x1e1)]&&_0xf4e21f[_0x54ffd0(0x200)](_0xccfcdb[_0x54ffd0(0x1e1)]['toLowerCase']())?0x2:0x1;},bookIndexUtil[_0x1149cd(0x1fa)]=function(_0x433f9c){const _0x26869e=_0x1149cd;let _0x4f91ed=_0x26869e(0x1d0),_0xca6b6d='UPDATE\x20file_index_book\x20SET\x20type=2\x20WHERE\x20type\x20=\x20\x27\x27\x20and\x20ext\x20in\x20'+_0x4f91ed;_0x433f9c['prepare'](_0xca6b6d)[_0x26869e(0x216)](),_0xca6b6d=_0x26869e(0x21f)+_0x4f91ed,_0x433f9c[_0x26869e(0x1fe)](_0xca6b6d)[_0x26869e(0x216)]();},bookIndexUtil['recursionFilesAddIndex']=async function(_0x48f3e2,_0x410ea3,_0x25caec){const _0x5914a8=_0x1149cd;return await indexUtil[_0x5914a8(0x1ed)](_0x48f3e2,_0x410ea3,indexTableName,'book',_0x25caec,bookIndexUtil[_0x5914a8(0x1d3)]);},bookIndexUtil['addFileIndexToDb']=async function(_0xa17ece,_0x149796,_0x224a3d,_0xf93731,_0x5eca75,_0x15414d){const _0x14341a=_0x1149cd;let _0x4eeedc=indexUtil[_0x14341a(0x1c8)](_0xa17ece,_0x14341a(0x219),config,_0x224a3d,_0xf93731);if(!_0x4eeedc)return;let _0x506bca=_0x15414d['birthtimeMs'];_0x15414d[_0x14341a(0x1e7)]<_0x506bca&&(_0x506bca=_0x15414d['mtimeMs']);_0x15414d[_0x14341a(0x1dc)]<_0x506bca&&(_0x506bca=_0x15414d[_0x14341a(0x1dc)]);_0x15414d[_0x14341a(0x1da)]<_0x506bca&&(_0x506bca=_0x15414d[_0x14341a(0x1da)]);let _0x37094d={'path':_0x224a3d,'filename':_0xf93731,'is_file':_0x5eca75,'ctime':_0x15414d[_0x14341a(0x1da)],'mtime':_0x15414d[_0x14341a(0x1e7)],'ext':path[_0x14341a(0x205)](_0xf93731),'birthtime':Math[_0x14341a(0x1ca)](_0x506bca),'size':_0x15414d[_0x14341a(0x1e2)],'check_time':new Date()[_0x14341a(0x1d1)]()};_0x37094d=await bookIndexUtil['dealBookInfo'](_0x149796,_0x37094d);},bookIndexUtil['dealFileChange']=async function(_0x1bce89,_0x411488,_0x1282f3){const _0x104a22=_0x1149cd;await indexUtil[_0x104a22(0x1df)](_0x1bce89,_0x411488,_0x1282f3,indexTableName,bookIndexUtil[_0x104a22(0x1d3)],bookIndexUtil[_0x104a22(0x1ed)]);return;},bookIndexUtil['addOriginalDate']=function(_0x395018,_0x363ef8,_0x44bdf4){const _0x370fab=_0x1149cd;nfoUtil[_0x370fab(0x203)](_0x44bdf4)[_0x370fab(0x1f5)](_0x3fcc22=>{_0x35b8cd(_0x3fcc22);})['catch'](_0x44963b=>{_0x35b8cd(_0x44bdf4);});function _0x35b8cd(_0x2de161){const _0x413258=_0x370fab;_0x363ef8&&_0x363ef8<config['exifMinTimeStamp']&&(_0x363ef8=![]);(!_0x363ef8||_0x363ef8=='NaN'||_0x363ef8==_0x413258(0x1e4)||_0x363ef8==_0x413258(0x1f2)||_0x363ef8==_0x413258(0x209))&&(_0x363ef8=_0x2de161['birthtime']||_0x2de161[_0x413258(0x223)]);let _0x42c630=new Date(_0x363ef8);_0x2de161['original_time']=_0x42c630['getTime']();let _0x140727=_0x42c630[_0x413258(0x207)](),_0x3fe312=_0x42c630[_0x413258(0x1ef)]()+0x1;_0x3fe312=_0x3fe312>=0xa?_0x3fe312:'0'+_0x3fe312;let _0x5ae237=_0x42c630[_0x413258(0x202)]();_0x5ae237=_0x5ae237>=0xa?_0x5ae237:'0'+_0x5ae237,_0x2de161[_0x413258(0x215)]=_0x140727+'-'+_0x3fe312+'-'+_0x5ae237;let _0x8f7ef5=dbFileIndexTable[_0x413258(0x1fc)](_0x395018,_0x2de161,indexTableName);if(_0x8f7ef5&&_0x8f7ef5[_0x413258(0x21a)]){let _0x44e248=dbFileIndexTable[_0x413258(0x1d5)](_0x395018,_0x8f7ef5[_0x413258(0x21a)],dbFileIndexTable['INDEX_TABLE_NAME_BOOK']);_0x44e248&&bookIndexUtil[_0x413258(0x213)](_0x395018,_0x44e248);}}},bookIndexUtil[_0x1149cd(0x1d8)]=function(_0x413794){const _0x3c814a=_0x1149cd;let _0x51265b=_0x3c814a(0x1e3),_0x33ca8a=_0x413794[_0x3c814a(0x1fe)](_0x51265b)['all']();for(let _0x32eaf4 in _0x33ca8a){bookIndexUtil[_0x3c814a(0x213)](_0x413794,_0x33ca8a[_0x32eaf4]);}};function _0x1bba(_0x18360a,_0x5e503b){const _0x220764=_0x2207();return _0x1bba=function(_0x1bbae8,_0x57e0e4){_0x1bbae8=_0x1bbae8-0x1c6;let _0x17601e=_0x220764[_0x1bbae8];return _0x17601e;},_0x1bba(_0x18360a,_0x5e503b);}function isChinese(_0x1ef265){const _0x4f99f8=_0x1149cd;var _0x119b84=/[^\\u4e00-\\u9fa5]/;return _0x119b84[_0x4f99f8(0x20b)](_0x1ef265);}bookIndexUtil[_0x1149cd(0x213)]=function(_0x3f290d,_0x41d2da){const _0x30eb8d=_0x1149cd;function _0x3135e2(_0xa545d9){const _0x6e85a4=_0x1bba;if(_0xa545d9&&_0xa545d9[_0x6e85a4(0x1f9)]>0x0){let _0x566dd8=_0xa545d9[0x0];if(letterList[_0x6e85a4(0x200)](_0x566dd8))return _0x566dd8;else{if(isChinese(_0x566dd8)){let _0x1a12df=pinyin(_0x566dd8,{'style':_0x6e85a4(0x217)});return _0x1a12df&&_0x1a12df[_0x6e85a4(0x1f9)]>0x0&&_0x1a12df[0x0]['length']>0x0&&_0x1a12df[0x0][0x0][_0x6e85a4(0x1f9)]>0x0?_0x1a12df[0x0][0x0][0x0]:'#';}else return'#';}}else return'';}let _0x3aabae=_0x3135e2(_0x41d2da['filename']?_0x41d2da['filename'][_0x30eb8d(0x1eb)]():'')[_0x30eb8d(0x1eb)](),_0x43476e=_0x3135e2(_0x41d2da[_0x30eb8d(0x1cf)]?_0x41d2da[_0x30eb8d(0x1cf)][_0x30eb8d(0x1eb)]():'')[_0x30eb8d(0x1eb)](),_0x4f7455=_0x3135e2(_0x41d2da[_0x30eb8d(0x1e0)]?_0x41d2da[_0x30eb8d(0x1e0)][_0x30eb8d(0x1eb)]():'')['toUpperCase']();_0x3f290d[_0x30eb8d(0x1fe)](_0x30eb8d(0x1ea))[_0x30eb8d(0x216)](_0x3aabae,_0x43476e,_0x4f7455,_0x41d2da['id']);},module[_0x1149cd(0x1f3)]=bookIndexUtil;