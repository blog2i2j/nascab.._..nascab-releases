const _0xc34ce8=_0x4267;(function(_0x269b5a,_0x26e50c){const _0x18873c=_0x4267,_0x4f9c35=_0x269b5a();while(!![]){try{const _0x4ecfa1=parseInt(_0x18873c(0xf8))/0x1+-parseInt(_0x18873c(0xdf))/0x2+parseInt(_0x18873c(0xd6))/0x3*(-parseInt(_0x18873c(0x107))/0x4)+parseInt(_0x18873c(0xe9))/0x5+-parseInt(_0x18873c(0xde))/0x6+parseInt(_0x18873c(0xc9))/0x7*(-parseInt(_0x18873c(0xf5))/0x8)+parseInt(_0x18873c(0xd9))/0x9;if(_0x4ecfa1===_0x26e50c)break;else _0x4f9c35['push'](_0x4f9c35['shift']());}catch(_0x34aec9){_0x4f9c35['push'](_0x4f9c35['shift']());}}}(_0x5aaa,0xe6ef5));const {parentPort,workerData}=require(_0xc34ce8(0x105)),EPub=require(_0xc34ce8(0xd1)),mobiNode=require(_0xc34ce8(0xe3)),mobiJs=require(_0xc34ce8(0xce)),fflate=require(_0xc34ce8(0xcc)),fs=require('fs'),path=require(_0xc34ce8(0x101));function _0x4267(_0x3951b8,_0x90b026){const _0x5aaa8c=_0x5aaa();return _0x4267=function(_0x426744,_0x3efa8e){_0x426744=_0x426744-0xc9;let _0x2458ba=_0x5aaa8c[_0x426744];return _0x2458ba;},_0x4267(_0x3951b8,_0x90b026);}let originalTime=null,coverData=null,zipUtil=require(_0xc34ce8(0xf9));function returnResult(){parentPort['postMessage']({'code':0x0,'indexObj':workerData['indexObj'],'originalTime':originalTime,'coverData':coverData}),process['exit'](0x0);}function _0x5aaa(){const _0x35bcb4=['close','3vchDYe','then','.epub','28226961gCWNqz','log','date','.azw','Worker\x20stopped.','6959346CAauwq','2198492qawhzc','bookCoverCachePath','MOBI写入书籍封面缓存：','.cbz','./bookMobiNode','indexObj','toLowerCase','type','total_page','getTime','7870535fCEocE','readFileSync','没有找到需要处理的书籍目录','coverPath','book-type','封面缓存已经存在','.cbr','.azw3','fileCount','err2','error','metadata','152Dnnbsd','metadata_state','onlyGenCover','230321pahXWG','../../utils/zipUtil','未找到封面','end','join','getImage','existsSync','dealedBuffer','cover','path','publisher','title','filename','worker_threads','creator','1839216OpWlDC','470071SqvDUf','EPUB写入书籍封面缓存：','epub解析失败','./bookFflate','getZipCover','mobi','.rar','unzlibSync','epub','language','from','MOBI'];_0x5aaa=function(){return _0x35bcb4;};return _0x5aaa();}async function genBookInfoMobi(_0x5c03ee){const _0x17fe8a=_0xc34ce8;if(!workerData[_0x17fe8a(0xf7)])try{let _0x285f47=new mobiJs(_0x5c03ee);_0x285f47[_0x17fe8a(0x103)]&&(workerData[_0x17fe8a(0xe4)][_0x17fe8a(0x103)]=_0x285f47['title']),workerData[_0x17fe8a(0xe4)][_0x17fe8a(0xf6)]=0x1;}catch(_0x350fc0){}try{if(fs[_0x17fe8a(0xfe)](workerData[_0x17fe8a(0xe0)]))return console[_0x17fe8a(0xda)]('封面缓存已经存在',workerData[_0x17fe8a(0xe4)][_0x17fe8a(0x104)]),workerData['indexObj'][_0x17fe8a(0xec)]=workerData['bookCoverCachePath'],returnResult();let _0x420907=fs[_0x17fe8a(0xea)](_0x5c03ee),_0x29a9f1=await new mobiNode[(_0x17fe8a(0xd4))]({'unzlib':fflate[_0x17fe8a(0xd0)]})['open'](new Uint8Array(_0x420907)),_0x5f5a85=await _0x29a9f1['getCover']();if(!_0x5f5a85)return returnResult();return console[_0x17fe8a(0xda)](_0x17fe8a(0xe1),workerData['indexObj']['filename']),coverData=Buffer[_0x17fe8a(0xd3)](_0x5f5a85),returnResult();}catch(_0xd93876){return console[_0x17fe8a(0xda)](_0x17fe8a(0xf2),_0xd93876),returnResult();}}async function genBookInfoEpub(_0x2ed597){const _0x39550b=_0xc34ce8;let _0x345416=new EPub(_0x2ed597);_0x345416['on'](_0x39550b(0xfb),function(){const _0x17d3f0=_0x39550b;if(_0x345416[_0x17d3f0(0xf4)]){let _0x1a7676=_0x345416[_0x17d3f0(0xf4)];_0x1a7676[_0x17d3f0(0x106)]&&(workerData['indexObj']['artist']=_0x1a7676['creator']);_0x1a7676[_0x17d3f0(0x102)]&&(workerData[_0x17d3f0(0xe4)][_0x17d3f0(0x102)]=_0x1a7676[_0x17d3f0(0x102)]);_0x1a7676['language']&&(workerData[_0x17d3f0(0xe4)][_0x17d3f0(0xd2)]=_0x1a7676[_0x17d3f0(0xd2)]);_0x1a7676[_0x17d3f0(0x103)]&&(workerData[_0x17d3f0(0xe4)][_0x17d3f0(0x103)]=_0x1a7676[_0x17d3f0(0x103)]);_0x1a7676['book-type']&&(console[_0x17d3f0(0xda)](_0x17d3f0(0xed),_0x1a7676[_0x17d3f0(0xed)]),_0x1a7676[_0x17d3f0(0xed)]=='comic'&&(workerData[_0x17d3f0(0xe4)][_0x17d3f0(0xe6)]=0x2));if(_0x1a7676[_0x17d3f0(0xdb)])try{originalTime=new Date(_0x1a7676[_0x17d3f0(0xdb)])[_0x17d3f0(0xe8)]();}catch(_0x3c4cdc){console['log'](_0x3c4cdc);}workerData[_0x17d3f0(0xe4)][_0x17d3f0(0xf6)]=0x1;if(fs[_0x17d3f0(0xfe)](workerData['bookCoverCachePath']))return console[_0x17d3f0(0xda)](_0x17d3f0(0xee),workerData[_0x17d3f0(0xe4)][_0x17d3f0(0x104)]),workerData[_0x17d3f0(0xe4)][_0x17d3f0(0xec)]=workerData['bookCoverCachePath'],returnResult();_0x345416[_0x17d3f0(0xf4)]['cover']?_0x345416[_0x17d3f0(0xfd)](_0x345416[_0x17d3f0(0xf4)][_0x17d3f0(0x100)],async(_0x44be45,_0x472127,_0x4cdfd5)=>{const _0x1e327e=_0x17d3f0;return console[_0x1e327e(0xda)](_0x1e327e(0xca),workerData[_0x1e327e(0xe0)]),coverData=_0x472127,returnResult();}):returnResult();}else returnResult();}),_0x345416['on'](_0x39550b(0xf3),()=>{const _0xa918ec=_0x39550b;console[_0xa918ec(0xda)](_0xa918ec(0xcb),_0x2ed597),returnResult();}),_0x345416['parse']();}async function genBookInfoZip(_0x504e63){const _0x47bbe4=_0xc34ce8;zipUtil[_0x47bbe4(0xcd)](_0x504e63)[_0x47bbe4(0xd7)](_0x213a19=>{const _0x5403ec=_0x47bbe4;if(!_0x213a19)return console[_0x5403ec(0xda)](_0x5403ec(0xfa),_0x504e63),returnResult();let _0x4c5dbf=_0x213a19[_0x5403ec(0xff)],_0x507f13=_0x213a19[_0x5403ec(0xf1)];_0x4c5dbf&&(coverData=_0x4c5dbf),_0x507f13&&(workerData[_0x5403ec(0xe4)][_0x5403ec(0xe7)]=_0x507f13),returnResult();})['catch'](_0x9eff8f=>{const _0x12190b=_0x47bbe4;console[_0x12190b(0xda)](_0x9eff8f);});}if(workerData&&workerData[_0xc34ce8(0xe4)]&&workerData['bookCoverCachePath']){let bookFullPath=path[_0xc34ce8(0xfc)](workerData[_0xc34ce8(0xe4)]['path'],workerData[_0xc34ce8(0xe4)][_0xc34ce8(0x104)]),lowerExt=workerData[_0xc34ce8(0xe4)]['ext'][_0xc34ce8(0xe5)]();if(fs[_0xc34ce8(0xfe)](bookFullPath)){if(lowerExt==_0xc34ce8(0xd8))genBookInfoEpub(bookFullPath);else{if(lowerExt=='.mobi'||lowerExt==_0xc34ce8(0xf0)||lowerExt==_0xc34ce8(0xdc))genBookInfoMobi(bookFullPath);else lowerExt==_0xc34ce8(0xe2)||lowerExt=='.zip'||lowerExt==_0xc34ce8(0xef)||lowerExt==_0xc34ce8(0xcf)?genBookInfoZip(bookFullPath):returnResult();}}else returnResult();}else console[_0xc34ce8(0xda)](_0xc34ce8(0xeb)),returnResult();parentPort['on'](_0xc34ce8(0xf3),_0x33d430=>{const _0x179b30=_0xc34ce8;console[_0x179b30(0xf3)]('Worker\x20error:',_0x33d430),returnResult();}),parentPort['on'](_0xc34ce8(0xd5),()=>{const _0x5901b7=_0xc34ce8;console[_0x5901b7(0xda)](_0x5901b7(0xdd));});