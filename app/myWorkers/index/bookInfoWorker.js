const _0x106b72=_0x2bc1;function _0x2930(){const _0x219d1b=['unzlibSync','date','language','.rar','exit','coverPath','getTime','creator','end','getZipCover','364rKjdvF','publisher','postMessage','book-type','total_page','toLowerCase','3570905LLmngK','metadata_state','fileCount','.cbz','4437664rLLvkE','21014848AngyZp','catch','epub','未找到封面','err2','Worker\x20error:','../../utils/zipUtil','21822RyYiYk','.mobi','dealedBuffer','existsSync','2610024UKQPos','没有找到需要处理的书籍目录','indexObj','getImage','ext','bookCoverCachePath','title','type','封面缓存已经存在','parse','.epub','log','close','EPUB写入书籍封面缓存：','816480TtqcTT','error','getCover','./bookMobiNode','epub解析失败','path','./bookFflate','comic','651774XmzINl','metadata','mobi','then','artist','MOBI','MOBI写入书籍封面缓存：','from'];_0x2930=function(){return _0x219d1b;};return _0x2930();}(function(_0x3c5c4f,_0x1d52b8){const _0x2b78c5=_0x2bc1,_0x529dfe=_0x3c5c4f();while(!![]){try{const _0x17f8db=-parseInt(_0x2b78c5(0x19c))/0x1+-parseInt(_0x2b78c5(0x194))/0x2+parseInt(_0x2b78c5(0x182))/0x3*(-parseInt(_0x2b78c5(0x170))/0x4)+-parseInt(_0x2b78c5(0x176))/0x5+-parseInt(_0x2b78c5(0x186))/0x6+parseInt(_0x2b78c5(0x17a))/0x7+parseInt(_0x2b78c5(0x17b))/0x8;if(_0x17f8db===_0x1d52b8)break;else _0x529dfe['push'](_0x529dfe['shift']());}catch(_0x454520){_0x529dfe['push'](_0x529dfe['shift']());}}}(_0x2930,0x5f22b));const {parentPort,workerData}=require('worker_threads'),EPub=require(_0x106b72(0x17d)),mobiNode=require(_0x106b72(0x197)),mobiJs=require(_0x106b72(0x19e)),fflate=require(_0x106b72(0x19a)),fs=require('fs'),path=require(_0x106b72(0x199));let originalTime=null,coverData=null,zipUtil=require(_0x106b72(0x181));function returnResult(){const _0xe591e0=_0x106b72;parentPort[_0xe591e0(0x172)]({'code':0x0,'indexObj':workerData[_0xe591e0(0x188)],'originalTime':originalTime,'coverData':coverData}),process[_0xe591e0(0x16a)](0x0);}async function genBookInfoMobi(_0x217f2a){const _0x5a1d15=_0x106b72;if(!workerData['onlyGenCover'])try{let _0x1d3316=new mobiJs(_0x217f2a);_0x1d3316['title']&&(workerData[_0x5a1d15(0x188)][_0x5a1d15(0x18c)]=_0x1d3316[_0x5a1d15(0x18c)]),workerData[_0x5a1d15(0x188)]['metadata_state']=0x1;}catch(_0x114eb4){}try{if(fs[_0x5a1d15(0x185)](workerData[_0x5a1d15(0x18b)]))return console[_0x5a1d15(0x191)](_0x5a1d15(0x18e),workerData[_0x5a1d15(0x188)]['filename']),workerData[_0x5a1d15(0x188)][_0x5a1d15(0x16b)]=workerData[_0x5a1d15(0x18b)],returnResult();let _0x57ce56=fs['readFileSync'](_0x217f2a),_0x75151d=await new mobiNode[(_0x5a1d15(0x1a1))]({'unzlib':fflate[_0x5a1d15(0x1a4)]})['open'](new Uint8Array(_0x57ce56)),_0x198743=await _0x75151d[_0x5a1d15(0x196)]();if(!_0x198743)return returnResult();return console[_0x5a1d15(0x191)](_0x5a1d15(0x1a2),workerData[_0x5a1d15(0x188)]['filename']),coverData=Buffer[_0x5a1d15(0x1a3)](_0x198743),returnResult();}catch(_0x519658){return console[_0x5a1d15(0x191)](_0x5a1d15(0x17f),_0x519658),returnResult();}}function _0x2bc1(_0x28c9c0,_0xad5220){const _0x2930c7=_0x2930();return _0x2bc1=function(_0x2bc13b,_0x4e0348){_0x2bc13b=_0x2bc13b-0x168;let _0x279acd=_0x2930c7[_0x2bc13b];return _0x279acd;},_0x2bc1(_0x28c9c0,_0xad5220);}async function genBookInfoEpub(_0x40f027){const _0x4579d9=_0x106b72;let _0x22acd7=new EPub(_0x40f027);_0x22acd7['on'](_0x4579d9(0x16e),function(){const _0x42a37a=_0x4579d9;if(_0x22acd7[_0x42a37a(0x19d)]){let _0x17b29e=_0x22acd7['metadata'];_0x17b29e[_0x42a37a(0x16d)]&&(workerData[_0x42a37a(0x188)][_0x42a37a(0x1a0)]=_0x17b29e[_0x42a37a(0x16d)]);_0x17b29e[_0x42a37a(0x171)]&&(workerData[_0x42a37a(0x188)][_0x42a37a(0x171)]=_0x17b29e['publisher']);_0x17b29e[_0x42a37a(0x168)]&&(workerData[_0x42a37a(0x188)][_0x42a37a(0x168)]=_0x17b29e[_0x42a37a(0x168)]);_0x17b29e[_0x42a37a(0x18c)]&&(workerData['indexObj']['title']=_0x17b29e[_0x42a37a(0x18c)]);_0x17b29e[_0x42a37a(0x173)]&&(console[_0x42a37a(0x191)](_0x42a37a(0x173),_0x17b29e['book-type']),_0x17b29e[_0x42a37a(0x173)]==_0x42a37a(0x19b)&&(workerData[_0x42a37a(0x188)][_0x42a37a(0x18d)]=0x2));if(_0x17b29e[_0x42a37a(0x1a5)])try{originalTime=new Date(_0x17b29e['date'])[_0x42a37a(0x16c)]();}catch(_0x5cc346){console[_0x42a37a(0x191)](_0x5cc346);}workerData[_0x42a37a(0x188)][_0x42a37a(0x177)]=0x1;if(fs[_0x42a37a(0x185)](workerData[_0x42a37a(0x18b)]))return console[_0x42a37a(0x191)](_0x42a37a(0x18e),workerData[_0x42a37a(0x188)]['filename']),workerData[_0x42a37a(0x188)][_0x42a37a(0x16b)]=workerData['bookCoverCachePath'],returnResult();_0x22acd7[_0x42a37a(0x19d)]['cover']?_0x22acd7[_0x42a37a(0x189)](_0x22acd7[_0x42a37a(0x19d)]['cover'],async(_0x2b8ed5,_0x30bb70,_0x37e00b)=>{const _0x1996c5=_0x42a37a;return console[_0x1996c5(0x191)](_0x1996c5(0x193),workerData[_0x1996c5(0x18b)]),coverData=_0x30bb70,returnResult();}):returnResult();}else returnResult();}),_0x22acd7['on'](_0x4579d9(0x195),()=>{const _0x5d81f2=_0x4579d9;console[_0x5d81f2(0x191)](_0x5d81f2(0x198),_0x40f027),returnResult();}),_0x22acd7[_0x4579d9(0x18f)]();}async function genBookInfoZip(_0x35a5cb){const _0xf40373=_0x106b72;zipUtil[_0xf40373(0x16f)](_0x35a5cb)[_0xf40373(0x19f)](_0x5ac251=>{const _0x1e011b=_0xf40373;if(!_0x5ac251)return console[_0x1e011b(0x191)](_0x1e011b(0x17e),_0x35a5cb),returnResult();let _0x51d2aa=_0x5ac251[_0x1e011b(0x184)],_0xbaa8a2=_0x5ac251[_0x1e011b(0x178)];_0x51d2aa&&(coverData=_0x51d2aa),_0xbaa8a2&&(workerData[_0x1e011b(0x188)][_0x1e011b(0x174)]=_0xbaa8a2),returnResult();})[_0xf40373(0x17c)](_0x891bee=>{const _0x14139f=_0xf40373;console[_0x14139f(0x191)](_0x891bee);});}if(workerData&&workerData[_0x106b72(0x188)]&&workerData[_0x106b72(0x18b)]){let bookFullPath=path['join'](workerData[_0x106b72(0x188)][_0x106b72(0x199)],workerData['indexObj']['filename']),lowerExt=workerData[_0x106b72(0x188)][_0x106b72(0x18a)][_0x106b72(0x175)]();if(fs[_0x106b72(0x185)](bookFullPath)){if(lowerExt==_0x106b72(0x190))genBookInfoEpub(bookFullPath);else{if(lowerExt==_0x106b72(0x183)||lowerExt=='.azw3'||lowerExt=='.azw')genBookInfoMobi(bookFullPath);else lowerExt==_0x106b72(0x179)||lowerExt=='.zip'||lowerExt=='.cbr'||lowerExt==_0x106b72(0x169)?genBookInfoZip(bookFullPath):returnResult();}}else returnResult();}else console['log'](_0x106b72(0x187)),returnResult();parentPort['on'](_0x106b72(0x195),_0x4349e0=>{const _0x16b239=_0x106b72;console[_0x16b239(0x195)](_0x16b239(0x180),_0x4349e0),returnResult();}),parentPort['on'](_0x106b72(0x192),()=>{const _0x1826c1=_0x106b72;console[_0x1826c1(0x191)]('Worker\x20stopped.');});