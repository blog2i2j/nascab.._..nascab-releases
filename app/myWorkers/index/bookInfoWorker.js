const _0x28e93b=_0x43f9;(function(_0x4d3470,_0x578235){const _0x4201f6=_0x43f9,_0x57cd98=_0x4d3470();while(!![]){try{const _0xdb16c5=parseInt(_0x4201f6(0x18e))/0x1+parseInt(_0x4201f6(0x18c))/0x2+parseInt(_0x4201f6(0x1ba))/0x3*(-parseInt(_0x4201f6(0x19e))/0x4)+-parseInt(_0x4201f6(0x1a2))/0x5+parseInt(_0x4201f6(0x1a4))/0x6+-parseInt(_0x4201f6(0x1c9))/0x7*(parseInt(_0x4201f6(0x1b6))/0x8)+-parseInt(_0x4201f6(0x1b1))/0x9*(-parseInt(_0x4201f6(0x1bb))/0xa);if(_0xdb16c5===_0x578235)break;else _0x57cd98['push'](_0x57cd98['shift']());}catch(_0x542e77){_0x57cd98['push'](_0x57cd98['shift']());}}}(_0x4c16,0xde1a3));const {parentPort,workerData}=require(_0x28e93b(0x197)),EPub=require('epub'),mobiNode=require('./bookMobiNode'),mobiJs=require(_0x28e93b(0x1c1)),fflate=require(_0x28e93b(0x18f)),fs=require('fs'),path=require(_0x28e93b(0x1af));let originalTime=null,coverData=null,zipUtil=require(_0x28e93b(0x1aa));function returnResult(){const _0x10403b=_0x28e93b;parentPort['postMessage']({'code':0x0,'indexObj':workerData[_0x10403b(0x198)],'originalTime':originalTime,'coverData':coverData}),process[_0x10403b(0x1b2)](0x0);}function _0x43f9(_0x55e804,_0xb620c4){const _0x4c168c=_0x4c16();return _0x43f9=function(_0x43f969,_0x44de76){_0x43f969=_0x43f969-0x189;let _0x257fbe=_0x4c168c[_0x43f969];return _0x257fbe;},_0x43f9(_0x55e804,_0xb620c4);}async function genBookInfoMobi(_0x182e57){const _0x3dc0a0=_0x28e93b;if(!workerData[_0x3dc0a0(0x1b8)])try{let _0x5b7413=new mobiJs(_0x182e57);_0x5b7413[_0x3dc0a0(0x1c4)]&&(workerData['indexObj']['title']=_0x5b7413[_0x3dc0a0(0x1c4)]),workerData[_0x3dc0a0(0x198)][_0x3dc0a0(0x1a1)]=0x1;}catch(_0xa66ce4){}try{if(fs[_0x3dc0a0(0x1a7)](workerData['bookCoverCachePath']))return console[_0x3dc0a0(0x192)](_0x3dc0a0(0x1c5),workerData[_0x3dc0a0(0x198)][_0x3dc0a0(0x1a5)]),workerData[_0x3dc0a0(0x198)][_0x3dc0a0(0x18a)]=workerData[_0x3dc0a0(0x19b)],returnResult();let _0x568db5=fs[_0x3dc0a0(0x190)](_0x182e57),_0x1d185c=await new mobiNode[(_0x3dc0a0(0x191))]({'unzlib':fflate[_0x3dc0a0(0x19c)]})[_0x3dc0a0(0x1c3)](new Uint8Array(_0x568db5)),_0x3d00ea=await _0x1d185c[_0x3dc0a0(0x1c0)]();if(!_0x3d00ea)return returnResult();return console[_0x3dc0a0(0x192)](_0x3dc0a0(0x18b),workerData['indexObj'][_0x3dc0a0(0x1a5)]),coverData=Buffer[_0x3dc0a0(0x1be)](_0x3d00ea),returnResult();}catch(_0x5f4dcf){return console[_0x3dc0a0(0x192)](_0x3dc0a0(0x1bc),_0x5f4dcf),returnResult();}}async function genBookInfoEpub(_0x261e03){const _0x348fe1=_0x28e93b;let _0xe710c2=new EPub(_0x261e03);_0xe710c2['on'](_0x348fe1(0x1a9),function(){const _0x178434=_0x348fe1;if(_0xe710c2[_0x178434(0x1bd)]){let _0x528674=_0xe710c2[_0x178434(0x1bd)];_0x528674['creator']&&(workerData['indexObj'][_0x178434(0x19a)]=_0x528674['creator']);_0x528674[_0x178434(0x1a0)]&&(workerData[_0x178434(0x198)][_0x178434(0x1a0)]=_0x528674[_0x178434(0x1a0)]);_0x528674[_0x178434(0x1b4)]&&(workerData[_0x178434(0x198)][_0x178434(0x1b4)]=_0x528674[_0x178434(0x1b4)]);_0x528674[_0x178434(0x1c4)]&&(workerData[_0x178434(0x198)][_0x178434(0x1c4)]=_0x528674[_0x178434(0x1c4)]);_0x528674['book-type']&&(console[_0x178434(0x192)]('book-type',_0x528674[_0x178434(0x1b3)]),_0x528674['book-type']==_0x178434(0x18d)&&(workerData['indexObj'][_0x178434(0x194)]=0x2));if(_0x528674[_0x178434(0x19d)])try{originalTime=new Date(_0x528674[_0x178434(0x19d)])['getTime']();}catch(_0x3396d2){console[_0x178434(0x192)](_0x3396d2);}workerData['indexObj']['metadata_state']=0x1;if(fs[_0x178434(0x1a7)](workerData[_0x178434(0x19b)]))return console[_0x178434(0x192)](_0x178434(0x1c5),workerData[_0x178434(0x198)][_0x178434(0x1a5)]),workerData[_0x178434(0x198)][_0x178434(0x18a)]=workerData['bookCoverCachePath'],returnResult();_0xe710c2['metadata'][_0x178434(0x1c7)]?_0xe710c2[_0x178434(0x195)](_0xe710c2['metadata'][_0x178434(0x1c7)],async(_0x88a174,_0x3d1861,_0xf8e5ef)=>{const _0x5d5e06=_0x178434;return console[_0x5d5e06(0x192)](_0x5d5e06(0x1ad),workerData[_0x5d5e06(0x19b)]),coverData=_0x3d1861,returnResult();}):returnResult();}else returnResult();}),_0xe710c2['on'](_0x348fe1(0x196),()=>{const _0x318fa3=_0x348fe1;console[_0x318fa3(0x192)](_0x318fa3(0x1ab),_0x261e03),returnResult();}),_0xe710c2[_0x348fe1(0x1b0)]();}async function genBookInfoZip(_0x19e8f3){const _0x536e0b=_0x28e93b;zipUtil[_0x536e0b(0x1bf)](_0x19e8f3)['then'](_0xb24653=>{const _0x253a4b=_0x536e0b;if(!_0xb24653)return console[_0x253a4b(0x192)](_0x253a4b(0x19f),_0x19e8f3),returnResult();let _0x24201d=_0xb24653[_0x253a4b(0x189)],_0x28ed21=_0xb24653[_0x253a4b(0x199)];_0x24201d&&(coverData=_0x24201d),_0x28ed21&&(workerData[_0x253a4b(0x198)][_0x253a4b(0x1a6)]=_0x28ed21),returnResult();})[_0x536e0b(0x1a3)](_0x550ae8=>{console['log'](_0x550ae8);});}if(workerData&&workerData[_0x28e93b(0x198)]&&workerData[_0x28e93b(0x19b)]){let bookFullPath=path['join'](workerData['indexObj']['path'],workerData['indexObj'][_0x28e93b(0x1a5)]),lowerExt=workerData['indexObj'][_0x28e93b(0x1b9)]['toLowerCase']();if(fs[_0x28e93b(0x1a7)](bookFullPath)){if(lowerExt=='.epub')genBookInfoEpub(bookFullPath);else{if(lowerExt==_0x28e93b(0x1c6)||lowerExt==_0x28e93b(0x1a8)||lowerExt==_0x28e93b(0x1b5))genBookInfoMobi(bookFullPath);else lowerExt==_0x28e93b(0x193)||lowerExt==_0x28e93b(0x1c2)||lowerExt==_0x28e93b(0x1c8)||lowerExt==_0x28e93b(0x1b7)?genBookInfoZip(bookFullPath):returnResult();}}else returnResult();}else console[_0x28e93b(0x192)](_0x28e93b(0x1ac)),returnResult();parentPort['on'](_0x28e93b(0x196),_0x3a8a09=>{const _0x55d49f=_0x28e93b;console[_0x55d49f(0x196)]('Worker\x20error:',_0x3a8a09),returnResult();}),parentPort['on']('close',()=>{const _0x1c95b6=_0x28e93b;console[_0x1c95b6(0x192)](_0x1c95b6(0x1ae));});function _0x4c16(){const _0x38bd17=['coverPath','MOBI写入书籍封面缓存：','393372AJSJdJ','comic','635779SmMdJT','./bookFflate','readFileSync','MOBI','log','.cbz','type','getImage','error','worker_threads','indexObj','fileCount','artist','bookCoverCachePath','unzlibSync','date','12UzavZf','未找到封面','publisher','metadata_state','4594250sMGvyq','catch','6635628BtRGLS','filename','total_page','existsSync','.azw3','end','../../utils/zipUtil','epub解析失败','没有找到需要处理的书籍目录','EPUB写入书籍封面缓存：','Worker\x20stopped.','path','parse','2034kwQjEB','exit','book-type','language','.azw','390256rfrdjK','.rar','onlyGenCover','ext','1281534pgrUHz','131710yZKzNx','err2','metadata','from','getZipCover','getCover','mobi','.zip','open','title','封面缓存已经存在','.mobi','cover','.cbr','259hrCMpK','dealedBuffer'];_0x4c16=function(){return _0x38bd17;};return _0x4c16();}