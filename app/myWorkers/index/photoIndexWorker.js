const _0x9b8288=_0x28aa;(function(_0x5a20ab,_0x4e8185){const _0x57cc34=_0x28aa,_0x4a6f25=_0x5a20ab();while(!![]){try{const _0x16235d=parseInt(_0x57cc34(0x17c))/0x1+-parseInt(_0x57cc34(0x172))/0x2*(-parseInt(_0x57cc34(0x174))/0x3)+-parseInt(_0x57cc34(0x188))/0x4+-parseInt(_0x57cc34(0x165))/0x5+parseInt(_0x57cc34(0x169))/0x6+parseInt(_0x57cc34(0x168))/0x7+parseInt(_0x57cc34(0x173))/0x8;if(_0x16235d===_0x4e8185)break;else _0x4a6f25['push'](_0x4a6f25['shift']());}catch(_0x628b66){_0x4a6f25['push'](_0x4a6f25['shift']());}}}(_0x35d1,0x26ae2));const fs=require('fs'),config=require(_0x9b8288(0x171)),Database=require(_0x9b8288(0x167)),dbOther=new Database(config[_0x9b8288(0x17f)],{}),dbFileIndex=new Database(config['dbFileIndex'],{});dbFileIndex[_0x9b8288(0x16c)](_0x9b8288(0x179)),dbOther[_0x9b8288(0x16c)](_0x9b8288(0x179));const dbFileIndexTable=require(_0x9b8288(0x183));process[_0x9b8288(0x175)]=_0x9b8288(0x184);const photoIndexUtil=require(_0x9b8288(0x187)),indexTableName=dbFileIndexTable[_0x9b8288(0x185)],dbScanTaskTable=require('../../db/dbScanTaskTable'),indexUtil=require(_0x9b8288(0x181)),dbSourceFolderTable=require(_0x9b8288(0x178));function _0x28aa(_0x407f9d,_0x38e27e){const _0x35d123=_0x35d1();return _0x28aa=function(_0x28aa83,_0x1474f3){_0x28aa83=_0x28aa83-0x162;let _0x14d7d9=_0x35d123[_0x28aa83];return _0x14d7d9;},_0x28aa(_0x407f9d,_0x38e27e);}async function startIndexingFolder(_0x143b29){return new Promise(async(_0x4e1579,_0x5609bb)=>{const _0x30f6db=_0x28aa;try{let _0x42cdbb=new Date()[_0x30f6db(0x17d)](),_0x1fa8d7=fs[_0x30f6db(0x16b)](_0x143b29);if(!_0x1fa8d7[_0x30f6db(0x16f)]())return console[_0x30f6db(0x162)](_0x30f6db(0x166),_0x143b29),_0x4e1579();console[_0x30f6db(0x162)](_0x30f6db(0x17e),_0x143b29),await indexUtil[_0x30f6db(0x164)](dbFileIndex,indexTableName,_0x143b29);let {checkFileCount:_0x5e0b43,checkPathCount:_0x11cfe9}=await photoIndexUtil[_0x30f6db(0x17b)](dbOther,dbFileIndex,_0x143b29);console[_0x30f6db(0x162)](_0x30f6db(0x176)+_0x143b29,_0x30f6db(0x16a),new Date()[_0x30f6db(0x17d)]()-_0x42cdbb,'ms',_0x30f6db(0x163),_0x11cfe9,_0x30f6db(0x170),_0x5e0b43),process[_0x30f6db(0x16e)]({'type':_0x30f6db(0x16d)}),_0x4e1579();}catch(_0x59f25c){console[_0x30f6db(0x162)](_0x30f6db(0x186),_0x143b29),_0x4e1579();}});}function runScanTask(){const _0xf2c3be=_0x9b8288;let _0x466b2c=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable['SCAN_TYPE_PHOTO']);_0x466b2c?(dbOther[_0xf2c3be(0x177)]('UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27')['run'](Date['now'](),_0x466b2c[_0xf2c3be(0x17a)]),startIndexingFolder(_0x466b2c[_0xf2c3be(0x17a)])[_0xf2c3be(0x182)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x466b2c['id']),runScanTask();})):(console[_0xf2c3be(0x162)](_0xf2c3be(0x189)),indexUtil[_0xf2c3be(0x180)](dbOther,indexTableName,![]),process['exit']());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();function _0x35d1(){const _0x19c8d3=['耗时:','statSync','pragma','NEW_PHOTO_INDEX','send','isDirectory','文件数量','../../myConfig/config','30146NuNkBe','1762208HMjvsD','21zqihJy','title','照片管理：扫描完成：','prepare','../../db/dbSourceFolderTable','journal_mode\x20=\x20WAL','scan_path','recursionFilesAddIndex','246203DlqPgJ','getTime','照片管理:\x20开始扫描','dbOther','setIndexingState','./indexUtil','then','../../db/dbFileIndexTable','NasCabPhotoIndexWorker','INDEX_TABLE_NAME_PHOTO','扫描目录已不存在\x20','./photoIndexUtil','1094656TlkYVd','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','log','文件夹数量','recursionDeleteIndex','1364775CisWTX','要扫描的目录不是文件夹','better-sqlite3','408114ORtwdZ','448566YluBup'];_0x35d1=function(){return _0x19c8d3;};return _0x35d1();}