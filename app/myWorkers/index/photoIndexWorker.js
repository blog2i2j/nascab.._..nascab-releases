function _0x5e63(_0x43359f,_0x28d563){const _0xcbf586=_0xcbf5();return _0x5e63=function(_0x5e63fc,_0x61daf1){_0x5e63fc=_0x5e63fc-0xa6;let _0x37508a=_0xcbf586[_0x5e63fc];return _0x37508a;},_0x5e63(_0x43359f,_0x28d563);}const _0x6c2a3c=_0x5e63;function _0xcbf5(){const _0x2c4225=['log','statSync','exit','then','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','getTime','pragma','照片管理:\x20开始扫描','setIndexingState','NasCabPhotoIndexWorker','prepare','7708181nWYuBd','照片管理：扫描完成：','better-sqlite3','../../db/dbScanTaskTable','48fKOLaL','49964speSyD','281FjYtnB','183OtrfAo','recursionFilesAddIndex','NEW_PHOTO_INDEX','journal_mode\x20=\x20WAL','10vHZCbc','recursionDeleteIndex','扫描目录已不存在\x20','要扫描的目录不是文件夹','1716995zetjPw','40UrBRHO','9208078FvBpzK','耗时:','send','594lbyMgi','SCAN_TYPE_PHOTO','isDirectory','../../myConfig/config','8342LCebyM','74590TtzzXL','scan_path','1035711AyAaKN','run'];_0xcbf5=function(){return _0x2c4225;};return _0xcbf5();}(function(_0x2c2a5c,_0x43a1bb){const _0x51a887=_0x5e63,_0x184ccd=_0x2c2a5c();while(!![]){try{const _0x1c0619=parseInt(_0x51a887(0xa6))/0x1*(-parseInt(_0x51a887(0xb8))/0x2)+parseInt(_0x51a887(0xa7))/0x3*(parseInt(_0x51a887(0xcd))/0x4)+parseInt(_0x51a887(0xb9))/0x5*(-parseInt(_0x51a887(0xb4))/0x6)+parseInt(_0x51a887(0xaf))/0x7*(parseInt(_0x51a887(0xb0))/0x8)+parseInt(_0x51a887(0xbb))/0x9*(parseInt(_0x51a887(0xab))/0xa)+-parseInt(_0x51a887(0xb1))/0xb+parseInt(_0x51a887(0xcc))/0xc*(parseInt(_0x51a887(0xc8))/0xd);if(_0x1c0619===_0x43a1bb)break;else _0x184ccd['push'](_0x184ccd['shift']());}catch(_0x3fc5fb){_0x184ccd['push'](_0x184ccd['shift']());}}}(_0xcbf5,0xf17f4));const fs=require('fs'),config=require(_0x6c2a3c(0xb7)),Database=require(_0x6c2a3c(0xca)),dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config['dbFileIndex'],{});dbFileIndex['pragma']('journal_mode\x20=\x20WAL'),dbOther[_0x6c2a3c(0xc3)](_0x6c2a3c(0xaa));const dbFileIndexTable=require('../../db/dbFileIndexTable');process['title']=_0x6c2a3c(0xc6);const photoIndexUtil=require('./photoIndexUtil'),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_PHOTO'],dbScanTaskTable=require(_0x6c2a3c(0xcb)),indexUtil=require('./indexUtil'),dbSourceFolderTable=require('../../db/dbSourceFolderTable');async function startIndexingFolder(_0x359df4){return new Promise(async(_0x6dbb75,_0x1eaa37)=>{const _0x3a604d=_0x5e63;try{let _0x2af033=new Date()['getTime'](),_0x2ab449=fs[_0x3a604d(0xbe)](_0x359df4);if(!_0x2ab449[_0x3a604d(0xb6)]())return console[_0x3a604d(0xbd)](_0x3a604d(0xae),_0x359df4),_0x6dbb75();console[_0x3a604d(0xbd)](_0x3a604d(0xc4),_0x359df4),await indexUtil[_0x3a604d(0xac)](dbFileIndex,indexTableName,_0x359df4);let {checkFileCount:_0x2ada2a,checkPathCount:_0x39a5c4}=await photoIndexUtil[_0x3a604d(0xa8)](dbOther,dbFileIndex,_0x359df4);console[_0x3a604d(0xbd)](_0x3a604d(0xc9)+_0x359df4,_0x3a604d(0xb2),new Date()[_0x3a604d(0xc2)]()-_0x2af033,'ms','文件夹数量',_0x39a5c4,'文件数量',_0x2ada2a),process[_0x3a604d(0xb3)]({'type':_0x3a604d(0xa9)}),_0x6dbb75();}catch(_0x2fe190){console[_0x3a604d(0xbd)](_0x3a604d(0xad),_0x359df4),_0x6dbb75();}});}function runScanTask(){const _0x6e9e17=_0x6c2a3c;let _0x33c701=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x6e9e17(0xb5)]);_0x33c701?(dbOther[_0x6e9e17(0xc7)]('UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27')[_0x6e9e17(0xbc)](Date['now'](),_0x33c701['scan_path']),startIndexingFolder(_0x33c701[_0x6e9e17(0xba)])[_0x6e9e17(0xc0)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x33c701['id']),runScanTask();})):(console[_0x6e9e17(0xbd)](_0x6e9e17(0xc1)),indexUtil[_0x6e9e17(0xc5)](dbOther,indexTableName,![]),process[_0x6e9e17(0xbf)]());}indexUtil[_0x6c2a3c(0xc5)](dbOther,indexTableName,!![]),runScanTask();