const _0x16d966=_0x242f;(function(_0x3afb3e,_0x20129f){const _0x41bd37=_0x242f,_0x8daf0b=_0x3afb3e();while(!![]){try{const _0x28bce1=-parseInt(_0x41bd37(0xeb))/0x1+parseInt(_0x41bd37(0x108))/0x2+parseInt(_0x41bd37(0xff))/0x3*(-parseInt(_0x41bd37(0xf7))/0x4)+-parseInt(_0x41bd37(0xf4))/0x5*(-parseInt(_0x41bd37(0x106))/0x6)+-parseInt(_0x41bd37(0xf6))/0x7+parseInt(_0x41bd37(0x112))/0x8*(parseInt(_0x41bd37(0xfa))/0x9)+-parseInt(_0x41bd37(0x10b))/0xa*(parseInt(_0x41bd37(0x100))/0xb);if(_0x28bce1===_0x20129f)break;else _0x8daf0b['push'](_0x8daf0b['shift']());}catch(_0x48d2fc){_0x8daf0b['push'](_0x8daf0b['shift']());}}}(_0x2bd3,0xbb22f));const fs=require('fs'),config=require(_0x16d966(0x115)),Database=require(_0x16d966(0xec)),dbOther=new Database(config[_0x16d966(0xed)],{}),dbFileIndex=new Database(config[_0x16d966(0x101)],{});function _0x242f(_0x4e9b8c,_0x330c25){const _0x2bd30c=_0x2bd3();return _0x242f=function(_0x242f4e,_0x4194ac){_0x242f4e=_0x242f4e-0xe9;let _0x1b8461=_0x2bd30c[_0x242f4e];return _0x1b8461;},_0x242f(_0x4e9b8c,_0x330c25);}dbFileIndex['pragma']('journal_mode\x20=\x20WAL'),dbOther[_0x16d966(0xf5)](_0x16d966(0x10d));const dbFileIndexTable=require('../../db/dbFileIndexTable');function _0x2bd3(){const _0x320b4d=['耗时:','scan_path','statSync','3847398rgxnaa','NEW_PHOTO_INDEX','2426760hdIqGR','照片管理：扫描完成：','文件数量','10EajgrB','文件夹数量','journal_mode\x20=\x20WAL','recursionFilesAddIndex','setIndexingState','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','title','2223272IYqBgG','deleteTask','要扫描的目录不是文件夹','../../myConfig/config','照片管理:\x20开始扫描','log','253511OfvGdH','better-sqlite3','dbOther','SCAN_TYPE_PHOTO','prepare','NasCabPhotoIndexWorker','then','send','INDEX_TABLE_NAME_PHOTO','5IUVBWD','pragma','6116082UjwZIE','23524hGqaiy','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','isDirectory','45xuoFHn','../../db/dbScanTaskTable','recursionDeleteIndex','getTime','../../db/dbSourceFolderTable','51BGUapl','13754763cftpyB','dbFileIndex','扫描目录已不存在\x20'];_0x2bd3=function(){return _0x320b4d;};return _0x2bd3();}process[_0x16d966(0x111)]=_0x16d966(0xf0);const photoIndexUtil=require('./photoIndexUtil'),indexTableName=dbFileIndexTable[_0x16d966(0xf3)],dbScanTaskTable=require(_0x16d966(0xfb)),indexUtil=require('./indexUtil'),dbSourceFolderTable=require(_0x16d966(0xfe));async function startIndexingFolder(_0x2d6a4e){return new Promise(async(_0x1768b7,_0x4e536c)=>{const _0x54930e=_0x242f;try{let _0x2efb00=new Date()[_0x54930e(0xfd)](),_0x31190d=fs[_0x54930e(0x105)](_0x2d6a4e);if(!_0x31190d[_0x54930e(0xf9)]())return console[_0x54930e(0xea)](_0x54930e(0x114),_0x2d6a4e),_0x1768b7();console['log'](_0x54930e(0xe9),_0x2d6a4e),await indexUtil[_0x54930e(0xfc)](dbFileIndex,indexTableName,_0x2d6a4e);let {checkFileCount:_0x50e091,checkPathCount:_0x326756}=await photoIndexUtil[_0x54930e(0x10e)](dbOther,dbFileIndex,_0x2d6a4e);console[_0x54930e(0xea)](_0x54930e(0x109)+_0x2d6a4e,_0x54930e(0x103),new Date()[_0x54930e(0xfd)]()-_0x2efb00,'ms',_0x54930e(0x10c),_0x326756,_0x54930e(0x10a),_0x50e091),process[_0x54930e(0xf2)]({'type':_0x54930e(0x107)}),_0x1768b7();}catch(_0x176a9f){console[_0x54930e(0xea)](_0x54930e(0x102),_0x2d6a4e),_0x1768b7();}});}function runScanTask(){const _0x497489=_0x16d966;let _0x2c97cb=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x497489(0xee)]);_0x2c97cb?(dbOther[_0x497489(0xef)](_0x497489(0xf8))['run'](Date['now'](),_0x2c97cb['scan_path']),startIndexingFolder(_0x2c97cb[_0x497489(0x104)])[_0x497489(0xf1)](()=>{const _0x1aa3ea=_0x497489;dbScanTaskTable[_0x1aa3ea(0x113)](dbOther,_0x2c97cb['id']),runScanTask();})):(console['log'](_0x497489(0x110)),indexUtil[_0x497489(0x10f)](dbOther,indexTableName,![]),process['exit']());}indexUtil[_0x16d966(0x10f)](dbOther,indexTableName,!![]),runScanTask();