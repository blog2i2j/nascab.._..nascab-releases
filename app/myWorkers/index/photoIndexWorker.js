const _0x19e14e=_0x56f0;function _0x2ec1(){const _0x2660a5=['exit','518AhfieQ','照片管理:\x20开始扫描','run','pragma','118304IxLoGD','scan_path','NasCabPhotoIndexWorker','17266550nnymjM','305393lqBhiA','文件夹数量','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','2483860vzffRR','statSync','3096qHYXBz','now','better-sqlite3','send','21wtjgPj','394195MgzhZC','isDirectory','9SRZvch','getTime','../../myConfig/config','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','dbFileIndex','../../db/dbSourceFolderTable','照片管理：扫描完成：','./photoIndexUtil','扫描目录已不存在\x20','../../db/dbScanTaskTable','then','4700LMRhUo','setIndexingState','耗时:','598112NtOqvl','getOnTask','INDEX_TABLE_NAME_PHOTO','./indexUtil','title','log','prepare','9366WnDGxG','dbOther','../../db/dbFileIndexTable'];_0x2ec1=function(){return _0x2660a5;};return _0x2ec1();}(function(_0x3c4174,_0x20888c){const _0x55dbf7=_0x56f0,_0x6b6807=_0x3c4174();while(!![]){try{const _0x3ed094=parseInt(_0x55dbf7(0x19f))/0x1+-parseInt(_0x55dbf7(0x198))/0x2+parseInt(_0x55dbf7(0x19e))/0x3*(-parseInt(_0x55dbf7(0x1af))/0x4)+-parseInt(_0x55dbf7(0x1ac))/0x5*(parseInt(_0x55dbf7(0x1b6))/0x6)+-parseInt(_0x55dbf7(0x1ba))/0x7*(parseInt(_0x55dbf7(0x191))/0x8)+parseInt(_0x55dbf7(0x1a1))/0x9*(-parseInt(_0x55dbf7(0x194))/0xa)+-parseInt(_0x55dbf7(0x195))/0xb*(-parseInt(_0x55dbf7(0x19a))/0xc);if(_0x3ed094===_0x20888c)break;else _0x6b6807['push'](_0x6b6807['shift']());}catch(_0x589605){_0x6b6807['push'](_0x6b6807['shift']());}}}(_0x2ec1,0xef494));const fs=require('fs'),config=require(_0x19e14e(0x1a3)),Database=require(_0x19e14e(0x19c)),dbOther=new Database(config[_0x19e14e(0x1b7)],{}),dbFileIndex=new Database(config[_0x19e14e(0x1a5)],{});dbFileIndex['pragma']('journal_mode\x20=\x20WAL'),dbOther[_0x19e14e(0x190)]('journal_mode\x20=\x20WAL');const dbFileIndexTable=require(_0x19e14e(0x1b8));process[_0x19e14e(0x1b3)]=_0x19e14e(0x193);function _0x56f0(_0x8104bd,_0x3ac018){const _0x2ec1a1=_0x2ec1();return _0x56f0=function(_0x56f0e8,_0x567a62){_0x56f0e8=_0x56f0e8-0x18f;let _0x25f634=_0x2ec1a1[_0x56f0e8];return _0x25f634;},_0x56f0(_0x8104bd,_0x3ac018);}const photoIndexUtil=require(_0x19e14e(0x1a8)),indexTableName=dbFileIndexTable[_0x19e14e(0x1b1)],dbScanTaskTable=require(_0x19e14e(0x1aa)),indexUtil=require(_0x19e14e(0x1b2)),dbSourceFolderTable=require(_0x19e14e(0x1a6));async function startIndexingFolder(_0x24f621){return new Promise(async(_0x2806c4,_0x55a00d)=>{const _0x116a8f=_0x56f0;try{let _0x497927=new Date()[_0x116a8f(0x1a2)](),_0x1e6bb3=fs[_0x116a8f(0x199)](_0x24f621);if(!_0x1e6bb3[_0x116a8f(0x1a0)]())return console[_0x116a8f(0x1b4)]('要扫描的目录不是文件夹',_0x24f621),_0x2806c4();console['log'](_0x116a8f(0x1bb),_0x24f621),await indexUtil['recursionDeleteIndex'](dbFileIndex,indexTableName,_0x24f621);let {checkFileCount:_0x489f71,checkPathCount:_0x554135}=await photoIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x24f621);console[_0x116a8f(0x1b4)](_0x116a8f(0x1a7)+_0x24f621,_0x116a8f(0x1ae),new Date()['getTime']()-_0x497927,'ms',_0x116a8f(0x196),_0x554135,'文件数量',_0x489f71),process[_0x116a8f(0x19d)]({'type':'NEW_PHOTO_INDEX'}),_0x2806c4();}catch(_0x4c45dd){console[_0x116a8f(0x1b4)](_0x116a8f(0x1a9),_0x24f621),_0x2806c4();}});}function runScanTask(){const _0x3024f8=_0x19e14e;let _0x541eda=dbScanTaskTable[_0x3024f8(0x1b0)](dbOther,dbScanTaskTable['SCAN_TYPE_PHOTO']);_0x541eda?(dbOther[_0x3024f8(0x1b5)](_0x3024f8(0x197))[_0x3024f8(0x18f)](Date[_0x3024f8(0x19b)](),_0x541eda[_0x3024f8(0x192)]),startIndexingFolder(_0x541eda[_0x3024f8(0x192)])[_0x3024f8(0x1ab)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x541eda['id']),runScanTask();})):(console[_0x3024f8(0x1b4)](_0x3024f8(0x1a4)),indexUtil[_0x3024f8(0x1ad)](dbOther,indexTableName,![]),process[_0x3024f8(0x1b9)]());}indexUtil[_0x19e14e(0x1ad)](dbOther,indexTableName,!![]),runScanTask();