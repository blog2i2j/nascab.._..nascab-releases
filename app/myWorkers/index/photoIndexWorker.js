const _0x2c73ed=_0xe023;(function(_0x2b0a9a,_0x45bbb7){const _0x390738=_0xe023,_0x2dcae5=_0x2b0a9a();while(!![]){try{const _0x582036=-parseInt(_0x390738(0x13d))/0x1+-parseInt(_0x390738(0x124))/0x2*(parseInt(_0x390738(0x133))/0x3)+parseInt(_0x390738(0x128))/0x4+parseInt(_0x390738(0x12d))/0x5+-parseInt(_0x390738(0x136))/0x6+parseInt(_0x390738(0x12a))/0x7+parseInt(_0x390738(0x126))/0x8;if(_0x582036===_0x45bbb7)break;else _0x2dcae5['push'](_0x2dcae5['shift']());}catch(_0xed2f74){_0x2dcae5['push'](_0x2dcae5['shift']());}}}(_0x26c5,0x22493));const fs=require('fs'),config=require(_0x2c73ed(0x11b)),Database=require(_0x2c73ed(0x131)),dbOther=new Database(config[_0x2c73ed(0x135)],{}),dbFileIndex=new Database(config[_0x2c73ed(0x122)],{});function _0xe023(_0x3b9aff,_0x4ccfff){const _0x26c5c2=_0x26c5();return _0xe023=function(_0xe0232c,_0xd9cc4){_0xe0232c=_0xe0232c-0x117;let _0x405cb4=_0x26c5c2[_0xe0232c];return _0x405cb4;},_0xe023(_0x3b9aff,_0x4ccfff);}dbFileIndex[_0x2c73ed(0x119)](_0x2c73ed(0x120)),dbOther['pragma']('journal_mode\x20=\x20WAL');const dbFileIndexTable=require(_0x2c73ed(0x129));process[_0x2c73ed(0x137)]=_0x2c73ed(0x13b);const photoIndexUtil=require(_0x2c73ed(0x13c)),indexTableName=dbFileIndexTable[_0x2c73ed(0x121)],dbScanTaskTable=require(_0x2c73ed(0x123)),indexUtil=require(_0x2c73ed(0x130)),dbSourceFolderTable=require('../../db/dbSourceFolderTable');async function startIndexingFolder(_0x39598b){return new Promise(async(_0x2fa57f,_0x383ac8)=>{const _0x25299d=_0xe023;try{let _0xb5c2a2=new Date()[_0x25299d(0x11c)](),_0x32dfb9=fs[_0x25299d(0x132)](_0x39598b);if(!_0x32dfb9[_0x25299d(0x117)]())return console[_0x25299d(0x138)]('要扫描的目录不是文件夹',_0x39598b),_0x2fa57f();console['log'](_0x25299d(0x118),_0x39598b),await indexUtil['recursionDeleteIndex'](dbFileIndex,indexTableName,_0x39598b);let {checkFileCount:_0x257cc4,checkPathCount:_0xc83f84}=await photoIndexUtil[_0x25299d(0x127)](dbOther,dbFileIndex,_0x39598b);console[_0x25299d(0x138)](_0x25299d(0x12c)+_0x39598b,'耗时:',new Date()[_0x25299d(0x11c)]()-_0xb5c2a2,'ms',_0x25299d(0x12b),_0xc83f84,_0x25299d(0x12f),_0x257cc4),process[_0x25299d(0x11e)]({'type':_0x25299d(0x134)}),_0x2fa57f();}catch(_0x495206){console['log'](_0x25299d(0x13a),_0x39598b),_0x2fa57f();}});}function runScanTask(){const _0x490f81=_0x2c73ed;let _0x4152cf=dbScanTaskTable[_0x490f81(0x139)](dbOther,dbScanTaskTable['SCAN_TYPE_PHOTO']);_0x4152cf?(dbOther['prepare'](_0x490f81(0x11f))['run'](Date['now'](),_0x4152cf[_0x490f81(0x12e)]),startIndexingFolder(_0x4152cf[_0x490f81(0x12e)])[_0x490f81(0x11d)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x4152cf['id']),runScanTask();})):(console['log'](_0x490f81(0x11a)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process['exit']());}function _0x26c5(){const _0x25e353=['isDirectory','照片管理:\x20开始扫描','pragma','照片管理:未找到扫描任务[Photos\x20scanning\x20task\x20not\x20found]','../../myConfig/config','getTime','then','send','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27photo\x27','journal_mode\x20=\x20WAL','INDEX_TABLE_NAME_PHOTO','dbFileIndex','../../db/dbScanTaskTable','11014aesCLj','setIndexingState','2143256fuHNig','recursionFilesAddIndex','227344XHWsBH','../../db/dbFileIndexTable','655662enUiLv','文件夹数量','照片管理：扫描完成：','254620zwdwZH','scan_path','文件数量','./indexUtil','better-sqlite3','statSync','57ykKtLx','NEW_PHOTO_INDEX','dbOther','499518JHWHpX','title','log','getOnTask','扫描目录已不存在\x20','NasCabPhotoIndexWorker','./photoIndexUtil','141012CeYQPO'];_0x26c5=function(){return _0x25e353;};return _0x26c5();}indexUtil[_0x2c73ed(0x125)](dbOther,indexTableName,!![]),runScanTask();