const _0x58fe5e=_0x2996;(function(_0x256b84,_0x10b25e){const _0x1eddda=_0x2996,_0x2fceed=_0x256b84();while(!![]){try{const _0x42cd0d=-parseInt(_0x1eddda(0x110))/0x1+parseInt(_0x1eddda(0x112))/0x2*(-parseInt(_0x1eddda(0x106))/0x3)+parseInt(_0x1eddda(0x104))/0x4*(parseInt(_0x1eddda(0x120))/0x5)+-parseInt(_0x1eddda(0x107))/0x6*(-parseInt(_0x1eddda(0x103))/0x7)+parseInt(_0x1eddda(0x10c))/0x8*(parseInt(_0x1eddda(0x11d))/0x9)+-parseInt(_0x1eddda(0x117))/0xa+parseInt(_0x1eddda(0x119))/0xb;if(_0x42cd0d===_0x10b25e)break;else _0x2fceed['push'](_0x2fceed['shift']());}catch(_0x2a9988){_0x2fceed['push'](_0x2fceed['shift']());}}}(_0x28cd,0x37a1b));let fs=require('fs');const config=require('../../myConfig/config'),Database=require(_0x58fe5e(0x10b));function _0x28cd(){const _0x227cf9=['5368374kcUmsH','prepare','./indexUtil','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','10989EBQiIk','getTime','statSync','155sMSmMl','then','recursionFilesAddIndex','dealFirstLetterAll','now','setIndexingState','../../db/dbScanTaskTable','./musicIndexUtil','dbFileIndex','扫描目录已不存在\x20','文件数量','../../db/dbFileIndexTable','scan_path','pragma','1140146SSBCoi','51328RZxvRu','journal_mode\x20=\x20WAL','673362DnXuTk','6kTlmyG','exit','音乐管理:\x20开始扫描','INDEX_TABLE_NAME_MUSIC','better-sqlite3','1648ZPZuSL','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','recursionDeleteIndex','NasCabMusicIndexWorker','179157PXJYfs','耗时:','4mSUAhz','run','isDirectory','音乐管理：扫描完成：','dbOther','4442980BmZRNn','log'];_0x28cd=function(){return _0x227cf9;};return _0x28cd();}let dbOther=new Database(config[_0x58fe5e(0x116)],{}),dbFileIndex=new Database(config[_0x58fe5e(0xfd)],{});dbFileIndex['pragma'](_0x58fe5e(0x105)),dbOther[_0x58fe5e(0x102)](_0x58fe5e(0x105));let musicUtils=require('../../utils/musicUtil');const dbFileIndexTable=require(_0x58fe5e(0x100));function _0x2996(_0x49f2db,_0x73efa0){const _0x28cdf1=_0x28cd();return _0x2996=function(_0x299660,_0x95a578){_0x299660=_0x299660-0xf7;let _0x26d3f9=_0x28cdf1[_0x299660];return _0x26d3f9;},_0x2996(_0x49f2db,_0x73efa0);}process['title']=_0x58fe5e(0x10f);const musicIndexUtil=require(_0x58fe5e(0xfc)),indexTableName=dbFileIndexTable[_0x58fe5e(0x10a)],dbScanTaskTable=require(_0x58fe5e(0xfb)),indexUtil=require(_0x58fe5e(0x11b));async function startIndexingFolder(_0x55fcb){return new Promise(async(_0x4e9532,_0x121ce4)=>{const _0x54a544=_0x2996;try{let _0x48ac5c=new Date()['getTime'](),_0x48bb65=fs[_0x54a544(0x11f)](_0x55fcb);if(!_0x48bb65[_0x54a544(0x114)]())return console['log']('要扫描的目录不是文件夹',_0x55fcb),_0x4e9532();console[_0x54a544(0x118)](_0x54a544(0x109),_0x55fcb),await indexUtil[_0x54a544(0x10e)](dbFileIndex,indexTableName,_0x55fcb);let {checkFileCount:_0x17556f,checkPathCount:_0x5b8784}=await musicIndexUtil[_0x54a544(0xf7)](dbOther,dbFileIndex,_0x55fcb);console[_0x54a544(0x118)](_0x54a544(0x115)+_0x55fcb,_0x54a544(0x111),new Date()[_0x54a544(0x11e)]()-_0x48ac5c,'ms','文件夹数量',_0x5b8784,_0x54a544(0xff),_0x17556f),_0x4e9532();}catch(_0x3a651d){console[_0x54a544(0x118)](_0x54a544(0xfe),_0x55fcb),_0x4e9532();}});}async function runScanTask(){const _0x1de5a9=_0x58fe5e;let _0x23de89=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable['SCAN_TYPE_MUSIC']);_0x23de89?(dbOther[_0x1de5a9(0x11a)](_0x1de5a9(0x10d))[_0x1de5a9(0x113)](Date[_0x1de5a9(0xf9)](),_0x23de89[_0x1de5a9(0x101)]),startIndexingFolder(_0x23de89['scan_path'])[_0x1de5a9(0x121)](()=>{const _0xc0cf9b=_0x1de5a9;dbScanTaskTable['deleteTask'](dbOther,_0x23de89['id']),musicUtils[_0xc0cf9b(0xf8)](dbFileIndex),runScanTask();})):(console[_0x1de5a9(0x118)](_0x1de5a9(0x11c)),indexUtil[_0x1de5a9(0xfa)](dbOther,indexTableName,![]),process[_0x1de5a9(0x108)]());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();