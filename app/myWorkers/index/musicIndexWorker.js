const _0x959d9e=_0x1591;(function(_0x31f880,_0x5dd8d4){const _0x49941f=_0x1591,_0x43cd7e=_0x31f880();while(!![]){try{const _0x4dc624=-parseInt(_0x49941f(0x101))/0x1*(-parseInt(_0x49941f(0xdd))/0x2)+parseInt(_0x49941f(0xe9))/0x3+-parseInt(_0x49941f(0x104))/0x4+parseInt(_0x49941f(0xdb))/0x5*(parseInt(_0x49941f(0xfe))/0x6)+-parseInt(_0x49941f(0xff))/0x7+parseInt(_0x49941f(0xee))/0x8*(-parseInt(_0x49941f(0xdf))/0x9)+parseInt(_0x49941f(0xfd))/0xa;if(_0x4dc624===_0x5dd8d4)break;else _0x43cd7e['push'](_0x43cd7e['shift']());}catch(_0x4ddfd7){_0x43cd7e['push'](_0x43cd7e['shift']());}}}(_0x30ff,0x568e3));function _0x1591(_0x3e9f36,_0x38cffa){const _0x30ffce=_0x30ff();return _0x1591=function(_0x1591d9,_0x36eae4){_0x1591d9=_0x1591d9-0xdb;let _0x50c185=_0x30ffce[_0x1591d9];return _0x50c185;},_0x1591(_0x3e9f36,_0x38cffa);}let fs=require('fs');const config=require(_0x959d9e(0xec)),Database=require(_0x959d9e(0xf4));let dbOther=new Database(config[_0x959d9e(0xe5)],{}),dbFileIndex=new Database(config['dbFileIndex'],{});dbFileIndex['pragma'](_0x959d9e(0xeb)),dbOther[_0x959d9e(0xfa)](_0x959d9e(0xeb));let musicUtils=require(_0x959d9e(0xf9));const dbFileIndexTable=require(_0x959d9e(0xe8));function _0x30ff(){const _0x46766f=['../../db/dbFileIndexTable','130239CpJods','./musicIndexUtil','journal_mode\x20=\x20WAL','../../myConfig/config','then','849912jKvQYk','要扫描的目录不是文件夹','run','prepare','getOnTask','recursionFilesAddIndex','better-sqlite3','scan_path','statSync','音乐管理：扫描完成：','setIndexingState','../../utils/musicUtil','pragma','./indexUtil','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','10000980EowqfY','3795162aimvxo','3777781tlWoEv','exit','263107kJFaCN','log','INDEX_TABLE_NAME_MUSIC','1629988htTklP','扫描目录已不存在\x20','5FwXOjD','音乐管理:\x20开始扫描','2NheXiA','耗时:','54GGJgoL','now','../../db/dbScanTaskTable','SCAN_TYPE_MUSIC','文件夹数量','recursionDeleteIndex','dbOther','文件数量','getTime'];_0x30ff=function(){return _0x46766f;};return _0x30ff();}process['title']='NasCabMusicIndexWorker';const musicIndexUtil=require(_0x959d9e(0xea)),indexTableName=dbFileIndexTable[_0x959d9e(0x103)],dbScanTaskTable=require(_0x959d9e(0xe1)),indexUtil=require(_0x959d9e(0xfb));async function startIndexingFolder(_0x40050e){return new Promise(async(_0x3346a7,_0x59506a)=>{const _0x5df6ce=_0x1591;try{let _0x568216=new Date()[_0x5df6ce(0xe7)](),_0x3c9ca7=fs[_0x5df6ce(0xf6)](_0x40050e);if(!_0x3c9ca7['isDirectory']())return console[_0x5df6ce(0x102)](_0x5df6ce(0xef),_0x40050e),_0x3346a7();console['log'](_0x5df6ce(0xdc),_0x40050e),await indexUtil[_0x5df6ce(0xe4)](dbFileIndex,indexTableName,_0x40050e);let {checkFileCount:_0x206d47,checkPathCount:_0x458ef9}=await musicIndexUtil[_0x5df6ce(0xf3)](dbOther,dbFileIndex,_0x40050e);console[_0x5df6ce(0x102)](_0x5df6ce(0xf7)+_0x40050e,_0x5df6ce(0xde),new Date()['getTime']()-_0x568216,'ms',_0x5df6ce(0xe3),_0x458ef9,_0x5df6ce(0xe6),_0x206d47),_0x3346a7();}catch(_0x370b8f){console[_0x5df6ce(0x102)](_0x5df6ce(0x105),_0x40050e),_0x3346a7();}});}async function runScanTask(){const _0x13bcd6=_0x959d9e;let _0x353469=dbScanTaskTable[_0x13bcd6(0xf2)](dbOther,dbScanTaskTable[_0x13bcd6(0xe2)]);_0x353469?(dbOther[_0x13bcd6(0xf1)](_0x13bcd6(0xfc))[_0x13bcd6(0xf0)](Date[_0x13bcd6(0xe0)](),_0x353469['scan_path']),startIndexingFolder(_0x353469[_0x13bcd6(0xf5)])[_0x13bcd6(0xed)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x353469['id']),musicUtils['dealFirstLetterAll'](dbFileIndex),runScanTask();})):(console['log']('音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]'),indexUtil[_0x13bcd6(0xf8)](dbOther,indexTableName,![]),process[_0x13bcd6(0x100)]());}indexUtil[_0x959d9e(0xf8)](dbOther,indexTableName,!![]),runScanTask();