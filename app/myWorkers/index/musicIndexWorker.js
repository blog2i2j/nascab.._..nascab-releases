const _0x115faa=_0x56cb;(function(_0x313009,_0x4b6542){const _0x4ea642=_0x56cb,_0x424a14=_0x313009();while(!![]){try{const _0x3e39fe=-parseInt(_0x4ea642(0x149))/0x1+parseInt(_0x4ea642(0x169))/0x2+-parseInt(_0x4ea642(0x14b))/0x3+parseInt(_0x4ea642(0x144))/0x4*(parseInt(_0x4ea642(0x15f))/0x5)+parseInt(_0x4ea642(0x15e))/0x6+-parseInt(_0x4ea642(0x150))/0x7*(parseInt(_0x4ea642(0x165))/0x8)+-parseInt(_0x4ea642(0x141))/0x9*(-parseInt(_0x4ea642(0x142))/0xa);if(_0x3e39fe===_0x4b6542)break;else _0x424a14['push'](_0x424a14['shift']());}catch(_0x37e363){_0x424a14['push'](_0x424a14['shift']());}}}(_0xe3b0,0x1b639));let fs=require('fs');const config=require('../../myConfig/config'),Database=require(_0x115faa(0x166));let dbOther=new Database(config[_0x115faa(0x155)],{}),dbFileIndex=new Database(config[_0x115faa(0x160)],{});dbFileIndex[_0x115faa(0x14e)](_0x115faa(0x158)),dbOther[_0x115faa(0x14e)](_0x115faa(0x158));let musicUtils=require('../../utils/musicUtil');const dbFileIndexTable=require('../../db/dbFileIndexTable');process[_0x115faa(0x153)]=_0x115faa(0x14a);function _0xe3b0(){const _0x59f2da=['recursionDeleteIndex','./musicIndexUtil','文件夹数量','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','72cyntlU','better-sqlite3','getOnTask','扫描目录已不存在\x20','177518YcVxyz','isDirectory','54504UqiimK','30JNpTlN','./indexUtil','24tbvxBC','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','要扫描的目录不是文件夹','deleteTask','now','10343lCafhy','NasCabMusicIndexWorker','229503aMUsnF','SCAN_TYPE_MUSIC','scan_path','pragma','setIndexingState','171759vBIrUf','INDEX_TABLE_NAME_MUSIC','../../db/dbScanTaskTable','title','then','dbOther','getTime','dealFirstLetterAll','journal_mode\x20=\x20WAL','recursionFilesAddIndex','log','statSync','音乐管理:\x20开始扫描','耗时:','994890QqwAoN','122600ivxrCW','dbFileIndex'];_0xe3b0=function(){return _0x59f2da;};return _0xe3b0();}const musicIndexUtil=require(_0x115faa(0x162)),indexTableName=dbFileIndexTable[_0x115faa(0x151)],dbScanTaskTable=require(_0x115faa(0x152)),indexUtil=require(_0x115faa(0x143));async function startIndexingFolder(_0x3cd512){return new Promise(async(_0x26f868,_0x336b14)=>{const _0x1fcf70=_0x56cb;try{let _0x1ac84e=new Date()[_0x1fcf70(0x156)](),_0x12e6ef=fs[_0x1fcf70(0x15b)](_0x3cd512);if(!_0x12e6ef[_0x1fcf70(0x140)]())return console[_0x1fcf70(0x15a)](_0x1fcf70(0x146),_0x3cd512),_0x26f868();console[_0x1fcf70(0x15a)](_0x1fcf70(0x15c),_0x3cd512),await indexUtil[_0x1fcf70(0x161)](dbFileIndex,indexTableName,_0x3cd512);let {checkFileCount:_0xa8e4d3,checkPathCount:_0x432c92}=await musicIndexUtil[_0x1fcf70(0x159)](dbOther,dbFileIndex,_0x3cd512);console[_0x1fcf70(0x15a)]('音乐管理：扫描完成：'+_0x3cd512,_0x1fcf70(0x15d),new Date()['getTime']()-_0x1ac84e,'ms',_0x1fcf70(0x163),_0x432c92,'文件数量',_0xa8e4d3),_0x26f868();}catch(_0x592d93){console[_0x1fcf70(0x15a)](_0x1fcf70(0x168),_0x3cd512),_0x26f868();}});}async function runScanTask(){const _0x2c7632=_0x115faa;let _0x34b271=dbScanTaskTable[_0x2c7632(0x167)](dbOther,dbScanTaskTable[_0x2c7632(0x14c)]);_0x34b271?(dbOther['prepare'](_0x2c7632(0x164))['run'](Date[_0x2c7632(0x148)](),_0x34b271[_0x2c7632(0x14d)]),startIndexingFolder(_0x34b271[_0x2c7632(0x14d)])[_0x2c7632(0x154)](()=>{const _0x1cdd85=_0x2c7632;dbScanTaskTable[_0x1cdd85(0x147)](dbOther,_0x34b271['id']),musicUtils[_0x1cdd85(0x157)](dbFileIndex),runScanTask();})):(console[_0x2c7632(0x15a)](_0x2c7632(0x145)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process['exit']());}function _0x56cb(_0x534c27,_0x2d3984){const _0xe3b0c8=_0xe3b0();return _0x56cb=function(_0x56cb9b,_0x126326){_0x56cb9b=_0x56cb9b-0x140;let _0x51fd6a=_0xe3b0c8[_0x56cb9b];return _0x51fd6a;},_0x56cb(_0x534c27,_0x2d3984);}indexUtil[_0x115faa(0x14f)](dbOther,indexTableName,!![]),runScanTask();