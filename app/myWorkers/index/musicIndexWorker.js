const _0x4871bf=_0x5d5b;function _0x4026(){const _0x2ad124=['recursionDeleteIndex','journal_mode\x20=\x20WAL','23032WlGyzP','文件数量','14700xMlSIv','dealFirstLetterAll','now','setIndexingState','SCAN_TYPE_MUSIC','dbFileIndex','exit','1484Gnosst','3116113DYCztV','209iqdQhb','NasCabMusicIndexWorker','159kjBhtp','../../utils/musicUtil','better-sqlite3','扫描目录已不存在\x20','then','scan_path','log','title','../../db/dbScanTaskTable','deleteTask','getOnTask','6606FgvGXz','108PBLuNj','8216dttgEt','INDEX_TABLE_NAME_MUSIC','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','./indexUtil','../../myConfig/config','音乐管理：扫描完成：','getTime','820UqptSE','21552HmbZqP','7AlSUlG','../../db/dbFileIndexTable','145vUqFcq','耗时:','pragma','文件夹数量','dbOther'];_0x4026=function(){return _0x2ad124;};return _0x4026();}(function(_0x53a780,_0x403d92){const _0x2fb786=_0x5d5b,_0x3c8af3=_0x53a780();while(!![]){try{const _0x48d123=parseInt(_0x2fb786(0x156))/0x1*(parseInt(_0x2fb786(0x146))/0x2)+parseInt(_0x2fb786(0x14a))/0x3*(parseInt(_0x2fb786(0x13d))/0x4)+parseInt(_0x2fb786(0x162))/0x5*(-parseInt(_0x2fb786(0x13f))/0x6)+-parseInt(_0x2fb786(0x160))/0x7*(parseInt(_0x2fb786(0x157))/0x8)+-parseInt(_0x2fb786(0x155))/0x9*(-parseInt(_0x2fb786(0x15e))/0xa)+parseInt(_0x2fb786(0x148))/0xb*(parseInt(_0x2fb786(0x15f))/0xc)+-parseInt(_0x2fb786(0x147))/0xd;if(_0x48d123===_0x403d92)break;else _0x3c8af3['push'](_0x3c8af3['shift']());}catch(_0x1a1346){_0x3c8af3['push'](_0x3c8af3['shift']());}}}(_0x4026,0x28fa4));let fs=require('fs');const config=require(_0x4871bf(0x15b)),Database=require(_0x4871bf(0x14c));let dbOther=new Database(config[_0x4871bf(0x13a)],{}),dbFileIndex=new Database(config[_0x4871bf(0x144)],{});dbFileIndex[_0x4871bf(0x164)](_0x4871bf(0x13c)),dbOther[_0x4871bf(0x164)]('journal_mode\x20=\x20WAL');let musicUtils=require(_0x4871bf(0x14b));const dbFileIndexTable=require(_0x4871bf(0x161));process[_0x4871bf(0x151)]=_0x4871bf(0x149);function _0x5d5b(_0x407c7a,_0x12dc47){const _0x4026fa=_0x4026();return _0x5d5b=function(_0x5d5b55,_0x151463){_0x5d5b55=_0x5d5b55-0x13a;let _0xf77576=_0x4026fa[_0x5d5b55];return _0xf77576;},_0x5d5b(_0x407c7a,_0x12dc47);}const musicIndexUtil=require('./musicIndexUtil'),indexTableName=dbFileIndexTable[_0x4871bf(0x158)],dbScanTaskTable=require(_0x4871bf(0x152)),indexUtil=require(_0x4871bf(0x15a));async function startIndexingFolder(_0x5500c6){return new Promise(async(_0x31fd1c,_0x15f8f1)=>{const _0x23aea1=_0x5d5b;try{let _0xe9955=new Date()[_0x23aea1(0x15d)](),_0xb777f3=fs['statSync'](_0x5500c6);if(!_0xb777f3['isDirectory']())return console[_0x23aea1(0x150)]('要扫描的目录不是文件夹',_0x5500c6),_0x31fd1c();console[_0x23aea1(0x150)]('音乐管理:\x20开始扫描',_0x5500c6),await indexUtil[_0x23aea1(0x13b)](dbFileIndex,indexTableName,_0x5500c6);let {checkFileCount:_0x2d4da0,checkPathCount:_0x539e4d}=await musicIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x5500c6);console[_0x23aea1(0x150)](_0x23aea1(0x15c)+_0x5500c6,_0x23aea1(0x163),new Date()[_0x23aea1(0x15d)]()-_0xe9955,'ms',_0x23aea1(0x165),_0x539e4d,_0x23aea1(0x13e),_0x2d4da0),_0x31fd1c();}catch(_0x1ae226){console[_0x23aea1(0x150)](_0x23aea1(0x14d),_0x5500c6),_0x31fd1c();}});}async function runScanTask(){const _0x3c5bad=_0x4871bf;let _0x2945ad=dbScanTaskTable[_0x3c5bad(0x154)](dbOther,dbScanTaskTable[_0x3c5bad(0x143)]);_0x2945ad?(dbOther['prepare']('UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27')['run'](Date[_0x3c5bad(0x141)](),_0x2945ad[_0x3c5bad(0x14f)]),startIndexingFolder(_0x2945ad[_0x3c5bad(0x14f)])[_0x3c5bad(0x14e)](()=>{const _0x176610=_0x3c5bad;dbScanTaskTable[_0x176610(0x153)](dbOther,_0x2945ad['id']),musicUtils[_0x176610(0x140)](dbFileIndex),runScanTask();})):(console[_0x3c5bad(0x150)](_0x3c5bad(0x159)),indexUtil[_0x3c5bad(0x142)](dbOther,indexTableName,![]),process[_0x3c5bad(0x145)]());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();