const _0x3d9460=_0x3f09;(function(_0x2a752e,_0x36a4d7){const _0xf860f8=_0x3f09,_0x72ef97=_0x2a752e();while(!![]){try{const _0x1ed2f4=-parseInt(_0xf860f8(0x140))/0x1*(parseInt(_0xf860f8(0x14e))/0x2)+-parseInt(_0xf860f8(0x142))/0x3*(-parseInt(_0xf860f8(0x13f))/0x4)+parseInt(_0xf860f8(0x13a))/0x5+-parseInt(_0xf860f8(0x14a))/0x6*(-parseInt(_0xf860f8(0x138))/0x7)+-parseInt(_0xf860f8(0x12b))/0x8+parseInt(_0xf860f8(0x12c))/0x9+parseInt(_0xf860f8(0x137))/0xa*(-parseInt(_0xf860f8(0x12d))/0xb);if(_0x1ed2f4===_0x36a4d7)break;else _0x72ef97['push'](_0x72ef97['shift']());}catch(_0x50c9d9){_0x72ef97['push'](_0x72ef97['shift']());}}}(_0x3df2,0xbc470));let fs=require('fs');const config=require(_0x3d9460(0x12f)),Database=require(_0x3d9460(0x135));function _0x3f09(_0x44f7cb,_0x16bb86){const _0x3df2a5=_0x3df2();return _0x3f09=function(_0x3f0949,_0x24edfb){_0x3f0949=_0x3f0949-0x12a;let _0xbaa652=_0x3df2a5[_0x3f0949];return _0xbaa652;},_0x3f09(_0x44f7cb,_0x16bb86);}let dbOther=new Database(config[_0x3d9460(0x143)],{}),dbFileIndex=new Database(config[_0x3d9460(0x148)],{});dbFileIndex[_0x3d9460(0x14f)](_0x3d9460(0x13e)),dbOther[_0x3d9460(0x14f)](_0x3d9460(0x13e));let musicUtils=require('../../utils/musicUtil');function _0x3df2(){const _0x3bc96d=['音乐管理：扫描完成：','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27music\x27','70BoSOtE','pragma','deleteTask','音乐管理:未找到扫描任务[Music\x20scanning\x20task\x20not\x20found]','log','11801352VwKhHQ','13702383IIHgyP','294734mGapCn','NasCabMusicIndexWorker','../../myConfig/config','getTime','isDirectory','getOnTask','recursionDeleteIndex','setIndexingState','better-sqlite3','then','540UnuwPE','92071fjlrBa','../../db/dbScanTaskTable','3985015WbuSLx','scan_path','文件数量','./indexUtil','journal_mode\x20=\x20WAL','205292LgTKNP','13333cSqumV','prepare','33gRExxU','dbOther','SCAN_TYPE_MUSIC','dealFirstLetterAll','title','耗时:','dbFileIndex','statSync','582FbUcGy','要扫描的目录不是文件夹'];_0x3df2=function(){return _0x3bc96d;};return _0x3df2();}const dbFileIndexTable=require('../../db/dbFileIndexTable');process[_0x3d9460(0x146)]=_0x3d9460(0x12e);const musicIndexUtil=require('./musicIndexUtil'),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_MUSIC'],dbScanTaskTable=require(_0x3d9460(0x139)),indexUtil=require(_0x3d9460(0x13d));async function startIndexingFolder(_0x5e7322){return new Promise(async(_0x14500b,_0x4c02ba)=>{const _0x121db0=_0x3f09;try{let _0x1eb0c6=new Date()['getTime'](),_0x505374=fs[_0x121db0(0x149)](_0x5e7322);if(!_0x505374[_0x121db0(0x131)]())return console['log'](_0x121db0(0x14b),_0x5e7322),_0x14500b();console[_0x121db0(0x12a)]('音乐管理:\x20开始扫描',_0x5e7322),await indexUtil[_0x121db0(0x133)](dbFileIndex,indexTableName,_0x5e7322);let {checkFileCount:_0x20ac75,checkPathCount:_0x16a39e}=await musicIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x5e7322);console[_0x121db0(0x12a)](_0x121db0(0x14c)+_0x5e7322,_0x121db0(0x147),new Date()[_0x121db0(0x130)]()-_0x1eb0c6,'ms','文件夹数量',_0x16a39e,_0x121db0(0x13c),_0x20ac75),_0x14500b();}catch(_0x270fc9){console['log']('扫描目录已不存在\x20',_0x5e7322),_0x14500b();}});}async function runScanTask(){const _0x563884=_0x3d9460;let _0x91a300=dbScanTaskTable[_0x563884(0x132)](dbOther,dbScanTaskTable[_0x563884(0x144)]);_0x91a300?(dbOther[_0x563884(0x141)](_0x563884(0x14d))['run'](Date['now'](),_0x91a300[_0x563884(0x13b)]),startIndexingFolder(_0x91a300['scan_path'])[_0x563884(0x136)](()=>{const _0x4a20cf=_0x563884;dbScanTaskTable[_0x4a20cf(0x150)](dbOther,_0x91a300['id']),musicUtils[_0x4a20cf(0x145)](dbFileIndex),runScanTask();})):(console[_0x563884(0x12a)](_0x563884(0x151)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process['exit']());}indexUtil[_0x3d9460(0x134)](dbOther,indexTableName,!![]),runScanTask();