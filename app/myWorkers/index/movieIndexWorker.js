const _0x55cfc8=_0x44bd;(function(_0xe55ec1,_0x42bee4){const _0x4eba9a=_0x44bd,_0x1fb8ea=_0xe55ec1();while(!![]){try{const _0x2c1c93=-parseInt(_0x4eba9a(0x183))/0x1+-parseInt(_0x4eba9a(0x182))/0x2+-parseInt(_0x4eba9a(0x16b))/0x3*(-parseInt(_0x4eba9a(0x170))/0x4)+parseInt(_0x4eba9a(0x169))/0x5+-parseInt(_0x4eba9a(0x188))/0x6+parseInt(_0x4eba9a(0x17a))/0x7+-parseInt(_0x4eba9a(0x17e))/0x8*(-parseInt(_0x4eba9a(0x18e))/0x9);if(_0x2c1c93===_0x42bee4)break;else _0x1fb8ea['push'](_0x1fb8ea['shift']());}catch(_0x27acd2){_0x1fb8ea['push'](_0x1fb8ea['shift']());}}}(_0x1d2d,0xeb976));const fs=require('fs'),path=require('path'),config=require('../../myConfig/config'),Database=require('better-sqlite3'),dbOther=new Database(config[_0x55cfc8(0x16d)],{});dbOther[_0x55cfc8(0x187)](_0x55cfc8(0x18b));function _0x1d2d(){const _0x5e3829=['3207976WcHlUg','1551838nEglCp','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27movie\x27','影音管理：扫描完成：','now','pragma','7060128dJtyxq','dealTvDrama','exit','journal_mode\x20=\x20WAL','../../express-server/utils/movieUtil','文件数量','2286fvRSgz','SCAN_TYPE_MOVIE','recursionFilesAddIndex','8371405klOiNF','statSync','6KLPRUB','prepare','dbOther','../../db/dbScanTaskTable','getTime','2038652mjpazM','dbFileIndex','setIndexingState','log','INDEX_TABLE_NAME_MOVIE','./indexUtil','send','耗时:','isDirectory','dealFirstLetterAll','3736523ErBOJI','title','getOnTask','scan_path','65200TMkmsW','../../db/dbFileIndexTable','NasCabMovieIndexingWorker','./movieIndexUtil'];_0x1d2d=function(){return _0x5e3829;};return _0x1d2d();}const dbFileIndex=new Database(config[_0x55cfc8(0x171)],{'timeout':0xea60});dbFileIndex[_0x55cfc8(0x187)]('journal_mode\x20=\x20WAL');const movieUtil=require(_0x55cfc8(0x18c)),dbScanTaskTable=require(_0x55cfc8(0x16e)),dbFileIndexTable=require(_0x55cfc8(0x17f)),indexTableName=dbFileIndexTable[_0x55cfc8(0x174)],movieIndexUtil=require(_0x55cfc8(0x181)),indexUtil=require(_0x55cfc8(0x175));process[_0x55cfc8(0x17b)]=_0x55cfc8(0x180);async function startIndexingFolder(_0x466e25){return new Promise(async(_0x40b2e2,_0x2d0a84)=>{const _0xe4ba57=_0x44bd;try{let _0x1366fc=new Date()['getTime'](),_0x1d6265=fs[_0xe4ba57(0x16a)](_0x466e25);if(!_0x1d6265[_0xe4ba57(0x178)]())return console[_0xe4ba57(0x173)]('要扫描的目录不是文件夹',_0x466e25),_0x40b2e2();console[_0xe4ba57(0x173)]('影音管理:\x20开始扫描',_0x466e25),await indexUtil['recursionDeleteIndex'](dbFileIndex,indexTableName,_0x466e25);let {checkFileCount:_0x5385cf,checkPathCount:_0x3a2f8f}=await movieIndexUtil[_0xe4ba57(0x168)](dbOther,dbFileIndex,_0x466e25);console[_0xe4ba57(0x173)](_0xe4ba57(0x185)+_0x466e25,_0xe4ba57(0x177),new Date()[_0xe4ba57(0x16f)]()-_0x1366fc,'ms','文件夹数量',_0x3a2f8f,_0xe4ba57(0x18d),_0x5385cf),movieIndexUtil[_0xe4ba57(0x189)](dbFileIndex),process[_0xe4ba57(0x176)]({'type':'NEW_MOVIE_INDEX'}),_0x40b2e2();}catch(_0x3ecd61){console[_0xe4ba57(0x173)]('扫描目录已不存在\x20',_0x3ecd61,_0x466e25),_0x40b2e2();}});}function _0x44bd(_0x1366cc,_0xab04e2){const _0x1d2dd6=_0x1d2d();return _0x44bd=function(_0x44bd51,_0x1fbf6d){_0x44bd51=_0x44bd51-0x167;let _0x11adea=_0x1d2dd6[_0x44bd51];return _0x11adea;},_0x44bd(_0x1366cc,_0xab04e2);}async function runScanTask(){const _0x15f894=_0x55cfc8;let _0x247130=dbScanTaskTable[_0x15f894(0x17c)](dbOther,dbScanTaskTable[_0x15f894(0x167)]);_0x247130?(dbOther[_0x15f894(0x16c)](_0x15f894(0x184))['run'](Date[_0x15f894(0x186)](),_0x247130[_0x15f894(0x17d)]),startIndexingFolder(_0x247130[_0x15f894(0x17d)])['then'](()=>{const _0x54ef0f=_0x15f894;dbScanTaskTable['deleteTask'](dbOther,_0x247130['id']),movieUtil[_0x54ef0f(0x179)](dbFileIndex),runScanTask();})):(console['log']('影音管理:未找到扫描任务[Movies\x20scanning\x20task\x20not\x20found]'),indexUtil[_0x15f894(0x172)](dbOther,indexTableName,![]),process[_0x15f894(0x18a)]());}indexUtil[_0x55cfc8(0x172)](dbOther,indexTableName,!![]),runScanTask();