const _0x549647=_0x26f1;(function(_0x9787b6,_0x4a785e){const _0x1135de=_0x26f1,_0xff2135=_0x9787b6();while(!![]){try{const _0x19d44b=-parseInt(_0x1135de(0x18e))/0x1+parseInt(_0x1135de(0x176))/0x2*(-parseInt(_0x1135de(0x18c))/0x3)+parseInt(_0x1135de(0x182))/0x4*(parseInt(_0x1135de(0x180))/0x5)+-parseInt(_0x1135de(0x181))/0x6*(parseInt(_0x1135de(0x16a))/0x7)+-parseInt(_0x1135de(0x168))/0x8+-parseInt(_0x1135de(0x175))/0x9+parseInt(_0x1135de(0x186))/0xa;if(_0x19d44b===_0x4a785e)break;else _0xff2135['push'](_0xff2135['shift']());}catch(_0x140396){_0xff2135['push'](_0xff2135['shift']());}}}(_0x2fb0,0x3c338));function _0x2fb0(){const _0x2b3b89=['70464GAIzRR','2242184ufaHwW','NEW_MOVIE_INDEX','1421819TVQPaw','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27movie\x27','getOnTask','../../express-server/utils/movieUtil','dealFirstLetterAll','NasCabMovieIndexingWorker','耗时:','SCAN_TYPE_MOVIE','pragma','影音管理：扫描完成：','then','624015JnpAqo','200sRPoXv','dbOther','title','影音管理:未找到扫描任务[Movies\x20scanning\x20task\x20not\x20found]','../../db/dbFileIndexTable','log','isDirectory','../../db/dbScanTaskTable','dbFileIndex','scan_path','25EsfEbg','6TVdQQu','200060ZrdYRw','deleteTask','exit','statSync','8477980rXRtLj','journal_mode\x20=\x20WAL','影音管理:\x20开始扫描','recursionFilesAddIndex','now','setIndexingState','6843VRbneG','文件数量'];_0x2fb0=function(){return _0x2b3b89;};return _0x2fb0();}const fs=require('fs'),path=require('path'),config=require('../../myConfig/config'),Database=require('better-sqlite3'),dbOther=new Database(config[_0x549647(0x177)],{});dbOther['pragma'](_0x549647(0x187));const dbFileIndex=new Database(config[_0x549647(0x17e)],{'timeout':0xea60});dbFileIndex[_0x549647(0x172)](_0x549647(0x187));const movieUtil=require(_0x549647(0x16d)),dbScanTaskTable=require(_0x549647(0x17d)),dbFileIndexTable=require(_0x549647(0x17a)),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_MOVIE'],movieIndexUtil=require('./movieIndexUtil'),indexUtil=require('./indexUtil');process[_0x549647(0x178)]=_0x549647(0x16f);async function startIndexingFolder(_0x40f42a){return new Promise(async(_0x4bffa8,_0x2421c8)=>{const _0x208d7e=_0x26f1;try{let _0x4ad85f=new Date()['getTime'](),_0x561b32=fs[_0x208d7e(0x185)](_0x40f42a);if(!_0x561b32[_0x208d7e(0x17c)]())return console[_0x208d7e(0x17b)]('要扫描的目录不是文件夹',_0x40f42a),_0x4bffa8();console[_0x208d7e(0x17b)](_0x208d7e(0x188),_0x40f42a),await indexUtil['recursionDeleteIndex'](dbFileIndex,indexTableName,_0x40f42a);let {checkFileCount:_0x46634e,checkPathCount:_0x4c75ab}=await movieIndexUtil[_0x208d7e(0x189)](dbOther,dbFileIndex,_0x40f42a);console[_0x208d7e(0x17b)](_0x208d7e(0x173)+_0x40f42a,_0x208d7e(0x170),new Date()['getTime']()-_0x4ad85f,'ms','文件夹数量',_0x4c75ab,_0x208d7e(0x18d),_0x46634e),movieIndexUtil['dealTvDrama'](dbFileIndex),process['send']({'type':_0x208d7e(0x169)}),_0x4bffa8();}catch(_0x49451b){console[_0x208d7e(0x17b)]('扫描目录已不存在\x20',_0x49451b,_0x40f42a),_0x4bffa8();}});}function _0x26f1(_0xd85c7d,_0x33b464){const _0x2fb093=_0x2fb0();return _0x26f1=function(_0x26f146,_0x1bd38a){_0x26f146=_0x26f146-0x168;let _0x3aee80=_0x2fb093[_0x26f146];return _0x3aee80;},_0x26f1(_0xd85c7d,_0x33b464);}async function runScanTask(){const _0x5838f0=_0x549647;let _0x39ee9e=dbScanTaskTable[_0x5838f0(0x16c)](dbOther,dbScanTaskTable[_0x5838f0(0x171)]);_0x39ee9e?(dbOther['prepare'](_0x5838f0(0x16b))['run'](Date[_0x5838f0(0x18a)](),_0x39ee9e[_0x5838f0(0x17f)]),startIndexingFolder(_0x39ee9e[_0x5838f0(0x17f)])[_0x5838f0(0x174)](()=>{const _0x1ab55e=_0x5838f0;dbScanTaskTable[_0x1ab55e(0x183)](dbOther,_0x39ee9e['id']),movieUtil[_0x1ab55e(0x16e)](dbFileIndex),runScanTask();})):(console['log'](_0x5838f0(0x179)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process[_0x5838f0(0x184)]());}indexUtil[_0x549647(0x18b)](dbOther,indexTableName,!![]),runScanTask();