const _0x368e22=_0x497c;function _0x497c(_0x444fc0,_0x31c3fb){const _0x35ff3b=_0x35ff();return _0x497c=function(_0x497c6f,_0x24f55f){_0x497c6f=_0x497c6f-0x7a;let _0x514886=_0x35ff3b[_0x497c6f];return _0x514886;},_0x497c(_0x444fc0,_0x31c3fb);}(function(_0x572e42,_0x2513b5){const _0x32c60=_0x497c,_0x527ba1=_0x572e42();while(!![]){try{const _0x23fe22=parseInt(_0x32c60(0x9a))/0x1*(parseInt(_0x32c60(0x7d))/0x2)+parseInt(_0x32c60(0x96))/0x3+parseInt(_0x32c60(0x7e))/0x4*(-parseInt(_0x32c60(0x95))/0x5)+parseInt(_0x32c60(0x97))/0x6+parseInt(_0x32c60(0xa0))/0x7+parseInt(_0x32c60(0xa6))/0x8+-parseInt(_0x32c60(0x81))/0x9;if(_0x23fe22===_0x2513b5)break;else _0x527ba1['push'](_0x527ba1['shift']());}catch(_0x46f3e9){_0x527ba1['push'](_0x527ba1['shift']());}}}(_0x35ff,0xbdd08));const fs=require('fs'),path=require(_0x368e22(0x7a)),config=require(_0x368e22(0x80)),Database=require(_0x368e22(0x8d)),dbOther=new Database(config[_0x368e22(0x7c)],{});dbOther[_0x368e22(0x7f)]('journal_mode\x20=\x20WAL');const dbFileIndex=new Database(config['dbFileIndex'],{'timeout':0xea60});dbFileIndex['pragma'](_0x368e22(0x85));const movieUtil=require(_0x368e22(0xa7)),dbScanTaskTable=require(_0x368e22(0xa3)),dbFileIndexTable=require(_0x368e22(0x99)),indexTableName=dbFileIndexTable[_0x368e22(0x9d)],movieIndexUtil=require(_0x368e22(0x86)),indexUtil=require(_0x368e22(0x89));process[_0x368e22(0x8a)]=_0x368e22(0x9e);async function startIndexingFolder(_0x344a13){return new Promise(async(_0x27c412,_0x98749c)=>{const _0x3ad2af=_0x497c;try{let _0x29a623=new Date()[_0x3ad2af(0x90)](),_0x586e5e=fs['statSync'](_0x344a13);if(!_0x586e5e[_0x3ad2af(0x7b)]())return console[_0x3ad2af(0x91)](_0x3ad2af(0x9f),_0x344a13),_0x27c412();console[_0x3ad2af(0x91)](_0x3ad2af(0x8b),_0x344a13),await indexUtil[_0x3ad2af(0xa2)](dbFileIndex,indexTableName,_0x344a13);let {checkFileCount:_0x4bbfca,checkPathCount:_0x475ea8}=await movieIndexUtil[_0x3ad2af(0x87)](dbOther,dbFileIndex,_0x344a13);console[_0x3ad2af(0x91)](_0x3ad2af(0xa1)+_0x344a13,_0x3ad2af(0x8e),new Date()[_0x3ad2af(0x90)]()-_0x29a623,'ms','文件夹数量',_0x475ea8,_0x3ad2af(0x94),_0x4bbfca),movieIndexUtil[_0x3ad2af(0x93)](dbFileIndex),process[_0x3ad2af(0xa5)]({'type':_0x3ad2af(0x8c)}),_0x27c412();}catch(_0x409295){console[_0x3ad2af(0x91)](_0x3ad2af(0x92),_0x409295,_0x344a13),_0x27c412();}});}async function runScanTask(){const _0x1b8284=_0x368e22;let _0x2174cf=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x1b8284(0x82)]);_0x2174cf?(dbOther[_0x1b8284(0x9b)]('UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27movie\x27')['run'](Date['now'](),_0x2174cf[_0x1b8284(0x88)]),startIndexingFolder(_0x2174cf[_0x1b8284(0x88)])[_0x1b8284(0x84)](()=>{const _0x443b2b=_0x1b8284;dbScanTaskTable[_0x443b2b(0x98)](dbOther,_0x2174cf['id']),movieUtil[_0x443b2b(0x9c)](dbFileIndex),runScanTask();})):(console[_0x1b8284(0x91)](_0x1b8284(0x8f)),indexUtil[_0x1b8284(0xa4)](dbOther,indexTableName,![]),process[_0x1b8284(0x83)]());}function _0x35ff(){const _0x3bf22b=['dealFirstLetterAll','INDEX_TABLE_NAME_MOVIE','NasCabMovieIndexingWorker','要扫描的目录不是文件夹','3259704frbABU','影音管理：扫描完成：','recursionDeleteIndex','../../db/dbScanTaskTable','setIndexingState','send','6279392jTZZBP','../../express-server/utils/movieUtil','path','isDirectory','dbOther','8lPAiRZ','58200SUAlJG','pragma','../../myConfig/config','28686438XOeozt','SCAN_TYPE_MOVIE','exit','then','journal_mode\x20=\x20WAL','./movieIndexUtil','recursionFilesAddIndex','scan_path','./indexUtil','title','影音管理:\x20开始扫描','NEW_MOVIE_INDEX','better-sqlite3','耗时:','影音管理:未找到扫描任务[Movies\x20scanning\x20task\x20not\x20found]','getTime','log','扫描目录已不存在\x20','dealTvDrama','文件数量','80nuinDh','2566383jAGYXH','5542230fIgKxE','deleteTask','../../db/dbFileIndexTable','291975zRVZSY','prepare'];_0x35ff=function(){return _0x3bf22b;};return _0x35ff();}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();