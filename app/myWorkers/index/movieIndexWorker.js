const _0x1a5a15=_0x257f;(function(_0x34bdaa,_0x550965){const _0x412ac2=_0x257f,_0x158d5a=_0x34bdaa();while(!![]){try{const _0x3d906b=-parseInt(_0x412ac2(0x6e))/0x1*(parseInt(_0x412ac2(0x7f))/0x2)+parseInt(_0x412ac2(0x68))/0x3+parseInt(_0x412ac2(0x8f))/0x4+-parseInt(_0x412ac2(0x94))/0x5+-parseInt(_0x412ac2(0x6c))/0x6*(parseInt(_0x412ac2(0x71))/0x7)+-parseInt(_0x412ac2(0x6d))/0x8*(-parseInt(_0x412ac2(0x70))/0x9)+parseInt(_0x412ac2(0x76))/0xa;if(_0x3d906b===_0x550965)break;else _0x158d5a['push'](_0x158d5a['shift']());}catch(_0x50eff0){_0x158d5a['push'](_0x158d5a['shift']());}}}(_0x15e0,0x517f4));const fs=require('fs'),path=require(_0x1a5a15(0x85)),config=require('../../myConfig/config'),Database=require(_0x1a5a15(0x6a)),dbOther=new Database(config[_0x1a5a15(0x78)],{});dbOther[_0x1a5a15(0x6b)]('journal_mode\x20=\x20WAL');const dbFileIndex=new Database(config[_0x1a5a15(0x75)],{'timeout':0xea60});function _0x257f(_0xa68832,_0x153053){const _0x15e0d4=_0x15e0();return _0x257f=function(_0x257f26,_0x7c8f2d){_0x257f26=_0x257f26-0x64;let _0x1fb55f=_0x15e0d4[_0x257f26];return _0x1fb55f;},_0x257f(_0xa68832,_0x153053);}dbFileIndex[_0x1a5a15(0x6b)](_0x1a5a15(0x91));function _0x15e0(){const _0x570857=['1005903MsYdbt','影音管理：扫描完成：','better-sqlite3','pragma','114kLsUuE','264AXjowT','142qVRVow','getTime','152325sUsWBZ','217826JfLGtx','../../db/dbFileIndexTable','log','exit','dbFileIndex','5513000muDYCs','../../express-server/utils/movieUtil','dbOther','recursionFilesAddIndex','run','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27movie\x27','statSync','耗时:','now','4646OLXWaI','文件夹数量','./movieIndexUtil','setIndexingState','影音管理:未找到扫描任务[Movies\x20scanning\x20task\x20not\x20found]','文件数量','path','scan_path','deleteTask','then','./indexUtil','dealFirstLetterAll','isDirectory','INDEX_TABLE_NAME_MOVIE','要扫描的目录不是文件夹','getOnTask','1625008voyMeX','send','journal_mode\x20=\x20WAL','prepare','扫描目录已不存在\x20','2982290LtICWt','SCAN_TYPE_MOVIE','NasCabMovieIndexingWorker','../../db/dbScanTaskTable','NEW_MOVIE_INDEX'];_0x15e0=function(){return _0x570857;};return _0x15e0();}const movieUtil=require(_0x1a5a15(0x77)),dbScanTaskTable=require(_0x1a5a15(0x66)),dbFileIndexTable=require(_0x1a5a15(0x72)),indexTableName=dbFileIndexTable[_0x1a5a15(0x8c)],movieIndexUtil=require(_0x1a5a15(0x81)),indexUtil=require(_0x1a5a15(0x89));process['title']=_0x1a5a15(0x65);async function startIndexingFolder(_0x49c9df){return new Promise(async(_0x10583d,_0x599053)=>{const _0x954fc0=_0x257f;try{let _0x527feb=new Date()[_0x954fc0(0x6f)](),_0x4be881=fs[_0x954fc0(0x7c)](_0x49c9df);if(!_0x4be881[_0x954fc0(0x8b)]())return console[_0x954fc0(0x73)](_0x954fc0(0x8d),_0x49c9df),_0x10583d();console[_0x954fc0(0x73)]('影音管理:\x20开始扫描',_0x49c9df),await indexUtil['recursionDeleteIndex'](dbFileIndex,indexTableName,_0x49c9df);let {checkFileCount:_0x4d95d4,checkPathCount:_0x83493a}=await movieIndexUtil[_0x954fc0(0x79)](dbOther,dbFileIndex,_0x49c9df);console[_0x954fc0(0x73)](_0x954fc0(0x69)+_0x49c9df,_0x954fc0(0x7d),new Date()[_0x954fc0(0x6f)]()-_0x527feb,'ms',_0x954fc0(0x80),_0x83493a,_0x954fc0(0x84),_0x4d95d4),movieIndexUtil['dealTvDrama'](dbFileIndex),process[_0x954fc0(0x90)]({'type':_0x954fc0(0x67)}),_0x10583d();}catch(_0x5208fc){console[_0x954fc0(0x73)](_0x954fc0(0x93),_0x5208fc,_0x49c9df),_0x10583d();}});}async function runScanTask(){const _0x2802e4=_0x1a5a15;let _0x32b1fe=dbScanTaskTable[_0x2802e4(0x8e)](dbOther,dbScanTaskTable[_0x2802e4(0x64)]);_0x32b1fe?(dbOther[_0x2802e4(0x92)](_0x2802e4(0x7b))[_0x2802e4(0x7a)](Date[_0x2802e4(0x7e)](),_0x32b1fe[_0x2802e4(0x86)]),startIndexingFolder(_0x32b1fe[_0x2802e4(0x86)])[_0x2802e4(0x88)](()=>{const _0x53e37c=_0x2802e4;dbScanTaskTable[_0x53e37c(0x87)](dbOther,_0x32b1fe['id']),movieUtil[_0x53e37c(0x8a)](dbFileIndex),runScanTask();})):(console['log'](_0x2802e4(0x83)),indexUtil[_0x2802e4(0x82)](dbOther,indexTableName,![]),process[_0x2802e4(0x74)]());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();