const _0x1550a2=_0x5a25;(function(_0x3b1799,_0x5c7834){const _0x37fb6f=_0x5a25,_0x8c5ec2=_0x3b1799();while(!![]){try{const _0x5e4e5b=-parseInt(_0x37fb6f(0x92))/0x1+parseInt(_0x37fb6f(0xab))/0x2*(-parseInt(_0x37fb6f(0xa1))/0x3)+-parseInt(_0x37fb6f(0xa2))/0x4+parseInt(_0x37fb6f(0xd7))/0x5+parseInt(_0x37fb6f(0xce))/0x6*(-parseInt(_0x37fb6f(0xdc))/0x7)+-parseInt(_0x37fb6f(0xc8))/0x8*(parseInt(_0x37fb6f(0xe2))/0x9)+parseInt(_0x37fb6f(0xc5))/0xa;if(_0x5e4e5b===_0x5c7834)break;else _0x8c5ec2['push'](_0x8c5ec2['shift']());}catch(_0x2964fa){_0x8c5ec2['push'](_0x8c5ec2['shift']());}}}(_0x2c8e,0xcdcf4));const path=require(_0x1550a2(0xbe)),fs=require('fs'),dbFileIndexTable=require(_0x1550a2(0xc4)),config=require('../../myConfig/config'),videoStreamUtil=require(_0x1550a2(0xd9)),indexUtil=require(_0x1550a2(0xb4));let musicUtils=require(_0x1550a2(0xb7));const indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_MUSIC'],musicIndexUtil={},sharpUtil=require(_0x1550a2(0xc9));function _0x5a25(_0x19741d,_0x14458f){const _0x2c8e1=_0x2c8e();return _0x5a25=function(_0x5a2523,_0x5bcb53){_0x5a2523=_0x5a2523-0x8f;let _0x394c7b=_0x2c8e1[_0x5a2523];return _0x394c7b;},_0x5a25(_0x19741d,_0x14458f);}function _0x2c8e(){const _0x34cea6=['original_date','size','1543364qEHUxW','addFileIndexToDb','mtimeMs','join','basename','getById','ctime','APIC','coverPath','temp.','includes','ctimeMs','music','dealMediaInfo','TPE1','1165062uogOyu','868880lqkGNW','transStringToUtf8','data','exports','NaN','lastInsertRowid','lyrics','atimeMs','addOriginalDate','4OISBOC','ext','picture','description','string','stringify','getTime','streams','title','./indexUtil','dirname','image','../../utils/musicUtil','getDate','is_file','read','duration','birthtimeMs','length','path','getMonth','TIT2','dealFileChange','year','extname','../../db/dbFileIndexTable','44071390AcpEnF','filename','ceil','8lkGaen','../../express-server/utils/sharpUtils','album','getDurationFromStream','addFinalIndexToDB','recursionFilesAddIndex','42nEnsWw','base64','tags','artist','genre','original_time','genTinyFile','indexOf','musicTypeList','5929525QgXyGB','type','../../utils/videoStreamUtil','create','jsmediatags','1217209fBHisS','exifMinTimeStamp','TYER','log','toLowerCase','from','8959923yCRmvz','parseAudioTags','format'];_0x2c8e=function(){return _0x34cea6;};return _0x2c8e();}let jsmediatags=require(_0x1550a2(0xdb)),musicTypeList=config[_0x1550a2(0xd6)];musicIndexUtil[_0x1550a2(0xc1)]=async function(_0x434d98,_0x28eecc,_0x5d9c45){const _0x5fdab1=_0x1550a2;await indexUtil[_0x5fdab1(0xc1)](_0x434d98,_0x28eecc,_0x5d9c45,indexTableName,musicIndexUtil[_0x5fdab1(0x93)],musicIndexUtil[_0x5fdab1(0xcd)]);return;},musicIndexUtil['recursionFilesAddIndex']=async function(_0x4806ee,_0x339e99,_0x3b496f){const _0x5b8ec6=_0x1550a2;return await indexUtil[_0x5b8ec6(0xcd)](_0x4806ee,_0x339e99,indexTableName,'music',_0x3b496f,musicIndexUtil['addFileIndexToDb']);},musicIndexUtil['addFileIndexToDb']=async function(_0x13568c,_0xdc451c,_0x3aa49b,_0x25e679,_0x2af9c1,_0x1d0e3d){const _0x19793f=_0x1550a2;let _0x4e103d=indexUtil['doesPathCanAddToDb'](_0x13568c,_0x19793f(0x9e),config,_0x3aa49b,_0x25e679);if(!_0x4e103d)return;let _0x2934d8=_0x1d0e3d[_0x19793f(0xbc)];_0x1d0e3d[_0x19793f(0x94)]<_0x2934d8&&(_0x2934d8=_0x1d0e3d['mtimeMs']);_0x1d0e3d[_0x19793f(0xa9)]<_0x2934d8&&(_0x2934d8=_0x1d0e3d['atimeMs']);_0x1d0e3d[_0x19793f(0x9d)]<_0x2934d8&&(_0x2934d8=_0x1d0e3d['ctimeMs']);let _0x425643={'path':_0x3aa49b,'filename':_0x25e679,'is_file':_0x2af9c1,'ctime':_0x1d0e3d['ctimeMs'],'mtime':_0x1d0e3d['mtimeMs'],'ext':path[_0x19793f(0xc3)](_0x25e679),'birthtime':Math[_0x19793f(0xc7)](_0x2934d8),'size':_0x1d0e3d[_0x19793f(0x91)],'check_time':new Date()[_0x19793f(0xb1)]()};_0x425643=await musicIndexUtil[_0x19793f(0x9f)](_0xdc451c,_0x425643);},musicIndexUtil[_0x1550a2(0x9f)]=async function(_0x494fcd,_0xc6ac85){const _0x3339e8=_0x1550a2;let _0x55602c=![],_0x4cb84c=path[_0x3339e8(0x95)](_0xc6ac85[_0x3339e8(0xbe)],_0xc6ac85[_0x3339e8(0xc6)]);if(_0xc6ac85['is_file']==0x1&&_0xc6ac85[_0x3339e8(0xac)]&&musicTypeList[_0x3339e8(0x9c)](_0xc6ac85[_0x3339e8(0xac)][_0x3339e8(0xe0)]())){_0xc6ac85[_0x3339e8(0xd8)]=0x3;try{let _0x10cc4d=await indexUtil['ffprobeSync'](_0x4cb84c);if(_0x10cc4d&&_0x10cc4d[_0x3339e8(0xb2)]&&_0x10cc4d[_0x3339e8(0xb2)][_0x3339e8(0xbd)]>0x0){_0xc6ac85['stream_info']=JSON['stringify'](_0x10cc4d[_0x3339e8(0xb2)]);let _0x407a2f=videoStreamUtil[_0x3339e8(0xcb)](_0x10cc4d);_0x407a2f&&(_0xc6ac85[_0x3339e8(0xbb)]=_0x407a2f);}if(_0x10cc4d&&_0x10cc4d[_0x3339e8(0x8f)]&&_0x10cc4d['format']['tags']){let _0x4ea70e=_0x10cc4d[_0x3339e8(0x8f)][_0x3339e8(0xd0)][_0x3339e8(0xca)];_0x4ea70e&&(_0xc6ac85[_0x3339e8(0xca)]=_0x4ea70e),_0x10cc4d[_0x3339e8(0x8f)][_0x3339e8(0xbb)]&&!_0xc6ac85[_0x3339e8(0xbb)]&&(_0xc6ac85[_0x3339e8(0xbb)]=_0x10cc4d['format'][_0x3339e8(0xbb)]);}musicIndexUtil[_0x3339e8(0xe3)](_0x4cb84c,_0xc6ac85,_0x5a4e4e=>{const _0x2ca93c=_0x3339e8;return _0x5a4e4e[_0x2ca93c(0xca)]&&(_0x5a4e4e[_0x2ca93c(0xca)]=musicUtils[_0x2ca93c(0xa3)](_0x5a4e4e[_0x2ca93c(0xca)])),_0x5a4e4e[_0x2ca93c(0xd1)]&&(_0x5a4e4e['artist']=musicUtils[_0x2ca93c(0xa3)](_0x5a4e4e[_0x2ca93c(0xd1)])),_0x5a4e4e[_0x2ca93c(0xb3)]&&(_0x5a4e4e[_0x2ca93c(0xb3)]=musicUtils['transStringToUtf8'](_0x5a4e4e['title'])),_0x5a4e4e[_0x2ca93c(0xa8)]&&(_0x5a4e4e['lyrics']=musicUtils[_0x2ca93c(0xa3)](_0x5a4e4e['lyrics'])),musicIndexUtil[_0x2ca93c(0xaa)](_0x494fcd,_0x55602c,_0x5a4e4e);});}catch(_0x92f7f5){return console[_0x3339e8(0xdf)](_0x92f7f5),musicIndexUtil[_0x3339e8(0xaa)](_0x494fcd,_0x55602c,_0xc6ac85);}}else{if(_0xc6ac85[_0x3339e8(0xb9)]==0x1)return;return musicIndexUtil['addOriginalDate'](_0x494fcd,_0x55602c,_0xc6ac85);}},musicIndexUtil[_0x1550a2(0xaa)]=function(_0x2ebcb5,_0x33085e,_0xe2cfc9){const _0x25104d=_0x1550a2;_0x33085e&&_0x33085e<config[_0x25104d(0xdd)]&&(_0x33085e=![]);(!_0x33085e||_0x33085e==_0x25104d(0xa6)||_0x33085e=='Nan'||_0x33085e==_0x25104d(0xa6)||_0x33085e=='Null')&&(_0x33085e=_0xe2cfc9['birthtime']||_0xe2cfc9[_0x25104d(0x98)]);let _0x22fb22=new Date(_0x33085e);_0xe2cfc9[_0x25104d(0xd3)]=_0x22fb22[_0x25104d(0xb1)]();let _0x26eb54=_0x22fb22['getFullYear'](),_0x27e24b=_0x22fb22[_0x25104d(0xbf)]()+0x1;_0x27e24b=_0x27e24b>=0xa?_0x27e24b:'0'+_0x27e24b;let _0x294f9c=_0x22fb22[_0x25104d(0xb8)]();_0x294f9c=_0x294f9c>=0xa?_0x294f9c:'0'+_0x294f9c,_0xe2cfc9[_0x25104d(0x90)]=_0x26eb54+'-'+_0x27e24b+'-'+_0x294f9c,musicIndexUtil[_0x25104d(0xcc)](_0x2ebcb5,_0xe2cfc9);},musicIndexUtil['addFinalIndexToDB']=function(_0x305de7,_0x52baf8){const _0x18671b=_0x1550a2;!_0x52baf8[_0x18671b(0xca)]&&(_0x52baf8['album']=path['basename'](_0x52baf8[_0x18671b(0xbe)]));let _0x366f90=musicUtils['getMusicSameNameCover'](_0x305de7,_0x52baf8);_0x52baf8['fileCoverPath']=_0x366f90?_0x366f90:'';let _0xe15c62=dbFileIndexTable[_0x18671b(0xda)](_0x305de7,_0x52baf8,indexTableName);if(_0xe15c62&&_0xe15c62[_0x18671b(0xa7)]){let _0x90022f=dbFileIndexTable[_0x18671b(0x97)](_0x305de7,_0xe15c62['lastInsertRowid'],dbFileIndexTable['INDEX_TABLE_NAME_MUSIC']);_0x90022f&&musicUtils['dealFirstLetterSingle'](_0x305de7,_0x90022f);}},musicIndexUtil[_0x1550a2(0xe3)]=function(_0x6f5141,_0x1df24a,_0x440fcc){const _0x34ed79=_0x1550a2;function _0x48a88e(_0x3fa491,_0x422932,_0x35122c,_0x466082,_0x109413){const _0x451c21=_0x5a25;try{!_0x1df24a[_0x422932]&&(_0x3fa491[_0x35122c]&&typeof _0x3fa491[_0x35122c]==_0x451c21(0xaf)&&(_0x1df24a[_0x35122c]=_0x3fa491[_0x35122c]),!_0x1df24a[_0x422932]&&_0x466082&&_0x3fa491[_0x466082]&&_0x3fa491[_0x466082][_0x451c21(0xa4)]&&typeof _0x3fa491[_0x466082][_0x451c21(0xa4)]=='string'&&_0x3fa491[_0x466082][_0x451c21(0xae)]&&typeof _0x3fa491[_0x466082][_0x451c21(0xae)]==_0x451c21(0xaf)&&_0x3fa491[_0x466082][_0x451c21(0xae)][_0x451c21(0xe0)]()[_0x451c21(0xd5)](_0x109413)!=-0x1&&(_0x1df24a[_0x422932]=_0x3fa491[_0x466082][_0x451c21(0xa4)]));}catch(_0x211bfe){console[_0x451c21(0xdf)](_0x211bfe);}}jsmediatags[_0x34ed79(0xba)](_0x6f5141,{'onSuccess':function(_0x5b27a2){const _0x327df3=_0x34ed79;let _0x2614ff=_0x5b27a2[_0x327df3(0xd0)];_0x48a88e(_0x2614ff,_0x327df3(0xca),'album','TALB',_0x327df3(0xca)),_0x48a88e(_0x2614ff,_0x327df3(0xb3),_0x327df3(0xb3),_0x327df3(0xc0),_0x327df3(0xb3)),_0x48a88e(_0x2614ff,_0x327df3(0xd1),'artist',_0x327df3(0xa0),'performer'),_0x48a88e(_0x2614ff,_0x327df3(0xc2),_0x327df3(0xc2),'TYER',_0x327df3(0xc2)),_0x48a88e(_0x2614ff,_0x327df3(0xd2),'genre',_0x327df3(0xde),'content\x20type');try{_0x2614ff[_0x327df3(0xa8)]&&(_0x2614ff['lyrics']=JSON[_0x327df3(0xb0)](_0x2614ff[_0x327df3(0xa8)])),_0x48a88e(_0x2614ff,_0x327df3(0xa8),_0x327df3(0xa8),'','');}catch(_0x377ff0){console[_0x327df3(0xdf)](_0x377ff0);}var _0x2e8ef8;_0x2614ff[_0x327df3(0xad)]&&_0x2614ff[_0x327df3(0xad)][_0x327df3(0xa4)]&&(_0x2e8ef8=_0x2614ff['picture']['data']);!_0x2e8ef8&&_0x2614ff[_0x327df3(0x99)]&&_0x2614ff[_0x327df3(0x99)]['data']&&_0x2614ff[_0x327df3(0x99)]['data']['data']&&(_0x2e8ef8=_0x2614ff[_0x327df3(0x99)]['data']['data']);let _0xafa486='';if(_0x2e8ef8){let _0x4efffd=0x200;_0xafa486=config['getMediaCoverCachePath'](_0x1df24a,_0x4efffd);let _0x41d579=path['join'](path['dirname'](_0xafa486),_0x327df3(0x9b)+path['basename'](_0xafa486));fs['writeFile'](_0x41d579,Buffer[_0x327df3(0xe1)](_0x2e8ef8),{'encoding':_0x327df3(0xcf)},function(_0x570d8e){const _0x188fdd=_0x327df3;_0x570d8e?console[_0x188fdd(0xdf)](_0x570d8e):sharpUtil[_0x188fdd(0xd4)](_0x41d579,path[_0x188fdd(0xb5)](_0xafa486),path[_0x188fdd(0x96)](_0xafa486),_0x188fdd(0xb6),null,_0x46deea=>{const _0x2ccd15=_0x188fdd;_0x1df24a[_0x2ccd15(0x9a)]=_0xafa486,fs['rm'](_0x41d579,_0x1edea8=>{}),_0x440fcc(_0x1df24a);},_0x3b3a20=>{_0x440fcc(_0x1df24a);},_0x4efffd);});}else _0x440fcc(_0x1df24a);},'onError':function(_0x4c8e3a){const _0x2c99cf=_0x34ed79;console[_0x2c99cf(0xdf)](_0x4c8e3a),_0x440fcc(_0x1df24a);}});},module[_0x1550a2(0xa5)]=musicIndexUtil;