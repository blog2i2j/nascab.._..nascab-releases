const _0x77e34b=_0x5a58;function _0x5a58(_0xa5f54b,_0x4201fc){const _0x20c997=_0x20c9();return _0x5a58=function(_0x5a58f6,_0x58c7bd){_0x5a58f6=_0x5a58f6-0x121;let _0x217c58=_0x20c997[_0x5a58f6];return _0x217c58;},_0x5a58(_0xa5f54b,_0x4201fc);}(function(_0x489712,_0x158388){const _0x2996b6=_0x5a58,_0x357bdd=_0x489712();while(!![]){try{const _0x105797=-parseInt(_0x2996b6(0x156))/0x1*(-parseInt(_0x2996b6(0x13e))/0x2)+-parseInt(_0x2996b6(0x12b))/0x3*(-parseInt(_0x2996b6(0x13c))/0x4)+parseInt(_0x2996b6(0x17d))/0x5+parseInt(_0x2996b6(0x126))/0x6*(-parseInt(_0x2996b6(0x147))/0x7)+-parseInt(_0x2996b6(0x14d))/0x8*(-parseInt(_0x2996b6(0x15e))/0x9)+parseInt(_0x2996b6(0x12e))/0xa*(-parseInt(_0x2996b6(0x12d))/0xb)+-parseInt(_0x2996b6(0x136))/0xc*(parseInt(_0x2996b6(0x179))/0xd);if(_0x105797===_0x158388)break;else _0x357bdd['push'](_0x357bdd['shift']());}catch(_0x49ab15){_0x357bdd['push'](_0x357bdd['shift']());}}}(_0x20c9,0x9aa4a));const path=require(_0x77e34b(0x127)),fs=require('fs'),dbFileIndexTable=require(_0x77e34b(0x15b)),config=require(_0x77e34b(0x168)),videoStreamUtil=require('../../utils/videoStreamUtil'),indexUtil=require(_0x77e34b(0x178));let musicUtils=require(_0x77e34b(0x13d));const indexTableName=dbFileIndexTable[_0x77e34b(0x134)],musicIndexUtil={},sharpUtil=require(_0x77e34b(0x167));function _0x20c9(){const _0x3206d2=['tags','lyrics','filename','format','ctimeMs','getMonth','duration','ext','./indexUtil','182NgNcVb','recursionFilesAddIndex','original_date','TPE1','5205060RJOZLq','album','getById','dirname','getDurationFromStream','toLowerCase','addFileIndexToDb','4044102Jeqiwu','path','getMediaCoverCachePath','musicTypeList','Null','1134717rjLXna','music','33xqRBFr','2328690RXszKI','genTinyFile','dealFirstLetterSingle','year','indexOf','is_file','INDEX_TABLE_NAME_MUSIC','getFullYear','1266108XNqepk','string','jsmediatags','dealMediaInfo','streams','content\x20type','12cnxVKd','../../utils/musicUtil','816818EGBGbk','lastInsertRowid','base64','extname','description','birthtime','NaN','image','APIC','7jqVFly','TYER','getDate','type','genre','addOriginalDate','719224fISIgp','length','join','birthtimeMs','picture','atimeMs','exifMinTimeStamp','ceil','dealFileChange','1cAgZHr','stream_info','from','addFinalIndexToDB','TALB','../../db/dbFileIndexTable','getTime','transStringToUtf8','90QBwjgA','data','create','ctime','log','title','exports','getMusicSameNameCover','coverPath','../../express-server/utils/sharpUtils','../../myConfig/config','basename','mtimeMs','original_time','stringify','artist','doesPathCanAddToDb','writeFile'];_0x20c9=function(){return _0x3206d2;};return _0x20c9();}let jsmediatags=require(_0x77e34b(0x138)),musicTypeList=config[_0x77e34b(0x129)];musicIndexUtil[_0x77e34b(0x155)]=async function(_0x59e60c,_0x10e64b,_0x171603){const _0x575e19=_0x77e34b;await indexUtil['dealFileChange'](_0x59e60c,_0x10e64b,_0x171603,indexTableName,musicIndexUtil[_0x575e19(0x125)],musicIndexUtil[_0x575e19(0x17a)]);return;},musicIndexUtil[_0x77e34b(0x17a)]=async function(_0x595ca8,_0x4112a7,_0x12531a){const _0x15b742=_0x77e34b;return await indexUtil[_0x15b742(0x17a)](_0x595ca8,_0x4112a7,indexTableName,_0x15b742(0x12c),_0x12531a,musicIndexUtil[_0x15b742(0x125)]);},musicIndexUtil[_0x77e34b(0x125)]=async function(_0x93e1fb,_0x538b83,_0x2defe7,_0x51e5cd,_0x418ab3,_0x171d58){const _0x1961f7=_0x77e34b;let _0xc8c468=indexUtil[_0x1961f7(0x16e)](_0x93e1fb,'music',config,_0x2defe7,_0x51e5cd);if(!_0xc8c468)return;let _0x2f9afa=_0x171d58[_0x1961f7(0x150)];_0x171d58[_0x1961f7(0x16a)]<_0x2f9afa&&(_0x2f9afa=_0x171d58[_0x1961f7(0x16a)]);_0x171d58[_0x1961f7(0x152)]<_0x2f9afa&&(_0x2f9afa=_0x171d58[_0x1961f7(0x152)]);_0x171d58[_0x1961f7(0x174)]<_0x2f9afa&&(_0x2f9afa=_0x171d58[_0x1961f7(0x174)]);let _0x416328={'path':_0x2defe7,'filename':_0x51e5cd,'is_file':_0x418ab3,'ctime':_0x171d58[_0x1961f7(0x174)],'mtime':_0x171d58['mtimeMs'],'ext':path[_0x1961f7(0x141)](_0x51e5cd),'birthtime':Math[_0x1961f7(0x154)](_0x2f9afa),'size':_0x171d58['size'],'check_time':new Date()[_0x1961f7(0x15c)]()};_0x416328=await musicIndexUtil[_0x1961f7(0x139)](_0x538b83,_0x416328);},musicIndexUtil['dealMediaInfo']=async function(_0x2decbf,_0x3b4588){const _0x4caad6=_0x77e34b;let _0x4a563a=![],_0x1d89b9=path[_0x4caad6(0x14f)](_0x3b4588[_0x4caad6(0x127)],_0x3b4588[_0x4caad6(0x172)]);if(_0x3b4588[_0x4caad6(0x133)]==0x1&&_0x3b4588[_0x4caad6(0x177)]&&musicTypeList['includes'](_0x3b4588[_0x4caad6(0x177)][_0x4caad6(0x124)]())){_0x3b4588[_0x4caad6(0x14a)]=0x3;try{let _0x2209d2=await indexUtil['ffprobeSync'](_0x1d89b9);if(_0x2209d2&&_0x2209d2[_0x4caad6(0x13a)]&&_0x2209d2[_0x4caad6(0x13a)][_0x4caad6(0x14e)]>0x0){_0x3b4588[_0x4caad6(0x157)]=JSON[_0x4caad6(0x16c)](_0x2209d2['streams']);let _0x2c3ca7=videoStreamUtil[_0x4caad6(0x123)](_0x2209d2);_0x2c3ca7&&(_0x3b4588['duration']=_0x2c3ca7);}if(_0x2209d2&&_0x2209d2['format']&&_0x2209d2[_0x4caad6(0x173)][_0x4caad6(0x170)]){let _0x400ef7=_0x2209d2['format']['tags'][_0x4caad6(0x17e)];_0x400ef7&&(_0x3b4588[_0x4caad6(0x17e)]=_0x400ef7),_0x2209d2['format'][_0x4caad6(0x176)]&&!_0x3b4588[_0x4caad6(0x176)]&&(_0x3b4588[_0x4caad6(0x176)]=_0x2209d2[_0x4caad6(0x173)][_0x4caad6(0x176)]);}musicIndexUtil['parseAudioTags'](_0x1d89b9,_0x3b4588,_0x2cf787=>{const _0x225a68=_0x4caad6;return _0x2cf787[_0x225a68(0x17e)]&&(_0x2cf787['album']=musicUtils[_0x225a68(0x15d)](_0x2cf787[_0x225a68(0x17e)])),_0x2cf787['artist']&&(_0x2cf787[_0x225a68(0x16d)]=musicUtils[_0x225a68(0x15d)](_0x2cf787[_0x225a68(0x16d)])),_0x2cf787[_0x225a68(0x163)]&&(_0x2cf787[_0x225a68(0x163)]=musicUtils['transStringToUtf8'](_0x2cf787['title'])),_0x2cf787[_0x225a68(0x171)]&&(_0x2cf787[_0x225a68(0x171)]=musicUtils[_0x225a68(0x15d)](_0x2cf787[_0x225a68(0x171)])),musicIndexUtil[_0x225a68(0x14c)](_0x2decbf,_0x4a563a,_0x2cf787);});}catch(_0x42040){return console['log'](_0x42040),musicIndexUtil['addOriginalDate'](_0x2decbf,_0x4a563a,_0x3b4588);}}else{if(_0x3b4588[_0x4caad6(0x133)]==0x1)return;return musicIndexUtil['addOriginalDate'](_0x2decbf,_0x4a563a,_0x3b4588);}},musicIndexUtil[_0x77e34b(0x14c)]=function(_0x592139,_0xfba909,_0x2dc09e){const _0x5bcf24=_0x77e34b;_0xfba909&&_0xfba909<config[_0x5bcf24(0x153)]&&(_0xfba909=![]);(!_0xfba909||_0xfba909==_0x5bcf24(0x144)||_0xfba909=='Nan'||_0xfba909==_0x5bcf24(0x144)||_0xfba909==_0x5bcf24(0x12a))&&(_0xfba909=_0x2dc09e[_0x5bcf24(0x143)]||_0x2dc09e[_0x5bcf24(0x161)]);let _0x1f94cb=new Date(_0xfba909);_0x2dc09e[_0x5bcf24(0x16b)]=_0x1f94cb[_0x5bcf24(0x15c)]();let _0x5bfaf9=_0x1f94cb[_0x5bcf24(0x135)](),_0x3ba3a4=_0x1f94cb[_0x5bcf24(0x175)]()+0x1;_0x3ba3a4=_0x3ba3a4>=0xa?_0x3ba3a4:'0'+_0x3ba3a4;let _0xadf369=_0x1f94cb[_0x5bcf24(0x149)]();_0xadf369=_0xadf369>=0xa?_0xadf369:'0'+_0xadf369,_0x2dc09e[_0x5bcf24(0x17b)]=_0x5bfaf9+'-'+_0x3ba3a4+'-'+_0xadf369,musicIndexUtil[_0x5bcf24(0x159)](_0x592139,_0x2dc09e);},musicIndexUtil[_0x77e34b(0x159)]=function(_0x12ace3,_0xfa305e){const _0x5bf04d=_0x77e34b;!_0xfa305e[_0x5bf04d(0x17e)]&&(_0xfa305e[_0x5bf04d(0x17e)]=path[_0x5bf04d(0x169)](_0xfa305e[_0x5bf04d(0x127)]));let _0x451e8b=musicUtils[_0x5bf04d(0x165)](_0x12ace3,_0xfa305e);_0xfa305e['fileCoverPath']=_0x451e8b?_0x451e8b:'';let _0x11c74a=dbFileIndexTable[_0x5bf04d(0x160)](_0x12ace3,_0xfa305e,indexTableName);if(_0x11c74a&&_0x11c74a[_0x5bf04d(0x13f)]){let _0x702d1f=dbFileIndexTable[_0x5bf04d(0x121)](_0x12ace3,_0x11c74a[_0x5bf04d(0x13f)],dbFileIndexTable[_0x5bf04d(0x134)]);_0x702d1f&&musicUtils[_0x5bf04d(0x130)](_0x12ace3,_0x702d1f);}},musicIndexUtil['parseAudioTags']=function(_0x2f8985,_0xfa066,_0x216a84){function _0x2c7f89(_0x322185,_0xbcc361,_0x56ad1c,_0x16b451,_0x561240){const _0x4d75b6=_0x5a58;try{!_0xfa066[_0xbcc361]&&(_0x322185[_0x56ad1c]&&typeof _0x322185[_0x56ad1c]==_0x4d75b6(0x137)&&(_0xfa066[_0x56ad1c]=_0x322185[_0x56ad1c]),!_0xfa066[_0xbcc361]&&_0x16b451&&_0x322185[_0x16b451]&&_0x322185[_0x16b451][_0x4d75b6(0x15f)]&&typeof _0x322185[_0x16b451]['data']==_0x4d75b6(0x137)&&_0x322185[_0x16b451][_0x4d75b6(0x142)]&&typeof _0x322185[_0x16b451][_0x4d75b6(0x142)]==_0x4d75b6(0x137)&&_0x322185[_0x16b451][_0x4d75b6(0x142)]['toLowerCase']()[_0x4d75b6(0x132)](_0x561240)!=-0x1&&(_0xfa066[_0xbcc361]=_0x322185[_0x16b451][_0x4d75b6(0x15f)]));}catch(_0xe637c5){console['log'](_0xe637c5);}}jsmediatags['read'](_0x2f8985,{'onSuccess':function(_0x19d29f){const _0x10e004=_0x5a58;let _0x46846d=_0x19d29f['tags'];_0x2c7f89(_0x46846d,_0x10e004(0x17e),_0x10e004(0x17e),_0x10e004(0x15a),'album'),_0x2c7f89(_0x46846d,_0x10e004(0x163),_0x10e004(0x163),'TIT2',_0x10e004(0x163)),_0x2c7f89(_0x46846d,_0x10e004(0x16d),_0x10e004(0x16d),_0x10e004(0x17c),'performer'),_0x2c7f89(_0x46846d,'year','year',_0x10e004(0x148),_0x10e004(0x131)),_0x2c7f89(_0x46846d,_0x10e004(0x14b),'genre',_0x10e004(0x148),_0x10e004(0x13b));try{_0x46846d['lyrics']&&(_0x46846d[_0x10e004(0x171)]=JSON['stringify'](_0x46846d['lyrics'])),_0x2c7f89(_0x46846d,_0x10e004(0x171),'lyrics','','');}catch(_0xcb8872){console['log'](_0xcb8872);}var _0x4d0902;_0x46846d['picture']&&_0x46846d['picture'][_0x10e004(0x15f)]&&(_0x4d0902=_0x46846d[_0x10e004(0x151)][_0x10e004(0x15f)]);!_0x4d0902&&_0x46846d[_0x10e004(0x146)]&&_0x46846d['APIC']['data']&&_0x46846d[_0x10e004(0x146)]['data']['data']&&(_0x4d0902=_0x46846d[_0x10e004(0x146)][_0x10e004(0x15f)][_0x10e004(0x15f)]);let _0x13d97f='';if(_0x4d0902){let _0x5cada0=0x200;_0x13d97f=config[_0x10e004(0x128)](_0xfa066,_0x5cada0);let _0x5ed5a4=path[_0x10e004(0x14f)](path[_0x10e004(0x122)](_0x13d97f),'temp.'+path[_0x10e004(0x169)](_0x13d97f));fs[_0x10e004(0x16f)](_0x5ed5a4,Buffer[_0x10e004(0x158)](_0x4d0902),{'encoding':_0x10e004(0x140)},function(_0x51aa42){const _0x51be2d=_0x10e004;_0x51aa42?console[_0x51be2d(0x162)](_0x51aa42):sharpUtil[_0x51be2d(0x12f)](_0x5ed5a4,path['dirname'](_0x13d97f),path[_0x51be2d(0x169)](_0x13d97f),_0x51be2d(0x145),null,_0x48cb9c=>{const _0x207bad=_0x51be2d;_0xfa066[_0x207bad(0x166)]=_0x13d97f,fs['rm'](_0x5ed5a4,_0x171609=>{}),_0x216a84(_0xfa066);},_0xb1c812=>{_0x216a84(_0xfa066);},_0x5cada0);});}else _0x216a84(_0xfa066);},'onError':function(_0x445bef){console['log'](_0x445bef),_0x216a84(_0xfa066);}});},module[_0x77e34b(0x164)]=musicIndexUtil;