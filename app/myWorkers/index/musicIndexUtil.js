const _0xba7555=_0x5216;(function(_0x21040b,_0x593a57){const _0x1011d8=_0x5216,_0x2880c2=_0x21040b();while(!![]){try{const _0x4182da=parseInt(_0x1011d8(0x1de))/0x1*(-parseInt(_0x1011d8(0x1c6))/0x2)+parseInt(_0x1011d8(0x1cc))/0x3*(parseInt(_0x1011d8(0x1df))/0x4)+parseInt(_0x1011d8(0x1b4))/0x5+-parseInt(_0x1011d8(0x1a7))/0x6*(-parseInt(_0x1011d8(0x1f8))/0x7)+-parseInt(_0x1011d8(0x1d1))/0x8*(parseInt(_0x1011d8(0x1fb))/0x9)+parseInt(_0x1011d8(0x1c0))/0xa*(parseInt(_0x1011d8(0x1b3))/0xb)+-parseInt(_0x1011d8(0x1e7))/0xc;if(_0x4182da===_0x593a57)break;else _0x2880c2['push'](_0x2880c2['shift']());}catch(_0x3bb193){_0x2880c2['push'](_0x2880c2['shift']());}}}(_0x5070,0x6a6d2));const path=require(_0xba7555(0x1c1)),fs=require('fs'),dbFileIndexTable=require(_0xba7555(0x1ea)),config=require(_0xba7555(0x1f3)),videoStreamUtil=require('../../utils/videoStreamUtil'),indexUtil=require('./indexUtil');let musicUtils=require('../../utils/musicUtil');function _0x5216(_0x1e290f,_0xd8d90a){const _0x507059=_0x5070();return _0x5216=function(_0x5216b6,_0x5003ef){_0x5216b6=_0x5216b6-0x1a3;let _0x2ccb6a=_0x507059[_0x5216b6];return _0x2ccb6a;},_0x5216(_0x1e290f,_0xd8d90a);}const indexTableName=dbFileIndexTable[_0xba7555(0x1ca)],musicIndexUtil={},sharpUtil=require('../../express-server/utils/sharpUtils');function _0x5070(){const _0xfce583=['getMusicSameNameCover','exifMinTimeStamp','56WhXTNm','addOriginalDate','getTime','basename','string','lastInsertRowid','getFullYear','doesPathCanAddToDb','mtimeMs','join','birthtime','size','Nan','3008KsNgGi','4bOpYHQ','music','stringify','getMediaCoverCachePath','album','recursionFilesAddIndex','create','APIC','10189572yBNzqy','title','NaN','../../db/dbFileIndexTable','dealFirstLetterSingle','Null','TYER','addFileIndexToDb','ceil','getDate','tags','ctimeMs','../../myConfig/config','parseAudioTags','getMonth','performer','original_time','14wRwnzr','dealFileChange','picture','527157kyQLoW','artist','format','description','lyrics','2513526uGWSqN','duration','log','atimeMs','writeFile','TPE1','genre','transStringToUtf8','jsmediatags','original_date','fileCoverPath','image','1896103elYXqB','1708485nBHStx','addFinalIndexToDB','content\x20type','indexOf','dealMediaInfo','year','from','TALB','temp.','musicTypeList','base64','extname','10LUAmWx','path','ffprobeSync','dirname','birthtimeMs','filename','304XBspqQ','TIT2','streams','coverPath','INDEX_TABLE_NAME_MUSIC','toLowerCase','2401104psNTkR','includes','data'];_0x5070=function(){return _0xfce583;};return _0x5070();}let jsmediatags=require(_0xba7555(0x1af)),musicTypeList=config[_0xba7555(0x1bd)];musicIndexUtil[_0xba7555(0x1f9)]=async function(_0xdb1ddc,_0x26ba2b,_0x2608ed){const _0x5ca85e=_0xba7555;await indexUtil[_0x5ca85e(0x1f9)](_0xdb1ddc,_0x26ba2b,_0x2608ed,indexTableName,musicIndexUtil['addFileIndexToDb'],musicIndexUtil['recursionFilesAddIndex']);return;},musicIndexUtil[_0xba7555(0x1e4)]=async function(_0x2c9817,_0x212dc2,_0x5a1385){const _0x539ba4=_0xba7555;return await indexUtil['recursionFilesAddIndex'](_0x2c9817,_0x212dc2,indexTableName,'music',_0x5a1385,musicIndexUtil[_0x539ba4(0x1ee)]);},musicIndexUtil[_0xba7555(0x1ee)]=async function(_0x15ce25,_0x2df323,_0x540bb5,_0x16d505,_0x5707ee,_0x7b840d){const _0x3e3ed1=_0xba7555;let _0x7655ff=indexUtil[_0x3e3ed1(0x1d8)](_0x15ce25,_0x3e3ed1(0x1e0),config,_0x540bb5,_0x16d505);if(!_0x7655ff)return;let _0x363757=_0x7b840d[_0x3e3ed1(0x1c4)];_0x7b840d['mtimeMs']<_0x363757&&(_0x363757=_0x7b840d[_0x3e3ed1(0x1d9)]);_0x7b840d[_0x3e3ed1(0x1aa)]<_0x363757&&(_0x363757=_0x7b840d[_0x3e3ed1(0x1aa)]);_0x7b840d[_0x3e3ed1(0x1f2)]<_0x363757&&(_0x363757=_0x7b840d['ctimeMs']);let _0x1a8f49={'path':_0x540bb5,'filename':_0x16d505,'is_file':_0x5707ee,'ctime':_0x7b840d['ctimeMs'],'mtime':_0x7b840d[_0x3e3ed1(0x1d9)],'ext':path[_0x3e3ed1(0x1bf)](_0x16d505),'birthtime':Math[_0x3e3ed1(0x1ef)](_0x363757),'size':_0x7b840d[_0x3e3ed1(0x1dc)],'check_time':new Date()[_0x3e3ed1(0x1d3)]()};_0x1a8f49=await musicIndexUtil['dealMediaInfo'](_0x2df323,_0x1a8f49);},musicIndexUtil[_0xba7555(0x1b8)]=async function(_0x481199,_0x1ad9ec){const _0x2ed5b0=_0xba7555;let _0x2e97cf=![],_0x55cdf4=path[_0x2ed5b0(0x1da)](_0x1ad9ec['path'],_0x1ad9ec[_0x2ed5b0(0x1c5)]);if(_0x1ad9ec['is_file']==0x1&&_0x1ad9ec['ext']&&musicTypeList[_0x2ed5b0(0x1cd)](_0x1ad9ec['ext'][_0x2ed5b0(0x1cb)]())){_0x1ad9ec['type']=0x3;try{let _0x40916f=await indexUtil[_0x2ed5b0(0x1c2)](_0x55cdf4);if(_0x40916f&&_0x40916f[_0x2ed5b0(0x1c8)]&&_0x40916f['streams']['length']>0x0){_0x1ad9ec['stream_info']=JSON[_0x2ed5b0(0x1e1)](_0x40916f['streams']);let _0x19b4fe=videoStreamUtil['getDurationFromStream'](_0x40916f);_0x19b4fe&&(_0x1ad9ec[_0x2ed5b0(0x1a8)]=_0x19b4fe);}if(_0x40916f&&_0x40916f['format']&&_0x40916f['format']['tags']){let _0x252f67=_0x40916f[_0x2ed5b0(0x1a4)][_0x2ed5b0(0x1f1)][_0x2ed5b0(0x1e3)];_0x252f67&&(_0x1ad9ec[_0x2ed5b0(0x1e3)]=_0x252f67),_0x40916f['format'][_0x2ed5b0(0x1a8)]&&!_0x1ad9ec[_0x2ed5b0(0x1a8)]&&(_0x1ad9ec[_0x2ed5b0(0x1a8)]=_0x40916f[_0x2ed5b0(0x1a4)]['duration']);}musicIndexUtil[_0x2ed5b0(0x1f4)](_0x55cdf4,_0x1ad9ec,_0x11bd64=>{const _0x1b4925=_0x2ed5b0;return _0x11bd64[_0x1b4925(0x1e3)]&&(_0x11bd64[_0x1b4925(0x1e3)]=musicUtils[_0x1b4925(0x1ae)](_0x11bd64['album'])),_0x11bd64[_0x1b4925(0x1a3)]&&(_0x11bd64[_0x1b4925(0x1a3)]=musicUtils[_0x1b4925(0x1ae)](_0x11bd64['artist'])),_0x11bd64['title']&&(_0x11bd64[_0x1b4925(0x1e8)]=musicUtils[_0x1b4925(0x1ae)](_0x11bd64['title'])),_0x11bd64['lyrics']&&(_0x11bd64['lyrics']=musicUtils['transStringToUtf8'](_0x11bd64[_0x1b4925(0x1a6)])),musicIndexUtil[_0x1b4925(0x1d2)](_0x481199,_0x2e97cf,_0x11bd64);});}catch(_0x54d547){return console[_0x2ed5b0(0x1a9)](_0x54d547),musicIndexUtil['addOriginalDate'](_0x481199,_0x2e97cf,_0x1ad9ec);}}else{if(_0x1ad9ec['is_file']==0x1)return;return musicIndexUtil['addOriginalDate'](_0x481199,_0x2e97cf,_0x1ad9ec);}},musicIndexUtil[_0xba7555(0x1d2)]=function(_0x3ab1db,_0x211b36,_0x36004f){const _0xf3fc6a=_0xba7555;_0x211b36&&_0x211b36<config[_0xf3fc6a(0x1d0)]&&(_0x211b36=![]);(!_0x211b36||_0x211b36=='NaN'||_0x211b36==_0xf3fc6a(0x1dd)||_0x211b36==_0xf3fc6a(0x1e9)||_0x211b36==_0xf3fc6a(0x1ec))&&(_0x211b36=_0x36004f[_0xf3fc6a(0x1db)]||_0x36004f['ctime']);let _0x40efdd=new Date(_0x211b36);_0x36004f[_0xf3fc6a(0x1f7)]=_0x40efdd[_0xf3fc6a(0x1d3)]();let _0x4c20fc=_0x40efdd[_0xf3fc6a(0x1d7)](),_0x308ace=_0x40efdd[_0xf3fc6a(0x1f5)]()+0x1;_0x308ace=_0x308ace>=0xa?_0x308ace:'0'+_0x308ace;let _0x67a368=_0x40efdd[_0xf3fc6a(0x1f0)]();_0x67a368=_0x67a368>=0xa?_0x67a368:'0'+_0x67a368,_0x36004f[_0xf3fc6a(0x1b0)]=_0x4c20fc+'-'+_0x308ace+'-'+_0x67a368,musicIndexUtil[_0xf3fc6a(0x1b5)](_0x3ab1db,_0x36004f);},musicIndexUtil[_0xba7555(0x1b5)]=function(_0x112c1e,_0x32f0f9){const _0x8bfa7b=_0xba7555;!_0x32f0f9['album']&&(_0x32f0f9['album']=path[_0x8bfa7b(0x1d4)](_0x32f0f9['path']));let _0x52e015=musicUtils[_0x8bfa7b(0x1cf)](_0x112c1e,_0x32f0f9);_0x32f0f9[_0x8bfa7b(0x1b1)]=_0x52e015?_0x52e015:'';let _0x13c7b7=dbFileIndexTable[_0x8bfa7b(0x1e5)](_0x112c1e,_0x32f0f9,indexTableName);if(_0x13c7b7&&_0x13c7b7['lastInsertRowid']){let _0xc0c880=dbFileIndexTable['getById'](_0x112c1e,_0x13c7b7[_0x8bfa7b(0x1d6)],dbFileIndexTable[_0x8bfa7b(0x1ca)]);_0xc0c880&&musicUtils[_0x8bfa7b(0x1eb)](_0x112c1e,_0xc0c880);}},musicIndexUtil[_0xba7555(0x1f4)]=function(_0x5764f9,_0x5b7060,_0x150eef){function _0x10f8e5(_0x2ca471,_0x5091d6,_0x9b5102,_0x5d0c75,_0x194084){const _0xbc29bd=_0x5216;try{!_0x5b7060[_0x5091d6]&&(_0x2ca471[_0x9b5102]&&typeof _0x2ca471[_0x9b5102]==_0xbc29bd(0x1d5)&&(_0x5b7060[_0x9b5102]=_0x2ca471[_0x9b5102]),!_0x5b7060[_0x5091d6]&&_0x5d0c75&&_0x2ca471[_0x5d0c75]&&_0x2ca471[_0x5d0c75][_0xbc29bd(0x1ce)]&&typeof _0x2ca471[_0x5d0c75][_0xbc29bd(0x1ce)]==_0xbc29bd(0x1d5)&&_0x2ca471[_0x5d0c75][_0xbc29bd(0x1a5)]&&typeof _0x2ca471[_0x5d0c75]['description']=='string'&&_0x2ca471[_0x5d0c75][_0xbc29bd(0x1a5)]['toLowerCase']()[_0xbc29bd(0x1b7)](_0x194084)!=-0x1&&(_0x5b7060[_0x5091d6]=_0x2ca471[_0x5d0c75][_0xbc29bd(0x1ce)]));}catch(_0x50486f){console[_0xbc29bd(0x1a9)](_0x50486f);}}jsmediatags['read'](_0x5764f9,{'onSuccess':function(_0x4f6c61){const _0x22932f=_0x5216;let _0x4f19e4=_0x4f6c61[_0x22932f(0x1f1)];_0x10f8e5(_0x4f19e4,_0x22932f(0x1e3),_0x22932f(0x1e3),_0x22932f(0x1bb),'album'),_0x10f8e5(_0x4f19e4,_0x22932f(0x1e8),_0x22932f(0x1e8),_0x22932f(0x1c7),_0x22932f(0x1e8)),_0x10f8e5(_0x4f19e4,_0x22932f(0x1a3),'artist',_0x22932f(0x1ac),_0x22932f(0x1f6)),_0x10f8e5(_0x4f19e4,'year',_0x22932f(0x1b9),_0x22932f(0x1ed),_0x22932f(0x1b9)),_0x10f8e5(_0x4f19e4,_0x22932f(0x1ad),_0x22932f(0x1ad),_0x22932f(0x1ed),_0x22932f(0x1b6));try{_0x4f19e4['lyrics']&&(_0x4f19e4['lyrics']=JSON[_0x22932f(0x1e1)](_0x4f19e4[_0x22932f(0x1a6)])),_0x10f8e5(_0x4f19e4,_0x22932f(0x1a6),'lyrics','','');}catch(_0x822dce){console['log'](_0x822dce);}var _0x27d161;_0x4f19e4[_0x22932f(0x1fa)]&&_0x4f19e4[_0x22932f(0x1fa)][_0x22932f(0x1ce)]&&(_0x27d161=_0x4f19e4[_0x22932f(0x1fa)][_0x22932f(0x1ce)]);!_0x27d161&&_0x4f19e4[_0x22932f(0x1e6)]&&_0x4f19e4[_0x22932f(0x1e6)][_0x22932f(0x1ce)]&&_0x4f19e4[_0x22932f(0x1e6)][_0x22932f(0x1ce)][_0x22932f(0x1ce)]&&(_0x27d161=_0x4f19e4[_0x22932f(0x1e6)][_0x22932f(0x1ce)][_0x22932f(0x1ce)]);let _0x4082d7='';if(_0x27d161){let _0x4f0988=0x200;_0x4082d7=config[_0x22932f(0x1e2)](_0x5b7060,_0x4f0988);let _0x434069=path[_0x22932f(0x1da)](path[_0x22932f(0x1c3)](_0x4082d7),_0x22932f(0x1bc)+path[_0x22932f(0x1d4)](_0x4082d7));fs[_0x22932f(0x1ab)](_0x434069,Buffer[_0x22932f(0x1ba)](_0x27d161),{'encoding':_0x22932f(0x1be)},function(_0x4073ba){const _0x425bdf=_0x22932f;_0x4073ba?console['log'](_0x4073ba):sharpUtil['genTinyFile'](_0x434069,path['dirname'](_0x4082d7),path[_0x425bdf(0x1d4)](_0x4082d7),_0x425bdf(0x1b2),null,_0x1a150d=>{const _0x4fde31=_0x425bdf;_0x5b7060[_0x4fde31(0x1c9)]=_0x4082d7,fs['rm'](_0x434069,_0x1b87fa=>{}),_0x150eef(_0x5b7060);},_0x2f7810=>{_0x150eef(_0x5b7060);},_0x4f0988);});}else _0x150eef(_0x5b7060);},'onError':function(_0x4834d3){console['log'](_0x4834d3),_0x150eef(_0x5b7060);}});},module['exports']=musicIndexUtil;