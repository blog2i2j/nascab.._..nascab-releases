const _0x2b174b=_0x54e4;(function(_0x12a87c,_0x3b2cb1){const _0x170c77=_0x54e4,_0x12c0b6=_0x12a87c();while(!![]){try{const _0xd16c96=-parseInt(_0x170c77(0x9e))/0x1+parseInt(_0x170c77(0x92))/0x2+parseInt(_0x170c77(0x82))/0x3*(parseInt(_0x170c77(0x9b))/0x4)+parseInt(_0x170c77(0xa0))/0x5*(-parseInt(_0x170c77(0x8b))/0x6)+-parseInt(_0x170c77(0x8a))/0x7+parseInt(_0x170c77(0xa4))/0x8+-parseInt(_0x170c77(0x9f))/0x9*(parseInt(_0x170c77(0xac))/0xa);if(_0xd16c96===_0x3b2cb1)break;else _0x12c0b6['push'](_0x12c0b6['shift']());}catch(_0x563ae5){_0x12c0b6['push'](_0x12c0b6['shift']());}}}(_0x5210,0x426c6));const fs=require('fs'),path=require('path'),config=require(_0x2b174b(0x97)),Database=require(_0x2b174b(0xa5)),dbOther=new Database(config[_0x2b174b(0x86)],{}),dbFileIndex=new Database(config[_0x2b174b(0x98)],{});dbFileIndex['pragma'](_0x2b174b(0x87)),dbOther[_0x2b174b(0x8d)](_0x2b174b(0x87));const dbFileIndexTable=require(_0x2b174b(0x85));process[_0x2b174b(0x93)]=_0x2b174b(0x84);const bookIndexUtil=require(_0x2b174b(0x89)),indexTableName=dbFileIndexTable[_0x2b174b(0xa8)],dbScanTaskTable=require(_0x2b174b(0x8e)),indexUtil=require(_0x2b174b(0x83));process['on'](_0x2b174b(0x9d),(_0x53e24e,_0x293d66)=>{const _0x490cf5=_0x2b174b;console[_0x490cf5(0x88)](_0x490cf5(0x94),_0x53e24e);});function _0x54e4(_0x2c5c30,_0x3c0e48){const _0x52102a=_0x5210();return _0x54e4=function(_0x54e4d4,_0x4ec87b){_0x54e4d4=_0x54e4d4-0x82;let _0x2fbb36=_0x52102a[_0x54e4d4];return _0x2fbb36;},_0x54e4(_0x2c5c30,_0x3c0e48);}function _0x5210(){const _0x1e47de=['prepare','文件数量','560724nvZAiX','title','Error\x20occurred\x20','isDirectory','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','../../myConfig/config','dbFileIndex','then','耗时:','1471824ONYfty','scan_path','uncaughtException','389276xmuJDi','1611gpwmAr','5qcmLRe','要扫描的目录不是文件夹','recursionDeleteIndex','run','3554112KDtbpw','better-sqlite3','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','SCAN_TYPE_BOOK','INDEX_TABLE_NAME_BOOK','now','扫描目录已不存在\x20','setIndexingState','7630BEaYuE','3WzgfzZ','./indexUtil','NasCabBookIndexWorker','../../db/dbFileIndexTable','dbOther','journal_mode\x20=\x20WAL','log','./bookIndexUtil','1853467tbgWGG','179268JtJcuG','文件夹数量','pragma','../../db/dbScanTaskTable','图书管理:\x20开始扫描'];_0x5210=function(){return _0x1e47de;};return _0x5210();}async function startIndexingFolder(_0x322bb0){return new Promise(async(_0x499f0e,_0x55c98e)=>{const _0x2c573e=_0x54e4;try{let _0x30aabb=new Date()['getTime'](),_0x166a4f=fs['statSync'](_0x322bb0);if(!_0x166a4f[_0x2c573e(0x95)]())return console[_0x2c573e(0x88)](_0x2c573e(0xa1),_0x322bb0),_0x499f0e();console[_0x2c573e(0x88)](_0x2c573e(0x8f),_0x322bb0),await indexUtil[_0x2c573e(0xa2)](dbFileIndex,indexTableName,_0x322bb0);let {checkFileCount:_0xbbc62a,checkPathCount:_0x11dc68}=await bookIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x322bb0);console[_0x2c573e(0x88)]('图书管理：扫描完成：'+_0x322bb0,_0x2c573e(0x9a),new Date()['getTime']()-_0x30aabb,'ms',_0x2c573e(0x8c),_0x11dc68,_0x2c573e(0x91),_0xbbc62a),_0x499f0e();}catch(_0x5eba08){console[_0x2c573e(0x88)](_0x2c573e(0xaa),_0x322bb0),_0x499f0e();}});}async function runScanTask(){const _0x578b7b=_0x2b174b;let _0x39020f=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x578b7b(0xa7)]);_0x39020f?(dbOther[_0x578b7b(0x90)](_0x578b7b(0x96))[_0x578b7b(0xa3)](Date[_0x578b7b(0xa9)](),_0x39020f[_0x578b7b(0x9c)]),startIndexingFolder(_0x39020f[_0x578b7b(0x9c)])[_0x578b7b(0x99)](()=>{dbScanTaskTable['deleteTask'](dbOther,_0x39020f['id']),runScanTask();})):(console[_0x578b7b(0x88)](_0x578b7b(0xa6)),indexUtil[_0x578b7b(0xab)](dbOther,indexTableName,![]),process['exit']());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();