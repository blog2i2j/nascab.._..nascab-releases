function _0x2143(){const _0x26d073=['28952ttrjNR','getTime','SCAN_TYPE_BOOK','文件夹数量','扫描目录已不存在\x20','scan_path','3693010YzyQpL','图书管理：扫描完成：','5454054mWQkER','18RhGFpL','1333140CFGDHs','prepare','../../myConfig/config','run','exit','then','./indexUtil','要扫描的目录不是文件夹','文件数量','statSync','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','setIndexingState','now','../../db/dbFileIndexTable','path','dbFileIndex','162666zWzMUN','5wsToBd','./bookIndexUtil','94pxrWNT','better-sqlite3','uncaughtException','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','../../db/dbScanTaskTable','3350032PANiPe','deleteTask','8071920FktMEE','title','journal_mode\x20=\x20WAL','isDirectory','pragma','log','recursionDeleteIndex'];_0x2143=function(){return _0x26d073;};return _0x2143();}const _0x59e82f=_0x18cc;(function(_0x3fcb2d,_0xa06f8d){const _0x39d529=_0x18cc,_0x2706d9=_0x3fcb2d();while(!![]){try{const _0x3d9fdf=-parseInt(_0x39d529(0x199))/0x1*(-parseInt(_0x39d529(0x18b))/0x2)+-parseInt(_0x39d529(0x178))/0x3+-parseInt(_0x39d529(0x190))/0x4*(parseInt(_0x39d529(0x189))/0x5)+parseInt(_0x39d529(0x176))/0x6+-parseInt(_0x39d529(0x188))/0x7+-parseInt(_0x39d529(0x192))/0x8+parseInt(_0x39d529(0x177))/0x9*(parseInt(_0x39d529(0x174))/0xa);if(_0x3d9fdf===_0xa06f8d)break;else _0x2706d9['push'](_0x2706d9['shift']());}catch(_0x59148d){_0x2706d9['push'](_0x2706d9['shift']());}}}(_0x2143,0xa97df));const fs=require('fs'),path=require(_0x59e82f(0x186)),config=require(_0x59e82f(0x17a)),Database=require(_0x59e82f(0x18c)),dbOther=new Database(config['dbOther'],{}),dbFileIndex=new Database(config[_0x59e82f(0x187)],{});dbFileIndex['pragma'](_0x59e82f(0x194)),dbOther[_0x59e82f(0x196)]('journal_mode\x20=\x20WAL');const dbFileIndexTable=require(_0x59e82f(0x185));process[_0x59e82f(0x193)]='NasCabBookIndexWorker';const bookIndexUtil=require(_0x59e82f(0x18a)),indexTableName=dbFileIndexTable['INDEX_TABLE_NAME_BOOK'],dbScanTaskTable=require(_0x59e82f(0x18f)),indexUtil=require(_0x59e82f(0x17e));process['on'](_0x59e82f(0x18d),(_0x374bbd,_0x2c2d03)=>{const _0x90dde0=_0x59e82f;console[_0x90dde0(0x197)]('Error\x20occurred\x20',_0x374bbd);});async function startIndexingFolder(_0x82d6ec){return new Promise(async(_0x3518af,_0x24ba9a)=>{const _0x16eb1b=_0x18cc;try{let _0xf6a021=new Date()['getTime'](),_0x4c7357=fs[_0x16eb1b(0x181)](_0x82d6ec);if(!_0x4c7357[_0x16eb1b(0x195)]())return console['log'](_0x16eb1b(0x17f),_0x82d6ec),_0x3518af();console[_0x16eb1b(0x197)]('图书管理:\x20开始扫描',_0x82d6ec),await indexUtil[_0x16eb1b(0x198)](dbFileIndex,indexTableName,_0x82d6ec);let {checkFileCount:_0x428667,checkPathCount:_0x597f7c}=await bookIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x82d6ec);console['log'](_0x16eb1b(0x175)+_0x82d6ec,'耗时:',new Date()[_0x16eb1b(0x19a)]()-_0xf6a021,'ms',_0x16eb1b(0x19c),_0x597f7c,_0x16eb1b(0x180),_0x428667),_0x3518af();}catch(_0x189b14){console[_0x16eb1b(0x197)](_0x16eb1b(0x172),_0x82d6ec),_0x3518af();}});}async function runScanTask(){const _0x2a9c0f=_0x59e82f;let _0x5359cb=dbScanTaskTable['getOnTask'](dbOther,dbScanTaskTable[_0x2a9c0f(0x19b)]);_0x5359cb?(dbOther[_0x2a9c0f(0x179)](_0x2a9c0f(0x18e))[_0x2a9c0f(0x17b)](Date[_0x2a9c0f(0x184)](),_0x5359cb[_0x2a9c0f(0x173)]),startIndexingFolder(_0x5359cb['scan_path'])[_0x2a9c0f(0x17d)](()=>{const _0x276a38=_0x2a9c0f;dbScanTaskTable[_0x276a38(0x191)](dbOther,_0x5359cb['id']),runScanTask();})):(console[_0x2a9c0f(0x197)](_0x2a9c0f(0x182)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process[_0x2a9c0f(0x17c)]());}function _0x18cc(_0x24038b,_0x1a3166){const _0x21432e=_0x2143();return _0x18cc=function(_0x18cc6e,_0x522aef){_0x18cc6e=_0x18cc6e-0x172;let _0x2bbe5a=_0x21432e[_0x18cc6e];return _0x2bbe5a;},_0x18cc(_0x24038b,_0x1a3166);}indexUtil[_0x59e82f(0x183)](dbOther,indexTableName,!![]),runScanTask();