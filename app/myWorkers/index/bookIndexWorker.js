const _0x1a86c6=_0x190f;(function(_0x4c2e03,_0xc37f4d){const _0x58705b=_0x190f,_0x46a4f4=_0x4c2e03();while(!![]){try{const _0x326924=-parseInt(_0x58705b(0x1e9))/0x1*(parseInt(_0x58705b(0x1e0))/0x2)+-parseInt(_0x58705b(0x1e4))/0x3*(-parseInt(_0x58705b(0x1f2))/0x4)+parseInt(_0x58705b(0x1e3))/0x5+-parseInt(_0x58705b(0x1e2))/0x6+parseInt(_0x58705b(0x1f4))/0x7*(-parseInt(_0x58705b(0x1f0))/0x8)+parseInt(_0x58705b(0x1f8))/0x9+parseInt(_0x58705b(0x1de))/0xa;if(_0x326924===_0xc37f4d)break;else _0x46a4f4['push'](_0x46a4f4['shift']());}catch(_0x24b08d){_0x46a4f4['push'](_0x46a4f4['shift']());}}}(_0x4634,0x82730));const fs=require('fs'),path=require('path'),config=require(_0x1a86c6(0x1e1)),Database=require('better-sqlite3'),dbOther=new Database(config[_0x1a86c6(0x1f7)],{}),dbFileIndex=new Database(config['dbFileIndex'],{});dbFileIndex[_0x1a86c6(0x1ff)](_0x1a86c6(0x1df)),dbOther[_0x1a86c6(0x1ff)](_0x1a86c6(0x1df));const dbFileIndexTable=require('../../db/dbFileIndexTable');process['title']=_0x1a86c6(0x1dd);function _0x4634(){const _0x2b5e6a=['exit','Error\x20occurred\x20','275bNpVGk','耗时:','now','getOnTask','recursionDeleteIndex','图书管理:未找到扫描任务[Books\x20scanning\x20task\x20not\x20found]','log','2189256zfPjKT','deleteTask','39544CLcYBs','UPDATE\x20source_folder\x20SET\x20last_scan_time=?\x20\x20WHERE\x20path=?\x20and\x20type=\x27book\x27','14ElGnlA','文件夹数量','isDirectory','dbOther','2749707YPdvjE','scan_path','扫描目录已不存在\x20','要扫描的目录不是文件夹','文件数量','uncaughtException','INDEX_TABLE_NAME_BOOK','pragma','../../db/dbScanTaskTable','then','./indexUtil','NasCabBookIndexWorker','6205200yvtDNs','journal_mode\x20=\x20WAL','5438aCtvQR','../../myConfig/config','4105938ioPudV','3687215uEWisQ','258QovAYE','statSync','getTime'];_0x4634=function(){return _0x2b5e6a;};return _0x4634();}const bookIndexUtil=require('./bookIndexUtil'),indexTableName=dbFileIndexTable[_0x1a86c6(0x1fe)],dbScanTaskTable=require(_0x1a86c6(0x200)),indexUtil=require(_0x1a86c6(0x202));function _0x190f(_0x2f7534,_0x5b9da5){const _0x4634a7=_0x4634();return _0x190f=function(_0x190f05,_0x559232){_0x190f05=_0x190f05-0x1dd;let _0x399813=_0x4634a7[_0x190f05];return _0x399813;},_0x190f(_0x2f7534,_0x5b9da5);}process['on'](_0x1a86c6(0x1fd),(_0x515016,_0x5c1631)=>{const _0x26d91c=_0x1a86c6;console[_0x26d91c(0x1ef)](_0x26d91c(0x1e8),_0x515016);});async function startIndexingFolder(_0x30b044){return new Promise(async(_0xfb0211,_0x14f9a8)=>{const _0x5903a5=_0x190f;try{let _0x3ba2e6=new Date()[_0x5903a5(0x1e6)](),_0x33c4c1=fs[_0x5903a5(0x1e5)](_0x30b044);if(!_0x33c4c1[_0x5903a5(0x1f6)]())return console[_0x5903a5(0x1ef)](_0x5903a5(0x1fb),_0x30b044),_0xfb0211();console[_0x5903a5(0x1ef)]('图书管理:\x20开始扫描',_0x30b044),await indexUtil[_0x5903a5(0x1ed)](dbFileIndex,indexTableName,_0x30b044);let {checkFileCount:_0x5ec24d,checkPathCount:_0x148e8b}=await bookIndexUtil['recursionFilesAddIndex'](dbOther,dbFileIndex,_0x30b044);console[_0x5903a5(0x1ef)]('图书管理：扫描完成：'+_0x30b044,_0x5903a5(0x1ea),new Date()[_0x5903a5(0x1e6)]()-_0x3ba2e6,'ms',_0x5903a5(0x1f5),_0x148e8b,_0x5903a5(0x1fc),_0x5ec24d),_0xfb0211();}catch(_0x451dca){console[_0x5903a5(0x1ef)](_0x5903a5(0x1fa),_0x30b044),_0xfb0211();}});}async function runScanTask(){const _0x671107=_0x1a86c6;let _0x1e49b8=dbScanTaskTable[_0x671107(0x1ec)](dbOther,dbScanTaskTable['SCAN_TYPE_BOOK']);_0x1e49b8?(dbOther['prepare'](_0x671107(0x1f3))['run'](Date[_0x671107(0x1eb)](),_0x1e49b8['scan_path']),startIndexingFolder(_0x1e49b8[_0x671107(0x1f9)])[_0x671107(0x201)](()=>{const _0x5271de=_0x671107;dbScanTaskTable[_0x5271de(0x1f1)](dbOther,_0x1e49b8['id']),runScanTask();})):(console[_0x671107(0x1ef)](_0x671107(0x1ee)),indexUtil['setIndexingState'](dbOther,indexTableName,![]),process[_0x671107(0x1e7)]());}indexUtil['setIndexingState'](dbOther,indexTableName,!![]),runScanTask();