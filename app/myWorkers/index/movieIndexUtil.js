const _0xa41336=_0x4627;(function(_0x40a914,_0x5c9c0a){const _0x41b0fc=_0x4627,_0x112799=_0x40a914();while(!![]){try{const _0x422216=parseInt(_0x41b0fc(0x1a8))/0x1+-parseInt(_0x41b0fc(0x18a))/0x2*(parseInt(_0x41b0fc(0x19a))/0x3)+parseInt(_0x41b0fc(0x14e))/0x4*(-parseInt(_0x41b0fc(0x185))/0x5)+-parseInt(_0x41b0fc(0x15e))/0x6+-parseInt(_0x41b0fc(0x181))/0x7+parseInt(_0x41b0fc(0x172))/0x8*(-parseInt(_0x41b0fc(0x19d))/0x9)+-parseInt(_0x41b0fc(0x16d))/0xa*(-parseInt(_0x41b0fc(0x162))/0xb);if(_0x422216===_0x5c9c0a)break;else _0x112799['push'](_0x112799['shift']());}catch(_0x191289){_0x112799['push'](_0x112799['shift']());}}}(_0x540c,0xe9e7a));const path=require(_0xa41336(0x178)),dbFileIndexTable=require(_0xa41336(0x15d)),config=require(_0xa41336(0x16b)),exifUtil=require(_0xa41336(0x14d)),videoStreamUtil=require(_0xa41336(0x1aa)),indexUtil=require(_0xa41336(0x150)),movieUtil=require(_0xa41336(0x195)),indexTableName=dbFileIndexTable[_0xa41336(0x17d)],movieIndexUtil={};function _0x540c(){const _0x9b8252=['originalTime','location','show_in_list','mode','is_file','ffprobeSync','endsWith','1362454DxWcrY','filename','../../utils/videoStreamUtil','/BDMV/STREAM','../../utils/exifUtils','1855076bwFLOy','doesPathCanAddToDb','./indexUtil','com.apple.quicktime.location.ISO6709','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x201\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20IN\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20t1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x20t1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INNER\x20JOIN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20path,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min(filename)\x20AS\x20filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x20path\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t2\x20ON\x20t1.path\x20=\x20t2.path\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t1.filename\x20=\x20t2.filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','影音管理：电视剧状态处理完成,耗时:','duration','log','dealFirstLetterSingle','getTime','birthtime','/bdmv/stream','streams','tags','影音管理：设置电视剧状态出错','../../db/dbFileIndexTable','11020602KduGel','getDate','recursionFilesAddIndex','addFileIndexToDb','11aNcuSB','location-eng','getFullYear','prepare','stringify','toLowerCase','addOriginalDate','getFilenameNumber','dealFileChange','../../myConfig/config','birthtimeMs','51161790xMZHny','ctimeMs','getMonth','tvplay','is_tvplay','8odChsr','UPDATE\x20','size','videoHeight','length','replace','path','parseVideoWH','substring','type','format','INDEX_TABLE_NAME_MOVIE','getExifInfo','videoWidth','ctime','7428785NvXdKq','ceil','rawImgTypeList','media_type','5PPLxav','movie','atimeMs','latitude','dealMediaInfo','3722TuvDwE','ext','\x5cbdmv\x5cstream','getById','dealTvDrama','height','transaction','width','lastInsertRowid','creation_time','create','../../express-server/utils/movieUtil','includes','mtimeMs','needDealTvDrama','run','1947FwJuGM','basename','push','8558811XVGVCi','original_date','\x20as\x20t\x20SET\x20show_in_list\x20=\x201,show_name=?\x20WHERE\x20path=?\x20AND\x20duration>1800','\x5cBDMV\x5cSTREAM'];_0x540c=function(){return _0x9b8252;};return _0x540c();}movieIndexUtil[_0xa41336(0x198)]=!![];function _0x4627(_0x3b423c,_0x2db1a4){const _0x540c1b=_0x540c();return _0x4627=function(_0x462717,_0x261caa){_0x462717=_0x462717-0x14d;let _0x45b8b0=_0x540c1b[_0x462717];return _0x45b8b0;},_0x4627(_0x3b423c,_0x2db1a4);}let lastDealTvDramaTimestamp=0x0;movieIndexUtil[_0xa41336(0x16a)]=async function(_0x3c4d3b,_0x345b73,_0x41a171){const _0x3ee321=_0xa41336;await indexUtil[_0x3ee321(0x16a)](_0x3c4d3b,_0x345b73,_0x41a171,indexTableName,movieIndexUtil[_0x3ee321(0x161)],movieIndexUtil[_0x3ee321(0x160)]);return;},movieIndexUtil[_0xa41336(0x160)]=async function(_0x472c31,_0x12cb89,_0x25dfac){const _0x88112c=_0xa41336;return await indexUtil['recursionFilesAddIndex'](_0x472c31,_0x12cb89,indexTableName,_0x88112c(0x186),_0x25dfac,movieIndexUtil[_0x88112c(0x161)],()=>{const _0x5f4a43=_0x88112c;let _0x361399=new Date()[_0x5f4a43(0x157)]()-lastDealTvDramaTimestamp;movieIndexUtil[_0x5f4a43(0x198)]&&_0x361399>0x1d4c0&&(movieIndexUtil[_0x5f4a43(0x18e)](_0x12cb89),lastDealTvDramaTimestamp=new Date()[_0x5f4a43(0x157)]());});},movieIndexUtil['addFileIndexToDb']=async function(_0x388765,_0x1e265a,_0x22845a,_0x4e4e52,_0x25f679,_0x1574e5){const _0x2fcbde=_0xa41336;let _0x4e3768={'path':_0x22845a,'filename':_0x4e4e52,'is_file':_0x25f679},_0x33fbcc=indexUtil[_0x2fcbde(0x14f)](_0x388765,_0x2fcbde(0x186),config,_0x22845a,_0x4e4e52);if(!_0x33fbcc)return;_0x33fbcc[_0x2fcbde(0x184)]==_0x2fcbde(0x170)&&(_0x4e3768[_0x2fcbde(0x171)]=0x1,_0x4e3768[_0x2fcbde(0x1a3)]=0x0);let _0x19ed06=_0x1574e5[_0x2fcbde(0x16c)];_0x1574e5[_0x2fcbde(0x197)]<_0x19ed06&&(_0x19ed06=_0x1574e5[_0x2fcbde(0x197)]),_0x1574e5[_0x2fcbde(0x187)]<_0x19ed06&&(_0x19ed06=_0x1574e5[_0x2fcbde(0x187)]),_0x1574e5[_0x2fcbde(0x16e)]<_0x19ed06&&(_0x19ed06=_0x1574e5[_0x2fcbde(0x16e)]),_0x4e3768={..._0x4e3768,'ctime':_0x1574e5[_0x2fcbde(0x16e)],'mtime':_0x1574e5['mtimeMs'],'ext':path['extname'](_0x4e4e52),'birthtime':Math[_0x2fcbde(0x182)](_0x19ed06),'size':_0x1574e5[_0x2fcbde(0x174)],'check_time':new Date()[_0x2fcbde(0x157)]()},_0x4e3768=await movieIndexUtil[_0x2fcbde(0x189)](_0x1e265a,_0x4e3768);},movieIndexUtil['dealMediaInfo']=async function(_0x3f4e29,_0x274c68){const _0x3d8549=_0xa41336;let _0x517580=![],_0x2efb9a=path['join'](_0x274c68['path'],_0x274c68[_0x3d8549(0x1a9)]);if(_0x274c68[_0x3d8549(0x1a5)]==0x1&&_0x274c68['ext']&&(config['imgTypeList'][_0x3d8549(0x196)](_0x274c68[_0x3d8549(0x18b)][_0x3d8549(0x167)]())||config[_0x3d8549(0x183)][_0x3d8549(0x196)](_0x274c68[_0x3d8549(0x18b)][_0x3d8549(0x167)]()))){_0x274c68[_0x3d8549(0x17b)]=0x1;try{let {tags:_0x4480bc,dealedIndexObj:_0x51e733}=await exifUtil[_0x3d8549(0x17e)](_0x2efb9a,_0x274c68);return movieIndexUtil[_0x3d8549(0x168)](_0x3f4e29,_0x51e733[_0x3d8549(0x1a1)],_0x51e733);}catch(_0x1040bc){return movieIndexUtil[_0x3d8549(0x168)](_0x3f4e29,_0x517580,_0x274c68);}}else{if(_0x274c68[_0x3d8549(0x1a5)]==0x1&&_0x274c68[_0x3d8549(0x18b)]&&config['videoTypeList']['includes'](_0x274c68['ext'][_0x3d8549(0x167)]())){_0x274c68['type']=0x2;try{let _0x2eba22=await indexUtil[_0x3d8549(0x1a6)](_0x2efb9a),_0x416e42=0x0,_0x448a17=0x0;if(_0x2eba22&&_0x2eba22[_0x3d8549(0x15a)]&&_0x2eba22[_0x3d8549(0x15a)][_0x3d8549(0x176)]>0x0){_0x274c68['stream_info']=JSON[_0x3d8549(0x166)](_0x2eba22[_0x3d8549(0x15a)]);let _0x5370d1=videoStreamUtil[_0x3d8549(0x179)](_0x2eba22[_0x3d8549(0x15a)]);_0x274c68[_0x3d8549(0x191)]=_0x5370d1[_0x3d8549(0x17f)],_0x274c68[_0x3d8549(0x18f)]=_0x5370d1[_0x3d8549(0x175)];let _0x526cb5=videoStreamUtil['getDurationFromStream'](_0x2eba22);_0x526cb5&&(_0x274c68[_0x3d8549(0x154)]=_0x526cb5);}if(_0x2eba22&&_0x2eba22[_0x3d8549(0x17c)]&&_0x2eba22[_0x3d8549(0x17c)][_0x3d8549(0x15b)]){let _0x1b723e=_0x2eba22['format'][_0x3d8549(0x15b)][_0x3d8549(0x151)],_0x59614b=_0x2eba22[_0x3d8549(0x17c)][_0x3d8549(0x15b)]['com.apple.quicktime.model'],_0x2a3650=_0x2eba22[_0x3d8549(0x17c)][_0x3d8549(0x15b)]['com.apple.quicktime.creationdate'];_0x59614b&&(_0x274c68[_0x3d8549(0x1a4)]=_0x59614b);_0x2a3650&&(_0x517580=_0x2a3650);!_0x517580&&_0x2eba22['format'][_0x3d8549(0x15b)][_0x3d8549(0x193)]&&(_0x517580=_0x2eba22['format'][_0x3d8549(0x15b)][_0x3d8549(0x193)]);function _0x5c53a7(_0xba6d86){const _0x423583=_0x3d8549;let _0x37befc=[];for(let _0x398067=0x0;_0x398067<_0xba6d86[_0x423583(0x176)];_0x398067++){(_0xba6d86[_0x398067]=='+'||_0xba6d86[_0x398067]=='-')&&_0x37befc[_0x423583(0x19c)](_0x398067);}if(_0x37befc[_0x423583(0x176)]==0x2)_0x416e42=_0xba6d86[_0x423583(0x17a)](_0x37befc[0x0],_0x37befc[0x1]),_0x448a17=_0xba6d86[_0x423583(0x17a)](_0x37befc[0x1]);else _0x37befc[_0x423583(0x176)]>=0x3&&(_0x416e42=_0xba6d86['substring'](_0x37befc[0x0],_0x37befc[0x1]),_0x448a17=_0xba6d86[_0x423583(0x17a)](_0x37befc[0x1],_0x37befc[0x2]));}_0x1b723e&&_0x5c53a7(_0x1b723e);let _0x13b292=_0x2eba22[_0x3d8549(0x17c)][_0x3d8549(0x15b)][_0x3d8549(0x1a2)]||_0x2eba22['format'][_0x3d8549(0x15b)][_0x3d8549(0x163)];_0x13b292&&!_0x416e42&&(_0x13b292=_0x13b292['replace']('/',''),_0x5c53a7(_0x13b292)),_0x2eba22[_0x3d8549(0x17c)]['duration']&&(_0x274c68[_0x3d8549(0x154)]=_0x2eba22['format']['duration']);}return _0x274c68[_0x3d8549(0x188)]=_0x416e42,_0x274c68['longitude']=_0x448a17,movieIndexUtil[_0x3d8549(0x168)](_0x3f4e29,_0x517580,_0x274c68);}catch(_0x3458ac){return movieIndexUtil[_0x3d8549(0x168)](_0x3f4e29,_0x517580,_0x274c68);}}else{if(_0x274c68[_0x3d8549(0x1a5)]==0x1)return;return movieIndexUtil['addOriginalDate'](_0x3f4e29,_0x517580,_0x274c68);}}},movieIndexUtil[_0xa41336(0x168)]=function(_0x561347,_0x10507a,_0x2149a8){const _0x587c86=_0xa41336;_0x10507a&&_0x10507a<config['exifMinTimeStamp']&&(_0x10507a=![]);!_0x10507a&&(_0x10507a=_0x2149a8[_0x587c86(0x158)]||_0x2149a8[_0x587c86(0x180)]);let _0x275b52=new Date(_0x10507a);_0x2149a8['original_time']=_0x275b52[_0x587c86(0x157)]();let _0x4a3562=_0x275b52[_0x587c86(0x164)](),_0x48345c=_0x275b52[_0x587c86(0x16f)]()+0x1;_0x48345c=_0x48345c>=0xa?_0x48345c:'0'+_0x48345c;let _0xd0e287=_0x275b52[_0x587c86(0x15f)]();_0xd0e287=_0xd0e287>=0xa?_0xd0e287:'0'+_0xd0e287,_0x2149a8[_0x587c86(0x19e)]=_0x4a3562+'-'+_0x48345c+'-'+_0xd0e287,movieIndexUtil['addFinalIndexToDB'](_0x561347,_0x2149a8);},movieIndexUtil['addFinalIndexToDB']=function(_0x51a23c,_0x52dcb1){const _0x33ed48=_0xa41336;_0x52dcb1['is_tvplay']==0x1&&_0x52dcb1['type']==0x2&&(movieIndexUtil['needDealTvDrama']=!![]);_0x52dcb1['filenameNumber']=movieUtil[_0x33ed48(0x169)](_0x52dcb1[_0x33ed48(0x1a9)]);let _0x33e00a=dbFileIndexTable[_0x33ed48(0x194)](_0x51a23c,_0x52dcb1,indexTableName),_0x27d484=_0x52dcb1['path']['toLowerCase']();try{if(_0x27d484[_0x33ed48(0x1a7)](_0x33ed48(0x18c))||_0x27d484['endsWith'](_0x33ed48(0x159))){_0x51a23c[_0x33ed48(0x165)](_0x33ed48(0x173)+indexTableName+'\x20SET\x20show_in_list\x20=\x200\x20WHERE\x20path=?')[_0x33ed48(0x199)](_0x52dcb1[_0x33ed48(0x178)]);let _0x56f704=_0x52dcb1['path'][_0x33ed48(0x177)](_0x33ed48(0x18c),'')[_0x33ed48(0x177)](_0x33ed48(0x159),'')[_0x33ed48(0x177)](_0x33ed48(0x1a0),'')['replace'](_0x33ed48(0x1ab),'');_0x56f704=path[_0x33ed48(0x19b)](_0x56f704),_0x51a23c[_0x33ed48(0x165)](_0x33ed48(0x173)+indexTableName+_0x33ed48(0x19f))[_0x33ed48(0x199)](_0x56f704,_0x52dcb1[_0x33ed48(0x178)]);}}catch(_0x1f1883){}let _0x50ffab=dbFileIndexTable[_0x33ed48(0x18d)](_0x51a23c,_0x33e00a[_0x33ed48(0x192)],indexTableName);_0x50ffab&&movieUtil[_0x33ed48(0x156)](_0x51a23c,_0x50ffab);};let tvDramaIsDealing=![];movieIndexUtil[_0xa41336(0x18e)]=function(_0x5ae565){const _0x5a135e=_0xa41336;if(!movieIndexUtil[_0x5a135e(0x198)])return;if(tvDramaIsDealing)return;tvDramaIsDealing=!![];let _0x5ed4a4=new Date()['getTime']();try{let _0x5bad70='UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20show_in_list\x20=\x201;',_0x137d12=_0x5a135e(0x152),_0x382fae=_0x5ae565[_0x5a135e(0x190)](()=>{const _0x5ee56c=_0x5a135e;_0x5ae565[_0x5ee56c(0x165)](_0x5bad70)[_0x5ee56c(0x199)](),_0x5ae565['prepare'](_0x137d12)[_0x5ee56c(0x199)]();}),_0x826b34=new Date()['getTime']();_0x382fae(),console[_0x5a135e(0x155)](_0x5a135e(0x153),(_0x826b34-_0x5ed4a4)/0x3e8+'s');}catch(_0x183773){console['log'](_0x5a135e(0x15c),_0x183773);}tvDramaIsDealing=![],movieIndexUtil[_0x5a135e(0x198)]=![];},module['exports']=movieIndexUtil;