const _0x46c6c4=_0x1ad6;(function(_0xc4468e,_0x47fdf4){const _0x334d1c=_0x1ad6,_0x8553f5=_0xc4468e();while(!![]){try{const _0x2ded3e=parseInt(_0x334d1c(0x1a4))/0x1+parseInt(_0x334d1c(0x1d2))/0x2+-parseInt(_0x334d1c(0x19b))/0x3*(-parseInt(_0x334d1c(0x1da))/0x4)+-parseInt(_0x334d1c(0x1a9))/0x5+parseInt(_0x334d1c(0x1ed))/0x6*(-parseInt(_0x334d1c(0x1c3))/0x7)+-parseInt(_0x334d1c(0x1b8))/0x8+-parseInt(_0x334d1c(0x1b6))/0x9;if(_0x2ded3e===_0x47fdf4)break;else _0x8553f5['push'](_0x8553f5['shift']());}catch(_0x4f54f5){_0x8553f5['push'](_0x8553f5['shift']());}}}(_0x9cd1,0xdf7ba));const path=require('path'),dbFileIndexTable=require(_0x46c6c4(0x1d9)),config=require(_0x46c6c4(0x1c9)),exifUtil=require(_0x46c6c4(0x1ae)),videoStreamUtil=require(_0x46c6c4(0x1b5)),indexUtil=require(_0x46c6c4(0x194)),movieUtil=require('../../express-server/utils/movieUtil'),indexTableName=dbFileIndexTable[_0x46c6c4(0x1cf)],movieIndexUtil={};movieIndexUtil[_0x46c6c4(0x1c2)]=!![];function _0x9cd1(){const _0x1f1a70=['\x5cBDMV\x5cSTREAM','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x201\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20IN\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20t1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x20t1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INNER\x20JOIN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20path,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min(filename)\x20AS\x20filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x20path\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t2\x20ON\x20t1.path\x20=\x20t2.path\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t1.filename\x20=\x20t2.filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','getDate','1502550DSXKaZ','width','format','getDurationFromStream','path','../../utils/exifUtils','ffprobeSync','com.apple.quicktime.creationdate','影音管理：电视剧状态处理完成,耗时:','imgTypeList','addOriginalDate','type','../../utils/videoStreamUtil','4518504yvjVRK','getExifInfo','8983208BCynAr','com.apple.quicktime.model','mode','rawImgTypeList','location','substring','getFilenameNumber','atimeMs','size','影音管理：设置电视剧状态出错','needDealTvDrama','7vIghcy','ctime','endsWith','exifMinTimeStamp','addFinalIndexToDB','filename','../../myConfig/config','stringify','creation_time','latitude','birthtimeMs','getFullYear','INDEX_TABLE_NAME_MOVIE','getById','recursionFilesAddIndex','987692xWZtyt','push','dealFileChange','prepare','getTime','/BDMV/STREAM','birthtime','../../db/dbFileIndexTable','412PXCFCH','original_date','ext','height','ceil','streams','UPDATE\x20','videoWidth','movie','includes','length','create','mtimeMs','\x5cbdmv\x5cstream','toLowerCase','is_file','/bdmv/stream','duration','filenameNumber','3627654iINPqq','dealFirstLetterSingle','lastInsertRowid','./indexUtil','addFileIndexToDb','join','basename','run','\x20as\x20t\x20SET\x20show_in_list\x20=\x201,show_name=?\x20WHERE\x20path=?\x20AND\x20duration>1800','tags','45393WnFsjH','replace','original_time','com.apple.quicktime.location.ISO6709','log','dealTvDrama','show_in_list','ctimeMs','exports','1393123hgKgVn','tvplay'];_0x9cd1=function(){return _0x1f1a70;};return _0x9cd1();}let lastDealTvDramaTimestamp=0x0;function _0x1ad6(_0x438da3,_0x4c2b95){const _0x9cd14d=_0x9cd1();return _0x1ad6=function(_0x1ad6c7,_0x2d4607){_0x1ad6c7=_0x1ad6c7-0x192;let _0x443000=_0x9cd14d[_0x1ad6c7];return _0x443000;},_0x1ad6(_0x438da3,_0x4c2b95);}movieIndexUtil[_0x46c6c4(0x1d4)]=async function(_0x25c629,_0x5a3ab6,_0x46b04d){const _0x4bc7ae=_0x46c6c4;await indexUtil[_0x4bc7ae(0x1d4)](_0x25c629,_0x5a3ab6,_0x46b04d,indexTableName,movieIndexUtil['addFileIndexToDb'],movieIndexUtil[_0x4bc7ae(0x1d1)]);return;},movieIndexUtil[_0x46c6c4(0x1d1)]=async function(_0x8cf6a3,_0x51499d,_0x21bde1){const _0x563601=_0x46c6c4;return await indexUtil['recursionFilesAddIndex'](_0x8cf6a3,_0x51499d,indexTableName,'movie',_0x21bde1,movieIndexUtil[_0x563601(0x195)],()=>{const _0x236ef5=_0x563601;let _0x3a516c=new Date()[_0x236ef5(0x1d6)]()-lastDealTvDramaTimestamp;movieIndexUtil[_0x236ef5(0x1c2)]&&_0x3a516c>0x1d4c0&&(movieIndexUtil['dealTvDrama'](_0x51499d),lastDealTvDramaTimestamp=new Date()[_0x236ef5(0x1d6)]());});},movieIndexUtil['addFileIndexToDb']=async function(_0x3d12b5,_0x35e19b,_0x47e477,_0x31af0b,_0x2fe4f0,_0x559b9b){const _0x5dbbdd=_0x46c6c4;let _0x418cbf={'path':_0x47e477,'filename':_0x31af0b,'is_file':_0x2fe4f0},_0xf21557=indexUtil['doesPathCanAddToDb'](_0x3d12b5,_0x5dbbdd(0x1e2),config,_0x47e477,_0x31af0b);if(!_0xf21557)return;_0xf21557['media_type']==_0x5dbbdd(0x1a5)&&(_0x418cbf['is_tvplay']=0x1,_0x418cbf[_0x5dbbdd(0x1a1)]=0x0);let _0x3bb6f8=_0x559b9b[_0x5dbbdd(0x1cd)];_0x559b9b[_0x5dbbdd(0x1e6)]<_0x3bb6f8&&(_0x3bb6f8=_0x559b9b[_0x5dbbdd(0x1e6)]),_0x559b9b[_0x5dbbdd(0x1bf)]<_0x3bb6f8&&(_0x3bb6f8=_0x559b9b[_0x5dbbdd(0x1bf)]),_0x559b9b[_0x5dbbdd(0x1a2)]<_0x3bb6f8&&(_0x3bb6f8=_0x559b9b['ctimeMs']),_0x418cbf={..._0x418cbf,'ctime':_0x559b9b[_0x5dbbdd(0x1a2)],'mtime':_0x559b9b[_0x5dbbdd(0x1e6)],'ext':path['extname'](_0x31af0b),'birthtime':Math[_0x5dbbdd(0x1de)](_0x3bb6f8),'size':_0x559b9b[_0x5dbbdd(0x1c0)],'check_time':new Date()[_0x5dbbdd(0x1d6)]()},_0x418cbf=await movieIndexUtil['dealMediaInfo'](_0x35e19b,_0x418cbf);},movieIndexUtil['dealMediaInfo']=async function(_0x2e5260,_0x364434){const _0x3a711d=_0x46c6c4;let _0x46dcc4=![],_0x5c0252=path[_0x3a711d(0x196)](_0x364434['path'],_0x364434[_0x3a711d(0x1c8)]);if(_0x364434['is_file']==0x1&&_0x364434['ext']&&(config[_0x3a711d(0x1b2)][_0x3a711d(0x1e3)](_0x364434[_0x3a711d(0x1dc)][_0x3a711d(0x1e8)]())||config[_0x3a711d(0x1bb)][_0x3a711d(0x1e3)](_0x364434[_0x3a711d(0x1dc)][_0x3a711d(0x1e8)]()))){_0x364434[_0x3a711d(0x1b4)]=0x1;try{let {tags:_0x3112f4,dealedIndexObj:_0x52568e}=await exifUtil[_0x3a711d(0x1b7)](_0x5c0252,_0x364434);return movieIndexUtil[_0x3a711d(0x1b3)](_0x2e5260,_0x52568e['originalTime'],_0x52568e);}catch(_0x2b2bf4){return movieIndexUtil[_0x3a711d(0x1b3)](_0x2e5260,_0x46dcc4,_0x364434);}}else{if(_0x364434[_0x3a711d(0x1e9)]==0x1&&_0x364434[_0x3a711d(0x1dc)]&&config['videoTypeList']['includes'](_0x364434[_0x3a711d(0x1dc)][_0x3a711d(0x1e8)]())){_0x364434['type']=0x2;try{let _0x14a7b7=await indexUtil[_0x3a711d(0x1af)](_0x5c0252),_0x3ff448=0x0,_0x93be5=0x0;if(_0x14a7b7&&_0x14a7b7['streams']&&_0x14a7b7['streams'][_0x3a711d(0x1e4)]>0x0){_0x364434['stream_info']=JSON[_0x3a711d(0x1ca)](_0x14a7b7[_0x3a711d(0x1df)]);let _0x5aa1fb=videoStreamUtil['parseVideoWH'](_0x14a7b7[_0x3a711d(0x1df)]);_0x364434[_0x3a711d(0x1aa)]=_0x5aa1fb[_0x3a711d(0x1e1)],_0x364434[_0x3a711d(0x1dd)]=_0x5aa1fb['videoHeight'];let _0x5070b0=videoStreamUtil[_0x3a711d(0x1ac)](_0x14a7b7);_0x5070b0&&(_0x364434[_0x3a711d(0x1eb)]=_0x5070b0);}if(_0x14a7b7&&_0x14a7b7['format']&&_0x14a7b7['format'][_0x3a711d(0x19a)]){let _0x62b4db=_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x19a)][_0x3a711d(0x19e)],_0x103401=_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x19a)][_0x3a711d(0x1b9)],_0x53aa6d=_0x14a7b7['format'][_0x3a711d(0x19a)][_0x3a711d(0x1b0)];_0x103401&&(_0x364434[_0x3a711d(0x1ba)]=_0x103401);_0x53aa6d&&(_0x46dcc4=_0x53aa6d);!_0x46dcc4&&_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x19a)][_0x3a711d(0x1cb)]&&(_0x46dcc4=_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x19a)]['creation_time']);function _0x205add(_0xd807c2){const _0x233a19=_0x3a711d;let _0x441819=[];for(let _0x72c226=0x0;_0x72c226<_0xd807c2[_0x233a19(0x1e4)];_0x72c226++){(_0xd807c2[_0x72c226]=='+'||_0xd807c2[_0x72c226]=='-')&&_0x441819[_0x233a19(0x1d3)](_0x72c226);}if(_0x441819[_0x233a19(0x1e4)]==0x2)_0x3ff448=_0xd807c2['substring'](_0x441819[0x0],_0x441819[0x1]),_0x93be5=_0xd807c2[_0x233a19(0x1bd)](_0x441819[0x1]);else _0x441819[_0x233a19(0x1e4)]>=0x3&&(_0x3ff448=_0xd807c2[_0x233a19(0x1bd)](_0x441819[0x0],_0x441819[0x1]),_0x93be5=_0xd807c2[_0x233a19(0x1bd)](_0x441819[0x1],_0x441819[0x2]));}_0x62b4db&&_0x205add(_0x62b4db);let _0x3a8d5a=_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x19a)][_0x3a711d(0x1bc)]||_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x19a)]['location-eng'];_0x3a8d5a&&!_0x3ff448&&(_0x3a8d5a=_0x3a8d5a[_0x3a711d(0x19c)]('/',''),_0x205add(_0x3a8d5a)),_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x1eb)]&&(_0x364434[_0x3a711d(0x1eb)]=_0x14a7b7[_0x3a711d(0x1ab)][_0x3a711d(0x1eb)]);}return _0x364434[_0x3a711d(0x1cc)]=_0x3ff448,_0x364434['longitude']=_0x93be5,movieIndexUtil[_0x3a711d(0x1b3)](_0x2e5260,_0x46dcc4,_0x364434);}catch(_0x58a7ea){return movieIndexUtil['addOriginalDate'](_0x2e5260,_0x46dcc4,_0x364434);}}else{if(_0x364434[_0x3a711d(0x1e9)]==0x1)return;return movieIndexUtil[_0x3a711d(0x1b3)](_0x2e5260,_0x46dcc4,_0x364434);}}},movieIndexUtil['addOriginalDate']=function(_0x4bc2f4,_0x578e06,_0x45db80){const _0x1800ba=_0x46c6c4;_0x578e06&&_0x578e06<config[_0x1800ba(0x1c6)]&&(_0x578e06=![]);!_0x578e06&&(_0x578e06=_0x45db80[_0x1800ba(0x1d8)]||_0x45db80[_0x1800ba(0x1c4)]);let _0x681400=new Date(_0x578e06);_0x45db80[_0x1800ba(0x19d)]=_0x681400[_0x1800ba(0x1d6)]();let _0x51b7bb=_0x681400[_0x1800ba(0x1ce)](),_0x11e680=_0x681400['getMonth']()+0x1;_0x11e680=_0x11e680>=0xa?_0x11e680:'0'+_0x11e680;let _0x31a0eb=_0x681400[_0x1800ba(0x1a8)]();_0x31a0eb=_0x31a0eb>=0xa?_0x31a0eb:'0'+_0x31a0eb,_0x45db80[_0x1800ba(0x1db)]=_0x51b7bb+'-'+_0x11e680+'-'+_0x31a0eb,movieIndexUtil[_0x1800ba(0x1c7)](_0x4bc2f4,_0x45db80);},movieIndexUtil[_0x46c6c4(0x1c7)]=function(_0xde7a27,_0x4ee53f){const _0x39ed60=_0x46c6c4;_0x4ee53f['is_tvplay']==0x1&&_0x4ee53f[_0x39ed60(0x1b4)]==0x2&&(movieIndexUtil[_0x39ed60(0x1c2)]=!![]);_0x4ee53f[_0x39ed60(0x1ec)]=movieUtil[_0x39ed60(0x1be)](_0x4ee53f['filename']);let _0xac3be7=dbFileIndexTable[_0x39ed60(0x1e5)](_0xde7a27,_0x4ee53f,indexTableName),_0x12822=_0x4ee53f['path'][_0x39ed60(0x1e8)]();try{if(_0x12822[_0x39ed60(0x1c5)](_0x39ed60(0x1e7))||_0x12822[_0x39ed60(0x1c5)](_0x39ed60(0x1ea))){_0xde7a27[_0x39ed60(0x1d5)](_0x39ed60(0x1e0)+indexTableName+'\x20SET\x20show_in_list\x20=\x200\x20WHERE\x20path=?')[_0x39ed60(0x198)](_0x4ee53f['path']);let _0x394dea=_0x4ee53f[_0x39ed60(0x1ad)]['replace']('\x5cbdmv\x5cstream','')[_0x39ed60(0x19c)](_0x39ed60(0x1ea),'')[_0x39ed60(0x19c)](_0x39ed60(0x1a6),'')[_0x39ed60(0x19c)](_0x39ed60(0x1d7),'');_0x394dea=path[_0x39ed60(0x197)](_0x394dea),_0xde7a27[_0x39ed60(0x1d5)](_0x39ed60(0x1e0)+indexTableName+_0x39ed60(0x199))['run'](_0x394dea,_0x4ee53f[_0x39ed60(0x1ad)]);}}catch(_0x5b460b){}let _0x789d25=dbFileIndexTable[_0x39ed60(0x1d0)](_0xde7a27,_0xac3be7[_0x39ed60(0x193)],indexTableName);_0x789d25&&movieUtil[_0x39ed60(0x192)](_0xde7a27,_0x789d25);};let tvDramaIsDealing=![];movieIndexUtil[_0x46c6c4(0x1a0)]=function(_0x50db13){const _0x25299e=_0x46c6c4;if(!movieIndexUtil[_0x25299e(0x1c2)])return;if(tvDramaIsDealing)return;tvDramaIsDealing=!![];let _0x5915d4=new Date()['getTime']();try{let _0x392b26='UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20show_in_list\x20=\x201;',_0x54df9c=_0x25299e(0x1a7),_0x2ae4a9=_0x50db13['transaction'](()=>{const _0x4b2273=_0x25299e;_0x50db13[_0x4b2273(0x1d5)](_0x392b26)[_0x4b2273(0x198)](),_0x50db13[_0x4b2273(0x1d5)](_0x54df9c)[_0x4b2273(0x198)]();}),_0x288a85=new Date()[_0x25299e(0x1d6)]();_0x2ae4a9(),console[_0x25299e(0x19f)](_0x25299e(0x1b1),(_0x288a85-_0x5915d4)/0x3e8+'s');}catch(_0x422abf){console[_0x25299e(0x19f)](_0x25299e(0x1c1),_0x422abf);}tvDramaIsDealing=![],movieIndexUtil['needDealTvDrama']=![];},module[_0x46c6c4(0x1a3)]=movieIndexUtil;