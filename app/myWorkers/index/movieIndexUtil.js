const _0x13838=_0x1761;(function(_0x9ae165,_0x4972d0){const _0x4464e1=_0x1761,_0x1efe2a=_0x9ae165();while(!![]){try{const _0x4938ba=parseInt(_0x4464e1(0xba))/0x1+parseInt(_0x4464e1(0xd6))/0x2+-parseInt(_0x4464e1(0xac))/0x3*(parseInt(_0x4464e1(0xb4))/0x4)+-parseInt(_0x4464e1(0xad))/0x5*(parseInt(_0x4464e1(0x9c))/0x6)+parseInt(_0x4464e1(0xcc))/0x7*(-parseInt(_0x4464e1(0xa0))/0x8)+-parseInt(_0x4464e1(0xd4))/0x9+parseInt(_0x4464e1(0x9a))/0xa*(parseInt(_0x4464e1(0xe3))/0xb);if(_0x4938ba===_0x4972d0)break;else _0x1efe2a['push'](_0x1efe2a['shift']());}catch(_0x2873a5){_0x1efe2a['push'](_0x1efe2a['shift']());}}}(_0x225f,0x1e940));const path=require(_0x13838(0xe9)),dbFileIndexTable=require(_0x13838(0xa5)),config=require(_0x13838(0xc8)),exifUtil=require('../../utils/exifUtils'),videoStreamUtil=require('../../utils/videoStreamUtil'),indexUtil=require(_0x13838(0xb5)),movieUtil=require(_0x13838(0xe7)),indexTableName=dbFileIndexTable[_0x13838(0xa2)],movieIndexUtil={};function _0x225f(){const _0x3755f1=['../../express-server/utils/movieUtil','doesPathCanAddToDb','path','getMonth','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x201\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20IN\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20t1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x20t1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INNER\x20JOIN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20path,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min(filename)\x20AS\x20filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x20path\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t2\x20ON\x20t1.path\x20=\x20t2.path\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t1.filename\x20=\x20t2.filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','getTime','is_tvplay','recursionFilesAddIndex','creation_time','dealTvDrama','videoHeight','ctime','basename','toLowerCase','\x20as\x20t\x20SET\x20show_in_list\x20=\x201,show_name=?\x20WHERE\x20path=?\x20AND\x20duration>1800','addFileIndexToDb','exports','latitude','atimeMs','filename','com.apple.quicktime.location.ISO6709','20UHksMh','getDurationFromStream','18Adaazs','run','needDealTvDrama','format','2152IMeYqx','width','INDEX_TABLE_NAME_MOVIE','stream_info','ext','../../db/dbFileIndexTable','getById','ffprobeSync','location','exifMinTimeStamp','getExifInfo','birthtimeMs','9141CUgxwQ','415705oSCtEK','is_file','com.apple.quicktime.creationdate','addOriginalDate','includes','\x5cBDMV\x5cSTREAM','length','20OmuNQq','./indexUtil','imgTypeList','streams','mode','stringify','181807RzIMIU','size','birthtime','getDate','addFinalIndexToDB','dealFirstLetterSingle','movie','videoTypeList','endsWith','duration','parseVideoWH','substring','height','media_type','../../myConfig/config','dealMediaInfo','prepare','filenameNumber','4529TuayBB','/bdmv/stream','rawImgTypeList','tags','UPDATE\x20','mtimeMs','/BDMV/STREAM','影音管理：设置电视剧状态出错','1765413NJmOZp','videoWidth','92202ZTCDLC','dealFileChange','lastInsertRowid','show_in_list','ceil','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20show_in_list\x20=\x201;','push','\x5cbdmv\x5cstream','log','replace','tvplay','type','original_time','2927089fFpEhr','ctimeMs','getFullYear','transaction'];_0x225f=function(){return _0x3755f1;};return _0x225f();}movieIndexUtil['needDealTvDrama']=!![];let lastDealTvDramaTimestamp=0x0;movieIndexUtil[_0x13838(0xd7)]=async function(_0x1d1f47,_0x17fc45,_0x477434){const _0x465c07=_0x13838;await indexUtil[_0x465c07(0xd7)](_0x1d1f47,_0x17fc45,_0x477434,indexTableName,movieIndexUtil[_0x465c07(0x94)],movieIndexUtil[_0x465c07(0x8c)]);return;},movieIndexUtil[_0x13838(0x8c)]=async function(_0xa76d47,_0x5b4815,_0xa3de47){const _0x514fa9=_0x13838;return await indexUtil[_0x514fa9(0x8c)](_0xa76d47,_0x5b4815,indexTableName,_0x514fa9(0xc0),_0xa3de47,movieIndexUtil[_0x514fa9(0x94)],()=>{const _0x1f8280=_0x514fa9;let _0x9b02ce=new Date()[_0x1f8280(0xec)]()-lastDealTvDramaTimestamp;movieIndexUtil[_0x1f8280(0x9e)]&&_0x9b02ce>0x1d4c0&&(movieIndexUtil[_0x1f8280(0x8e)](_0x5b4815),lastDealTvDramaTimestamp=new Date()[_0x1f8280(0xec)]());});},movieIndexUtil[_0x13838(0x94)]=async function(_0x31c52d,_0x3f3862,_0x3388eb,_0x26e8a1,_0x52d3b6,_0x5ac00d){const _0x186b21=_0x13838;let _0xdf8e17={'path':_0x3388eb,'filename':_0x26e8a1,'is_file':_0x52d3b6},_0x29c503=indexUtil[_0x186b21(0xe8)](_0x31c52d,_0x186b21(0xc0),config,_0x3388eb,_0x26e8a1);if(!_0x29c503)return;_0x29c503[_0x186b21(0xc7)]==_0x186b21(0xe0)&&(_0xdf8e17[_0x186b21(0x8b)]=0x1,_0xdf8e17[_0x186b21(0xd9)]=0x0);let _0x24f906=_0x5ac00d[_0x186b21(0xab)];_0x5ac00d[_0x186b21(0xd1)]<_0x24f906&&(_0x24f906=_0x5ac00d[_0x186b21(0xd1)]),_0x5ac00d[_0x186b21(0x97)]<_0x24f906&&(_0x24f906=_0x5ac00d[_0x186b21(0x97)]),_0x5ac00d['ctimeMs']<_0x24f906&&(_0x24f906=_0x5ac00d['ctimeMs']),_0xdf8e17={..._0xdf8e17,'ctime':_0x5ac00d[_0x186b21(0xe4)],'mtime':_0x5ac00d[_0x186b21(0xd1)],'ext':path['extname'](_0x26e8a1),'birthtime':Math[_0x186b21(0xda)](_0x24f906),'size':_0x5ac00d[_0x186b21(0xbb)],'check_time':new Date()[_0x186b21(0xec)]()},_0xdf8e17=await movieIndexUtil['dealMediaInfo'](_0x3f3862,_0xdf8e17);},movieIndexUtil[_0x13838(0xc9)]=async function(_0x36e2de,_0x335f10){const _0x458927=_0x13838;let _0x38087b=![],_0x2b7efa=path['join'](_0x335f10[_0x458927(0xe9)],_0x335f10[_0x458927(0x98)]);if(_0x335f10['is_file']==0x1&&_0x335f10[_0x458927(0xa4)]&&(config[_0x458927(0xb6)]['includes'](_0x335f10[_0x458927(0xa4)][_0x458927(0x92)]())||config[_0x458927(0xce)]['includes'](_0x335f10[_0x458927(0xa4)][_0x458927(0x92)]()))){_0x335f10['type']=0x1;try{let {tags:_0x31e460,dealedIndexObj:_0x209966}=await exifUtil[_0x458927(0xaa)](_0x2b7efa,_0x335f10);return movieIndexUtil['addOriginalDate'](_0x36e2de,_0x209966['originalTime'],_0x209966);}catch(_0x49ff74){return movieIndexUtil[_0x458927(0xb0)](_0x36e2de,_0x38087b,_0x335f10);}}else{if(_0x335f10[_0x458927(0xae)]==0x1&&_0x335f10[_0x458927(0xa4)]&&config[_0x458927(0xc1)][_0x458927(0xb1)](_0x335f10['ext'][_0x458927(0x92)]())){_0x335f10[_0x458927(0xe1)]=0x2;try{let _0x75793c=await indexUtil[_0x458927(0xa7)](_0x2b7efa),_0x2b6a13=0x0,_0x8c9e82=0x0;if(_0x75793c&&_0x75793c[_0x458927(0xb7)]&&_0x75793c[_0x458927(0xb7)][_0x458927(0xb3)]>0x0){_0x335f10[_0x458927(0xa3)]=JSON[_0x458927(0xb9)](_0x75793c[_0x458927(0xb7)]);let _0x553d57=videoStreamUtil[_0x458927(0xc4)](_0x75793c['streams']);_0x335f10[_0x458927(0xa1)]=_0x553d57[_0x458927(0xd5)],_0x335f10[_0x458927(0xc6)]=_0x553d57[_0x458927(0x8f)];let _0x46d696=videoStreamUtil[_0x458927(0x9b)](_0x75793c);_0x46d696&&(_0x335f10[_0x458927(0xc3)]=_0x46d696);}if(_0x75793c&&_0x75793c[_0x458927(0x9f)]&&_0x75793c[_0x458927(0x9f)]['tags']){let _0x3c895b=_0x75793c[_0x458927(0x9f)]['tags'][_0x458927(0x99)],_0xcbbc2a=_0x75793c[_0x458927(0x9f)][_0x458927(0xcf)]['com.apple.quicktime.model'],_0x4749bd=_0x75793c[_0x458927(0x9f)]['tags'][_0x458927(0xaf)];_0xcbbc2a&&(_0x335f10[_0x458927(0xb8)]=_0xcbbc2a);_0x4749bd&&(_0x38087b=_0x4749bd);!_0x38087b&&_0x75793c[_0x458927(0x9f)][_0x458927(0xcf)][_0x458927(0x8d)]&&(_0x38087b=_0x75793c[_0x458927(0x9f)][_0x458927(0xcf)][_0x458927(0x8d)]);function _0x38003b(_0x511b41){const _0x2399a9=_0x458927;let _0x34bd9f=[];for(let _0x3f1b34=0x0;_0x3f1b34<_0x511b41['length'];_0x3f1b34++){(_0x511b41[_0x3f1b34]=='+'||_0x511b41[_0x3f1b34]=='-')&&_0x34bd9f[_0x2399a9(0xdc)](_0x3f1b34);}if(_0x34bd9f[_0x2399a9(0xb3)]==0x2)_0x2b6a13=_0x511b41[_0x2399a9(0xc5)](_0x34bd9f[0x0],_0x34bd9f[0x1]),_0x8c9e82=_0x511b41[_0x2399a9(0xc5)](_0x34bd9f[0x1]);else _0x34bd9f['length']>=0x3&&(_0x2b6a13=_0x511b41[_0x2399a9(0xc5)](_0x34bd9f[0x0],_0x34bd9f[0x1]),_0x8c9e82=_0x511b41[_0x2399a9(0xc5)](_0x34bd9f[0x1],_0x34bd9f[0x2]));}_0x3c895b&&_0x38003b(_0x3c895b);let _0xaffedb=_0x75793c['format'][_0x458927(0xcf)][_0x458927(0xa8)]||_0x75793c[_0x458927(0x9f)]['tags']['location-eng'];_0xaffedb&&!_0x2b6a13&&(_0xaffedb=_0xaffedb[_0x458927(0xdf)]('/',''),_0x38003b(_0xaffedb)),_0x75793c[_0x458927(0x9f)][_0x458927(0xc3)]&&(_0x335f10[_0x458927(0xc3)]=_0x75793c[_0x458927(0x9f)][_0x458927(0xc3)]);}return _0x335f10[_0x458927(0x96)]=_0x2b6a13,_0x335f10['longitude']=_0x8c9e82,movieIndexUtil[_0x458927(0xb0)](_0x36e2de,_0x38087b,_0x335f10);}catch(_0x30056b){return movieIndexUtil[_0x458927(0xb0)](_0x36e2de,_0x38087b,_0x335f10);}}else{if(_0x335f10[_0x458927(0xae)]==0x1)return;return movieIndexUtil[_0x458927(0xb0)](_0x36e2de,_0x38087b,_0x335f10);}}},movieIndexUtil[_0x13838(0xb0)]=function(_0x2807e4,_0x31734a,_0x4c8476){const _0x2c28b3=_0x13838;_0x31734a&&_0x31734a<config[_0x2c28b3(0xa9)]&&(_0x31734a=![]);!_0x31734a&&(_0x31734a=_0x4c8476[_0x2c28b3(0xbc)]||_0x4c8476[_0x2c28b3(0x90)]);let _0x46280e=new Date(_0x31734a);_0x4c8476[_0x2c28b3(0xe2)]=_0x46280e[_0x2c28b3(0xec)]();let _0x400b37=_0x46280e[_0x2c28b3(0xe5)](),_0x3dbef0=_0x46280e[_0x2c28b3(0xea)]()+0x1;_0x3dbef0=_0x3dbef0>=0xa?_0x3dbef0:'0'+_0x3dbef0;let _0x488061=_0x46280e[_0x2c28b3(0xbd)]();_0x488061=_0x488061>=0xa?_0x488061:'0'+_0x488061,_0x4c8476['original_date']=_0x400b37+'-'+_0x3dbef0+'-'+_0x488061,movieIndexUtil[_0x2c28b3(0xbe)](_0x2807e4,_0x4c8476);},movieIndexUtil[_0x13838(0xbe)]=function(_0x513753,_0x4fbbb0){const _0x20ec50=_0x13838;_0x4fbbb0[_0x20ec50(0x8b)]==0x1&&_0x4fbbb0[_0x20ec50(0xe1)]==0x2&&(movieIndexUtil[_0x20ec50(0x9e)]=!![]);_0x4fbbb0[_0x20ec50(0xcb)]=movieUtil['getFilenameNumber'](_0x4fbbb0[_0x20ec50(0x98)]);let _0x592228=dbFileIndexTable['create'](_0x513753,_0x4fbbb0,indexTableName),_0x501368=_0x4fbbb0[_0x20ec50(0xe9)][_0x20ec50(0x92)]();try{if(_0x501368['endsWith'](_0x20ec50(0xdd))||_0x501368[_0x20ec50(0xc2)](_0x20ec50(0xcd))){_0x513753[_0x20ec50(0xca)](_0x20ec50(0xd0)+indexTableName+'\x20SET\x20show_in_list\x20=\x200\x20WHERE\x20path=?')['run'](_0x4fbbb0[_0x20ec50(0xe9)]);let _0x8137b9=_0x4fbbb0[_0x20ec50(0xe9)]['replace'](_0x20ec50(0xdd),'')[_0x20ec50(0xdf)](_0x20ec50(0xcd),'')[_0x20ec50(0xdf)](_0x20ec50(0xb2),'')['replace'](_0x20ec50(0xd2),'');_0x8137b9=path[_0x20ec50(0x91)](_0x8137b9),_0x513753[_0x20ec50(0xca)](_0x20ec50(0xd0)+indexTableName+_0x20ec50(0x93))[_0x20ec50(0x9d)](_0x8137b9,_0x4fbbb0[_0x20ec50(0xe9)]);}}catch(_0x58caff){}let _0x6fed9a=dbFileIndexTable[_0x20ec50(0xa6)](_0x513753,_0x592228[_0x20ec50(0xd8)],indexTableName);_0x6fed9a&&movieUtil[_0x20ec50(0xbf)](_0x513753,_0x6fed9a);};let tvDramaIsDealing=![];function _0x1761(_0x3508fd,_0x19d02b){const _0x225f23=_0x225f();return _0x1761=function(_0x176108,_0x324a1c){_0x176108=_0x176108-0x8b;let _0x352fc0=_0x225f23[_0x176108];return _0x352fc0;},_0x1761(_0x3508fd,_0x19d02b);}movieIndexUtil[_0x13838(0x8e)]=function(_0x3e5513){const _0x33e85f=_0x13838;if(!movieIndexUtil['needDealTvDrama'])return;if(tvDramaIsDealing)return;tvDramaIsDealing=!![];let _0x4ee844=new Date()[_0x33e85f(0xec)]();try{let _0xfa0d0=_0x33e85f(0xdb),_0x27e344=_0x33e85f(0xeb),_0x165099=_0x3e5513[_0x33e85f(0xe6)](()=>{const _0x96bfb5=_0x33e85f;_0x3e5513[_0x96bfb5(0xca)](_0xfa0d0)[_0x96bfb5(0x9d)](),_0x3e5513[_0x96bfb5(0xca)](_0x27e344)[_0x96bfb5(0x9d)]();}),_0x4e1d2e=new Date()['getTime']();_0x165099(),console[_0x33e85f(0xde)]('影音管理：电视剧状态处理完成,耗时:',(_0x4e1d2e-_0x4ee844)/0x3e8+'s');}catch(_0x135163){console[_0x33e85f(0xde)](_0x33e85f(0xd3),_0x135163);}tvDramaIsDealing=![],movieIndexUtil[_0x33e85f(0x9e)]=![];},module[_0x13838(0x95)]=movieIndexUtil;