const _0x4bf570=_0x15b3;(function(_0x3991d8,_0x1eda29){const _0xf9d55=_0x15b3,_0x5c41ef=_0x3991d8();while(!![]){try{const _0x2b755b=-parseInt(_0xf9d55(0x16b))/0x1*(-parseInt(_0xf9d55(0x16a))/0x2)+-parseInt(_0xf9d55(0x152))/0x3+parseInt(_0xf9d55(0x146))/0x4+parseInt(_0xf9d55(0x14a))/0x5+parseInt(_0xf9d55(0x160))/0x6*(-parseInt(_0xf9d55(0x184))/0x7)+-parseInt(_0xf9d55(0x17c))/0x8+-parseInt(_0xf9d55(0x161))/0x9*(parseInt(_0xf9d55(0x153))/0xa);if(_0x2b755b===_0x1eda29)break;else _0x5c41ef['push'](_0x5c41ef['shift']());}catch(_0x26891b){_0x5c41ef['push'](_0x5c41ef['shift']());}}}(_0x5368,0x72156));const path=require(_0x4bf570(0x174)),dbFileIndexTable=require(_0x4bf570(0x13e)),config=require(_0x4bf570(0x14e)),exifUtil=require('../../utils/exifUtils'),videoStreamUtil=require('../../utils/videoStreamUtil'),indexUtil=require(_0x4bf570(0x14d)),movieUtil=require(_0x4bf570(0x15d)),indexTableName=dbFileIndexTable[_0x4bf570(0x187)],movieIndexUtil={};function _0x15b3(_0x4a49bb,_0x36b8cb){const _0x536861=_0x5368();return _0x15b3=function(_0x15b301,_0xc67c78){_0x15b301=_0x15b301-0x13d;let _0x457bef=_0x536861[_0x15b301];return _0x457bef;},_0x15b3(_0x4a49bb,_0x36b8cb);}function _0x5368(){const _0x537636=['dealFirstLetterSingle','type','log','dealTvDrama','getDate','birthtimeMs','getDurationFromStream','original_date','影音管理：设置电视剧状态出错','/BDMV/STREAM','extname','getTime','original_time','dealMediaInfo','filename','ceil','longitude','getMonth','ffprobeSync','exports','rawImgTypeList','../../db/dbFileIndexTable','videoWidth','creation_time','getFilenameNumber','videoHeight','addFinalIndexToDB','影音管理：电视剧状态处理完成,耗时:','addOriginalDate','2904552hvuyYM','lastInsertRowid','toLowerCase','ctimeMs','1041785orioXl','push','recursionFilesAddIndex','./indexUtil','../../myConfig/config','com.apple.quicktime.creationdate','ext','dealFileChange','462603uDAznO','220OXkqfA','height','location-eng','filenameNumber','latitude','length','is_tvplay','location','imgTypeList','width','../../express-server/utils/movieUtil','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20show_in_list\x20=\x201;','substring','20166BXuqpF','116757pvusEG','/bdmv/stream','getFullYear','ctime','includes','movie','is_file','basename','prepare','628kXbTWG','2167TeNLtc','needDealTvDrama','transaction','replace','endsWith','format','com.apple.quicktime.model','tvplay','getExifInfo','path','streams','UPDATE\x20','show_in_list','tags','addFileIndexToDb','getById','\x5cbdmv\x5cstream','4077928VBjseq','run','duration','\x20SET\x20show_in_list\x20=\x200\x20WHERE\x20path=?','atimeMs','parseVideoWH','stream_info','mtimeMs','413jqvJJe','media_type','UPDATE\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SET\x20show_in_list\x20=\x201\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20id\x20IN\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20t1.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x20t1\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INNER\x20JOIN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20path,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min(filename)\x20AS\x20filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20file_index_movie\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20is_tvplay\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_file\x20=\x201\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type\x20=\x202\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x20path\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t2\x20ON\x20t1.path\x20=\x20t2.path\x20AND\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t1.filename\x20=\x20t2.filename\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);','INDEX_TABLE_NAME_MOVIE','\x20as\x20t\x20SET\x20show_in_list\x20=\x201,show_name=?\x20WHERE\x20path=?\x20AND\x20duration>1800'];_0x5368=function(){return _0x537636;};return _0x5368();}movieIndexUtil[_0x4bf570(0x16c)]=!![];let lastDealTvDramaTimestamp=0x0;movieIndexUtil[_0x4bf570(0x151)]=async function(_0x3a52ed,_0x4cc567,_0x5e03db){const _0x14af62=_0x4bf570;await indexUtil[_0x14af62(0x151)](_0x3a52ed,_0x4cc567,_0x5e03db,indexTableName,movieIndexUtil['addFileIndexToDb'],movieIndexUtil[_0x14af62(0x14c)]);return;},movieIndexUtil[_0x4bf570(0x14c)]=async function(_0x55f7bd,_0x1a6c65,_0x496d8d){const _0x3ac895=_0x4bf570;return await indexUtil[_0x3ac895(0x14c)](_0x55f7bd,_0x1a6c65,indexTableName,_0x3ac895(0x166),_0x496d8d,movieIndexUtil[_0x3ac895(0x179)],()=>{const _0x31be09=_0x3ac895;let _0x225660=new Date()[_0x31be09(0x194)]()-lastDealTvDramaTimestamp;movieIndexUtil['needDealTvDrama']&&_0x225660>0x1d4c0&&(movieIndexUtil[_0x31be09(0x18c)](_0x1a6c65),lastDealTvDramaTimestamp=new Date()[_0x31be09(0x194)]());});},movieIndexUtil[_0x4bf570(0x179)]=async function(_0x2297ab,_0x6bd2ed,_0x45cbf7,_0x27eda1,_0x34fcbb,_0x85f1d3){const _0x29e27b=_0x4bf570;let _0x2a3256={'path':_0x45cbf7,'filename':_0x27eda1,'is_file':_0x34fcbb},_0x5524d0=indexUtil['doesPathCanAddToDb'](_0x2297ab,_0x29e27b(0x166),config,_0x45cbf7,_0x27eda1);if(!_0x5524d0)return;_0x5524d0[_0x29e27b(0x185)]==_0x29e27b(0x172)&&(_0x2a3256[_0x29e27b(0x159)]=0x1,_0x2a3256[_0x29e27b(0x177)]=0x0);let _0x114885=_0x85f1d3[_0x29e27b(0x18e)];_0x85f1d3[_0x29e27b(0x183)]<_0x114885&&(_0x114885=_0x85f1d3[_0x29e27b(0x183)]),_0x85f1d3[_0x29e27b(0x180)]<_0x114885&&(_0x114885=_0x85f1d3['atimeMs']),_0x85f1d3['ctimeMs']<_0x114885&&(_0x114885=_0x85f1d3['ctimeMs']),_0x2a3256={..._0x2a3256,'ctime':_0x85f1d3[_0x29e27b(0x149)],'mtime':_0x85f1d3['mtimeMs'],'ext':path[_0x29e27b(0x193)](_0x27eda1),'birthtime':Math[_0x29e27b(0x198)](_0x114885),'size':_0x85f1d3['size'],'check_time':new Date()[_0x29e27b(0x194)]()},_0x2a3256=await movieIndexUtil[_0x29e27b(0x196)](_0x6bd2ed,_0x2a3256);},movieIndexUtil[_0x4bf570(0x196)]=async function(_0x114c6b,_0x254485){const _0xeec624=_0x4bf570;let _0x14ae27=![],_0x3014c6=path['join'](_0x254485[_0xeec624(0x174)],_0x254485[_0xeec624(0x197)]);if(_0x254485[_0xeec624(0x167)]==0x1&&_0x254485['ext']&&(config[_0xeec624(0x15b)][_0xeec624(0x165)](_0x254485['ext'][_0xeec624(0x148)]())||config[_0xeec624(0x13d)][_0xeec624(0x165)](_0x254485['ext'][_0xeec624(0x148)]()))){_0x254485['type']=0x1;try{let {tags:_0x54fa96,dealedIndexObj:_0x4058c2}=await exifUtil[_0xeec624(0x173)](_0x3014c6,_0x254485);return movieIndexUtil[_0xeec624(0x145)](_0x114c6b,_0x4058c2['originalTime'],_0x4058c2);}catch(_0x555a42){return movieIndexUtil['addOriginalDate'](_0x114c6b,_0x14ae27,_0x254485);}}else{if(_0x254485[_0xeec624(0x167)]==0x1&&_0x254485[_0xeec624(0x150)]&&config['videoTypeList'][_0xeec624(0x165)](_0x254485[_0xeec624(0x150)][_0xeec624(0x148)]())){_0x254485[_0xeec624(0x18a)]=0x2;try{let _0x26ffa4=await indexUtil[_0xeec624(0x19b)](_0x3014c6),_0x3160a0=0x0,_0x3d6682=0x0;if(_0x26ffa4&&_0x26ffa4[_0xeec624(0x175)]&&_0x26ffa4['streams'][_0xeec624(0x158)]>0x0){_0x254485[_0xeec624(0x182)]=JSON['stringify'](_0x26ffa4[_0xeec624(0x175)]);let _0x43b750=videoStreamUtil[_0xeec624(0x181)](_0x26ffa4[_0xeec624(0x175)]);_0x254485[_0xeec624(0x15c)]=_0x43b750[_0xeec624(0x13f)],_0x254485[_0xeec624(0x154)]=_0x43b750[_0xeec624(0x142)];let _0xd6f878=videoStreamUtil[_0xeec624(0x18f)](_0x26ffa4);_0xd6f878&&(_0x254485[_0xeec624(0x17e)]=_0xd6f878);}if(_0x26ffa4&&_0x26ffa4[_0xeec624(0x170)]&&_0x26ffa4['format'][_0xeec624(0x178)]){let _0x284715=_0x26ffa4[_0xeec624(0x170)][_0xeec624(0x178)]['com.apple.quicktime.location.ISO6709'],_0x578849=_0x26ffa4['format'][_0xeec624(0x178)][_0xeec624(0x171)],_0x2083ea=_0x26ffa4[_0xeec624(0x170)][_0xeec624(0x178)][_0xeec624(0x14f)];_0x578849&&(_0x254485['mode']=_0x578849);_0x2083ea&&(_0x14ae27=_0x2083ea);!_0x14ae27&&_0x26ffa4[_0xeec624(0x170)][_0xeec624(0x178)][_0xeec624(0x140)]&&(_0x14ae27=_0x26ffa4[_0xeec624(0x170)][_0xeec624(0x178)][_0xeec624(0x140)]);function _0x37d954(_0x6b2bc9){const _0x49215d=_0xeec624;let _0x9a3abb=[];for(let _0x1d5309=0x0;_0x1d5309<_0x6b2bc9[_0x49215d(0x158)];_0x1d5309++){(_0x6b2bc9[_0x1d5309]=='+'||_0x6b2bc9[_0x1d5309]=='-')&&_0x9a3abb[_0x49215d(0x14b)](_0x1d5309);}if(_0x9a3abb[_0x49215d(0x158)]==0x2)_0x3160a0=_0x6b2bc9[_0x49215d(0x15f)](_0x9a3abb[0x0],_0x9a3abb[0x1]),_0x3d6682=_0x6b2bc9[_0x49215d(0x15f)](_0x9a3abb[0x1]);else _0x9a3abb['length']>=0x3&&(_0x3160a0=_0x6b2bc9[_0x49215d(0x15f)](_0x9a3abb[0x0],_0x9a3abb[0x1]),_0x3d6682=_0x6b2bc9[_0x49215d(0x15f)](_0x9a3abb[0x1],_0x9a3abb[0x2]));}_0x284715&&_0x37d954(_0x284715);let _0x2aff55=_0x26ffa4[_0xeec624(0x170)][_0xeec624(0x178)][_0xeec624(0x15a)]||_0x26ffa4[_0xeec624(0x170)][_0xeec624(0x178)][_0xeec624(0x155)];_0x2aff55&&!_0x3160a0&&(_0x2aff55=_0x2aff55[_0xeec624(0x16e)]('/',''),_0x37d954(_0x2aff55)),_0x26ffa4[_0xeec624(0x170)]['duration']&&(_0x254485['duration']=_0x26ffa4[_0xeec624(0x170)]['duration']);}return _0x254485[_0xeec624(0x157)]=_0x3160a0,_0x254485[_0xeec624(0x199)]=_0x3d6682,movieIndexUtil[_0xeec624(0x145)](_0x114c6b,_0x14ae27,_0x254485);}catch(_0x55c5ba){return movieIndexUtil[_0xeec624(0x145)](_0x114c6b,_0x14ae27,_0x254485);}}else{if(_0x254485[_0xeec624(0x167)]==0x1)return;return movieIndexUtil[_0xeec624(0x145)](_0x114c6b,_0x14ae27,_0x254485);}}},movieIndexUtil[_0x4bf570(0x145)]=function(_0x1b6fb4,_0x296b43,_0x5eaa22){const _0x51408c=_0x4bf570;_0x296b43&&_0x296b43<config['exifMinTimeStamp']&&(_0x296b43=![]);!_0x296b43&&(_0x296b43=_0x5eaa22['birthtime']||_0x5eaa22[_0x51408c(0x164)]);let _0x34792e=new Date(_0x296b43);_0x5eaa22[_0x51408c(0x195)]=_0x34792e[_0x51408c(0x194)]();let _0x4fc185=_0x34792e[_0x51408c(0x163)](),_0x479165=_0x34792e[_0x51408c(0x19a)]()+0x1;_0x479165=_0x479165>=0xa?_0x479165:'0'+_0x479165;let _0xe278ee=_0x34792e[_0x51408c(0x18d)]();_0xe278ee=_0xe278ee>=0xa?_0xe278ee:'0'+_0xe278ee,_0x5eaa22[_0x51408c(0x190)]=_0x4fc185+'-'+_0x479165+'-'+_0xe278ee,movieIndexUtil[_0x51408c(0x143)](_0x1b6fb4,_0x5eaa22);},movieIndexUtil[_0x4bf570(0x143)]=function(_0x5300c8,_0x3bc508){const _0x2c962f=_0x4bf570;_0x3bc508[_0x2c962f(0x159)]==0x1&&_0x3bc508[_0x2c962f(0x18a)]==0x2&&(movieIndexUtil['needDealTvDrama']=!![]);_0x3bc508[_0x2c962f(0x156)]=movieUtil[_0x2c962f(0x141)](_0x3bc508[_0x2c962f(0x197)]);let _0x66a80e=dbFileIndexTable['create'](_0x5300c8,_0x3bc508,indexTableName),_0x35abba=_0x3bc508[_0x2c962f(0x174)][_0x2c962f(0x148)]();try{if(_0x35abba[_0x2c962f(0x16f)](_0x2c962f(0x17b))||_0x35abba[_0x2c962f(0x16f)](_0x2c962f(0x162))){_0x5300c8[_0x2c962f(0x169)](_0x2c962f(0x176)+indexTableName+_0x2c962f(0x17f))[_0x2c962f(0x17d)](_0x3bc508['path']);let _0x246eab=_0x3bc508[_0x2c962f(0x174)][_0x2c962f(0x16e)](_0x2c962f(0x17b),'')[_0x2c962f(0x16e)](_0x2c962f(0x162),'')['replace']('\x5cBDMV\x5cSTREAM','')[_0x2c962f(0x16e)](_0x2c962f(0x192),'');_0x246eab=path[_0x2c962f(0x168)](_0x246eab),_0x5300c8['prepare'](_0x2c962f(0x176)+indexTableName+_0x2c962f(0x188))[_0x2c962f(0x17d)](_0x246eab,_0x3bc508['path']);}}catch(_0x3a0073){}let _0x572925=dbFileIndexTable[_0x2c962f(0x17a)](_0x5300c8,_0x66a80e[_0x2c962f(0x147)],indexTableName);_0x572925&&movieUtil[_0x2c962f(0x189)](_0x5300c8,_0x572925);};let tvDramaIsDealing=![];movieIndexUtil[_0x4bf570(0x18c)]=function(_0x1ca598){const _0x2b65d7=_0x4bf570;if(!movieIndexUtil['needDealTvDrama'])return;if(tvDramaIsDealing)return;tvDramaIsDealing=!![];let _0xbd8bc5=new Date()['getTime']();try{let _0x2eb327=_0x2b65d7(0x15e),_0x2fdcce=_0x2b65d7(0x186),_0x380ed3=_0x1ca598[_0x2b65d7(0x16d)](()=>{const _0x1ff2b8=_0x2b65d7;_0x1ca598[_0x1ff2b8(0x169)](_0x2eb327)[_0x1ff2b8(0x17d)](),_0x1ca598[_0x1ff2b8(0x169)](_0x2fdcce)[_0x1ff2b8(0x17d)]();}),_0x92013a=new Date()[_0x2b65d7(0x194)]();_0x380ed3(),console[_0x2b65d7(0x18b)](_0x2b65d7(0x144),(_0x92013a-_0xbd8bc5)/0x3e8+'s');}catch(_0x355062){console[_0x2b65d7(0x18b)](_0x2b65d7(0x191),_0x355062);}tvDramaIsDealing=![],movieIndexUtil[_0x2b65d7(0x16c)]=![];},module[_0x4bf570(0x19c)]=movieIndexUtil;