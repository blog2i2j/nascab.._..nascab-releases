const _0x1f8274=_0x337f;function _0x337f(_0x3655c6,_0x2d585f){const _0x98805b=_0x9880();return _0x337f=function(_0x337fa4,_0x265b26){_0x337fa4=_0x337fa4-0xa6;let _0x1830d0=_0x98805b[_0x337fa4];return _0x1830d0;},_0x337f(_0x3655c6,_0x2d585f);}(function(_0x295f9b,_0x4a5b9d){const _0x27b928=_0x337f,_0x408edf=_0x295f9b();while(!![]){try{const _0x4a356b=-parseInt(_0x27b928(0xca))/0x1+-parseInt(_0x27b928(0xd4))/0x2*(-parseInt(_0x27b928(0xb3))/0x3)+parseInt(_0x27b928(0xe2))/0x4+parseInt(_0x27b928(0xe0))/0x5+parseInt(_0x27b928(0xd7))/0x6*(parseInt(_0x27b928(0xa7))/0x7)+-parseInt(_0x27b928(0xae))/0x8+parseInt(_0x27b928(0xd2))/0x9;if(_0x4a356b===_0x4a5b9d)break;else _0x408edf['push'](_0x408edf['shift']());}catch(_0x4f6fcc){_0x408edf['push'](_0x408edf['shift']());}}}(_0x9880,0xf1253));const dbDownloadTasksTable=require(_0x1f8274(0xc0)),config=require('../../myConfig/config');let shouldStartDownloadStateList=[dbDownloadTasksTable['STATE_PARSING'],dbDownloadTasksTable[_0x1f8274(0xd6)],dbDownloadTasksTable[_0x1f8274(0xcb)],dbDownloadTasksTable[_0x1f8274(0xc2)],dbDownloadTasksTable[_0x1f8274(0xe4)]];class btDownloadManager{constructor(_0x23e390,_0x4b1356,_0x25710e,_0x36e7a2){const _0x4d2aa8=_0x1f8274;try{this['dbOther']=_0x23e390,this[_0x4d2aa8(0xdf)]=_0x4b1356,this[_0x4d2aa8(0xd0)]=_0x25710e,this[_0x4d2aa8(0xc3)]=_0x36e7a2,this[_0x4d2aa8(0xb6)]=[],this[_0x4d2aa8(0xd9)]=0x1,this['maxDownloadSpeed']=0x400*0x400,this[_0x4d2aa8(0xb4)]=0x400*0x400;}catch(_0x465036){console[_0x4d2aa8(0xc6)](_0x465036);}}[_0x1f8274(0xbe)](){const _0x568fd8=_0x1f8274;dbDownloadTasksTable[_0x568fd8(0xbe)](this[_0x568fd8(0xe3)]);}[_0x1f8274(0xaa)](){const _0x6f7114=_0x1f8274;this['taskObjList']=this['dbOther'][_0x6f7114(0xc7)]('SELECT\x20*\x20FROM\x20download_tasks\x20WHERE\x20task_state\x20<\x20?')[_0x6f7114(0xc1)](dbDownloadTasksTable[_0x6f7114(0xcb)]);}[_0x1f8274(0xda)](){const _0x1db49b=_0x1f8274;try{this['getAllTaskFromDb']();for(let _0x2c09c9 of this[_0x1db49b(0xac)]){this[_0x1db49b(0xad)](_0x2c09c9);}}catch(_0x51b01c){console[_0x1db49b(0xc6)]('暂停全部任务\x20异常',_0x51b01c);}}[_0x1f8274(0xbc)](){const _0x3a82db=_0x1f8274;try{this[_0x3a82db(0xaa)]();for(let _0x566fe8 of this[_0x3a82db(0xac)]){this[_0x3a82db(0xb8)](_0x566fe8);}}catch(_0x302100){console[_0x3a82db(0xc6)](_0x3a82db(0xd5),_0x302100);}}[_0x1f8274(0xb1)](){const _0x18bd65=_0x1f8274;try{this[_0x18bd65(0xaa)]();for(let _0x10d6c4 of this[_0x18bd65(0xac)]){this['startTask'](_0x10d6c4);}}catch(_0x563e67){console[_0x18bd65(0xc6)](_0x18bd65(0xba),_0x563e67);}}[_0x1f8274(0xb8)](_0x16c45b){const _0x45d113=_0x1f8274;let _0x1ed9a7=this[_0x45d113(0xb0)](_0x16c45b['id']);_0x1ed9a7?this['workerSendMsg'](_0x1ed9a7[_0x45d113(0xe1)],{'operation':_0x45d113(0xbf),'taskObj':_0x1ed9a7[_0x45d113(0xb5)]}):console[_0x45d113(0xc6)](_0x45d113(0xde));}['pauseTask'](_0x519701){const _0x335321=_0x1f8274;let _0x32e58f=this[_0x335321(0xb0)](_0x519701['id']);dbDownloadTasksTable[_0x335321(0xbb)](this[_0x335321(0xe3)],_0x519701['id'],_0x335321(0xc4),dbDownloadTasksTable[_0x335321(0xe4)]),_0x32e58f?this[_0x335321(0xc3)](_0x32e58f[_0x335321(0xe1)],{'operation':_0x335321(0xce),'taskObj':_0x32e58f[_0x335321(0xb5)]}):console[_0x335321(0xc6)](_0x335321(0xd8));}[_0x1f8274(0xc5)](_0x14beac){const _0x51726e=_0x1f8274;if(!shouldStartDownloadStateList['includes'](_0x14beac[_0x51726e(0xc4)])){console[_0x51726e(0xc6)]('任务无需开始',_0x14beac[_0x51726e(0xd1)],_0x51726e(0xa6),_0x14beac[_0x51726e(0xc4)]);return;}let _0x4afd1e;for(let _0x359d26 in this[_0x51726e(0xb6)]){if(this[_0x51726e(0xb6)][_0x359d26][_0x51726e(0xb5)]['id']==_0x14beac['id']){_0x4afd1e=this[_0x51726e(0xb6)][_0x359d26]['worker'],console['log'](_0x51726e(0xa8));break;}}!_0x4afd1e&&(console[_0x51726e(0xc6)]('新建BT下载Worker'),_0x14beac[_0x51726e(0xdb)]==_0x51726e(0xc9)||_0x14beac[_0x51726e(0xdb)]==_0x51726e(0xdc)?_0x4afd1e=this['forkNewBtDownloadWorker']():_0x4afd1e=this[_0x51726e(0xd0)](),_0x4afd1e['on'](_0x51726e(0xcf),()=>{const _0xb5c1e=_0x51726e;try{for(let _0x51bb52 in this[_0xb5c1e(0xb6)]){let _0x4c7930=this['taskWorkerCacheList'][_0x51bb52];if(_0x4c7930[_0xb5c1e(0xe1)]===_0x4afd1e){console[_0xb5c1e(0xc6)]('下载线程已经退出,从缓存列表删除'),this['taskWorkerCacheList'][_0xb5c1e(0xa9)](_0x51bb52,0x1);break;}}}catch(_0x207972){console[_0xb5c1e(0xc6)](_0x207972);}}),this[_0x51726e(0xb6)][_0x51726e(0xdd)]({'taskObj':_0x14beac,'worker':_0x4afd1e})),this[_0x51726e(0xc3)](_0x4afd1e,{'torrentSaveFolder':config[_0x51726e(0xaf)],'operation':_0x51726e(0xd3),'taskObj':_0x14beac});}[_0x1f8274(0xb0)](_0x3286c0){const _0x5a44e8=_0x1f8274;for(let _0x11563e in this[_0x5a44e8(0xb6)]){let _0x569886=this[_0x5a44e8(0xb6)][_0x11563e];if(_0x569886['taskObj']['id']===_0x3286c0)return _0x569886;}}[_0x1f8274(0xb2)](_0x4f4bf0){const _0x100fa8=_0x1f8274;console[_0x100fa8(0xc6)](_0x100fa8(0xcd),_0x4f4bf0[_0x100fa8(0xc8)]);let {operation:_0x2cc277,taskId:_0x4a0db1,deleteFile:_0x540f31}=_0x4f4bf0;if(_0x2cc277==_0x100fa8(0xab)){if(_0x4f4bf0[_0x100fa8(0xac)]&&_0x4f4bf0['taskObjList'][_0x100fa8(0xb9)]>0x0)for(let _0x18c944 of _0x4f4bf0[_0x100fa8(0xac)]){this[_0x100fa8(0xc5)](_0x18c944);}}else{if(_0x2cc277==_0x100fa8(0xbf))this['deleteTask'](_0x4f4bf0[_0x100fa8(0xb5)]);else{if(_0x2cc277==_0x100fa8(0xce))this[_0x100fa8(0xad)](_0x4f4bf0['taskObj']);else{if(_0x2cc277==_0x100fa8(0xd3))_0x4f4bf0[_0x100fa8(0xb5)]&&this[_0x100fa8(0xc5)](_0x4f4bf0['taskObj']);else{if(_0x2cc277==_0x100fa8(0xbd))_0x4f4bf0[_0x100fa8(0xb5)]&&(this[_0x100fa8(0xad)](_0x4f4bf0[_0x100fa8(0xb5)]),this[_0x100fa8(0xc5)](_0x4f4bf0[_0x100fa8(0xb5)]));else{if(_0x2cc277==_0x100fa8(0xb7))this[_0x100fa8(0xb1)]();else{if(_0x2cc277=='PAUSE_ALL')this['pauseAll']();else _0x2cc277==_0x100fa8(0xcc)&&this[_0x100fa8(0xbc)]();}}}}}}}}function _0x9880(){const _0x1874c0=['DELETE\x20未找到缓存的worker','forkNewBtDownloadWorker','5026165jfDrUJ','worker','1168812qdBOqf','dbOther','STATE_PAUSE','exports','当前状态','3300815HeEqiU','BT下载Worker已存在','splice','getAllTaskFromDb','ADD','taskObjList','pauseTask','3716968zVvzPH','torrentPath','getTargetCache','startAll','onTaskChange','73533EjYQjF','maxUploadSpeed','taskObj','taskWorkerCacheList','START_ALL','deleteTask','length','btManager\x20异常','updateTaskField','deleteAll','RESTART','setAllDownloadingTaskToPause','DELETE','../../db/dbDownloadTasksTable','all','STATE_DOWNLOADING','workerSendMsg','task_state','startTask','log','prepare','operation','TORRENT','1532234MWKttT','STATE_COMPLETED','DELETE_ALL','下载任务变化','PAUSE','exit','forkNewHttpDownloadWorker','task_name','1895886EEisbV','START','82ZasURY','删除全部任务\x20异常','STATE_WAITING','6byfJXS','PAUSE\x20未找到缓存的worker','maxDownloadingCount','pauseAll','task_type','MAGNET','push'];_0x9880=function(){return _0x1874c0;};return _0x9880();}module[_0x1f8274(0xe5)]=btDownloadManager;