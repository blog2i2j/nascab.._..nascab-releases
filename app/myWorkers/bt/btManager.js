const _0x58f94c=_0x58e1;(function(_0x4c5418,_0x164ead){const _0x4a707a=_0x58e1,_0x169f7f=_0x4c5418();while(!![]){try{const _0x59cff6=parseInt(_0x4a707a(0x105))/0x1+-parseInt(_0x4a707a(0x108))/0x2+-parseInt(_0x4a707a(0x111))/0x3+parseInt(_0x4a707a(0xf4))/0x4*(parseInt(_0x4a707a(0x11a))/0x5)+-parseInt(_0x4a707a(0x11e))/0x6*(-parseInt(_0x4a707a(0x116))/0x7)+-parseInt(_0x4a707a(0x11b))/0x8*(parseInt(_0x4a707a(0x11d))/0x9)+-parseInt(_0x4a707a(0xf2))/0xa;if(_0x59cff6===_0x164ead)break;else _0x169f7f['push'](_0x169f7f['shift']());}catch(_0x5207a0){_0x169f7f['push'](_0x169f7f['shift']());}}}(_0x2765,0x59484));const dbDownloadTasksTable=require(_0x58f94c(0x10d)),config=require('../../myConfig/config');function _0x58e1(_0x6df4a6,_0x503ea6){const _0x27652b=_0x2765();return _0x58e1=function(_0x58e16c,_0x487a3c){_0x58e16c=_0x58e16c-0xe8;let _0x524877=_0x27652b[_0x58e16c];return _0x524877;},_0x58e1(_0x6df4a6,_0x503ea6);}let shouldStartDownloadStateList=[dbDownloadTasksTable[_0x58f94c(0x102)],dbDownloadTasksTable[_0x58f94c(0xe8)],dbDownloadTasksTable[_0x58f94c(0xec)],dbDownloadTasksTable[_0x58f94c(0xf3)],dbDownloadTasksTable[_0x58f94c(0x103)]];function _0x2765(){const _0x505e5e=['PAUSE\x20未找到缓存的worker','ADD','maxDownloadingCount','当前状态','forkNewBtDownloadWorker','updateTaskField','STATE_WAITING','length','task_type','workerSendMsg','STATE_COMPLETED','exports','TORRENT','getTargetCache','deleteTask','DELETE_ALL','1871100PnnrvN','STATE_DOWNLOADING','946028LBTCnK','setAllDownloadingTaskToPause','worker','pauseTask','deleteAll','MAGNET','dbOther','删除全部任务\x20异常','新建BT下载Worker','getAllTaskFromDb','exit','torrentPath','log','startAll','STATE_PARSING','STATE_PAUSE','onTaskChange','368330vrmrpq','forkNewHttpDownloadWorker','暂停全部任务\x20异常','250994GNPXOE','pauseAll','task_state','START','operation','../../db/dbDownloadTasksTable','taskWorkerCacheList','taskObjList','DELETE','1314834gyHqqr','DELETE\x20未找到缓存的worker','任务无需开始','下载任务变化','taskObj','7pprMCO','START_ALL','PAUSE_ALL','startTask','10OcqAdv','488JDLzwX','all','49401UkUOoo','3660420llfGiB'];_0x2765=function(){return _0x505e5e;};return _0x2765();}class btDownloadManager{constructor(_0x134741,_0x1283b3,_0x3ce16c,_0x55bb86){const _0x49ad42=_0x58f94c;try{this['dbOther']=_0x134741,this[_0x49ad42(0x123)]=_0x1283b3,this[_0x49ad42(0x106)]=_0x3ce16c,this[_0x49ad42(0xeb)]=_0x55bb86,this[_0x49ad42(0x10e)]=[],this[_0x49ad42(0x121)]=0x1,this['maxDownloadSpeed']=0x400*0x400,this['maxUploadSpeed']=0x400*0x400;}catch(_0x28ca1a){console[_0x49ad42(0x100)](_0x28ca1a);}}['setAllDownloadingTaskToPause'](){const _0x1b3bbb=_0x58f94c;dbDownloadTasksTable[_0x1b3bbb(0xf5)](this[_0x1b3bbb(0xfa)]);}['getAllTaskFromDb'](){const _0x4db77a=_0x58f94c;this[_0x4db77a(0x10f)]=this['dbOther']['prepare']('SELECT\x20*\x20FROM\x20download_tasks\x20WHERE\x20task_state\x20<\x20?')[_0x4db77a(0x11c)](dbDownloadTasksTable[_0x4db77a(0xec)]);}[_0x58f94c(0x109)](){const _0x19df75=_0x58f94c;try{this[_0x19df75(0xfd)]();for(let _0x1fcdb3 of this['taskObjList']){this[_0x19df75(0xf7)](_0x1fcdb3);}}catch(_0x27d043){console[_0x19df75(0x100)](_0x19df75(0x107),_0x27d043);}}['deleteAll'](){const _0x3f3956=_0x58f94c;try{this['getAllTaskFromDb']();for(let _0x1d5313 of this[_0x3f3956(0x10f)]){this[_0x3f3956(0xf0)](_0x1d5313);}}catch(_0x1d4f59){console[_0x3f3956(0x100)](_0x3f3956(0xfb),_0x1d4f59);}}[_0x58f94c(0x101)](){const _0x5a3246=_0x58f94c;try{this[_0x5a3246(0xfd)]();for(let _0x21d747 of this[_0x5a3246(0x10f)]){this[_0x5a3246(0x119)](_0x21d747);}}catch(_0x237bd5){console[_0x5a3246(0x100)]('btManager\x20异常',_0x237bd5);}}[_0x58f94c(0xf0)](_0x5d4605){const _0x1e4a67=_0x58f94c;let _0x5014c0=this['getTargetCache'](_0x5d4605['id']);_0x5014c0?this[_0x1e4a67(0xeb)](_0x5014c0['worker'],{'operation':'DELETE','taskObj':_0x5014c0['taskObj']}):console[_0x1e4a67(0x100)](_0x1e4a67(0x112));}[_0x58f94c(0xf7)](_0x1fed02){const _0x3b1e70=_0x58f94c;let _0x2e3f07=this[_0x3b1e70(0xef)](_0x1fed02['id']);dbDownloadTasksTable[_0x3b1e70(0x124)](this[_0x3b1e70(0xfa)],_0x1fed02['id'],_0x3b1e70(0x10a),dbDownloadTasksTable['STATE_PAUSE']),_0x2e3f07?this[_0x3b1e70(0xeb)](_0x2e3f07[_0x3b1e70(0xf6)],{'operation':'PAUSE','taskObj':_0x2e3f07[_0x3b1e70(0x115)]}):console[_0x3b1e70(0x100)](_0x3b1e70(0x11f));}[_0x58f94c(0x119)](_0x5f43f5){const _0x130927=_0x58f94c;if(!shouldStartDownloadStateList['includes'](_0x5f43f5[_0x130927(0x10a)])){console['log'](_0x130927(0x113),_0x5f43f5['task_name'],_0x130927(0x122),_0x5f43f5[_0x130927(0x10a)]);return;}let _0x509c88;for(let _0x321c92 in this['taskWorkerCacheList']){if(this[_0x130927(0x10e)][_0x321c92]['taskObj']['id']==_0x5f43f5['id']){_0x509c88=this[_0x130927(0x10e)][_0x321c92][_0x130927(0xf6)],console[_0x130927(0x100)]('BT下载Worker已存在');break;}}!_0x509c88&&(console[_0x130927(0x100)](_0x130927(0xfc)),_0x5f43f5['task_type']==_0x130927(0xee)||_0x5f43f5[_0x130927(0xea)]==_0x130927(0xf9)?_0x509c88=this[_0x130927(0x123)]():_0x509c88=this[_0x130927(0x106)](),_0x509c88['on'](_0x130927(0xfe),()=>{const _0x9f4eb3=_0x130927;try{for(let _0x455d0f in this['taskWorkerCacheList']){let _0x95624b=this[_0x9f4eb3(0x10e)][_0x455d0f];if(_0x95624b[_0x9f4eb3(0xf6)]===_0x509c88){console[_0x9f4eb3(0x100)]('下载线程已经退出,从缓存列表删除'),this[_0x9f4eb3(0x10e)]['splice'](_0x455d0f,0x1);break;}}}catch(_0x124e01){console[_0x9f4eb3(0x100)](_0x124e01);}}),this[_0x130927(0x10e)]['push']({'taskObj':_0x5f43f5,'worker':_0x509c88})),this[_0x130927(0xeb)](_0x509c88,{'torrentSaveFolder':config[_0x130927(0xff)],'operation':_0x130927(0x10b),'taskObj':_0x5f43f5});}[_0x58f94c(0xef)](_0x14fa88){const _0x1967b4=_0x58f94c;for(let _0x353132 in this[_0x1967b4(0x10e)]){let _0x111350=this[_0x1967b4(0x10e)][_0x353132];if(_0x111350[_0x1967b4(0x115)]['id']===_0x14fa88)return _0x111350;}}[_0x58f94c(0x104)](_0xedd33d){const _0x366f29=_0x58f94c;console['log'](_0x366f29(0x114),_0xedd33d[_0x366f29(0x10c)]);let {operation:_0x464f38,taskId:_0x3d3250,deleteFile:_0x6fea6e}=_0xedd33d;if(_0x464f38==_0x366f29(0x120)){if(_0xedd33d[_0x366f29(0x10f)]&&_0xedd33d['taskObjList'][_0x366f29(0xe9)]>0x0)for(let _0x1d3ebf of _0xedd33d[_0x366f29(0x10f)]){this[_0x366f29(0x119)](_0x1d3ebf);}}else{if(_0x464f38==_0x366f29(0x110))this[_0x366f29(0xf0)](_0xedd33d['taskObj']);else{if(_0x464f38=='PAUSE')this[_0x366f29(0xf7)](_0xedd33d[_0x366f29(0x115)]);else{if(_0x464f38==_0x366f29(0x10b))_0xedd33d[_0x366f29(0x115)]&&this[_0x366f29(0x119)](_0xedd33d[_0x366f29(0x115)]);else{if(_0x464f38=='RESTART')_0xedd33d[_0x366f29(0x115)]&&(this[_0x366f29(0xf7)](_0xedd33d[_0x366f29(0x115)]),this[_0x366f29(0x119)](_0xedd33d[_0x366f29(0x115)]));else{if(_0x464f38==_0x366f29(0x117))this['startAll']();else{if(_0x464f38==_0x366f29(0x118))this[_0x366f29(0x109)]();else _0x464f38==_0x366f29(0xf1)&&this[_0x366f29(0xf8)]();}}}}}}}}module[_0x58f94c(0xed)]=btDownloadManager;