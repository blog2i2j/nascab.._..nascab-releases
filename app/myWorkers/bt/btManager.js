const _0x4394e8=_0x2276;(function(_0x5a21ce,_0x13de09){const _0x3db4fb=_0x2276,_0x1b9091=_0x5a21ce();while(!![]){try{const _0x2c9af0=parseInt(_0x3db4fb(0x10c))/0x1+-parseInt(_0x3db4fb(0x145))/0x2*(-parseInt(_0x3db4fb(0x113))/0x3)+parseInt(_0x3db4fb(0x10b))/0x4*(parseInt(_0x3db4fb(0x125))/0x5)+-parseInt(_0x3db4fb(0x12e))/0x6+-parseInt(_0x3db4fb(0x122))/0x7+-parseInt(_0x3db4fb(0x128))/0x8*(-parseInt(_0x3db4fb(0x118))/0x9)+-parseInt(_0x3db4fb(0x10e))/0xa;if(_0x2c9af0===_0x13de09)break;else _0x1b9091['push'](_0x1b9091['shift']());}catch(_0x257099){_0x1b9091['push'](_0x1b9091['shift']());}}}(_0x115f,0xf3d34));function _0x115f(){const _0x52eb04=['splice','pauseTask','SELECT\x20*\x20FROM\x20download_tasks\x20WHERE\x20task_state\x20<\x20?','setAllDownloadingTaskToPause','maxUploadSpeed','下载任务变化','forkNewHttpDownloadWorker','38FDGNlH','task_state','任务无需开始','includes','STATE_WAITING','log','operation','onTaskChange','maxDownloadSpeed','496892zjosKT','1277913HXjgqr','push','14012220hlhzjH','PAUSE\x20未找到缓存的worker','worker','PAUSE','updateTaskField','146001VDhePB','STATE_COMPLETED','DELETE','STATE_PARSING','MAGNET','658062KlctaP','../../db/dbDownloadTasksTable','删除全部任务\x20异常','forkNewBtDownloadWorker','all','taskWorkerCacheList','deleteAll','exports','getAllTaskFromDb','dbOther','4908533oMoNhh','新建BT下载Worker','RESTART','35cmnZbI','startTask','STATE_DOWNLOADING','184aiNDBZ','startAll','STATE_PAUSE','task_name','当前状态','DELETE_ALL','9916272GMjPbv','length','getTargetCache','deleteTask','maxDownloadingCount','taskObjList','taskObj','BT下载Worker已存在','exit','下载线程已经退出,从缓存列表删除','task_type','workerSendMsg','pauseAll','btManager\x20异常','START','PAUSE_ALL'];_0x115f=function(){return _0x52eb04;};return _0x115f();}const dbDownloadTasksTable=require(_0x4394e8(0x119)),config=require('../../myConfig/config');function _0x2276(_0x5c4dc8,_0x347222){const _0x115f07=_0x115f();return _0x2276=function(_0x227678,_0x1c3f9b){_0x227678=_0x227678-0x10a;let _0x54fdd1=_0x115f07[_0x227678];return _0x54fdd1;},_0x2276(_0x5c4dc8,_0x347222);}let shouldStartDownloadStateList=[dbDownloadTasksTable[_0x4394e8(0x116)],dbDownloadTasksTable[_0x4394e8(0x149)],dbDownloadTasksTable['STATE_COMPLETED'],dbDownloadTasksTable[_0x4394e8(0x127)],dbDownloadTasksTable[_0x4394e8(0x12a)]];class btDownloadManager{constructor(_0x498c39,_0x59a24f,_0x363398,_0x57674b){const _0x177bf0=_0x4394e8;try{this[_0x177bf0(0x121)]=_0x498c39,this[_0x177bf0(0x11b)]=_0x59a24f,this[_0x177bf0(0x144)]=_0x363398,this[_0x177bf0(0x139)]=_0x57674b,this[_0x177bf0(0x11d)]=[],this[_0x177bf0(0x132)]=0x1,this[_0x177bf0(0x10a)]=0x400*0x400,this[_0x177bf0(0x142)]=0x400*0x400;}catch(_0x1b2495){console['log'](_0x1b2495);}}[_0x4394e8(0x141)](){const _0xd45451=_0x4394e8;dbDownloadTasksTable[_0xd45451(0x141)](this[_0xd45451(0x121)]);}['getAllTaskFromDb'](){const _0x11b6de=_0x4394e8;this[_0x11b6de(0x133)]=this[_0x11b6de(0x121)]['prepare'](_0x11b6de(0x140))[_0x11b6de(0x11c)](dbDownloadTasksTable[_0x11b6de(0x114)]);}[_0x4394e8(0x13a)](){const _0x3e32c8=_0x4394e8;try{this[_0x3e32c8(0x120)]();for(let _0x3f4f83 of this[_0x3e32c8(0x133)]){this[_0x3e32c8(0x13f)](_0x3f4f83);}}catch(_0x5d3eff){console[_0x3e32c8(0x14a)]('暂停全部任务\x20异常',_0x5d3eff);}}[_0x4394e8(0x11e)](){const _0x120167=_0x4394e8;try{this[_0x120167(0x120)]();for(let _0x29489a of this[_0x120167(0x133)]){this[_0x120167(0x131)](_0x29489a);}}catch(_0x2923f8){console[_0x120167(0x14a)](_0x120167(0x11a),_0x2923f8);}}[_0x4394e8(0x129)](){const _0xb636f7=_0x4394e8;try{this['getAllTaskFromDb']();for(let _0x254e4f of this['taskObjList']){this[_0xb636f7(0x126)](_0x254e4f);}}catch(_0x4c047f){console[_0xb636f7(0x14a)](_0xb636f7(0x13b),_0x4c047f);}}['deleteTask'](_0x2857b2){const _0x589725=_0x4394e8;let _0xc912f0=this[_0x589725(0x130)](_0x2857b2['id']);_0xc912f0?this[_0x589725(0x139)](_0xc912f0[_0x589725(0x110)],{'operation':_0x589725(0x115),'taskObj':_0xc912f0[_0x589725(0x134)]}):console[_0x589725(0x14a)]('DELETE\x20未找到缓存的worker');}[_0x4394e8(0x13f)](_0x39fc42){const _0x454a38=_0x4394e8;let _0x51c06c=this[_0x454a38(0x130)](_0x39fc42['id']);dbDownloadTasksTable[_0x454a38(0x112)](this[_0x454a38(0x121)],_0x39fc42['id'],_0x454a38(0x146),dbDownloadTasksTable['STATE_PAUSE']),_0x51c06c?this['workerSendMsg'](_0x51c06c['worker'],{'operation':_0x454a38(0x111),'taskObj':_0x51c06c[_0x454a38(0x134)]}):console[_0x454a38(0x14a)](_0x454a38(0x10f));}[_0x4394e8(0x126)](_0x410827){const _0x50b1f4=_0x4394e8;if(!shouldStartDownloadStateList[_0x50b1f4(0x148)](_0x410827['task_state'])){console[_0x50b1f4(0x14a)](_0x50b1f4(0x147),_0x410827[_0x50b1f4(0x12b)],_0x50b1f4(0x12c),_0x410827[_0x50b1f4(0x146)]);return;}let _0x3acbf0;for(let _0x2f1f4f in this[_0x50b1f4(0x11d)]){if(this[_0x50b1f4(0x11d)][_0x2f1f4f][_0x50b1f4(0x134)]['id']==_0x410827['id']){_0x3acbf0=this[_0x50b1f4(0x11d)][_0x2f1f4f]['worker'],console[_0x50b1f4(0x14a)](_0x50b1f4(0x135));break;}}!_0x3acbf0&&(console[_0x50b1f4(0x14a)](_0x50b1f4(0x123)),_0x410827['task_type']=='TORRENT'||_0x410827[_0x50b1f4(0x138)]==_0x50b1f4(0x117)?_0x3acbf0=this['forkNewBtDownloadWorker']():_0x3acbf0=this[_0x50b1f4(0x144)](),_0x3acbf0['on'](_0x50b1f4(0x136),()=>{const _0x2b7168=_0x50b1f4;try{for(let _0x47b8d6 in this[_0x2b7168(0x11d)]){let _0x17b3d5=this[_0x2b7168(0x11d)][_0x47b8d6];if(_0x17b3d5[_0x2b7168(0x110)]===_0x3acbf0){console[_0x2b7168(0x14a)](_0x2b7168(0x137)),this[_0x2b7168(0x11d)][_0x2b7168(0x13e)](_0x47b8d6,0x1);break;}}}catch(_0x496ce8){console[_0x2b7168(0x14a)](_0x496ce8);}}),this[_0x50b1f4(0x11d)][_0x50b1f4(0x10d)]({'taskObj':_0x410827,'worker':_0x3acbf0})),this[_0x50b1f4(0x139)](_0x3acbf0,{'torrentSaveFolder':config['torrentPath'],'operation':_0x50b1f4(0x13c),'taskObj':_0x410827});}[_0x4394e8(0x130)](_0x4b480a){const _0x35f13b=_0x4394e8;for(let _0x2e01a4 in this[_0x35f13b(0x11d)]){let _0x2b39a3=this[_0x35f13b(0x11d)][_0x2e01a4];if(_0x2b39a3[_0x35f13b(0x134)]['id']===_0x4b480a)return _0x2b39a3;}}[_0x4394e8(0x14c)](_0x4e6bd7){const _0x5539e8=_0x4394e8;console[_0x5539e8(0x14a)](_0x5539e8(0x143),_0x4e6bd7[_0x5539e8(0x14b)]);let {operation:_0x54721b,taskId:_0x4e5116,deleteFile:_0x4fbe95}=_0x4e6bd7;if(_0x54721b=='ADD'){if(_0x4e6bd7[_0x5539e8(0x133)]&&_0x4e6bd7[_0x5539e8(0x133)][_0x5539e8(0x12f)]>0x0)for(let _0x3534a0 of _0x4e6bd7[_0x5539e8(0x133)]){this[_0x5539e8(0x126)](_0x3534a0);}}else{if(_0x54721b==_0x5539e8(0x115))this[_0x5539e8(0x131)](_0x4e6bd7[_0x5539e8(0x134)]);else{if(_0x54721b==_0x5539e8(0x111))this[_0x5539e8(0x13f)](_0x4e6bd7['taskObj']);else{if(_0x54721b==_0x5539e8(0x13c))_0x4e6bd7[_0x5539e8(0x134)]&&this[_0x5539e8(0x126)](_0x4e6bd7['taskObj']);else{if(_0x54721b==_0x5539e8(0x124))_0x4e6bd7[_0x5539e8(0x134)]&&(this[_0x5539e8(0x13f)](_0x4e6bd7[_0x5539e8(0x134)]),this['startTask'](_0x4e6bd7[_0x5539e8(0x134)]));else{if(_0x54721b=='START_ALL')this['startAll']();else{if(_0x54721b==_0x5539e8(0x13d))this[_0x5539e8(0x13a)]();else _0x54721b==_0x5539e8(0x12d)&&this[_0x5539e8(0x11e)]();}}}}}}}}module[_0x4394e8(0x11f)]=btDownloadManager;