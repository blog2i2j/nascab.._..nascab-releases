const _0x92ae3d=_0x13d1;function _0x1c2d(){const _0x3fdae2=['taskObjList','13068657rnYrMt','pauseAll','TORRENT','RESTART','worker','DELETE\x20未找到缓存的worker','pauseTask','taskObj','btManager\x20异常','deleteTask','torrentPath','forkNewHttpDownloadWorker','taskWorkerCacheList','../../myConfig/config','maxUploadSpeed','getAllTaskFromDb','任务无需开始','STATE_PAUSE','STATE_COMPLETED','ADD','workerSendMsg','MAGNET','onTaskChange','dbOther','startAll','当前状态','删除全部任务\x20异常','STATE_WAITING','forkNewBtDownloadWorker','STATE_DOWNLOADING','396562ORkbHH','3zTIuyZ','includes','663477DNmAGQ','START_ALL','all','setAllDownloadingTaskToPause','exit','SELECT\x20*\x20FROM\x20download_tasks\x20WHERE\x20task_state\x20<\x20?','PAUSE','新建BT下载Worker','task_type','PAUSE\x20未找到缓存的worker','prepare','deleteAll','length','operation','DELETE','maxDownloadingCount','2620690FHZxAG','暂停全部任务\x20异常','5579376QQZOGv','PAUSE_ALL','task_name','下载线程已经退出,从缓存列表删除','9104039gfgdMN','8QxzTth','5351358ArwRfb','START','splice','下载任务变化','DELETE_ALL','BT下载Worker已存在','log','task_state','getTargetCache','startTask'];_0x1c2d=function(){return _0x3fdae2;};return _0x1c2d();}(function(_0x4f2efa,_0x37575f){const _0x50a56a=_0x13d1,_0x2d5064=_0x4f2efa();while(!![]){try{const _0x13acba=parseInt(_0x50a56a(0xba))/0x1*(-parseInt(_0x50a56a(0xb9))/0x2)+parseInt(_0x50a56a(0xbc))/0x3*(-parseInt(_0x50a56a(0xd3))/0x4)+parseInt(_0x50a56a(0xcc))/0x5+parseInt(_0x50a56a(0xd4))/0x6+parseInt(_0x50a56a(0xd2))/0x7+parseInt(_0x50a56a(0xce))/0x8+-parseInt(_0x50a56a(0x9b))/0x9;if(_0x13acba===_0x37575f)break;else _0x2d5064['push'](_0x2d5064['shift']());}catch(_0x46b4ea){_0x2d5064['push'](_0x2d5064['shift']());}}}(_0x1c2d,0xe1c7c));const dbDownloadTasksTable=require('../../db/dbDownloadTasksTable'),config=require(_0x92ae3d(0xa8));let shouldStartDownloadStateList=[dbDownloadTasksTable['STATE_PARSING'],dbDownloadTasksTable[_0x92ae3d(0xb6)],dbDownloadTasksTable['STATE_COMPLETED'],dbDownloadTasksTable[_0x92ae3d(0xb8)],dbDownloadTasksTable['STATE_PAUSE']];class btDownloadManager{constructor(_0x1d9500,_0x33d61a,_0x5b6e9e,_0x37482b){const _0x36dab6=_0x92ae3d;try{this['dbOther']=_0x1d9500,this[_0x36dab6(0xb7)]=_0x33d61a,this[_0x36dab6(0xa6)]=_0x5b6e9e,this[_0x36dab6(0xaf)]=_0x37482b,this['taskWorkerCacheList']=[],this[_0x36dab6(0xcb)]=0x1,this['maxDownloadSpeed']=0x400*0x400,this[_0x36dab6(0xa9)]=0x400*0x400;}catch(_0x2d64d3){console[_0x36dab6(0xda)](_0x2d64d3);}}['setAllDownloadingTaskToPause'](){const _0x32f1b5=_0x92ae3d;dbDownloadTasksTable[_0x32f1b5(0xbf)](this['dbOther']);}[_0x92ae3d(0xaa)](){const _0x14a368=_0x92ae3d;this[_0x14a368(0x9a)]=this[_0x14a368(0xb2)][_0x14a368(0xc6)](_0x14a368(0xc1))[_0x14a368(0xbe)](dbDownloadTasksTable[_0x14a368(0xad)]);}[_0x92ae3d(0x9c)](){const _0x3fb89b=_0x92ae3d;try{this['getAllTaskFromDb']();for(let _0x4f091d of this[_0x3fb89b(0x9a)]){this[_0x3fb89b(0xa1)](_0x4f091d);}}catch(_0x6b396d){console['log'](_0x3fb89b(0xcd),_0x6b396d);}}[_0x92ae3d(0xc7)](){const _0x3430f0=_0x92ae3d;try{this[_0x3430f0(0xaa)]();for(let _0x1884cd of this['taskObjList']){this[_0x3430f0(0xa4)](_0x1884cd);}}catch(_0x2e4e47){console['log'](_0x3430f0(0xb5),_0x2e4e47);}}[_0x92ae3d(0xb3)](){const _0x514efb=_0x92ae3d;try{this[_0x514efb(0xaa)]();for(let _0x591a29 of this[_0x514efb(0x9a)]){this[_0x514efb(0x99)](_0x591a29);}}catch(_0x4c4a91){console[_0x514efb(0xda)](_0x514efb(0xa3),_0x4c4a91);}}['deleteTask'](_0x5bf0b4){const _0x655b0b=_0x92ae3d;let _0x547192=this['getTargetCache'](_0x5bf0b4['id']);_0x547192?this[_0x655b0b(0xaf)](_0x547192[_0x655b0b(0x9f)],{'operation':'DELETE','taskObj':_0x547192[_0x655b0b(0xa2)]}):console[_0x655b0b(0xda)](_0x655b0b(0xa0));}[_0x92ae3d(0xa1)](_0x17d064){const _0x509caf=_0x92ae3d;let _0x43f020=this[_0x509caf(0xdc)](_0x17d064['id']);dbDownloadTasksTable['updateTaskField'](this[_0x509caf(0xb2)],_0x17d064['id'],_0x509caf(0xdb),dbDownloadTasksTable[_0x509caf(0xac)]),_0x43f020?this[_0x509caf(0xaf)](_0x43f020[_0x509caf(0x9f)],{'operation':_0x509caf(0xc2),'taskObj':_0x43f020['taskObj']}):console['log'](_0x509caf(0xc5));}[_0x92ae3d(0x99)](_0x45c972){const _0x572c68=_0x92ae3d;if(!shouldStartDownloadStateList[_0x572c68(0xbb)](_0x45c972[_0x572c68(0xdb)])){console[_0x572c68(0xda)](_0x572c68(0xab),_0x45c972[_0x572c68(0xd0)],_0x572c68(0xb4),_0x45c972[_0x572c68(0xdb)]);return;}let _0x14862f;for(let _0x2b3b8e in this[_0x572c68(0xa7)]){if(this['taskWorkerCacheList'][_0x2b3b8e][_0x572c68(0xa2)]['id']==_0x45c972['id']){_0x14862f=this[_0x572c68(0xa7)][_0x2b3b8e][_0x572c68(0x9f)],console[_0x572c68(0xda)](_0x572c68(0xd9));break;}}!_0x14862f&&(console['log'](_0x572c68(0xc3)),_0x45c972['task_type']==_0x572c68(0x9d)||_0x45c972[_0x572c68(0xc4)]==_0x572c68(0xb0)?_0x14862f=this[_0x572c68(0xb7)]():_0x14862f=this[_0x572c68(0xa6)](),_0x14862f['on'](_0x572c68(0xc0),()=>{const _0x3b22ff=_0x572c68;try{for(let _0x1d324c in this[_0x3b22ff(0xa7)]){let _0x1fad4f=this[_0x3b22ff(0xa7)][_0x1d324c];if(_0x1fad4f['worker']===_0x14862f){console[_0x3b22ff(0xda)](_0x3b22ff(0xd1)),this['taskWorkerCacheList'][_0x3b22ff(0xd6)](_0x1d324c,0x1);break;}}}catch(_0x4bdb56){console[_0x3b22ff(0xda)](_0x4bdb56);}}),this[_0x572c68(0xa7)]['push']({'taskObj':_0x45c972,'worker':_0x14862f})),this[_0x572c68(0xaf)](_0x14862f,{'torrentSaveFolder':config[_0x572c68(0xa5)],'operation':'START','taskObj':_0x45c972});}['getTargetCache'](_0x3f1569){const _0x1cfa99=_0x92ae3d;for(let _0x10329d in this[_0x1cfa99(0xa7)]){let _0x378553=this[_0x1cfa99(0xa7)][_0x10329d];if(_0x378553[_0x1cfa99(0xa2)]['id']===_0x3f1569)return _0x378553;}}[_0x92ae3d(0xb1)](_0x309619){const _0x50b62b=_0x92ae3d;console['log'](_0x50b62b(0xd7),_0x309619[_0x50b62b(0xc9)]);let {operation:_0x366118,taskId:_0x25ab82,deleteFile:_0x2df517}=_0x309619;if(_0x366118==_0x50b62b(0xae)){if(_0x309619[_0x50b62b(0x9a)]&&_0x309619[_0x50b62b(0x9a)][_0x50b62b(0xc8)]>0x0)for(let _0x220473 of _0x309619[_0x50b62b(0x9a)]){this[_0x50b62b(0x99)](_0x220473);}}else{if(_0x366118==_0x50b62b(0xca))this[_0x50b62b(0xa4)](_0x309619['taskObj']);else{if(_0x366118==_0x50b62b(0xc2))this[_0x50b62b(0xa1)](_0x309619[_0x50b62b(0xa2)]);else{if(_0x366118==_0x50b62b(0xd5))_0x309619[_0x50b62b(0xa2)]&&this[_0x50b62b(0x99)](_0x309619[_0x50b62b(0xa2)]);else{if(_0x366118==_0x50b62b(0x9e))_0x309619['taskObj']&&(this[_0x50b62b(0xa1)](_0x309619['taskObj']),this[_0x50b62b(0x99)](_0x309619[_0x50b62b(0xa2)]));else{if(_0x366118==_0x50b62b(0xbd))this[_0x50b62b(0xb3)]();else{if(_0x366118==_0x50b62b(0xcf))this[_0x50b62b(0x9c)]();else _0x366118==_0x50b62b(0xd8)&&this[_0x50b62b(0xc7)]();}}}}}}}}function _0x13d1(_0x3e9581,_0xdf7ede){const _0x1c2df3=_0x1c2d();return _0x13d1=function(_0x13d12a,_0x2cfee2){_0x13d12a=_0x13d12a-0x99;let _0x5e2b09=_0x1c2df3[_0x13d12a];return _0x5e2b09;},_0x13d1(_0x3e9581,_0xdf7ede);}module['exports']=btDownloadManager;