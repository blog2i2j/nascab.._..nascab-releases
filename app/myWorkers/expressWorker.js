const _0x5bc9a7=_0x4235;(function(_0x33daed,_0x5aa064){const _0x39711b=_0x4235,_0x36c562=_0x33daed();while(!![]){try{const _0x61d38=parseInt(_0x39711b(0x1e5))/0x1*(parseInt(_0x39711b(0x1eb))/0x2)+-parseInt(_0x39711b(0x1d2))/0x3+parseInt(_0x39711b(0x1fc))/0x4*(parseInt(_0x39711b(0x1fb))/0x5)+parseInt(_0x39711b(0x1cb))/0x6*(-parseInt(_0x39711b(0x1c6))/0x7)+-parseInt(_0x39711b(0x1cf))/0x8*(parseInt(_0x39711b(0x1e6))/0x9)+-parseInt(_0x39711b(0x1e3))/0xa*(parseInt(_0x39711b(0x1dc))/0xb)+parseInt(_0x39711b(0x1ca))/0xc;if(_0x61d38===_0x5aa064)break;else _0x36c562['push'](_0x36c562['shift']());}catch(_0x93c2e6){_0x36c562['push'](_0x36c562['shift']());}}}(_0x4041,0xd3673));const expressApp=require(_0x5bc9a7(0x1e4)),fs=require('fs'),path=require('path'),config=require(_0x5bc9a7(0x1ed)),Database=require(_0x5bc9a7(0x1f4)),dbConfigTable=require(_0x5bc9a7(0x1c9));let dbNoticeCenterTable=require(_0x5bc9a7(0x1c8));const http=require('http'),https=require('https');let dbOther=new Database(config[_0x5bc9a7(0x1de)],{});dbOther[_0x5bc9a7(0x1c3)](_0x5bc9a7(0x1d7));let tls=require(_0x5bc9a7(0x1e0));const cryptoUtils=require('../express-server/utils/cryptoUtils');function _0x4041(){const _0x38620f=['../myConfig/config','decryptString','key.pem','certs','createSecureContext','HTTPS\x20certs\x20error','message','better-sqlite3','createServer','stringify','error','httpsCert','(Custom\x20https\x20key)','listen','10hVjxgt','475552VeULzj','usePort','https\x20service\x20is\x20running','Error\x20occurred\x20in\x20api\x20process','readFileSync','../utils/messageUtil','Error\x20occurred\x20in\x20api\x20process\x20','send','expressStarted','appRootPath','close','pragma','apiServerHttps','HTTPS\x20certs\x20not\x20exist','105KoPQRy','run','../db/dbNoticeCenterTable','../db/dbConfigTable','37309284uiLooQ','28746Kbgkni','nasZs987bac','httpsKey','saveMsg','8XFbZSl','join','title','537138OEuUZl','warning','existsSync','证书信息:系统默认证书(Default\x20https\x20cert)','stack','journal_mode\x20=\x20WAL','env','toString','证书信息:系统默认证书(Default\x20https\x20key)','uncaughtException','68871rCQhIL','findByTitle','dbOther','https\x20service\x20is\x20not\x20running\x20','tls','(Custom\x20https\x20cert)','value','2240xVsAjo','../express-server/app','599XeXVfI','11324538YEubYs','create','NasCabApiWorker','startsWith','log','1438rhGKQX','apiPortHttps'];_0x4041=function(){return _0x38620f;};return _0x4041();}var expressWs=require('express-ws');const messageUtil=require(_0x5bc9a7(0x1bd));function _0x4235(_0x411d03,_0x5a94ec){const _0x4041bc=_0x4041();return _0x4235=function(_0x423525,_0x249f04){_0x423525=_0x423525-0x1b9;let _0x3f59ed=_0x4041bc[_0x423525];return _0x3f59ed;},_0x4235(_0x411d03,_0x5a94ec);}process[_0x5bc9a7(0x1d1)]=_0x5bc9a7(0x1e8);function testCertAndKeyMatch(_0x4b6d38,_0x4c622c){const _0x62ed35=_0x5bc9a7;try{return tls[_0x62ed35(0x1f1)]({'cert':_0x4b6d38,'key':_0x4c622c}),!![];}catch(_0x4c2335){return![];}}function notifyMainLoadPage(_0x4ed15b){const _0x1d40bb=_0x5bc9a7;currentPort=_0x4ed15b,process[_0x1d40bb(0x1bf)]({'type':_0x1d40bb(0x1c0),'exressPort':_0x4ed15b});}function getFreePort(_0x42530f,_0x26b564){_0x42530f=parseInt(_0x42530f),isPortFree(_0x42530f)['then'](_0x45123f=>{_0x45123f?_0x26b564(_0x42530f):(_0x42530f=parseInt(_0x42530f)+0x1,getFreePort(_0x42530f,_0x26b564));});}function isPortFree(_0x153752){return new Promise(_0x2db5fb=>{const _0x52f66a=_0x4235,_0x2c032b=http[_0x52f66a(0x1f5)]()['listen'](_0x153752,()=>{const _0x395a6b=_0x52f66a;_0x2c032b[_0x395a6b(0x1c2)](),_0x2db5fb(!![]);})['on']('error',()=>{_0x2db5fb(![]);});});}function setHttpsError(_0x4c243b){const _0xa31265=_0x5bc9a7;console[_0xa31265(0x1ea)](_0xa31265(0x1df),_0x4c243b),dbConfigTable[_0xa31265(0x1e7)](dbOther,{'title':_0xa31265(0x1c4),'value':JSON['stringify']({'state':_0xa31265(0x1f7),'port':0x0,'message':_0x4c243b?JSON[_0xa31265(0x1f6)](_0x4c243b):_0xa31265(0x1f7)})}),dbNoticeCenterTable[_0xa31265(0x1e7)](dbOther,{'title':'https\x20service\x20is\x20not\x20running','level':_0xa31265(0x1f7),'content':_0x4c243b?JSON[_0xa31265(0x1f6)](_0x4c243b):_0xa31265(0x1f7)});}function startListen(_0x10f850){const _0x241409=_0x5bc9a7;expressApp[_0x241409(0x1fa)](_0x10f850,()=>{const _0x27047b=_0x241409;notifyMainLoadPage(_0x10f850);try{let _0x42bea9=0x1bb,_0x119b07=dbConfigTable['findByTitle'](dbOther,_0x27047b(0x1ec));_0x119b07&&_0x119b07[_0x27047b(0x1e2)]&&_0x119b07['value']>0x0&&_0x119b07['value']<0xffff&&(_0x42bea9=_0x119b07['value']),getFreePort(_0x42bea9,async _0x75325d=>{const _0x450ef2=_0x27047b;_0x42bea9=_0x75325d;let _0x330737='',_0x169416='',_0x4c7913=dbConfigTable['findByTitle'](dbOther,_0x450ef2(0x1f8));_0x4c7913&&_0x4c7913[_0x450ef2(0x1e2)]&&(_0x330737=_0x4c7913[_0x450ef2(0x1e2)],console['log'](_0x450ef2(0x1e1)));let _0xc24071=dbConfigTable[_0x450ef2(0x1dd)](dbOther,_0x450ef2(0x1cd));_0xc24071&&_0xc24071[_0x450ef2(0x1e2)]&&(_0x169416=_0xc24071[_0x450ef2(0x1e2)],console['log'](_0x450ef2(0x1f9)));if(!_0x330737){let _0x4c51b6=path[_0x450ef2(0x1d0)](config[_0x450ef2(0x1c1)],_0x450ef2(0x1f0),'cert.pem');if(!fs[_0x450ef2(0x1d4)](_0x4c51b6))return setHttpsError(_0x450ef2(0x1c5));_0x330737=fs[_0x450ef2(0x1bc)](_0x4c51b6)[_0x450ef2(0x1d9)](),console['log'](_0x450ef2(0x1d5));}if(!_0x169416){let _0x2eaa65=path[_0x450ef2(0x1d0)](config[_0x450ef2(0x1c1)],_0x450ef2(0x1f0),_0x450ef2(0x1ef));if(!fs[_0x450ef2(0x1d4)](_0x2eaa65))return setHttpsError('HTTPS\x20certs\x20not\x20exist');console[_0x450ef2(0x1ea)](_0x450ef2(0x1da)),_0x169416=fs[_0x450ef2(0x1bc)](_0x2eaa65)[_0x450ef2(0x1d9)]();}if(!_0x330737[_0x450ef2(0x1e9)]('-----'))try{_0x330737=await cryptoUtils['decryptString'](_0x450ef2(0x1cc),_0x330737),_0x169416=await cryptoUtils[_0x450ef2(0x1ee)]('nasZs987bac',_0x169416),console[_0x450ef2(0x1ea)]('(Encrypted\x20https\x20cert)');}catch(_0x2605c0){console[_0x450ef2(0x1ea)](_0x2605c0);}const _0x162d79=testCertAndKeyMatch(_0x330737,_0x169416);if(!_0x162d79){setHttpsError(_0x450ef2(0x1f2));return;}const _0x30818e={'cert':_0x330737,'key':_0x169416};let _0x5cdad5=https['createServer'](_0x30818e,expressApp);expressWs(expressApp,_0x5cdad5),_0x5cdad5[_0x450ef2(0x1fa)](_0x42bea9,_0x90bf58=>{const _0x1f7084=_0x450ef2;process[_0x1f7084(0x1bf)]({'type':'expressStartedHttps','exressPort':_0x42bea9}),dbConfigTable[_0x1f7084(0x1e7)](dbOther,{'title':_0x1f7084(0x1c4),'value':JSON[_0x1f7084(0x1f6)]({'state':_0x1f7084(0x1c7),'port':_0x42bea9,'message':_0x1f7084(0x1ba)})});}),_0x5cdad5['on'](_0x450ef2(0x1f7),_0x3d0b7a=>{const _0x479cd0=_0x450ef2;console[_0x479cd0(0x1ea)](_0x3d0b7a),dbConfigTable['create'](dbOther,{'title':_0x479cd0(0x1c4),'value':JSON['stringify']({'state':_0x479cd0(0x1f7),'port':_0x42bea9,'message':'https\x20service\x20is\x20not\x20running'})});});});}catch(_0x28de15){console[_0x27047b(0x1ea)](_0x28de15),setHttpsError(_0x28de15);}});}process['on'](_0x5bc9a7(0x1db),(_0x286d66,_0x3233cb)=>{const _0x34dd01=_0x5bc9a7;console[_0x34dd01(0x1ea)](_0x34dd01(0x1be),_0x286d66),messageUtil[_0x34dd01(0x1ce)](dbOther,_0x34dd01(0x1bb),_0x34dd01(0x1f7),_0x286d66[_0x34dd01(0x1d6)]||_0x286d66[_0x34dd01(0x1f3)]);}),process['on'](_0x5bc9a7(0x1d3),_0x2036a3=>console['warn'](_0x2036a3[_0x5bc9a7(0x1d6)])),startListen(process[_0x5bc9a7(0x1d8)][_0x5bc9a7(0x1b9)]);