const _0x2865c9=_0x5653;(function(_0x4ea149,_0x21fe7f){const _0x17741a=_0x5653,_0x1fb979=_0x4ea149();while(!![]){try{const _0x222acf=-parseInt(_0x17741a(0xac))/0x1+parseInt(_0x17741a(0x8a))/0x2*(parseInt(_0x17741a(0xa3))/0x3)+-parseInt(_0x17741a(0xb0))/0x4+-parseInt(_0x17741a(0xae))/0x5*(parseInt(_0x17741a(0xa4))/0x6)+parseInt(_0x17741a(0xab))/0x7*(-parseInt(_0x17741a(0x92))/0x8)+-parseInt(_0x17741a(0x84))/0x9*(parseInt(_0x17741a(0x8e))/0xa)+parseInt(_0x17741a(0xb2))/0xb*(parseInt(_0x17741a(0xa7))/0xc);if(_0x222acf===_0x21fe7f)break;else _0x1fb979['push'](_0x1fb979['shift']());}catch(_0x1fd5df){_0x1fb979['push'](_0x1fb979['shift']());}}}(_0x58a4,0xe5e34));const expressApp=require(_0x2865c9(0x88)),fs=require('fs'),path=require('path'),config=require(_0x2865c9(0x78)),Database=require(_0x2865c9(0x7c)),dbConfigTable=require(_0x2865c9(0x7a));let dbNoticeCenterTable=require(_0x2865c9(0x7e));const http=require(_0x2865c9(0xa0)),https=require(_0x2865c9(0x9f));let dbOther=new Database(config[_0x2865c9(0x96)],{});function _0x5653(_0x313f46,_0x48a57c){const _0x58a48c=_0x58a4();return _0x5653=function(_0x565357,_0x356e41){_0x565357=_0x565357-0x6d;let _0x2e8618=_0x58a48c[_0x565357];return _0x2e8618;},_0x5653(_0x313f46,_0x48a57c);}dbOther[_0x2865c9(0x79)](_0x2865c9(0x87));let tls=require(_0x2865c9(0xa2));const cryptoUtils=require(_0x2865c9(0x7b));var expressWs=require('express-ws');function _0x58a4(){const _0x3ad59b=['(Custom\x20https\x20key)','NasCabApiWorker','expressStartedHttps','join','apiServerHttps','toString','close','HTTPS\x20certs\x20error','../myConfig/config','pragma','../db/dbConfigTable','../express-server/utils/cryptoUtils','better-sqlite3','warning','../db/dbNoticeCenterTable','stack','appRootPath','https\x20service\x20is\x20not\x20running','existsSync','findByTitle','261KgUnUx','then','run','journal_mode\x20=\x20WAL','../express-server/app','../utils/messageUtil','35792TgwsEj','expressStarted','saveMsg','httpsKey','450280TRBYvF','error','nasZs987bac','send','377576ZLUUux','createServer','证书信息:系统默认证书(Default\x20https\x20key)','listen','dbOther','(Encrypted\x20https\x20cert)','createSecureContext','https\x20service\x20is\x20not\x20running\x20','env','key.pem','Error\x20occurred\x20in\x20api\x20process','Error\x20occurred\x20in\x20api\x20process\x20','uncaughtException','https','http','HTTPS\x20certs\x20not\x20exist','tls','225QjKGOe','498eEzTCQ','log','(Custom\x20https\x20cert)','21475236rYBRKa','证书信息:系统默认证书(Default\x20https\x20cert)','title','message','203ahoMPO','1184964pXiCNU','readFileSync','59605PJqbPT','value','3681828QYutdG','stringify','33PxitAO','startsWith','create','-----','apiPortHttps'];_0x58a4=function(){return _0x3ad59b;};return _0x58a4();}const messageUtil=require(_0x2865c9(0x89));process[_0x2865c9(0xa9)]=_0x2865c9(0x71);function testCertAndKeyMatch(_0x5e0f78,_0x118bb6){const _0x1fc080=_0x2865c9;try{return tls[_0x1fc080(0x98)]({'cert':_0x5e0f78,'key':_0x118bb6}),!![];}catch(_0x5c7ac2){return![];}}function notifyMainLoadPage(_0x59a40e){const _0x45fccb=_0x2865c9;currentPort=_0x59a40e,process[_0x45fccb(0x91)]({'type':_0x45fccb(0x8b),'exressPort':_0x59a40e});}function getFreePort(_0x50b8b1,_0x2c1ad7){const _0x2b0285=_0x2865c9;_0x50b8b1=parseInt(_0x50b8b1),isPortFree(_0x50b8b1)[_0x2b0285(0x85)](_0x4cd851=>{_0x4cd851?_0x2c1ad7(_0x50b8b1):(_0x50b8b1=parseInt(_0x50b8b1)+0x1,getFreePort(_0x50b8b1,_0x2c1ad7));});}function isPortFree(_0x1d59fb){return new Promise(_0x2cc150=>{const _0x3bda36=_0x5653,_0x457085=http[_0x3bda36(0x93)]()['listen'](_0x1d59fb,()=>{const _0x761c78=_0x3bda36;_0x457085[_0x761c78(0x76)](),_0x2cc150(!![]);})['on']('error',()=>{_0x2cc150(![]);});});}function setHttpsError(_0x3f946b){const _0x1e01b7=_0x2865c9;console[_0x1e01b7(0xa5)](_0x1e01b7(0x99),_0x3f946b),dbConfigTable[_0x1e01b7(0x6d)](dbOther,{'title':'apiServerHttps','value':JSON['stringify']({'state':'error','port':0x0,'message':_0x3f946b?JSON[_0x1e01b7(0xb1)](_0x3f946b):_0x1e01b7(0x8f)})}),dbNoticeCenterTable['create'](dbOther,{'title':_0x1e01b7(0x81),'level':_0x1e01b7(0x8f),'content':_0x3f946b?JSON['stringify'](_0x3f946b):_0x1e01b7(0x8f)});}function startListen(_0x3fa885){const _0x346335=_0x2865c9;expressApp[_0x346335(0x95)](_0x3fa885,()=>{const _0x10c77a=_0x346335;notifyMainLoadPage(_0x3fa885);try{let _0xdeab1b=0x1bb,_0x758426=dbConfigTable['findByTitle'](dbOther,_0x10c77a(0x6f));_0x758426&&_0x758426[_0x10c77a(0xaf)]&&_0x758426[_0x10c77a(0xaf)]>0x0&&_0x758426[_0x10c77a(0xaf)]<0xffff&&(_0xdeab1b=_0x758426[_0x10c77a(0xaf)]),getFreePort(_0xdeab1b,async _0x5730be=>{const _0x16d8ac=_0x10c77a;_0xdeab1b=_0x5730be;let _0x1bc11d='',_0x1e75c2='',_0x59ac34=dbConfigTable[_0x16d8ac(0x83)](dbOther,'httpsCert');_0x59ac34&&_0x59ac34['value']&&(_0x1bc11d=_0x59ac34[_0x16d8ac(0xaf)],console[_0x16d8ac(0xa5)](_0x16d8ac(0xa6)));let _0x3f926f=dbConfigTable[_0x16d8ac(0x83)](dbOther,_0x16d8ac(0x8d));_0x3f926f&&_0x3f926f[_0x16d8ac(0xaf)]&&(_0x1e75c2=_0x3f926f['value'],console[_0x16d8ac(0xa5)](_0x16d8ac(0x70)));if(!_0x1bc11d){let _0x3eead8=path[_0x16d8ac(0x73)](config[_0x16d8ac(0x80)],'certs','cert.pem');if(!fs[_0x16d8ac(0x82)](_0x3eead8))return setHttpsError(_0x16d8ac(0xa1));_0x1bc11d=fs[_0x16d8ac(0xad)](_0x3eead8)[_0x16d8ac(0x75)](),console[_0x16d8ac(0xa5)](_0x16d8ac(0xa8));}if(!_0x1e75c2){let _0x534533=path[_0x16d8ac(0x73)](config[_0x16d8ac(0x80)],'certs',_0x16d8ac(0x9b));if(!fs[_0x16d8ac(0x82)](_0x534533))return setHttpsError(_0x16d8ac(0xa1));console[_0x16d8ac(0xa5)](_0x16d8ac(0x94)),_0x1e75c2=fs[_0x16d8ac(0xad)](_0x534533)[_0x16d8ac(0x75)]();}if(!_0x1bc11d[_0x16d8ac(0xb3)](_0x16d8ac(0x6e)))try{_0x1bc11d=await cryptoUtils['decryptString'](_0x16d8ac(0x90),_0x1bc11d),_0x1e75c2=await cryptoUtils['decryptString']('nasZs987bac',_0x1e75c2),console['log'](_0x16d8ac(0x97));}catch(_0x18350b){console[_0x16d8ac(0xa5)](_0x18350b);}const _0x3b3421=testCertAndKeyMatch(_0x1bc11d,_0x1e75c2);if(!_0x3b3421){setHttpsError(_0x16d8ac(0x77));return;}const _0x477e4d={'cert':_0x1bc11d,'key':_0x1e75c2};let _0x971a8b=https[_0x16d8ac(0x93)](_0x477e4d,expressApp);expressWs(expressApp,_0x971a8b),_0x971a8b[_0x16d8ac(0x95)](_0xdeab1b,_0x90369a=>{const _0x55d5ef=_0x16d8ac;process[_0x55d5ef(0x91)]({'type':_0x55d5ef(0x72),'exressPort':_0xdeab1b}),dbConfigTable['create'](dbOther,{'title':_0x55d5ef(0x74),'value':JSON[_0x55d5ef(0xb1)]({'state':_0x55d5ef(0x86),'port':_0xdeab1b,'message':'https\x20service\x20is\x20running'})});}),_0x971a8b['on']('error',_0x15b501=>{const _0x5d6af5=_0x16d8ac;console['log'](_0x15b501),dbConfigTable[_0x5d6af5(0x6d)](dbOther,{'title':_0x5d6af5(0x74),'value':JSON['stringify']({'state':_0x5d6af5(0x8f),'port':_0xdeab1b,'message':_0x5d6af5(0x81)})});});});}catch(_0x290163){console[_0x10c77a(0xa5)](_0x290163),setHttpsError(_0x290163);}});}process['on'](_0x2865c9(0x9e),(_0x50573f,_0x55131e)=>{const _0x391f1d=_0x2865c9;console[_0x391f1d(0xa5)](_0x391f1d(0x9d),_0x50573f),messageUtil[_0x391f1d(0x8c)](dbOther,_0x391f1d(0x9c),_0x391f1d(0x8f),_0x50573f[_0x391f1d(0x7f)]||_0x50573f[_0x391f1d(0xaa)]);}),process['on'](_0x2865c9(0x7d),_0x2a514a=>console['warn'](_0x2a514a[_0x2865c9(0x7f)])),startListen(process[_0x2865c9(0x9a)]['usePort']);